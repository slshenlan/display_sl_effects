(self["webpackChunkshenlan_code"]=self["webpackChunkshenlan_code"]||[]).push([[924],{64924:function(t,e,n){"use strict";n.r(e),n.d(e,{default:function(){return O}});var r=function(){var t=this,e=t._self._c;return e("div",{staticClass:"sl-main-content"},[e("Card",[e("p",{attrs:{slot:"title"},slot:"title"},[t._v("展示")]),e("div",{staticClass:"extra",attrs:{slot:"extra"},slot:"extra"},[e("div",{staticClass:"sl-margin-right-10"},[e("label",[t._v("基站")]),e("iSwitch",{on:{"on-change":t.l7MapToggleJiZhanLayer},model:{value:t.demo1.switch.layer,callback:function(e){t.$set(t.demo1.switch,"layer",e)},expression:"demo1.switch.layer"}})],1),e("div",[e("label",[t._v("围栏")]),e("iSwitch",{on:{"on-change":t.l7MapTogglePolygonLayer},model:{value:t.demo1.switch.polygon,callback:function(e){t.$set(t.demo1.switch,"polygon",e)},expression:"demo1.switch.polygon"}})],1)]),e("div",[e("div",{staticClass:"map",attrs:{id:"demo-1"}},[e("sl-l7",{ref:"sll7_1",attrs:{id:"sll7-1"}})],1)])]),e("Card",{staticClass:"sl-margin-top-10"},[e("p",{attrs:{slot:"title"},slot:"title"},[t._v("可编辑")]),e("div",{staticClass:"extra",attrs:{slot:"extra"},slot:"extra"},[e("Button",{attrs:{type:"primary"},on:{click:t.demo2MapGetDrawPolygonData}},[t._v("获取数据")])],1),e("div",[e("div",{staticClass:"map",attrs:{id:"demo-2"}},[e("sl-l7",{ref:"sll7_2",attrs:{id:"sll7-2"}})],1)])])],1)},i=[],o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"sl-com-l7"},[e("fullscreen",{staticClass:"l7-full",model:{value:t.mixinFullscreen,callback:function(e){t.mixinFullscreen=e},expression:"mixinFullscreen"}},[e("div",{staticClass:"l7-map",attrs:{id:t.id}},[t.fullscreen?e("span",{staticClass:"span-full",class:{selected:t.mixinFullscreen},on:{click:t.mixinFullscreenMethod}}):t._e()])])],1)},a=[],s=n(40347),u=n.n(s),c=n(27195);c["default"].use(u());var l={data:function(){return{mixinFullscreen:!1}},computed:{},beforeDestroy:function(){},mounted:function(){this.$nextTick((function(){}))},methods:{mixinFullscreenMethod:function(){this.mixinFullscreen=!this.mixinFullscreen}}},h=n(23698),f=n(78910),p=n(5868),d=10,v=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(0,f.Z)(t,2),r=n[0],i=n[1],o=e-i;return(0,p.metersToLngLat)([r*d,o*d])},m=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=(0,p.lngLatToMeters)(t),r=(0,f.Z)(n,2),i=r[0],o=r[1];return[i/d,e-o/d]},g=function(t,e){var n=(t/275*10).toFixed(1),r=(e/275*10).toFixed(1),i=(e/275).toFixed(1);return{l7MapWidth:i,maxRange:(0,p.metersToLngLat)([n,r])}},y=n(86080),_={data:function(){return{pointLayer:{data:[],list:{}},pointLayerList:{data:[],list:{}}}},computed:{},beforeDestroy:function(){},mounted:function(){this.$nextTick((function(){}))},methods:{pointLayerSetData:function(t){t=this.l7DemoData().station;var e=this.scene,n=this.pointLayer,r=this.l7MapWidth;n.data=t,e.addImage("Gateway","".concat("/upload/ybimg/","number.png")),e.addImage("GatewayCar","".concat("/upload/ybimg/","car.png"));var i=n.data.reduce((function(t,e){var n=v([e.setX,e.setY],r),i=(0,f.Z)(n,2),o=i[0],a=i[1],s=(0,y.Z)((0,y.Z)({},e),{},{lng:o,lat:a});return t[e.type]?t[e.type].push(s):t[e.type]=[s],t}),{});for(var o in i)Object.hasOwnProperty.call(i,o)&&this.handleSetData(i[o],o)},handleSetData:function(t,e){var n=this,r=this.scene,i=new p.PointLayer({zIndex:3}).source(t,{parser:{type:"json",x:"lng",y:"lat",name:"type"}}).shape(e).size(20);i.on("mousemove",(function(t){n.mapPopup.setLnglat(t.lngLat).setHTML("<span>\n                <p>编号:".concat(t.feature.gateway,"</p>\n                <p>类型: Gateway</p>\n                <p>X:").concat(t.feature.setX,"</p>\n                <p>Y:").concat(t.feature.setY,"</p>\n              </span>")),r.addPopup(n.mapPopup)})),i.on("mouseout",(function(){n.mapPopup.hide()})),this.pointLayer.list[e]={layer:i,source:t},r.addLayer(i)},pointLayerListSetData:function(t){t=this.l7DemoData().stationList;var e=this.scene,n=this.l7MapWidth,r=t.reduce((function(t,e){var r=v([e.posX,e.posY],n),i=(0,f.Z)(r,2),o=i[0],a=i[1];return t.push((0,y.Z)((0,y.Z)({},e),{},{lng:o,lat:a})),t}),[]),i=new p.PointLayer({zIndex:3}).source(r,{parser:{type:"json",x:"lng",y:"lat",name:"type"}}).shape("circle").size(5).color("mag",(function(){return"#5B8FF9"}));e.addLayer(i);for(var o=[],a=0;a<t.length;a++){var s=t[a],u=t[a+1];if(u){var c=v([s.posX,s.posY],n),l=(0,f.Z)(c,2),h=l[0],d=l[1],m=v([u.posX,u.posY],n),g=(0,f.Z)(m,2),_=g[0],x=g[1];o.push((0,y.Z)((0,y.Z)({},s),{},{lng:h,lat:d,lng1:_,lat1:x}))}}var b=new p.LineLayer({zIndex:3}).source(o,{parser:{type:"json",x:"lng",y:"lat",x1:"lng1",y1:"lat1"}}).shape("line").size(2).color("#5B8FF9").animate({interval:.4,duration:1,trailLength:.8}).style({lineTexture:!0,iconStep:20});e.addLayer(b)},pointLayerToggleXinbiao:function(t){var e=this.scene,n=this.pointLayer.list.Gateway;t?this.handleSetData(n.source,"Gateway"):e.removeLayer(n.layer)},pointLayerToggleJizhan:function(t){var e=this.scene,n=this.pointLayer.list.GatewayCar;t?this.handleSetData(n.source,"GatewayCar"):e.removeLayer(n.layer)}}},x=n(98489),b={data:function(){return{polygonLayer:{data:[],source:null}}},computed:{},beforeDestroy:function(){},mounted:function(){this.$nextTick((function(){}))},methods:{polygonLayerSetData:function(t){t=this.l7DemoData().fence;var e=this.scene,n=this.l7MapWidth,r=this.polygonLayer;r.data=t,r.data.forEach((function(t){var r={type:"FeatureCollection",features:[{type:"Feature",properties:{name:t.name,code:t.fenceId,c:"In"===t.type?"#95de64":"#ffd666"},geometry:{type:"Polygon",coordinates:[t.points.map((function(t){return v([t.x,t.y],n)}))]}}]},i=new p.PolygonLayer({zIndex:4,name:"fence-layout-"+t.fenceId,active:!0,activeColor:"red"}).source(r).shape("fill").color("c").style({opacity:.6});t.polygonLayer=i,e.addLayer(i)}))},polygonLayerSetEdit:function(){var t=this.l7MapWidth,e=this.l7DemoData().fence.reduce((function(e,n){return e.push({type:"Feature",properties:{},geometry:{type:"Polygon",coordinates:[n.points.map((function(e){return v([e.x,e.y],t)}))]}}),e}),[]),n=new x.DrawPolygon(this.scene,{initialData:e,liveUpdate:!0,distanceOptions:{showTotalDistance:!1,showDashDistance:!0,format:function(t){return t>=1e3?+(t/d/1e3).toFixed(2)+"km":+(t/d).toFixed(2)+"m"}}});n.enable(),this.scene.drawPolygon=n},polygonLayerGetData:function(){var t=this.l7MapWidth,e=this.scene.drawPolygon.getPolygonData();e.map((function(e){var n,r=null===(n=e.geometry.coordinates)||void 0===n?void 0:n[0];return r.map((function(e){var n=null!==e&&void 0!==e?e:[],r=(0,f.Z)(n,2),i=r[0],o=r[1],a=m([i,o],t),s=(0,f.Z)(a,2),u=s[0],c=s[1];return{x:u,y:c}}))}))},polygonLayerToggle:function(t){var e=this;t?this.polygonLayerSetData(this.polygonLayer.data):this.polygonLayer.data.forEach((function(t){e.scene.removeLayer(t.polygonLayer)}))}}},w={mixins:[_,b],data:function(){return{scene:null,l7MapWidth:0}},computed:{},beforeDestroy:function(){try{this.scene.removeAllLayer()}catch(t){}},mounted:function(){this.$nextTick((function(){}))},methods:{mapInit:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:19.85;return new Promise((function(n){var r=new p.Scene({id:t.id,logoVisible:!1,map:new p.Mapbox({style:"light",center:[0,0],pitch:0,zoom:e,minZoom:18})});t.scene=r,r.on("loaded",(function(){t.mapPopup=new p.Popup({offsets:[0,0],closeButton:!1}),n()}))}))},mapSetBackgroundImage:function(t){t={width:2048,height:950,src:"/upload/ybimg/room2.png"};var e=this.scene,n=g(t.width,t.height),r=n.maxRange;this.l7MapWidth=4.2;var i=new p.ImageLayer({});i.source(t.src,{parser:{type:"image",extent:[0,0].concat((0,h.Z)(r))}}),e.setCenter([r[0]/2,r[1]/2]),e.addLayer(i)},mapClear:function(){try{this.scene.removeAllLayer(),this.scene.drawPolygon.clear()}catch(t){}},mapGetScene:function(){return this.scene},l7DemoData:function(){return{station:[{gateway:"10030240",mapId:"1645334018633216001",groupId:"3",name:"中心",productName:"gateway",systemId:"10990145",type:"Gateway",status:"Online",ip:"61.194.146.44",fenceIds:null,setX:3.5,setY:1.9,setZ:2.5,angle:90,hisX:.306456,hisY:-.306456,hisZ:-9.65336,updateTime:1687752916,extraInfo:null},{gateway:"10030241",mapId:"1645334018633216001",groupId:"3",name:"原点",productName:"gateway",systemId:"10990145",type:"Gateway",status:"Offline",ip:"61.194.146.44",fenceIds:null,setX:.5,setY:2.1,setZ:2.5,angle:90,hisX:0,hisY:-.153228,hisZ:-10.4195,updateTime:1687752920,extraInfo:null},{gateway:"10030240",mapId:"1645334018633216001",groupId:"3",name:"中心",productName:"gateway",systemId:"10990145",type:"GatewayCar",status:"Online",ip:"61.194.146.44",fenceIds:null,setX:3.9,setY:2,setZ:2.5,angle:90,hisX:.306456,hisY:-.306456,hisZ:-9.65336,updateTime:1687752916,extraInfo:null},{gateway:"10030241",mapId:"1645334018633216001",groupId:"3",name:"原点",productName:"gateway",systemId:"10990145",type:"GatewayCar",status:"Offline",ip:"61.194.146.44",fenceIds:null,setX:1,setY:4.1,setZ:2.5,angle:90,hisX:0,hisY:-.153228,hisZ:-10.4195,updateTime:1687752920,extraInfo:null}],stationList:[{gateway:"10030240",mapId:"1645334018633216001",groupId:"3",name:"中心",productName:"gateway",systemId:"10990145",type:"Gateway",status:"Online",ip:"61.194.146.44",fenceIds:null,posX:3.5,posY:1.9,setZ:2.5,angle:90,hisX:.306456,hisY:-.306456,hisZ:-9.65336,updateTime:1687752916,extraInfo:null},{gateway:"10030240",mapId:"1645334018633216001",groupId:"3",name:"中心",productName:"gateway",systemId:"10990145",type:"Gateway",status:"Online",ip:"61.194.146.44",fenceIds:null,posX:3.62,posY:1.9,setZ:2.5,angle:90,hisX:.306456,hisY:-.306456,hisZ:-9.65336,updateTime:1687752916,extraInfo:null},{gateway:"10030240",mapId:"1645334018633216001",groupId:"3",name:"中心",productName:"gateway",systemId:"10990145",type:"Gateway",status:"Online",ip:"61.194.146.44",fenceIds:null,posX:3.73,posY:2,setZ:2.5,angle:90,hisX:.306456,hisY:-.306456,hisZ:-9.65336,updateTime:1687752916,extraInfo:null}],fence:[{fenceId:"1656844789678571521",name:"充电站",mapId:"1645334018633216001",mapName:"3F-RoomC",type:"Out",points:[{x:.37,y:2.12},{x:1.75,y:2.12},{x:1.4,y:3.16},{x:.42,y:3.14},{x:.37,y:2.12}],enabled:!0},{fenceId:"1673196278525186049",name:"禁止进入",mapId:"1645334018633216001",mapName:"3F-RoomC",type:"In",points:[{x:2.75,y:1.94},{x:3.97,y:1.92},{x:3.97,y:2.92},{x:2.76,y:2.91},{x:2.75,y:1.94}],enabled:!0}]}}}},E={name:"SlL7",mixins:[w,l],props:{id:{type:String,default:"l7-map-default"},fullscreen:{type:Boolean,default:!0}},data:function(){return{}},computed:{},watch:{},beforeDestroy:function(){},mounted:function(){this.$nextTick((function(){}))},methods:{}},S=E,A=n(43736),T=(0,A.Z)(S,o,a,!1,null,"0ef91e17",null),C=T.exports,k=C,M={data:function(){return{demo1:{switch:{layer:!0,polygon:!0}}}},computed:{},beforeDestroy:function(){},mounted:function(){var t=this;this.$nextTick((function(){t.demo1Init()}))},methods:{demo1Init:function(){var t=this.$refs.sll7_1;t.mapInit().then((function(){t.mapSetBackgroundImage(),t.pointLayerSetData(),t.polygonLayerSetData()}))},l7MapToggleJiZhanLayer:function(t){this.$refs.sll7_1.pointLayerToggleJizhan(t)},l7MapTogglePolygonLayer:function(t){this.$refs.sll7_1.polygonLayerToggle(t)}}},P={data:function(){return{}},computed:{},beforeDestroy:function(){},mounted:function(){var t=this;this.$nextTick((function(){t.demo2Init()}))},methods:{demo2Init:function(){var t=this.$refs.sll7_2;t.mapInit().then((function(){t.mapSetBackgroundImage(),t.polygonLayerSetEdit()}))},demo2MapGetDrawPolygonData:function(){}}},I={components:{SlL7:k},mixins:[M,P],data:function(){return{value1:""}},computed:{},watch:{},methods:{}},R=I,L=(0,A.Z)(R,r,i,!1,null,"2b5c8615",null),O=L.exports},46512:function(t,e,n){"use strict";var r,i,o=n(1692)["default"];n(57658),n(33948),n(21703),function(a,s){"object"===o(e)?t.exports=s():(r=s,i="function"===typeof r?r.call(e,n,e,t):r,void 0===i||(t.exports=i))}(0,(function(){function t(t){var r=[];return t.AMapUI&&r.push(e(t.AMapUI)),t.Loca&&r.push(n(t.Loca)),Promise.all(r)}function e(t){return new Promise((function(e,n){var s=[];if(t.plugins)for(var u=0;u<t.plugins.length;u+=1)-1==i.AMapUI.plugins.indexOf(t.plugins[u])&&s.push(t.plugins[u]);if(o.AMapUI===r.failed)n("前次请求 AMapUI 失败");else if(o.AMapUI===r.notload){o.AMapUI=r.loading,i.AMapUI.version=t.version||i.AMapUI.version,u=i.AMapUI.version;var c=document.body||document.head,l=document.createElement("script");l.type="text/javascript",l.src="https://webapi.amap.com/ui/"+u+"/main.js",l.onerror=function(t){o.AMapUI=r.failed,n("请求 AMapUI 失败")},l.onload=function(){if(o.AMapUI=r.loaded,s.length)window.AMapUI.loadUI(s,(function(){for(var t=0,n=s.length;t<n;t++){var r=s[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}for(e();a.AMapUI.length;)a.AMapUI.splice(0,1)[0]()}));else for(e();a.AMapUI.length;)a.AMapUI.splice(0,1)[0]()},c.appendChild(l)}else o.AMapUI===r.loaded?t.version&&t.version!==i.AMapUI.version?n("不允许多个版本 AMapUI 混用"):s.length?window.AMapUI.loadUI(s,(function(){for(var t=0,n=s.length;t<n;t++){var r=s[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}e()})):e():t.version&&t.version!==i.AMapUI.version?n("不允许多个版本 AMapUI 混用"):a.AMapUI.push((function(t){t?n(t):s.length?window.AMapUI.loadUI(s,(function(){for(var t=0,n=s.length;t<n;t++){var r=s[t].split("/").slice(-1)[0];window.AMapUI[r]=arguments[t]}e()})):e()}))}))}function n(t){return new Promise((function(e,n){if(o.Loca===r.failed)n("前次请求 Loca 失败");else if(o.Loca===r.notload){o.Loca=r.loading,i.Loca.version=t.version||i.Loca.version;var s=i.Loca.version,u=i.AMap.version.startsWith("2"),c=s.startsWith("2");if(u&&!c||!u&&c)n("JSAPI 与 Loca 版本不对应！！");else{u=i.key,c=document.body||document.head;var l=document.createElement("script");l.type="text/javascript",l.src="https://webapi.amap.com/loca?v="+s+"&key="+u,l.onerror=function(t){o.Loca=r.failed,n("请求 AMapUI 失败")},l.onload=function(){for(o.Loca=r.loaded,e();a.Loca.length;)a.Loca.splice(0,1)[0]()},c.appendChild(l)}}else o.Loca===r.loaded?t.version&&t.version!==i.Loca.version?n("不允许多个版本 Loca 混用"):e():t.version&&t.version!==i.Loca.version?n("不允许多个版本 Loca 混用"):a.Loca.push((function(t){t?n(t):n()}))}))}if(!window)throw Error("AMap JSAPI can only be used in Browser.");var r;(function(t){t.notload="notload",t.loading="loading",t.loaded="loaded",t.failed="failed"})(r||(r={}));var i={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},o={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},a={AMap:[],AMapUI:[],Loca:[]},s=[],u=function(t){"function"==typeof t&&(o.AMap===r.loaded?t(window.AMap):s.push(t))};return{load:function(e){return new Promise((function(n,a){if(o.AMap==r.failed)a("");else if(o.AMap==r.notload){var c=e.key,l=e.version,h=e.plugins;c?(window.AMap&&"lbs.amap.com"!==location.host&&a("禁止多种API加载方式混用"),i.key=c,i.AMap.version=l||i.AMap.version,i.AMap.plugins=h||i.AMap.plugins,o.AMap=r.loading,l=document.body||document.head,window.___onAPILoaded=function(i){if(delete window.___onAPILoaded,i)o.AMap=r.failed,a(i);else for(o.AMap=r.loaded,t(e).then((function(){n(window.AMap)}))["catch"](a);s.length;)s.splice(0,1)[0]()},h=document.createElement("script"),h.type="text/javascript",h.src="https://webapi.amap.com/maps?callback=___onAPILoaded&v="+i.AMap.version+"&key="+c+"&plugin="+i.AMap.plugins.join(","),h.onerror=function(t){o.AMap=r.failed,a(t)},l.appendChild(h)):a("请填写key")}else if(o.AMap==r.loaded)if(e.key&&e.key!==i.key)a("多个不一致的 key");else if(e.version&&e.version!==i.AMap.version)a("不允许多个版本 JSAPI 混用");else{if(c=[],e.plugins)for(l=0;l<e.plugins.length;l+=1)-1==i.AMap.plugins.indexOf(e.plugins[l])&&c.push(e.plugins[l]);c.length?window.AMap.plugin(c,(function(){t(e).then((function(){n(window.AMap)}))["catch"](a)})):t(e).then((function(){n(window.AMap)}))["catch"](a)}else if(e.key&&e.key!==i.key)a("多个不一致的 key");else if(e.version&&e.version!==i.AMap.version)a("不允许多个版本 JSAPI 混用");else{var f=[];if(e.plugins)for(l=0;l<e.plugins.length;l+=1)-1==i.AMap.plugins.indexOf(e.plugins[l])&&f.push(e.plugins[l]);u((function(){f.length?window.AMap.plugin(f,(function(){t(e).then((function(){n(window.AMap)}))["catch"](a)})):t(e).then((function(){n(window.AMap)}))["catch"](a)}))}}))},reset:function(){delete window.AMap,delete window.AMapUI,delete window.Loca,i={key:"",AMap:{version:"1.4.15",plugins:[]},AMapUI:{version:"1.1",plugins:[]},Loca:{version:"1.3.2"}},o={AMap:r.notload,AMapUI:r.notload,Loca:r.notload},a={AMap:[],AMapUI:[],Loca:[]}}}}))},95285:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(t){try{var e=function(){c||(c=!0,s())},n=function t(){try{u.documentElement.doScroll("left")}catch(r){return void setTimeout(t,50)}e()},r=(r=document.getElementsByTagName("script"))[r.length-1],i=r.getAttribute("data-injectcss");r=r.getAttribute("data-disable-injectsvg");if(!r){var o,a,s,u,c,l=function(t,e){e.parentNode.insertBefore(t,e)};if(i&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(r){console}}o=function(){var e,n=document.createElement("div");n.innerHTML=t._iconfont_svg_string_3580659,(n=n.getElementsByTagName("svg")[0])&&(n.setAttribute("aria-hidden","true"),n.style.position="absolute",n.style.width=0,n.style.height=0,n.style.overflow="hidden",(e=document.body).firstChild?l(n,e.firstChild):e.appendChild(n))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(o,0):(a=function(){document.removeEventListener("DOMContentLoaded",a,!1),o()},document.addEventListener("DOMContentLoaded",a,!1)):document.attachEvent&&(s=o,u=t.document,c=!1,n(),u.onreadystatechange=function(){"complete"==u.readyState&&(u.onreadystatechange=null,e())})}}catch(h){}}(window)},98489:function(t,e,n){var r,i,o,a=n(4982)["default"],s=n(86728)["default"],u=n(32046)["default"],c=n(1692)["default"];n(35837),n(74916),n(15306),n(2707),n(33948),n(57658),n(73210),n(21703),n(81299),n(41817),n(84944),n(33792),n(39575),n(76495),n(48675),n(33105),n(63408),n(14590),n(3462),n(33824),n(23767),n(8585),n(68696),n(83753),n(24603),n(28450),n(18264),n(30541),n(65069),function(a,s){"object"==c(e)?s(e,n(5868)):(i=[e,n(5868)],r=s,o="function"===typeof r?r.apply(e,i):r,void 0===o||(t.exports=o))}(0,(function(t,e){"use strict";var r={draw:"crosshair",pointHover:"pointer",pointDrag:"move",lineHover:"pointer",lineDrag:"move",polygonHover:"pointer",polygonDrag:"move"},i={point:[],line:[],polygon:[],midPoint:[],dashLine:[],text:[]},o="top",l="bottom",h="right",f="left",p="auto",d=[o,l,h,f],v="start",m="end",g="clippingParents",y="viewport",_="popper",x="reference",b=d.reduce((function(t,e){return t.concat([e+"-"+v,e+"-"+m])}),[]),w=[].concat(d,[p]).reduce((function(t,e){return t.concat([e,e+"-"+v,e+"-"+m])}),[]),E=["beforeRead","read","afterRead","beforeMain","main","afterMain","beforeWrite","write","afterWrite"];function S(t){return t?(t.nodeName||"").toLowerCase():null}function A(t){if(null==t)return window;if(""+t!="[object Window]"){var e=t.ownerDocument;return e&&e.defaultView||window}return t}function T(t){return t instanceof A(t).Element||t instanceof Element}function C(t){return t instanceof A(t).HTMLElement||t instanceof HTMLElement}function k(t){return"undefined"!=typeof ShadowRoot&&(t instanceof A(t).ShadowRoot||t instanceof ShadowRoot)}var M={name:"applyStyles",enabled:!0,phase:"write",fn:function(t){var e=t.state;Object.keys(e.elements).forEach((function(t){var n=e.styles[t]||{},r=e.attributes[t]||{},i=e.elements[t];C(i)&&S(i)&&(Object.assign(i.style,n),Object.keys(r).forEach((function(t){var e=r[t];!1===e?i.removeAttribute(t):i.setAttribute(t,!0===e?"":e)})))}))},effect:function(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};return Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow),function(){Object.keys(e.elements).forEach((function(t){var r=e.elements[t],i=e.attributes[t]||{},o=Object.keys(e.styles.hasOwnProperty(t)?e.styles[t]:n[t]).reduce((function(t,e){return t[e]="",t}),{});C(r)&&S(r)&&(Object.assign(r.style,o),Object.keys(i).forEach((function(t){r.removeAttribute(t)})))}))}},requires:["computeStyles"]};function P(t){return t.split("-")[0]}var I=Math.max,R=Math.min,L=Math.round;function O(){var t=navigator.userAgentData;return null!=t&&t.brands&&Array.isArray(t.brands)?t.brands.map((function(t){return t.brand+"/"+t.version})).join(" "):navigator.userAgent}function D(){return!/^((?!chrome|android).)*safari/i.test(O())}function N(t,e,n){void 0===e&&(e=!1),void 0===n&&(n=!1);var r=t.getBoundingClientRect(),i=1,o=1;e&&C(t)&&(i=t.offsetWidth>0&&L(r.width)/t.offsetWidth||1,o=t.offsetHeight>0&&L(r.height)/t.offsetHeight||1);var a=(T(t)?A(t):window).visualViewport,s=!D()&&n,u=(r.left+(s&&a?a.offsetLeft:0))/i,c=(r.top+(s&&a?a.offsetTop:0))/o,l=r.width/i,h=r.height/o;return{width:l,height:h,top:c,right:u+l,bottom:c+h,left:u,x:u,y:c}}function z(t){var e=N(t),n=t.offsetWidth,r=t.offsetHeight;return Math.abs(e.width-n)>1||(n=e.width),Math.abs(e.height-r)>1||(r=e.height),{x:t.offsetLeft,y:t.offsetTop,width:n,height:r}}function F(t,e){var n=e.getRootNode&&e.getRootNode();if(t.contains(e))return!0;if(n&&k(n)){var r=e;do{if(r&&t.isSameNode(r))return!0;r=r.parentNode||r.host}while(r)}return!1}function B(t){return A(t).getComputedStyle(t)}function U(t){return["table","td","th"].indexOf(S(t))>=0}function j(t){return((T(t)?t.ownerDocument:t.document)||window.document).documentElement}function Z(t){return"html"===S(t)?t:t.assignedSlot||t.parentNode||(k(t)?t.host:null)||j(t)}function V(t){return C(t)&&"fixed"!==B(t).position?t.offsetParent:null}function G(t){for(var e=A(t),n=V(t);n&&U(n)&&"static"===B(n).position;)n=V(n);return n&&("html"===S(n)||"body"===S(n)&&"static"===B(n).position)?e:n||function(t){var e=/firefox/i.test(O());if(/Trident/i.test(O())&&C(t)&&"fixed"===B(t).position)return null;var n=Z(t);for(k(n)&&(n=n.host);C(n)&&0>["html","body"].indexOf(S(n));){var r=B(n);if("none"!==r.transform||"none"!==r.perspective||"paint"===r.contain||-1!==["transform","perspective"].indexOf(r.willChange)||e&&"filter"===r.willChange||e&&r.filter&&"none"!==r.filter)return n;n=n.parentNode}return null}(t)||e}function H(t){return 0>["top","bottom"].indexOf(t)?"y":"x"}function W(t,e,n){return I(t,R(e,n))}function q(t){return Object.assign({},{top:0,right:0,bottom:0,left:0},t)}function X(t,e){return e.reduce((function(e,n){return e[n]=t,e}),{})}var Y={name:"arrow",enabled:!0,phase:"main",fn:function(t){var e,n=t.state,r=t.name,i=t.options,a=n.elements.arrow,s=n.modifiersData.popperOffsets,u=P(n.placement),c=H(u),p=[f,h].indexOf(u)>=0?"height":"width";if(a&&s){var v=function(t,e){return q("number"!=typeof(t="function"==typeof t?t(Object.assign({},e.rects,{placement:e.placement})):t)?t:X(t,d))}(i.padding,n),m=z(a),g="y"===c?o:f,y="y"===c?l:h,_=n.rects.reference[p]+n.rects.reference[c]-s[c]-n.rects.popper[p],x=s[c]-n.rects.reference[c],b=G(a),w=b?"y"===c?b.clientHeight||0:b.clientWidth||0:0,E=w/2-m[p]/2+(_/2-x/2),S=W(v[g],E,w-m[p]-v[y]);n.modifiersData[r]=((e={})[c]=S,e.centerOffset=S-E,e)}},effect:function(t){var e=t.state,n=t.options.element,r=void 0===n?"[data-popper-arrow]":n;null!=r&&("string"!=typeof r||(r=e.elements.popper.querySelector(r)))&&F(e.elements.popper,r)&&(e.elements.arrow=r)},requires:["popperOffsets"],requiresIfExists:["preventOverflow"]};function K(t){return t.split("-")[1]}var Q={top:"auto",right:"auto",bottom:"auto",left:"auto"};function J(t){var e,n=t.popper,r=t.popperRect,i=t.placement,a=t.variation,s=t.offsets,u=t.position,c=t.gpuAcceleration,p=t.adaptive,d=t.roundOffsets,v=t.isFixed,g=s.x,y=void 0===g?0:g,_=s.y,x=void 0===_?0:_,b="function"==typeof d?d({x:y,y:x}):{x:y,y:x};y=b.x,x=b.y;var w=s.hasOwnProperty("x"),E=s.hasOwnProperty("y"),S=f,T=o,C=window;if(p){var k=G(n),M="clientHeight",P="clientWidth";k===A(n)&&"static"!==B(k=j(n)).position&&"absolute"===u&&(M="scrollHeight",P="scrollWidth"),(i===o||(i===f||i===h)&&a===m)&&(T=l,x-=(v&&k===C&&C.visualViewport?C.visualViewport.height:k[M])-r.height,x*=c?1:-1),i!==f&&(i!==o&&i!==l||a!==m)||(S=h,y-=(v&&k===C&&C.visualViewport?C.visualViewport.width:k[P])-r.width,y*=c?1:-1)}var I,R=Object.assign({position:u},p&&Q),O=!0===d?function(t,e){var n=t.y,r=e.devicePixelRatio||1;return{x:L(t.x*r)/r||0,y:L(n*r)/r||0}}({x:y,y:x},A(n)):{x:y,y:x};return y=O.x,x=O.y,Object.assign({},R,c?((I={})[T]=E?"0":"",I[S]=w?"0":"",I.transform=(C.devicePixelRatio||1)>1?"translate3d("+y+"px, "+x+"px, 0)":"translate("+y+"px, "+x+"px)",I):((e={})[T]=E?x+"px":"",e[S]=w?y+"px":"",e.transform="",e))}var $={passive:!0},tt={left:"right",right:"left",bottom:"top",top:"bottom"};function et(t){return t.replace(/left|right|bottom|top/g,(function(t){return tt[t]}))}var nt={start:"end",end:"start"};function rt(t){return t.replace(/start|end/g,(function(t){return nt[t]}))}function it(t){var e=A(t);return{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function ot(t){return N(j(t)).left+it(t).scrollLeft}function at(t){var e=B(t);return/auto|scroll|overlay|hidden/.test(e.overflow+e.overflowY+e.overflowX)}function st(t){return 0>["html","body","#document"].indexOf(S(t))?C(t)&&at(t)?t:st(Z(t)):t.ownerDocument.body}function ut(t,e){var n;void 0===e&&(e=[]);var r=st(t),i=r===(null==(n=t.ownerDocument)?void 0:n.body),o=A(r),a=i?[o].concat(o.visualViewport||[],at(r)?r:[]):r,s=e.concat(a);return i?s:s.concat(ut(Z(a)))}function ct(t){return Object.assign({},t,{left:t.x,top:t.y,right:t.x+t.width,bottom:t.y+t.height})}function lt(t,e,n){return e===y?ct(function(t,e){var n=A(t),r=j(t),i=n.visualViewport,o=r.clientWidth,a=r.clientHeight,s=0,u=0;if(i){o=i.width,a=i.height;var c=D();(c||!c&&"fixed"===e)&&(s=i.offsetLeft,u=i.offsetTop)}return{width:o,height:a,x:s+ot(t),y:u}}(t,n)):T(e)?function(t,e){var n=N(t,!1,"fixed"===e);return n.top=n.top+t.clientTop,n.left=n.left+t.clientLeft,n.bottom=n.top+t.clientHeight,n.right=n.left+t.clientWidth,n.width=t.clientWidth,n.height=t.clientHeight,n.x=n.left,n.y=n.top,n}(e,n):ct(function(t){var e,n=j(t),r=it(t),i=null==(e=t.ownerDocument)?void 0:e.body,o=I(n.scrollWidth,n.clientWidth,i?i.scrollWidth:0,i?i.clientWidth:0),a=I(n.scrollHeight,n.clientHeight,i?i.scrollHeight:0,i?i.clientHeight:0),s=-r.scrollLeft+ot(t),u=-r.scrollTop;return"rtl"===B(i||n).direction&&(s+=I(n.clientWidth,i?i.clientWidth:0)-o),{width:o,height:a,x:s,y:u}}(j(t)))}function ht(t,e,n,r){var i="clippingParents"===e?function(t){var e=ut(Z(t)),n=["absolute","fixed"].indexOf(B(t).position)>=0&&C(t)?G(t):t;return T(n)?e.filter((function(t){return T(t)&&F(t,n)&&"body"!==S(t)})):[]}(t):[].concat(e),o=[].concat(i,[n]),a=o.reduce((function(e,n){var i=lt(t,n,r);return e.top=I(i.top,e.top),e.right=R(i.right,e.right),e.bottom=R(i.bottom,e.bottom),e.left=I(i.left,e.left),e}),lt(t,o[0],r));return a.width=a.right-a.left,a.height=a.bottom-a.top,a.x=a.left,a.y=a.top,a}function ft(t){var e,n=t.reference,r=t.element,i=t.placement,a=i?P(i):null,s=i?K(i):null,u=n.x+n.width/2-r.width/2,c=n.y+n.height/2-r.height/2;switch(a){case o:e={x:u,y:n.y-r.height};break;case l:e={x:u,y:n.y+n.height};break;case h:e={x:n.x+n.width,y:c};break;case f:e={x:n.x-r.width,y:c};break;default:e={x:n.x,y:n.y}}var p=a?H(a):null;if(null!=p){var d="y"===p?"height":"width";switch(s){case v:e[p]=e[p]-(n[d]/2-r[d]/2);break;case m:e[p]=e[p]+(n[d]/2-r[d]/2)}}return e}function pt(t,e){void 0===e&&(e={});var n=e.placement,r=void 0===n?t.placement:n,i=e.strategy,a=void 0===i?t.strategy:i,s=e.boundary,u=void 0===s?g:s,c=e.rootBoundary,f=void 0===c?y:c,p=e.elementContext,v=void 0===p?_:p,m=e.altBoundary,b=void 0!==m&&m,w=e.padding,E=void 0===w?0:w,S=q("number"!=typeof E?E:X(E,d)),A=t.rects.popper,C=t.elements[b?v===_?x:_:v],k=ht(T(C)?C:C.contextElement||j(t.elements.popper),u,f,a),M=N(t.elements.reference),P=ft({reference:M,element:A,strategy:"absolute",placement:r}),I=ct(Object.assign({},A,P)),R=v===_?I:M,L={top:k.top-R.top+S.top,bottom:R.bottom-k.bottom+S.bottom,left:k.left-R.left+S.left,right:R.right-k.right+S.right},O=t.modifiersData.offset;if(v===_&&O){var D=O[r];Object.keys(L).forEach((function(t){var e=0>[h,l].indexOf(t)?-1:1;L[t]+=D[0>[o,l].indexOf(t)?"x":"y"]*e}))}return L}function dt(t,e){void 0===e&&(e={});var n=e.boundary,r=e.rootBoundary,i=e.padding,o=e.flipVariations,a=e.allowedAutoPlacements,s=void 0===a?w:a,u=K(e.placement),c=u?o?b:b.filter((function(t){return K(t)===u})):d,l=c.filter((function(t){return s.indexOf(t)>=0}));0===l.length&&(l=c);var h=l.reduce((function(e,o){return e[o]=pt(t,{placement:o,boundary:n,rootBoundary:r,padding:i})[P(o)],e}),{});return Object.keys(h).sort((function(t,e){return h[t]-h[e]}))}var vt={name:"flip",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,r=t.name;if(!e.modifiersData[r]._skip){for(var i=n.mainAxis,a=void 0===i||i,s=n.altAxis,u=void 0===s||s,c=n.fallbackPlacements,d=n.padding,m=n.boundary,g=n.rootBoundary,y=n.altBoundary,_=n.flipVariations,x=void 0===_||_,b=n.allowedAutoPlacements,w=e.options.placement,E=P(w),S=c||(E!==w&&x?function(t){if(P(t)===p)return[];var e=et(t);return[rt(t),e,rt(e)]}(w):[et(w)]),A=[w].concat(S).reduce((function(t,n){return t.concat(P(n)===p?dt(e,{placement:n,boundary:m,rootBoundary:g,padding:d,flipVariations:x,allowedAutoPlacements:b}):n)}),[]),T=e.rects.reference,C=e.rects.popper,k=new Map,M=!0,I=A[0],R=0;A.length>R;R++){var L=A[R],O=P(L),D=K(L)===v,N=[o,l].indexOf(O)>=0,z=N?"width":"height",F=pt(e,{placement:L,boundary:m,rootBoundary:g,altBoundary:y,padding:d}),B=N?D?h:f:D?l:o;T[z]>C[z]&&(B=et(B));var U=et(B),j=[];if(a&&j.push(0>=F[O]),u&&j.push(0>=F[B],0>=F[U]),j.every((function(t){return t}))){I=L,M=!1;break}k.set(L,j)}if(M)for(var Z=function(t){var e=A.find((function(e){var n=k.get(e);if(n)return n.slice(0,t).every((function(t){return t}))}));if(e)return I=e,"break"},V=x?3:1;V>0;V--)if("break"===Z(V))break;e.placement!==I&&(e.modifiersData[r]._skip=!0,e.placement=I,e.reset=!0)}},requiresIfExists:["offset"],data:{_skip:!1}};function mt(t,e,n){return void 0===n&&(n={x:0,y:0}),{top:t.top-e.height-n.y,right:t.right-e.width+n.x,bottom:t.bottom-e.height+n.y,left:t.left-e.width-n.x}}function gt(t){return[o,h,l,f].some((function(e){return t[e]>=0}))}var yt={name:"offset",enabled:!0,phase:"main",requires:["popperOffsets"],fn:function(t){var e=t.state,n=t.name,r=t.options.offset,i=void 0===r?[0,0]:r,a=w.reduce((function(t,n){return t[n]=function(t,e,n){var r=P(t),i=0>[f,o].indexOf(r)?1:-1,a="function"==typeof n?n(Object.assign({},e,{placement:t})):n,s=a[0],u=a[1];return s=s||0,u=(u||0)*i,0>[f,h].indexOf(r)?{x:s,y:u}:{x:u,y:s}}(n,e.rects,i),t}),{}),s=a[e.placement],u=s.y;null!=e.modifiersData.popperOffsets&&(e.modifiersData.popperOffsets.x+=s.x,e.modifiersData.popperOffsets.y+=u),e.modifiersData[n]=a}},_t={name:"preventOverflow",enabled:!0,phase:"main",fn:function(t){var e=t.state,n=t.options,r=t.name,i=n.mainAxis,a=void 0===i||i,s=n.altAxis,u=void 0!==s&&s,c=n.tether,p=void 0===c||c,d=n.tetherOffset,m=void 0===d?0:d,g=pt(e,{boundary:n.boundary,rootBoundary:n.rootBoundary,padding:n.padding,altBoundary:n.altBoundary}),y=P(e.placement),_=K(e.placement),x=!_,b=H(y),w="x"===b?"y":"x",E=e.modifiersData.popperOffsets,S=e.rects.reference,A=e.rects.popper,T="function"==typeof m?m(Object.assign({},e.rects,{placement:e.placement})):m,C="number"==typeof T?{mainAxis:T,altAxis:T}:Object.assign({mainAxis:0,altAxis:0},T),k=e.modifiersData.offset?e.modifiersData.offset[e.placement]:null,M={x:0,y:0};if(E){if(a){var L,O="y"===b?o:f,D="y"===b?l:h,N="y"===b?"height":"width",F=E[b],B=F+g[O],U=F-g[D],j=p?-A[N]/2:0,Z=_===v?S[N]:A[N],V=_===v?-A[N]:-S[N],q=e.elements.arrow,X=p&&q?z(q):{width:0,height:0},Y=e.modifiersData["arrow#persistent"]?e.modifiersData["arrow#persistent"].padding:{top:0,right:0,bottom:0,left:0},Q=Y[O],J=Y[D],$=W(0,S[N],X[N]),tt=x?S[N]/2-j-$-Q-C.mainAxis:Z-$-Q-C.mainAxis,et=x?-S[N]/2+j+$+J+C.mainAxis:V+$+J+C.mainAxis,nt=e.elements.arrow&&G(e.elements.arrow),rt=null!=(L=null==k?void 0:k[b])?L:0,it=F+et-rt,ot=W(p?R(B,F+tt-rt-(nt?"y"===b?nt.clientTop||0:nt.clientLeft||0:0)):B,F,p?I(U,it):U);E[b]=ot,M[b]=ot-F}if(u){var at,st=E[w],ut="y"===w?"height":"width",ct=st+g["x"===b?o:f],lt=st-g["x"===b?l:h],ht=-1!==[o,f].indexOf(y),ft=null!=(at=null==k?void 0:k[w])?at:0,dt=ht?ct:st-S[ut]-A[ut]-ft+C.altAxis,vt=ht?st+S[ut]+A[ut]-ft-C.altAxis:lt,mt=p&&ht?function(t,e,n){var r=W(t,e,n);return r>n?n:r}(dt,st,vt):W(p?dt:ct,st,p?vt:lt);E[w]=mt,M[w]=mt-st}e.modifiersData[r]=M}},requiresIfExists:["offset"]};function xt(t,e,n){void 0===n&&(n=!1);var r,i,o=C(e),a=C(e)&&function(t){var e=t.getBoundingClientRect(),n=L(e.width)/t.offsetWidth||1,r=L(e.height)/t.offsetHeight||1;return 1!==n||1!==r}(e),s=j(e),u=N(t,a,n),c={scrollLeft:0,scrollTop:0},l={x:0,y:0};return(o||!o&&!n)&&(("body"!==S(e)||at(s))&&(c=(r=e)!==A(r)&&C(r)?{scrollLeft:(i=r).scrollLeft,scrollTop:i.scrollTop}:it(r)),C(e)?((l=N(e,!0)).x+=e.clientLeft,l.y+=e.clientTop):s&&(l.x=ot(s))),{x:u.left+c.scrollLeft-l.x,y:u.top+c.scrollTop-l.y,width:u.width,height:u.height}}function bt(t){var e=new Map,n=new Set,r=[];function i(t){n.add(t.name),[].concat(t.requires||[],t.requiresIfExists||[]).forEach((function(t){if(!n.has(t)){var r=e.get(t);r&&i(r)}})),r.push(t)}return t.forEach((function(t){e.set(t.name,t)})),t.forEach((function(t){n.has(t.name)||i(t)})),r}var wt={placement:"bottom",modifiers:[],strategy:"absolute"};function Et(){for(var t=arguments.length,e=Array(t),n=0;t>n;n++)e[n]=arguments[n];return!e.some((function(t){return!(t&&"function"==typeof t.getBoundingClientRect)}))}function St(t){void 0===t&&(t={});var e=t.defaultModifiers,n=void 0===e?[]:e,r=t.defaultOptions,i=void 0===r?wt:r;return function(t,e,r){void 0===r&&(r=i);var o,a,s={placement:"bottom",orderedModifiers:[],options:Object.assign({},wt,i),modifiersData:{},elements:{reference:t,popper:e},attributes:{},styles:{}},u=[],c=!1,l={state:s,setOptions:function(r){var o="function"==typeof r?r(s.options):r;h(),s.options=Object.assign({},i,s.options,o),s.scrollParents={reference:T(t)?ut(t):t.contextElement?ut(t.contextElement):[],popper:ut(e)};var a,c,f=function(t){var e=bt(t);return E.reduce((function(t,n){return t.concat(e.filter((function(t){return t.phase===n})))}),[])}((a=[].concat(n,s.options.modifiers),c=a.reduce((function(t,e){var n=t[e.name];return t[e.name]=n?Object.assign({},n,e,{options:Object.assign({},n.options,e.options),data:Object.assign({},n.data,e.data)}):e,t}),{}),Object.keys(c).map((function(t){return c[t]}))));return s.orderedModifiers=f.filter((function(t){return t.enabled})),s.orderedModifiers.forEach((function(t){var e=t.options,n=t.effect;if("function"==typeof n){var r=n({state:s,name:t.name,instance:l,options:void 0===e?{}:e});u.push(r||function(){})}})),l.update()},forceUpdate:function(){if(!c){var t=s.elements,e=t.reference,n=t.popper;if(Et(e,n)){s.rects={reference:xt(e,G(n),"fixed"===s.options.strategy),popper:z(n)},s.reset=!1,s.placement=s.options.placement,s.orderedModifiers.forEach((function(t){return s.modifiersData[t.name]=Object.assign({},t.data)}));for(var r=0;s.orderedModifiers.length>r;r++)if(!0!==s.reset){var i=s.orderedModifiers[r],o=i.fn,a=i.options;"function"==typeof o&&(s=o({state:s,options:void 0===a?{}:a,name:i.name,instance:l})||s)}else s.reset=!1,r=-1}}},update:(o=function(){return new Promise((function(t){l.forceUpdate(),t(s)}))},function(){return a||(a=new Promise((function(t){Promise.resolve().then((function(){a=void 0,t(o())}))}))),a}),destroy:function(){h(),c=!0}};if(!Et(t,e))return l;function h(){u.forEach((function(t){return t()})),u=[]}return l.setOptions(r).then((function(t){!c&&r.onFirstUpdate&&r.onFirstUpdate(t)})),l}}var At=St({defaultModifiers:[{name:"eventListeners",enabled:!0,phase:"write",fn:function(){},effect:function(t){var e=t.state,n=t.instance,r=t.options,i=r.scroll,o=void 0===i||i,a=r.resize,s=void 0===a||a,u=A(e.elements.popper),c=[].concat(e.scrollParents.reference,e.scrollParents.popper);return o&&c.forEach((function(t){t.addEventListener("scroll",n.update,$)})),s&&u.addEventListener("resize",n.update,$),function(){o&&c.forEach((function(t){t.removeEventListener("scroll",n.update,$)})),s&&u.removeEventListener("resize",n.update,$)}},data:{}},{name:"popperOffsets",enabled:!0,phase:"read",fn:function(t){var e=t.state;e.modifiersData[t.name]=ft({reference:e.rects.reference,element:e.rects.popper,strategy:"absolute",placement:e.placement})},data:{}},{name:"computeStyles",enabled:!0,phase:"beforeWrite",fn:function(t){var e=t.state,n=t.options,r=n.gpuAcceleration,i=void 0===r||r,o=n.adaptive,a=void 0===o||o,s=n.roundOffsets,u=void 0===s||s,c={placement:P(e.placement),variation:K(e.placement),popper:e.elements.popper,popperRect:e.rects.popper,gpuAcceleration:i,isFixed:"fixed"===e.options.strategy};null!=e.modifiersData.popperOffsets&&(e.styles.popper=Object.assign({},e.styles.popper,J(Object.assign({},c,{offsets:e.modifiersData.popperOffsets,position:e.options.strategy,adaptive:a,roundOffsets:u})))),null!=e.modifiersData.arrow&&(e.styles.arrow=Object.assign({},e.styles.arrow,J(Object.assign({},c,{offsets:e.modifiersData.arrow,position:"absolute",adaptive:!1,roundOffsets:u})))),e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-placement":e.placement})},data:{}},M,yt,vt,_t,Y,{name:"hide",enabled:!0,phase:"main",requiresIfExists:["preventOverflow"],fn:function(t){var e=t.state,n=t.name,r=e.rects.reference,i=e.rects.popper,o=e.modifiersData.preventOverflow,a=pt(e,{elementContext:"reference"}),s=pt(e,{altBoundary:!0}),u=mt(a,r),c=mt(s,i,o),l=gt(u),h=gt(c);e.modifiersData[n]={referenceClippingOffsets:u,popperEscapeOffsets:c,isReferenceHidden:l,hasPopperEscaped:h},e.attributes.popper=Object.assign({},e.attributes.popper,{"data-popper-reference-hidden":l,"data-popper-escaped":h})}}]}),Tt="tippy-content",Ct="tippy-backdrop",kt="tippy-arrow",Mt="tippy-svg-arrow",Pt={passive:!0,capture:!0},It=function(){return document.body};function Rt(t,e,n){if(Array.isArray(t)){var r=t[e];return null==r?Array.isArray(n)?n[e]:n:r}return t}function Lt(t,e){var n={}.toString.call(t);return 0===n.indexOf("[object")&&n.indexOf(e+"]")>-1}function Ot(t,e){return"function"==typeof t?t.apply(void 0,e):t}function Dt(t,e){return 0===e?t:function(r){clearTimeout(n),n=setTimeout((function(){t(r)}),e)};var n}function Nt(t){return[].concat(t)}function zt(t,e){-1===t.indexOf(e)&&t.push(e)}function Ft(t){return[].slice.call(t)}function Bt(t){return Object.keys(t).reduce((function(e,n){return void 0!==t[n]&&(e[n]=t[n]),e}),{})}function Ut(){return document.createElement("div")}function jt(t){return["Element","Fragment"].some((function(e){return Lt(t,e)}))}function Zt(t){return Lt(t,"MouseEvent")}function Vt(t){return jt(t)?[t]:function(t){return Lt(t,"NodeList")}(t)?Ft(t):Array.isArray(t)?t:Ft(document.querySelectorAll(t))}function Gt(t,e){t.forEach((function(t){t&&(t.style.transitionDuration=e+"ms")}))}function Ht(t,e){t.forEach((function(t){t&&t.setAttribute("data-state",e)}))}function Wt(t){var e,n=Nt(t)[0];return null!=n&&null!=(e=n.ownerDocument)&&e.body?n.ownerDocument:document}function qt(t,e,n){var r=e+"EventListener";["transitionend","webkitTransitionEnd"].forEach((function(e){t[r](e,n)}))}function Xt(t,e){for(var n=e;n;){var r;if(t.contains(n))return!0;n=null==n.getRootNode||null==(r=n.getRootNode())?void 0:r.host}return!1}var Yt={isTouch:!1},Kt=0;function Qt(){Yt.isTouch||(Yt.isTouch=!0,window.performance&&document.addEventListener("mousemove",Jt))}function Jt(){var t=performance.now();20>t-Kt&&(Yt.isTouch=!1,document.removeEventListener("mousemove",Jt)),Kt=t}function $t(){var t,e=document.activeElement;(t=e)&&t._tippy&&t._tippy.reference===t&&e.blur&&!e._tippy.state.isVisible&&e.blur()}var te=!("undefined"==typeof window||"undefined"==typeof document)&&!!window.msCrypto,ee=Object.assign({appendTo:It,aria:{content:"auto",expanded:"auto"},delay:0,duration:[300,250],getReferenceClientRect:null,hideOnClick:!0,ignoreAttributes:!1,interactive:!1,interactiveBorder:2,interactiveDebounce:0,moveTransition:"",offset:[0,10],onAfterUpdate:function(){},onBeforeUpdate:function(){},onCreate:function(){},onDestroy:function(){},onHidden:function(){},onHide:function(){},onMount:function(){},onShow:function(){},onShown:function(){},onTrigger:function(){},onUntrigger:function(){},onClickOutside:function(){},placement:"top",plugins:[],popperOptions:{},render:null,showOnCreate:!1,touch:!0,trigger:"mouseenter focus",triggerTarget:null},{animateFill:!1,followCursor:!1,inlinePositioning:!1,sticky:!1},{allowHTML:!1,animation:"fade",arrow:!0,content:"",inertia:!1,maxWidth:350,role:"tooltip",theme:"",zIndex:9999}),ne=Object.keys(ee);function re(t){var e=(t.plugins||[]).reduce((function(e,n){var r,i=n.name;return i&&(e[i]=void 0!==t[i]?t[i]:null!=(r=ee[i])?r:n.defaultValue),e}),{});return Object.assign({},t,e)}function ie(t,e){var n=Object.assign({},e,{content:Ot(e.content,[t])},e.ignoreAttributes?{}:function(t,e){return(e?Object.keys(re(Object.assign({},ee,{plugins:e}))):ne).reduce((function(e,n){var r=(t.getAttribute("data-tippy-"+n)||"").trim();if(!r)return e;if("content"===n)e[n]=r;else try{e[n]=JSON.parse(r)}catch(t){e[n]=r}return e}),{})}(t,e.plugins));return n.aria=Object.assign({},ee.aria,n.aria),n.aria={expanded:"auto"===n.aria.expanded?e.interactive:n.aria.expanded,content:"auto"===n.aria.content?e.interactive?null:"describedby":n.aria.content},n}var oe=function(){return"innerHTML"};function ae(t,e){t[oe()]=e}function se(t){var e=Ut();return!0===t?e.className=kt:(e.className=Mt,jt(t)?e.appendChild(t):ae(e,t)),e}function ue(t,e){jt(e.content)?(ae(t,""),t.appendChild(e.content)):"function"!=typeof e.content&&(e.allowHTML?ae(t,e.content):t.textContent=e.content)}function ce(t){var e=t.firstElementChild,n=Ft(e.children);return{box:e,content:n.find((function(t){return t.classList.contains(Tt)})),arrow:n.find((function(t){return t.classList.contains(kt)||t.classList.contains(Mt)})),backdrop:n.find((function(t){return t.classList.contains(Ct)}))}}function le(t){var e=Ut(),n=Ut();n.className="tippy-box",n.setAttribute("data-state","hidden"),n.setAttribute("tabindex","-1");var r=Ut();function i(n,r){var i=ce(e),o=i.box,a=i.content,s=i.arrow;r.theme?o.setAttribute("data-theme",r.theme):o.removeAttribute("data-theme"),"string"==typeof r.animation?o.setAttribute("data-animation",r.animation):o.removeAttribute("data-animation"),r.inertia?o.setAttribute("data-inertia",""):o.removeAttribute("data-inertia"),o.style.maxWidth="number"==typeof r.maxWidth?r.maxWidth+"px":r.maxWidth,r.role?o.setAttribute("role",r.role):o.removeAttribute("role"),n.content===r.content&&n.allowHTML===r.allowHTML||ue(a,t.props),r.arrow?s?n.arrow!==r.arrow&&(o.removeChild(s),o.appendChild(se(r.arrow))):o.appendChild(se(r.arrow)):s&&o.removeChild(s)}return r.className=Tt,r.setAttribute("data-state","hidden"),ue(r,t.props),e.appendChild(n),n.appendChild(r),i(t.props,t.props),{popper:e,onUpdate:i}}le.$$tippy=!0;var he=1,fe=[],pe=[];function de(t,e){var n,r,i,o,a,s,u,c,l=ie(t,Object.assign({},ee,re(Bt(e)))),h=!1,f=!1,p=!1,d=!1,v=[],m=Dt(q,l.interactiveDebounce),g=he++,y=(c=l.plugins).filter((function(t,e){return c.indexOf(t)===e})),_={id:g,reference:t,popper:Ut(),popperInstance:null,props:l,state:{isEnabled:!0,isVisible:!1,isDestroyed:!1,isMounted:!1,isShown:!1},plugins:y,clearDelayTimeouts:function(){clearTimeout(n),clearTimeout(r),cancelAnimationFrame(i)},setProps:function(e){if(!_.state.isDestroyed){L("onBeforeUpdate",[_,e]),H();var n=_.props,r=ie(t,Object.assign({},n,Bt(e),{ignoreAttributes:!0}));_.props=r,G(),n.interactiveDebounce!==r.interactiveDebounce&&(N(),m=Dt(q,r.interactiveDebounce)),n.triggerTarget&&!r.triggerTarget?Nt(n.triggerTarget).forEach((function(t){t.removeAttribute("aria-expanded")})):r.triggerTarget&&t.removeAttribute("aria-expanded"),D(),R(),w&&w(n,r),_.popperInstance&&(Q(),$().forEach((function(t){requestAnimationFrame(t._tippy.popperInstance.forceUpdate)}))),L("onAfterUpdate",[_,e])}},setContent:function(t){_.setProps({content:t})},show:function(){var t=_.state.isVisible,e=_.state.isDestroyed,n=!_.state.isEnabled,r=Yt.isTouch&&!_.props.touch,i=Rt(_.props.duration,0,ee.duration);if(!(t||e||n||r)&&!k().hasAttribute("disabled")&&(L("onShow",[_],!1),!1!==_.props.onShow(_))){if(_.state.isVisible=!0,C()&&(b.style.visibility="visible"),R(),U(),_.state.isMounted||(b.style.transition="none"),C()){var o=P();Gt([o.box,o.content],0)}s=function(){var t;if(_.state.isVisible&&!d){if(d=!0,b.style.transition=_.props.moveTransition,C()&&_.props.animation){var e=P(),n=e.box,r=e.content;Gt([n,r],i),Ht([n,r],"visible")}O(),D(),zt(pe,_),null==(t=_.popperInstance)||t.forceUpdate(),L("onMount",[_]),_.props.animation&&C()&&function(t,e){Z(t,e)}(i,(function(){_.state.isShown=!0,L("onShown",[_])}))}},function(){var t,e=_.props.appendTo,n=k();t=_.props.interactive&&e===It||"parent"===e?n.parentNode:Ot(e,[n]),t.contains(b)||t.appendChild(b),_.state.isMounted=!0,Q()}()}},hide:function(){var t=!_.state.isVisible,e=_.state.isDestroyed,n=!_.state.isEnabled,r=Rt(_.props.duration,1,ee.duration);if(!(t||e||n)&&(L("onHide",[_],!1),!1!==_.props.onHide(_))){if(_.state.isVisible=!1,_.state.isShown=!1,d=!1,h=!1,C()&&(b.style.visibility="hidden"),N(),j(),R(!0),C()){var i=P(),o=i.box,a=i.content;_.props.animation&&(Gt([o,a],r),Ht([o,a],"hidden"))}O(),D(),_.props.animation?C()&&function(t,e){Z(t,(function(){!_.state.isVisible&&b.parentNode&&b.parentNode.contains(b)&&e()}))}(r,_.unmount):_.unmount()}},hideWithInteractivity:function(t){M().addEventListener("mousemove",m),zt(fe,m),m(t)},enable:function(){_.state.isEnabled=!0},disable:function(){_.hide(),_.state.isEnabled=!1},unmount:function(){_.state.isVisible&&_.hide(),_.state.isMounted&&(J(),$().forEach((function(t){t._tippy.unmount()})),b.parentNode&&b.parentNode.removeChild(b),pe=pe.filter((function(t){return t!==_})),_.state.isMounted=!1,L("onHidden",[_]))},destroy:function(){_.state.isDestroyed||(_.clearDelayTimeouts(),_.unmount(),H(),delete t._tippy,_.state.isDestroyed=!0,L("onDestroy",[_]))}};if(!l.render)return _;var x=l.render(_),b=x.popper,w=x.onUpdate;b.setAttribute("data-tippy-root",""),b.id="tippy-"+_.id,_.popper=b,t._tippy=_,b._tippy=_;var E=y.map((function(t){return t.fn(_)})),S=t.hasAttribute("aria-expanded");return G(),D(),R(),L("onCreate",[_]),l.showOnCreate&&tt(),b.addEventListener("mouseenter",(function(){_.props.interactive&&_.state.isVisible&&_.clearDelayTimeouts()})),b.addEventListener("mouseleave",(function(){_.props.interactive&&_.props.trigger.indexOf("mouseenter")>=0&&M().addEventListener("mousemove",m)})),_;function A(){var t=_.props.touch;return Array.isArray(t)?t:[t,0]}function T(){return"hold"===A()[0]}function C(){var t;return!(null==(t=_.props.render)||!t.$$tippy)}function k(){return u||t}function M(){var t=k().parentNode;return t?Wt(t):document}function P(){return ce(b)}function I(t){return _.state.isMounted&&!_.state.isVisible||Yt.isTouch||o&&"focus"===o.type?0:Rt(_.props.delay,t?0:1,ee.delay)}function R(t){void 0===t&&(t=!1),b.style.pointerEvents=_.props.interactive&&!t?"":"none",b.style.zIndex=""+_.props.zIndex}function L(t,e,n){var r;void 0===n&&(n=!0),E.forEach((function(n){n[t]&&n[t].apply(n,e)})),n&&(r=_.props)[t].apply(r,e)}function O(){var e=_.props.aria;if(e.content){var n="aria-"+e.content,r=b.id;Nt(_.props.triggerTarget||t).forEach((function(t){var e=t.getAttribute(n);if(_.state.isVisible)t.setAttribute(n,e?e+" "+r:r);else{var i=e&&e.replace(r,"").trim();i?t.setAttribute(n,i):t.removeAttribute(n)}}))}}function D(){!S&&_.props.aria.expanded&&Nt(_.props.triggerTarget||t).forEach((function(t){_.props.interactive?t.setAttribute("aria-expanded",_.state.isVisible&&t===k()?"true":"false"):t.removeAttribute("aria-expanded")}))}function N(){M().removeEventListener("mousemove",m),fe=fe.filter((function(t){return t!==m}))}function z(e){if(!Yt.isTouch||!p&&"mousedown"!==e.type){var n=e.composedPath&&e.composedPath()[0]||e.target;if(!_.props.interactive||!Xt(b,n)){if(Nt(_.props.triggerTarget||t).some((function(t){return Xt(t,n)}))){if(Yt.isTouch)return;if(_.state.isVisible&&_.props.trigger.indexOf("click")>=0)return}else L("onClickOutside",[_,e]);!0===_.props.hideOnClick&&(_.clearDelayTimeouts(),_.hide(),f=!0,setTimeout((function(){f=!1})),_.state.isMounted||j())}}}function F(){p=!0}function B(){p=!1}function U(){var t=M();t.addEventListener("mousedown",z,!0),t.addEventListener("touchend",z,Pt),t.addEventListener("touchstart",B,Pt),t.addEventListener("touchmove",F,Pt)}function j(){var t=M();t.removeEventListener("mousedown",z,!0),t.removeEventListener("touchend",z,Pt),t.removeEventListener("touchstart",B,Pt),t.removeEventListener("touchmove",F,Pt)}function Z(t,e){var n=P().box;function r(t){t.target===n&&(qt(n,"remove",r),e())}if(0===t)return e();qt(n,"remove",a),qt(n,"add",r),a=r}function V(e,n,r){void 0===r&&(r=!1),Nt(_.props.triggerTarget||t).forEach((function(t){t.addEventListener(e,n,r),v.push({node:t,eventType:e,handler:n,options:r})}))}function G(){var t;T()&&(V("touchstart",W,{passive:!0}),V("touchend",X,{passive:!0})),(t=_.props.trigger,t.split(/\s+/).filter(Boolean)).forEach((function(t){if("manual"!==t)switch(V(t,W),t){case"mouseenter":V("mouseleave",X);break;case"focus":V(te?"focusout":"blur",Y);break;case"focusin":V("focusout",Y)}}))}function H(){v.forEach((function(t){t.node.removeEventListener(t.eventType,t.handler,t.options)})),v=[]}function W(t){var e,n=!1;if(_.state.isEnabled&&!K(t)&&!f){var r="focus"===(null==(e=o)?void 0:e.type);o=t,u=t.currentTarget,D(),!_.state.isVisible&&Zt(t)&&fe.forEach((function(e){return e(t)})),"click"===t.type&&(0>_.props.trigger.indexOf("mouseenter")||h)&&!1!==_.props.hideOnClick&&_.state.isVisible?n=!0:tt(t),"click"===t.type&&(h=!n),n&&!r&&et(t)}}function q(t){var e=t.target,n=k().contains(e)||b.contains(e);if("mousemove"!==t.type||!n){var r=$().concat(b).map((function(t){var e,n=null==(e=t._tippy.popperInstance)?void 0:e.state;return n?{popperRect:t.getBoundingClientRect(),popperState:n,props:l}:null})).filter(Boolean);(function(t,e){var n=e.clientX,r=e.clientY;return t.every((function(t){var e=t.popperRect,i=t.popperState,o=t.props.interactiveBorder,a=i.placement.split("-")[0],s=i.modifiersData.offset;return!s||e.top-r+("bottom"===a?s.top.y:0)>o||r-e.bottom-("top"===a?s.bottom.y:0)>o||e.left-n+("right"===a?s.left.x:0)>o||n-e.right-("left"===a?s.right.x:0)>o}))})(r,t)&&(N(),et(t))}}function X(t){K(t)||_.props.trigger.indexOf("click")>=0&&h||(_.props.interactive?_.hideWithInteractivity(t):et(t))}function Y(t){0>_.props.trigger.indexOf("focusin")&&t.target!==k()||_.props.interactive&&t.relatedTarget&&b.contains(t.relatedTarget)||et(t)}function K(t){return!!Yt.isTouch&&T()!==t.type.indexOf("touch")>=0}function Q(){J();var e=_.props,n=e.popperOptions,r=e.placement,i=e.offset,o=e.getReferenceClientRect,a=e.moveTransition,u=C()?ce(b).arrow:null,c=o?{getBoundingClientRect:o,contextElement:o.contextElement||k()}:t,l={name:"$$tippy",enabled:!0,phase:"beforeWrite",requires:["computeStyles"],fn:function(t){var e=t.state;if(C()){var n=P().box;["placement","reference-hidden","escaped"].forEach((function(t){"placement"===t?n.setAttribute("data-placement",e.placement):e.attributes.popper["data-popper-"+t]?n.setAttribute("data-"+t,""):n.removeAttribute("data-"+t)})),e.attributes.popper={}}}},h=[{name:"offset",options:{offset:i}},{name:"preventOverflow",options:{padding:{top:2,bottom:2,left:5,right:5}}},{name:"flip",options:{padding:5}},{name:"computeStyles",options:{adaptive:!a}},l];C()&&u&&h.push({name:"arrow",options:{element:u,padding:3}}),h.push.apply(h,(null==n?void 0:n.modifiers)||[]),_.popperInstance=At(c,b,Object.assign({},n,{placement:r,onFirstUpdate:s,modifiers:h}))}function J(){_.popperInstance&&(_.popperInstance.destroy(),_.popperInstance=null)}function $(){return Ft(b.querySelectorAll("[data-tippy-root]"))}function tt(t){_.clearDelayTimeouts(),t&&L("onTrigger",[_,t]),U();var e=I(!0),r=A(),i=r[1];Yt.isTouch&&"hold"===r[0]&&i&&(e=i),e?n=setTimeout((function(){_.show()}),e):_.show()}function et(t){if(_.clearDelayTimeouts(),L("onUntrigger",[_,t]),_.state.isVisible){if(0>_.props.trigger.indexOf("mouseenter")||0>_.props.trigger.indexOf("click")||0>["mouseleave","mousemove"].indexOf(t.type)||!h){var e=I(!1);e?r=setTimeout((function(){_.state.isVisible&&_.hide()}),e):i=requestAnimationFrame((function(){_.hide()}))}}else j()}}function ve(t,e){void 0===e&&(e={});var n=ee.plugins.concat(e.plugins||[]);document.addEventListener("touchstart",Qt,Pt),window.addEventListener("blur",$t);var r=Object.assign({},e,{plugins:n}),i=Vt(t).reduce((function(t,e){var n=e&&de(e,r);return n&&t.push(n),t}),[]);return jt(t)?i[0]:i}ve.defaultProps=ee,ve.setDefaultProps=function(t){Object.keys(t).forEach((function(e){ee[e]=t[e]}))},ve.currentInput=Yt,Object.assign({},M,{effect:function(t){var e=t.state,n={popper:{position:e.options.strategy,left:"0",top:"0",margin:"0"},arrow:{position:"absolute"},reference:{}};Object.assign(e.elements.popper.style,n.popper),e.styles=n,e.elements.arrow&&Object.assign(e.elements.arrow.style,n.arrow)}});var me={clientX:0,clientY:0},ge=[];function ye(t){me={clientX:t.clientX,clientY:t.clientY}}var _e={name:"followCursor",defaultValue:!1,fn:function(t){var e=t.reference,n=Wt(t.props.triggerTarget||e),r=!1,i=!1,o=!0,a=t.props;function s(){return"initial"===t.props.followCursor&&t.state.isVisible}function u(){n.addEventListener("mousemove",h)}function c(){n.removeEventListener("mousemove",h)}function l(){r=!0,t.setProps({getReferenceClientRect:null}),r=!1}function h(n){var r=!n.target||e.contains(n.target),i=t.props.followCursor,o=n.clientX,a=n.clientY,s=e.getBoundingClientRect(),u=o-s.left,c=a-s.top;!r&&t.props.interactive||t.setProps({getReferenceClientRect:function(){var t=e.getBoundingClientRect(),n=o,r=a;"initial"===i&&(n=t.left+u,r=t.top+c);var s="horizontal"===i?t.top:r,l="vertical"===i?t.right:n,h="horizontal"===i?t.bottom:r,f="vertical"===i?t.left:n;return{width:l-f,height:h-s,top:s,right:l,bottom:h,left:f}}})}function f(){t.props.followCursor&&(ge.push({instance:t,doc:n}),function(t){t.addEventListener("mousemove",ye)}(n))}function p(){0===(ge=ge.filter((function(e){return e.instance!==t}))).filter((function(t){return t.doc===n})).length&&function(t){t.removeEventListener("mousemove",ye)}(n)}return{onCreate:f,onDestroy:p,onBeforeUpdate:function(){a=t.props},onAfterUpdate:function(e,n){var o=n.followCursor;r||void 0!==o&&a.followCursor!==o&&(p(),o?(f(),!t.state.isMounted||i||s()||u()):(c(),l()))},onMount:function(){t.props.followCursor&&!i&&(o&&(h(me),o=!1),s()||u())},onTrigger:function(t,e){Zt(e)&&(me={clientX:e.clientX,clientY:e.clientY}),i="focus"===e.type},onHidden:function(){t.props.followCursor&&(l(),c(),o=!0)}}}};ve.setDefaultProps({render:le});var xe,be,we,Ee,Se,Ae,Te={showTotalDistance:!1,showDashDistance:!0,showWhen:["normal","active"],format:function(t){return 1e3>t?+t.toFixed(2)+"m":+(t/1e3).toFixed(2)+"km"}},Ce={showWhen:["normal","active"],format:function(t){return t>1e6?"".concat(+(t/1e6).toFixed(2),"km²"):"".concat(+t.toFixed(2),"m²")}},ke={maxSize:100},Me={remove:["del","backspace"],revert:["command+z","ctrl+z"],redo:["command+shift+z","ctrl+shift+z"]},Pe={allowHTML:!0,followCursor:!0,placement:"bottom-start",offset:[-10,20],plugins:[_e],trigger:"manual",hideOnClick:!1,theme:"light"},Ie={data:"drawData",pointAdsorbPixel:12,lineAdsorbPixel:10};function Re(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,r)}return n}function Le(t){for(var e=1;arguments.length>e;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?Re(Object(n),!0).forEach((function(e){ze(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):Re(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function Oe(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function De(t,e){for(var n=0;e.length>n;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,Xe(r.key),r)}}function Ne(t,e,n){return e&&De(t.prototype,e),n&&De(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}function ze(t,e,n){return(e=Xe(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function Fe(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Ue(t,e)}function Be(t){return Be=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Be(t)}function Ue(t,e){return Ue=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Ue(t,e)}function je(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Ze(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Be(t);if(e){var i=Be(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return function(t,e){if(e&&("object"==c(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return je(t)}(this,n)}}function Ve(){return Ve="undefined"!=typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=function(t,e){for(;!Object.prototype.hasOwnProperty.call(t,e)&&null!==(t=Be(t)););return t}(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(3>arguments.length?t:n):i.value}},Ve.apply(this,arguments)}function Ge(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(t){c=!0,i=t}finally{try{if(!u&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(c)throw i}}return s}}(t,e)||We(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function He(t){return function(t){if(Array.isArray(t))return qe(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||We(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function We(t,e){if(t){if("string"==typeof t)return qe(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qe(t,e):void 0}}function qe(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=Array(e);e>n;n++)r[n]=t[n];return r}function Xe(t){var e=function(t,e){if("object"!=c(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var r=n.call(t,e||"default");if("object"!=c(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==c(e)?e:e+""}(xe=t.DrawEvent||(t.DrawEvent={})).Init="init",xe.Destroy="destroy",xe.Enable="enable",xe.Disable="disable",xe.Add="add",xe.Edit="edit",xe.Remove="remove",xe.Clear="clear",xe.Change="change",xe.DragStart="dragStart",xe.Dragging="dragging",xe.DragEnd="dragEnd",xe.Select="select",xe.AddNode="addNode",xe.RemoveNode="removeNode",(be=t.SourceEvent||(t.SourceEvent={})).Change="change",be.Update="update",(we=t.RenderEvent||(t.RenderEvent={})).Click="click",we.UnClick="unclick",we.Dragstart="dragstart",we.Mousemove="mousemove",we.Mouseout="mouseout",we.Dragging="dragging",we.Dragend="dragend",we.DblClick="dblClick",we.Contextmenu="contextmenu",(Ee=t.LayerEvent||(t.LayerEvent={})).Mousedown="mousedown",Ee.Mouseup="mouseup",Ee.Click="click",Ee.UnClick="unclick",Ee.Dblclick="dblclick",Ee.Mousemove="mousemove",Ee.Mouseover="mouseover",Ee.Mouseenter="mouseenter",Ee.Mouseleave="mouseleave",Ee.Mouseout="mouseout",Ee.Contextmenu="contextmenu",(Se=t.SceneEvent||(t.SceneEvent={})).Loaded="loaded",Se.MapMove="mapmove",Se.MoveStart="movestart",Se.MoveEnd="moveend",Se.ZoomChange="zoomchange",Se.ZoomStart="zoomstart",Se.ZoomEnd="zoomend",Se.Click="click",Se.Dblclick="dblclick",Se.Mousemove="mousemove",Se.Mousewheel="mousewheel",Se.Mouseover="mouseover",Se.Mouseout="mouseout",Se.Mouseup="mouseup",Se.Mousedown="mousedown",Se.Contextmenu="contextmenu",Se.Dragstart="dragstart",Se.Dragging="dragging",Se.Dragend="dragend",(Ae=t.ControlEvent||(t.ControlEvent={})).DrawChange="drawchange",Ae.DataChange="datachange";var Ye=6371008.8,Ke={centimeters:637100880,centimetres:637100880,degrees:57.22891354143274,feet:20902260.511392,inches:39.37*Ye,kilometers:6371.0088,kilometres:6371.0088,meters:Ye,metres:Ye,miles:3958.761333810546,millimeters:6371008800,millimetres:6371008800,nauticalmiles:Ye/1852,radians:1,yards:6967335.223679999},Qe={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function Je(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function $e(t,e,n){if(void 0===n&&(n={}),!t)throw Error("coordinates is required");if(!Array.isArray(t))throw Error("coordinates must be an Array");if(2>t.length)throw Error("coordinates must be at least 2 numbers long");if(!hn(t[0])||!hn(t[1]))throw Error("coordinates must contain numbers");return Je({type:"Point",coordinates:t},e,n)}function tn(t,e,n){void 0===n&&(n={});for(var r=0,i=t;i.length>r;r++){var o=i[r];if(4>o.length)throw Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;o[o.length-1].length>a;a++)if(o[o.length-1][a]!==o[0][a])throw Error("First and last Position are not equivalent.")}return Je({type:"Polygon",coordinates:t},e,n)}function en(t,e,n){if(void 0===n&&(n={}),2>t.length)throw Error("coordinates must be an array of two or more positions");return Je({type:"LineString",coordinates:t},e,n)}function nn(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function rn(t,e,n){return void 0===n&&(n={}),Je({type:"MultiLineString",coordinates:t},e,n)}function on(t,e,n){return void 0===n&&(n={}),Je({type:"MultiPoint",coordinates:t},e,n)}function an(t,e,n){return void 0===n&&(n={}),Je({type:"MultiPolygon",coordinates:t},e,n)}function sn(t,e){void 0===e&&(e="kilometers");var n=Ke[e];if(!n)throw Error(e+" units is invalid");return t*n}function un(t,e){void 0===e&&(e="kilometers");var n=Ke[e];if(!n)throw Error(e+" units is invalid");return t/n}function cn(t){return t%(2*Math.PI)*180/Math.PI}function ln(t){return t%360*Math.PI/180}function hn(t){return!isNaN(t)&&null!==t&&!Array.isArray(t)}function fn(t){return!!t&&t.constructor===Object}var pn=Object.freeze({__proto__:null,earthRadius:Ye,factors:Ke,unitsFactors:{centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:.001,kilometres:.001,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/Ye,yards:1.0936133},areaFactors:Qe,feature:Je,geometry:function(t,e,n){switch(t){case"Point":return $e(e).geometry;case"LineString":return en(e).geometry;case"Polygon":return tn(e).geometry;case"MultiPoint":return on(e).geometry;case"MultiLineString":return rn(e).geometry;case"MultiPolygon":return an(e).geometry;default:throw Error(t+" is invalid")}},point:$e,points:function(t,e,n){return void 0===n&&(n={}),nn(t.map((function(t){return $e(t,e)})),n)},polygon:tn,polygons:function(t,e,n){return void 0===n&&(n={}),nn(t.map((function(t){return tn(t,e)})),n)},lineString:en,lineStrings:function(t,e,n){return void 0===n&&(n={}),nn(t.map((function(t){return en(t,e)})),n)},featureCollection:nn,multiLineString:rn,multiPoint:on,multiPolygon:an,geometryCollection:function(t,e,n){return void 0===n&&(n={}),Je({type:"GeometryCollection",geometries:t},e,n)},round:function(t,e){if(void 0===e&&(e=0),e&&e<0)throw Error("precision must be a positive number");var n=Math.pow(10,e||0);return Math.round(t*n)/n},radiansToLength:sn,lengthToRadians:un,lengthToDegrees:function(t,e){return cn(un(t,e))},bearingToAzimuth:function(t){var e=t%360;return 0>e&&(e+=360),e},radiansToDegrees:cn,degreesToRadians:ln,convertLength:function(t,e,n){if(void 0===e&&(e="kilometers"),void 0===n&&(n="kilometers"),t<0)throw Error("length must be a positive number");return sn(un(t,e),n)},convertArea:function(t,e,n){if(void 0===e&&(e="meters"),void 0===n&&(n="kilometers"),t<0)throw Error("area must be a positive number");var r=Qe[e];if(!r)throw Error("invalid original units");var i=Qe[n];if(!i)throw Error("invalid final units");return t/r*i},isNumber:hn,isObject:fn,validateBBox:function(t){if(!t)throw Error("bbox is required");if(!Array.isArray(t))throw Error("bbox must be an Array");if(4!==t.length&&6!==t.length)throw Error("bbox must be an Array of 4 or 6 numbers");t.forEach((function(t){if(!hn(t))throw Error("bbox must only contain numbers")}))},validateId:function(t){if(!t)throw Error("id is required");if(-1===["string","number"].indexOf(c(t)))throw Error("id must be a number or a string")}});function dn(t,e,n){if(null!==t)for(var r,i,o,a,s,u,c,l,h=0,f=0,p=t.type,d="FeatureCollection"===p,v="Feature"===p,m=d?t.features.length:1,g=0;m>g;g++){s=(l=!!(c=d?t.features[g].geometry:v?t.geometry:t)&&"GeometryCollection"===c.type)?c.geometries.length:1;for(var y=0;s>y;y++){var _=0,x=0;if(null!==(a=l?c.geometries[y]:c)){u=a.coordinates;var b=a.type;switch(h=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(u,f,g,_,x))return!1;f++,_++;break;case"LineString":case"MultiPoint":for(r=0;u.length>r;r++){if(!1===e(u[r],f,g,_,x))return!1;f++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(r=0;u.length>r;r++){for(i=0;u[r].length-h>i;i++){if(!1===e(u[r][i],f,g,_,x))return!1;f++}"MultiLineString"===b&&_++,"Polygon"===b&&x++}"Polygon"===b&&_++;break;case"MultiPolygon":for(r=0;u.length>r;r++){for(x=0,i=0;u[r].length>i;i++){for(o=0;u[r][i].length-h>o;o++){if(!1===e(u[r][i][o],f,g,_,x))return!1;f++}x++}_++}break;case"GeometryCollection":for(r=0;a.geometries.length>r;r++)if(!1===dn(a.geometries[r],e,n))return!1;break;default:throw Error("Unknown Geometry Type")}}}}}function vn(t,e){var n;switch(t.type){case"FeatureCollection":for(n=0;t.features.length>n&&!1!==e(t.features[n].properties,n);n++);break;case"Feature":e(t.properties,0)}}function mn(t,e){if("Feature"===t.type)e(t,0);else if("FeatureCollection"===t.type)for(var n=0;t.features.length>n&&!1!==e(t.features[n],n);n++);}function gn(t){var e=[];return dn(t,(function(t){e.push(t)})),e}function yn(t,e){var n,r,i,o,a,s,u,c,l,h,f=0,p="FeatureCollection"===t.type,d="Feature"===t.type,v=p?t.features.length:1;for(n=0;v>n;n++){for(c=p?t.features[n].properties:d?t.properties:{},l=p?t.features[n].bbox:d?t.bbox:void 0,h=p?t.features[n].id:d?t.id:void 0,a=(u=!!(s=p?t.features[n].geometry:d?t.geometry:t)&&"GeometryCollection"===s.type)?s.geometries.length:1,i=0;a>i;i++)if(null!==(o=u?s.geometries[i]:s))switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,f,c,l,h))return!1;break;case"GeometryCollection":for(r=0;o.geometries.length>r;r++)if(!1===e(o.geometries[r],f,c,l,h))return!1;break;default:throw Error("Unknown Geometry Type")}else if(!1===e(null,f,c,l,h))return!1;f++}}function _n(t,e,n){var r=n;return yn(t,(function(t,i,o,a,s){r=0===i&&void 0===n?t:e(r,t,i,o,a,s)})),r}function xn(t,e){yn(t,(function(t,n,r,i,o){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(Je(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon"}for(var u=0;t.coordinates.length>u;u++)if(!1===e(Je({type:a,coordinates:t.coordinates[u]},r),n,u))return!1}))}function bn(t,e){xn(t,(function(t,n,r){var i=0;if(t.geometry){var o=t.geometry.type;if("Point"!==o&&"MultiPoint"!==o){var a,s=0,u=0,c=0;return!1!==dn(t,(function(o,l,h,f,p){if(void 0===a||n>s||f>u||p>c)return a=o,s=n,u=f,c=p,void(i=0);var d=en([a,o],t.properties);if(!1===e(d,n,r,p,i))return!1;i++,a=o}))&&void 0}}}))}function wn(t,e,n){var r=n,i=!1;return bn(t,(function(t,o,a,s,u){r=!1===i&&void 0===n?t:e(r,t,o,a,s,u),i=!0})),r}function En(t,e){if(!t)throw Error("geojson is required");xn(t,(function(t,n,r){if(null!==t.geometry){var i=t.geometry.coordinates;switch(t.geometry.type){case"LineString":if(!1===e(t,n,r,0,0))return!1;break;case"Polygon":for(var o=0;i.length>o;o++)if(!1===e(en(i[o],t.properties),n,r,o))return!1}}}))}var Sn=Object.freeze({__proto__:null,coordAll:gn,coordEach:dn,coordReduce:function(t,e,n,r){var i=n;return dn(t,(function(t,r,o,a,s){i=0===r&&void 0===n?t:e(i,t,r,o,a,s)}),r),i},featureEach:mn,featureReduce:function(t,e,n){var r=n;return mn(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r},findPoint:function(t,e){if(!fn(e=e||{}))throw Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,a=e.coordIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":0>r&&(r=t.features.length+r),s=s||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":s=s||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw Error("geojson is invalid")}if(null===n)return null;var u=n.coordinates;switch(n.type){case"Point":return $e(u,s,e);case"MultiPoint":return 0>i&&(i=u.length+i),$e(u[i],s,e);case"LineString":return 0>a&&(a=u.length+a),$e(u[a],s,e);case"Polygon":return 0>o&&(o=u.length+o),0>a&&(a=u[o].length+a),$e(u[o][a],s,e);case"MultiLineString":return 0>i&&(i=u.length+i),0>a&&(a=u[i].length+a),$e(u[i][a],s,e);case"MultiPolygon":return 0>i&&(i=u.length+i),0>o&&(o=u[i].length+o),0>a&&(a=u[i][o].length-a),$e(u[i][o][a],s,e)}throw Error("geojson is invalid")},findSegment:function(t,e){if(!fn(e=e||{}))throw Error("options is invalid");var n,r=e.featureIndex||0,i=e.multiFeatureIndex||0,o=e.geometryIndex||0,a=e.segmentIndex||0,s=e.properties;switch(t.type){case"FeatureCollection":0>r&&(r=t.features.length+r),s=s||t.features[r].properties,n=t.features[r].geometry;break;case"Feature":s=s||t.properties,n=t.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":n=t;break;default:throw Error("geojson is invalid")}if(null===n)return null;var u=n.coordinates;switch(n.type){case"Point":case"MultiPoint":return null;case"LineString":return 0>a&&(a=u.length+a-1),en([u[a],u[a+1]],s,e);case"Polygon":return 0>o&&(o=u.length+o),0>a&&(a=u[o].length+a-1),en([u[o][a],u[o][a+1]],s,e);case"MultiLineString":return 0>i&&(i=u.length+i),0>a&&(a=u[i].length+a-1),en([u[i][a],u[i][a+1]],s,e);case"MultiPolygon":return 0>i&&(i=u.length+i),0>o&&(o=u[i].length+o),0>a&&(a=u[i][o].length-a-1),en([u[i][o][a],u[i][o][a+1]],s,e)}throw Error("geojson is invalid")},flattenEach:xn,flattenReduce:function(t,e,n){var r=n;return xn(t,(function(t,i,o){r=0===i&&0===o&&void 0===n?t:e(r,t,i,o)})),r},geomEach:yn,geomReduce:_n,lineEach:En,lineReduce:function(t,e,n){var r=n;return En(t,(function(t,i,o,a){r=0===i&&void 0===n?t:e(r,t,i,o,a)})),r},propEach:vn,propReduce:function(t,e,n){var r=n;return vn(t,(function(t,i){r=0===i&&void 0===n?t:e(r,t,i)})),r},segmentEach:bn,segmentReduce:wn});function An(t){var e=[1/0,1/0,-1/0,-1/0];return dn(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),t[0]>e[2]&&(e[2]=t[0]),t[1]>e[3]&&(e[3]=t[1])})),e}An.default=An;var Tn=Object.freeze({__proto__:null,default:An});function Cn(t){if(!t)throw Error("coord is required");if(!Array.isArray(t)){if("Feature"===t.type&&null!==t.geometry&&"Point"===t.geometry.type)return t.geometry.coordinates;if("Point"===t.type)return t.coordinates}if(Array.isArray(t)&&t.length>=2&&!Array.isArray(t[0])&&!Array.isArray(t[1]))return t;throw Error("coord must be GeoJSON Point or an Array of numbers")}function kn(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Mn(t){return"Feature"===t.type?t.geometry:t}function Pn(t,e){return"FeatureCollection"===t.type?"FeatureCollection":"GeometryCollection"===t.type?"GeometryCollection":"Feature"===t.type&&null!==t.geometry?t.geometry.type:t.type}function In(t,e,n,r,i){Rn(t,e,n||0,r||t.length-1,i||On)}function Rn(t,e,n,r,i){for(;r>n;){if(r-n>600){var o=r-n+1,a=e-n+1,s=Math.log(o),u=.5*Math.exp(2*s/3),c=.5*Math.sqrt(s*u*(o-u)/o)*(0>a-o/2?-1:1);Rn(t,e,Math.max(n,Math.floor(e-a*u/o+c)),Math.min(r,Math.floor(e+(o-a)*u/o+c)),i)}var l=t[e],h=n,f=r;for(Ln(t,n,e),i(t[r],l)>0&&Ln(t,n,r);f>h;){for(Ln(t,h,f),h++,f--;0>i(t[h],l);)h++;for(;i(t[f],l)>0;)f--}0===i(t[n],l)?Ln(t,n,f):Ln(t,++f,r),f>e||(n=f+1),e>f||(r=f-1)}}function Ln(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function On(t,e){return e>t?-1:t>e?1:0}function Dn(t,e,n){if(!n)return e.indexOf(t);for(var r=0;e.length>r;r++)if(n(t,e[r]))return r;return-1}function Nn(t,e){zn(t,0,t.children.length,e,t)}function zn(t,e,n,r,i){i||(i=Wn(null)),i.minX=1/0,i.minY=1/0,i.maxX=-1/0,i.maxY=-1/0;for(var o=e;n>o;o++){var a=t.children[o];Fn(i,t.leaf?r(a):a)}return i}function Fn(t,e){return t.minX=Math.min(t.minX,e.minX),t.minY=Math.min(t.minY,e.minY),t.maxX=Math.max(t.maxX,e.maxX),t.maxY=Math.max(t.maxY,e.maxY),t}function Bn(t,e){return t.minX-e.minX}function Un(t,e){return t.minY-e.minY}function jn(t){return(t.maxX-t.minX)*(t.maxY-t.minY)}function Zn(t){return t.maxX-t.minX+(t.maxY-t.minY)}function Vn(t,e){var n=Math.max(t.minX,e.minX),r=Math.max(t.minY,e.minY),i=Math.min(t.maxX,e.maxX),o=Math.min(t.maxY,e.maxY);return Math.max(0,i-n)*Math.max(0,o-r)}function Gn(t,e){return!(t.minX>e.minX||t.minY>e.minY||e.maxX>t.maxX||e.maxY>t.maxY)}function Hn(t,e){return!(e.minX>t.maxX||e.minY>t.maxY||t.minX>e.maxX||t.minY>e.maxY)}function Wn(t){return{children:t,height:1,leaf:!0,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0}}function qn(t,e,n,r,i){for(var o=[e,n];o.length;)if(!(r>=(n=o.pop())-(e=o.pop()))){var a=e+Math.ceil((n-e)/r/2)*r;In(t,a,e,n,i),o.push(e,a,a,n)}}var Xn=Object.freeze({__proto__:null,default:function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:9;s(this,t),this._maxEntries=Math.max(4,e),this._minEntries=Math.max(2,Math.ceil(.4*this._maxEntries)),this.clear()}return u(t,[{key:"all",value:function(){return this._all(this.data,[])}},{key:"search",value:function(t){var e=this.data,n=[];if(!Hn(t,e))return n;for(var r=this.toBBox,i=[];e;){for(var o=0;e.children.length>o;o++){var a=e.children[o],s=e.leaf?r(a):a;Hn(t,s)&&(e.leaf?n.push(a):Gn(t,s)?this._all(a,n):i.push(a))}e=i.pop()}return n}},{key:"collides",value:function(t){var e=this.data;if(!Hn(t,e))return!1;for(var n=[];e;){for(var r=0;e.children.length>r;r++){var i=e.children[r],o=e.leaf?this.toBBox(i):i;if(Hn(t,o)){if(e.leaf||Gn(t,o))return!0;n.push(i)}}e=n.pop()}return!1}},{key:"load",value:function(t){if(!t||!t.length)return this;if(this._minEntries>t.length){for(var e=0;t.length>e;e++)this.insert(t[e]);return this}var n=this._build(t.slice(),0,t.length-1,0);if(this.data.children.length)if(this.data.height===n.height)this._splitRoot(this.data,n);else{if(n.height>this.data.height){var r=this.data;this.data=n,n=r}this._insert(n,this.data.height-n.height-1,!0)}else this.data=n;return this}},{key:"insert",value:function(t){return t&&this._insert(t,this.data.height-1),this}},{key:"clear",value:function(){return this.data=Wn([]),this}},{key:"remove",value:function(t,e){if(!t)return this;for(var n,r,i,o=this.data,a=this.toBBox(t),s=[],u=[];o||s.length;){if(o||(o=s.pop(),r=s[s.length-1],n=u.pop(),i=!0),o.leaf){var c=Dn(t,o.children,e);if(-1!==c)return o.children.splice(c,1),s.push(o),this._condense(s),this}i||o.leaf||!Gn(o,a)?r?(n++,o=r.children[n],i=!1):o=null:(s.push(o),u.push(n),n=0,r=o,o=o.children[0])}return this}},{key:"toBBox",value:function(t){return t}},{key:"compareMinX",value:function(t,e){return t.minX-e.minX}},{key:"compareMinY",value:function(t,e){return t.minY-e.minY}},{key:"toJSON",value:function(){return this.data}},{key:"fromJSON",value:function(t){return this.data=t,this}},{key:"_all",value:function(t,e){for(var n=[];t;)t.leaf?e.push.apply(e,a(t.children)):n.push.apply(n,a(t.children)),t=n.pop();return e}},{key:"_build",value:function(t,e,n,r){var i,o=n-e+1,a=this._maxEntries;if(a>=o)return i=Wn(t.slice(e,n+1)),Nn(i,this.toBBox),i;r||(a=Math.ceil(o/Math.pow(a,(r=Math.ceil(Math.log(o)/Math.log(a)))-1))),i=Wn([]),i.leaf=!1,i.height=r;var s=Math.ceil(o/a),u=s*Math.ceil(Math.sqrt(a));qn(t,e,n,u,this.compareMinX);for(var c=e;n>=c;c+=u){var l=Math.min(c+u-1,n);qn(t,c,l,s,this.compareMinY);for(var h=c;l>=h;h+=s)i.children.push(this._build(t,h,Math.min(h+s-1,l),r-1))}return Nn(i,this.toBBox),i}},{key:"_chooseSubtree",value:function(t,e,n,r){for(;r.push(e),!e.leaf&&r.length-1!==n;){for(var i=void 0,o=1/0,a=1/0,s=0;e.children.length>s;s++){var u=e.children[s],c=jn(u),l=(Math.max((f=u).maxX,(h=t).maxX)-Math.min(f.minX,h.minX))*(Math.max(f.maxY,h.maxY)-Math.min(f.minY,h.minY))-c;a>l?(a=l,o=o>c?c:o,i=u):l===a&&o>c&&(o=c,i=u)}e=i||e.children[0]}var h,f;return e}},{key:"_insert",value:function(t,e,n){var r=n?t:this.toBBox(t),i=[],o=this._chooseSubtree(r,this.data,e,i);for(o.children.push(t),Fn(o,r);e>=0&&i[e].children.length>this._maxEntries;)this._split(i,e),e--;this._adjustParentBBoxes(r,i,e)}},{key:"_split",value:function(t,e){var n=t[e],r=n.children.length,i=this._minEntries;this._chooseSplitAxis(n,i,r);var o=this._chooseSplitIndex(n,i,r),a=Wn(n.children.splice(o,n.children.length-o));a.height=n.height,a.leaf=n.leaf,Nn(n,this.toBBox),Nn(a,this.toBBox),e?t[e-1].children.push(a):this._splitRoot(n,a)}},{key:"_splitRoot",value:function(t,e){this.data=Wn([t,e]),this.data.height=t.height+1,this.data.leaf=!1,Nn(this.data,this.toBBox)}},{key:"_chooseSplitIndex",value:function(t,e,n){for(var r,i=1/0,o=1/0,a=e;n-e>=a;a++){var s=zn(t,0,a,this.toBBox),u=zn(t,a,n,this.toBBox),c=Vn(s,u),l=jn(s)+jn(u);i>c?(i=c,r=a,o=o>l?l:o):c===i&&o>l&&(o=l,r=a)}return r||n-e}},{key:"_chooseSplitAxis",value:function(t,e,n){var r=t.leaf?this.compareMinX:Bn,i=t.leaf?this.compareMinY:Un,o=this._allDistMargin(t,e,n,r);this._allDistMargin(t,e,n,i)>o&&t.children.sort(r)}},{key:"_allDistMargin",value:function(t,e,n,r){t.children.sort(r);for(var i=this.toBBox,o=zn(t,0,e,i),a=zn(t,n-e,n,i),s=Zn(o)+Zn(a),u=e;n-e>u;u++){var c=t.children[u];Fn(o,t.leaf?i(c):c),s+=Zn(o)}for(var l=n-e-1;l>=e;l--){var h=t.children[l];Fn(a,t.leaf?i(h):h),s+=Zn(a)}return s}},{key:"_adjustParentBBoxes",value:function(t,e,n){for(var r=n;r>=0;r--)Fn(e[r],t)}},{key:"_condense",value:function(t){for(var e,n=t.length-1;n>=0;n--)0===t[n].children.length?n>0?(e=t[n-1].children,e.splice(e.indexOf(t[n]),1)):this.clear():Nn(t[n],this.toBBox)}}]),t}()});function Yn(t,e){return e>t?-1:t>e?1:0}var Kn=Object.freeze({__proto__:null,default:function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Yn;if(s(this,t),this.data=e,this.length=this.data.length,this.compare=n,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}return u(t,[{key:"push",value:function(t){this.data.push(t),this.length++,this._up(this.length-1)}},{key:"pop",value:function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}}},{key:"peek",value:function(){return this.data[0]}},{key:"_up",value:function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r}},{key:"_down",value:function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];r>t;){var o=1+(t<<1),a=e[o],s=o+1;if(this.length>s&&0>n(e[s],a)&&(o=s,a=e[s]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i}}]),t}()}),Qn=function(t,e,n,r){var i=t[0],o=t[1],a=!1;void 0===n&&(n=0),void 0===r&&(r=e.length);for(var s=(r-n)/2,u=0,c=s-1;s>u;c=u++){var l=e[n+2*u+0],h=e[n+2*u+1],f=e[n+2*c+1];h>o!=f>o&&(e[n+2*c+0]-l)*(o-h)/(f-h)+l>i&&(a=!a)}return a},Jn=function(t,e,n,r){var i=t[0],o=t[1],a=!1;void 0===n&&(n=0),void 0===r&&(r=e.length);for(var s=r-n,u=0,c=s-1;s>u;c=u++){var l=e[u+n][0],h=e[u+n][1],f=e[c+n][1];h>o!=f>o&&(e[c+n][0]-l)*(o-h)/(f-h)+l>i&&(a=!a)}return a},$n=function(t,e,n,r){return e.length>0&&Array.isArray(e[0])?Jn(t,e,n,r):Qn(t,e,n,r)},tr=Qn;$n.nested=Jn,$n.flat=tr;var er="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof n.g?n.g:"undefined"!=typeof self?self:{};function nr(t,e,n){return t(n={path:e,exports:{},require:function(t,e){return function(){throw Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}()}},n.exports),n.exports}function rr(t){if(t.__esModule)return t;var e=Object.defineProperty({},"__esModule",{value:!0});return Object.keys(t).forEach((function(n){var r=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,r.get?r:{enumerable:!0,get:function(){return t[n]}})})),e}var ir=nr((function(t,e){!function(t){var e=134217729,n=33306690738754706e-32;function r(t,e,n,r,i){var o,a,s,u,c=e[0],l=r[0],h=0,f=0;l>c==l>-c?(o=c,c=e[++h]):(o=l,l=r[++f]);var p=0;if(t>h&&n>f)for(l>c==l>-c?(s=o-((a=c+o)-c),c=e[++h]):(s=o-((a=l+o)-l),l=r[++f]),o=a,0!==s&&(i[p++]=s);t>h&&n>f;)l>c==l>-c?(s=o-((a=o+c)-(u=a-o))+(c-u),c=e[++h]):(s=o-((a=o+l)-(u=a-o))+(l-u),l=r[++f]),o=a,0!==s&&(i[p++]=s);for(;t>h;)s=o-((a=o+c)-(u=a-o))+(c-u),c=e[++h],o=a,0!==s&&(i[p++]=s);for(;n>f;)s=o-((a=o+l)-(u=a-o))+(l-u),l=r[++f],o=a,0!==s&&(i[p++]=s);return 0===o&&0!==p||(i[p++]=o),p}function i(t){return new Float64Array(t)}var o=33306690738754716e-32,a=22204460492503146e-32,s=11093356479670487e-47,u=i(4),c=i(8),l=i(12),h=i(16),f=i(4);t.orient2d=function(t,i,p,d,v,m){var g=(i-m)*(p-v),y=(t-v)*(d-m),_=g-y;if(0===g||0===y||g>0!=y>0)return _;var x=Math.abs(g+y);return o*x>Math.abs(_)?-function(t,i,o,p,d,v,m){var g,y,_,x,b,w,E,S,A,T,C,k,M,P,I,R,L,O,D=t-d,N=o-d,z=i-v,F=p-v;b=(I=(S=D-(E=(w=e*D)-(w-D)))*(T=F-(A=(w=e*F)-(w-F)))-((P=D*F)-E*A-S*A-E*T))-(C=I-(L=(S=z-(E=(w=e*z)-(w-z)))*(T=N-(A=(w=e*N)-(w-N)))-((R=z*N)-E*A-S*A-E*T))),u[0]=I-(C+b)+(b-L),b=(M=P-((k=P+C)-(b=k-P))+(C-b))-(C=M-R),u[1]=M-(C+b)+(b-R),b=(O=k+C)-k,u[2]=k-(O-b)+(C-b),u[3]=O;var B=function(t,e){for(var n=e[0],r=1;t>r;r++)n+=e[r];return n}(4,u),U=a*m;if(B>=U||-B>=U)return B;if(g=t-(D+(b=t-D))+(b-d),_=o-(N+(b=o-N))+(b-d),y=i-(z+(b=i-z))+(b-v),x=p-(F+(b=p-F))+(b-v),0===g&&0===y&&0===_&&0===x)return B;if(U=s*m+n*Math.abs(B),(B+=D*x+F*g-(z*_+N*y))>=U||-B>=U)return B;b=(I=(S=g-(E=(w=e*g)-(w-g)))*(T=F-(A=(w=e*F)-(w-F)))-((P=g*F)-E*A-S*A-E*T))-(C=I-(L=(S=y-(E=(w=e*y)-(w-y)))*(T=N-(A=(w=e*N)-(w-N)))-((R=y*N)-E*A-S*A-E*T))),f[0]=I-(C+b)+(b-L),b=(M=P-((k=P+C)-(b=k-P))+(C-b))-(C=M-R),f[1]=M-(C+b)+(b-R),b=(O=k+C)-k,f[2]=k-(O-b)+(C-b),f[3]=O;var j=r(4,u,4,f,c);b=(I=(S=D-(E=(w=e*D)-(w-D)))*(T=x-(A=(w=e*x)-(w-x)))-((P=D*x)-E*A-S*A-E*T))-(C=I-(L=(S=z-(E=(w=e*z)-(w-z)))*(T=_-(A=(w=e*_)-(w-_)))-((R=z*_)-E*A-S*A-E*T))),f[0]=I-(C+b)+(b-L),b=(M=P-((k=P+C)-(b=k-P))+(C-b))-(C=M-R),f[1]=M-(C+b)+(b-R),b=(O=k+C)-k,f[2]=k-(O-b)+(C-b),f[3]=O;var Z=r(j,c,4,f,l);b=(I=(S=g-(E=(w=e*g)-(w-g)))*(T=x-(A=(w=e*x)-(w-x)))-((P=g*x)-E*A-S*A-E*T))-(C=I-(L=(S=y-(E=(w=e*y)-(w-y)))*(T=_-(A=(w=e*_)-(w-_)))-((R=y*_)-E*A-S*A-E*T))),f[0]=I-(C+b)+(b-L),b=(M=P-((k=P+C)-(b=k-P))+(C-b))-(C=M-R),f[1]=M-(C+b)+(b-R),b=(O=k+C)-k,f[2]=k-(O-b)+(C-b),f[3]=O;var V=r(Z,l,4,f,h);return h[V-1]}(t,i,p,d,v,m,x):_},t.orient2dfast=function(t,e,n,r,i,o){return(e-o)*(n-i)-(t-i)*(r-o)},Object.defineProperty(t,"__esModule",{value:!0})}(e)})),or=rr(Xn),ar=rr(Kn),sr=ir.orient2d;ar.default&&(ar=ar.default);var ur=cr;function cr(t,e,n){e=Math.max(0,void 0===e?2:e),n=n||0;var r=function(t){for(var e=t[0],n=t[0],r=t[0],i=t[0],o=0;t.length>o;o++){var a=t[o];e[0]>a[0]&&(e=a),a[0]>r[0]&&(r=a),n[1]>a[1]&&(n=a),a[1]>i[1]&&(i=a)}var s=[e,n,r,i],u=s.slice();for(o=0;t.length>o;o++)$n(t[o],s)||u.push(t[o]);return function(t){t.sort(br);for(var e=[],n=0;t.length>n;n++){for(;e.length>=2&&0>=vr(e[e.length-2],e[e.length-1],t[n]);)e.pop();e.push(t[n])}for(var r=[],i=t.length-1;i>=0;i--){for(;r.length>=2&&0>=vr(r[r.length-2],r[r.length-1],t[i]);)r.pop();r.push(t[i])}return r.pop(),e.pop(),e.concat(r)}(u)}(t),i=new or(16);i.toBBox=function(t){return{minX:t[0],minY:t[1],maxX:t[0],maxY:t[1]}},i.compareMinX=function(t,e){return t[0]-e[0]},i.compareMinY=function(t,e){return t[1]-e[1]},i.load(t);for(var o,a=[],s=0;r.length>s;s++){var u=r[s];i.remove(u),o=gr(u,o),a.push(o)}var c=new or(16);for(s=0;a.length>s;s++)c.insert(mr(a[s]));for(var l=e*e,h=n*n;a.length;){var f=a.shift(),p=f.p,d=f.next.p,v=yr(p,d);if(v>=h){var m=v/l;(u=lr(i,f.prev.p,p,d,f.next.next.p,m,c))&&Math.min(yr(u,p),yr(u,d))<=m&&(a.push(f),a.push(gr(u,f)),i.remove(u),c.remove(f),c.insert(mr(f)),c.insert(mr(f.next)))}}f=o;var g=[];do{g.push(f.p),f=f.next}while(f!==o);return g.push(f.p),g}function lr(t,e,n,r,i,o,a){for(var s=new ar([],hr),u=t.data;u;){for(var c=0;u.children.length>c;c++){var l=u.children[c],h=u.leaf?_r(l,n,r):fr(n,r,l);o<h||s.push({node:l,dist:h})}for(;s.length&&!s.peek().node.children;){var f=s.pop(),p=f.node,d=_r(p,e,n),v=_r(p,r,i);if(d>f.dist&&v>f.dist&&dr(n,p,a)&&dr(r,p,a))return p}(u=s.pop())&&(u=u.node)}return null}function hr(t,e){return t.dist-e.dist}function fr(t,e,n){if(pr(t,n)||pr(e,n))return 0;var r=xr(t[0],t[1],e[0],e[1],n.minX,n.minY,n.maxX,n.minY);if(0===r)return 0;var i=xr(t[0],t[1],e[0],e[1],n.minX,n.minY,n.minX,n.maxY);if(0===i)return 0;var o=xr(t[0],t[1],e[0],e[1],n.maxX,n.minY,n.maxX,n.maxY);if(0===o)return 0;var a=xr(t[0],t[1],e[0],e[1],n.minX,n.maxY,n.maxX,n.maxY);return 0===a?0:Math.min(r,i,o,a)}function pr(t,e){return!(e.minX>t[0]||t[0]>e.maxX||e.minY>t[1]||t[1]>e.maxY)}function dr(t,e,n){for(var r,i,o,a,s=n.search({minX:Math.min(t[0],e[0]),minY:Math.min(t[1],e[1]),maxX:Math.max(t[0],e[0]),maxY:Math.max(t[1],e[1])}),u=0;s.length>u;u++)if(i=s[u].next.p,o=t,(r=s[u].p)!==(a=e)&&i!==o&&vr(r,i,o)>0!=vr(r,i,a)>0&&vr(o,a,r)>0!=vr(o,a,i)>0)return!1;return!0}function vr(t,e,n){return sr(t[0],t[1],e[0],e[1],n[0],n[1])}function mr(t){var e=t.p,n=t.next.p;return t.minX=Math.min(e[0],n[0]),t.minY=Math.min(e[1],n[1]),t.maxX=Math.max(e[0],n[0]),t.maxY=Math.max(e[1],n[1]),t}function gr(t,e){var n={p:t,prev:null,next:null,minX:0,minY:0,maxX:0,maxY:0};return e?(n.next=e.next,n.prev=e,e.next.prev=n,e.next=n):(n.prev=n,n.next=n),n}function yr(t,e){var n=t[0]-e[0],r=t[1]-e[1];return n*n+r*r}function _r(t,e,n){var r=e[0],i=e[1],o=n[0]-r,a=n[1]-i;if(0!==o||0!==a){var s=((t[0]-r)*o+(t[1]-i)*a)/(o*o+a*a);s>1?(r=n[0],i=n[1]):s>0&&(r+=o*s,i+=a*s)}return(o=t[0]-r)*o+(a=t[1]-i)*a}function xr(t,e,n,r,i,o,a,s){var u,c,l,h,f=n-t,p=r-e,d=a-i,v=s-o,m=t-i,g=e-o,y=f*f+p*p,_=f*d+p*v,x=d*d+v*v,b=f*m+p*g,w=d*m+v*g,E=y*x-_*_,S=E,A=E;0===E?(c=0,S=1,h=w,A=x):(h=y*w-_*b,0>(c=_*w-x*b)?(c=0,h=w,A=x):c>S&&(c=S,h=w+_,A=x)),0>h?(h=0,0>-b?c=0:-b>y?c=S:(c=-b,S=y)):h>A&&(h=A,0>-b+_?c=0:-b+_>y?c=S:(c=-b+_,S=y));var T=(1-(l=0===h?0:h/A))*i+l*a-((1-(u=0===c?0:c/S))*t+u*n),C=(1-l)*o+l*s-((1-u)*e+u*r);return T*T+C*C}function br(t,e){return t[0]===e[0]?t[1]-e[1]:t[0]-e[0]}function wr(t,e,n){void 0===n&&(n={});var r=Cn(t),i=Cn(e),o=ln(i[1]-r[1]),a=ln(i[0]-r[0]),s=ln(r[1]),u=ln(i[1]),c=Math.pow(Math.sin(o/2),2)+Math.pow(Math.sin(a/2),2)*Math.cos(s)*Math.cos(u);return sn(2*Math.atan2(Math.sqrt(c),Math.sqrt(1-c)),n.units)}function Er(t){return function(t,e){void 0===e&&(e={});var n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),o=Number(t[3]);if(6===t.length)throw Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r];return tn([[a,[i,r],[i,o],[n,o],a]],e.properties,{bbox:t,id:e.id})}(An(t))}function Sr(t,e,n,r){void 0===r&&(r={});var i=Cn(t),o=ln(i[0]),a=ln(i[1]),s=ln(n),u=un(e,r.units),c=Math.asin(Math.sin(a)*Math.cos(u)+Math.cos(a)*Math.sin(u)*Math.cos(s));return $e([cn(o+Math.atan2(Math.sin(s)*Math.sin(u)*Math.cos(a),Math.cos(u)-Math.sin(a)*Math.sin(c))),cn(c)],r.properties)}function Ar(t,e,n){if(void 0===n&&(n={}),!0===n.final)return function(t,e){var n=Ar(e,t);return(n+180)%360}(t,e);var r=Cn(t),i=Cn(e),o=ln(r[0]),a=ln(i[0]),s=ln(r[1]),u=ln(i[1]);return cn(Math.atan2(Math.sin(a-o)*Math.cos(u),Math.cos(s)*Math.sin(u)-Math.sin(s)*Math.cos(u)*Math.cos(a-o)))}function Tr(t,e){void 0===e&&(e={});var n=An(t);return $e([(n[0]+n[2])/2,(n[1]+n[3])/2],e.properties,e)}function Cr(t,e){void 0===e&&(e={});var n=0,r=0,i=0;return dn(t,(function(t){n+=t[0],r+=t[1],i++}),!0),$e([n/i,r/i],e.properties)}function kr(t,e){switch(void 0===e&&(e={}),Pn(t)){case"Point":return $e(Cn(t),e.properties);case"Polygon":var n=[];dn(t,(function(t){n.push(t)}));var r,i,o,a,s,u,c,l,h=Cr(t,{properties:e.properties}),f=h.geometry.coordinates,p=0,d=0,v=0,m=n.map((function(t){return[t[0]-f[0],t[1]-f[1]]}));for(r=0;n.length-1>r;r++)v+=l=(a=(i=m[r])[0])*(c=(o=m[r+1])[1])-(s=o[0])*(u=i[1]),p+=(a+s)*l,d+=(u+c)*l;if(0===v)return h;var g=1/(.5*v*6);return $e([f[0]+g*p,f[1]+g*d],e.properties);default:var y=function(t,e){void 0===e&&(e={}),e.concavity=e.concavity||1/0;var n=[];if(dn(t,(function(t){n.push([t[0],t[1]])})),!n.length)return null;var r=ur(n,e.concavity);return r.length>3?tn([r]):null}(t);return y?kr(y,{properties:e.properties}):Cr(t,{properties:e.properties})}}function Mr(t){if(!t)throw Error("geojson is required");var e=[];return xn(t,(function(t){!function(t,e){var n=[],r=t.geometry;if(null!==r){switch(r.type){case"Polygon":n=kn(r);break;case"LineString":n=[kn(r)]}n.forEach((function(n){var r=function(t,e){var n=[];return t.reduce((function(t,r){var i,o,a,s,u,c,l=en([t,r],e);return l.bbox=[(u=(o=r)[0])>(a=(i=t)[0])?a:u,(c=o[1])>(s=i[1])?s:c,a>u?a:u,s>c?s:c],n.push(l),r})),n}(n,t.properties);r.forEach((function(t){t.id=e.length,e.push(t)}))}))}}(t,e)})),nn(e)}ur.default=cr;var Pr=rr(pn),Ir=rr(Sn),Rr=rr(Tn).default,Lr=Ir.featureEach,Or=Pr.featureCollection;function Dr(t){var e=new or(t);return e.insert=function(t){if("Feature"!==t.type)throw Error("invalid feature");return t.bbox=t.bbox?t.bbox:Rr(t),or.prototype.insert.call(this,t)},e.load=function(t){var e=[];return Array.isArray(t)?t.forEach((function(t){if("Feature"!==t.type)throw Error("invalid features");t.bbox=t.bbox?t.bbox:Rr(t),e.push(t)})):Lr(t,(function(t){if("Feature"!==t.type)throw Error("invalid features");t.bbox=t.bbox?t.bbox:Rr(t),e.push(t)})),or.prototype.load.call(this,e)},e.remove=function(t,e){if("Feature"!==t.type)throw Error("invalid feature");return t.bbox=t.bbox?t.bbox:Rr(t),or.prototype.remove.call(this,t,e)},e.clear=function(){return or.prototype.clear.call(this)},e.search=function(t){var e=or.prototype.search.call(this,this.toBBox(t));return Or(e)},e.collides=function(t){return or.prototype.collides.call(this,this.toBBox(t))},e.all=function(){var t=or.prototype.all.call(this);return Or(t)},e.toJSON=function(){return or.prototype.toJSON.call(this)},e.fromJSON=function(t){return or.prototype.fromJSON.call(this,t)},e.toBBox=function(t){var e;if(t.bbox)e=t.bbox;else if(Array.isArray(t)&&4===t.length)e=t;else if(Array.isArray(t)&&6===t.length)e=[t[0],t[1],t[3],t[4]];else if("Feature"===t.type)e=Rr(t);else{if("FeatureCollection"!==t.type)throw Error("invalid geojson");e=Rr(t)}return{minX:e[0],minY:e[1],maxX:e[2],maxY:e[3]}},e}var Nr=Dr;function zr(t,e){var n={},r=[];if("LineString"===t.type&&(t=Je(t)),"LineString"===e.type&&(e=Je(e)),"Feature"===t.type&&"Feature"===e.type&&null!==t.geometry&&null!==e.geometry&&"LineString"===t.geometry.type&&"LineString"===e.geometry.type&&2===t.geometry.coordinates.length&&2===e.geometry.coordinates.length){var i=Fr(t,e);return i&&r.push(i),nn(r)}var o=Nr();return o.load(Mr(e)),mn(Mr(t),(function(t){mn(o.search(t),(function(e){var i=Fr(t,e);if(i){var o=kn(i).join(",");n[o]||(n[o]=!0,r.push(i))}}))})),nn(r)}function Fr(t,e){var n=kn(t),r=kn(e);if(2!==n.length)throw Error("<intersects> line1 must only contain 2 coordinates");if(2!==r.length)throw Error("<intersects> line2 must only contain 2 coordinates");var i=n[0][0],o=n[0][1],a=n[1][0],s=n[1][1],u=r[0][0],c=r[0][1],l=r[1][0],h=r[1][1],f=(h-c)*(a-i)-(l-u)*(s-o),p=(l-u)*(o-c)-(h-c)*(i-u),d=(a-i)*(o-c)-(s-o)*(i-u);if(0===f)return null;var v=p/f,m=d/f;return 0>v||v>1||0>m||m>1?null:$e([i+v*(a-i),o+v*(s-o)])}Nr.default=Dr;var Br=6378137;function Ur(t){return _n(t,(function(t,e){return t+function(t){var e,n=0;switch(t.type){case"Polygon":return jr(t.coordinates);case"MultiPolygon":for(e=0;t.coordinates.length>e;e++)n+=jr(t.coordinates[e]);return n;case"Point":case"MultiPoint":case"LineString":case"MultiLineString":return 0}return 0}(e)}),0)}function jr(t){var e=0;if(t&&t.length>0){e+=Math.abs(Zr(t[0]));for(var n=1;t.length>n;n++)e-=Math.abs(Zr(t[n]))}return e}function Zr(t){var e,n,r,i,o,a,s=0,u=t.length;if(u>2){for(a=0;u>a;a++)a===u-2?(r=u-2,i=u-1,o=0):a===u-1?(r=u-1,i=0,o=1):(r=a,i=a+1,o=a+2),e=t[r],n=t[i],s+=(Vr(t[o][0])-Vr(e[0]))*Math.sin(Vr(n[1]));s=s*Br*Br/2}return s}function Vr(t){return t*Math.PI/180}function Gr(t,e){return void 0===e&&(e={}),wn(t,(function(t,n){var r=n.geometry.coordinates;return t+wr(r[0],r[1],e)}),0)}function Hr(t,e){void 0===e&&(e={});var n=Mn(t);switch(e.properties||"Feature"!==t.type||(e.properties=t.properties),n.type){case"Polygon":return function(t,e){void 0===e&&(e={});var n=Mn(t),r=n.coordinates,i=e.properties?e.properties:"Feature"===t.type?t.properties:{};return Wr(r,i)}(n,e);case"MultiPolygon":return function(t,e){void 0===e&&(e={});var n=Mn(t),r=n.coordinates,i=e.properties?e.properties:"Feature"===t.type?t.properties:{},o=[];return r.forEach((function(t){o.push(Wr(t,i))})),nn(o)}(n,e);default:throw Error("invalid poly")}}function Wr(t,e){return t.length>1?rn(t,e):en(t[0],e)}function qr(t){for(var e,n,r=kn(t),i=0,o=1;r.length>o;)e=n||r[0],i+=((n=r[o])[0]-e[0])*(n[1]+e[1]),o++;return i>0}var Xr=nr((function(t){var e=Object.prototype.hasOwnProperty,n="~";function r(){}function i(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function o(t,e,r,o,a){if("function"!=typeof r)throw new TypeError("The listener must be a function");var s=new i(r,o||t,a),u=n?n+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function a(t,e){0==--t._eventsCount?t._events=new r:delete t._events[e]}function s(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),s.prototype.eventNames=function(){var t,r,i=[];if(0===this._eventsCount)return i;for(r in t=this._events)e.call(t,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(t)):i},s.prototype.listeners=function(t){var e=this._events[n?n+t:t];if(!e)return[];if(e.fn)return[e.fn];for(var r=0,i=e.length,o=Array(i);i>r;r++)o[r]=e[r].fn;return o},s.prototype.listenerCount=function(t){var e=this._events[n?n+t:t];return e?e.fn?1:e.length:0},s.prototype.emit=function(t,e,r,i,o,a){var s=n?n+t:t;if(!this._events[s])return!1;var u,c,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,r),!0;case 4:return l.fn.call(l.context,e,r,i),!0;case 5:return l.fn.call(l.context,e,r,i,o),!0;case 6:return l.fn.call(l.context,e,r,i,o,a),!0}for(c=1,u=Array(h-1);h>c;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,p=l.length;for(c=0;p>c;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,r);break;case 4:l[c].fn.call(l[c].context,e,r,i);break;default:if(!u)for(f=1,u=Array(h-1);h>f;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},s.prototype.on=function(t,e,n){return o(this,t,e,n,!1)},s.prototype.once=function(t,e,n){return o(this,t,e,n,!0)},s.prototype.removeListener=function(t,e,r,i){var o=n?n+t:t;if(!this._events[o])return this;if(!e)return a(this,o),this;var s=this._events[o];if(s.fn)s.fn!==e||i&&!s.once||r&&s.context!==r||a(this,o);else{for(var u=0,c=[],l=s.length;l>u;u++)(s[u].fn!==e||i&&!s[u].once||r&&s[u].context!==r)&&c.push(s[u]);c.length?this._events[o]=1===c.length?c[0]:c:a(this,o)}return this},s.prototype.removeAllListeners=function(t){var e;return t?this._events[e=n?n+t:t]&&a(this,e):(this._events=new r,this._eventsCount=0),this},s.prototype.off=s.prototype.removeListener,s.prototype.addListener=s.prototype.on,s.prefixed=n,s.EventEmitter=s,t.exports=s})),Yr=function(t){Fe(n,t);var e=Ze(n);function n(t,r){var i,o=r.style;return Oe(this,n),(i=e.call(this)).scene=void 0,i.style=void 0,i.layers=void 0,i.data=[],i.scene=t,i.style=o,i.layers=i.initLayers(),i.layers.forEach((function(e){t.addLayer(e)})),o.callback instanceof Function&&o.callback(i.layers),i}return Ne(n,[{key:"getLayers",value:function(){return this.layers}},{key:"show",value:function(){this.layers.forEach((function(t){t.show()}))}},{key:"hide",value:function(){this.layers.forEach((function(t){t.hide()}))}},{key:"setData",value:function(t){this.data=t;var e=nn(t);this.layers.forEach((function(t){t.setData(e)}))}},{key:"destroy",value:function(){var t=this;this.layers.forEach((function(e){t.scene.removeLayer(e)}))}}]),n}(Xr.EventEmitter),Kr=function(t){Fe(r,t);var n=Ze(r);function r(){return Oe(this,r),n.apply(this,arguments)}return Ne(r,[{key:"initLayers",value:function(){var t=this.style,n=t.normal,r=t.style,i=t.options;return[new e.LineLayer(null!=i?i:{}).source(nn([])).size(n.size).color(n.color).shape("line").style(r)]}}]),r}(Yr),Qr=function(t){var e=c(t);return null!=t&&("object"==e||"function"==e)},Jr="object"==c(er)&&er&&er.Object===Object&&er,$r="object"==("undefined"===typeof self?"undefined":c(self))&&self&&self.Object===Object&&self,ti=Jr||$r||Function("return this")(),ei=function(){return ti.Date.now()},ni=/\s/,ri=function(t){for(var e=t.length;e--&&ni.test(t.charAt(e)););return e},ii=/^\s+/,oi=function(t){return t?t.slice(0,ri(t)+1).replace(ii,""):t},ai=ti.Symbol,si=Object.prototype,ui=si.hasOwnProperty,ci=si.toString,li=ai?ai.toStringTag:void 0,hi=function(t){var e=ui.call(t,li),n=t[li];try{t[li]=void 0;var r=!0}catch(t){}var i=ci.call(t);return r&&(e?t[li]=n:delete t[li]),i},fi=Object.prototype.toString,pi=function(t){return fi.call(t)},di=ai?ai.toStringTag:void 0,vi=function(t){return null==t?void 0===t?"[object Undefined]":"[object Null]":di&&di in Object(t)?hi(t):pi(t)},mi=function(t){return null!=t&&"object"==c(t)},gi=function(t){return"symbol"==c(t)||mi(t)&&"[object Symbol]"==vi(t)},yi=/^[-+]0x[0-9a-f]+$/i,_i=/^0b[01]+$/i,xi=/^0o[0-7]+$/i,bi=parseInt,wi=function(t){if("number"==typeof t)return t;if(gi(t))return NaN;if(Qr(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Qr(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=oi(t);var n=_i.test(t);return n||xi.test(t)?bi(t.slice(2),n?2:8):yi.test(t)?NaN:+t},Ei=Math.max,Si=Math.min,Ai=function(t,e,n){var r,i,o,a,s,u,c=0,l=!1,h=!1,f=!0;if("function"!=typeof t)throw new TypeError("Expected a function");function p(e){var n=r,o=i;return r=i=void 0,c=e,a=t.apply(o,n)}function d(t){var n=t-u;return void 0===u||n>=e||0>n||h&&t-c>=o}function v(){var t=ei();if(d(t))return m(t);s=setTimeout(v,function(t){var n=e-(t-u);return h?Si(n,o-(t-c)):n}(t))}function m(t){return s=void 0,f&&r?p(t):(r=i=void 0,a)}function g(){var t=ei(),n=d(t);if(r=arguments,i=this,u=t,n){if(void 0===s)return function(t){return c=t,s=setTimeout(v,e),l?p(t):a}(u);if(h)return clearTimeout(s),s=setTimeout(v,e),p(u)}return void 0===s&&(s=setTimeout(v,e)),a}return e=wi(e)||0,Qr(n)&&(l=!!n.leading,o=(h="maxWait"in n)?Ei(wi(n.maxWait)||0,e):o,f="trailing"in n?!!n.trailing:f),g.cancel=function(){void 0!==s&&clearTimeout(s),c=0,r=u=i=s=void 0},g.flush=function(){return void 0===s?a:m(ei())},g},Ti=function(n){Fe(i,n);var r=Ze(i);function i(){var e;Oe(this,i);for(var n=arguments.length,o=Array(n),a=0;n>a;a++)o[a]=arguments[a];return(e=r.call.apply(r,[this].concat(o))).onMouseMove=function(n){e.emit(t.RenderEvent.Mousemove,n)},e.onMouseOut=function(n){e.emit(t.RenderEvent.Mouseout,n)},e.onMouseDown=function(n){e.emit(t.RenderEvent.Dragstart,n)},e.onDragging=function(n){e.emit(t.RenderEvent.Dragging,n)},e.onDragEnd=Ai((function(n){e.emit(t.RenderEvent.Dragend,n)}),0),e.onUnClick=function(n){e.emit(t.RenderEvent.UnClick,n)},e.enableHover=function(){var n,r;e.disableHover(),null===(n=e.layers[0])||void 0===n||n.on(t.LayerEvent.Mousemove,e.onMouseMove),null===(r=e.layers[0])||void 0===r||r.on(t.LayerEvent.Mouseout,e.onMouseOut)},e.disableHover=function(){var n,r;null===(n=e.layers[0])||void 0===n||n.off(t.LayerEvent.Mousemove,e.onMouseMove),null===(r=e.layers[0])||void 0===r||r.off(t.LayerEvent.Mouseout,e.onMouseOut)},e}return Ne(i,[{key:"initLayers",value:function(){var t=this.style,n=t.normal,r=t.hover,i=t.active,o=t.style,a=t.options;return[new e.LineLayer(null!=a?a:{}).source(nn([])).size("isHover*isActive",(function(t,e){return e?i.size:t?r.size:n.size})).color("isHover*isActive",(function(t,e){return e?i.color:t?r.color:n.color})).shape("line").style(o)]}},{key:"enableDrag",value:function(){this.disableDrag(),this.layers[0].on(t.LayerEvent.Mousedown,this.onMouseDown),this.scene.on(t.SceneEvent.Dragging,this.onDragging),this.scene.on(t.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(t.SceneEvent.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.layers[0].off(t.LayerEvent.Mousedown,this.onMouseDown),this.scene.off(t.SceneEvent.Dragging,this.onDragging),this.scene.off(t.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(t.SceneEvent.Dragend,this.onDragEnd)}},{key:"enableUnClick",value:function(){this.disableUnClick(),this.layers[0].on(t.LayerEvent.UnClick,this.onUnClick)}},{key:"disableUnClick",value:function(){this.layers[0].off(t.LayerEvent.UnClick,this.onUnClick)}}]),i}(Yr),Ci=function(n){Fe(i,n);var r=Ze(i);function i(){var e;Oe(this,i);for(var n=arguments.length,o=Array(n),a=0;n>a;a++)o[a]=arguments[a];return(e=r.call.apply(r,[this].concat(o))).onMouseMove=function(n){e.emit(t.RenderEvent.Mousemove,n)},e.onMouseOut=function(n){e.emit(t.RenderEvent.Mouseout,n)},e.onMouseDown=function(n){e.emit(t.RenderEvent.Click,n)},e}return Ne(i,[{key:"initLayers",value:function(){var t=this.style,n=t.normal,r=t.style,i=t.options,o=n.shape,a=n.size,s=n.color,u=n.stroke;return[new e.PointLayer(null!=i?i:{}).source(nn([])).size(a).color(s).shape(o).style(Le({stroke:u},r))]}},{key:"enableClick",value:function(){this.disableClick(),this.layers[0].on(t.LayerEvent.Mousedown,this.onMouseDown)}},{key:"disableClick",value:function(){this.layers[0].off(t.LayerEvent.Mousedown,this.onMouseDown)}},{key:"enableHover",value:function(){var e,n;this.disableHover(),null===(e=this.layers[0])||void 0===e||e.on(t.LayerEvent.Mousemove,this.onMouseMove),null===(n=this.layers[0])||void 0===n||n.on(t.LayerEvent.Mouseout,this.onMouseOut)}},{key:"disableHover",value:function(){var e,n;null===(e=this.layers[0])||void 0===e||e.off(t.LayerEvent.Mousemove,this.onMouseMove),null===(n=this.layers[0])||void 0===n||n.off(t.LayerEvent.Mouseout,this.onMouseOut)}}]),i}(Yr),ki=function(n){Fe(i,n);var r=Ze(i);function i(){var e;Oe(this,i);for(var n=arguments.length,o=Array(n),a=0;n>a;a++)o[a]=arguments[a];return(e=r.call.apply(r,[this].concat(o))).onCreate=function(n){e.emit(t.RenderEvent.UnClick,n)},e.onMouseMove=function(n){e.emit(t.RenderEvent.Mousemove,n)},e.onMouseOut=function(n){e.emit(t.RenderEvent.Mouseout,n)},e.onMouseDown=function(n){e.emit(t.RenderEvent.Dragstart,n)},e.onDragging=function(n){e.emit(t.RenderEvent.Dragging,n)},e.onDragEnd=Ai((function(n){e.emit(t.RenderEvent.Dragend,n)}),0),e.onClick=function(n){e.emit(t.RenderEvent.Click,n)},e.onContextmenu=function(n){e.emit(t.RenderEvent.Contextmenu,n)},e}return Ne(i,[{key:"initLayers",value:function(){var t=this.style,n=t.normal,r=t.hover,i=t.active,o=t.style,a=t.options;return[new e.PointLayer(null!=a?a:{}).source(nn([])).size("isHover*isActive",(function(t,e){return e?i.size:t?r.size:n.size})).color("isHover*isActive",(function(t,e){return e?i.color:t?r.color:n.color})).shape("isHover*isActive",(function(t,e){return e?i.shape:t?r.shape:n.shape})).style(Le({stroke:["isHover*isActive",function(t,e){return e?i.stroke:t?r.stroke:n.stroke}]},o))]}},{key:"enableCreate",value:function(){this.disableCreate(),this.layers[0].on(t.LayerEvent.UnClick,this.onCreate)}},{key:"disableCreate",value:function(){this.layers[0].off(t.LayerEvent.UnClick,this.onCreate)}},{key:"enableHover",value:function(){var e,n;this.disableHover(),null===(e=this.layers[0])||void 0===e||e.on(t.LayerEvent.Mousemove,this.onMouseMove),null===(n=this.layers[0])||void 0===n||n.on(t.LayerEvent.Mouseout,this.onMouseOut)}},{key:"disableHover",value:function(){var e,n;null===(e=this.layers[0])||void 0===e||e.off(t.LayerEvent.Mousemove,this.onMouseMove),null===(n=this.layers[0])||void 0===n||n.off(t.LayerEvent.Mouseout,this.onMouseOut)}},{key:"enableDrag",value:function(){this.disableDrag(),this.layers[0].on(t.LayerEvent.Mousedown,this.onMouseDown),this.scene.on(t.SceneEvent.Dragging,this.onDragging),this.scene.on(t.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(t.SceneEvent.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.layers[0].off(t.LayerEvent.Mousedown,this.onMouseDown),this.scene.off(t.SceneEvent.Dragging,this.onDragging),this.scene.off(t.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(t.SceneEvent.Dragend,this.onDragEnd)}},{key:"enableClick",value:function(){this.disableClick(),this.layers[0].on(t.LayerEvent.Click,this.onClick)}},{key:"disableClick",value:function(){this.layers[0].off(t.LayerEvent.Click,this.onClick)}},{key:"enableContextMenu",value:function(){this.disableContextMenu(),this.layers[0].on(t.LayerEvent.Contextmenu,this.onContextmenu)}},{key:"disableContextMenu",value:function(){this.layers[0].off(t.LayerEvent.Contextmenu,this.onContextmenu)}}]),i}(Yr),Mi=function(n){Fe(i,n);var r=Ze(i);function i(){var e;Oe(this,i);for(var n=arguments.length,o=Array(n),a=0;n>a;a++)o[a]=arguments[a];return(e=r.call.apply(r,[this].concat(o))).onMouseMove=function(n){e.emit(t.RenderEvent.Mousemove,n)},e.onMouseOut=function(n){e.emit(t.RenderEvent.Mouseout,n)},e.onMouseDown=function(n){e.emit(t.RenderEvent.Dragstart,n)},e.onDragging=function(n){e.emit(t.RenderEvent.Dragging,n)},e.onDragEnd=Ai((function(n){e.emit(t.RenderEvent.Dragend,n)}),0),e.onUnClick=function(n){e.emit(t.RenderEvent.UnClick,n)},e.enableHover=function(){var n,r;e.disableHover(),null===(n=e.layers[0])||void 0===n||n.on(t.LayerEvent.Mousemove,e.onMouseMove),null===(r=e.layers[0])||void 0===r||r.on(t.LayerEvent.Mouseout,e.onMouseOut)},e.disableHover=function(){var n,r;null===(n=e.layers[0])||void 0===n||n.off(t.LayerEvent.Mousemove,e.onMouseMove),null===(r=e.layers[0])||void 0===r||r.off(t.LayerEvent.Mouseout,e.onMouseOut)},e}return Ne(i,[{key:"initLayers",value:function(){var t=this.style,n=t.normal,r=t.hover,i=t.active,o=t.style,a=t.options,s=new e.PolygonLayer(null!=a?a:{});return s.source(nn([])).color("isHover*isActive",(function(t,e){return e?i.color:t?r.color:n.color})).style(o),[s]}},{key:"enableDrag",value:function(){this.disableDrag(),this.layers[0].on(t.LayerEvent.Mousedown,this.onMouseDown),this.scene.on(t.SceneEvent.Dragging,this.onDragging),this.scene.on(t.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(t.SceneEvent.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.layers[0].off(t.LayerEvent.Mousedown,this.onMouseDown),this.scene.off(t.SceneEvent.Dragging,this.onDragging),this.scene.off(t.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(t.SceneEvent.Dragend,this.onDragEnd)}},{key:"enableUnClick",value:function(){this.disableUnClick(),this.layers[0].on(t.LayerEvent.UnClick,this.onUnClick)}},{key:"disableUnClick",value:function(){this.layers[0].off(t.LayerEvent.UnClick,this.onUnClick)}}]),i}(Yr),Pi=function(e){Fe(r,e);var n=Ze(r);function r(e){var i;return Oe(this,r),(i=n.call(this)).scene=void 0,i.previousClick=void 0,i.onDblClick=function(e){var n,r,o=null!==(n=null!==(r=e.pixel)&&void 0!==r?r:e.point)&&void 0!==n?n:{},a=o.x,s=void 0===a?0:a,u=o.y,c=void 0===u?0:u,l=Date.now();if(i.previousClick){var h=i.previousClick,f=h.y;300>l-h.time&&5>Math.abs(s-h.x)&&5>Math.abs(c-f)&&i.emit(t.RenderEvent.DblClick,e)}i.previousClick={x:s,y:c,time:l}},i.onMouseMove=function(e){i.emit(t.RenderEvent.Mousemove,e)},i.onMouseDown=function(e){i.emit(t.RenderEvent.Dragstart,e)},i.onDragging=function(e){i.emit(t.RenderEvent.Dragging,e)},i.onDragEnd=Ai((function(e){i.emit(t.RenderEvent.Dragend,e)}),0),i.scene=e,i}return Ne(r,[{key:"enableDrag",value:function(){this.disableDrag(),this.scene.on(t.SceneEvent.Mousedown,this.onMouseDown),this.scene.on(t.SceneEvent.Dragging,this.onDragging),this.scene.on(t.SceneEvent.Mouseup,this.onDragEnd),this.scene.on(t.SceneEvent.Dragend,this.onDragEnd)}},{key:"disableDrag",value:function(){this.scene.off(t.SceneEvent.Mousedown,this.onMouseDown),this.scene.off(t.SceneEvent.Dragging,this.onDragging),this.scene.off(t.SceneEvent.Mouseup,this.onDragEnd),this.scene.off(t.SceneEvent.Dragend,this.onDragEnd)}},{key:"enableMouseMove",value:function(){this.disableMouseMove(),this.scene.on(t.SceneEvent.Mousemove,this.onMouseMove)}},{key:"disableMouseMove",value:function(){this.scene.off(t.SceneEvent.Mousemove,this.onMouseMove)}},{key:"enableDblClick",value:function(){this.disableDblClick(),this.scene.on(t.SceneEvent.Mousedown,this.onDblClick)}},{key:"disableDblClick",value:function(){this.scene.off(t.SceneEvent.Mousedown,this.onDblClick)}}]),r}(Xr),Ii=function(t){Fe(r,t);var n=Ze(r);function r(){return Oe(this,r),n.apply(this,arguments)}return Ne(r,[{key:"initLayers",value:function(){var t=this.style,n=t.normal,r=t.active,i=t.style,o=t.options;return[new e.PointLayer(null!=o?o:{}).source(nn([])).size("isActive",(function(t){return t?r.size:n.size})).color("isActive",(function(t){return t?r.color:n.color})).shape("text","text").style(Le({stroke:["isActive",function(t){return t?r.stroke:n.stroke}]},i))]}}]),r}(Yr),Ri={point:ki,line:Ti,dashLine:Kr,midPoint:Ci,text:Ii,polygon:Mi},Li="#1990FF",Oi="#ED9D48",Di={blend:"normal",pickingBuffer:5},Ni={color:Li,shape:"circle",size:6,stroke:"#ffffff"},zi={color:Oi,shape:"circle",size:6,stroke:"#ffffff"},Fi={shape:"circle",size:6,color:Oi,stroke:"#ffffff"},Bi={options:Di,normal:Ni,hover:Le(Le({},Ni),{},{size:8}),active:Le(Le({},Ni),{},{size:8,color:Oi}),style:{strokeWidth:2}},Ui={options:Di,normal:zi,hover:Le(Le({},zi),{},{size:8}),active:Le(Le({},zi),{},{size:8}),style:{strokeWidth:2}},ji={color:Li,size:12,stroke:"#ffffff"},Zi={point:Ui,line:{options:Di,normal:{color:Li,size:2},hover:{color:Li,size:2},active:{color:Oi,size:2},style:{}},polygon:{options:Di,normal:{color:Li},hover:{color:Li},active:{color:Oi},style:{opacity:.15}},midPoint:{options:Di,normal:Fi},dashLine:{options:Di,normal:{color:Oi,size:2},style:{lineType:"dash",dashArray:[6,6]}},text:{options:Di,normal:ji,active:Le(Le({},ji),{},{color:Oi}),style:{fontWeight:"800",textOffset:[0,ji.size+6],textAllowOverlap:!0,strokeWidth:2}}},Vi=function(t,e){return t===e||t!=t&&e!=e},Gi=function(t,e){for(var n=t.length;n--;)if(Vi(t[n][0],e))return n;return-1},Hi=Array.prototype.splice,Wi=function(t){var e=this.__data__,n=Gi(e,t);return n>=0&&(n==e.length-1?e.pop():Hi.call(e,n,1),--this.size,!0)},qi=function(t){var e=this.__data__,n=Gi(e,t);return 0>n?void 0:e[n][1]},Xi=function(t){return Gi(this.__data__,t)>-1},Yi=function(t,e){var n=this.__data__,r=Gi(n,t);return 0>r?(++this.size,n.push([t,e])):n[r][1]=e,this};function Ki(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Ki.prototype.clear=function(){this.__data__=[],this.size=0},Ki.prototype.delete=Wi,Ki.prototype.get=qi,Ki.prototype.has=Xi,Ki.prototype.set=Yi;var Qi,Ji=Ki,$i=function(){this.__data__=new Ji,this.size=0},to=function(t){var e=this.__data__,n=e.delete(t);return this.size=e.size,n},eo=function(t){return this.__data__.get(t)},no=function(t){return this.__data__.has(t)},ro=function(t){if(!Qr(t))return!1;var e=vi(t);return"[object Function]"==e||"[object GeneratorFunction]"==e||"[object AsyncFunction]"==e||"[object Proxy]"==e},io=ti["__core-js_shared__"],oo=(Qi=/[^.]+$/.exec(io&&io.keys&&io.keys.IE_PROTO||""))?"Symbol(src)_1."+Qi:"",ao=function(t){return!!oo&&oo in t},so=Function.prototype.toString,uo=function(t){if(null!=t){try{return so.call(t)}catch(t){}try{return t+""}catch(t){}}return""},co=/^\[object .+?Constructor\]$/,lo=RegExp("^"+Function.prototype.toString.call(Object.prototype.hasOwnProperty).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ho=function(t){return!(!Qr(t)||ao(t))&&(ro(t)?lo:co).test(uo(t))},fo=function(t,e){return null==t?void 0:t[e]},po=function(t,e){var n=fo(t,e);return ho(n)?n:void 0},vo=po(ti,"Map"),mo=po(Object,"create"),go=function(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e},yo=Object.prototype.hasOwnProperty,_o=function(t){var e=this.__data__;if(mo){var n=e[t];return"__lodash_hash_undefined__"===n?void 0:n}return yo.call(e,t)?e[t]:void 0},xo=Object.prototype.hasOwnProperty,bo=function(t){var e=this.__data__;return mo?void 0!==e[t]:xo.call(e,t)},wo=function(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=mo&&void 0===e?"__lodash_hash_undefined__":e,this};function Eo(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Eo.prototype.clear=function(){this.__data__=mo?mo(null):{},this.size=0},Eo.prototype.delete=go,Eo.prototype.get=_o,Eo.prototype.has=bo,Eo.prototype.set=wo;var So=Eo,Ao=function(t){var e=c(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t},To=function(t,e){var n=t.__data__;return Ao(e)?n["string"==typeof e?"string":"hash"]:n.map},Co=function(t){var e=To(this,t).delete(t);return this.size-=e?1:0,e},ko=function(t){return To(this,t).get(t)},Mo=function(t){return To(this,t).has(t)},Po=function(t,e){var n=To(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this};function Io(t){var e=-1,n=null==t?0:t.length;for(this.clear();++e<n;){var r=t[e];this.set(r[0],r[1])}}Io.prototype.clear=function(){this.size=0,this.__data__={hash:new So,map:new(vo||Ji),string:new So}},Io.prototype.delete=Co,Io.prototype.get=ko,Io.prototype.has=Mo,Io.prototype.set=Po;var Ro=Io,Lo=function(t,e){var n=this.__data__;if(n instanceof Ji){var r=n.__data__;if(!vo||199>r.length)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Ro(r)}return n.set(t,e),this.size=n.size,this};function Oo(t){var e=this.__data__=new Ji(t);this.size=e.size}Oo.prototype.clear=$i,Oo.prototype.delete=to,Oo.prototype.get=eo,Oo.prototype.has=no,Oo.prototype.set=Lo;var Do=Oo,No=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r&&!1!==e(t[n],n,t););return t},zo=function(){try{var t=po(Object,"defineProperty");return t({},"",{}),t}catch(t){}}(),Fo=function(t,e,n){"__proto__"==e&&zo?zo(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n},Bo=Object.prototype.hasOwnProperty,Uo=function(t,e,n){var r=t[e];Bo.call(t,e)&&Vi(r,n)&&(void 0!==n||e in t)||Fo(t,e,n)},jo=function(t,e,n,r){var i=!n;n||(n={});for(var o=-1,a=e.length;++o<a;){var s=e[o],u=r?r(n[s],t[s],s,n,t):void 0;void 0===u&&(u=t[s]),i?Fo(n,s,u):Uo(n,s,u)}return n},Zo=function(t,e){for(var n=-1,r=Array(t);++n<t;)r[n]=e(n);return r},Vo=function(t){return mi(t)&&"[object Arguments]"==vi(t)},Go=Object.prototype,Ho=Go.hasOwnProperty,Wo=Go.propertyIsEnumerable,qo=Vo(function(){return arguments}())?Vo:function(t){return mi(t)&&Ho.call(t,"callee")&&!Wo.call(t,"callee")},Xo=qo,Yo=Array.isArray,Ko=function(){return!1},Qo=nr((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n?ti.Buffer:void 0;t.exports=(i?i.isBuffer:void 0)||Ko})),Jo=/^(?:0|[1-9]\d*)$/,$o=function(t,e){var n=c(t);return!!(e=null==e?9007199254740991:e)&&("number"==n||"symbol"!=n&&Jo.test(t))&&t>-1&&t%1==0&&e>t},ta=function(t){return"number"==typeof t&&t>-1&&t%1==0&&9007199254740991>=t},ea={};ea["[object Float32Array]"]=ea["[object Float64Array]"]=ea["[object Int8Array]"]=ea["[object Int16Array]"]=ea["[object Int32Array]"]=ea["[object Uint8Array]"]=ea["[object Uint8ClampedArray]"]=ea["[object Uint16Array]"]=ea["[object Uint32Array]"]=!0,ea["[object Arguments]"]=ea["[object Array]"]=ea["[object ArrayBuffer]"]=ea["[object Boolean]"]=ea["[object DataView]"]=ea["[object Date]"]=ea["[object Error]"]=ea["[object Function]"]=ea["[object Map]"]=ea["[object Number]"]=ea["[object Object]"]=ea["[object RegExp]"]=ea["[object Set]"]=ea["[object String]"]=ea["[object WeakMap]"]=!1;var na=function(t){return mi(t)&&ta(t.length)&&!!ea[vi(t)]},ra=function(t){return function(e){return t(e)}},ia=nr((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n&&Jr.process,o=function(){try{var t=r&&r.require&&r.require("util").types;return t||i&&i.binding&&i.binding("util")}catch(t){}}();t.exports=o})),oa=ia&&ia.isTypedArray,aa=oa?ra(oa):na,sa=Object.prototype.hasOwnProperty,ua=function(t,e){var n=Yo(t),r=!n&&Xo(t),i=!n&&!r&&Qo(t),o=!n&&!r&&!i&&aa(t),a=n||r||i||o,s=a?Zo(t.length,String):[],u=s.length;for(var c in t)!e&&!sa.call(t,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||$o(c,u))||s.push(c);return s},ca=Object.prototype,la=function(t){var e=t&&t.constructor;return t===("function"==typeof e&&e.prototype||ca)},ha=function(t,e){return function(n){return t(e(n))}},fa=ha(Object.keys,Object),pa=Object.prototype.hasOwnProperty,da=function(t){if(!la(t))return fa(t);var e=[];for(var n in Object(t))pa.call(t,n)&&"constructor"!=n&&e.push(n);return e},va=function(t){return null!=t&&ta(t.length)&&!ro(t)},ma=function(t){return va(t)?ua(t):da(t)},ga=function(t,e){return t&&jo(e,ma(e),t)},ya=function(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e},_a=Object.prototype.hasOwnProperty,xa=function(t){if(!Qr(t))return ya(t);var e=la(t),n=[];for(var r in t)("constructor"!=r||!e&&_a.call(t,r))&&n.push(r);return n},ba=function(t){return va(t)?ua(t,!0):xa(t)},wa=function(t,e){return t&&jo(e,ba(e),t)},Ea=nr((function(t,e){var n=e&&!e.nodeType&&e,r=n&&t&&!t.nodeType&&t,i=r&&r.exports===n?ti.Buffer:void 0,o=i?i.allocUnsafe:void 0;t.exports=function(t,e){if(e)return t.slice();var n=t.length,r=o?o(n):new t.constructor(n);return t.copy(r),r}})),Sa=function(t,e){var n=-1,r=t.length;for(e||(e=Array(r));++n<r;)e[n]=t[n];return e},Aa=function(t,e){for(var n=-1,r=null==t?0:t.length,i=0,o=[];++n<r;){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o},Ta=function(){return[]},Ca=Object.prototype.propertyIsEnumerable,ka=Object.getOwnPropertySymbols,Ma=ka?function(t){return null==t?[]:Aa(ka(t=Object(t)),(function(e){return Ca.call(t,e)}))}:Ta,Pa=function(t,e){return jo(t,Ma(t),e)},Ia=function(t,e){for(var n=-1,r=e.length,i=t.length;++n<r;)t[i+n]=e[n];return t},Ra=ha(Object.getPrototypeOf,Object),La=Object.getOwnPropertySymbols?function(t){for(var e=[];t;)Ia(e,Ma(t)),t=Ra(t);return e}:Ta,Oa=function(t,e){return jo(t,La(t),e)},Da=function(t,e,n){var r=e(t);return Yo(t)?r:Ia(r,n(t))},Na=function(t){return Da(t,ma,Ma)},za=function(t){return Da(t,ba,La)},Fa=po(ti,"DataView"),Ba=po(ti,"Promise"),Ua=po(ti,"Set"),ja=po(ti,"WeakMap"),Za="[object Map]",Va="[object Promise]",Ga="[object Set]",Ha="[object WeakMap]",Wa="[object DataView]",qa=uo(Fa),Xa=uo(vo),Ya=uo(Ba),Ka=uo(Ua),Qa=uo(ja),Ja=vi;(Fa&&Ja(new Fa(new ArrayBuffer(1)))!=Wa||vo&&Ja(new vo)!=Za||Ba&&Ja(Ba.resolve())!=Va||Ua&&Ja(new Ua)!=Ga||ja&&Ja(new ja)!=Ha)&&(Ja=function(t){var e=vi(t),n="[object Object]"==e?t.constructor:void 0,r=n?uo(n):"";if(r)switch(r){case qa:return Wa;case Xa:return Za;case Ya:return Va;case Ka:return Ga;case Qa:return Ha}return e});var $a=Ja,ts=Object.prototype.hasOwnProperty,es=function(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&ts.call(t,"index")&&(n.index=t.index,n.input=t.input),n},ns=ti.Uint8Array,rs=function(t){var e=new t.constructor(t.byteLength);return new ns(e).set(new ns(t)),e},is=function(t,e){var n=e?rs(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)},os=/\w*$/,as=function(t){var e=new t.constructor(t.source,os.exec(t));return e.lastIndex=t.lastIndex,e},ss=ai?ai.prototype:void 0,us=ss?ss.valueOf:void 0,cs=function(t){return us?Object(us.call(t)):{}},ls=function(t,e){var n=e?rs(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)},hs=function(t,e,n){var r=t.constructor;switch(e){case"[object ArrayBuffer]":return rs(t);case"[object Boolean]":case"[object Date]":return new r(+t);case"[object DataView]":return is(t,n);case"[object Float32Array]":case"[object Float64Array]":case"[object Int8Array]":case"[object Int16Array]":case"[object Int32Array]":case"[object Uint8Array]":case"[object Uint8ClampedArray]":case"[object Uint16Array]":case"[object Uint32Array]":return ls(t,n);case"[object Map]":case"[object Set]":return new r;case"[object Number]":case"[object String]":return new r(t);case"[object RegExp]":return as(t);case"[object Symbol]":return cs(t)}},fs=Object.create,ps=function(){function t(){}return function(e){if(!Qr(e))return{};if(fs)return fs(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}(),ds=function(t){return"function"!=typeof t.constructor||la(t)?{}:ps(Ra(t))},vs=function(t){return mi(t)&&"[object Map]"==$a(t)},ms=ia&&ia.isMap,gs=ms?ra(ms):vs,ys=function(t){return mi(t)&&"[object Set]"==$a(t)},_s=ia&&ia.isSet,xs=_s?ra(_s):ys,bs="[object Arguments]",ws="[object Function]",Es="[object Object]",Ss={};Ss[bs]=Ss["[object Array]"]=Ss["[object ArrayBuffer]"]=Ss["[object DataView]"]=Ss["[object Boolean]"]=Ss["[object Date]"]=Ss["[object Float32Array]"]=Ss["[object Float64Array]"]=Ss["[object Int8Array]"]=Ss["[object Int16Array]"]=Ss["[object Int32Array]"]=Ss["[object Map]"]=Ss["[object Number]"]=Ss[Es]=Ss["[object RegExp]"]=Ss["[object Set]"]=Ss["[object String]"]=Ss["[object Symbol]"]=Ss["[object Uint8Array]"]=Ss["[object Uint8ClampedArray]"]=Ss["[object Uint16Array]"]=Ss["[object Uint32Array]"]=!0,Ss["[object Error]"]=Ss[ws]=Ss["[object WeakMap]"]=!1;var As=function t(e,n,r,i,o,a){var s,u=1&n,c=2&n,l=4&n;if(r&&(s=o?r(e,i,o,a):r(e)),void 0!==s)return s;if(!Qr(e))return e;var h=Yo(e);if(h){if(s=es(e),!u)return Sa(e,s)}else{var f=$a(e),p=f==ws||"[object GeneratorFunction]"==f;if(Qo(e))return Ea(e,u);if(f==Es||f==bs||p&&!o){if(s=c||p?{}:ds(e),!u)return c?Oa(e,wa(s,e)):Pa(e,ga(s,e))}else{if(!Ss[f])return o?e:{};s=hs(e,f,u)}}a||(a=new Do);var d=a.get(e);if(d)return d;a.set(e,s),xs(e)?e.forEach((function(i){s.add(t(i,n,r,i,e,a))})):gs(e)&&e.forEach((function(i,o){s.set(o,t(i,n,r,o,e,a))}));var v=h?void 0:(l?c?za:Na:c?ba:ma)(e);return No(v||e,(function(i,o){v&&(i=e[o=i]),Uo(s,o,t(i,n,r,o,e,a))})),s},Ts=function(t){return As(t,5)},Cs=function(t){for(var e=-1,n=null==t?0:t.length,r={};++e<n;){var i=t[e];r[i[0]]=i[1]}return r},ks=function(t){return this.__data__.has(t)};function Ms(t){var e=-1,n=null==t?0:t.length;for(this.__data__=new Ro;++e<n;)this.add(t[e])}Ms.prototype.add=Ms.prototype.push=function(t){return this.__data__.set(t,"__lodash_hash_undefined__"),this},Ms.prototype.has=ks;var Ps,Is=Ms,Rs=function(t,e){for(var n=-1,r=null==t?0:t.length;++n<r;)if(e(t[n],n,t))return!0;return!1},Ls=function(t,e){return t.has(e)},Os=function(t,e,n,r,i,o){var a=1&n,s=t.length,u=e.length;if(!(s==u||a&&u>s))return!1;var c=o.get(t),l=o.get(e);if(c&&l)return c==e&&l==t;var h=-1,f=!0,p=2&n?new Is:void 0;for(o.set(t,e),o.set(e,t);++h<s;){var d=t[h],v=e[h];if(r)var m=a?r(v,d,h,e,t,o):r(d,v,h,t,e,o);if(void 0!==m){if(m)continue;f=!1;break}if(p){if(!Rs(e,(function(t,e){if(!Ls(p,e)&&(d===t||i(d,t,n,r,o)))return p.push(e)}))){f=!1;break}}else if(d!==v&&!i(d,v,n,r,o)){f=!1;break}}return o.delete(t),o.delete(e),f},Ds=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n},Ns=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n},zs=ai?ai.prototype:void 0,Fs=zs?zs.valueOf:void 0,Bs=function(t,e,n,r,i,o,a){switch(n){case"[object DataView]":if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case"[object ArrayBuffer]":return!(t.byteLength!=e.byteLength||!o(new ns(t),new ns(e)));case"[object Boolean]":case"[object Date]":case"[object Number]":return Vi(+t,+e);case"[object Error]":return t.name==e.name&&t.message==e.message;case"[object RegExp]":case"[object String]":return t==e+"";case"[object Map]":var s=Ds;case"[object Set]":if(s||(s=Ns),t.size!=e.size&&!(1&r))return!1;var u=a.get(t);if(u)return u==e;r|=2,a.set(t,e);var c=Os(s(t),s(e),r,i,o,a);return a.delete(t),c;case"[object Symbol]":if(Fs)return Fs.call(t)==Fs.call(e)}return!1},Us=Object.prototype.hasOwnProperty,js=function(t,e,n,r,i,o){var a=1&n,s=Na(t),u=s.length;if(u!=Na(e).length&&!a)return!1;for(var c=u;c--;){var l=s[c];if(!(a?l in e:Us.call(e,l)))return!1}var h=o.get(t),f=o.get(e);if(h&&f)return h==e&&f==t;var p=!0;o.set(t,e),o.set(e,t);for(var d=a;++c<u;){var v=t[l=s[c]],m=e[l];if(r)var g=a?r(m,v,l,e,t,o):r(v,m,l,t,e,o);if(!(void 0===g?v===m||i(v,m,n,r,o):g)){p=!1;break}d||(d="constructor"==l)}if(p&&!d){var y=t.constructor,_=e.constructor;y==_||!("constructor"in t)||!("constructor"in e)||"function"==typeof y&&y instanceof y&&"function"==typeof _&&_ instanceof _||(p=!1)}return o.delete(t),o.delete(e),p},Zs="[object Arguments]",Vs="[object Array]",Gs="[object Object]",Hs=Object.prototype.hasOwnProperty,Ws=function(t,e,n,r,i,o){var a=Yo(t),s=Yo(e),u=a?Vs:$a(t),c=s?Vs:$a(e),l=(u=u==Zs?Gs:u)==Gs,h=(c=c==Zs?Gs:c)==Gs,f=u==c;if(f&&Qo(t)){if(!Qo(e))return!1;a=!0,l=!1}if(f&&!l)return o||(o=new Do),a||aa(t)?Os(t,e,n,r,i,o):Bs(t,e,u,n,r,i,o);if(!(1&n)){var p=l&&Hs.call(t,"__wrapped__"),d=h&&Hs.call(e,"__wrapped__");if(p||d){var v=p?t.value():t,m=d?e.value():e;return o||(o=new Do),i(v,m,n,r,o)}}return!!f&&(o||(o=new Do),js(t,e,n,r,i,o))},qs=function t(e,n,r,i,o){return e===n||(null==e||null==n||!mi(e)&&!mi(n)?e!=e&&n!=n:Ws(e,n,r,i,t,o))},Xs=function(t,e){return qs(t,e)},Ys=function(t,e,n){(void 0!==n&&!Vi(t[e],n)||void 0===n&&!(e in t))&&Fo(t,e,n)},Ks=function(t){return function(e,n,r){for(var i=-1,o=Object(e),a=r(e),s=a.length;s--;){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}},Qs=Ks(),Js=function(t){return mi(t)&&va(t)},$s=Function.prototype.toString,tu=Object.prototype.hasOwnProperty,eu=$s.call(Object),nu=function(t){if(!mi(t)||"[object Object]"!=vi(t))return!1;var e=Ra(t);if(null===e)return!0;var n=tu.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&$s.call(n)==eu},ru=function(t,e){if(("constructor"!==e||"function"!=typeof t[e])&&"__proto__"!=e)return t[e]},iu=function(t){return jo(t,ba(t))},ou=function(t,e,n,r,i,o,a){var s=ru(t,n),u=ru(e,n),c=a.get(u);if(c)Ys(t,n,c);else{var l=o?o(s,u,n+"",t,e,a):void 0,h=void 0===l;if(h){var f=Yo(u),p=!f&&Qo(u),d=!f&&!p&&aa(u);l=u,f||p||d?Yo(s)?l=s:Js(s)?l=Sa(s):p?(h=!1,l=Ea(u,!0)):d?(h=!1,l=ls(u,!0)):l=[]:nu(u)||Xo(u)?(l=s,Xo(s)?l=iu(s):Qr(s)&&!ro(s)||(l=ds(u))):h=!1}h&&(a.set(u,l),i(l,u,r,o,a),a.delete(u)),Ys(t,n,l)}},au=function t(e,n,r,i,o){e!==n&&Qs(n,(function(a,s){if(o||(o=new Do),Qr(a))ou(e,n,s,r,t,i,o);else{var u=i?i(ru(e,s),a,s+"",e,n,o):void 0;void 0===u&&(u=a),Ys(e,s,u)}}),ba)},su=function(t){return t},uu=function(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)},cu=Math.max,lu=function(t,e,n){return e=cu(void 0===e?t.length-1:e,0),function(){for(var r=arguments,i=-1,o=cu(r.length-e,0),a=Array(o);++i<o;)a[i]=r[e+i];i=-1;for(var s=Array(e+1);++i<e;)s[i]=r[i];return s[e]=n(a),uu(t,this,s)}},hu=function(t){return function(){return t}},fu=Date.now,pu=function(t){var e=0,n=0;return function(){var r=fu(),i=16-(r-n);if(n=r,i>0){if(++e>=800)return arguments[0]}else e=0;return t.apply(void 0,arguments)}},du=pu(zo?function(t,e){return zo(t,"toString",{configurable:!0,enumerable:!1,value:hu(e),writable:!0})}:su),vu=function(t,e){return du(lu(t,e,su),t+"")},mu=function(t,e,n){if(!Qr(n))return!1;var r=c(e);return!!("number"==r?va(n)&&$o(e,n.length):"string"==r&&e in n)&&Vi(n[e],t)},gu=function(t){return vu((function(e,n){var r=-1,i=n.length,o=i>1?n[i-1]:void 0,a=i>2?n[2]:void 0;for(o=t.length>3&&"function"==typeof o?(i--,o):void 0,a&&mu(n[0],n[1],a)&&(o=3>i?void 0:o,i=1),e=Object(e);++r<i;){var s=n[r];s&&t(e,s,r,o)}return e}))},yu=gu((function(t,e,n){au(t,e,n)})),_u=function(t,e){for(var n=-1,r=null==t?0:t.length,i=Array(r);++n<r;)i[n]=e(t[n],n,t);return i},xu=function(t,e){return _u(e,(function(e){return[e,t[e]]}))},bu=function(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n},wu=function(t){return function(e){var n=$a(e);return"[object Map]"==n?Ds(e):"[object Set]"==n?bu(e):xu(e,t(e))}}(ma),Eu=nr((function(t){!function(e,n,r){if(e){for(var i,o={8:"backspace",9:"tab",13:"enter",16:"shift",17:"ctrl",18:"alt",20:"capslock",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",45:"ins",46:"del",91:"meta",93:"meta",224:"meta"},a={106:"*",107:"+",109:"-",110:".",111:"/",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'"},s={"~":"`","!":"1","@":"2","#":"3",$:"4","%":"5","^":"6","&":"7","*":"8","(":"9",")":"0",_:"-","+":"=",":":";",'"':"'","<":",",">":".","?":"/","|":"\\"},u={option:"alt",command:"meta",return:"enter",escape:"esc",plus:"+",mod:/Mac|iPod|iPhone|iPad/.test(navigator.platform)?"meta":"ctrl"},c=1;20>c;++c)o[111+c]="f"+c;for(c=0;9>=c;++c)o[c+96]=""+c;m.prototype.bind=function(t,e,n){var r=this;return r._bindMultiple.call(r,t=t instanceof Array?t:[t],e,n),r},m.prototype.unbind=function(t,e){return this.bind.call(this,t,(function(){}),e)},m.prototype.trigger=function(t,e){var n=this;return n._directMap[t+":"+e]&&n._directMap[t+":"+e]({},t),n},m.prototype.reset=function(){var t=this;return t._callbacks={},t._directMap={},t},m.prototype.stopCallback=function(t,e){if((" "+e.className+" ").indexOf(" mousetrap ")>-1)return!1;if(v(e,this.target))return!1;if("composedPath"in t&&"function"==typeof t.composedPath){var n=t.composedPath()[0];n!==t.target&&(e=n)}return"INPUT"==e.tagName||"SELECT"==e.tagName||"TEXTAREA"==e.tagName||e.isContentEditable},m.prototype.handleKey=function(){return this._handleKey.apply(this,arguments)},m.addKeycodes=function(t){for(var e in t)t.hasOwnProperty(e)&&(o[e]=t[e]);i=null},m.init=function(){var t=m(n);for(var e in t)"_"!==e.charAt(0)&&(m[e]=function(e){return function(){return t[e].apply(t,arguments)}}(e))},m.init(),e.Mousetrap=m,t.exports&&(t.exports=m)}function l(t,e,n){t.addEventListener?t.addEventListener(e,n,!1):t.attachEvent("on"+e,n)}function h(t){if("keypress"==t.type){var e=String.fromCharCode(t.which);return t.shiftKey||(e=e.toLowerCase()),e}return o[t.which]?o[t.which]:a[t.which]?a[t.which]:String.fromCharCode(t.which).toLowerCase()}function f(t){return"shift"==t||"ctrl"==t||"alt"==t||"meta"==t}function p(t,e,n){return n||(n=function(){if(!i)for(var t in i={},o)t>95&&112>t||o.hasOwnProperty(t)&&(i[o[t]]=t);return i}()[t]?"keydown":"keypress"),"keypress"==n&&e.length&&(n="keydown"),n}function d(t,e){var n,r,i,o=[];for(n=function(t){return"+"===t?["+"]:(t=t.replace(/\+{2}/g,"+plus")).split("+")}(t),i=0;n.length>i;++i)u[r=n[i]]&&(r=u[r]),e&&"keypress"!=e&&s[r]&&(r=s[r],o.push("shift")),f(r)&&o.push(r);return{key:r,modifiers:o,action:e=p(r,o,e)}}function v(t,e){return null!==t&&t!==n&&(t===e||v(t.parentNode,e))}function m(t){var e=this;if(t=t||n,!(e instanceof m))return new m(t);e.target=t,e._callbacks={},e._directMap={};var r,i={},o=!1,a=!1,s=!1;function u(t){t=t||{};var e,n=!1;for(e in i)t[e]?n=!0:i[e]=0;n||(s=!1)}function c(t,n,r,o,a,s){var u,c,l,h=[],p=r.type;if(!e._callbacks[t])return[];for("keyup"==p&&f(t)&&(n=[t]),u=0;e._callbacks[t].length>u;++u)c=e._callbacks[t][u],(o||!c.seq||i[c.seq]==c.level)&&p==c.action&&(("keypress"!=p||r.metaKey||r.ctrlKey)&&(l=c.modifiers,n.sort().join(",")!==l.sort().join(","))||((!o&&c.combo==a||o&&c.seq==o&&c.level==s)&&e._callbacks[t].splice(u,1),h.push(c)));return h}function p(t,n,r,i){e.stopCallback(n,n.target||n.srcElement,r,i)||!1===t(n,r)&&(function(t){t.preventDefault?t.preventDefault():t.returnValue=!1}(n),function(t){t.stopPropagation?t.stopPropagation():t.cancelBubble=!0}(n))}function v(t){"number"!=typeof t.which&&(t.which=t.keyCode);var n=h(t);n&&("keyup"!=t.type||o!==n?e.handleKey(n,function(t){var e=[];return t.shiftKey&&e.push("shift"),t.altKey&&e.push("alt"),t.ctrlKey&&e.push("ctrl"),t.metaKey&&e.push("meta"),e}(t),t):o=!1)}function g(t,e,n,a){function c(e){return function(){s=e,++i[t],clearTimeout(r),r=setTimeout(u,1e3)}}function l(e){p(n,e,t),"keyup"!==a&&(o=h(e)),setTimeout(u,10)}i[t]=0;for(var f=0;e.length>f;++f){var v=f+1===e.length?l:c(a||d(e[f+1]).action);y(e[f],v,a,t,f)}}function y(t,n,r,i,o){e._directMap[t+":"+r]=n;var a,s=(t=t.replace(/\s+/g," ")).split(" ");s.length>1?g(t,s,n,r):(a=d(t,r),e._callbacks[a.key]=e._callbacks[a.key]||[],c(a.key,a.modifiers,{type:a.action},i,t,o),e._callbacks[a.key][i?"unshift":"push"]({callback:n,modifiers:a.modifiers,action:a.action,seq:i,level:o,combo:t}))}e._handleKey=function(t,e,n){var r,i=c(t,e,n),o={},l=0,h=!1;for(r=0;i.length>r;++r)i[r].seq&&(l=Math.max(l,i[r].level));for(r=0;i.length>r;++r)if(i[r].seq){if(i[r].level!=l)continue;h=!0,o[i[r].seq]=1,p(i[r].callback,n,i[r].combo,i[r].seq)}else h||p(i[r].callback,n,i[r].combo);var d="keypress"==n.type&&a;n.type!=s||f(t)||d||u(o),a=h&&"keydown"==n.type},e._bindMultiple=function(t,e,n){for(var r=0;t.length>r;++r)y(t[r],e,n)},l(t,"keypress",v),l(t,"keydown",v),l(t,"keyup",v)}}("undefined"!=typeof window?window:null,"undefined"!=typeof window?document:null)})),Su=function(t){return t&&t.length?t[0]:void 0},Au=(Ps=1,function(t){return"".concat(t,"-").concat(Ps++)}),Tu=function(t,e){var n,r;return!(!t||!e||(null===(n=t.properties)||void 0===n?void 0:n.id)!==(null===(r=e.properties)||void 0===r?void 0:r.id))},Cu=function(t){var e=t.target,n=t.targetHandler,r=t.otherHandler;return t.data.map((function(t,i){var o,a=Tu(t,e)?n:r;return null!==(o=null==a?void 0:a(t,i))&&void 0!==o?o:t}))},ku=function(){return{id:Au("point"),isHover:!1,isActive:!1,isDrag:!1,createTime:Date.now()}},Mu=function(){return{id:Au("line"),isHover:!1,isActive:!1,isDrag:!1,isDraw:!1,createTime:Date.now()}},Pu=function(){return{id:Au("polygon"),isHover:!1,isActive:!1,isDrag:!1,isDraw:!1,createTime:Date.now()}},Iu=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return $e(t,Le(Le({},ku()),e))},Ru=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:"Feature",properties:Le(Le({},Mu()),{},{nodes:t},e),geometry:{type:"LineString",coordinates:gn(nn(t))}}},Lu=function(t){return en(t,{id:Au("dashLine")})},Ou=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return{type:"Feature",properties:Le(Le({},Pu()),{},{nodes:t},e),geometry:{type:"Polygon",coordinates:[gn(nn([].concat(He(t),[Su(t)])))]}}},Du=function(t){return function(t,e,n){void 0===n&&(n={});for(var r=Mn(t).coordinates,i=0,o=0;r.length>o&&(i>e||o!==r.length-1);o++){if(i>=e){var a=e-i;if(a){var s=Ar(r[o],r[o-1])-180;return Sr(r[o],a,s,n)}return $e(r[o])}i+=wr(r[o],r[o+1],n)}return $e(r[r.length-1])}(t,Gr(t,{units:"meters"})/2,{units:"meters"})},Nu=function(t,e){var n=e.format,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=[];if(e.showTotalDistance){var o=Du(t),a=Gr(t,{units:"meters"});o.properties=Le({id:Au("text"),isActive:!1,meters:a,text:n(a),type:"totalDistance"},r),i.push(o)}else for(var s=t.geometry.coordinates,u=0;s.length-1>u;u++){var c=$e(s[u]),l=$e(s[u+1]),h=wr(c,l,{units:"meters"}),f=Tr(nn([c,l]));f.properties=Le({id:Au("text"),isActive:!1,meters:h,text:n(h),type:"distance"},r),i.push(f)}return i},zu=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.format,i=Ur(t);return kr(t,{properties:Le({meters:i,text:r(i),type:"area",isActive:!1},n)})},Fu=function(t){var e,n,r=t.getContainer();return null!==(e=null!==(n=null==r?void 0:r.querySelector(".l7-marker-container"))&&void 0!==n?n:null==r?void 0:r.querySelector(".amap-maps"))&&void 0!==e?e:null},Bu=function(t){return t.lngLat||t.lnglat},Uu=function(t){var e=Bu(t);return[e.lng,e.lat]},ju=function(t){return[t.lng,t.lat]},Zu=function(t){for(var e=Number.MAX_SAFE_INTEGER,n=0,r=t.length,i=0;r>i;i++)e>t[i]&&(e=t[i],n=i);return n},Vu=function(t,e){var n=[],r=[];return t.forEach((function(t){Xs(t,e)?r.length&&(n.push(r),r=[]):r.push(t)})),r.length&&n.push(r),n},Gu=function(t,e,n){var r=[],i=[],o=[];return(r="drawData"===t?e.getData():t instanceof Function?t(n):t).length&&(i=r.map((function(t){var e,r=null!==(e=t.properties)&&void 0!==e?e:{},i=r.nodes,o=void 0===i?[]:i,a=r.isActive;return void 0!==a&&a?o.filter((function(t){return!Xs(t.geometry.coordinates,n)})):o})).flat().filter((function(t){return t})),i.length||(i=gn(nn(r)).map((function(t){return $e(t)}))),o=r.map((function(t){var e,r,i=null===(e=t.properties)||void 0===e?void 0:e.line;return(null===(r=t.properties)||void 0===r?void 0:r.isActive)&&i?Vu(i.properties.nodes.map((function(t){return t.geometry.coordinates})),n).filter((function(t){return t.length>1})).map((function(t){return en(t)})):[i]})).flat().filter((function(t){return t})),o.length||r.forEach((function(t){var e=Pn(t);if(/linestring/i.test(e)&&o.push(t),/polygon/i.test(e)){var n,r,i=Hr(t);return(n=o).push.apply(n,He(null!==(r=null==i?void 0:i.features)&&void 0!==r?r:[i]))}}))),{points:i,lines:o}},Hu=function(t,e,n,r){var i=n.pointAdsorbPixel,o=Ge(t,2),a=r.lngLatToPixel([o[0],o[1]]),s=a.x,u=a.y,c=e.map((function(t){var e=Ge(t.geometry.coordinates,2),n=r.lngLatToPixel([e[0],e[1]]),i=n.y;return Math.pow(s-n.x,2)+Math.pow(u-i,2)})),l=Zu(c);return Math.pow(c[l],.5)>i?null:e[l].geometry.coordinates},Wu=function(t,e,n,r){var i=n.lineAdsorbPixel,o=Ge(t,2),a=r.lngLatToPixel([o[0],o[1]]),s=a.x,u=a.y,c=e.filter((function(t){return gn(t).length>1})).map((function(e){return function(t,e,n){void 0===n&&(n={});var r=$e([1/0,1/0],{dist:1/0}),i=0;return xn(t,(function(t){for(var o=kn(t),a=0;o.length-1>a;a++){var s=$e(o[a]);s.properties.dist=wr(e,s,n);var u=$e(o[a+1]);u.properties.dist=wr(e,u,n);var c=wr(s,u,n),l=Math.max(s.properties.dist,u.properties.dist),h=Ar(s,u),f=Sr(e,l,h+90,n),p=Sr(e,l,h-90,n),d=zr(en([f.geometry.coordinates,p.geometry.coordinates]),en([s.geometry.coordinates,u.geometry.coordinates])),v=null;d.features.length>0&&((v=d.features[0]).properties.dist=wr(e,v,n),v.properties.location=i+wr(s,v,n)),r.properties.dist>s.properties.dist&&((r=s).properties.index=a,r.properties.location=i),r.properties.dist>u.properties.dist&&((r=u).properties.index=a+1,r.properties.location=i+c),v&&r.properties.dist>v.properties.dist&&((r=v).properties.index=a),i+=c}})),r}(e,t)}));if(!c.length)return null;var l=c.map((function(t){var e=Ge(t.geometry.coordinates,2),n=r.lngLatToPixel([e[0],e[1]]),i=n.y;return Math.pow(s-n.x,2)+Math.pow(u-i,2)})),h=Zu(l);return Math.pow(l[h],.5)>i?null:c[h].geometry.coordinates},qu=function(t,e){var n=Ge(e,2),r=n[0],i=n[1];t.lngLat&&(t.lngLat={lng:r,lat:i}),t.lnglat&&(t.lnglat={lng:r,lat:i})},Xu=function(){function t(e,n){Oe(this,t),this.container=void 0,this.cursor=null,this.options=void 0,this.container=Fu(e),this.options=n}return Ne(t,[{key:"setCursor",value:function(t){t!==this.cursor&&this.container&&(this.container.style.cursor=t?this.options[t]:"",this.cursor=t)}},{key:"destroy",value:function(){this.setCursor(null)}}]),t}();function Yu(t,e){void 0===e&&(e={});var n=e.insertAt;if(t&&"undefined"!=typeof document){var r=document.head||document.getElementsByTagName("head")[0],i=document.createElement("style");i.type="text/css","top"===n&&r.firstChild?r.insertBefore(i,r.firstChild):r.appendChild(i),i.styleSheet?i.styleSheet.cssText=t:i.appendChild(document.createTextNode(t))}}Yu('.tippy-box[data-animation=fade][data-state=hidden]{opacity:0}[data-tippy-root]{max-width:calc(100vw - 10px)}.tippy-box{position:relative;background-color:#333;color:#fff;border-radius:4px;font-size:14px;line-height:1.4;white-space:normal;outline:0;transition-property:transform,visibility,opacity}.tippy-box[data-placement^=top]>.tippy-arrow{bottom:0}.tippy-box[data-placement^=top]>.tippy-arrow:before{bottom:-7px;left:0;border-width:8px 8px 0;border-top-color:initial;transform-origin:center top}.tippy-box[data-placement^=bottom]>.tippy-arrow{top:0}.tippy-box[data-placement^=bottom]>.tippy-arrow:before{top:-7px;left:0;border-width:0 8px 8px;border-bottom-color:initial;transform-origin:center bottom}.tippy-box[data-placement^=left]>.tippy-arrow{right:0}.tippy-box[data-placement^=left]>.tippy-arrow:before{border-width:8px 0 8px 8px;border-left-color:initial;right:-7px;transform-origin:center left}.tippy-box[data-placement^=right]>.tippy-arrow{left:0}.tippy-box[data-placement^=right]>.tippy-arrow:before{left:-7px;border-width:8px 8px 8px 0;border-right-color:initial;transform-origin:center right}.tippy-box[data-inertia][data-state=visible]{transition-timing-function:cubic-bezier(.54,1.5,.38,1.11)}.tippy-arrow{width:16px;height:16px;color:#333}.tippy-arrow:before{content:"";position:absolute;border-color:transparent;border-style:solid}.tippy-content{position:relative;padding:5px 9px;z-index:1}'),Yu(".tippy-box[data-theme~=light]{color:#26323d;box-shadow:0 0 20px 4px rgba(154,161,177,.15),0 4px 80px -8px rgba(36,40,47,.25),0 4px 4px -2px rgba(91,94,105,.15);background-color:#fff}.tippy-box[data-theme~=light][data-placement^=top]>.tippy-arrow:before{border-top-color:#fff}.tippy-box[data-theme~=light][data-placement^=bottom]>.tippy-arrow:before{border-bottom-color:#fff}.tippy-box[data-theme~=light][data-placement^=left]>.tippy-arrow:before{border-left-color:#fff}.tippy-box[data-theme~=light][data-placement^=right]>.tippy-arrow:before{border-right-color:#fff}.tippy-box[data-theme~=light]>.tippy-backdrop{background-color:#fff}.tippy-box[data-theme~=light]>.tippy-svg-arrow{fill:#fff}");var Ku=function(){function e(n,r){var i=this;Oe(this,e),this.content="",this.tippy=void 0,this.scene=void 0,this.isMouseInner=!1,this.onMouseMove=function(){i.isMouseInner=!0,i.checkTippyShow()},this.onMouseOut=function(){i.isMouseInner=!1,i.checkTippyShow()},this.setContent=Ai((function(t){i.content=null!=t?t:"",i.tippy.setContent(null!=t?t:""),i.checkTippyShow()}),16,{maxWait:16}),this.tippy=ve(Fu(n),Le(Le({},Pe),r)),this.tippy.hide(),this.scene=n,n.on(t.SceneEvent.Mousemove,this.onMouseMove),n.on(t.SceneEvent.Mouseout,this.onMouseOut)}return Ne(e,[{key:"getContent",value:function(){return this.content}},{key:"checkTippyShow",value:function(){this.content&&this.isMouseInner?this.tippy.show():this.tippy.hide()}},{key:"destroy",value:function(){this.scene.off(t.SceneEvent.Mousemove,this.onMouseMove),this.scene.off(t.SceneEvent.Mouseout,this.onMouseOut),this.tippy.destroy()}}]),e}(),Qu=function(){function t(e){var n=e.config;Oe(this,t),this.historyList=[],this.historyIndex=0,this.config=void 0,this.config=n}return Ne(t,[{key:"save",value:function(t){if(this.config){var e=this.config.maxSize;this.historyIndex&&(this.historyList=this.historyList.slice(this.historyIndex),this.historyIndex=0),e>this.historyList.length||this.historyList.pop();var n=Ts(t);return this.historyList.unshift(n),n}}},{key:"revert",value:function(){if(this.historyList.length&&this.historyList.length-1>this.historyIndex){var t=this.historyList[++this.historyIndex];return t?Ts(t):void 0}}},{key:"redo",value:function(){if(this.historyList.length&&this.historyIndex>0){var t=this.historyList[--this.historyIndex];return t?Ts(t):void 0}}}]),t}(),Ju=function(e){Fe(r,e);var n=Ze(r);function r(t){var e,o=t.data,a=t.render,s=t.history,u=t.scene;return Oe(this,r),(e=n.call(this)).scene=void 0,e.render=void 0,e.data=Ts(i),e.timeout=null,e.diffData={},e.history=void 0,e.scene=u,e.render=a,s&&(e.history=new Qu({config:s})),o&&e.setData(o),e}return Ne(r,[{key:"saveHistory",value:function(){var t;return null===(t=this.history)||void 0===t?void 0:t.save(this.data)}},{key:"revertHistory",value:function(){var t,e=null===(t=this.history)||void 0===t?void 0:t.revert();if(e)return this.setData(e),e}},{key:"redoHistory",value:function(){var t,e=null===(t=this.history)||void 0===t?void 0:t.redo();if(e)return this.setData(e),e}},{key:"setData",value:function(e){var n=this;return Object.keys(e).length&&(this.data=Le(Le({},this.data),e),this.diffData=Le(Le({},this.diffData),e),this.timeout||(this.timeout=requestAnimationFrame((function(){return n.updateDiffData()}))),this.emit(t.SourceEvent.Change,{data:this.data})),this.data}},{key:"getData",value:function(){return this.data}},{key:"getRenderData",value:function(t){return this.data[t]}},{key:"setRenderData",value:function(e,n){var r="function"==typeof n?n(this.getRenderData(e)):n;return this.setData(ze({},e,He(r).sort((function(t,e){return+t.properties.isActive-+e.properties.isActive})))),this.emit(t.SourceEvent.Change,this.data),r}},{key:"updateDiffData",value:function(){var e=this,n=Object.entries(this.diffData);n.length&&(n.forEach((function(t){var n,r=Ge(t,2),i=r[0],o=r[1];Array.isArray(o)&&(null===(n=e.getRender(i))||void 0===n||n.setData(o))})),this.emit(t.SourceEvent.Update,this.data,this.diffData),this.diffData={},this.timeout=null,requestAnimationFrame((function(){e.scene.render()})))}},{key:"getRender",value:function(t){return this.render[t]}},{key:"clear",value:function(){this.setData(Cs(Object.keys(this.render).map((function(t){return[t,[]]}))))}}]),r}(Xr),$u=function(e){Fe(i,e);var n=Ze(i);function i(e,r){var o;Oe(this,i),(o=n.call(this)).scene=void 0,o.source=void 0,o.render=void 0,o.cursor=void 0,o.options=void 0,o.enabled=!1,o.allowCreate=!1,o.sceneRender=void 0,o.mouseLngLat={lng:0,lat:0},o.popup=void 0,o.addCount=0,o.saveMouseLngLat=Ai((function(t){o.mouseLngLat=Bu(t)}),100,{maxWait:100}),o.saveHistory=Ai((function(){o.options.history&&o.source.saveHistory()}),100),o.bindThis(),o.scene=e,o.sceneRender=new Pi(e),o.options=yu({},o.getDefaultOptions(r),r),o.render=o.initRender(),o.source=new Ju({render:o.render,history:o.options.history||void 0,scene:e}),o.cursor=new Xu(e,o.options.cursor);var a=o.options,s=a.initialData,u=a.popup;return s&&o.setData(s),u&&(o.popup=new Ku(e,u instanceof Object?u:{})),o.saveHistory(),o.bindCommonEvent(),o.emit(t.DrawEvent.Init,je(o)),o.bindEnableEvent(),o}return Ne(i,[{key:"addable",get:function(){var t=this.getData(),e=this.options,n=e.multiple,r=e.maxCount,i=t.find((function(t){return t.properties.isDraw}));return!(!this.enabled||!this.allowCreate)&&(!!(n&&0>=r||i)||!(!n&&this.addCount>=1)&&(0>=r||r>t.length))}},{key:"getOptions",value:function(){return this.options}},{key:"getEditItem",value:function(){return this.editItem}},{key:"getDragItem",value:function(){return this.dragItem}},{key:"setHelper",value:function(t){var e,n,r=this.options.helper;if(r){var i=null!==(e=t in r?r[t]:t)&&void 0!==e?e:null;null===(n=this.popup)||void 0===n||n.setContent(i)}}},{key:"isEnable",value:function(){return this.enabled}},{key:"bindThis",value:function(){this.initRender=this.initRender.bind(this),this.getData=this.getData.bind(this),this.setData=this.setData.bind(this),this.emitChangeEvent=this.emitChangeEvent.bind(this),this.saveHistory=this.saveHistory.bind(this),this.onSceneMouseMove=this.onSceneMouseMove.bind(this),this.revertHistory=this.revertHistory.bind(this),this.redoHistory=this.redoHistory.bind(this),this.removeActiveFeature=this.removeActiveFeature.bind(this),this.bindCommonEvent=this.bindCommonEvent.bind(this),this.bindEnableEvent=this.bindEnableEvent.bind(this),this.unbindEnableEvent=this.unbindEnableEvent.bind(this),this.setActiveFeature=this.setActiveFeature.bind(this)}},{key:"bindCommonEvent",value:function(){var e=this;this.on(t.DrawEvent.Add,this.emitChangeEvent),this.on(t.DrawEvent.Add,(function(){e.addCount++})),this.on(t.DrawEvent.Edit,this.emitChangeEvent),this.on(t.DrawEvent.Remove,this.emitChangeEvent),this.on(t.DrawEvent.Clear,this.emitChangeEvent),this.on(t.DrawEvent.AddNode,this.saveHistory),this.on(t.DrawEvent.RemoveNode,this.emitChangeEvent),this.bindEmitSelectEvent(!0)}},{key:"bindEmitSelectEvent",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]&&arguments[0],r=null,i=function(){var n,i,o,a=e.getData().find((function(t){var e;return null===(e=t.properties)||void 0===e?void 0:e.isActive}))||null;(null===(n=r)||void 0===n||null===(i=n.properties)||void 0===i?void 0:i.id)!==(null==a||null===(o=a.properties)||void 0===o?void 0:o.id)&&(r=a,e.emit(t.DrawEvent.Select,a))};this.source.on(t.SourceEvent.Change,i),n&&i()}},{key:"bindEnableEvent",value:function(){this.unbindKeyboardEvent(),this.scene.setMapStatus({doubleClickZoom:!1}),this.scene.on(t.SceneEvent.Mousemove,this.saveMouseLngLat),this.bindKeyboardEvent()}},{key:"unbindEnableEvent",value:function(){this.scene.setMapStatus({doubleClickZoom:!0}),this.scene.off(t.SceneEvent.Mousemove,this.saveMouseLngLat),this.unbindKeyboardEvent()}},{key:"bindKeyboardEvent",value:function(){var t=this,e=this.options.keyboard||{},n=e.revert,r=e.redo,i=e.remove;i&&Eu.bind(i,(function(){t.removeActiveFeature()})),this.options.history&&(n&&Eu.bind(n,this.revertHistory),r&&Eu.bind(r,this.redoHistory))}},{key:"unbindKeyboardEvent",value:function(){var t=this.options.keyboard||{},e=t.revert,n=t.redo,r=t.remove;r&&Eu.unbind(r),this.options.history&&(e&&Eu.unbind(e),n&&Eu.unbind(n))}},{key:"emitChangeEvent",value:function(){this.emit(t.DrawEvent.Change,this.getData()),this.saveHistory()}},{key:"revertHistory",value:function(){this.enabled&&this.options.history&&this.source.revertHistory()&&(this.correctDrawItem(),this.emit(t.DrawEvent.Change,this.getData()))}},{key:"redoHistory",value:function(){this.enabled&&this.options.history&&this.source.redoHistory()&&(this.correctDrawItem(),this.emit(t.DrawEvent.Change,this.getData()))}},{key:"getRenderLayers",value:function(){return Cs(wu(this.render).map((function(t){var e=Ge(t,2);return[e[0],e[1].getLayers()]})))}},{key:"getTargetFeature",value:function(t){var e,n,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getData(),i=null;return t&&(i=null!==(e=r.find((function(e){var n;return e.properties.id===("string"==typeof t?t:null===(n=t.properties)||void 0===n?void 0:n.id)})))&&void 0!==e?e:null,!i&&t instanceof Object&&(i=null!==(n=r.find((function(e){return Xs(t.geometry,e.geometry)})))&&void 0!==n?n:null)),i}},{key:"removeActiveFeature",value:function(){var t=this.getData().find((function(t){var e=t.properties;return e.isActive||e.isDraw}));return t&&this.removeFeature(t),t}},{key:"removeFeature",value:function(e){var n=this.getData(),r=this.getTargetFeature(e);r&&(this.setData(n.filter((function(t){return!Tu(r,t)}))),this.emit(t.DrawEvent.Remove,e,this.getData()))}},{key:"correctDrawItem",value:function(){this.getData().find((function(t){return t.properties.isDraw}))&&this.onSceneMouseMove({type:"mousemove",lnglat:this.mouseLngLat,lngLat:this.mouseLngLat})}},{key:"initRender",value:function(){var t,e={},n=function(t,e){var n="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=We(t))||e&&t&&"number"==typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return t.length>r?{done:!1,value:t[r++]}:{done:!0}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}(this.getRenderTypes());try{for(n.s();!(t=n.n()).done;){var r=t.value;e[r]=new(0,Ri[r])(this.scene,{style:this.options.style[r]})}}catch(t){n.e(t)}finally{n.f()}return e}},{key:"getCommonOptions",value:function(t){return{initialData:[],autoActive:!0,cursor:Ts(r),editable:!0,style:Ts(Zi),multiple:!0,history:Ts(ke),keyboard:Ts(Me),popup:!0,helper:{},maxCount:-1}}},{key:"setCursor",value:function(t){this.cursor.setCursor(t)}},{key:"resetCursor",value:function(){this.setCursor(this.addable?"draw":null)}},{key:"enable",value:function(){var e=this;this.allowCreate=0>=arguments.length||void 0===arguments[0]||arguments[0],this.addCount=0,this.enabled=!0,this.bindEnableEvent(),this.resetCursor(),this.setHelper(this.addable?"draw":null),setTimeout((function(){e.emit(t.DrawEvent.Enable,e)}),0)}},{key:"disable",value:function(){var e=this;this.resetFeatures(),this.enabled=!1,this.setCursor(null),this.unbindEnableEvent(),this.addCount=0,this.setHelper(null),setTimeout((function(){e.emit(t.DrawEvent.Disable,e)}),0)}},{key:"clear",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];this.source.clear(),this.emit(t.DrawEvent.Clear,this),e&&this.disable()}},{key:"show",value:function(){return Object.values(this.render).forEach((function(t){t.show()}))}},{key:"hide",value:function(){return Object.values(this.render).forEach((function(t){t.hide()}))}},{key:"destroy",value:function(){var e,n=this;Object.values(this.render).forEach((function(t){t.destroy()})),Object.values(t.RenderEvent).forEach((function(t){Object.values(n.render).forEach((function(e){e.removeAllListeners(t)})),n.sceneRender.removeAllListeners(t)})),setTimeout((function(){Object.values(t.DrawEvent).forEach((function(t){n.removeAllListeners(t)}))}),0),null===(e=this.popup)||void 0===e||e.destroy(),this.cursor.destroy(),this.emit(t.DrawEvent.Destroy,this)}}]),i}(Xr),tc=function(t){var e=null==t?0:t.length;return e?t[e-1]:void 0},ec=function(e){Fe(r,e);var n=Ze(r);function r(){return Oe(this,r),n.apply(this,arguments)}return Ne(r,[{key:"pointRender",get:function(){return this.render.point}},{key:"dragPoint",get:function(){return this.getPointData().find((function(t){return t.properties.isDrag}))}},{key:"editPoint",get:function(){return this.getPointData().find((function(t){return t.properties.isActive}))}},{key:"hoverPoint",get:function(){return this.getPointData().find((function(t){return t.properties.isHover}))}},{key:"getDragPoint",value:function(){return this.dragPoint}},{key:"getEditPoint",value:function(){return this.editPoint}},{key:"getPointData",value:function(){return this.source.getRenderData("point")}},{key:"setPointData",value:function(t){return this.source.setRenderData("point",t)}},{key:"bindPointRenderEvent",value:function(){var e,n,r,i,o,a;null===(e=this.pointRender)||void 0===e||e.on(t.RenderEvent.UnClick,this.onPointCreate.bind(this)),null===(n=this.pointRender)||void 0===n||n.on(t.RenderEvent.Mousemove,this.onPointMouseMove.bind(this)),null===(r=this.pointRender)||void 0===r||r.on(t.RenderEvent.Mouseout,this.onPointMouseOut.bind(this)),null===(i=this.pointRender)||void 0===i||i.on(t.RenderEvent.Dragstart,this.onPointDragStart.bind(this)),null===(o=this.pointRender)||void 0===o||o.on(t.RenderEvent.Dragging,this.onPointDragging.bind(this)),null===(a=this.pointRender)||void 0===a||a.on(t.RenderEvent.Dragend,this.onPointDragEnd.bind(this))}},{key:"handleCreatePoint",value:function(t){var e=this.options,n=e.autoActive,r=e.editable,i=Iu(t);return this.setPointData((function(t){return Cu({target:i,data:[].concat(He(t),[i]),targetHandler:function(t){t.properties=Le(Le({},t.properties),{},{isHover:r,isActive:n&&r})},otherHandler:function(t){t.properties=Le(Le({},t.properties),{},{isHover:!1,isActive:!1,isDrag:!1})}})})),i}},{key:"handlePointHover",value:function(t){return this.setCursor("pointHover"),Tu(t,this.hoverPoint)||this.setPointData((function(e){return Cu({target:t,data:e,targetHandler:function(t){t.properties.isHover=!0},otherHandler:function(t){t.properties.isHover=!1}})})),t}},{key:"handlePointUnHover",value:function(t){return this.resetCursor(),this.setPointData((function(t){return t.map((function(t){return t.properties.isHover=!1,t}))})),t}},{key:"handlePointDragStart",value:function(t){return this.setPointData((function(e){return Cu({target:t,data:e,targetHandler:function(t){t.properties=Le(Le({},t.properties),{},{isDrag:!0,isActive:!0})},otherHandler:function(t){t.properties=Le(Le({},t.properties),{},{isDrag:!1,isActive:!1})}})})),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("pointDrag"),t}},{key:"handlePointDragging",value:function(t,e){return this.setPointData((function(n){return Cu({target:t,data:n,targetHandler:function(t){t.geometry.coordinates=ju(e)}})})),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("pointDrag"),t}},{key:"handlePointDragEnd",value:function(t){return this.setPointData((function(e){return Cu({target:t,data:e,targetHandler:function(t){t.properties.isDrag=!1}})})),this.scene.setMapStatus({dragEnable:!0}),this.setCursor("pointHover"),t}},{key:"onPointCreate",value:function(t){return this.handleCreatePoint(ju(Bu(t)))}},{key:"onPointMouseMove",value:function(t){return this.handlePointHover(t.feature)}},{key:"onPointMouseOut",value:function(t){return this.handlePointUnHover(t.feature)}},{key:"onPointDragStart",value:function(t){if(this.options.editable)return this.handlePointDragStart(t.feature)}},{key:"onPointDragging",value:function(t){var e=this.dragPoint;if(this.options.editable&&e)return this.handlePointDragging(e,Bu(t))}},{key:"onPointDragEnd",value:function(t){var e=this.dragPoint;if(this.options.editable&&e)return this.handlePointDragEnd(e)}},{key:"enablePointRenderAction",value:function(){var t,e,n,r,i=this.options.editable;this.enabled&&(null===(e=this.pointRender)||void 0===e||e.enableCreate()),null===(t=this.pointRender)||void 0===t||t.enableClick(),i&&(null===(n=this.pointRender)||void 0===n||n.enableHover(),null===(r=this.pointRender)||void 0===r||r.enableDrag())}},{key:"disablePointRenderAction",value:function(){var t,e,n,r;null===(t=this.pointRender)||void 0===t||t.disableCreate(),null===(e=this.pointRender)||void 0===e||e.disableHover(),null===(n=this.pointRender)||void 0===n||n.disableDrag(),null===(r=this.pointRender)||void 0===r||r.disableClick()}}]),r}($u),nc=function(e){Fe(r,e);var n=Ze(r);function r(){return Oe(this,r),n.apply(this,arguments)}return Ne(r,[{key:"midPointRender",get:function(){return this.render.midPoint}},{key:"getCommonOptions",value:function(t){return Le(Le({},Ve(Be(r.prototype),"getCommonOptions",this).call(this,t)),{},{showMidPoint:!0})}},{key:"bindMidPointRenderEvent",value:function(){var e,n,r;null===(e=this.midPointRender)||void 0===e||e.on(t.RenderEvent.Click,this.onMidPointClick.bind(this)),null===(n=this.midPointRender)||void 0===n||n.on(t.RenderEvent.Mousemove,this.onMidPointHover.bind(this)),null===(r=this.midPointRender)||void 0===r||r.on(t.RenderEvent.Mouseout,this.onMidPointUnHover.bind(this))}},{key:"getMidPointData",value:function(){return this.source.getRenderData("midPoint")}},{key:"setMidPointData",value:function(t){return this.source.setRenderData("midPoint",t)}},{key:"getMidPointsByLine",value:function(t){var e=t.properties.nodes;if(!this.options.showMidPoint||2>e.length)return[];for(var n=[],r=0;e.length-1>r;r++){var i,o,a,s,u=Tr(nn([e[r],e[r+1]]),{properties:{id:Au("midPoint"),startId:null!==(i=null===(o=e[r].properties)||void 0===o?void 0:o.id)&&void 0!==i?i:"",endId:null!==(a=null===(s=e[r+1].properties)||void 0===s?void 0:s.id)&&void 0!==a?a:""}});n.push(u)}return n}},{key:"onMidPointHover",value:function(t){this.setCursor("pointHover")}},{key:"onMidPointUnHover",value:function(t){this.resetCursor()}},{key:"enableMidPointRenderAction",value:function(){var t,e;null===(t=this.midPointRender)||void 0===t||t.enableClick(),null===(e=this.midPointRender)||void 0===e||e.enableHover()}},{key:"disableMidPointRenderAction",value:function(){var t,e;null===(t=this.midPointRender)||void 0===t||t.disableClick(),null===(e=this.midPointRender)||void 0===e||e.disableHover()}}]),r}(ec),rc={draw:"单击绘制点",pointHover:"可拖拽调整点位置",pointDrag:null},ic={draw:"单击绘制首个节点",pointHover:"可拖拽调整节点位置",pointDrag:null,lineHover:"可拖拽调整线位置",lineDrag:null,midPointHover:"单击在该位置新增节点",drawFinish:"单击继续绘制，双击结束绘制"},oc={draw:"单击绘制首个节点",drawContinue:"单击继续绘制",drawFinish:"单击继续绘制，双击结束绘制",midPointHover:"单击在该位置新增节点",pointHover:"可拖拽调整节点位置",pointDrag:null,lineHover:"可拖拽调整面位置",lineDrag:null,polygonHover:"可拖拽调整面位置",polygonDrag:null},ac=Le(Le({},oc),{},{draw:"单击绘制首个节点",drawFinish:"单击结束绘制"}),sc={draw:"拖拽开始绘制",drawFinish:"松开鼠标结束绘制"},uc={lineHover:"可拖拽调整矩形位置",polygonHover:"可拖拽调整矩形位置"},cc={lineHover:"可拖拽调整圆位置",polygonHover:"可拖拽调整圆位置"},lc=function(e){Fe(r,e);var n=Ze(r);function r(){var t;Oe(this,r);for(var e=arguments.length,i=Array(e),o=0;e>o;o++)i[o]=arguments[o];return(t=n.call.apply(n,[this].concat(i))).previousPosition=[0,0],t}return Ne(r,[{key:"lineRender",get:function(){return this.render.line}},{key:"dragLine",get:function(){return this.getLineData().find((function(t){return t.properties.isDrag}))}},{key:"drawLine",get:function(){return this.getLineData().find((function(t){return t.properties.isDraw}))}},{key:"editLine",get:function(){return this.getLineData().find((function(t){var e=t.properties;return!e.isDraw&&e.isActive}))}},{key:"hoverLine",get:function(){return this.getLineData().find((function(t){return t.properties.isHover}))}},{key:"getDragLine",value:function(){return this.dragLine}},{key:"getDrawLine",value:function(){return this.drawLine}},{key:"getEditLine",value:function(){return this.editLine}},{key:"getDefaultOptions",value:function(t){var e=Le(Le({},this.getCommonOptions(t)),{},{showMidPoint:!0,distanceOptions:!1,helper:Ts(ic)});return t.distanceOptions&&(e.distanceOptions=Le(Le({},Te),e.distanceOptions)),t.adsorbOptions&&(e.adsorbOptions=Le(Le({},Ie),e.adsorbOptions)),e}},{key:"getAdsorbPosition",value:function(t){var e=this.options.adsorbOptions;if("boolean"==typeof e)return t;var n=this.scene,r=e.pointAdsorbPixel,i=e.lineAdsorbPixel,o=null,a=Gu(e.data,this,t),s=a.points,u=a.lines;return s.length&&r>0&&(o=Hu(t,s,e,n)),!o&&u.length&&i>0&&(o=Wu(t,u,e,n)),o}},{key:"bindSceneEvent",value:function(){this.sceneRender.on(t.RenderEvent.Mousemove,this.onSceneMouseMove.bind(this))}},{key:"bindPointRenderEvent",value:function(){var e;Ve(Be(r.prototype),"bindPointRenderEvent",this).call(this),null===(e=this.pointRender)||void 0===e||e.on(t.RenderEvent.Click,this.onPointClick.bind(this))}},{key:"bindLineRenderEvent",value:function(){var e,n,r,i,o,a;null===(e=this.lineRender)||void 0===e||e.on(t.RenderEvent.UnClick,this.onLineUnClick.bind(this)),null===(n=this.lineRender)||void 0===n||n.on(t.RenderEvent.Mousemove,this.onLineMouseMove.bind(this)),null===(r=this.lineRender)||void 0===r||r.on(t.RenderEvent.Mouseout,this.onLineMouseOut.bind(this)),null===(i=this.lineRender)||void 0===i||i.on(t.RenderEvent.Dragstart,this.onLineDragStart.bind(this)),null===(o=this.lineRender)||void 0===o||o.on(t.RenderEvent.Dragging,this.onLineDragging.bind(this)),null===(a=this.lineRender)||void 0===a||a.on(t.RenderEvent.Dragend,this.onLineDragEnd.bind(this))}},{key:"getDashLineDistanceTexts",value:function(t,e){var n=e.showTotalDistance,r=e.format;return e.showDashDistance?t.map((function(t){return Nu(t,{showTotalDistance:n,format:r},{isActive:!0,type:"dash"})})).flat():[]}},{key:"getLineDistanceTexts",value:function(t,e){var n=e.showTotalDistance,r=e.format,i=e.showWhen,o=[];if(i.includes("active")){var a=t.filter((function(t){return t.properties.isActive&&t.properties.nodes.length>1}));o.push.apply(o,He(a.map((function(t){return Nu(t,{showTotalDistance:n,format:r},{isActive:!0})})).flat()))}if(i.includes("normal")){var s=t.filter((function(t){return!t.properties.isActive&&t.properties.nodes.length>1}));o.push.apply(o,He(s.map((function(t){return Nu(t,{showTotalDistance:n,format:r})})).flat()))}return o}},{key:"getDistanceTexts",value:function(){var t=this.options.distanceOptions;if(!t)return[];var e=[],n=t.showWhen,r=t.showDashDistance,i=t.format,o=t.showTotalDistance;return e.push.apply(e,He(this.getDashLineDistanceTexts(this.getDashLineData(),{showTotalDistance:!1,format:i,showDashDistance:r})).concat(He(this.getLineDistanceTexts(this.getLineData(),{showTotalDistance:o,format:i,showWhen:n})))),e}},{key:"getAllTexts",value:function(){return this.getDistanceTexts()}},{key:"handleCreateLine",value:function(t){var e=Ru([t],{isActive:!0,isDraw:!0});return this.setLineData((function(t){return Cu({target:e,data:[].concat(He(t),[e]),otherHandler:function(t){t.properties.isActive=!1}})})),this.setPointData([t]),this.setTextData(this.getAllTexts()),e}},{key:"syncLineNodes",value:function(t,e){return t.properties.nodes=e,t.geometry.coordinates=gn(nn(e)),this.setLineData((function(e){return e.map((function(e){return Tu(e,t)?t:e}))})),Tu(this.editLine,t)&&this.setMidPointData(this.getMidPointsByLine(t)),this.setPointData(t.properties.nodes),this.setTextData(this.getAllTexts()),t}},{key:"setActiveLine",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.setLineData((function(n){return Cu({target:t,data:n,targetHandler:function(t){t.properties=Le(Le({},t.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},e)},otherHandler:function(t){t.properties=Le(Le({},t.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})})),this.setPointData(t.properties.nodes.map((function(t){return t.properties=Le(Le({},t.properties),{},{isHover:!1,isActive:!1}),t}))),this.setMidPointData(this.getMidPointsByLine(t)),this.setDashLineData([]),this.setTextData(this.getAllTexts()),t}},{key:"clearActiveLine",value:function(){this.source.setData({point:[],line:this.getLineData().map((function(t){return t.properties=Le(Le({},t.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),t})),midPoint:[],text:this.getAllTexts()})}},{key:"handleLineUnClick",value:function(t){return this.clearActiveLine(),t}},{key:"handleLineHover",value:function(t){if(!this.drawLine)return this.setCursor("lineHover"),Tu(t,this.hoverLine)||this.setLineData((function(e){return Cu({target:t,data:e,targetHandler:function(t){t.properties.isHover=!0},otherHandler:function(t){t.properties.isHover=!1}})})),t}},{key:"handleLineUnHover",value:function(t){if(!this.drawLine)return this.resetCursor(),this.setLineData((function(t){return t.map((function(t){return t.properties.isHover=!1,t}))})),t}},{key:"handleLineDragStart",value:function(t){return this.setActiveLine(t,{isDrag:!0,isActive:!0}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("lineDrag"),t}},{key:"handleLineDragging",value:function(t,e){var n=e.lng,r=e.lat,i=t.properties.nodes,o=Ge(this.previousPosition,2),a=o[0],s=o[1];return i.forEach((function(t){var e=t.geometry.coordinates;t.geometry.coordinates=[e[0]+n-a,e[1]+r-s]})),this.syncLineNodes(t,i),this.setActiveLine(t,{isDrag:!0}),this.setCursor("lineDrag"),this.previousPosition=[n,r],t}},{key:"handleLineDragEnd",value:function(t){return t.properties.isDrag=!1,this.setLineData((function(t){return t})),this.scene.setMapStatus({dragEnable:!0}),t}},{key:"resetAdsorbLngLat",value:function(t){if(this.options.adsorbOptions){var e=this.getAdsorbPosition(ju(Bu(t)));return e&&qu(t,e),e}}},{key:"onPointCreate",value:function(t){if(!this.editLine){this.resetAdsorbLngLat(t);var e=Ve(Be(r.prototype),"onPointCreate",this).call(this,t),n=this.drawLine;if(e)return n?(this.syncLineNodes(n,[].concat(He(n.properties.nodes),[e])),this.setDashLineData([])):this.handleCreateLine(e),e}}},{key:"onPointDragStart",value:function(t){if(this.editLine)return this.setHelper("pointDrag"),Ve(Be(r.prototype),"onPointDragStart",this).call(this,t)}},{key:"onPointDragging",value:function(t){var e=Ve(Be(r.prototype),"onPointDragging",this).call(this,t);if(e){var n=this.resetAdsorbLngLat(t);n&&(e.geometry.coordinates=Ts(n))}var i=this.editLine;return i&&e&&(this.syncLineNodes(i,i.properties.nodes.map((function(t){return Tu(e,t)?e:t}))),this.setActiveLine(i)),e}},{key:"onPointDragEnd",value:function(t){if(this.editLine){var e=Ve(Be(r.prototype),"onPointDragEnd",this).call(this,t);return this.setPointData((function(t){return t.map((function(t){return t.properties.isActive=!1,t}))})),this.setHelper("pointHover"),e}}},{key:"onLineUnClick",value:function(t){var e=this.editLine;if(e)return this.handleLineUnClick(e)}},{key:"onLineMouseMove",value:function(t){if(!this.drawLine)return this.dragLine||this.drawLine||!this.options.editable||this.setHelper("lineHover"),this.handleLineHover(t.feature)}},{key:"onLineMouseOut",value:function(t){if(!this.drawLine)return this.dragLine||this.drawLine||this.setHelper(this.addable?"draw":null),this.handleLineUnHover(t.feature)}},{key:"onLineDragStart",value:function(t){if(this.options.editable&&!this.drawLine)return this.previousPosition=Uu(t),this.setHelper("lineDrag"),this.handleLineDragStart(t.feature)}},{key:"onLineDragging",value:function(t){var e=this.dragLine;if(e)return this.handleLineDragging(e,Bu(t))}},{key:"onLineDragEnd",value:function(t){var e=this.dragLine;if(e)return this.setHelper("lineHover"),this.handleLineDragEnd(e)}},{key:"onPointMouseMove",value:function(t){var e=Ve(Be(r.prototype),"onPointMouseMove",this).call(this,t);return this.dragLine||this.drawLine||this.dragPoint||this.setHelper("pointHover"),e}},{key:"onPointMouseOut",value:function(t){var e=Ve(Be(r.prototype),"onPointMouseOut",this).call(this,t);return this.dragLine||this.drawLine||this.dragPoint||this.setHelper(this.addable?"draw":null),e}},{key:"onMidPointHover",value:function(t){Ve(Be(r.prototype),"onMidPointHover",this).call(this,t),this.setHelper("midPointHover")}},{key:"onMidPointUnHover",value:function(t){Ve(Be(r.prototype),"onMidPointUnHover",this).call(this,t),this.setHelper(null)}},{key:"onPointClick",value:function(t){}},{key:"getLineData",value:function(){return this.source.getRenderData("line")}},{key:"setLineData",value:function(t){return this.source.setRenderData("line",t)}},{key:"getTextData",value:function(){return this.source.getRenderData("text")}},{key:"setTextData",value:function(t){return this.source.setRenderData("text",t)}},{key:"getDashLineData",value:function(){return this.source.getRenderData("dashLine")}},{key:"setDashLineData",value:function(t){return this.source.setRenderData("dashLine",t)}},{key:"onMidPointClick",value:function(t){var e=this.editLine,n=t.feature;if(e&&n&&!this.dragPoint){var r=e.properties.nodes,i=n.properties,o=i.startId,a=i.endId,s=r.findIndex((function(t){return t.properties.id===o})),u=r.findIndex((function(t){return t.properties.id===a}));if(s>-1&&u>-1){var c=Iu(n.geometry.coordinates,{isDrag:!0,isHover:!0});return this.setHelper("pointDrag"),r.splice(u,0,c),e.geometry.coordinates=gn(nn(r)),this.syncLineNodes(e,r),this.setActiveLine(e),c}}}},{key:"enableSceneRenderAction",value:function(){this.sceneRender.enableDrag(),this.sceneRender.enableMouseMove(),this.sceneRender.enableDblClick()}},{key:"disableSceneRenderAction",value:function(){this.sceneRender.disableDrag(),this.sceneRender.disableMouseMove(),this.sceneRender.disableDblClick()}},{key:"enableLineRenderAction",value:function(){var t,e,n,r=this.options.editable;null===(t=this.lineRender)||void 0===t||t.enableUnClick(),r&&(null===(e=this.lineRender)||void 0===e||e.enableHover(),null===(n=this.lineRender)||void 0===n||n.enableDrag())}},{key:"disableLineRenderAction",value:function(){var t,e,n;null===(t=this.lineRender)||void 0===t||t.disableUnClick(),null===(e=this.lineRender)||void 0===e||e.disableHover(),null===(n=this.lineRender)||void 0===n||n.disableDrag()}}]),r}(nc),hc=function(e){Fe(r,e);var n=Ze(r);function r(){return Oe(this,r),n.apply(this,arguments)}return Ne(r,[{key:"dragItem",get:function(){return this.dragPolygon}},{key:"editItem",get:function(){return this.editPolygon}},{key:"polygonRender",get:function(){return this.render.polygon}},{key:"dragPolygon",get:function(){return this.getPolygonData().find((function(t){return t.properties.isDrag}))}},{key:"drawPolygon",get:function(){return this.getPolygonData().find((function(t){return t.properties.isDraw}))}},{key:"editPolygon",get:function(){return this.getPolygonData().find((function(t){var e=t.properties;return!e.isDraw&&e.isActive}))}},{key:"hoverPolygon",get:function(){return this.getPolygonData().find((function(t){return t.properties.isHover}))}},{key:"getDragPolygon",value:function(){return this.dragPolygon}},{key:"getDrawPolygon",value:function(){return this.drawPolygon}},{key:"getEditPolygon",value:function(){return this.editPolygon}},{key:"getRenderTypes",value:function(){return["polygon","line","dashLine","midPoint","point","text"]}},{key:"getData",value:function(){return this.getPolygonData()}},{key:"getMainLayer",value:function(){var t,e;return null!==(t=null===(e=this.render.polygon)||void 0===e?void 0:e.getLayers())&&void 0!==t?t:[]}},{key:"getDefaultOptions",value:function(t){var e=Le(Le({},Ve(Be(r.prototype),"getDefaultOptions",this).call(this,t)),{},{areaOptions:!1,helper:Ts(oc)});return t.areaOptions&&(e.areaOptions=Le(Le({},Ce),t.areaOptions)),e}},{key:"getAreaTexts",value:function(t){var e=this.options.areaOptions;if(!e)return[];var n=e.format,r=e.showWhen,i=[],o=t.filter((function(t){return t.geometry.coordinates[0].length>=4}));return r.includes("active")&&o.filter((function(t){return t.properties.isActive})).forEach((function(t){i.push(zu(t,{format:n},{isActive:!0}))})),r.includes("normal")&&o.filter((function(t){return!t.properties.isActive})).forEach((function(t){i.push(zu(t,{format:n},{isActive:!1}))})),i}},{key:"getAllTexts",value:function(){return[].concat(He(Ve(Be(r.prototype),"getAllTexts",this).call(this)),He(this.getAreaTexts(this.getPolygonData())))}},{key:"getPolygonData",value:function(){return this.source.getRenderData("polygon")}},{key:"setPolygonData",value:function(t){return this.source.setRenderData("polygon",t)}},{key:"handleCreatePolygon",value:function(t,e){var n=Ou(t,{nodes:t,line:e,isActive:!0,isDraw:!0});return this.setPolygonData((function(t){return Cu({target:n,data:[].concat(He(t),[n]),otherHandler:function(t){t.properties.isActive=!1}})})),n}},{key:"handlePolygonUnClick",value:function(t){return this.clearActivePolygon(),t}},{key:"handlePolygonHover",value:function(t){return this.setCursor("polygonHover"),Tu(t,this.hoverPolygon)||this.setPolygonData((function(e){return Cu({target:t,data:e,targetHandler:function(t){t.properties.isHover=!0},otherHandler:function(t){t.properties.isHover=!1}})})),t}},{key:"handlePolygonUnHover",value:function(){this.resetCursor(),this.setPolygonData((function(t){return t.map((function(t){return t.properties.isHover=!1,t}))}))}},{key:"handlePolygonDragStart",value:function(t){return this.setActivePolygon(t,{isDrag:!0}),this.scene.setMapStatus({dragEnable:!1}),this.setCursor("polygonDrag"),t}},{key:"bindPolygonRenderEvent",value:function(){var e,n,r,i;null===(e=this.polygonRender)||void 0===e||e.on(t.RenderEvent.UnClick,this.onPolygonUnClick.bind(this)),null===(n=this.polygonRender)||void 0===n||n.on(t.RenderEvent.Mousemove,this.onPolygonHover.bind(this)),null===(r=this.polygonRender)||void 0===r||r.on(t.RenderEvent.Mouseout,this.onPolygonUnHover.bind(this)),null===(i=this.polygonRender)||void 0===i||i.on(t.RenderEvent.Dragstart,this.onPolygonDragStart.bind(this))}},{key:"syncPolygonNodes",value:function(t,e){var n=gn(nn([].concat(He(e),[Su(e)]))),r=t.properties,i=r.line;if(t.properties.nodes=e,t.geometry.coordinates=[qr(en(n))?n:n.reverse()],this.setPolygonData((function(e){return e.map((function(e){return Tu(e,t)?t:e}))})),!Tu(this.drawPolygon,t)){var o=i.properties.nodes,a=He(e),s=Su(a);a.push(o.length===e.length?Iu(s.geometry.coordinates):tc(o));var u=tc(a);Xs(s.geometry.coordinates,u.geometry.coordinates)||(u.geometry.coordinates=Ts(s.geometry.coordinates)),this.syncLineNodes(i,a)}return t}},{key:"setActivePolygon",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return this.setActiveLine(t.properties.line,e),this.setPolygonData((function(n){return Cu({target:t,data:n,targetHandler:function(t){t.properties=Le(Le({},t.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},e)},otherHandler:function(t){t.properties=Le(Le({},t.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})})),this.setTextData(this.getAllTexts()),t}},{key:"clearActivePolygon",value:function(){this.setPolygonData((function(t){return t.map((function(t){return t.properties=Le(Le({},t.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),t}))})),this.clearActiveLine()}},{key:"onLineDragStart",value:function(e){var n=Ve(Be(r.prototype),"onLineDragStart",this).call(this,e),i=this.getPolygonData().find((function(t){return Tu(t.properties.line,n)}));return i&&(this.setActivePolygon(i,{isDrag:!0}),this.emit(t.DrawEvent.DragStart,i,this.getPolygonData())),n}},{key:"onLineUnClick",value:function(t){return this.editLine}},{key:"onLineDragEnd",value:function(e){var n=Ve(Be(r.prototype),"onLineDragEnd",this).call(this,e),i=this.dragPolygon;return n&&i&&(i.properties.isDrag=!1,this.emit(t.DrawEvent.DragEnd,i,this.getPolygonData()),this.emit(t.DrawEvent.Edit,i,this.getPolygonData())),n}},{key:"onPolygonUnClick",value:function(t){var e=this.editPolygon;if(e)return this.handlePolygonUnClick(e)}},{key:"onPolygonHover",value:function(t){if(!this.drawPolygon)return this.dragPolygon||this.setHelper("polygonHover"),this.handlePolygonHover(t.feature)}},{key:"onPolygonUnHover",value:function(t){if(!this.drawPolygon)return this.setHelper(this.addable?"draw":null),this.handlePolygonUnHover()}},{key:"onPolygonDragStart",value:function(e){if(this.options.editable&&!this.drawPolygon){var n=e.feature;return this.previousPosition=Uu(e),this.setHelper("polygonDrag"),this.emit(t.DrawEvent.DragStart,n,this.getPolygonData()),this.handlePolygonDragStart(n)}}},{key:"onMidPointClick",value:function(t){var e=this.editPolygon,n=Ve(Be(r.prototype),"onMidPointClick",this).call(this,t);if(n&&e){var i=e.properties.line.properties.nodes;this.syncPolygonNodes(e,i.slice(0,i.length-1)),this.setActivePolygon(e)}return n}},{key:"onPointDragEnd",value:function(e){var n=this.editPolygon,i=Ve(Be(r.prototype),"onPointDragEnd",this).call(this,e);return i&&n&&this.emit(t.DrawEvent.Edit,n,this.getPolygonData()),i}},{key:"enablePolygonRenderAction",value:function(){var t,e,n,r=this.options.editable;null===(t=this.polygonRender)||void 0===t||t.enableUnClick(),r&&(null===(e=this.polygonRender)||void 0===e||e.enableHover(),null===(n=this.polygonRender)||void 0===n||n.enableDrag())}},{key:"disablePolygonRenderAction",value:function(){var t,e,n;null===(t=this.polygonRender)||void 0===t||t.disableUnClick(),null===(e=this.polygonRender)||void 0===e||e.disableHover(),null===(n=this.polygonRender)||void 0===n||n.disableDrag()}},{key:"bindEnableEvent",value:function(){Ve(Be(r.prototype),"bindEnableEvent",this).call(this),this.enableSceneRenderAction(),this.enablePointRenderAction(),this.enableLineRenderAction(),this.enableMidPointRenderAction(),this.enablePolygonRenderAction()}},{key:"unbindEnableEvent",value:function(){Ve(Be(r.prototype),"unbindEnableEvent",this).call(this),this.disableSceneRenderAction(),this.disablePointRenderAction(),this.disableLineRenderAction(),this.disableMidPointRenderAction(),this.disablePolygonRenderAction()}},{key:"bindThis",value:function(){Ve(Be(r.prototype),"bindThis",this).call(this),this.bindPointRenderEvent=this.bindPointRenderEvent.bind(this),this.bindSceneEvent=this.bindSceneEvent.bind(this),this.bindLineRenderEvent=this.bindLineRenderEvent.bind(this),this.bindMidPointRenderEvent=this.bindMidPointRenderEvent.bind(this),this.bindPolygonRenderEvent=this.bindPolygonRenderEvent.bind(this)}},{key:"setActiveFeature",value:function(t){var e=this.getTargetFeature(t);e?this.setActivePolygon(e):this.clearActivePolygon()}},{key:"resetFeatures",value:function(){var t=this.getPolygonData();this.drawPolygon&&(t=t.filter((function(t){return!t.properties.isDraw})),this.source.setData({point:[],dashLine:[],midPoint:[]}),this.setLineData((function(t){return t.filter((function(t){return!t.properties.isDraw}))})),this.setTextData((function(t){return t.filter((function(t){return!t.properties.isActive}))}))),this.editPolygon&&this.handlePolygonUnClick(this.editPolygon),this.setPolygonData(t.map((function(t){return t.properties=Le(Le({},t.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),t})))}}]),r}(lc),fc=function(e){Fe(r,e);var n=Ze(r);function r(t,e){var i;return Oe(this,r),(i=n.call(this,t,e)).onSceneDragStart=i.onSceneDragStart.bind(je(i)),i.onSceneDragEnd=i.onSceneDragEnd.bind(je(i)),i}return Ne(r,[{key:"drawLine",get:function(){var t;return null===(t=this.drawPolygon)||void 0===t?void 0:t.properties.line}},{key:"isDragTrigger",get:function(){return"drag"===this.options.trigger}},{key:"isClickTrigger",get:function(){return"click"===this.options.trigger}},{key:"getDefaultOptions",value:function(t){var e=Le(Le({},Ve(Be(r.prototype),"getDefaultOptions",this).call(this,t)),{},{showMidPoint:!1,trigger:"click",autoActive:!1,helper:Ts(ac)});return"drag"===t.trigger&&(e.helper=Le(Le({},e.helper),sc)),e}},{key:"getMidPointsByLine",value:function(t){return[]}},{key:"handleCreatePolygon",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=e.properties.nodes;return Ou(r.slice(0,r.length-1),Le({nodes:t,line:e},n))}},{key:"handleFirstNodeCreate",value:function(e){var n=Iu(e.geometry.coordinates),r=this.handleCreatePolygonLine(e,n,{isDraw:!0,isActive:!0}),i=this.handleCreatePolygon([e,n],r,{isDraw:!0,isActive:!0});return this.setPolygonData((function(t){return Cu({target:i,data:[].concat(He(t),[i]),targetHandler:function(t){t.properties=Le(Le({},t.properties),{},{isDraw:!0,isActive:!0})}})})),this.emit(t.DrawEvent.AddNode,e,this.drawPolygon,this.getPolygonData()),this.setHelper("drawFinish"),e}},{key:"handleLastNodeCreate",value:function(e){var n=this.options,r=n.autoActive,i=n.editable,o=this.drawPolygon;return o?(this.setLineData((function(t){return[].concat(He(t),[o.properties.line])})),this.setActivePolygon(o),r&&i||this.handlePolygonUnClick(o),this.emit(t.DrawEvent.Add,o,this.getPolygonData()),this.emit(t.DrawEvent.AddNode,o.properties.nodes[1],this.drawPolygon,this.getPolygonData()),this.setHelper(i?r?"pointHover":"polygonHover":this.addable?"draw":null),e):e}},{key:"onPointCreate",value:function(t){var e=this;if(this.addable&&!this.dragPoint&&!this.editLine&&this.isClickTrigger){var n=this.drawPolygon,r=Uu(t),i=this.handleCreatePoint(r);return n?requestAnimationFrame((function(){e.handleLastNodeCreate(i)})):this.handleFirstNodeCreate(i),i}}},{key:"setActivePolygon",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.setActiveLine(t.properties.line,e),this.setPolygonData((function(n){return Cu({target:t,data:n,targetHandler:function(t){t.properties=Le(Le({},t.properties),{},{isDraw:!1,isActive:!0,isDrag:!1,isHover:!1},e)},otherHandler:function(t){t.properties=Le(Le({},t.properties),{},{isDraw:!1,isActive:!1,isDrag:!1})}})})),this.setPointData(t.properties.nodes),this.setDashLineData([]);var n=this.getAllTexts();return this.setTextData(n),t}},{key:"onPointDragging",value:function(t){var e=this.dragPoint;if(e){var n=this.handlePointDragging(e,Bu(t)),r=this.editPolygon;return n&&r&&(this.syncPolygonNodes(r,r.properties.nodes.map((function(t){return Tu(t,n)?n:t}))),this.setActivePolygon(r)),n}}},{key:"onSceneDragStart",value:function(t){this.isDragTrigger&&this.addable&&!this.dragPoint&&!this.editLine&&(this.scene.setMapStatus({dragEnable:!1}),this.handleFirstNodeCreate(this.handleCreatePoint(Uu(t))))}},{key:"onSceneDragEnd",value:function(t){this.isDragTrigger&&this.addable&&!this.dragPoint&&!this.editLine&&this.drawPolygon&&(this.scene.setMapStatus({dragEnable:!1}),this.handleLastNodeCreate(this.handleCreatePoint(Uu(t))))}},{key:"onSceneMouseMove",value:function(t){var e=this.drawPolygon;if(e){var n=e.properties.nodes,r=Su(n),i=tc(n);i.geometry.coordinates=Uu(t),this.syncPolygonNodes(e,[r,i]),this.setDashLineData([e.properties.line]),this.setTextData(this.getAllTexts()),this.resetCursor()}}},{key:"bindSceneDragEvent",value:function(){this.unbindSceneDragEvent(),this.sceneRender.on(t.RenderEvent.Dragstart,this.onSceneDragStart),this.sceneRender.on(t.RenderEvent.Dragend,this.onSceneDragEnd),this.scene.setMapStatus({dragEnable:!1})}},{key:"unbindSceneDragEvent",value:function(){this.sceneRender.off(t.RenderEvent.Dragstart,this.onSceneDragStart),this.sceneRender.off(t.RenderEvent.Dragend,this.onSceneDragEnd),this.scene.setMapStatus({dragEnable:!0})}},{key:"bindEnableEvent",value:function(){Ve(Be(r.prototype),"bindEnableEvent",this).call(this),this.isDragTrigger&&this.bindSceneDragEvent()}},{key:"unbindEnableEvent",value:function(){Ve(Be(r.prototype),"unbindEnableEvent",this).call(this),this.isDragTrigger&&this.unbindSceneDragEvent()}},{key:"bindThis",value:function(){Ve(Be(r.prototype),"bindThis",this).call(this),this.onSceneDragStart=this.onSceneDragStart.bind(this),this.onSceneDragEnd=this.onSceneDragEnd.bind(this)}}]),r}(hc),pc=function(e){Fe(r,e);var n=Ze(r);function r(t,e){var i;return Oe(this,r),(i=n.call(this,t,e)).bindPointRenderEvent(),i.bindSceneEvent(),i.bindMidPointRenderEvent(),i.bindLineRenderEvent(),i.bindPolygonRenderEvent(),i}return Ne(r,[{key:"getDefaultOptions",value:function(t){var e=Le(Le({},Ve(Be(r.prototype),"getDefaultOptions",this).call(this,t)),{},{showMidPoint:!1,circleSteps:60});return e.distanceOptions&&(e.distanceOptions.showTotalDistance=!0,void 0===e.distanceOptions.showOnRadius&&(e.distanceOptions.showOnRadius=!0)),e.helper&&(e.helper=Le(Le({},e.helper),cc)),e}},{key:"getDistanceTexts",value:function(){var t=this.options.distanceOptions;if(!t)return[];var e=[],n=t.showWhen,r=t.showDashDistance,i=t.format,o=t.showTotalDistance;return e.push.apply(e,He(this.getDashLineDistanceTexts(this.getDashLineData(),{showTotalDistance:!0,format:i,showDashDistance:r})).concat(He(this.getLineDistanceTexts(this.getLineData(),{showTotalDistance:o,format:i,showWhen:n})))),e}},{key:"setData",value:function(t){var e=this,n=t.map((function(t){var n,r,i;t.properties=Le(Le({},Pu()),t.properties);var o=null===(n=t.properties)||void 0===n?void 0:n.nodes;if(2!==(null===(r=o)||void 0===r?void 0:r.length)){var a=Ge(Tr(t).geometry.coordinates,2),s=a[0],u=a[1],c=An(t),l=c[2],h=(c[1]+c[3])/2;o=[Iu([s,u]),Iu([l,h])],t.properties.nodes=o}var f=o[0],p=o[1],d=!!(null===(i=t.properties)||void 0===i?void 0:i.isActive),v=t.properties.line;return v||(v=e.handleCreatePolygonLine(f,p,{isActive:d}),t.properties.line=v),e.handleCreatePolygon([f,p],v,Le(Le({},t.properties),{},{isActive:d}))}));this.source.setData({point:[],midPoint:[],dashLine:[],polygon:n,line:n.map((function(t){return t.properties.line}))}),this.setTextData(this.getAllTexts()),this.editPolygon&&this.setActivePolygon(this.editPolygon)}},{key:"handleCreatePolygonLine",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=this.getBoundaryPositions(t,e).map((function(t){return Iu(t)}));return Ru(r,n)}},{key:"syncPolygonNodes",value:function(t,e){var n=t.properties.line,r=this.getBoundaryPositions(e[0],e[1]);return t.properties.nodes=e,t.geometry.coordinates=[r],this.setPolygonData((function(e){return e.map((function(e){return Tu(e,t)?t:e}))})),this.setPointData(t.properties.isDraw?[e[0]]:e),n.properties.nodes.forEach((function(t,e){t.geometry.coordinates=r[e]})),n.geometry.coordinates=r,t}},{key:"onLineDragging",value:function(e){var n=this.dragPolygon,i=Ge(this.previousPosition,2),o=i[0],a=i[1],s=Ve(Be(r.prototype),"onLineDragging",this).call(this,e);if(n){var u=Ge(Uu(e),2),c=u[0],l=u[1];n.properties.nodes.forEach((function(t){var e=Ge(t.geometry.coordinates,2);t.geometry.coordinates=[e[0]+c-o,e[1]+l-a]})),this.syncPolygonNodes(n,n.properties.nodes),this.setActivePolygon(n,{isDrag:!0}),this.emit(t.DrawEvent.Dragging,n,this.getPolygonData())}return s}},{key:"getBoundaryPositions",value:function(t,e){for(var n=this.options.circleSteps,r=wr(t,e,{units:"meters"}),i=[],o=0;n>o;o++)i.push(Sr(t,r,-360*o/n,{units:"meters"}).geometry.coordinates);return i.push(i[0]),i}}]),r}(fc),dc=function(e){Fe(r,e);var n=Ze(r);function r(e,i){var o;return Oe(this,r),(o=n.call(this,e,i)).drawLineFinish=function(){var e,n=o.drawLine,r=null!==(e=null==n?void 0:n.properties.nodes)&&void 0!==e?e:[];if(n&&(null==r?void 0:r.length)>1){o.setActiveLine(n);var i=o.options,a=i.autoActive,s=i.editable;a&&s||o.handleLineUnClick(n),o.setHelper(s&&a?"pointHover":o.addable?"draw":null),o.emit(t.DrawEvent.Add,n,o.getLineData())}},o.sceneRender.on(t.RenderEvent.DblClick,o.drawLineFinish),o.bindPointRenderEvent(),o.bindSceneEvent(),o.bindMidPointRenderEvent(),o.bindLineRenderEvent(),o}return Ne(r,[{key:"dragItem",get:function(){return this.dragLine}},{key:"editItem",get:function(){return this.editLine}},{key:"getMainLayer",value:function(){var t,e;return null!==(t=null===(e=this.render.line)||void 0===e?void 0:e.getLayers())&&void 0!==t?t:[]}},{key:"setData",value:function(t){var e=t.map((function(t){var e,n;return t.properties=Le(Le({},Mu()),null!==(e=t.properties)&&void 0!==e?e:{}),(null===(n=t.properties.nodes)||void 0===n?void 0:n.length)||(t.properties.nodes=gn(t).map((function(t){return Iu(t)}))),t}));this.source.setData({point:[],midPoint:[],dashLine:[],line:e}),this.setTextData(this.getAllTexts()),this.editLine&&this.setActiveLine(this.editLine)}},{key:"getData",value:function(){return this.getLineData()}},{key:"getRenderTypes",value:function(){return["line","dashLine","midPoint","point","text"]}},{key:"bindPointRenderEvent",value:function(){var e;Ve(Be(r.prototype),"bindPointRenderEvent",this).call(this),null===(e=this.pointRender)||void 0===e||e.on(t.RenderEvent.Contextmenu,this.onPointContextMenu.bind(this))}},{key:"onPointClick",value:function(t){var e,n=this,r=this.drawLine,i=null!==(e=null==r?void 0:r.properties.nodes)&&void 0!==e?e:[],o=t.feature;if(Tu(o,tc(i)))requestAnimationFrame((function(){n.drawLineFinish()}));else{var a=Ge(o.geometry.coordinates,2);t.lngLat={lng:a[0],lat:a[1]},this.onPointCreate(t)}}},{key:"removeNode",value:function(e,n){var r,i=this.getTargetFeature(n),o=this.getTargetFeature(e,null!==(r=null==i?void 0:i.properties.nodes)&&void 0!==r?r:[]);if(i&&o){var a,s=null!==(a=null==i?void 0:i.properties.nodes)&&void 0!==a?a:[];if(3>s.length)return;this.syncLineNodes(i,s.filter((function(t){return!Tu(o,t)}))),this.emit(t.DrawEvent.RemoveNode,o,i,this.getLineData()),this.emit(t.DrawEvent.Edit,i,this.getLineData())}}},{key:"onPointContextMenu",value:function(t){var e,n=this.editLine,r=t.feature,i=null!==(e=null==n?void 0:n.properties.nodes)&&void 0!==e?e:[];if(n&&i.length>=3)return this.removeNode(r,n),this.scene.setMapStatus({dragEnable:!0}),r}},{key:"onPointCreate",value:function(e){if(this.addable){var n=Ve(Be(r.prototype),"onPointCreate",this).call(this,e);return n&&(this.setHelper("drawFinish"),this.emit(t.DrawEvent.AddNode,n,this.drawLine,this.getLineData())),n}}},{key:"onPointDragEnd",value:function(e){var n=this.editLine,i=Ve(Be(r.prototype),"onPointDragEnd",this).call(this,e);return n&&i&&this.emit(t.DrawEvent.Edit,n,this.getLineData()),i}},{key:"onLineDragStart",value:function(e){var n=Ve(Be(r.prototype),"onLineDragStart",this).call(this,e);return n&&this.emit(t.DrawEvent.DragStart,n,this.getLineData()),n}},{key:"onLineDragging",value:function(e){var n=Ve(Be(r.prototype),"onLineDragging",this).call(this,e);return n&&this.emit(t.DrawEvent.Dragging,n,this.getLineData()),n}},{key:"onLineDragEnd",value:function(e){var n=Ve(Be(r.prototype),"onLineDragEnd",this).call(this,e);return n&&(this.emit(t.DrawEvent.DragEnd,n,this.getLineData()),this.emit(t.DrawEvent.Edit,n,this.getLineData())),n}},{key:"onMidPointClick",value:function(e){var n=this.editLine,i=Ve(Be(r.prototype),"onMidPointClick",this).call(this,e);return n&&i&&(this.emit(t.DrawEvent.Edit,n,this.getLineData()),this.emit(t.DrawEvent.AddNode,i,n,this.getLineData())),i}},{key:"onSceneMouseMove",value:function(t){var e=this.drawLine;if(e){var n,r=tc(e.properties.nodes),i=Uu(t);this.options.adsorbOptions&&(i=null!==(n=this.getAdsorbPosition(i))&&void 0!==n?n:i),this.setDashLineData([Lu([i,r.geometry.coordinates])]),this.setTextData(this.getAllTexts())}}},{key:"setActiveFeature",value:function(t){var e=this.getTargetFeature(t);e?this.setActiveLine(e):this.clearActiveLine()}},{key:"resetFeatures",value:function(){var t=this.getLineData();this.drawLine&&(t=t.filter((function(t){return!t.properties.isDraw})),this.source.setData({point:[],dashLine:[],midPoint:[]}),this.setTextData((function(t){return t.filter((function(t){return!t.properties.isActive}))}))),this.editLine&&this.handleLineUnClick(this.editLine),this.setLineData(t.map((function(t){return t.properties=Le(Le({},t.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),t})))}},{key:"enablePointRenderAction",value:function(){var t;Ve(Be(r.prototype),"enablePointRenderAction",this).call(this),this.options.editable&&(null===(t=this.pointRender)||void 0===t||t.enableContextMenu())}},{key:"disablePointRenderAction",value:function(){var t;Ve(Be(r.prototype),"disablePointRenderAction",this).call(this),null===(t=this.pointRender)||void 0===t||t.disableContextMenu()}},{key:"bindEnableEvent",value:function(){Ve(Be(r.prototype),"bindEnableEvent",this).call(this),this.enableSceneRenderAction(),this.enablePointRenderAction(),this.enableLineRenderAction(),this.enableMidPointRenderAction(),this.sceneRender.enableDblClick()}},{key:"unbindEnableEvent",value:function(){Ve(Be(r.prototype),"unbindEnableEvent",this).call(this),this.disableSceneRenderAction(),this.disablePointRenderAction(),this.disableLineRenderAction(),this.disableMidPointRenderAction(),this.sceneRender.disableDblClick()}},{key:"bindThis",value:function(){Ve(Be(r.prototype),"bindThis",this).call(this),this.bindPointRenderEvent=this.bindPointRenderEvent.bind(this),this.bindSceneEvent=this.bindSceneEvent.bind(this),this.bindLineRenderEvent=this.bindLineRenderEvent.bind(this),this.bindMidPointRenderEvent=this.bindMidPointRenderEvent.bind(this)}}]),r}(lc),vc=function(e){Fe(r,e);var n=Ze(r);function r(t,e){var i;return Oe(this,r),(i=n.call(this,t,e)).bindPointRenderEvent(),i}return Ne(r,[{key:"dragItem",get:function(){return this.dragPoint}},{key:"editItem",get:function(){return this.editPoint}},{key:"getDefaultOptions",value:function(t){var e=Le(Le({},this.getCommonOptions(t)),{},{helper:Ts(rc),initialData:t.initialData});return e.style.point=Bi,e}},{key:"bindEnableEvent",value:function(){Ve(Be(r.prototype),"bindEnableEvent",this).call(this),this.enablePointRenderAction()}},{key:"unbindEnableEvent",value:function(){Ve(Be(r.prototype),"unbindEnableEvent",this).call(this),this.disablePointRenderAction()}},{key:"getRenderTypes",value:function(){return["point"]}},{key:"getMainLayer",value:function(){var t,e;return null!==(t=null===(e=this.render.point)||void 0===e?void 0:e.getLayers())&&void 0!==t?t:[]}},{key:"setData",value:function(t){this.setPointData(t.map((function(t){var e;return t.properties=Le(Le({},ku()),null!==(e=t.properties)&&void 0!==e?e:{}),t})))}},{key:"getData",value:function(){return this.getPointData()}},{key:"onPointCreate",value:function(e){if(this.addable){var n=Ve(Be(r.prototype),"onPointCreate",this).call(this,e);if(n)return this.options.editable&&this.setHelper("pointHover"),this.emit(t.DrawEvent.Add,n,this.getData()),n}else this.setPointData((function(t){return t.map((function(t){return t.properties=Le(Le({},t.properties),{},{isHover:!1,isActive:!1}),t}))}))}},{key:"onPointMouseMove",value:function(t){var e=Ve(Be(r.prototype),"onPointMouseMove",this).call(this,t);return this.options.editable&&!this.dragPoint&&this.setHelper("pointHover"),e}},{key:"onPointMouseOut",value:function(t){var e=Ve(Be(r.prototype),"onPointMouseOut",this).call(this,t);return this.setHelper(this.addable?"draw":null),e}},{key:"onPointDragStart",value:function(e){var n=Ve(Be(r.prototype),"onPointDragStart",this).call(this,e);return this.setHelper("pointDrag"),this.emit(t.DrawEvent.DragStart,n,this.getData()),n}},{key:"onPointDragging",value:function(e){var n=Ve(Be(r.prototype),"onPointDragging",this).call(this,e);return n&&this.options.editable&&this.emit(t.DrawEvent.Dragging,n,this.getData()),n}},{key:"onPointDragEnd",value:function(e){var n=Ve(Be(r.prototype),"onPointDragEnd",this).call(this,e);return n&&this.options.editable&&(this.setHelper("pointHover"),this.emit(t.DrawEvent.DragEnd,n,this.getData()),this.emit(t.DrawEvent.Edit,n,this.getData())),n}},{key:"bindThis",value:function(){Ve(Be(r.prototype),"bindThis",this).call(this),this.bindPointRenderEvent=this.bindPointRenderEvent.bind(this)}},{key:"onSceneMouseMove",value:function(t){}},{key:"setActiveFeature",value:function(t){var e=this.getTargetFeature(t);this.setPointData((function(t){return t.map((function(t){return t.properties.isActive=Tu(e,t),t}))}))}},{key:"resetFeatures",value:function(){this.setPointData((function(t){return t.map((function(t){return t.properties=Le(Le({},t.properties),{},{isDrag:!1,isActive:!1,isHover:!1}),t}))}))}}]),r}(ec),mc=function(e){Fe(r,e);var n=Ze(r);function r(e,i){var o;return Oe(this,r),(o=n.call(this,e,i)).drawPolygonFinish=function(){var e,n=o.drawPolygon,r=null!==(e=null==n?void 0:n.properties.nodes)&&void 0!==e?e:[];if(n&&r.length>=3){n.properties.isDraw=!1,o.syncPolygonNodes(n,r),o.setActivePolygon(n);var i=o.options,a=i.autoActive,s=i.editable;a&&s||o.handlePolygonUnClick(n),o.setHelper(s?a?"pointHover":"polygonHover":o.addable?"draw":null),o.emit(t.DrawEvent.Add,n,o.getPolygonData())}},o.sceneRender.on(t.RenderEvent.DblClick,o.drawPolygonFinish),o.bindPointRenderEvent(),o.bindSceneEvent(),o.bindMidPointRenderEvent(),o.bindLineRenderEvent(),o.bindPolygonRenderEvent(),o}return Ne(r,[{key:"getDefaultOptions",value:function(t){return Le(Le({},Ve(Be(r.prototype),"getDefaultOptions",this).call(this,t)),{},{liveUpdate:!1})}},{key:"setData",value:function(t){var e=t.map((function(t){var e,n;if(t.properties=Le(Le({},Pu()),null!==(e=t.properties)&&void 0!==e?e:{}),!(null===(n=t.properties.nodes)||void 0===n?void 0:n.length)){var r=gn(t);r=r.slice(0,r.length-1),t.properties.nodes=r.map((function(t){return Iu(t)}))}if(!t.properties.line){var i=t.properties.nodes;t.properties.line=Ru([].concat(He(i),[Iu(Su(i).geometry.coordinates)]))}return t}));this.source.setData({point:[],midPoint:[],dashLine:[],polygon:e,line:e.map((function(t){return t.properties.line}))}),this.setTextData(this.getAllTexts()),this.editPolygon&&this.setActivePolygon(this.editPolygon)}},{key:"onPointCreate",value:function(e){if(this.addable&&!this.dragPoint){var n=Ve(Be(r.prototype),"onPointCreate",this).call(this,e),i=this.drawPolygon,o=this.drawLine;return n&&(i?(this.syncPolygonNodes(i,[].concat(He(i.properties.nodes),[n])),this.setDashLineData([Lu([Uu(e),i.properties.nodes[0].geometry.coordinates])]),i.properties.nodes.length>1&&this.setHelper("drawFinish")):o&&(this.handleCreatePolygon([n],o),this.setHelper("drawContinue")),this.emit(t.DrawEvent.AddNode,n,i,this.getPolygonData())),n}}},{key:"onPointClick",value:function(t){var e=this,n=this.drawPolygon,r=t.feature;if(n){var i=n.properties.nodes;if(i.length<3||!Tu(Su(i),r)&&!Tu(tc(i),r)){var o=Ge(r.geometry.coordinates,2);t.lngLat={lng:o[0],lat:o[1]},this.onPointCreate(t)}else requestAnimationFrame((function(){e.drawPolygonFinish()}))}}},{key:"onPointDragging",value:function(t){var e=this.dragPoint,n=this.editPolygon;if(e&&n){var i=n.properties.line;i.properties.nodes=i.properties.nodes.map((function(t){return Tu(t,e)?e:t}));var o=i.properties.nodes,a=o.slice(0,o.length-1),s=Su(o),u=tc(o),c=Tu(s,e)||Tu(u,e);if(c&&(s.geometry.coordinates=u.geometry.coordinates=Uu(t)),this.options.adsorbOptions&&c){var l=this.resetAdsorbLngLat(t);l&&(s.geometry.coordinates=u.geometry.coordinates=l)}Ve(Be(r.prototype),"onPointDragging",this).call(this,t),this.syncPolygonNodes(n,a),this.setActivePolygon(n)}return e}},{key:"onLineDragging",value:function(e){var n=this.dragPolygon,i=Ve(Be(r.prototype),"onLineDragging",this).call(this,e);if(i&&n){var o=i.properties.nodes;this.syncPolygonNodes(n,o.slice(0,o.length-1)),this.emit(t.DrawEvent.Dragging,n,this.getPolygonData())}return i}},{key:"onMidPointClick",value:function(e){var n=Ve(Be(r.prototype),"onMidPointClick",this).call(this,e),i=this.editPolygon;return n&&i&&(this.emit(t.DrawEvent.Edit,i,this.getPolygonData()),this.emit(t.DrawEvent.AddNode,n,i,this.getPolygonData())),n}},{key:"onSceneMouseMove",value:function(t){var e,n=this.drawPolygon,r=null!==(e=null==n?void 0:n.properties.nodes)&&void 0!==e?e:[];if(n&&r.length){this.options.adsorbOptions&&this.resetAdsorbLngLat(t);var i=Uu(t),o=[];if(o.push(Lu([i,Su(r).geometry.coordinates])),r.length>1&&o.push(Lu([i,tc(r).geometry.coordinates])),this.options.liveUpdate&&r.length>=2){var a=gn(nn(r));n.geometry.coordinates=[[].concat(He(a),[i,a[0]])],this.setPolygonData(this.getPolygonData())}this.setDashLineData(o),this.setTextData(this.getAllTexts())}}},{key:"removeNode",value:function(e,n){var r,i=this.getTargetFeature(n),o=this.getTargetFeature(e,null!==(r=null==i?void 0:i.properties.nodes)&&void 0!==r?r:[]);if(i&&o){var a,s=null!==(a=null==i?void 0:i.properties.nodes)&&void 0!==a?a:[];if(4>s.length)return;this.syncPolygonNodes(i,s.filter((function(t){return!Tu(o,t)}))),this.emit(t.DrawEvent.RemoveNode,o,i,this.getLineData()),this.emit(t.DrawEvent.Edit,i,this.getPolygonData())}}},{key:"onPointContextMenu",value:function(t){var e,n=this.editPolygon,r=t.feature,i=null!==(e=null==n?void 0:n.properties.nodes)&&void 0!==e?e:[];if(n&&i.length>=4)return i.find((function(t){return Tu(t,r)}))||(r=i[0]),this.removeNode(r,n),r}},{key:"bindPointRenderEvent",value:function(){var e;Ve(Be(r.prototype),"bindPointRenderEvent",this).call(this),null===(e=this.pointRender)||void 0===e||e.on(t.RenderEvent.Contextmenu,this.onPointContextMenu.bind(this))}},{key:"enablePointRenderAction",value:function(){var t;Ve(Be(r.prototype),"enablePointRenderAction",this).call(this),this.options.editable&&(null===(t=this.pointRender)||void 0===t||t.enableContextMenu())}},{key:"disablePointRenderAction",value:function(){var t;Ve(Be(r.prototype),"disablePointRenderAction",this).call(this),null===(t=this.pointRender)||void 0===t||t.disableContextMenu()}}]),r}(hc),gc=function(e){Fe(r,e);var n=Ze(r);function r(t,e){var i;return Oe(this,r),(i=n.call(this,t,e)).bindPointRenderEvent(),i.bindSceneEvent(),i.bindMidPointRenderEvent(),i.bindLineRenderEvent(),i.bindPolygonRenderEvent(),i}return Ne(r,[{key:"getDefaultOptions",value:function(t){var e=Ve(Be(r.prototype),"getDefaultOptions",this).call(this,t);return e.helper&&(e.helper=Le(Le({},e.helper),uc)),e}},{key:"setData",value:function(t){var e=this,n=t.map((function(t){var n,r,i;t.properties=Le(Le({},Pu()),null!==(n=t.properties)&&void 0!==n?n:{});var o=t.properties.nodes;if(2!==(null===(r=o)||void 0===r?void 0:r.length)){var a=Ge(An(t),4),s=a[2],u=a[3];o=[Iu([a[0],a[1]]),Iu([s,u])],t.properties.nodes=o}var c=Ge(o,2),l=c[0],h=c[1],f=!!(null===(i=t.properties)||void 0===i?void 0:i.isActive),p=t.properties.line;return p||(p=e.handleCreatePolygonLine(l,h,{isActive:f}),t.properties.line=p),e.handleCreatePolygon([l,h],p,Le(Le({},t.properties),{},{isActive:f}))}));this.source.setData({point:[],midPoint:[],dashLine:[],polygon:n,line:n.map((function(t){return t.properties.line}))}),this.setTextData(this.getAllTexts()),this.editPolygon&&this.setActivePolygon(this.editPolygon)}},{key:"handleCreatePolygonLine",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=gn(Er(nn([t,e]))).map((function(n,r){return 0===r?t:2===r?e:Iu(n)}));return Ru(r,n)}},{key:"syncPolygonNodes",value:function(t,e){var n=t.properties.line,r=gn(Er(nn(e)));t.properties.nodes=e,t.geometry.coordinates=[r],this.setPolygonData((function(e){return e.map((function(e){return Tu(e,t)?t:e}))})),this.setPointData(t.properties.isDraw?[e[0]]:e);var i=n.properties.nodes,o=r.filter((function(t){return!Xs(t,e[0].geometry.coordinates)&&!Xs(t,e[1].geometry.coordinates)}));return i.forEach((function(t,n){var r=[0,0];switch(n){case 0:r=e[0].geometry.coordinates;break;case 1:r=o[0];break;case 2:r=e[1].geometry.coordinates;break;case 3:r=o[1];break;case 4:r=Ts(e[0].geometry.coordinates)}t.geometry.coordinates=r})),n.geometry.coordinates=r,t}},{key:"onLineDragging",value:function(e){var n=Ve(Be(r.prototype),"onLineDragging",this).call(this,e),i=this.dragPolygon;if(n&&i){var o=i.properties.line.properties.nodes;this.syncPolygonNodes(i,[o[0],o[2]]),this.setActivePolygon(i,{isDrag:!0}),this.emit(t.DrawEvent.Dragging,i,this.getPolygonData())}return n}}]),r}(fc),yc=function(t,e){for(var n=t;n&&!Array.from(n.classList).includes(e);)n=n.parentElement;return n},_c={point:"#l7draw-point",line:"#l7draw-line",polygon:"#l7draw-polygon",rect:"#l7draw-rect",circle:"#l7draw-circle",clear:"#l7draw-qingkong"},xc={point:vc,line:dc,polygon:mc,rect:gc,circle:pc},bc="data-draw-type",wc="l7-draw-control",Ec="".concat(wc,"__btn"),Sc="".concat(Ec,"--active");!function(t){var e,n,r,i,o,a='<svg><symbol id="l7draw-qingkong" viewBox="0 0 1024 1024"><path d="M778.96777344 334.02148437h-148.31542969V284.58300781A71.78466797 71.78466797 0 0 0 556.49462891 215.36914062H467.50537109a71.78466797 71.78466797 0 0 0-74.15771484 69.11499024V334.02148437h-148.31542969a29.66308594 29.66308594 0 1 0 0 59.32617188h29.66308594v326.29394531A88.98925781 88.98925781 0 0 0 363.68457031 808.63085938h296.63085938a88.98925781 88.98925781 0 0 0 88.98925781-88.98925782V393.34765625h29.66308594a29.66308594 29.66308594 0 0 0 0-59.32617188zM452.67382812 284.58300781c0-4.74609375 6.22924805-9.78881836 14.83154297-9.78881836h88.98925782c8.60229492 0 14.83154297 5.04272461 14.83154296 9.78881836V334.02148437H452.67382812V284.53356934z m237.30468751 435.10803223a29.66308594 29.66308594 0 0 1-29.66308594 29.66308593H363.68457031a29.66308594 29.66308594 0 0 1-29.66308593-29.66308594V393.34765625h355.95703124v326.29394531z"  ></path><path d="M437.84228516 660.31542969c6.57531739 0 12.85400391-3.46069336 17.5012207-9.64050294A39.20471192 39.20471192 0 0 0 462.56152344 627.33996582V495.5369873a39.20471192 39.20471192 0 0 0-7.21801758-23.33496093A22.09899903 22.09899903 0 0 0 437.84228516 462.56152344c-6.57531739 0-12.85400391 3.46069336-17.50122071 9.64050293A39.20471192 39.20471192 0 0 0 413.12304687 495.5369873v131.80297853c0 8.75061036 2.62023926 17.15515137 7.21801758 23.33496092 4.6472168 6.17980958 10.92590333 9.64050293 17.50122071 9.64050294zM586.15771484 660.31542969c6.57531739 0 12.85400391-3.46069336 17.50122071-9.64050294a39.20471192 39.20471192 0 0 0 7.21801758-23.33496093V495.5369873a39.20471192 39.20471192 0 0 0-7.21801758-23.33496093A22.09899903 22.09899903 0 0 0 586.15771484 462.56152344c-6.57531739 0-12.85400391 3.46069336-17.5012207 9.64050293A39.20471192 39.20471192 0 0 0 561.43847656 495.5369873v131.80297853c0 8.75061036 2.62023926 17.15515137 7.21801758 23.33496092 4.6472168 6.17980958 10.92590333 9.64050293 17.5012207 9.64050294z"  ></path></symbol><symbol id="l7draw-rect" viewBox="0 0 1024 1024"><path d="M736.14 648.79V330c0-23.16-18.84-42-42-42H375.49c-11.07-19.13-31.74-32.01-55.43-32.01-35.35 0-64.01 28.66-64.01 64.01 0 23.69 12.88 44.36 32.01 55.43v318.8c0 23.16 18.84 42 42 42H648.7c11.07 19.13 31.74 32.01 55.43 32.01 35.35 0 64.01-28.66 64.01-64.01 0.01-23.7-12.87-44.37-32-55.44zM352.06 375.43A64.281 64.281 0 0 0 375.49 352h296.64v296.8a64.357 64.357 0 0 0-23.43 23.43H352.06v-296.8z"  ></path></symbol><symbol id="l7draw-circle" viewBox="0 0 1024 1024"><path d="M467.013228 557.765038a64.01 64.01 0 1 0 90.52223-90.52539 64.01 64.01 0 1 0-90.52223 90.52539Z"  ></path><path d="M832.16 512.22c0-26.06-15.58-48.46-37.93-58.45-11.21-54.67-38.11-104.92-78.48-145.3-54.42-54.42-126.78-84.4-203.75-84.4s-149.33 29.97-203.75 84.4c-54.42 54.42-84.4 126.79-84.4 203.75s29.97 149.33 84.4 203.75c54.42 54.42 126.78 84.4 203.75 84.4s149.33-29.97 203.75-84.4c40.37-40.37 67.28-90.62 78.48-145.3 22.35-9.98 37.93-32.39 37.93-58.45zM670.5 670.72c-42.34 42.34-98.62 65.65-158.5 65.65-59.87 0-116.16-23.32-158.5-65.65-42.34-42.34-65.65-98.62-65.65-158.5s23.32-116.16 65.65-158.5c42.34-42.34 98.62-65.65 158.5-65.65 59.87 0 116.16 23.32 158.5 65.65 29.9 29.9 50.3 66.77 59.71 106.95-15.81 11.66-26.07 30.4-26.07 51.55s10.26 39.9 26.07 51.55c-9.41 40.18-29.81 77.05-59.71 106.95z"  ></path></symbol><symbol id="l7draw-polygon" viewBox="0 0 1024 1024"><path d="M705.97 640.31c-5.79 0-11.39 0.78-16.72 2.22L381.94 336.66a64.079 64.079 0 0 0 2.14-16.43c0-35.35-28.66-64.01-64.01-64.01s-64.01 28.66-64.01 64.01c0 23.69 12.88 44.36 32.01 55.43V648.8c-19.13 11.07-32.01 31.74-32.01 55.43 0 35.35 28.66 64.01 64.01 64.01 23.69 0 44.35-12.87 55.42-32l275.05 0.07c11.07 19.14 31.74 32.03 55.44 32.03 35.35 0 64.01-28.66 64.01-64.01s-28.66-64.02-64.02-64.02z m-353.91 8.48V397.22L628.44 672.3l-252.94-0.07a64.411 64.411 0 0 0-23.44-23.44z"  ></path></symbol><symbol id="l7draw-line" viewBox="0 0 1024 1024"><path d="M832.16 449.21c0-35.35-28.66-64.01-64.01-64.01-29.2 0-53.81 19.56-61.5 46.28l-390.9 96.82 72.18-144.18c33.56-1.99 60.17-29.83 60.17-63.89 0-35.35-28.66-64.01-64.01-64.01s-64.01 28.66-64.01 64.01c0 13.04 3.91 25.17 10.61 35.28l-78.42 156.65c-33.58 1.97-60.21 29.81-60.21 63.89 0 35.35 28.66 64.01 64.01 64.01 29.2 0 53.81-19.56 61.5-46.28l390.8-96.79-71.97 143.34c-33.62 1.93-60.28 29.8-60.28 63.9 0 35.35 28.66 64.01 64.01 64.01s64.01-28.66 64.01-64.01c0-13-3.89-25.09-10.54-35.18l78.28-155.93c33.61-1.95 60.28-29.81 60.28-63.91z"  ></path></symbol><symbol id="l7draw-point" viewBox="0 0 1024 1024"><path d="M331.46 330.08m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path><path d="M384.12 735.84m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path><path d="M769.11 512.7m-64.01 0a64.01 64.01 0 1 0 128.02 0 64.01 64.01 0 1 0-128.02 0Z"  ></path></symbol></svg>',s=(s=document.getElementsByTagName("script"))[s.length-1].getAttribute("data-injectcss");if(s&&!t.__iconfont__svg__cssinject__){t.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(t){console}}function u(){o||(o=!0,r())}e=function(){var t,e=document.createElement("div");e.innerHTML=a,a=null,(e=e.getElementsByTagName("svg")[0])&&(e.setAttribute("aria-hidden","true"),e.style.position="absolute",e.style.width=0,e.style.height=0,e.style.overflow="hidden",(t=document.body).firstChild?function(t,e){e.parentNode.insertBefore(t,e)}(e,t.firstChild):t.appendChild(e))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(e,0):(n=function(){document.removeEventListener("DOMContentLoaded",n,!1),e()},document.addEventListener("DOMContentLoaded",n,!1)):document.attachEvent&&(r=e,i=t.document,o=!1,function t(){try{i.documentElement.doScroll("left")}catch(e){return void setTimeout(t,50)}u()}(),i.onreadystatechange=function(){"complete"==i.readyState&&(i.onreadystatechange=null,u())})}(window),Yu(".l7-draw-control{display:flex;overflow:hidden;background:#fff;border-radius:2px}.l7-draw-control__btn{display:inline-flex;align-items:center;justify-content:center;width:30px;height:30px;padding:0;text-align:center;background:transparent;border-width:0;border-right:1px solid #e0e0e0;outline:0;cursor:pointer}.l7-draw-control__btn:hover{background-color:#e5e5e5}.l7-draw-control__btn:last-child{border-bottom:0}.l7-draw-control__btn .l7-draw-icon{width:26px;height:26px;overflow:hidden;fill:currentColor}.l7-draw-control__btn--active svg{color:#0370fe}");var Ac=function(n){Fe(i,n);var r=Ze(i);function i(e){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Oe(this,i),(n=r.call(this,o)).controlOption=void 0,n.sceneInstance=void 0,n.drawMap={},n.btnMap={},n.activeType=null,n.emitDataChange=Ai((function(){n.emit(t.ControlEvent.DataChange,n.getDrawData())}),16),n.sceneInstance=e,n.controlOption=Le(Le({},n.getDefault()),o||{}),n.onBtnClick=n.onBtnClick.bind(je(n)),n}return Ne(i,[{key:"getActiveType",value:function(){return this.activeType}},{key:"getDefault",value:function(){return Le(Le({},Ve(Be(i.prototype),"getDefault",this).call(this)),{},{className:"",buttonClassName:"",activeButtonClassName:"",style:"",position:"topleft",commonDrawOptions:{},drawConfig:{point:!0,line:!0,polygon:!0,rect:!0,circle:!0,clear:!0}})}},{key:"addTo",value:function(t){return Ve(Be(i.prototype),"addTo",this).call(this,t),this.init(),this}},{key:"onAdd",value:function(){var t=this.controlOption,n=t.className,r=t.style,i=e.DOM.create("div","".concat(wc," ").concat(n));return r&&i.setAttribute("style",r),i}},{key:"onRemove",value:function(){Object.values(this.drawMap).forEach((function(t){t.clear(!0)}))}},{key:"init",value:function(){var e,n=this,r=[];Object.entries(this.controlOption.drawConfig).forEach((function(e){var i=Ge(e,2),o=i[0],a=i[1];if(a){var s=n.initBtn(o);s.addEventListener("click",n.onBtnClick),r.push(s),n.btnMap[o]=s;var u=xc[o];if(u&&n.sceneInstance){var c=new u(n.sceneInstance,Le(Le({},n.controlOption.commonDrawOptions),"boolean"==typeof a?{}:a));c.on(t.DrawEvent.Change,n.emitDataChange),n.drawMap[o]=c}}})),(e=this.container).append.apply(e,r),this.controlOption.defaultActiveType&&this.onDrawClick(this.controlOption.defaultActiveType)}},{key:"getDrawData",value:function(){return Cs(wu(this.drawMap).map((function(t){var e=Ge(t,2);return[e[0],e[1].getData()]})))}},{key:"getTypeDraw",value:function(t){var e;return null!==(e=this.drawMap[t])&&void 0!==e?e:null}},{key:"onBtnClick",value:function(t){var e=yc(t.target,Ec);if(e){var n=e.getAttribute(bc);"clear"===n?this.clearDrawData():this.onDrawClick(n)}}},{key:"setActiveType",value:function(n){var r=null,i=this.activeType;if(i){var o,a=this.btnMap[i];if(a){e.DOM.removeClass(a,Sc);var s=this.controlOption.activeButtonClassName;s&&e.DOM.removeClass(a,s)}null===(o=this.drawMap[i])||void 0===o||o.disable(),r=null}if(i!==n&&n){var u;null===(u=this.drawMap[n])||void 0===u||u.enable();var c=this.btnMap[n];c&&e.DOM.addClass(c,"".concat(Sc," ").concat(this.controlOption.activeButtonClassName)),r=n}this.activeType=r,this.emit(t.ControlEvent.DrawChange,r)}},{key:"onDrawClick",value:function(t){this.setActiveType(t)}},{key:"clearDrawData",value:function(){Object.values(this.drawMap).forEach((function(t){null==t||t.clear()}))}},{key:"initBtn",value:function(t){var n=e.DOM.create("button","".concat(Ec," ").concat(this.controlOption.buttonClassName));return n.innerHTML='<svg class="l7-draw-icon" aria-hidden="true">\n      <use xlink:href="'.concat(_c[t],'"></use>\n    </svg>'),n.setAttribute(bc,t),n}}]),i}(e.Control);t.ACTIVE_COLOR=Oi,t.BaseMode=$u,t.CircleDrawer=pc,t.DEFAULT_ADSORB_CONFIG=Ie,t.DEFAULT_AREA_OPTIONS=Ce,t.DEFAULT_COMMON_OPTIONS=Di,t.DEFAULT_CURSOR_MAP=r,t.DEFAULT_DISTANCE_OPTIONS=Te,t.DEFAULT_HISTORY_CONFIG=ke,t.DEFAULT_KEYBOARD_CONFIG=Me,t.DEFAULT_MID_POINT_STYLE=Fi,t.DEFAULT_NODE_NORMAL_STYLE=zi,t.DEFAULT_NODE_STYLE=Ui,t.DEFAULT_POINT_NORMAL_STYLE=Ni,t.DEFAULT_POINT_STYLE=Bi,t.DEFAULT_POPUP_CONFIG=Pe,t.DEFAULT_SOURCE_DATA=i,t.DEFAULT_STYLE=Zi,t.DEFAULT_TEXT_NORMAL_STYLE=ji,t.DashLineRender=Kr,t.DragPolygonMode=fc,t.DrawCircle=pc,t.DrawControl=Ac,t.DrawLine=dc,t.DrawPoint=vc,t.DrawPolygon=mc,t.DrawRect=gc,t.LayerRender=Yr,t.LineDrawer=dc,t.LineMode=lc,t.LineRender=Ti,t.MidPointMode=nc,t.MidPointRender=Ci,t.NORMAL_COLOR=Li,t.PointDrawer=vc,t.PointMode=ec,t.PointRender=ki,t.PolygonDrawer=mc,t.PolygonMode=hc,t.PolygonRender=Mi,t.RENDER_MAP=Ri,t.RectDrawer=gc,t.SceneRender=Pi,t.Source=Ju,t.TextRender=Ii,t.calcAreaText=zu,t.calcDistanceTextsByLine=Nu,t.createDashLine=Lu,t.createLineFeature=Ru,t.createPointFeature=Iu,t.createPolygonFeature=Ou,t.findMinIndex=Zu,t.getAdsorbFeature=Gu,t.getAdsorbLine=Wu,t.getAdsorbPoint=Hu,t.getDefaultLineProperties=Mu,t.getDefaultPointProperties=ku,t.getDefaultPolygonProperties=Pu,t.getLineCenterPoint=Du,t.getLngLat=Bu,t.getMapDom=Fu,t.getParentByClassName=yc,t.getPosition=Uu,t.getSingleColorStyle=function(t){return{point:{normal:{color:t},hover:{color:t},active:{color:t}},line:{normal:{color:t},hover:{color:t},active:{color:t}},polygon:{normal:{color:t},hover:{color:t},active:{color:t},style:{opacity:.2}},text:{normal:{color:t},active:{color:t}},midPoint:{normal:{color:t}},dashLine:{normal:{color:t}}}},t.getUuid=Au,t.isDev=!1,t.isSameFeature=Tu,t.resetEventLngLat=qu,t.splitByPosition=Vu,t.transLngLat2Position=ju,t.updateTargetFeature=Cu,Object.defineProperty(t,"__esModule",{value:!0})}))},5868:function(t,e,n){"use strict";n.r(e),n.d(e,{$XMLHttpRequest:function(){return br},$location:function(){return wr},$window:function(){return xr},AJAXError:function(){return Ar},AttributeType:function(){return Ug},BKDRHash:function(){return Jo},BaseLayer:function(){return Dx},BaseMapService:function(){return ej},BaseMapWrapper:function(){return LD},BaseModel:function(){return Bx},BasePostProcessingPass:function(){return Zv},BlendType:function(){return _h},ButtonControl:function(){return r_},CameraUniform:function(){return jg},CanvasLayer:function(){return Jx},CanvasUpdateType:function(){return Gx},CityBuildingLayer:function(){return $w},Control:function(){return t_},CoordinateSystem:function(){return Uh},CoordinateUniform:function(){return Jh},DOM:function(){return r},Earth:function(){return pj},EarthLayer:function(){return mk},ExportImage:function(){return y_},FrequencyController:function(){return yo},Fullscreen:function(){return M_},GaodeMap:function(){return gz},GaodeMapV1:function(){return iz},GaodeMapV2:function(){return gz},GeoLocate:function(){return R_},GeometryLayer:function(){return xE},HeatmapLayer:function(){return JE},IDebugLog:function(){return Zg},ILayerStage:function(){return wh},ImageLayer:function(){return uS},InteractionEvent:function(){return rf},LRUCache:function(){return ya},LayerPopup:function(){return ox},LayerSwitch:function(){return D_},LineLayer:function(){return bA},LineTriangulation:function(){return Cu},LinearDir:function(){return jx},LoadTileDataStatus:function(){return Ra},Logo:function(){return F_},Map:function(){return Sj},MapServiceEvent:function(){return Gg},MapTheme:function(){return V_},Mapbox:function(){return tZ},Marker:function(){return Xy},MarkerLayer:function(){return Qy},MaskLayer:function(){return Tk},MaskOperation:function(){return bh},MouseLocation:function(){return W_},PassType:function(){return qd},PointFillTriangulation:function(){return ku},PointLayer:function(){return XT},PolygonLayer:function(){return AC},PopperControl:function(){return l_},Popup:function(){return ex},PositionType:function(){return ah},RasterLayer:function(){return qC},RasterTileType:function(){return Vg},Satistics:function(){return i},Scale:function(){return Y_},ScaleTypes:function(){return Fg},Scene:function(){return kZ},SceneEventList:function(){return Hg},SelectControl:function(){return d_},SizeUnitType:function(){return Vx},Source:function(){return Hy},SourceTile:function(){return $a},StencilType:function(){return xh},StyleScaleType:function(){return Bg},TYPES:function(){return wc},TextureBlend:function(){return Zx},TileDebugLayer:function(){return KC},TilesetManager:function(){return us},UpdateTileStrategy:function(){return Ia},Version:function(){return ux},Viewport:function(){return yN},WindLayer:function(){return uM},WorkerSourceMap:function(){return Lu},Zoom:function(){return J_},aProjectFlat:function(){return Lo},amap2Project:function(){return Do},amap2UnProject:function(){return No},anchorTranslate:function(){return Br},anchorType:function(){return Fr},applyAnchorClass:function(){return Ur},bBoxToBounds:function(){return jo},bindAll:function(){return go},boundsContains:function(){return Uo},calAngle:function(){return Wo},calDistance:function(){return Vo},calculateCentroid:function(){return Yo},calculatePointsCenterAndRadius:function(){return Ko},container:function(){return Ag},createLayerContainer:function(){return kg},createSceneContainer:function(){return Cg},decodePickingColor:function(){return wi},dispatchMapCameraParams:function(){return pr},dispatchMouseDown:function(){return Bn},dispatchMouseMove:function(){return Un},dispatchMouseUp:function(){return jn},dispatchPointerDown:function(){return er},dispatchPointerMove:function(){return nr},dispatchPointerUp:function(){return rr},dispatchTouchEnd:function(){return fr},dispatchTouchMove:function(){return hr},dispatchTouchStart:function(){return lr},djb2hash:function(){return $o},encodePickingColor:function(){return Ei},executeWorkerTask:function(){return Wu},expandUrl:function(){return ls},extent:function(){return So},flow:function(){return Xo},formatImage:function(){return zr},generateCatRamp:function(){return Ti},generateColorRamp:function(){return Si},generateCustomRamp:function(){return ki},generateLinearRamp:function(){return Ai},generateQuantizeRamp:function(){return Ci},getAngle:function(){return qo},getArrayBuffer:function(){return Pr},getBBoxFromPoints:function(){return Qo},getCullFace:function(){return Ri},getDefaultDomain:function(){return Pi},getImage:function(){return Nr},getJSON:function(){return Mr},getReferrer:function(){return ho},getTileIndices:function(){return Ya},getTileWarpXY:function(){return Ka},getURLFromTemplate:function(){return hs},getWMTSURLFromTemplate:function(){return fs},gl:function(){return vf},guid:function(){return ta},isAndroid:function(){return vo},isColor:function(){return xi},isImageBitmap:function(){return co},isMini:function(){return yr},isMiniAli:function(){return mr},isMiniScene:function(){return dr},isPC:function(){return mo},isURLTemplate:function(){return cs},isWeChatMiniProgram:function(){return gr},isWorker:function(){return lo},isiOS:function(){return po},latitude:function(){return Io},lazyInject:function(){return Eg},lazyMultiInject:function(){return Sg},lineAtOffset:function(){return va},lineAtOffsetAsyc:function(){return ma},lineStyleType:function(){return Ux},lngLatInExtent:function(){return Eo},lngLatToMeters:function(){return ko},lnglatDistance:function(){return zo},longitude:function(){return Po},makeXMLHttpRequestPromise:function(){return Cr},metersToLngLat:function(){return Mo},miniWindow:function(){return _r},normalize:function(){return Zo},osmLonLat2TileXY:function(){return Wa},osmTileXY2LonLat:function(){return qa},packCircleVertex:function(){return zg},padBounds:function(){return Bo},polygonFillTriangulation:function(){return Mu},postData:function(){return Ir},project:function(){return Fo},rgb2arr:function(){return bi},sameOrigin:function(){return Rr},setL7WorkerSource:function(){return Gu},setMiniScene:function(){return vr},tileToBounds:function(){return Xa},tranfrormCoord:function(){return To},unProjectFlat:function(){return Oo},validateLngLat:function(){return Ro},version:function(){return MZ}});var r={};n.r(r),n.d(r,{DPR:function(){return $i},addClass:function(){return ji},addStyle:function(){return to},appendElementType:function(){return uo},clearChildren:function(){return ao},create:function(){return Bi},css2Style:function(){return ro},empty:function(){return Wi},getClass:function(){return Hi},getContainer:function(){return Di},getDiffRect:function(){return io},getStyleList:function(){return eo},getViewPortScale:function(){return Qi},hasClass:function(){return Vi},printCanvas:function(){return Ki},remove:function(){return Ui},removeClass:function(){return Zi},removeStyle:function(){return no},setChecked:function(){return oo},setClass:function(){return Gi},setTransform:function(){return Xi},setUnDraggable:function(){return so},splitWords:function(){return zi},triggerResize:function(){return Yi},trim:function(){return Ni}});var i={};n.r(i),n.d(i,{getColumn:function(){return Aa},getSatByColumn:function(){return Ta},max:function(){return _a},mean:function(){return wa},min:function(){return xa},mode:function(){return Ea},statMap:function(){return Sa},sum:function(){return ba}});var o={};n.r(o),n.d(o,{add:function(){return Jl},adjoint:function(){return gl},clone:function(){return ll},copy:function(){return hl},create:function(){return cl},determinant:function(){return yl},equals:function(){return rh},exactEquals:function(){return nh},frob:function(){return Ql},fromQuat:function(){return Bl},fromQuat2:function(){return Ll},fromRotation:function(){return kl},fromRotationTranslation:function(){return Rl},fromRotationTranslationScale:function(){return zl},fromRotationTranslationScaleOrigin:function(){return Fl},fromScaling:function(){return Cl},fromTranslation:function(){return Tl},fromValues:function(){return fl},fromXRotation:function(){return Ml},fromYRotation:function(){return Pl},fromZRotation:function(){return Il},frustum:function(){return Ul},getRotation:function(){return Nl},getScaling:function(){return Dl},getTranslation:function(){return Ol},identity:function(){return dl},invert:function(){return ml},lookAt:function(){return Xl},mul:function(){return ch},multiply:function(){return _l},multiplyScalar:function(){return th},multiplyScalarAndAdd:function(){return eh},ortho:function(){return Wl},orthoNO:function(){return Hl},orthoZO:function(){return ql},perspective:function(){return Zl},perspectiveFromFieldOfView:function(){return Gl},perspectiveNO:function(){return jl},perspectiveZO:function(){return Vl},rotate:function(){return wl},rotateX:function(){return El},rotateY:function(){return Sl},rotateZ:function(){return Al},scale:function(){return bl},set:function(){return pl},str:function(){return Kl},sub:function(){return lh},subtract:function(){return $l},targetTo:function(){return Yl},translate:function(){return xl},transpose:function(){return vl}});var a={};n.r(a),n.d(a,{add:function(){return ob},angle:function(){return Ob},bezier:function(){return Tb},ceil:function(){return cb},clone:function(){return tb},copy:function(){return rb},create:function(){return $x},cross:function(){return Eb},dist:function(){return Zb},distance:function(){return mb},div:function(){return jb},divide:function(){return ub},dot:function(){return wb},equals:function(){return Fb},exactEquals:function(){return zb},floor:function(){return lb},forEach:function(){return Wb},fromValues:function(){return nb},hermite:function(){return Ab},inverse:function(){return xb},len:function(){return Gb},length:function(){return eb},lerp:function(){return Sb},max:function(){return fb},min:function(){return hb},mul:function(){return Ub},multiply:function(){return sb},negate:function(){return _b},normalize:function(){return bb},random:function(){return Cb},rotateX:function(){return Ib},rotateY:function(){return Rb},rotateZ:function(){return Lb},round:function(){return pb},scale:function(){return db},scaleAndAdd:function(){return vb},set:function(){return ib},sqrDist:function(){return Vb},sqrLen:function(){return Hb},squaredDistance:function(){return gb},squaredLength:function(){return yb},str:function(){return Nb},sub:function(){return Bb},subtract:function(){return ab},transformMat3:function(){return Mb},transformMat4:function(){return kb},transformQuat:function(){return Pb},zero:function(){return Db}});var s={},u={},c=function(t){return u[t]},l=function(t,e){u[t]=e},h=function(t){return s[t]},f=function(t,e){s[t]=e},p=(n(24603),n(74916),n(15306),{}),d={},v=34,m=10,g=13;function y(t){return new Function("d","return {"+t.map((function(t,e){return JSON.stringify(t)+": d["+e+'] || ""'})).join(",")+"}")}function _(t,e){var n=y(t);return function(r,i){return e(n(r),i,t)}}function x(t){var e=Object.create(null),n=[];return t.forEach((function(t){for(var r in t)r in e||n.push(e[r]=r)})),n}function b(t,e){var n=t+"",r=n.length;return r<e?new Array(e-r+1).join(0)+n:n}function w(t){return t<0?"-"+b(-t,6):t>9999?"+"+b(t,6):b(t,4)}function E(t){var e=t.getUTCHours(),n=t.getUTCMinutes(),r=t.getUTCSeconds(),i=t.getUTCMilliseconds();return isNaN(t)?"Invalid Date":w(t.getUTCFullYear(),4)+"-"+b(t.getUTCMonth()+1,2)+"-"+b(t.getUTCDate(),2)+(i?"T"+b(e,2)+":"+b(n,2)+":"+b(r,2)+"."+b(i,3)+"Z":r?"T"+b(e,2)+":"+b(n,2)+":"+b(r,2)+"Z":n||e?"T"+b(e,2)+":"+b(n,2)+"Z":"")}function S(t){var e=new RegExp('["'+t+"\n\r]"),n=t.charCodeAt(0);function r(t,e){var n,r,o=i(t,(function(t,i){if(n)return n(t,i-1);r=t,n=e?_(t,e):y(t)}));return o.columns=r||[],o}function i(t,e){var r,i=[],o=t.length,a=0,s=0,u=o<=0,c=!1;function l(){if(u)return d;if(c)return c=!1,p;var e,r,i=a;if(t.charCodeAt(i)===v){while(a++<o&&t.charCodeAt(a)!==v||t.charCodeAt(++a)===v);return(e=a)>=o?u=!0:(r=t.charCodeAt(a++))===m?c=!0:r===g&&(c=!0,t.charCodeAt(a)===m&&++a),t.slice(i+1,e-1).replace(/""/g,'"')}while(a<o){if((r=t.charCodeAt(e=a++))===m)c=!0;else if(r===g)c=!0,t.charCodeAt(a)===m&&++a;else if(r!==n)continue;return t.slice(i,e)}return u=!0,t.slice(i,o)}t.charCodeAt(o-1)===m&&--o,t.charCodeAt(o-1)===g&&--o;while((r=l())!==d){var h=[];while(r!==p&&r!==d)h.push(r),r=l();e&&null==(h=e(h,s++))||i.push(h)}return i}function o(e,n){return e.map((function(e){return n.map((function(t){return l(e[t])})).join(t)}))}function a(e,n){return null==n&&(n=x(e)),[n.map(l).join(t)].concat(o(e,n)).join("\n")}function s(t,e){return null==e&&(e=x(t)),o(t,e).join("\n")}function u(t){return t.map(c).join("\n")}function c(e){return e.map(l).join(t)}function l(t){return null==t?"":t instanceof Date?E(t):e.test(t+="")?'"'+t.replace(/"/g,'""')+'"':t}return{parse:r,parseRows:i,format:a,formatBody:s,formatRows:u,formatRow:c,formatValue:l}}var A=S(","),T=A.parse,C=(A.parseRows,A.format,A.formatBody,A.formatRows,A.formatRow,A.formatValue,n(23698)),k=n(86080),M=n(20535),P=n.n(M),I=n(2434),R=6371008.8,L={centimeters:100*R,centimetres:100*R,degrees:R/111325,feet:3.28084*R,inches:39.37*R,kilometers:R/1e3,kilometres:R/1e3,meters:R,metres:R,miles:R/1609.344,millimeters:1e3*R,millimetres:1e3*R,nauticalmiles:R/1852,radians:1,yards:1.0936*R};function O(t,e,n){void 0===n&&(n={});var r={type:"Feature"};return(0===n.id||n.id)&&(r.id=n.id),n.bbox&&(r.bbox=n.bbox),r.properties=e||{},r.geometry=t,r}function D(t,e,n){void 0===n&&(n={});for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var a=0;a<o[o.length-1].length;a++)if(o[o.length-1][a]!==o[0][a])throw new Error("First and last Position are not equivalent.")}var s={type:"Polygon",coordinates:t};return O(s,e,n)}function N(t,e,n){if(void 0===n&&(n={}),t.length<2)throw new Error("coordinates must be an array of two or more positions");var r={type:"LineString",coordinates:t};return O(r,e,n)}function z(t,e){void 0===e&&(e={});var n={type:"FeatureCollection"};return e.id&&(n.id=e.id),e.bbox&&(n.bbox=e.bbox),n.features=t,n}function F(t,e,n){void 0===n&&(n={});var r={type:"MultiPolygon",coordinates:t};return O(r,e,n)}function B(t,e){void 0===e&&(e="kilometers");var n=L[e];if(!n)throw new Error(e+" units is invalid");return t*n}function U(t){var e=t%(2*Math.PI);return 180*e/Math.PI}function j(t){var e=t%360;return e*Math.PI/180}function Z(t){if(Array.isArray(t))return t;if("Feature"===t.type){if(null!==t.geometry)return t.geometry.coordinates}else if(t.coordinates)return t.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function V(t){return"Feature"===t.type?t.geometry:t}function G(t,e,n){if(null!==t)for(var r,i,o,a,s,u,c,l,h=0,f=0,p=t.type,d="FeatureCollection"===p,v="Feature"===p,m=d?t.features.length:1,g=0;g<m;g++){c=d?t.features[g].geometry:v?t.geometry:t,l=!!c&&"GeometryCollection"===c.type,s=l?c.geometries.length:1;for(var y=0;y<s;y++){var _=0,x=0;if(a=l?c.geometries[y]:c,null!==a){u=a.coordinates;var b=a.type;switch(h=!n||"Polygon"!==b&&"MultiPolygon"!==b?0:1,b){case null:break;case"Point":if(!1===e(u,f,g,_,x))return!1;f++,_++;break;case"LineString":case"MultiPoint":for(r=0;r<u.length;r++){if(!1===e(u[r],f,g,_,x))return!1;f++,"MultiPoint"===b&&_++}"LineString"===b&&_++;break;case"Polygon":case"MultiLineString":for(r=0;r<u.length;r++){for(i=0;i<u[r].length-h;i++){if(!1===e(u[r][i],f,g,_,x))return!1;f++}"MultiLineString"===b&&_++,"Polygon"===b&&x++}"Polygon"===b&&_++;break;case"MultiPolygon":for(r=0;r<u.length;r++){for(x=0,i=0;i<u[r].length;i++){for(o=0;o<u[r][i].length-h;o++){if(!1===e(u[r][i][o],f,g,_,x))return!1;f++}x++}_++}break;case"GeometryCollection":for(r=0;r<a.geometries.length;r++)if(!1===G(a.geometries[r],e,n))return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function H(t,e){var n,r,i,o,a,s,u,c,l,h,f=0,p="FeatureCollection"===t.type,d="Feature"===t.type,v=p?t.features.length:1;for(n=0;n<v;n++){for(s=p?t.features[n].geometry:d?t.geometry:t,c=p?t.features[n].properties:d?t.properties:{},l=p?t.features[n].bbox:d?t.bbox:void 0,h=p?t.features[n].id:d?t.id:void 0,u=!!s&&"GeometryCollection"===s.type,a=u?s.geometries.length:1,i=0;i<a;i++)if(o=u?s.geometries[i]:s,null!==o)switch(o.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":if(!1===e(o,f,c,l,h))return!1;break;case"GeometryCollection":for(r=0;r<o.geometries.length;r++)if(!1===e(o.geometries[r],f,c,l,h))return!1;break;default:throw new Error("Unknown Geometry Type")}else if(!1===e(null,f,c,l,h))return!1;f++}}function W(t,e){H(t,(function(t,n,r,i,o){var a,s=null===t?null:t.type;switch(s){case null:case"Point":case"LineString":case"Polygon":return!1!==e(O(t,r,{bbox:i,id:o}),n,0)&&void 0}switch(s){case"MultiPoint":a="Point";break;case"MultiLineString":a="LineString";break;case"MultiPolygon":a="Polygon";break}for(var u=0;u<t.coordinates.length;u++){var c=t.coordinates[u],l={type:a,coordinates:c};if(!1===e(O(l,r),n,u))return!1}}))}function q(t,e){var n=e.x,r=e.y,i=e.x1,o=e.y1,a=e.coordinates,s=e.geometry,u=[];if(!Array.isArray(t))return{dataArray:[]};if(s)return t.filter((function(t){return t[s]&&t[s].type&&t[s].coordinates&&t[s].coordinates.length>0})).forEach((function(t,e){var n=P()((0,k.Z)({},t[s]),!0);W(n,(function(n){var r=Z(n),i=(0,k.Z)((0,k.Z)({},t),{},{_id:e,coordinates:r});u.push(i)}))})),{dataArray:u};for(var c=0;c<t.length;c++){var l=t[c],h=[];if(a){var f="Polygon";Array.isArray(a[0])||(f="Point"),Array.isArray(a[0])&&!Array.isArray(a[0][0])&&(f="LineString");var p=P()({type:f,coordinates:(0,C.Z)(l[a])},!0);h=p.coordinates}else if(n&&r&&i&&o){var d=[parseFloat(l[n]),parseFloat(l[r])],v=[parseFloat(l[i]),parseFloat(l[o])];h=[d,v]}else n&&r&&(h=[parseFloat(l[n]),parseFloat(l[r])]);var m=(0,k.Z)((0,k.Z)({},l),{},{_id:c,coordinates:h});u.push(m)}return{dataArray:u}}function X(t,e){var n=T(t);return q(n,e)}function Y(t){var e=t.toString(),n=5381,r=e.length;while(r)n=33*n^e.charCodeAt(--r);return n>>>0}function K(t,e){return void 0===e?null:1*(0,I.Z)(t.properties[e])==="number"?1*t.properties[e]:t.properties&&t.properties[e]?Y(t.properties[e]+"")%1000019:null}function Q(t,e){var n=[],r={};return t.features?(t.features=t.features.filter((function(t){var e=t.geometry;return null!=t&&e&&e.type&&e.coordinates&&e.coordinates.length>0})),P()(t,!0),0===t.features.length?{dataArray:[],featureKeys:r}:(W(t,(function(t,r){var i=K(t,null===e||void 0===e?void 0:e.featureId);null===i&&(i=r);var o=i,a=Z(t),s=(0,k.Z)((0,k.Z)({},t.properties),{},{coordinates:a,_id:o});n.push(s)})),{dataArray:n,featureKeys:r})):(t.features=[],{dataArray:[]})}var J=n(85617),$=n(82558),tt=n.n($);function et(t,e,n,r){for(var i,o=r,a=n-e>>1,s=n-e,u=t[e],c=t[e+1],l=t[n],h=t[n+1],f=e+3;f<n;f+=3){var p=nt(t[f],t[f+1],u,c,l,h);if(p>o)i=f,o=p;else if(p===o){var d=Math.abs(f-a);d<s&&(i=f,s=d)}}o>r&&(i-e>3&&et(t,e,i,r),t[i+2]=o,n-i>3&&et(t,i,n,r))}function nt(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((t-n)*a+(e-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return a=t-n,s=e-r,a*a+s*s}function rt(t,e,n,r){var i={id:"undefined"===typeof t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return it(i),i}function it(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)ot(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)ot(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)ot(t,e[r][i])}function ot(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function at(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)st(n,t.features[r],e,r);else"Feature"===t.type?st(n,t,e):st(n,{geometry:t},e);return n}function st(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)ut(i,s);else if("MultiPoint"===o)for(var c=0;c<i.length;c++)ut(i[c],s);else if("LineString"===o)ct(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(c=0;c<i.length;c++)s=[],ct(i[c],s,a,!1),t.push(rt(u,"LineString",s,e.properties));return}lt(i,s,a,!1)}else if("Polygon"===o)lt(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)st(t,{id:u,geometry:e.geometry.geometries[c],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<i.length;c++){var l=[];lt(i[c],l,a,!0),s.push(l)}}t.push(rt(u,o,s,e.properties))}}function ut(t,e){e.push(ht(t[0])),e.push(ft(t[1])),e.push(0)}function ct(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var u=ht(t[s][0]),c=ft(t[s][1]);e.push(u),e.push(c),e.push(0),s>0&&(a+=r?(i*c-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(c-o,2))),i=u,o=c}var l=e.length-3;e[2]=1,et(e,0,l,n),e[l+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function lt(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];ct(t[i],o,n,r),e.push(o)}}function ht(t){return t/360+.5}function ft(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function pt(t,e,n,r,i,o,a,s){if(n/=e,r/=e,o>=n&&a<r)return t;if(a<n||o>=r)return null;for(var u=[],c=0;c<t.length;c++){var l=t[c],h=l.geometry,f=l.type,p=0===i?l.minX:l.minY,d=0===i?l.maxX:l.maxY;if(p>=n&&d<r)u.push(l);else if(!(d<n||p>=r)){var v=[];if("Point"===f||"MultiPoint"===f)dt(h,v,n,r,i);else if("LineString"===f)vt(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===f)gt(h,v,n,r,i,!1);else if("Polygon"===f)gt(h,v,n,r,i,!0);else if("MultiPolygon"===f)for(var m=0;m<h.length;m++){var g=[];gt(h[m],g,n,r,i,!0),g.length&&v.push(g)}if(v.length){if(s.lineMetrics&&"LineString"===f){for(m=0;m<v.length;m++)u.push(rt(l.id,f,v[m],l.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===v.length?(f="LineString",v=v[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===v.length?"Point":"MultiPoint"),u.push(rt(l.id,f,v,l.tags))}}}return u.length?u:null}function dt(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function vt(t,e,n,r,i,o,a){for(var s,u,c=mt(t),l=0===i?_t:xt,h=t.start,f=0;f<t.length-3;f+=3){var p=t[f],d=t[f+1],v=t[f+2],m=t[f+3],g=t[f+4],y=0===i?p:d,_=0===i?m:g,x=!1;a&&(s=Math.sqrt(Math.pow(p-m,2)+Math.pow(d-g,2))),y<n?_>n&&(u=l(c,p,d,m,g,n),a&&(c.start=h+s*u)):y>r?_<r&&(u=l(c,p,d,m,g,r),a&&(c.start=h+s*u)):yt(c,p,d,v),_<n&&y>=n&&(u=l(c,p,d,m,g,n),x=!0),_>r&&y<=r&&(u=l(c,p,d,m,g,r),x=!0),!o&&x&&(a&&(c.end=h+s*u),e.push(c),c=mt(t)),a&&(h+=s)}var b=t.length-3;p=t[b],d=t[b+1],v=t[b+2],y=0===i?p:d,y>=n&&y<=r&&yt(c,p,d,v),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&yt(c,c[0],c[1],c[2]),c.length&&e.push(c)}function mt(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function gt(t,e,n,r,i,o){for(var a=0;a<t.length;a++)vt(t[a],e,n,r,i,o,!1)}function yt(t,e,n,r){t.push(e),t.push(n),t.push(r)}function _t(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function xt(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function bt(t,e){var n=e.buffer/e.extent,r=t,i=pt(t,1,-1-n,n,0,-1,2,e),o=pt(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=pt(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=wt(i,1).concat(r)),o&&(r=r.concat(wt(o,-1)))),r}function wt(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=Et(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(Et(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],c=0;c<o.geometry[s].length;c++)u.push(Et(o.geometry[s][c],e));i.push(u)}n.push(rt(o.id,a,i,o.tags))}return n}function Et(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function St(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],c=u.geometry,l=u.type;if(u.geometry=[],1===l)for(r=0;r<c.length;r+=2)u.geometry.push(At(c[r],c[r+1],e,o,a,s));else for(r=0;r<c.length;r++){var h=[];for(i=0;i<c[r].length;i+=2)h.push(At(c[r][i],c[r][i+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function At(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function Tt(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,Ct(a,t[s],o,i);var u=t[s].minX,c=t[s].minY,l=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),c<a.minY&&(a.minY=c),l>a.maxX&&(a.maxX=l),h>a.maxY&&(a.maxY=h)}return a}function Ct(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)kt(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)kt(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var c=i[u];for(s=0;s<c.length;s++)kt(a,c[s],t,n,!0,0===s)}if(a.length){var l=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in l={},e.tags)l[h]=e.tags[h];l["mapbox_clip_start"]=i.start/i.size,l["mapbox_clip_end"]=i.end/i.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:l};null!==e.id&&(f.id=e.id),t.features.push(f)}}function kt(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===r||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;i&&Mt(s,o),t.push(s)}}function Mt(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}function Pt(t,e){return new It(t,e)}function It(t,e){e=this.options=Lt(Object.create(this.options),e);var n=e.debug;if(e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=at(t,e);this.tiles={},this.tileCoords=[],n&&(this.stats={},this.total=0),r=bt(r,e),r.length&&this.splitTile(r,0,0,0),n&&r.length}function Rt(t,e,n){return 32*((1<<t)*n+e)+t}function Lt(t,e){for(var n in e)t[n]=e[n];return t}function Ot(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}It.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},It.prototype.splitTile=function(t,e,n,r,i,o,a){var s=[t,e,n,r],u=this.options,c=u.debug;while(s.length){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var l=1<<e,h=Rt(e,n,r),f=this.tiles[h];if(!f&&(f=this.tiles[h]=Tt(t,e,n,r,u),this.tileCoords.push({z:e,x:n,y:r}),c)){var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==t.length){var v,m,g,y,_,x,b=.5*u.buffer/u.extent,w=.5-b,E=.5+b,S=1+b;v=m=g=y=null,_=pt(t,l,n-b,n+E,0,f.minX,f.maxX,u),x=pt(t,l,n+w,n+S,0,f.minX,f.maxX,u),t=null,_&&(v=pt(_,l,r-b,r+E,1,f.minY,f.maxY,u),m=pt(_,l,r+w,r+S,1,f.minY,f.maxY,u),_=null),x&&(g=pt(x,l,r-b,r+E,1,f.minY,f.maxY,u),y=pt(x,l,r+w,r+S,1,f.minY,f.maxY,u),x=null),s.push(v||[],e+1,2*n,2*r),s.push(m||[],e+1,2*n,2*r+1),s.push(g||[],e+1,2*n+1,2*r),s.push(y||[],e+1,2*n+1,2*r+1)}}},It.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent;r.debug;if(t<0||t>24)return null;var o=1<<t;e=(e%o+o)%o;var a=Rt(t,e,n);if(this.tiles[a])return St(this.tiles[a],i);var s,u=t,c=e,l=n;while(!s&&u>0)u--,c=Math.floor(c/2),l=Math.floor(l/2),s=this.tiles[Rt(u,c,l)];return s&&s.source?(this.splitTile(s.source,u,c,l,t,e,n),this.tiles[a]?St(this.tiles[a],i):null):null};var Dt=n(72555);function Nt(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,(0,Dt.Z)(r.key),r)}}function zt(t,e,n){return e&&Nt(t.prototype,e),n&&Nt(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}var Ft=n(54503),Bt=function(){function t(e,n,r,i){Ot(this,t),(0,Ft.Z)(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=e}return zt(t,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var e=this.vectorTile.layers[t];return e.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),t}(),Ut={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function jt(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],n=t[a],r+=(n.x-e.x)*(e.y+n.y);return r}function Zt(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=jt(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}var Vt=["Unknown","Point","LineString","Polygon"];function Gt(t,e,n,r,i){var o,a,s=i.geometry,u=i.type,c=i.tags,l=i.id,h=t*Math.pow(2,r),f=t*e,p=t*n,d=Vt[u];function v(t){for(var e=0;e<t.length;e++){var n=t[e];if(n[3])break;var r=180-360*(n[1]+p)/h,i=360*(n[0]+f)/h-180,o=360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90;t[e]=[i,o,0,1]}}switch(u){case 1:var m=[];for(o=0;o<s.length;o++)m[o]=s[o][0];s=m,v(s);break;case 2:for(o=0;o<s.length;o++)v(s[o]);break;case 3:for(s=Zt(s),o=0;o<s.length;o++)for(a=0;a<s[o].length;a++)v(s[o][a]);break}1===s.length?s=s[0]:d="Multi"+d;var g={type:"Feature",geometry:{type:d,coordinates:s},properties:c,id:l,tileOrigin:[0,0],coord:""};return g}var Ht=function(){var t=(0,J.Z)(tt().mark((function t(e,n,r,i){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var o=n.getTile(e.z,e.x,e.y),a=o?o.features.map((function(t){return Gt(i,r.x,r.y,r.z,t)})):[],s={layers:{defaultLayer:{features:a}}},u=new Bt(s,e.x,e.y,e.z);t(u)})));case 1:case"end":return t.stop()}}),t)})));return function(e,n,r,i){return t.apply(this,arguments)}}();function Wt(t){var e={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return void 0===t||"undefined"===typeof t.geojsonvtOptions?e:(0,k.Z)((0,k.Z)({},e),t.geojsonvtOptions)}function qt(t,e){var n=Wt(e),r=n.extent||4096,i=Pt(t,n),o=function(t,e){return Ht(e,i,t,r)},a=(0,k.Z)((0,k.Z)((0,k.Z)({},Ut),e),{},{getTileData:o});return{data:t,dataArray:[],tilesetOptions:a,isTile:!0}}n(39575),n(82472),n(33105),n(3462),n(33824);function Xt(t,e){return Xt=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t},Xt(t,e)}function Yt(t,e){if("function"!==typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&Xt(t,e)}function Kt(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function Qt(t,e){if(e&&("object"===(0,I.Z)(e)||"function"===typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return Kt(t)}function Jt(t){return Jt=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},Jt(t)}n(33948);function $t(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function te(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function ee(t,e,n){return ee=te()?Reflect.construct.bind():function(t,e,n){var r=[null];r.push.apply(r,e);var i=Function.bind.apply(t,r),o=new i;return n&&Xt(o,n.prototype),o},ee.apply(null,arguments)}function ne(t){var e="function"===typeof Map?new Map:void 0;return ne=function(t){if(null===t||!$t(t))return t;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return ee(t,arguments,Jt(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),Xt(n,t)},ne(t)}var re="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";function ie(t){this.message=t}function oe(t){var e=String(t).replace(/=+$/,"");if(e.length%4===1)throw new ie("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,r,i="",o=0,a=0;r=e.charAt(a++);~r&&(n=o%4?64*n+r:r,o++%4)?i+=String.fromCharCode(255&n>>(-2*o&6)):0)r=re.indexOf(r);return i}function ae(t){t=String(t);for(var e,n,r,i,o="",a=0,s=t.length%3;a<t.length;){if((n=t.charCodeAt(a++))>255||(r=t.charCodeAt(a++))>255||(i=t.charCodeAt(a++))>255)throw new TypeError("Failed to execute 'btoa' on 'Window': The string to be encoded contains characters outside of the Latin1 range.");e=n<<16|r<<8|i,o+=re.charAt(e>>18&63)+re.charAt(e>>12&63)+re.charAt(e>>6&63)+re.charAt(63&e)}return s?o.slice(0,s-3)+"===".substring(s):o}ie.prototype=new Error,ie.prototype.name="InvalidCharacterError";var se,ue,ce=function(){function t(e,n){Ot(this,t),this.buffers=e,this.type=n}return zt(t,[{key:"arraybuffer",value:function(){return Promise.resolve(this.buffers[0])}},{key:"stream",value:function(){throw new Error("not implemented")}},{key:"text",value:function(){throw new Error("not implemented")}},{key:"slice",value:function(t,e,n){throw new Error("not implemented")}}]),t}(),le=function(){return se||(se="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof self?self:"undefined"!==typeof window?window:"undefined"!==typeof n.g?n.g:{})};se=le(),ue="undefined"===typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,n){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window;var he="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,fe=he?my.getSystemInfoSync().pixelRatio:ue.devicePixelRatio,pe=zt((function t(e,n){Ot(this,t),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()}));n(41817);function de(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=ve(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ve(t,e){if(t){if("string"===typeof t)return me(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?me(t,e):void 0}}function me(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var ge=new WeakMap,ye=function(){function t(){Ot(this,t),ge.set(this,{})}return zt(t,[{key:"addEventListener",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=ge.get(this);r||(r={}),r[t]||(r[t]=[]),r[t].push(e),ge.set(this,r),n.capture,n.once,n.passive}},{key:"removeEventListener",value:function(t,e){var n=ge.get(this);if(n){var r=n[t];if(r&&r.length>0)for(var i=r.length;i--;i>0)if(r[i]===e){r.splice(i,1);break}}}},{key:"dispatchEvent",value:function(t){var e=ge.get(this)[t.type];if(e){var n,r=de(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;i(t)}}catch(o){r.e(o)}finally{r.f()}}}}]),t}();function _e(t){var e=xe();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function xe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var be=function(t){Yt(n,t);var e=_e(n);function n(){var t;return Ot(this,n),t=e.call(this),t.childNodes=[],t}return zt(n,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),n}(ye);function we(t){var e=Ee();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Ee(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Se,Ae,Te,Ce,ke=function(t){Yt(n,t);var e=we(n);function n(){var t;return Ot(this,n),t=e.call(this),t.className="",t.children=[],t}return zt(n,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),n}(be),Me="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;if(Me){var Pe=my.getSystemInfoSync();Se=Pe.screenWidth,Ae=Pe.screenHeight,Te=Pe.windowWidth,Ce=Pe.windowHeight}else{var Ie=ue.innerWidth,Re=ue.innerHeight;Se=Ie,Ae=Re,Te=Ie,Ce=Re}var Le={width:Se,height:Ae,availWidth:Te,availHeight:Ce,availLeft:0,availTop:0},Oe=Le.availWidth,De=Le.availHeight,Ne={style:[]};function ze(t,e){var n,r;"parentNode"in t||(n=0===e?function(){return null}:1===e?function(){return Ne}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:n}));"parentElement"in t||(r=0===e?function(){return null}:1===e?function(){return Ne}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:r}))}function Fe(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:Oe+"px",height:De+"px",margin:"0px",padding:"0px"})}function Be(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=Oe,t.clientHeight=De),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){var t={x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight};return t})}function Ue(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=Oe,t.offsetHeight=De)}function je(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=Oe,t.scrollHeight=De)}function Ze(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function Ve(t){var e=Ge();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Ge(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function He(){}var We=function(t){Yt(n,t);var e=Ve(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",i=arguments.length>1?arguments[1]:void 0;return Ot(this,n),t=e.call(this),t.className="",t.children=[],t.focus=He,t.blur=He,t.insertBefore=He,t.appendChild=He,t.removeChild=He,t.remove=He,t.innerHTML="",t.tagName=r.toUpperCase(),ze(Kt(t),i),Fe(Kt(t)),Ze(Kt(t)),Be(Kt(t)),Ue(Kt(t)),je(Kt(t)),t}return zt(n)}(ke);function qe(t){var e=Xe();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Xe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ye=function(t){Yt(n,t);var e=qe(n);function n(t){return Ot(this,n),e.call(this,t)}return zt(n,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),n}(We);function Ke(t){var e=Qe();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Qe(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Je=function(t){Yt(n,t);var e=Ke(n);function n(){return Ot(this,n),e.call(this,"video")}return zt(n)}(Ye),$e={};function tn(){return $e}var en=zt((function t(){Ot(this,t);var e=tn(),n=e.createImage&&e.createImage()||{};return"tagName"in n||(n.tagName="IMG",n.__proto__=t.prototype),ze(n),Ze(n),Object.assign(n,{addEventListener:function(t,e){n["on".concat(t)]=e.bind(n)},removeEventListener:function(t){n["on".concat(t)]=null}}),n})),nn={href:"",protocol:"",host:""};function rn(t){var e=on();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function on(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var an=function(t){Yt(n,t);var e=rn(n);function n(){return Ot(this,n),e.call(this,"body",0)}return zt(n,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,n){}},{key:"dispatchEvent",value:function(t){}}]),n}(We),sn=function(t){Yt(n,t);var e=rn(n);function n(){return Ot(this,n),e.call(this,"html",0)}return zt(n,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),n}(We),un={},cn={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:nn,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return t=t.toLowerCase(),"canvas"===t?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new en:"video"===t?new Je:new We(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,n){un[t]||(un[t]=[]),un[t].push(e)},removeEventListener:function(t,e){var n=un[t];if(n&&n.length>0)for(var r=n.length;r--;r>0)if(n[r]===e){n.splice(r,1);break}},dispatchEvent:function(t){var e=t.type,n=un[e];if(n)for(var r=0;r<n.length;r++)n[r](t);t.target&&"function"===typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new pe(t)}};cn.documentElement=new sn,cn.head=new We("head"),cn.body=new an;var ln,hn,fn,pn=Object,dn=(n(49743),function(){function t(){Ot(this,t);var e=arguments.length;if(2===e){if("number"===typeof arguments[0]&&"number"===typeof arguments[1])return this._w=arguments[0],this._h=arguments[1],void(this._data=new Uint8ClampedArray(this._w*this._h*4))}else 3===e&&"object"===(0,I.Z)(arguments[0])&&"number"===typeof arguments[1]&&"number"===typeof arguments[2]&&(this._data=arguments[0],this._w=arguments[1],this._h=arguments[2]);throw new Error("ImageData: params error")}return zt(t,[{key:"width",get:function(){return this._w}},{key:"height",get:function(){return this._h}},{key:"data",get:function(){return this._data}}]),t}()),vn="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;if(vn){var mn=my.getSystemInfoSync();ln=mn.system,hn=mn.platform,fn=mn.language}else{var gn={versions:function(){var t=ue.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1===t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1===t.indexOf("Safari"),weixin:t.indexOf("MicroMessenger")>-1,qq:" qq"===t.match(/\sQQ/i)}}(),language:(ue.navigator.browserLanguage||ue.navigator.language).toLowerCase()};gn.versions.android?hn="android":gn.versions.trident?hn="IE":gn.versions.presto?hn="Opera":gn.versions.webKit?hn="webKit":gn.versions.gecko?hn="Firefox":gn.versions.mobile?hn="mobile":gn.versions.ios?hn="ios":gn.versions.iPhone?hn="iPhone":gn.versions.iPad?hn="ipad":gn.versions.webApp?hn="webApp":gn.versions.weixin?hn="weixin":gn.versions.qq&&(hn="qq"),ln=ue.navigator.userAgent,fn=gn.language}var yn=-1!==ln.toLowerCase().indexOf("android"),_n=yn?"Android; CPU Android 6.0":"iPhone; CPU iPhone OS 10_3_1 like Mac OS X",xn="Mozilla/5.0 (".concat(_n,") AppleWebKit/603.1.30 (KHTML, like Gecko) Mobile/14E8301 MicroMessenger/6.6.0 MiniGame NetType/WIFI Language/").concat(fn),bn={platform:hn,language:fn,appVersion:"5.0 (".concat(_n,") AppleWebKit/601.1.46 (KHTML, like Gecko) Version/9.0 Mobile/13B143 Safari/601.1"),userAgent:xn},wn={mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,n){return{duration:0}},now:function(){}},En=0,Sn=0;function An(t){var e=Date.now(),n=Math.max(En+23,e);return Sn=setTimeout((function(){t(En=n)}),n-e),Sn}function Tn(t){var e=tn();return e.requestAnimationFrame?e.requestAnimationFrame(t):An(t)}function Cn(t){var e=tn();return e.cancelAnimationFrame?e.cancelAnimationFrame(t):clearTimeout(t)}var kn=function(){function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";Ot(this,t),0!=e.indexOf("http://")&&0!=e.indexOf("https://")?this.href=n+e:this.href=e}return zt(t,null,[{key:"createObjectURL",value:function(t){var e=t.buffers[0],n=t.type,r=Mn(e),i="data:".concat(n,";base64, ");return i+r}}]),t}();function Mn(t){for(var e="",n=new Uint8Array(t),r=n.byteLength,i=0;i<r;i++)e+=String.fromCharCode(n[i]);return ae(e)}var Pn={GCCSO_SHADER_BINARY_FJ:37472,_3DC_XY_AMD:34810,_3DC_X_AMD:34809,ACTIVE_ATTRIBUTES:35721,ACTIVE_ATTRIBUTE_MAX_LENGTH:35722,ACTIVE_PROGRAM_EXT:33369,ACTIVE_TEXTURE:34016,ACTIVE_UNIFORMS:35718,ACTIVE_UNIFORM_MAX_LENGTH:35719,ALIASED_LINE_WIDTH_RANGE:33902,ALIASED_POINT_SIZE_RANGE:33901,ALL_COMPLETED_NV:34034,ALL_SHADER_BITS_EXT:4294967295,ALPHA:6406,ALPHA16F_EXT:34844,ALPHA32F_EXT:34838,ALPHA8_EXT:32828,ALPHA8_OES:32828,ALPHA_BITS:3413,ALPHA_TEST_FUNC_QCOM:3009,ALPHA_TEST_QCOM:3008,ALPHA_TEST_REF_QCOM:3010,ALREADY_SIGNALED_APPLE:37146,ALWAYS:519,AMD_compressed_3DC_texture:1,AMD_compressed_ATC_texture:1,AMD_performance_monitor:1,AMD_program_binary_Z400:1,ANGLE_depth_texture:1,ANGLE_framebuffer_blit:1,ANGLE_framebuffer_multisample:1,ANGLE_instanced_arrays:1,ANGLE_pack_reverse_row_order:1,ANGLE_program_binary:1,ANGLE_texture_compression_dxt3:1,ANGLE_texture_compression_dxt5:1,ANGLE_texture_usage:1,ANGLE_translated_shader_source:1,ANY_SAMPLES_PASSED_CONSERVATIVE_EXT:36202,ANY_SAMPLES_PASSED_EXT:35887,APPLE_copy_texture_levels:1,APPLE_framebuffer_multisample:1,APPLE_rgb_422:1,APPLE_sync:1,APPLE_texture_format_BGRA8888:1,APPLE_texture_max_level:1,ARM_mali_program_binary:1,ARM_mali_shader_binary:1,ARM_rgba8:1,ARRAY_BUFFER:34962,ARRAY_BUFFER_BINDING:34964,ATC_RGBA_EXPLICIT_ALPHA_AMD:35987,ATC_RGBA_INTERPOLATED_ALPHA_AMD:34798,ATC_RGB_AMD:35986,ATTACHED_SHADERS:35717,BACK:1029,BGRA8_EXT:37793,BGRA_EXT:32993,BGRA_IMG:32993,BINNING_CONTROL_HINT_QCOM:36784,BLEND:3042,BLEND_COLOR:32773,BLEND_DST_ALPHA:32970,BLEND_DST_RGB:32968,BLEND_EQUATION:32777,BLEND_EQUATION_ALPHA:34877,BLEND_EQUATION_RGB:32777,BLEND_SRC_ALPHA:32971,BLEND_SRC_RGB:32969,BLUE_BITS:3412,BOOL:35670,BOOL_VEC2:35671,BOOL_VEC3:35672,BOOL_VEC4:35673,BUFFER:33504,BUFFER_ACCESS_OES:35003,BUFFER_MAPPED_OES:35004,BUFFER_MAP_POINTER_OES:35005,BUFFER_OBJECT_EXT:37201,BUFFER_SIZE:34660,BUFFER_USAGE:34661,BYTE:5120,CCW:2305,CLAMP_TO_BORDER_NV:33069,CLAMP_TO_EDGE:33071,COLOR_ATTACHMENT0:36064,COLOR_ATTACHMENT0_NV:36064,COLOR_ATTACHMENT10_NV:36074,COLOR_ATTACHMENT11_NV:36075,COLOR_ATTACHMENT12_NV:36076,COLOR_ATTACHMENT13_NV:36077,COLOR_ATTACHMENT14_NV:36078,COLOR_ATTACHMENT15_NV:36079,COLOR_ATTACHMENT1_NV:36065,COLOR_ATTACHMENT2_NV:36066,COLOR_ATTACHMENT3_NV:36067,COLOR_ATTACHMENT4_NV:36068,COLOR_ATTACHMENT5_NV:36069,COLOR_ATTACHMENT6_NV:36070,COLOR_ATTACHMENT7_NV:36071,COLOR_ATTACHMENT8_NV:36072,COLOR_ATTACHMENT9_NV:36073,COLOR_ATTACHMENT_EXT:37104,COLOR_BUFFER_BIT:16384,COLOR_BUFFER_BIT0_QCOM:1,COLOR_BUFFER_BIT1_QCOM:2,COLOR_BUFFER_BIT2_QCOM:4,COLOR_BUFFER_BIT3_QCOM:8,COLOR_BUFFER_BIT4_QCOM:16,COLOR_BUFFER_BIT5_QCOM:32,COLOR_BUFFER_BIT6_QCOM:64,COLOR_BUFFER_BIT7_QCOM:128,COLOR_CLEAR_VALUE:3106,COLOR_EXT:6144,COLOR_WRITEMASK:3107,COMPARE_REF_TO_TEXTURE_EXT:34894,COMPILE_STATUS:35713,COMPRESSED_RGBA_ASTC_10x10_KHR:37819,COMPRESSED_RGBA_ASTC_10x5_KHR:37816,COMPRESSED_RGBA_ASTC_10x6_KHR:37817,COMPRESSED_RGBA_ASTC_10x8_KHR:37818,COMPRESSED_RGBA_ASTC_12x10_KHR:37820,COMPRESSED_RGBA_ASTC_12x12_KHR:37821,COMPRESSED_RGBA_ASTC_4x4_KHR:37808,COMPRESSED_RGBA_ASTC_5x4_KHR:37809,COMPRESSED_RGBA_ASTC_5x5_KHR:37810,COMPRESSED_RGBA_ASTC_6x5_KHR:37811,COMPRESSED_RGBA_ASTC_6x6_KHR:37812,COMPRESSED_RGBA_ASTC_8x5_KHR:37813,COMPRESSED_RGBA_ASTC_8x6_KHR:37814,COMPRESSED_RGBA_ASTC_8x8_KHR:37815,COMPRESSED_RGBA_PVRTC_2BPPV1_IMG:35843,COMPRESSED_RGBA_PVRTC_2BPPV2_IMG:37175,COMPRESSED_RGBA_PVRTC_4BPPV1_IMG:35842,COMPRESSED_RGBA_PVRTC_4BPPV2_IMG:37176,COMPRESSED_RGBA_S3TC_DXT1_EXT:33777,COMPRESSED_RGBA_S3TC_DXT3_ANGLE:33778,COMPRESSED_RGBA_S3TC_DXT5_ANGLE:33779,COMPRESSED_RGB_PVRTC_2BPPV1_IMG:35841,COMPRESSED_RGB_PVRTC_4BPPV1_IMG:35840,COMPRESSED_RGB_S3TC_DXT1_EXT:33776,COMPRESSED_SRGB8_ALPHA8_ASTC_10x10_KHR:37851,COMPRESSED_SRGB8_ALPHA8_ASTC_10x5_KHR:37848,COMPRESSED_SRGB8_ALPHA8_ASTC_10x6_KHR:37849,COMPRESSED_SRGB8_ALPHA8_ASTC_10x8_KHR:37850,COMPRESSED_SRGB8_ALPHA8_ASTC_12x10_KHR:37852,COMPRESSED_SRGB8_ALPHA8_ASTC_12x12_KHR:37853,COMPRESSED_SRGB8_ALPHA8_ASTC_4x4_KHR:37840,COMPRESSED_SRGB8_ALPHA8_ASTC_5x4_KHR:37841,COMPRESSED_SRGB8_ALPHA8_ASTC_5x5_KHR:37842,COMPRESSED_SRGB8_ALPHA8_ASTC_6x5_KHR:37843,COMPRESSED_SRGB8_ALPHA8_ASTC_6x6_KHR:37844,COMPRESSED_SRGB8_ALPHA8_ASTC_8x5_KHR:37845,COMPRESSED_SRGB8_ALPHA8_ASTC_8x6_KHR:37846,COMPRESSED_SRGB8_ALPHA8_ASTC_8x8_KHR:37847,COMPRESSED_SRGB_ALPHA_S3TC_DXT1_NV:35917,COMPRESSED_SRGB_ALPHA_S3TC_DXT3_NV:35918,COMPRESSED_SRGB_ALPHA_S3TC_DXT5_NV:35919,COMPRESSED_SRGB_S3TC_DXT1_NV:35916,COMPRESSED_TEXTURE_FORMATS:34467,CONDITION_SATISFIED_APPLE:37148,CONSTANT_ALPHA:32771,CONSTANT_COLOR:32769,CONTEXT_FLAG_DEBUG_BIT:2,CONTEXT_ROBUST_ACCESS_EXT:37107,COUNTER_RANGE_AMD:35777,COUNTER_TYPE_AMD:35776,COVERAGE_ALL_FRAGMENTS_NV:36565,COVERAGE_ATTACHMENT_NV:36562,COVERAGE_AUTOMATIC_NV:36567,COVERAGE_BUFFERS_NV:36563,COVERAGE_BUFFER_BIT_NV:32768,COVERAGE_COMPONENT4_NV:36561,COVERAGE_COMPONENT_NV:36560,COVERAGE_EDGE_FRAGMENTS_NV:36566,COVERAGE_SAMPLES_NV:36564,CPU_OPTIMIZED_QCOM:36785,CULL_FACE:2884,CULL_FACE_MODE:2885,CURRENT_PROGRAM:35725,CURRENT_QUERY_EXT:34917,CURRENT_VERTEX_ATTRIB:34342,CW:2304,DEBUG_CALLBACK_FUNCTION:33348,DEBUG_CALLBACK_USER_PARAM:33349,DEBUG_GROUP_STACK_DEPTH:33389,DEBUG_LOGGED_MESSAGES:37189,DEBUG_NEXT_LOGGED_MESSAGE_LENGTH:33347,DEBUG_OUTPUT:37600,DEBUG_OUTPUT_SYNCHRONOUS:33346,DEBUG_SEVERITY_HIGH:37190,DEBUG_SEVERITY_LOW:37192,DEBUG_SEVERITY_MEDIUM:37191,DEBUG_SEVERITY_NOTIFICATION:33387,DEBUG_SOURCE_API:33350,DEBUG_SOURCE_APPLICATION:33354,DEBUG_SOURCE_OTHER:33355,DEBUG_SOURCE_SHADER_COMPILER:33352,DEBUG_SOURCE_THIRD_PARTY:33353,DEBUG_SOURCE_WINDOW_SYSTEM:33351,DEBUG_TYPE_DEPRECATED_BEHAVIOR:33357,DEBUG_TYPE_ERROR:33356,DEBUG_TYPE_MARKER:33384,DEBUG_TYPE_OTHER:33361,DEBUG_TYPE_PERFORMANCE:33360,DEBUG_TYPE_POP_GROUP:33386,DEBUG_TYPE_PORTABILITY:33359,DEBUG_TYPE_PUSH_GROUP:33385,DEBUG_TYPE_UNDEFINED_BEHAVIOR:33358,DECR:7683,DECR_WRAP:34056,DELETE_STATUS:35712,DEPTH24_STENCIL8_OES:35056,DEPTH_ATTACHMENT:36096,DEPTH_STENCIL_ATTACHMENT:33306,DEPTH_BITS:3414,DEPTH_BUFFER_BIT:256,DEPTH_BUFFER_BIT0_QCOM:256,DEPTH_BUFFER_BIT1_QCOM:512,DEPTH_BUFFER_BIT2_QCOM:1024,DEPTH_BUFFER_BIT3_QCOM:2048,DEPTH_BUFFER_BIT4_QCOM:4096,DEPTH_BUFFER_BIT5_QCOM:8192,DEPTH_BUFFER_BIT6_QCOM:16384,DEPTH_BUFFER_BIT7_QCOM:32768,DEPTH_CLEAR_VALUE:2931,DEPTH_COMPONENT:6402,DEPTH_COMPONENT16:33189,DEPTH_COMPONENT16_NONLINEAR_NV:36396,DEPTH_COMPONENT16_OES:33189,DEPTH_COMPONENT24_OES:33190,DEPTH_COMPONENT32_OES:33191,DEPTH_EXT:6145,DEPTH_FUNC:2932,DEPTH_RANGE:2928,DEPTH_STENCIL:34041,DEPTH_STENCIL_OES:34041,DEPTH_TEST:2929,DEPTH_WRITEMASK:2930,DITHER:3024,DMP_shader_binary:1,DONT_CARE:4352,DRAW_BUFFER0_NV:34853,DRAW_BUFFER10_NV:34863,DRAW_BUFFER11_NV:34864,DRAW_BUFFER12_NV:34865,DRAW_BUFFER13_NV:34866,DRAW_BUFFER14_NV:34867,DRAW_BUFFER15_NV:34868,DRAW_BUFFER1_NV:34854,DRAW_BUFFER2_NV:34855,DRAW_BUFFER3_NV:34856,DRAW_BUFFER4_NV:34857,DRAW_BUFFER5_NV:34858,DRAW_BUFFER6_NV:34859,DRAW_BUFFER7_NV:34860,DRAW_BUFFER8_NV:34861,DRAW_BUFFER9_NV:34862,DRAW_BUFFER_EXT:3073,DRAW_FRAMEBUFFER_ANGLE:36009,DRAW_FRAMEBUFFER_APPLE:36009,DRAW_FRAMEBUFFER_BINDING_ANGLE:36006,DRAW_FRAMEBUFFER_BINDING_APPLE:36006,DRAW_FRAMEBUFFER_BINDING_NV:36006,DRAW_FRAMEBUFFER_NV:36009,DST_ALPHA:772,DST_COLOR:774,DYNAMIC_DRAW:35048,ELEMENT_ARRAY_BUFFER:34963,ELEMENT_ARRAY_BUFFER_BINDING:34965,EQUAL:514,ES_VERSION_2_0:1,ETC1_RGB8_OES:36196,ETC1_SRGB8_NV:35054,EXTENSIONS:7939,EXT_blend_minmax:1,EXT_color_buffer_half_float:1,EXT_debug_label:1,EXT_debug_marker:1,EXT_discard_framebuffer:1,EXT_map_buffer_range:1,EXT_multi_draw_arrays:1,EXT_multisampled_render_to_texture:1,EXT_multiview_draw_buffers:1,EXT_occlusion_query_boolean:1,EXT_read_format_bgra:1,EXT_robustness:1,EXT_sRGB:1,EXT_separate_shader_objects:1,EXT_shader_framebuffer_fetch:1,EXT_shader_texture_lod:1,EXT_shadow_samplers:1,EXT_texture_compression_dxt1:1,EXT_texture_filter_anisotropic:1,EXT_texture_format_BGRA8888:1,EXT_texture_rg:1,EXT_texture_storage:1,EXT_texture_type_2_10_10_10_REV:1,EXT_unpack_subimage:1,FALSE:0,FASTEST:4353,FENCE_CONDITION_NV:34036,FENCE_STATUS_NV:34035,FIXED:5132,FJ_shader_binary_GCCSO:1,FLOAT:5126,FLOAT_MAT2:35674,FLOAT_MAT3:35675,FLOAT_MAT4:35676,FLOAT_VEC2:35664,FLOAT_VEC3:35665,FLOAT_VEC4:35666,FRAGMENT_SHADER:35632,FRAGMENT_SHADER_BIT_EXT:2,FRAGMENT_SHADER_DERIVATIVE_HINT_OES:35723,FRAGMENT_SHADER_DISCARDS_SAMPLES_EXT:35410,FRAMEBUFFER:36160,FRAMEBUFFER_ATTACHMENT_ANGLE:37795,FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT:33296,FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT:33297,FRAMEBUFFER_ATTACHMENT_OBJECT_NAME:36049,FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE:36048,FRAMEBUFFER_ATTACHMENT_TEXTURE_3D_ZOFFSET_OES:36052,FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE:36051,FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL:36050,FRAMEBUFFER_ATTACHMENT_TEXTURE_SAMPLES_EXT:36204,FRAMEBUFFER_BINDING:36006,FRAMEBUFFER_COMPLETE:36053,FRAMEBUFFER_INCOMPLETE_ATTACHMENT:36054,FRAMEBUFFER_INCOMPLETE_DIMENSIONS:36057,FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT:36055,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_ANGLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_APPLE:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_EXT:36182,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_IMG:37172,FRAMEBUFFER_INCOMPLETE_MULTISAMPLE_NV:36182,FRAMEBUFFER_UNDEFINED_OES:33305,FRAMEBUFFER_UNSUPPORTED:36061,FRONT:1028,FRONT_AND_BACK:1032,FRONT_FACE:2886,FUNC_ADD:32774,FUNC_REVERSE_SUBTRACT:32779,FUNC_SUBTRACT:32778,GENERATE_MIPMAP_HINT:33170,GEQUAL:518,GPU_OPTIMIZED_QCOM:36786,GREATER:516,GREEN_BITS:3411,GUILTY_CONTEXT_RESET_EXT:33363,HALF_FLOAT_OES:36193,HIGH_FLOAT:36338,HIGH_INT:36341,IMG_multisampled_render_to_texture:1,IMG_program_binary:1,IMG_read_format:1,IMG_shader_binary:1,IMG_texture_compression_pvrtc:1,IMG_texture_compression_pvrtc2:1,IMPLEMENTATION_COLOR_READ_FORMAT:35739,IMPLEMENTATION_COLOR_READ_TYPE:35738,INCR:7682,INCR_WRAP:34055,INFO_LOG_LENGTH:35716,INNOCENT_CONTEXT_RESET_EXT:33364,INT:5124,INT_10_10_10_2_OES:36343,INT_VEC2:35667,INT_VEC3:35668,INT_VEC4:35669,INVALID_ENUM:1280,INVALID_FRAMEBUFFER_OPERATION:1286,INVALID_OPERATION:1282,INVALID_VALUE:1281,INVERT:5386,KEEP:7680,KHR_debug:1,KHR_texture_compression_astc_ldr:1,LEFT:1030,LEQUAL:515,LESS:513,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985,LINES:1,LINE_LOOP:2,LINE_STRIP:3,LINE_WIDTH:2849,LINK_STATUS:35714,LOSE_CONTEXT_ON_RESET_EXT:33362,LOW_FLOAT:36336,LOW_INT:36339,LUMINANCE:6409,LUMINANCE16F_EXT:34846,LUMINANCE32F_EXT:34840,LUMINANCE4_ALPHA4_OES:32835,LUMINANCE8_ALPHA8_EXT:32837,LUMINANCE8_ALPHA8_OES:32837,LUMINANCE8_EXT:32832,LUMINANCE8_OES:32832,LUMINANCE_ALPHA:6410,LUMINANCE_ALPHA16F_EXT:34847,LUMINANCE_ALPHA32F_EXT:34841,MALI_PROGRAM_BINARY_ARM:36705,MALI_SHADER_BINARY_ARM:36704,MAP_FLUSH_EXPLICIT_BIT_EXT:16,MAP_INVALIDATE_BUFFER_BIT_EXT:8,MAP_INVALIDATE_RANGE_BIT_EXT:4,MAP_READ_BIT_EXT:1,MAP_UNSYNCHRONIZED_BIT_EXT:32,MAP_WRITE_BIT_EXT:2,MAX_3D_TEXTURE_SIZE_OES:32883,MAX_COLOR_ATTACHMENTS_NV:36063,MAX_COMBINED_TEXTURE_IMAGE_UNITS:35661,MAX_CUBE_MAP_TEXTURE_SIZE:34076,MAX_DEBUG_GROUP_STACK_DEPTH:33388,MAX_DEBUG_LOGGED_MESSAGES:37188,MAX_DEBUG_MESSAGE_LENGTH:37187,MAX_DRAW_BUFFERS_NV:34852,MAX_EXT:32776,MAX_FRAGMENT_UNIFORM_VECTORS:36349,MAX_LABEL_LENGTH:33512,MAX_MULTIVIEW_BUFFERS_EXT:37106,MAX_RENDERBUFFER_SIZE:34024,MAX_SAMPLES_ANGLE:36183,MAX_SAMPLES_APPLE:36183,MAX_SAMPLES_EXT:36183,MAX_SAMPLES_IMG:37173,MAX_SAMPLES_NV:36183,MAX_SERVER_WAIT_TIMEOUT_APPLE:37137,MAX_TEXTURE_IMAGE_UNITS:34930,MAX_TEXTURE_MAX_ANISOTROPY_EXT:34047,MAX_TEXTURE_SIZE:3379,MAX_VARYING_VECTORS:36348,MAX_VERTEX_ATTRIBS:34921,MAX_VERTEX_TEXTURE_IMAGE_UNITS:35660,MAX_VERTEX_UNIFORM_VECTORS:36347,MAX_VIEWPORT_DIMS:3386,MEDIUM_FLOAT:36337,MEDIUM_INT:36340,MIN_EXT:32775,MIRRORED_REPEAT:33648,MULTISAMPLE_BUFFER_BIT0_QCOM:16777216,MULTISAMPLE_BUFFER_BIT1_QCOM:33554432,MULTISAMPLE_BUFFER_BIT2_QCOM:67108864,MULTISAMPLE_BUFFER_BIT3_QCOM:134217728,MULTISAMPLE_BUFFER_BIT4_QCOM:268435456,MULTISAMPLE_BUFFER_BIT5_QCOM:536870912,MULTISAMPLE_BUFFER_BIT6_QCOM:1073741824,MULTISAMPLE_BUFFER_BIT7_QCOM:2147483648,MULTIVIEW_EXT:37105,NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,NEVER:512,NICEST:4354,NONE:0,NOTEQUAL:517,NO_ERROR:0,NO_RESET_NOTIFICATION_EXT:33377,NUM_COMPRESSED_TEXTURE_FORMATS:34466,NUM_PROGRAM_BINARY_FORMATS_OES:34814,NUM_SHADER_BINARY_FORMATS:36345,NV_coverage_sample:1,NV_depth_nonlinear:1,NV_draw_buffers:1,NV_draw_instanced:1,NV_fbo_color_attachments:1,NV_fence:1,NV_framebuffer_blit:1,NV_framebuffer_multisample:1,NV_generate_mipmap_sRGB:1,NV_instanced_arrays:1,NV_read_buffer:1,NV_read_buffer_front:1,NV_read_depth:1,NV_read_depth_stencil:1,NV_read_stencil:1,NV_sRGB_formats:1,NV_shadow_samplers_array:1,NV_shadow_samplers_cube:1,NV_texture_border_clamp:1,NV_texture_compression_s3tc_update:1,NV_texture_npot_2D_mipmap:1,OBJECT_TYPE_APPLE:37138,OES_EGL_image:1,OES_EGL_image_external:1,OES_compressed_ETC1_RGB8_texture:1,OES_compressed_paletted_texture:1,OES_depth24:1,OES_depth32:1,OES_depth_texture:1,OES_element_index_uint:1,OES_fbo_render_mipmap:1,OES_fragment_precision_high:1,OES_get_program_binary:1,OES_mapbuffer:1,OES_packed_depth_stencil:1,OES_required_internalformat:1,OES_rgb8_rgba8:1,OES_standard_derivatives:1,OES_stencil1:1,OES_stencil4:1,OES_surfaceless_context:1,OES_texture_3D:1,OES_texture_float:1,OES_texture_float_linear:1,OES_texture_half_float:1,OES_texture_half_float_linear:1,OES_texture_npot:1,OES_vertex_array_object:1,OES_vertex_half_float:1,OES_vertex_type_10_10_10_2:1,ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,OUT_OF_MEMORY:1285,PACK_ALIGNMENT:3333,PACK_REVERSE_ROW_ORDER_ANGLE:37796,PALETTE4_R5_G6_B5_OES:35730,PALETTE4_RGB5_A1_OES:35732,PALETTE4_RGB8_OES:35728,PALETTE4_RGBA4_OES:35731,PALETTE4_RGBA8_OES:35729,PALETTE8_R5_G6_B5_OES:35735,PALETTE8_RGB5_A1_OES:35737,PALETTE8_RGB8_OES:35733,PALETTE8_RGBA4_OES:35736,PALETTE8_RGBA8_OES:35734,PERCENTAGE_AMD:35779,PERFMON_GLOBAL_MODE_QCOM:36768,PERFMON_RESULT_AMD:35782,PERFMON_RESULT_AVAILABLE_AMD:35780,PERFMON_RESULT_SIZE_AMD:35781,POINTS:0,POLYGON_OFFSET_FACTOR:32824,POLYGON_OFFSET_FILL:32823,POLYGON_OFFSET_UNITS:10752,PROGRAM:33506,PROGRAM_BINARY_ANGLE:37798,PROGRAM_BINARY_FORMATS_OES:34815,PROGRAM_BINARY_LENGTH_OES:34625,PROGRAM_OBJECT_EXT:35648,PROGRAM_PIPELINE_BINDING_EXT:33370,PROGRAM_PIPELINE_OBJECT_EXT:35407,PROGRAM_SEPARABLE_EXT:33368,QCOM_alpha_test:1,QCOM_binning_control:1,QCOM_driver_control:1,QCOM_extended_get:1,QCOM_extended_get2:1,QCOM_perfmon_global_mode:1,QCOM_tiled_rendering:1,QCOM_writeonly_rendering:1,QUERY:33507,QUERY_OBJECT_EXT:37203,QUERY_RESULT_AVAILABLE_EXT:34919,QUERY_RESULT_EXT:34918,R16F_EXT:33325,R32F_EXT:33326,R8_EXT:33321,READ_BUFFER_EXT:3074,READ_BUFFER_NV:3074,READ_FRAMEBUFFER_ANGLE:36008,READ_FRAMEBUFFER_APPLE:36008,READ_FRAMEBUFFER_BINDING_ANGLE:36010,READ_FRAMEBUFFER_BINDING_APPLE:36010,READ_FRAMEBUFFER_BINDING_NV:36010,READ_FRAMEBUFFER_NV:36008,RED_BITS:3410,RED_EXT:6403,RENDERBUFFER:36161,RENDERBUFFER_ALPHA_SIZE:36179,RENDERBUFFER_BINDING:36007,RENDERBUFFER_BLUE_SIZE:36178,RENDERBUFFER_DEPTH_SIZE:36180,RENDERBUFFER_GREEN_SIZE:36177,RENDERBUFFER_HEIGHT:36163,RENDERBUFFER_INTERNAL_FORMAT:36164,RENDERBUFFER_RED_SIZE:36176,RENDERBUFFER_SAMPLES_ANGLE:36011,RENDERBUFFER_SAMPLES_APPLE:36011,RENDERBUFFER_SAMPLES_EXT:36011,RENDERBUFFER_SAMPLES_IMG:37171,RENDERBUFFER_SAMPLES_NV:36011,RENDERBUFFER_STENCIL_SIZE:36181,RENDERBUFFER_WIDTH:36162,RENDERER:7937,RENDER_DIRECT_TO_FRAMEBUFFER_QCOM:36787,REPEAT:10497,REPLACE:7681,REQUIRED_TEXTURE_IMAGE_UNITS_OES:36200,RESET_NOTIFICATION_STRATEGY_EXT:33366,RG16F_EXT:33327,RG32F_EXT:33328,RG8_EXT:33323,RGB:6407,RGB10_A2_EXT:32857,RGB10_EXT:32850,RGB16F_EXT:34843,RGB32F_EXT:34837,RGB565:36194,RGB565_OES:36194,RGB5_A1:32855,RGB5_A1_OES:32855,RGB8_OES:32849,RGBA:6408,RGBA16F_EXT:34842,RGBA32F_EXT:34836,RGBA4:32854,RGBA4_OES:32854,RGBA8_OES:32856,RGB_422_APPLE:35359,RG_EXT:33319,RIGHT:1031,SAMPLER:33510,SAMPLER_2D:35678,SAMPLER_2D_ARRAY_SHADOW_NV:36292,SAMPLER_2D_SHADOW_EXT:35682,SAMPLER_3D_OES:35679,SAMPLER_CUBE:35680,SAMPLER_CUBE_SHADOW_NV:36293,SAMPLER_EXTERNAL_OES:36198,SAMPLES:32937,SAMPLE_ALPHA_TO_COVERAGE:32926,SAMPLE_BUFFERS:32936,SAMPLE_COVERAGE:32928,SAMPLE_COVERAGE_INVERT:32939,SAMPLE_COVERAGE_VALUE:32938,SCISSOR_BOX:3088,SCISSOR_TEST:3089,SGX_BINARY_IMG:35850,SGX_PROGRAM_BINARY_IMG:37168,SHADER:33505,SHADER_BINARY_DMP:37456,SHADER_BINARY_FORMATS:36344,SHADER_BINARY_VIV:36804,SHADER_COMPILER:36346,SHADER_OBJECT_EXT:35656,SHADER_SOURCE_LENGTH:35720,SHADER_TYPE:35663,SHADING_LANGUAGE_VERSION:35724,SHORT:5122,SIGNALED_APPLE:37145,SLUMINANCE8_ALPHA8_NV:35909,SLUMINANCE8_NV:35911,SLUMINANCE_ALPHA_NV:35908,SLUMINANCE_NV:35910,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,SRGB8_ALPHA8_EXT:35907,SRGB8_NV:35905,SRGB_ALPHA_EXT:35906,SRGB_EXT:35904,STACK_OVERFLOW:1283,STACK_UNDERFLOW:1284,STATE_RESTORE:35804,STATIC_DRAW:35044,STENCIL_ATTACHMENT:36128,STENCIL_BACK_FAIL:34817,STENCIL_BACK_FUNC:34816,STENCIL_BACK_PASS_DEPTH_FAIL:34818,STENCIL_BACK_PASS_DEPTH_PASS:34819,STENCIL_BACK_REF:36003,STENCIL_BACK_VALUE_MASK:36004,STENCIL_BACK_WRITEMASK:36005,STENCIL_BITS:3415,STENCIL_BUFFER_BIT:1024,STENCIL_BUFFER_BIT0_QCOM:65536,STENCIL_BUFFER_BIT1_QCOM:131072,STENCIL_BUFFER_BIT2_QCOM:262144,STENCIL_BUFFER_BIT3_QCOM:524288,STENCIL_BUFFER_BIT4_QCOM:1048576,STENCIL_BUFFER_BIT5_QCOM:2097152,STENCIL_BUFFER_BIT6_QCOM:4194304,STENCIL_BUFFER_BIT7_QCOM:8388608,STENCIL_CLEAR_VALUE:2961,STENCIL_EXT:6146,STENCIL_FAIL:2964,STENCIL_FUNC:2962,STENCIL_INDEX1_OES:36166,STENCIL_INDEX4_OES:36167,STENCIL_INDEX:6401,STENCIL_INDEX8:36168,STENCIL_PASS_DEPTH_FAIL:2965,STENCIL_PASS_DEPTH_PASS:2966,STENCIL_REF:2967,STENCIL_TEST:2960,STENCIL_VALUE_MASK:2963,STENCIL_WRITEMASK:2968,STREAM_DRAW:35040,SUBPIXEL_BITS:3408,SYNC_CONDITION_APPLE:37139,SYNC_FENCE_APPLE:37142,SYNC_FLAGS_APPLE:37141,SYNC_FLUSH_COMMANDS_BIT_APPLE:1,SYNC_GPU_COMMANDS_COMPLETE_APPLE:37143,SYNC_OBJECT_APPLE:35411,SYNC_STATUS_APPLE:37140,TEXTURE:5890,TEXTURE0:33984,TEXTURE1:33985,TEXTURE10:33994,TEXTURE11:33995,TEXTURE12:33996,TEXTURE13:33997,TEXTURE14:33998,TEXTURE15:33999,TEXTURE16:34e3,TEXTURE17:34001,TEXTURE18:34002,TEXTURE19:34003,TEXTURE2:33986,TEXTURE20:34004,TEXTURE21:34005,TEXTURE22:34006,TEXTURE23:34007,TEXTURE24:34008,TEXTURE25:34009,TEXTURE26:34010,TEXTURE27:34011,TEXTURE28:34012,TEXTURE29:34013,TEXTURE3:33987,TEXTURE30:34014,TEXTURE31:34015,TEXTURE4:33988,TEXTURE5:33989,TEXTURE6:33990,TEXTURE7:33991,TEXTURE8:33992,TEXTURE9:33993,TEXTURE_2D:3553,TEXTURE_3D_OES:32879,TEXTURE_BINDING_2D:32873,TEXTURE_BINDING_3D_OES:32874,TEXTURE_BINDING_CUBE_MAP:34068,TEXTURE_BINDING_EXTERNAL_OES:36199,TEXTURE_BORDER_COLOR_NV:4100,TEXTURE_COMPARE_FUNC_EXT:34893,TEXTURE_COMPARE_MODE_EXT:34892,TEXTURE_CUBE_MAP:34067,TEXTURE_CUBE_MAP_NEGATIVE_X:34070,TEXTURE_CUBE_MAP_NEGATIVE_Y:34072,TEXTURE_CUBE_MAP_NEGATIVE_Z:34074,TEXTURE_CUBE_MAP_POSITIVE_X:34069,TEXTURE_CUBE_MAP_POSITIVE_Y:34071,TEXTURE_CUBE_MAP_POSITIVE_Z:34073,TEXTURE_DEPTH_QCOM:35796,TEXTURE_EXTERNAL_OES:36197,TEXTURE_FORMAT_QCOM:35798,TEXTURE_HEIGHT_QCOM:35795,TEXTURE_IMAGE_VALID_QCOM:35800,TEXTURE_IMMUTABLE_FORMAT_EXT:37167,TEXTURE_INTERNAL_FORMAT_QCOM:35797,TEXTURE_MAG_FILTER:10240,TEXTURE_MAX_ANISOTROPY_EXT:34046,TEXTURE_MAX_LEVEL_APPLE:33085,TEXTURE_MIN_FILTER:10241,TEXTURE_NUM_LEVELS_QCOM:35801,TEXTURE_OBJECT_VALID_QCOM:35803,TEXTURE_SAMPLES_IMG:37174,TEXTURE_TARGET_QCOM:35802,TEXTURE_TYPE_QCOM:35799,TEXTURE_USAGE_ANGLE:37794,TEXTURE_WIDTH_QCOM:35794,TEXTURE_WRAP_R_OES:32882,TEXTURE_WRAP_S:10242,TEXTURE_WRAP_T:10243,TIMEOUT_EXPIRED_APPLE:37147,TIMEOUT_IGNORED_APPLE:0x10000000000000000,TRANSLATED_SHADER_SOURCE_LENGTH_ANGLE:37792,TRIANGLES:4,TRIANGLE_FAN:6,TRIANGLE_STRIP:5,TRUE:1,UNKNOWN_CONTEXT_RESET_EXT:33365,UNPACK_ALIGNMENT:3317,UNPACK_ROW_LENGTH:3314,UNPACK_SKIP_PIXELS:3316,UNPACK_SKIP_ROWS:3315,UNSIGNALED_APPLE:37144,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_INT64_AMD:35778,UNSIGNED_INT_10_10_10_2_OES:36342,UNSIGNED_INT_24_8_OES:34042,UNSIGNED_INT_2_10_10_10_REV_EXT:33640,UNSIGNED_NORMALIZED_EXT:35863,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_1_5_5_5_REV_EXT:33638,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_4_4_4_4_REV_EXT:33637,UNSIGNED_SHORT_4_4_4_4_REV_IMG:33637,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635,UNSIGNED_SHORT_8_8_APPLE:34234,UNSIGNED_SHORT_8_8_REV_APPLE:34235,VALIDATE_STATUS:35715,VENDOR:7936,VERSION:7938,VERTEX_ARRAY_BINDING_OES:34229,VERTEX_ARRAY_OBJECT_EXT:37204,VERTEX_ATTRIB_ARRAY_BUFFER_BINDING:34975,VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE:35070,VERTEX_ATTRIB_ARRAY_DIVISOR_NV:35070,VERTEX_ATTRIB_ARRAY_ENABLED:34338,VERTEX_ATTRIB_ARRAY_NORMALIZED:34922,VERTEX_ATTRIB_ARRAY_POINTER:34373,VERTEX_ATTRIB_ARRAY_SIZE:34339,VERTEX_ATTRIB_ARRAY_STRIDE:34340,VERTEX_ATTRIB_ARRAY_TYPE:34341,VERTEX_SHADER:35633,VERTEX_SHADER_BIT_EXT:1,VIEWPORT:2978,VIV_shader_binary:1,WAIT_FAILED_APPLE:37149,WRITEONLY_RENDERING_QCOM:34851,WRITE_ONLY_OES:35001,Z400_BINARY_AMD:34624,ZERO:0,RASTERIZER_DISCARD:35977,UNPACK_FLIP_Y_WEBGL:37440,UNPACK_PREMULTIPLY_ALPHA_WEBGL:37441,CONTEXT_LOST_WEBGL:37442,UNPACK_COLORSPACE_CONVERSION_WEBGL:37443,BROWSER_DEFAULT_WEBGL:37444},In={};function Rn(t){var e=Ln();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Ln(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var On=new Map,Dn=new Map,Nn=new Map;var zn=function(t){Yt(n,t);var e=Rn(n);function n(){var t;return Ot(this,n),t=e.call(this),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,On.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return zt(n,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=Nn.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Dn.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\n")}},{key:"getResponseHeader",value:function(t){return Dn.get("responseHeader")[t]}},{key:"open",value:function(t,e,n){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var n=On.get("requestHeader");n[t]=e,On.set("requestHeader",n)}},{key:"addEventListener",value:function(t,e){var n=this;"function"===typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||n,e.call(n,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),n}(ye);zn.UNSEND=0,zn.OPENED=1,zn.HEADERS_RECEIVED=2,zn.LOADING=3,zn.DONE=4;function Fn(t){return function(e){e.type=t,cn.dispatchEvent(e)}}var Bn=Fn("mousedown"),Un=Fn("mousemove"),jn=Fn("mouseup");function Zn(t){var e=Vn();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Vn(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Gn=function(t){Yt(n,t);var e=Zn(n);function n(t){var r;return Ot(this,n),r=e.call(this,t),r.target=tn(),r.currentTarget=tn(),r}return zt(n)}(pe),Hn=["bubbles","cancelable","view","detail","screenX","screenY","clientX","clientY","ctrlKey","altKey","shiftKey","metaKey","button","relatedTarget","pointerId","width","height","pressure","tiltX","tiltY","pointerType","hwTimestamp","isPrimary","pageX","pageY","timeStamp"],Wn=[!1,!1,null,null,0,0,0,0,!1,!1,!1,!1,0,null,0,0,0,0,0,0,0,"",0,!1,0,0,0],qn="touch";function Xn(t,e,n){for(var r=new Gn(t),i=0;i<Hn.length;i++){var o=Hn[i];r[o]=e[o]||Wn[i]}return r.type=t,r.target=tn(),r.currentTarget=tn(),r.buttons=Yn(t),r.which=r.buttons,r.pointerId=(e.identifier||0)+2,r.bubbles=!0,r.cancelable=!0,r.button=0,r.width=2*(e.radiusX||.5),r.height=2*(e.radiusY||.5),r.pressure=e.force||.5,r.isPrimary=Qn(e),r.pointerType=qn,r.altKey=n.altKey,r.ctrlKey=n.ctrlKey,r.metaKey=n.metaKey,r.shiftKey=n.shiftKey,n.preventDefault&&(r.preventDefault=function(){n.preventDefault()}),r}function Yn(t){var e=0;return"touchstart"!==t&&"touchmove"!==t&&"pointerdown"!==t&&"pointermove"!==t||(e=1),e}var Kn=null;function Qn(t){return Kn===t.identifier}function Jn(t){null===Kn&&(Kn=t.identifier)}function $n(t){Kn===t.identifier&&(Kn=null)}function tr(t){return function(e){for(var n=e.changedTouches,r=0;r<n.length;r++){var i=n[r];0===r&&"pointerdown"===t?Jn(i):"pointerup"!==t&&"pointercancel"!==t||$n(i);var o=Xn(t,i,e);cn.dispatchEvent(o)}}}var er=tr("pointerdown"),nr=tr("pointermove"),rr=tr("pointerup");function ir(t){var e=or();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function or(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ar=function(t){Yt(n,t);var e=ir(n);function n(t){var r;return Ot(this,n),r=e.call(this,t),r.touches=[],r.targetTouches=[],r.changedTouches=[],r.target=tn(),r.currentTarget=tn(),r}return zt(n)}(pe);function sr(t){var e=t||{},n=e.x,r=void 0===n?0:n,i=e.y,o=void 0===i?0:i,a=e.clientX,s=void 0===a?0:a,u=e.clientY,c=void 0===u?0:u;-1!==Object.keys(t).indexOf("x")?(t.pageX=t.clientX=r,t.pageY=t.clientY=o):(t.x=s,t.y=c)}function ur(t){return function(e){var n=new ar(t);n.changedTouches=e.changedTouches,n.touches=e.touches,n.targetTouches=Array.prototype.slice.call(e.touches),n.timeStamp=e.timeStamp,n.changedTouches.forEach((function(t){return sr(t)})),n.touches.forEach((function(t){return sr(t)})),n.targetTouches.forEach((function(t){return sr(t)})),cn.dispatchEvent(n)}}function cr(t){return function(e){e.type=t,cn.dispatchEvent(e)}}var lr=ur("touchstart"),hr=ur("touchmove"),fr=ur("touchend"),pr=cr("mapCameaParams"),dr=!1;function vr(t){dr=t}var mr="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,gr="undefined"!==typeof wx&&null!==wx&&("undefined"!==typeof wx.request||"undefined"!==typeof wx.miniProgram),yr=(mr||gr)&&dr,_r={atob:oe,btoa:ae,devicePixelRatio:fe,Blob:ce,document:cn,Element:ke,Event:pe,EventTarget:ye,HTMLCanvasElement:pn,HTMLElement:We,HTMLMediaElement:Ye,HTMLVideoElement:Je,Image:en,ImageData:dn,navigator:bn,Node:be,requestAnimationFrame:Tn,cancelAnimationFrame:Cn,screen:Le,XMLHttpRequest:zn,performance:wn,URL:kn,WebGLRenderingContext:Pn,WebGL2RenderingContext:In,addEventListener:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};cn.addEventListener(t,e,n)},removeEventListener:function(t,e,n){cn.removeEventListener(t,e)},dispatchEvent:function(t){cn.dispatchEvent(t)},innerWidth:Le.availWidth,innerHeight:Le.availHeight,setTimeout:setTimeout,clearTimeout:clearTimeout,setInterval:setInterval,clearInterval:clearInterval},xr=yr?_r:ue,br=yr?zn:ue.XMLHttpRequest,wr=yr?nn:ue.location;function Er(t){var e=Sr();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Sr(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ar=function(t){Yt(n,t);var e=Er(n);function n(t,r,i,o){var a;return Ot(this,n),a=e.call(this,"AJAXError: ".concat(r," (").concat(t,"): ").concat(i)),a.status=t,a.statusText=r,a.url=i,a.body=o,a}return zt(n)}(ne(Error));function Tr(t,e){var n=new br,r=Array.isArray(t.url)?t.url[0]:t.url;for(var i in n.open(t.method||"GET",r,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)t.headers.hasOwnProperty(i)&&n.setRequestHeader(i,t.headers[i]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var i=n.response;if("json"===t.type)try{i=JSON.parse(n.response)}catch(a){return e(a)}e(null,i,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"),n)}else{var o=new Blob([n.response],{type:n.getResponseHeader("Content-Type")});e(new Ar(n.status,n.statusText,r.toString(),o))}},n.send(t.body),n}function Cr(t){return new Promise((function(e,n){Tr(t,(function(t,r,i,o,a){t?n({err:t,data:null,xhr:a}):e({err:null,data:r,cacheControl:i,expires:o,xhr:a})}))}))}function kr(t,e){return Tr(t,e)}var Mr=function(t,e){return kr((0,k.Z)((0,k.Z)({},t),{},{type:"json"}),e)},Pr=function(t,e){return kr((0,k.Z)((0,k.Z)({},t),{},{type:"arrayBuffer"}),e)},Ir=function(t,e){return kr((0,k.Z)((0,k.Z)({},t),{},{method:"POST"}),e)};function Rr(t){var e=xr.document.createElement("a");return e.href=t,e.protocol===xr.document.location.protocol&&e.host===xr.document.location.host}var Lr="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function Or(t,e){var n=new xr.Image,r=xr.URL||xr.webkitURL;n.crossOrigin="anonymous",n.onload=function(){e(null,n),r.revokeObjectURL(n.src),n.onload=null,window.requestAnimationFrame((function(){n.src=Lr}))},n.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?r.createObjectURL(i):Lr}function Dr(t,e){var n=new Blob([new Uint8Array(t)],{type:"image/png"});createImageBitmap(n).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of ".concat(t.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))}))}var Nr=function(t,e,n){var r=function(t,r){if(t)e(t);else if(r){var i="function"===typeof createImageBitmap,o=n?n(r):r;i?Dr(o,e):Or(o,e)}};return"json"===t.type?Mr(t,r):Pr(t,r)},zr=function(t,e){var n="function"===typeof createImageBitmap;n?Dr(t,e):Or(t,e)},Fr=function(t){return t["CENTER"]="center",t["TOP"]="top",t["TOP-LEFT"]="top-left",t["TOP-RIGHT"]="top-right",t["BOTTOM"]="bottom",t["BOTTOM-LEFT"]="bottom-left",t["BOTTOM-RIGHT"]="bottom-right",t["LEFT"]="left",t["RIGHT"]="right",t}({}),Br={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Ur(t,e,n){var r=t.classList;for(var i in Br)Br.hasOwnProperty(i)&&r.remove("l7-".concat(n,"-anchor-").concat(i));r.add("l7-".concat(n,"-anchor-").concat(e))}n(73210);function jr(t,e,n){t.prototype=e.prototype=n,n.constructor=t}function Zr(t,e){var n=Object.create(t.prototype);for(var r in e)n[r]=e[r];return n}function Vr(){}var Gr=.7,Hr=1/Gr,Wr="\\s*([+-]?\\d+)\\s*",qr="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)\\s*",Xr="\\s*([+-]?\\d*\\.?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Yr=/^#([0-9a-f]{3,8})$/,Kr=new RegExp("^rgb\\("+[Wr,Wr,Wr]+"\\)$"),Qr=new RegExp("^rgb\\("+[Xr,Xr,Xr]+"\\)$"),Jr=new RegExp("^rgba\\("+[Wr,Wr,Wr,qr]+"\\)$"),$r=new RegExp("^rgba\\("+[Xr,Xr,Xr,qr]+"\\)$"),ti=new RegExp("^hsl\\("+[qr,Xr,Xr]+"\\)$"),ei=new RegExp("^hsla\\("+[qr,Xr,Xr,qr]+"\\)$"),ni={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};function ri(){return this.rgb().formatHex()}function ii(){return mi(this).formatHsl()}function oi(){return this.rgb().formatRgb()}function ai(t){var e,n;return t=(t+"").trim().toLowerCase(),(e=Yr.exec(t))?(n=e[1].length,e=parseInt(e[1],16),6===n?si(e):3===n?new hi(e>>8&15|e>>4&240,e>>4&15|240&e,(15&e)<<4|15&e,1):8===n?ui(e>>24&255,e>>16&255,e>>8&255,(255&e)/255):4===n?ui(e>>12&15|e>>8&240,e>>8&15|e>>4&240,e>>4&15|240&e,((15&e)<<4|15&e)/255):null):(e=Kr.exec(t))?new hi(e[1],e[2],e[3],1):(e=Qr.exec(t))?new hi(255*e[1]/100,255*e[2]/100,255*e[3]/100,1):(e=Jr.exec(t))?ui(e[1],e[2],e[3],e[4]):(e=$r.exec(t))?ui(255*e[1]/100,255*e[2]/100,255*e[3]/100,e[4]):(e=ti.exec(t))?vi(e[1],e[2]/100,e[3]/100,1):(e=ei.exec(t))?vi(e[1],e[2]/100,e[3]/100,e[4]):ni.hasOwnProperty(t)?si(ni[t]):"transparent"===t?new hi(NaN,NaN,NaN,0):null}function si(t){return new hi(t>>16&255,t>>8&255,255&t,1)}function ui(t,e,n,r){return r<=0&&(t=e=n=NaN),new hi(t,e,n,r)}function ci(t){return t instanceof Vr||(t=ai(t)),t?(t=t.rgb(),new hi(t.r,t.g,t.b,t.opacity)):new hi}function li(t,e,n,r){return 1===arguments.length?ci(t):new hi(t,e,n,null==r?1:r)}function hi(t,e,n,r){this.r=+t,this.g=+e,this.b=+n,this.opacity=+r}function fi(){return"#"+di(this.r)+di(this.g)+di(this.b)}function pi(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(1===t?"rgb(":"rgba(")+Math.max(0,Math.min(255,Math.round(this.r)||0))+", "+Math.max(0,Math.min(255,Math.round(this.g)||0))+", "+Math.max(0,Math.min(255,Math.round(this.b)||0))+(1===t?")":", "+t+")")}function di(t){return t=Math.max(0,Math.min(255,Math.round(t)||0)),(t<16?"0":"")+t.toString(16)}function vi(t,e,n,r){return r<=0?t=e=n=NaN:n<=0||n>=1?t=e=NaN:e<=0&&(t=NaN),new yi(t,e,n,r)}function mi(t){if(t instanceof yi)return new yi(t.h,t.s,t.l,t.opacity);if(t instanceof Vr||(t=ai(t)),!t)return new yi;if(t instanceof yi)return t;t=t.rgb();var e=t.r/255,n=t.g/255,r=t.b/255,i=Math.min(e,n,r),o=Math.max(e,n,r),a=NaN,s=o-i,u=(o+i)/2;return s?(a=e===o?(n-r)/s+6*(n<r):n===o?(r-e)/s+2:(e-n)/s+4,s/=u<.5?o+i:2-o-i,a*=60):s=u>0&&u<1?0:a,new yi(a,s,u,t.opacity)}function gi(t,e,n,r){return 1===arguments.length?mi(t):new yi(t,e,n,null==r?1:r)}function yi(t,e,n,r){this.h=+t,this.s=+e,this.l=+n,this.opacity=+r}function _i(t,e,n){return 255*(t<60?e+(n-e)*t/60:t<180?n:t<240?e+(n-e)*(240-t)/60:e)}function xi(t){return"string"===typeof t&&!!ai(t)}function bi(t){var e=ai(t),n=[0,0,0,0];return null!=e&&(n[0]=e.r/255,n[1]=e.g/255,n[2]=e.b/255,n[3]=e.opacity),n}function wi(t){var e=t&&t[0],n=t&&t[1],r=t&&t[2],i=e+256*n+65536*r-1;return i}function Ei(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}function Si(t){var e=xr.document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;for(var r=null,i=n.createLinearGradient(0,0,256,1),o=t.positions[0],a=t.positions[t.positions.length-1],s=0;s<t.colors.length;++s){var u=(t.positions[s]-o)/(a-o);i.addColorStop(u,t.colors[s])}if(n.fillStyle=i,n.fillRect(0,0,256,1),yr)return r=new Uint8ClampedArray(n.getImageData(0,0,256,1).data),e=null,n=null,{data:r,width:256,height:1};r=n.getImageData(0,0,256,1).data;for(var c=n.createImageData(256,1),l=0;l<c.data.length;l+=4)c.data[l+0]=r[l+0],c.data[l+1]=r[l+1],c.data[l+2]=r[l+2],c.data[l+3]=r[l+3];return e=null,n=null,c}function Ai(t,e){var n=xr.document.createElement("canvas"),r=n.getContext("2d");n.width=256,n.height=1;for(var i=r.createLinearGradient(0,0,256,1),o=e[1]-e[0],a=0;a<t.colors.length;++a){var s=Math.max((t.positions[a]-e[0])/o,0);i.addColorStop(s,t.colors[a])}r.fillStyle=i,r.fillRect(0,0,256,1);var u=r.getImageData(0,0,256,1).data,c=Mi(r,u);return n=null,r=null,c}function Ti(t){var e=xr.document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;var r=n.createImageData(256,1);return r.data.fill(0),t.positions.forEach((function(e,n){var i=bi(t.colors[n]);r.data[4*e+0]=255*i[0],r.data[4*e+1]=255*i[1],r.data[4*e+2]=255*i[2],r.data[4*e+3]=255*i[3]})),e=null,n=null,r}function Ci(t){var e=xr.document.createElement("canvas"),n=e.getContext("2d");n.globalAlpha=1,e.width=256,e.height=1;for(var r=256/t.colors.length,i=0;i<t.colors.length;i++)n.beginPath(),n.lineWidth=2,n.strokeStyle=t.colors[i],n.moveTo(i*r,0),n.lineTo((i+1)*r,0),n.stroke();var o=n.getImageData(0,0,256,1).data,a=Mi(n,o);return e=null,n=null,a}function ki(t,e){var n=xr.document.createElement("canvas"),r=n.getContext("2d");r.globalAlpha=1,n.width=256,n.height=1;var i=e[1]-e[0];t.positions.length,t.colors.length;for(var o=0;o<t.colors.length;o++)r.beginPath(),r.lineWidth=2,r.strokeStyle=t.colors[o],r.moveTo((t.positions[o]-e[0])/i*255,0),r.lineTo((t.positions[o+1]-e[0])/i*255,0),r.stroke();var a=r.getImageData(0,0,256,1).data,s=Mi(r,a);return n=null,r=null,s}function Mi(t,e){for(var n=t.createImageData(256,1),r=0;r<n.data.length;r+=4)n.data[r+0]=e[r+0],n.data[r+1]=e[r+1],n.data[r+2]=e[r+2],n.data[r+3]=e[r+3];return n}function Pi(t){switch(t.type){case"cat":return[0,255];default:return[0,1]}}jr(Vr,ai,{copy:function(t){return Object.assign(new this.constructor,this,t)},displayable:function(){return this.rgb().displayable()},hex:ri,formatHex:ri,formatHsl:ii,formatRgb:oi,toString:oi}),jr(hi,li,Zr(Vr,{brighter:function(t){return t=null==t?Hr:Math.pow(Hr,t),new hi(this.r*t,this.g*t,this.b*t,this.opacity)},darker:function(t){return t=null==t?Gr:Math.pow(Gr,t),new hi(this.r*t,this.g*t,this.b*t,this.opacity)},rgb:function(){return this},displayable:function(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:fi,formatHex:fi,formatRgb:pi,toString:pi})),jr(yi,gi,Zr(Vr,{brighter:function(t){return t=null==t?Hr:Math.pow(Hr,t),new yi(this.h,this.s,this.l*t,this.opacity)},darker:function(t){return t=null==t?Gr:Math.pow(Gr,t),new yi(this.h,this.s,this.l*t,this.opacity)},rgb:function(){var t=this.h%360+360*(this.h<0),e=isNaN(t)||isNaN(this.s)?0:this.s,n=this.l,r=n+(n<.5?n:1-n)*e,i=2*n-r;return new hi(_i(t>=240?t-240:t+120,i,r),_i(t,i,r),_i(t<120?t+240:t-120,i,r),this.opacity)},displayable:function(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl:function(){var t=this.opacity;return t=isNaN(t)?1:Math.max(0,Math.min(1,t)),(1===t?"hsl(":"hsla(")+(this.h||0)+", "+100*(this.s||0)+"%, "+100*(this.l||0)+"%"+(1===t?")":", "+t+")")}}));var Ii={BACK:1029,FRONT:1028};function Ri(t){switch(t){case"GAODE1.x":return Ii.BACK;case"GAODE2.x":return Ii.BACK;case"MAPBOX":return Ii.FRONT;case"SIMPLE":return Ii.FRONT;case"GLOBEL":return Ii.BACK;case"DEBAULT":return Ii.FRONT;default:return Ii.FRONT}}var Li=n(78910),Oi=n(51579);function Di(t){var e=t;return"string"===typeof t&&(e=xr.document.getElementById(t)),e}function Ni(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function zi(t){return Ni(t).split(/\s+/)}function Fi(t){var e,n,r=null===xr||void 0===xr||null===(e=xr.document)||void 0===e||null===(n=e.documentElement)||void 0===n?void 0:n.style;if(!r)return t[0];for(var i in t)if(t[i]&&t[i]in r)return t[i];return t[0]}function Bi(t,e,n){var r=xr.document.createElement(t);return e&&(r.className=e||""),n&&n.appendChild(r),r}function Ui(t){var e=t.parentNode;e&&e.removeChild(t)}function ji(t,e){if(void 0!==t.classList)for(var n=zi(e),r=0,i=n.length;r<i;r++)t.classList.add(n[r]);else if(!Vi(t,e)){var o=Hi(t);Gi(t,(o?o+" ":"")+e)}}function Zi(t,e){if(void 0!==t.classList){var n=zi(e);n.forEach((function(e){t.classList.remove(e)}))}else Gi(t,Ni((" "+Hi(t)+" ").replace(" "+e+" "," ")))}function Vi(t,e){if(void 0!==t.classList)return t.classList.contains(e);var n=Hi(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function Gi(t,e){t instanceof HTMLElement?t.className=e:t.className.baseVal=e}function Hi(t){return t instanceof SVGElement&&(t=t.correspondingElement),void 0===t.className.baseVal?t.className:t.className.baseVal}function Wi(t){while(t&&t.firstChild)t.removeChild(t.firstChild)}var qi=Fi(["transform","WebkitTransform"]);function Xi(t,e){t.style[qi]=e}function Yi(){if("function"===typeof Event)xr.dispatchEvent(new Event("resize"));else{var t=xr.document.createEvent("UIEvents");t.initUIEvent("resize",!0,!1,xr,0),xr.dispatchEvent(t)}}function Ki(t){t.height,t.width,t.height,t.toDataURL()}function Qi(){var t,e=xr.document.querySelector('meta[name="viewport"]');if(!e)return 1;var n=null===(t=e.content)||void 0===t?void 0:t.split(","),r=n.find((function(t){var e=t.split("="),n=(0,Li.Z)(e,1),r=n[0];return"initial-scale"===r}));return r?1*r.split("=")[1]:1}var Ji,$i=Qi()<1?1:xr.devicePixelRatio;function to(t,e){t.setAttribute("style","".concat(t.style.cssText).concat(e))}function eo(t){return t.split(";").map((function(t){return t.trim()})).filter((function(t){return t}))}function no(t,e){var n,r=eo(null!==(n=t.getAttribute("style"))&&void 0!==n?n:""),i=eo(e),o=Oi.pull.apply(void 0,[r].concat((0,C.Z)(i)));t.setAttribute("style",o.join(";"))}function ro(t){return Object.entries(t).map((function(t){var e=(0,Li.Z)(t,2),n=e[0],r=e[1];return"".concat(n,": ").concat(r)})).join(";")}function io(t,e){return{left:t.left-e.left,top:t.top-e.top,right:e.left+e.width-t.left-t.width,bottom:e.top+e.height-t.top-t.height}}function oo(t,e){t.checked=e,e?t.setAttribute("checked","true"):t.removeAttribute("checked")}function ao(t){t.innerHTML=""}function so(t){t.setAttribute("draggable","false")}function uo(t,e){if("string"===typeof e){var n=document.createElement("div");n.innerHTML=e;while(n.firstChild)t.append(n.firstChild)}else Array.isArray(e)?t.append.apply(t,(0,C.Z)(e)):t.append(e)}function co(t){return"undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap}function lo(){return"function"===typeof importScripts}var ho=lo()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===window.location.protocol?window.parent:window).location.href},fo=null===(Ji=navigator)||void 0===Ji?void 0:Ji.userAgent,po=!!fo.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),vo=fo.indexOf("Android")>-1||fo.indexOf("Adr")>-1;function mo(){for(var t=fo,e=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],n=!0,r=0,i=e;r<i.length;r++){var o=i[r];if(t.indexOf(o)>0){n=!1;break}}return n}function go(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}var yo=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16;Ot(this,t),(0,Ft.Z)(this,"duration",16),(0,Ft.Z)(this,"timestamp",(new Date).getTime()),this.duration=e}return zt(t,[{key:"run",value:function(t){var e=(new Date).getTime(),n=e-this.timestamp;this.timestamp=e,n>=this.duration&&t()}}]),t}();function _o(t){var e=[1/0,1/0,-1/0,-1/0];return G(t,(function(t){e[0]>t[0]&&(e[0]=t[0]),e[1]>t[1]&&(e[1]=t[1]),e[2]<t[0]&&(e[2]=t[0]),e[3]<t[1]&&(e[3]=t[1])})),e}_o["default"]=_o;var xo=_o;function bo(t){return"number"===typeof t}var wo=2*Math.PI*6378137/2;function Eo(t,e){var n=(0,Li.Z)(e,4),r=n[0],i=n[1],o=n[2],a=n[3];return t.lng>r&&t.lng<=o&&t.lat>i&&t.lat<=a}function So(t){var e=[1/0,1/0,-1/0,-1/0];return t.forEach((function(t){var n=t.coordinates;Ao(e,n)})),e}function Ao(t,e){return Array.isArray(e[0])?e.forEach((function(e){Ao(t,e)})):(t[0]>e[0]&&(t[0]=e[0]),t[1]>e[1]&&(t[1]=e[1]),t[2]<e[0]&&(t[2]=e[0]),t[3]<e[1]&&(t[3]=e[1])),t}function To(t,e){return Co(t,e)}function Co(t,e){return Array.isArray(t[0])?t.map((function(t){return Co(t,e)})):e(t)}function ko(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{enable:!0,decimal:1};t=Ro(t,e);var r=t[0],i=t[1],o=r*wo/180,a=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return a=a*wo/180,n.enable&&(o=Number(o.toFixed(n.decimal)),a=Number(a.toFixed(n.decimal))),3===t.length?[o,a,t[2]]:[o,a]}function Mo(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:6,n=t[0],r=t[1],i=n/wo*180,o=r/wo*180;return o=180/Math.PI*(2*Math.atan(Math.exp(o*Math.PI/180))-Math.PI/2),void 0!==e&&null!==e&&(i=Number(i.toFixed(e)),o=Number(o.toFixed(e))),3===t.length?[i,o,t[2]]:[i,o]}function Po(t){if(void 0===t||null===t)throw new Error("lng is required");return(t>180||t<-180)&&(t%=360,t>180&&(t=-360+t),t<-180&&(t=360+t),0===t&&(t=0)),t}function Io(t){if(void 0===t||null===t)throw new Error("lat is required");return(t>90||t<-90)&&(t%=180,t>90&&(t=-180+t),t<-90&&(t=180+t),0===t&&(t=0)),t}function Ro(t,e){if(!1===e)return t;var n=Po(t[0]),r=Io(t[1]);return r>85&&(r=85),r<-85&&(r=-85),3===t.length?[n,r,t[2]]:[n,r]}function Lo(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));var s=.5/Math.PI,u=.5,c=-.5/Math.PI;return i=.5,o=r*(s*o+u),a=r*(c*a+i),[Math.floor(o),Math.floor(a)]}function Oo(t){var e=.5/Math.PI,n=.5,r=-.5/Math.PI,i=.5,o=256<<20,a=(0,Li.Z)(t,2),s=a[0],u=a[1];s=(s/o-n)/e,u=(u/o-i)/r,u=2*(Math.atan(Math.pow(Math.E,u))-Math.PI/4),i=Math.PI/180;var c=u/i,l=s/i;return[l,c]}function Do(t,e){var n=85.0511287798,r=Math.PI/180,i=6378137;return e=Math.max(Math.min(n,e),-n),t*=r,e*=r,e=Math.log(Math.tan(Math.PI/4+e/2)),[t*i,e*i]}function No(t,e){var n=Math.PI/180,r=6378137,i=t/r/n,o=2*(Math.atan(Math.exp(e/r))-Math.PI/4)/n;return[i,o]}function zo(t,e,n){var r=j(e[1]-t[1]),i=j(e[0]-t[0]),o=j(t[1]),a=j(e[1]),s=Math.pow(Math.sin(r/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(o)*Math.cos(a);return B(2*Math.atan2(Math.sqrt(s),Math.sqrt(1-s)),"meters")}function Fo(t){var e=Math.PI/180,n=85.0511287798,r=6378137,i=Math.max(Math.min(n,t[1]),-n),o=Math.sin(i*e),a=r*t[0]*e,s=r*Math.log((1+o)/(1-o))/2;return[a,s]}function Bo(t,e){var n=Math.abs(t[1][1]-t[0][1])*e,r=Math.abs(t[1][0]-t[0][0])*e;return[[t[0][0]-r,t[0][1]-n],[t[1][0]+r,t[1][1]+n]]}function Uo(t,e){return t[0][0]<=e[0][0]&&t[0][1]<=e[0][1]&&t[1][0]>=e[1][0]&&t[1][1]>=e[1][1]}function jo(t){return[[t[0],t[1]],[t[2],t[3]]]}function Zo(t){var e=Vo(t,[0,0]);return[t[0]/e,t[1]/e]}function Vo(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function Go(t,e){return t[0]*e[0]+t[1]*e[1]}function Ho(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Wo(t,e){return 180*Math.acos(Go(t,e)/(Ho(t)*Ho(e)))/Math.PI}function qo(t,e){return e[0]>0?e[1]>0?90-180*Math.atan(e[1]/e[0])/Math.PI:90+180*Math.atan(-e[1]/e[0])/Math.PI:e[1]<0?90-180*Math.atan(e[1]/e[0])/Math.PI+180:270+180*Math.atan(e[1]/-e[0])/Math.PI}function Xo(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100;if(t&&!(t.length<2)){for(var n=[0,1],r=0,i=[],o=0;o<t.length-1;o++){var a=t[o],s=t[o+1],u=Vo(a,s);r+=u;var c=[a[0]-s[0],a[1]-s[1]],l=qo(n,c);if(o>0){var h=i[o-1].rotation;h-l>360-h+l&&(l+=360)}i.push({start:a,end:s,dis:u,rotation:l,duration:0})}return i.map((function(t){t.duration=e*(t.dis/r)})),i}}function Yo(t){if(bo(t[0]))return t;if(bo(t[0][0]))throw new Error("当前数据不支持标注");if(bo(t[0][0][0])){var e=t,n=0,r=0,i=0;return e.forEach((function(t){t.forEach((function(t){n+=t[0],r+=t[1],i++}))})),[n/i,r/i,0]}throw new Error("当前数据不支持标注")}function Ko(t){for(var e=t[0],n=t[1],r=t[0],i=t[1],o=0,a=0,s=0,u=0;u<t.length;u+=2){var c=t[u],l=t[u+1];c&&l&&(e=Math.max(c,e),n=Math.max(l,n),r=Math.min(c,r),i=Math.min(l,i),o+=c,a+=l,s++)}return{center:[o/s,a/s],radius:Math.sqrt(Math.pow(e-r,2)+Math.pow(n-i,2))/2}}function Qo(t){return xo(z([N(t)]))}function Jo(t){var e=131,n=137,r=0;t+="x";for(var i=Math.floor(9007199254740991/n),o=0;o<t.length;o++)r>i&&(r=Math.floor(r/n)),r=r*e+t.charCodeAt(o);return r}function $o(t){t=t.toString();var e=5381,n=t.length;while(n)e=33*e^t.charCodeAt(--n);return e>>>0}function ta(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(t){var e=16*Math.random()|0,n="x"===t?e:3&e|8;return n.toString(16)}))}var ea=function(t){return t["GAODE1.x"]="GAODE1.x",t["GAODE2.x"]="GAODE2.x",t["MAPBOX"]="MAPBOX",t["DEFAULT"]="DEFAUlTMAP",t["SIMPLE"]="SIMPLE",t["GLOBEL"]="GLOBEL",t}({});function na(t,e,n,r,i){var o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=arguments.length>6?arguments[6]:void 0,s=n;return a&&(s=Math.round(n*(o-1))/(o-1)),aa(t,e,s,r||.314,i)}function ra(t,e){var n=1-e;return(t[0]*n+t[1]*e)*n+(t[1]*n+t[2]*e)*e}function ia(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function oa(t,e,n){var r=[e[0]-t[0],e[1]-t[1]],i=ia(r,[0,0]),o=Math.atan2(r[1],r[0]),a=i/2/Math.cos(n),s=o+n,u=[a*Math.cos(s)+t[0],a*Math.sin(s)+t[1]];return u}function aa(t,e,n,r,i){if(i===ea["GAODE2.x"]){var o=Do(t[0],t[1]),a=Do(e[0],e[1]),s=oa(o,a,r),u=[o[0],s[0],a[0]],c=[o[1],s[1],a[1]];return[].concat((0,C.Z)(No(ra(u,n),ra(c,n))),[0])}var l=oa(t,e,r),h=[t[0],l[0],e[0]],f=[t[1],l[1],e[1]];return[ra(h,n),ra(f,n),0]}function sa(t,e,n,r,i){var o=arguments.length>6?arguments[6]:void 0,a=n;return o&&(a=Math.round(29*n)/29),ha(t,e,a,i)}function ua(t,e){var n=[e[0]-t[0],e[1]-t[1]],r=Vo(n,[0,0]),i=Math.atan2(n[1],n[0]),o=.314,a=r/2/Math.cos(o),s=i+o,u=[a*Math.cos(s)+t[0],a*Math.sin(s)+t[1]];return u}function ca(t,e){var n=1-e;return(t[0]*n+t[1]*e)*n+(t[1]*n+t[2]*e)*e}function la(t,e){var n=[t[0]-e[0],t[1]-e[1]],r=[Math.sin(n[0]/2),Math.sin(n[1]/2)],i=r[1]*r[1]+Math.cos(t[1])*Math.cos(e[1])*r[0]*r[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function ha(t,e,n,r){var i=[j(t[0]),j(t[1])],o=[j(e[0]),j(e[1])];if("GAODE2.x"===r){var a=ua(i,o),s=[i[0],a[0],o[0]],u=[i[1],a[1],o[1]];return[ca(s,n),ca(u,n),0]}var c=la(i,o);if(Math.abs(c-Math.PI)<.001)return[(1-n)*i[0]+n*o[0],(1-n)*i[1]+n*o[1]];var l=Math.sin((1-n)*c)/Math.sin(c),h=Math.sin(n*c)/Math.sin(c),f=[Math.sin(i[0]),Math.sin(i[1])],p=[Math.cos(i[0]),Math.cos(i[1])],d=[Math.sin(o[0]),Math.sin(o[1])],v=[Math.cos(o[0]),Math.cos(o[1])],m=l*p[1]*p[0]+h*v[1]*v[0],g=l*p[1]*f[0]+h*v[1]*d[0],y=l*f[1]+h*d[1];return[U(Math.atan2(g,m)),U(Math.atan2(y,Math.sqrt(m*m+g*g)))]}function fa(t,e){for(var n=0,r=[],i=0;i<t.length-1;i++){var o=t[i],a=t[i+1],s=da(o,a),u=n;n+=s,r.push({p1:o,p2:a,totalDistance:n,distance:s,lastTotalDistance:u})}for(var c,l,h=n*e,f=0,p=r;f<p.length;f++){var d=p[f],v=d.totalDistance;if(v>h){var m=d.p1,g=d.p2,y=(h-d.lastTotalDistance)/d.distance,_=pa(g,m,y);c=_[0],l=_[1];break}}return{lng:c,lat:l,height:0}}function pa(t,e,n){return[t[0]*n+e[0]*(1-n),t[1]*n+e[1]*(1-n)]}function da(t,e){return Math.sqrt(Math.pow(t[0]-e[0],2)+Math.pow(t[1]-e[1],2))}function va(t,e){var n=e.featureId,r=t.data.dataArray;return"number"===typeof n&&(r=r.filter((function(t){var e=t.id;return e===n}))),r.map((function(t){var n=ga(t,e);return(0,k.Z)((0,k.Z)({},t),n)}))}function ma(t,e){return new Promise((function(n){t.inited?n(va(t,e)):t.once("update",(function(){n(va(t,e))}))}))}function ga(t,e){var n=e.offset,r=e.shape,i=e.thetaOffset,o=e.mapVersion,a=e.segmentNumber,s=void 0===a?30:a,u=e.autoFit,c=void 0===u||u,l=t.coordinates;if("line"===r)return fa(l,n);var h,f=l[0],p=l[1],d="string"===typeof i?t[i]||0:i;switch(r){case"arc":h=na;break;case"greatcircle":h=sa;break;default:h=na}var v=h(f,p,n,d,o,s,c),m=(0,Li.Z)(v,3),g=m[0],y=m[1],_=m[2];return{lng:g,lat:y,height:_}}var ya=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:50,n=arguments.length>1?arguments[1]:void 0;Ot(this,t),this.limit=e,this.destroy=n||this.defaultDestroy,this.order=[],this.clear()}return zt(t,[{key:"clear",value:function(){var t=this;this.order.forEach((function(e){t.delete(e)})),this.cache={},this.order=[]}},{key:"get",value:function(t){var e=this.cache[t];return e&&(this.deleteOrder(t),this.appendOrder(t)),e}},{key:"set",value:function(t,e){this.cache[t]?(this.delete(t),this.cache[t]=e,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=e,this.appendOrder(t))}},{key:"delete",value:function(t){var e=this.cache[t];e&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(e,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var e=this.order.findIndex((function(e){return e===t}));e>=0&&this.order.splice(e,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,e){return null}}]),t}();n(2707);function _a(t){if(0===t.length)throw new Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return 1*e}function xa(t){if(0===t.length)throw new Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return 1*e}function ba(t){if(0===t.length)return 0;for(var e=1*t[0],n=1;n<t.length;n++)e+=1*t[n];return e}function wa(t){if(0===t.length)throw new Error("mean requires at least one data point");return ba(t)/t.length}function Ea(t){if(0===t.length)throw new Error("mean requires at least one data point");if(t.length<3)return t[0];t.sort();for(var e=t[0],n=NaN,r=0,i=1,o=1;o<t.length+1;o++)t[o]!==e?(i>r&&(r=i,n=e),i=1,e=t[o]):i++;return 1*n}var Sa={min:xa,max:_a,mean:wa,sum:ba,mode:Ea};function Aa(t,e){return t.map((function(t){return t[e]}))}function Ta(t,e){return Sa[t](e)}function Ca(t,e){void 0===e&&(e={});var n=Number(t[0]),r=Number(t[1]),i=Number(t[2]),o=Number(t[3]);if(6===t.length)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var a=[n,r],s=[n,o],u=[i,o],c=[i,r];return D([[a,c,u,s,a]],e.properties,{bbox:t,id:e.id})}var ka,Ma=n(92062),Pa=n.n(Ma),Ia=function(t){return t["Realtime"]="realtime",t["Overlap"]="overlap",t["Replace"]="replace",t}({}),Ra=function(t){return t["Loading"]="Loading",t["Loaded"]="Loaded",t["Failure"]="Failure",t["Cancelled"]="Cancelled",t}({}),La=0,Oa=1,Da=2;function Na(t){t.forEach((function(t){t.isCurrent&&(t.isVisible=t.isLoaded)}))}function za(t){t.forEach((function(t){t.properties.state=La})),t.forEach((function(t){t.isCurrent&&!Ba(t)&&Ua(t)})),t.forEach((function(t){t.isVisible=Boolean(t.properties.state&Da)}))}function Fa(t){t.forEach((function(t){t.properties.state=La})),t.forEach((function(t){t.isCurrent&&Ba(t)}));var e=t.slice().sort((function(t,e){return t.z-e.z}));e.forEach((function(t){t.isVisible=Boolean(t.properties.state&Da),t.children.length&&(t.isVisible||t.properties.state&Oa)?t.children.forEach((function(t){t.properties.state=Oa})):t.isCurrent&&Ua(t)}))}function Ba(t){while(t){if(t.isLoaded)return t.properties.state|=Da,!0;t=t.parent}return!1}function Ua(t){t.children.forEach((function(t){t.isLoaded?t.properties.state|=Da:Ua(t)}))}var ja=[-1/0,-1/0,1/0,1/0],Za=.2,Va=5,Ga=(ka={},(0,Ft.Z)(ka,Ia.Realtime,Na),(0,Ft.Z)(ka,Ia.Overlap,za),(0,Ft.Z)(ka,Ia.Replace,Fa),ka),Ha=function(){};function Wa(t,e,n){var r=Math.floor((t+180)/360*Math.pow(2,n)),i=Math.floor((1-Math.log(Math.tan(e*Math.PI/180)+1/Math.cos(e*Math.PI/180))/Math.PI)/2*Math.pow(2,n));return[r,i]}function qa(t,e,n){var r=t/Math.pow(2,n)*360-180,i=Math.PI-2*Math.PI*e/Math.pow(2,n),o=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[r,o]}var Xa=function(t,e,n){var r=qa(t,e,n),i=(0,Li.Z)(r,2),o=i[0],a=i[1],s=qa(t+1,e+1,n),u=(0,Li.Z)(s,2),c=u[0],l=u[1];return[o,l,c,a]};function Ya(t){var e=t.zoom,n=t.latLonBounds,r=t.maxZoom,i=void 0===r?1/0:r,o=t.minZoom,a=void 0===o?0:o,s=t.zoomOffset,u=void 0===s?0:s,c=t.extent,l=void 0===c?ja:c,h=Math.ceil(e)+u;if(Number.isFinite(a)&&h<a)return[];Number.isFinite(i)&&h>i&&(h=i);for(var f=(0,Li.Z)(n,4),p=f[0],d=f[1],v=f[2],m=f[3],g=[Math.max(p,l[0]),Math.max(d,l[1]),Math.min(v,l[2]),Math.min(m,l[3])],y=[],_=Wa(g[0],g[1],h),x=(0,Li.Z)(_,2),b=x[0],w=x[1],E=Wa(g[2],g[3],h),S=(0,Li.Z)(E,2),A=S[0],T=S[1],C=b;C<=A;C++)for(var k=T;k<=w;k++)y.push({x:C,y:k,z:h});var M=(A+b)/2,P=(w+T)/2,I=function(t,e){return Math.abs(t-M)+Math.abs(e-P)};return y.sort((function(t,e){return I(t.x,t.y)-I(e.x,e.y)})),y}var Ka=function(t,e,n){var r=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],i=Math.pow(2,n),o=i-1,a=i,s=t,u=e;return r&&(s<0?s+=a:s>o&&(s%=a)),{warpX:s,warpY:u}};function Qa(t){var e=Ja();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Ja(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var $a=function(t){Yt(n,t);var e=Qa(n);function n(t){var r;Ot(this,n),r=e.call(this),(0,Ft.Z)(Kt(r),"tileSize",256),(0,Ft.Z)(Kt(r),"isVisible",!1),(0,Ft.Z)(Kt(r),"isCurrent",!1),(0,Ft.Z)(Kt(r),"isVisibleChange",!1),(0,Ft.Z)(Kt(r),"loadedLayers",0),(0,Ft.Z)(Kt(r),"isLayerLoaded",!1),(0,Ft.Z)(Kt(r),"isLoad",!1),(0,Ft.Z)(Kt(r),"isChildLoad",!1),(0,Ft.Z)(Kt(r),"parent",null),(0,Ft.Z)(Kt(r),"children",[]),(0,Ft.Z)(Kt(r),"data",null),(0,Ft.Z)(Kt(r),"properties",{}),(0,Ft.Z)(Kt(r),"loadDataId",0);var i=t.x,o=t.y,a=t.z,s=t.tileSize,u=t.warp,c=void 0===u||u;return r.x=i,r.y=o,r.z=a,r.warp=c||!0,r.tileSize=s,r}return zt(n,[{key:"isLoading",get:function(){return this.loadStatus===Ra.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===Ra.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===Ra.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===Ra.Cancelled}},{key:"isDone",get:function(){return[Ra.Loaded,Ra.Cancelled,Ra.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Xa(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var t=(0,Li.Z)(this.bounds,4),e=t[0],n=t[1],r=t[2],i=t[3],o=[(r-e)/2,(i-n)/2],a=Ca(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:o,meta:"\n      ".concat(this.key,"\n      ")}});return a}},{key:"key",get:function(){var t="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return t}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var t=(0,J.Z)(tt().mark((function t(e){var n,r,i,o,a,s,u,c,l,h,f,p,d,v,m,g,y;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.getData,r=e.onLoad,i=e.onError,this.loadDataId++,o=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=Ra.Loading,a=null,t.prev=7,u=this.x,c=this.y,l=this.z,h=this.bounds,f=this.tileSize,p=this.warp,d=Ka(u,c,l,p),v=d.warpX,m=d.warpY,g=this.abortController.signal,y={x:v,y:m,z:l,bounds:h,tileSize:f,signal:g,warp:p},t.next=14,n(y,this);case 14:a=t.sent,t.next=20;break;case 17:t.prev=17,t.t0=t["catch"](7),s=t.t0;case 20:if(o===this.loadDataId){t.next=22;break}return t.abrupt("return");case 22:if(!this.isCancelled||a){t.next=24;break}return t.abrupt("return");case 24:if(!s&&a){t.next=28;break}return this.loadStatus=Ra.Failure,i(s,this),t.abrupt("return");case 28:this.loadStatus=Ra.Loaded,this.data=a,r(this);case 31:case"end":return t.stop()}}),t,this,[[7,17]])})));function e(e){return t.apply(this,arguments)}return e}()},{key:"reloadData",value:function(t){this.isLoading&&this.abortLoad(),this.loadData(t)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=Ra.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),n}(Ma.EventEmitter),ts=function(t,e){var n=jo(t),r=Bo(n,e),i=900,o=85.0511287798065,a=[Math.max(r[0][0],-i),Math.max(r[0][1],-o),Math.min(r[1][0],i),Math.min(r[1][1],o)];return a},es=function(t,e){var n=jo(t),r=jo(e),i=Uo(n,r);return i};function ns(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=rs(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function rs(t,e){if(t){if("string"===typeof t)return is(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?is(t,e):void 0}}function is(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function os(t){var e=as();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function as(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ss=function(t){return t["TilesLoadStart"]="tiles-load-start",t["TileLoaded"]="tile-loaded",t["TileError"]="tile-error",t["TileUnload"]="tile-unload",t["TileUpdate"]="tile-update",t["TilesLoadFinished"]="tiles-load-finished",t}({}),us=function(t){Yt(n,t);var e=os(n);function n(t){var r;return Ot(this,n),r=e.call(this),(0,Ft.Z)(Kt(r),"currentTiles",[]),(0,Ft.Z)(Kt(r),"cacheTiles",new Map),(0,Ft.Z)(Kt(r),"throttleUpdate",(0,Oi.throttle)((function(t,e){r.update(t,e)}),16)),(0,Ft.Z)(Kt(r),"onTileLoad",(function(t){r.emit(ss.TileLoaded,t),r.updateTileVisible(),r.loadFinished()})),(0,Ft.Z)(Kt(r),"onTileError",(function(t,e){r.emit(ss.TileError,{error:t,tile:e}),r.updateTileVisible(),r.loadFinished()})),(0,Ft.Z)(Kt(r),"onTileUnload",(function(t){r.emit(ss.TileUnload,t),r.loadFinished()})),r.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:ja,getTileData:Ha,warp:!0,updateStrategy:Ia.Overlap},r.updateOptions(t),r}return zt(n,[{key:"isLoaded",get:function(){return this.currentTiles.every((function(t){return t.isDone}))}},{key:"tiles",get:function(){var t=Array.from(this.cacheTiles.values()).sort((function(t,e){return t.z-e.z}));return t}},{key:"updateOptions",value:function(t){var e=void 0===t.minZoom?this.options.minZoom:Math.ceil(t.minZoom),n=void 0===t.maxZoom?this.options.maxZoom:Math.floor(t.maxZoom);this.options=(0,k.Z)((0,k.Z)((0,k.Z)({},this.options),t),{},{minZoom:e,maxZoom:n})}},{key:"update",value:function(t,e){var n=this,r=Math.max(0,Math.ceil(t));if(!this.lastViewStates||this.lastViewStates.zoom!==r||!es(this.lastViewStates.latLonBoundsBuffer,e)){var i=ts(e,Za);this.lastViewStates={zoom:r,latLonBounds:e,latLonBoundsBuffer:i},this.currentZoom=r;var o=!1,a=this.getTileIndices(r,i).filter((function(t){return n.options.warp||t.x>=0&&t.x<Math.pow(2,r)}));this.emit(ss.TilesLoadStart),this.currentTiles=a.map((function(t){var e=t.x,r=t.y,i=t.z,a=n.getTile(e,r,i);if(a){var s,u,c=(null===(s=a)||void 0===s?void 0:s.isFailure)||(null===(u=a)||void 0===u?void 0:u.isCancelled);return c&&a.loadData({getData:n.options.getTileData,onLoad:n.onTileLoad,onError:n.onTileError}),a}return a=n.createTile(e,r,i),o=!0,a})),o&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var t,e=ns(this.cacheTiles);try{for(e.s();!(t=e.n()).done;){var n=(0,Li.Z)(t.value,2),r=n[0],i=n[1];if(!this.currentTiles.includes(i))return this.cacheTiles.delete(r),void this.onTileUnload(i);this.onTileUnload(i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(o){e.e(o)}finally{e.f()}}},{key:"reloadTileById",value:function(t,e,n){var r=this.cacheTiles.get("".concat(e,",").concat(n,",").concat(t));r&&(this.onTileUnload(r),r.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(t,e,n){var r=this.getTileByLngLat(t,e,n);r&&this.reloadTileById(r.z,r.x,r.y)}},{key:"reloadTileByExtent",value:function(t,e){var n=this,r=this.getTileIndices(e,t);r.forEach((function(t){n.reloadTileById(t.z,t.x,t.y)}))}},{key:"pruneRequests",value:function(){var t,e=[],n=ns(this.cacheTiles.values());try{for(n.s();!(t=n.n()).done;){var r=t.value;r.isLoading&&(r.isCurrent||r.isVisible||e.push(r))}}catch(o){n.e(o)}finally{n.f()}while(e.length>0){var i=e.shift();i.abortLoad()}}},{key:"getTileByLngLat",value:function(t,e,n){var r=this.options.zoomOffset,i=Math.ceil(n)+r,o=Wa(t,e,i),a=this.tiles.filter((function(t){return t.key==="".concat(o[0],"_").concat(o[1],"_").concat(i)}));return a[0]}},{key:"getTileExtent",value:function(t,e){return this.getTileIndices(e,t)}},{key:"getTileByZXY",value:function(t,e,n){var r=this.tiles.filter((function(r){return r.key==="".concat(e,"_").concat(n,"_").concat(t)}));return r[0]}},{key:"clear",value:function(){var t,e=ns(this.cacheTiles.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.isLoading?n.abortLoad():this.onTileUnload(n)}}catch(r){e.e(r)}finally{e.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var t,e=this.options.updateStrategy,n=new Map,r=ns(this.cacheTiles.values());try{for(r.s();!(t=r.n()).done;){var i=t.value;n.set(i.key,i.isVisible),i.isCurrent=!1,i.isVisible=!1}}catch(l){r.e(l)}finally{r.f()}var o,a=ns(this.currentTiles);try{for(a.s();!(o=a.n()).done;){var s=o.value;s.isCurrent=!0,s.isVisible=!0}}catch(l){a.e(l)}finally{a.f()}var u=Array.from(this.cacheTiles.values());"function"===typeof e?e(u):Ga[e](u);var c=!1;Array.from(this.cacheTiles.values()).forEach((function(t){t.isVisible!==n.get(t.key)?(t.isVisibleChange=!0,c=!0):t.isVisibleChange=!1})),c&&this.emit(ss.TileUpdate)}},{key:"getTileIndices",value:function(t,e){var n=this.options,r=n.tileSize,i=n.extent,o=n.zoomOffset,a=Math.floor(this.options.maxZoom),s=Math.ceil(this.options.minZoom),u=Ya({maxZoom:a,minZoom:s,zoomOffset:o,tileSize:r,zoom:t,latLonBounds:e,extent:i});return u}},{key:"getTileId",value:function(t,e,n){var r="".concat(t,",").concat(e,",").concat(n);return r}},{key:"loadFinished",value:function(){var t=!this.currentTiles.some((function(t){return!t.isDone}));return t&&this.emit(ss.TilesLoadFinished),t}},{key:"getTile",value:function(t,e,n){var r=this.getTileId(t,e,n),i=this.cacheTiles.get(r);return i}},{key:"createTile",value:function(t,e,n){var r=this.getTileId(t,e,n),i=new $a({x:t,y:e,z:n,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(r,i),i.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),i}},{key:"resizeCacheTiles",value:function(){var t=Va*this.currentTiles.length,e=this.cacheTiles.size>t;if(e){var n,r=ns(this.cacheTiles);try{for(r.s();!(n=r.n()).done;){var i=(0,Li.Z)(n.value,2),o=i[0],a=i[1];if(a.isVisible||this.currentTiles.includes(a)||(this.cacheTiles.delete(o),this.onTileUnload(a)),this.cacheTiles.size<=t)break}}catch(s){r.e(s)}finally{r.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var t,e=ns(this.cacheTiles.values());try{for(e.s();!(t=e.n()).done;){var n=t.value;n.parent=null,n.children.length=0}}catch(s){e.e(s)}finally{e.f()}var r,i=ns(this.cacheTiles.values());try{for(i.s();!(r=i.n()).done;){var o=r.value,a=this.getNearestAncestor(o.x,o.y,o.z);o.parent=a,null!==a&&void 0!==a&&a.children&&a.children.push(o)}}catch(s){i.e(s)}finally{i.f()}}},{key:"getNearestAncestor",value:function(t,e,n){while(n>this.options.minZoom){t=Math.floor(t/2),e=Math.floor(e/2),n-=1;var r=this.getTile(t,e,n);if(r)return r}return null}}]),n}(Pa());function cs(t){return/(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(t)}function ls(t){var e=[],n=/\{([a-z])-([a-z])\}/.exec(t);if(n){var r,i=n[1].charCodeAt(0),o=n[2].charCodeAt(0);for(r=i;r<=o;++r)e.push(t.replace(n[0],String.fromCharCode(r)));return e}if(n=/\{(\d+)-(\d+)\}/.exec(t),n){for(var a=parseInt(n[2],10),s=parseInt(n[1],10);s<=a;s++)e.push(t.replace(n[0],s.toString()));return e}return e.push(t),e}function hs(t,e){if(!t||!t.length)throw new Error("url is not allowed to be empty");var n=e.x,r=e.y,i=e.z,o=ls(t),a=Math.abs(n+r)%o.length,s=o[a];return s.replace(/\{x\}/g,n.toString()).replace(/\{y\}/g,r.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,Xa(n,r,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-r-1).toString())}function fs(t,e){var n=e.x,r=e.y,i=e.z,o=e.layer,a=e.version,s=void 0===a?"1.0.0":a,u=e.style,c=void 0===u?"default":u,l=e.format,h=e.service,f=void 0===h?"WMTS":h,p=e.tileMatrixset,d="".concat(t,"&SERVICE=").concat(f,"&REQUEST=GetTile&VERSION=").concat(s,"&LAYER=").concat(o,"&STYLE=").concat(c,"&TILEMATRIXSET=").concat(p,"&FORMAT=").concat(l,"&TILECOL=").concat(n,"&TILEROW=").concat(r,"&TILEMATRIX=").concat(i);return d}function ps(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}var ds={self:"undefined"!==typeof self&&self,window:"undefined"!==typeof window&&window,document:"undefined"!==typeof document&&document},vs=(ds.self||ds.window,ds.window||ds.self,ds.self||ds.window,ds.document,"undefined"!==typeof window&&"undefined"!==typeof window.orientation),ms=function(){function t(t,e){var n=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){n.resolve=t,n.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){ps(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){ps(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),gs=ms,ys=(n(60285),n(41637),new Map);function _s(t){ps(t.source&&!t.url||!t.source&&t.url);var e=ys.get(t.source||t.url);return e||(t.url&&(e=xs(t.url),ys.set(t.url,e)),t.source&&(e=bs(t.source),ys.set(t.source,e))),ps(e),e}function xs(t){if(!t.startsWith("http"))return t;var e=ws(t);return bs(e)}function bs(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function ws(t){return"try {\n  importScripts('"+t+"');\n} catch (error) {\n  console.error(error);\n  throw error;\n}"}n(18264);function Es(t,e,n){void 0===e&&(e=!0);var r=n||new Set;if(t){if(Ss(t))r.add(t);else if(Ss(t.buffer))r.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"===(0,I.Z)(t))for(var i in t)Es(t[i],e,r)}else;return void 0===n?Array.from(r):[]}function Ss(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!==typeof MessagePort&&t instanceof MessagePort||("undefined"!==typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!==typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var As=function(){},Ts=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,n=t.source,r=t.url;ps(n||r),this.name=e,this.source=n,this.url=r,this.onMessage=As,this.onError=function(t){},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!==typeof Worker},t.prototype.destroy=function(){this.onMessage=As,this.onError=As,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Es(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=_s({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(t){},e},t}(),Cs=Ts,ks=function(){return ks=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n],e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},ks.apply(this,arguments)},Ms=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function a(t){try{u(r.next(t))}catch(e){o(e)}}function s(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(a,s)}u((r=r.apply(t,e||[])).next())}))},Ps=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(t){return function(e){return u([t,e])}}function u(o){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(i=2&o[0]?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},Is=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=ks(ks({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,n){return void 0===e&&(e=function(t,e,n){return t.done(n)}),void 0===n&&(n=function(t,e){return t.error(e)}),Ms(this,void 0,void 0,(function(){var r,i=this;return Ps(this,(function(o){switch(o.label){case 0:return r=new Promise((function(r){return i.jobQueue.push({name:t,onMessage:e,onError:n,onStart:r}),i})),this.startQueuedJob(),[4,r];case 1:return[2,o.sent()]}}))}))},t.prototype.startQueuedJob=function(){return Ms(this,void 0,void 0,(function(){var t,e,n;return Ps(this,(function(r){switch(r.label){case 0:if(!this.jobQueue.length)return[2];if(t=this.getAvailableWorker(),!t)return[2];if(e=this.jobQueue.shift(),!e)return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),n=new gs(e.name,t),t.onMessage=function(t){return e.onMessage(n,t.type,t.payload)},t.onError=function(t){return e.onError(n,t)},e.onStart(n),r.label=1;case 1:return r.trys.push([1,,3,4]),[4,n.result];case 2:return r.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){var e=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();e?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Cs({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return vs?this.maxMobileConcurrency:this.maxConcurrency},t}(),Rs=Is,Ls=function(){return Ls=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n],e)Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t},Ls.apply(this,arguments)},Os=function(t){var e="function"===typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"===typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ds={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},Ns=function(){function t(t){this.workerPools=new Map,this.props=Ls({},Ds),this.setProps(t),this.workerPools=new Map}return t.isSupported=function(){return Cs.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var n=Os(this.workerPools.values()),r=n.next();!r.done;r=n.next()){var i=r.value;i.destroy()}}catch(o){t={error:o}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,n;this.props=Ls(Ls({},this.props),t);try{for(var r=Os(this.workerPools.values()),i=r.next();!i.done;i=r.next()){var o=i.value;o.setProps(this.getWorkerPoolProps())}}catch(a){e={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,n=t.source,r=t.url,i=this.workerPools.get(e);return i||(i=new Rs({name:e,source:n,url:r}),i.setProps(this.getWorkerPoolProps()),this.workerPools.set(e,i)),i},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},t}(),zs=Ns,Fs=new Map,Bs=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(js(e)){var n=e.data,r=n.type,i=n.payload;t(r,i)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=Fs.get(t);e||(e=function(e){if(js(e)){var n=e.data,r=n.type,i=n.payload;t(r,i)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=Fs.get(t);Fs.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var n={source:"Worker thread",type:t,payload:e},r=Es(e);self.postMessage(n,r)}},t}(),Us=Bs;function js(t){var e=t.type,n=t.data;return"message"===e&&n&&"string"===typeof n.source&&"Main thread"===n.source}n(72443);var Zs,Vs,Gs=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){while(this._settlers.length>0){var t=this._settlers.shift();t.resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,n){t._settlers.push({resolve:e,reject:n})}))},t}(),Hs=Gs,Ws=function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function a(t){try{u(r.next(t))}catch(e){o(e)}}function s(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(a,s)}u((r=r.apply(t,e||[])).next())}))},qs=function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(t){return function(e){return u([t,e])}}function u(o){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(i=2&o[0]?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},Xs=function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,n=t[Symbol.asyncIterator];return n?n.call(t):(t="function"===typeof __values?__values(t):t[Symbol.iterator](),e={},r("next"),r("throw"),r("return"),e[Symbol.asyncIterator]=function(){return this},e);function r(n){e[n]=t[n]&&function(e){return new Promise((function(r,o){e=t[n](e),i(r,o,e.done,e.value)}))}}function i(t,e,n,r){Promise.resolve(r).then((function(e){t({value:e,done:n})}),e)}},Ys=0;function Ks(t,e){var n=this;if("undefined"!==typeof self){var r={process:Qs};Us.onmessage=function(i,o){return Ws(n,void 0,void 0,(function(){var n,a,s,u,c,l,h,f,p,d,v;return qs(this,(function(m){switch(m.label){case 0:switch(m.trys.push([0,19,,20]),n=i,n){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(o.input,o.options||{},r)];case 2:return a=m.sent(),Us.postMessage("done",{result:a}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");Zs=new Hs,Vs=o.options||{},s=e(Zs,Vs,r),m.label=4;case 4:m.trys.push([4,9,10,15]),u=Xs(s),m.label=5;case 5:return[4,u.next()];case 6:if(c=m.sent(),c.done)return[3,8];l=c.value,Us.postMessage("output-batch",{result:l}),m.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return h=m.sent(),d={error:h},[3,15];case 10:return m.trys.push([10,,13,14]),c&&!c.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:m.sent(),m.label=12;case 12:return[3,14];case 13:if(d)throw d.error;return[7];case 14:return[7];case 15:return Us.postMessage("done",{}),[3,18];case 16:return Zs.push(o.input),[3,18];case 17:return Zs.close(),[3,18];case 18:return[3,20];case 19:return f=m.sent(),p=f instanceof Error?f.message:"",Us.postMessage("error",{error:p}),[3,20];case 20:return[2]}}))}))}}}function Qs(t,e){return void 0===e&&(e={}),new Promise((function(n,r){var i=Ys++,o=function t(e,o){if(o.id===i)switch(e){case"done":Us.removeEventListener(t),n(o.result);break;case"error":Us.removeEventListener(t),r(o.error);break;default:}};Us.addEventListener(o);var a={id:i,input:t,options:e};Us.postMessage("process",a)}))}function Js(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function $s(t,e,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}function tu(t){var e=t.filter;return e?[1]:[0]}function eu(t,e){return[e]}var nu=n(19652),ru=n.n(nu),iu=(n(44197),1e-6),ou="undefined"!==typeof Float32Array?Float32Array:Array,au=Math.random;Math.PI;function su(){var t=new ou(2);return ou!=Float32Array&&(t[0]=0,t[1]=0),t}function uu(t,e){var n=new ou(2);return n[0]=t,n[1]=e,n}function cu(t,e){return t[0]=e[0],t[1]=e[1],t}function lu(t,e,n){return t[0]=e,t[1]=n,t}function hu(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t}function fu(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t}function pu(t,e){return t[0]=-e[0],t[1]=-e[1],t}function du(t,e){var n=e[0],r=e[1],i=n*n+r*r;return i>0&&(i=1/Math.sqrt(i)),t[0]=e[0]*i,t[1]=e[1]*i,t}function vu(t,e){return t[0]*e[0]+t[1]*e[1]}function mu(t,e,n,r){var i=e[0],o=e[1];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t}Math.hypot||(Math.hypot=function(){var t=0,e=arguments.length;while(e--)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var gu=fu,yu=(function(){var t=su()}(),su()),_u=(su(),su()),xu=su(),bu=su();function wu(t,e,n,r,i){hu(t,n,r),du(t,t),e=uu(-t[1],t[0]);var o=uu(-n[1],n[0]);return[i/vu(e,o),e]}function Eu(t,e){return lu(t,-e[1],e[0])}function Su(t,e,n){return gu(t,e,n),du(t,t),t}function Au(t,e){return t[0]===e[0]&&t[1]===e[1]}var Tu=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ot(this,t),(0,Ft.Z)(this,"lastFlip",-1),(0,Ft.Z)(this,"miter",uu(0,0)),(0,Ft.Z)(this,"started",!1),(0,Ft.Z)(this,"dash",!1),(0,Ft.Z)(this,"totalDistance",0),(0,Ft.Z)(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return zt(t,[{key:"extrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=t[o-1];c.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var l=e[o-1],h=t[o];h.push(null!==(s=e[o][2])&&void 0!==s?s:0);var f=e[o],p=o<t.length-1?[].concat((0,C.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null,v=this.segment_gaode2(n,i,c,h,p,l,f,d);i+=v}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=t[o-1];c.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var l=e[o-1],h=t[o];h.push(null!==(s=e[o][2])&&void 0!==s?s:0);var f=e[o],p=o<t.length-1?[].concat((0,C.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null,v=this.simpleSegment(n,i,c,h,p,l,f,d);i+=v}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null,u=this.segment(e,r,o,a,s);r+=u}if(this.dash)for(var c=0;c<e.positions.length/6;c++)e.positions[6*c+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null,u=this.simpleSegment(e,r,o,a,s);r+=u}if(this.dash)for(var c=0;c<e.positions.length/6;c++)e.positions[6*c+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,n,r,i,o,a,s){var u=0,c=t.indices,l=t.positions,h=t.normals,f="square"===this.cap,p="bevel"===this.join,d=Lo([a[0],a[1]]),v=Lo([o[0],o[1]]);Su(_u,r,n);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,v),this.totalDistance+=m),this.normal||(this.normal=su(),Eu(this.normal,_u)),!this.started)if(this.started=!0,f){var g=su(),y=su();hu(g,this.normal,_u),hu(y,this.normal,_u),h.push(y[0],y[1],0),h.push(g[0],g[1],0),l.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,n,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),i){Au(r,i)&&hu(i,r,du(i,fu(i,r,n))),Su(xu,i,r);var _=wu(bu,su(),_u,xu,this.thickness),x=(0,Li.Z)(_,2),b=x[0],w=x[1],E=vu(bu,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join){var A=b;A>this.miterLimit&&(S=!0)}S?(h.push(this.normal[0],this.normal[1],0),h.push(w[0],w[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,(0,C.Z)(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),Eu(yu,xu),cu(this.normal,yu),h.push(this.normal[0],this.normal[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,h,r,w,b,this.totalDistance),c.push.apply(c,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,cu(this.normal,w),u+=2),this.lastFlip=E}else{if(Eu(this.normal,_u),f){var T=su(),k=su();gu(k,_u,this.normal),hu(T,_u,this.normal),h.push(k[0],k[1],0),h.push(T[0],T[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,r,this.normal,this.thickness,this.totalDistance);c.push.apply(c,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),u+=2}return u}},{key:"simpleSegment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,c=Lo([r[0],r[1]]),l=Lo([n[0],n[1]]);Su(_u,c,l);var h=0;if(this.dash&&(h=this.lineSegmentDistance(c,l),this.totalDistance+=h),this.normal||(this.normal=su(),Eu(this.normal,_u)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(e+0,e+1,e+2),i){var f=Lo([i[0],i[1]]);Au(c,f)&&hu(f,c,du(f,fu(f,c,l))),Su(xu,f,c);var p=wu(bu,su(),_u,xu,this.thickness),d=(0,Li.Z)(p,2),v=d[0],m=d[1],g=vu(bu,this.normal)<0?-1:1;this.extrusions(s,u,r,m,v,this.totalDistance),a.push.apply(a,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),g=-1,cu(this.normal,m),o+=2,this.lastFlip=g}else Eu(this.normal,_u),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2;return o}},{key:"segment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,c="square"===this.cap,l="bevel"===this.join,h=Lo([r[0],r[1]]),f=Lo([n[0],n[1]]);Su(_u,h,f);var p=0;if(this.dash&&(p=this.lineSegmentDistance(h,f),this.totalDistance+=p),this.normal||(this.normal=su(),Eu(this.normal,_u)),!this.started)if(this.started=!0,c){var d=su(),v=su();hu(d,this.normal,_u),hu(v,this.normal,_u),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),i){var m=Lo([i[0],i[1]]);Au(h,m)&&hu(m,h,du(m,fu(m,h,f))),Su(xu,m,h);var g=wu(bu,su(),_u,xu,this.thickness),y=(0,Li.Z)(g,2),_=y[0],x=y[1],b=vu(bu,this.normal)<0?-1:1,w=l;if(!w&&"miter"===this.join){var E=_;E>this.miterLimit&&(w=!0)}w?(u.push(this.normal[0],this.normal[1],0),u.push(x[0],x[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,(0,C.Z)(this.lastFlip!==-b?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),Eu(yu,xu),cu(this.normal,yu),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,x,_,this.totalDistance),a.push.apply(a,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),b=-1,cu(this.normal,x),o+=2),this.lastFlip=b}else{if(Eu(this.normal,_u),c){var S=su(),A=su();gu(A,_u,this.normal),hu(S,_u,this.normal),u.push(A[0],A[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2}return o}},{key:"extrusions",value:function(t,e,n,r,i,o){e.push(r[0],r[1],0),e.push(r[0],r[1],0),t.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}}]),t}();function Cu(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new Tu({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],c=a[s];i.extrude_gaode2(u,c)}}else{var l=e;l[0]&&!Array.isArray(l[0][0])&&(l=[e]),l.forEach((function(t){i.extrude(t)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function ku(t){var e=Yo(t.coordinates);return{vertices:[].concat((0,C.Z)(e),(0,C.Z)(e),(0,C.Z)(e),(0,C.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function Mu(t){var e=t.coordinates,n=ru().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes,a=ru()(r,o,i);return{indices:a,vertices:r,size:i}}var Pu=function(){var t=(0,J.Z)(tt().mark((function t(e){var n,r,i,o,a,s,u,c,l;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o=e.iconMap,a={a_Color:Js,a_Position:$s,filter:tu,a_vertexId:eu,a_PickingColor:function(t){var e=t.id;return i?Ei(e):[0,0,0]},a_DistanceAndIndex:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]},a_Total_Distance:function(t,e,n){return[n[5]]},a_Size:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]},a_Normal:function(t,e,n,r,i){return i},a_Miter:function(t,e,n){return[n[4]]},a_iconMapUV:function(t){var e=t.texture,n=o[e]||{x:0,y:0},r=n.x,i=n.y;return[r,i]}},s={sizePerElement:0,elements:[]},u=0,c=[],l=3,r.forEach((function(t,e){var r=Cu(t),i=r.indices,o=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(t){c.push(t+u)})),l=f;var d=o.length/f;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null===h||void 0===h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*f,r*f+f),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,(0,C.Z)(a[n.name](t,e,s,r,i,u)))}))},m=0;m<d;m++)v(m)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Iu=function(){var t=(0,J.Z)(tt().mark((function t(e){var n,r,i,o,a,s,u,c,l;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o=e.shape2d,a={a_Color:Js,a_Position:$s,filter:tu,a_vertexId:eu,a_PickingColor:function(t){var e=t.id;return i?Ei(e):[0,0,0]},a_Shape:function(t){var e=t.shape,n=void 0===e?2:e,r=o.indexOf(n);return[r]},a_Extrude:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]},a_Size:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}},s={sizePerElement:0,elements:[]},u=0,c=[],l=3,r.forEach((function(t,e){var r=ku(t),i=r.indices,o=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(t){c.push(t+u)})),l=f;var d=o.length/f;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:o,normals:h,offset:u}),u+=d;for(var v=function(r){var i=(null===h||void 0===h?void 0:h.slice(3*r,3*r+3))||[],s=o.slice(r*f,r*f+f),u=0;p&&void 0!==p[r]&&(u=p[r]),n.forEach((function(n){var o;n&&a[n.name]&&(o=n.buffer.data).push.apply(o,(0,C.Z)(a[n.name](t,e,s,r,i,u)))}))},m=0;m<d;m++)v(m)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Ru=function(){var t=(0,J.Z)(tt().mark((function t(e){var n,r,i,o,a,s,u,c;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.descriptors,r=e.features,i=e.enablePicking,o={a_Color:Js,a_Position:$s,filter:tu,a_vertexId:eu,a_PickingColor:function(t){var e=t.id;return i?Ei(e):[0,0,0]}},a={sizePerElement:0,elements:[]},s=0,u=[],c=3,r.forEach((function(t,e){var r=Mu(t),i=r.indices,l=r.vertices,h=r.normals,f=r.size,p=r.indexes;i.forEach((function(t){u.push(t+s)})),c=f;var d=l.length/f;a.sizePerElement=c,a.elements.push({featureIdx:e,vertices:l,normals:h,offset:s}),s+=d;for(var v=function(r){var i=(null===h||void 0===h?void 0:h.slice(3*r,3*r+3))||[],a=l.slice(r*f,r*f+f),s=0;p&&void 0!==p[r]&&(s=p[r]),n.forEach((function(n){var u;n&&o[n.name]&&(u=n.buffer.data).push.apply(u,(0,C.Z)(o[n.name](t,e,a,r,i,s)))}))},m=0;m<d;m++)v(m)})),t.abrupt("return",{descriptors:n,featureLayout:a,indices:u});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Lu={pointFill:Iu,line:Pu,polygonFill:Ru},Ou=(0,k.Z)({},Lu);function Du(t){return Nu.apply(this,arguments)}function Nu(){return Nu=(0,J.Z)(tt().mark((function t(e){var n,r;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n=e.workerType,r=e.data,!Ou[n]){t.next=3;break}return t.abrupt("return",Ou[n](r));case 3:return t.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(n,'" non-existent.'))));case 4:case"end":return t.stop()}}),t)}))),Nu.apply(this,arguments)}Ks(Du);var zu=new Map;function Fu(t,e){zu.set(t,e)}function Bu(t){var e=zu.get(t);return e}var Uu='var L7=function(t){"use strict";function e(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function r(){r=function(){return t};var t={},e=Object.prototype,n=e.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",u=i.asyncIterator||"@@asyncIterator",s=i.toStringTag||"@@toStringTag";function c(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{c({},"")}catch(t){c=function(t,e,r){return t[e]=r}}function f(t,e,r,n){var i=e&&e.prototype instanceof p?e:p,a=Object.create(i.prototype),u=new T(n||[]);return o(a,"_invoke",{value:E(t,r,u)}),a}function l(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}t.wrap=f;var h={};function p(){}function v(){}function d(){}var y={};c(y,a,(function(){return this}));var g=Object.getPrototypeOf,m=g&&g(g(k([])));m&&m!==e&&n.call(m,a)&&(y=m);var b=d.prototype=p.prototype=Object.create(y);function x(t){["next","throw","return"].forEach((function(e){c(t,e,(function(t){return this._invoke(e,t)}))}))}function w(t,e){var r;o(this,"_invoke",{value:function(o,i){function a(){return new e((function(r,a){!function r(o,i,a,u){var s=l(t[o],t,i);if("throw"!==s.type){var c=s.arg,f=c.value;return f&&"object"==typeof f&&n.call(f,"__await")?e.resolve(f.__await).then((function(t){r("next",t,a,u)}),(function(t){r("throw",t,a,u)})):e.resolve(f).then((function(t){c.value=t,a(c)}),(function(t){return r("throw",t,a,u)}))}u(s.arg)}(o,i,r,a)}))}return r=r?r.then(a,a):a()}})}function E(t,e,r){var n="suspendedStart";return function(o,i){if("executing"===n)throw new Error("Generator is already running");if("completed"===n){if("throw"===o)throw i;return I()}for(r.method=o,r.arg=i;;){var a=r.delegate;if(a){var u=A(a,r);if(u){if(u===h)continue;return u}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if("suspendedStart"===n)throw n="completed",r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);n="executing";var s=l(t,e,r);if("normal"===s.type){if(n=r.done?"completed":"suspendedYield",s.arg===h)continue;return{value:s.arg,done:r.done}}"throw"===s.type&&(n="completed",r.method="throw",r.arg=s.arg)}}}function A(t,e){var r=e.method,n=t.iterator[r];if(void 0===n)return e.delegate=null,"throw"===r&&t.iterator.return&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method)||"return"!==r&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a \'"+r+"\' method")),h;var o=l(n,t.iterator,e.arg);if("throw"===o.type)return e.method="throw",e.arg=o.arg,e.delegate=null,h;var i=o.arg;return i?i.done?(e[t.resultName]=i.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,h):i:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,h)}function O(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function S(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function T(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(O,this),this.reset(!0)}function k(t){if(t){var e=t[a];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,o=function e(){for(;++r<t.length;)if(n.call(t,r))return e.value=t[r],e.done=!1,e;return e.value=void 0,e.done=!0,e};return o.next=o}}return{next:I}}function I(){return{value:void 0,done:!0}}return v.prototype=d,o(b,"constructor",{value:d,configurable:!0}),o(d,"constructor",{value:v,configurable:!0}),v.displayName=c(d,s,"GeneratorFunction"),t.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===v||"GeneratorFunction"===(e.displayName||e.name))},t.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,d):(t.__proto__=d,c(t,s,"GeneratorFunction")),t.prototype=Object.create(b),t},t.awrap=function(t){return{__await:t}},x(w.prototype),c(w.prototype,u,(function(){return this})),t.AsyncIterator=w,t.async=function(e,r,n,o,i){void 0===i&&(i=Promise);var a=new w(f(e,r,n,o),i);return t.isGeneratorFunction(r)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},x(b),c(b,s,"Generator"),c(b,a,(function(){return this})),c(b,"toString",(function(){return"[object Generator]"})),t.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},t.values=k,T.prototype={constructor:T,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(S),!t)for(var e in this)"t"===e.charAt(0)&&n.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function r(r,n){return a.type="throw",a.arg=t,e.next=r,n&&(e.method="next",e.arg=void 0),!!n}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return r("end");if(i.tryLoc<=this.prev){var u=n.call(i,"catchLoc"),s=n.call(i,"finallyLoc");if(u&&s){if(this.prev<i.catchLoc)return r(i.catchLoc,!0);if(this.prev<i.finallyLoc)return r(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return r(i.catchLoc,!0)}else{if(!s)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return r(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,h):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),h},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),S(r),h}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;S(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,r){return this.delegate={iterator:k(t),resultName:e,nextLoc:r},"next"===this.method&&(this.arg=void 0),h}},t}function n(t,e,r,n,o,i,a){try{var u=t[i](a),s=u.value}catch(t){return void r(t)}u.done?e(s):Promise.resolve(s).then(n,o)}function o(t){return function(){var e=this,r=arguments;return new Promise((function(o,i){var a=t.apply(e,r);function u(t){n(a,o,i,u,s,"next",t)}function s(t){n(a,o,i,u,s,"throw",t)}u(void 0)}))}}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function a(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,b(n.key),n)}}function u(t,e,r){return e&&a(t.prototype,e),r&&a(t,r),Object.defineProperty(t,"prototype",{writable:!1}),t}function s(t,e,r){return(e=b(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function c(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&l(t,e)}function f(t){return(f=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function l(t,e){return(l=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(t,e){return t.__proto__=e,t})(t,e)}function h(t){if(void 0===t)throw new ReferenceError("this hasn\'t been initialised - super() hasn\'t been called");return t}function p(t,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return h(t)}function v(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var r,n=f(t);if(e){var o=f(this).constructor;r=Reflect.construct(n,arguments,o)}else r=n.apply(this,arguments);return p(this,r)}}function d(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,i,a,u=[],s=!0,c=!1;try{if(i=(r=r.call(t)).next,0===e){if(Object(r)!==r)return;s=!1}else for(;!(s=(n=i.call(r)).done)&&(u.push(n.value),u.length!==e);s=!0);}catch(t){c=!0,o=t}finally{try{if(!s&&null!=r.return&&(a=r.return(),Object(a)!==a))return}finally{if(c)throw o}}return u}}(t,e)||g(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(t){return function(t){if(Array.isArray(t))return m(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||g(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(t,e){if(t){if("string"==typeof t)return m(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?m(t,e):void 0}}function m(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=new Array(e);r<e;r++)n[r]=t[r];return n}function b(t){var e=function(t,e){if("object"!=typeof t||null===t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(t,"string");return"symbol"==typeof e?e:String(e)}var x="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function w(t,e){return t(e={exports:{}},e.exports),e.exports}var E,A,O=function(t){return t&&t.Math==Math&&t},S=O("object"==typeof globalThis&&globalThis)||O("object"==typeof window&&window)||O("object"==typeof self&&self)||O("object"==typeof x&&x)||function(){return this}()||x||Function("return this")(),T=Object.defineProperty,k=function(t,e){try{T(S,t,{value:e,configurable:!0,writable:!0})}catch(r){S[t]=e}return e},I=S["__core-js_shared__"]||k("__core-js_shared__",{}),j=w((function(t){(t.exports=function(t,e){return I[t]||(I[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.30.2",mode:"global",copyright:"© 2014-2023 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.30.2/LICENSE",source:"https://github.com/zloirock/core-js"})})),P=function(t){try{return!!t()}catch(t){return!0}},_=!P((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),M=Function.prototype,L=M.call,R=_&&M.bind.bind(L,L),N=_?R:function(t){return function(){return L.apply(t,arguments)}},C=function(t){return null==t},D=TypeError,F=function(t){if(C(t))throw D("Can\'t call method on "+t);return t},W=Object,z=function(t){return W(F(t))},B=N({}.hasOwnProperty),U=Object.hasOwn||function(t,e){return B(z(t),e)},G=0,V=Math.random(),H=N(1..toString),q=function(t){return"Symbol("+(void 0===t?"":t)+")_"+H(++G+V,36)},Z="undefined"!=typeof navigator&&String(navigator.userAgent)||"",Y=S.process,$=S.Deno,K=Y&&Y.versions||$&&$.version,Q=K&&K.v8;Q&&(A=(E=Q.split("."))[0]>0&&E[0]<4?1:+(E[0]+E[1])),!A&&Z&&(!(E=Z.match(/Edge\\/(\\d+)/))||E[1]>=74)&&(E=Z.match(/Chrome\\/(\\d+)/))&&(A=+E[1]);var X=A,J=S.String,tt=!!Object.getOwnPropertySymbols&&!P((function(){var t=Symbol();return!J(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&X&&X<41})),et=tt&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,rt=S.Symbol,nt=j("wks"),ot=et?rt.for||rt:rt&&rt.withoutSetter||q,it=function(t){return U(nt,t)||(nt[t]=tt&&U(rt,t)?rt[t]:ot("Symbol."+t)),nt[t]},at={};at[it("toStringTag")]="z";var ut="[object z]"===String(at),st="object"==typeof document&&document.all,ct={all:st,IS_HTMLDDA:void 0===st&&void 0!==st},ft=ct.all,lt=ct.IS_HTMLDDA?function(t){return"function"==typeof t||t===ft}:function(t){return"function"==typeof t},ht=!P((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),pt=ct.all,vt=ct.IS_HTMLDDA?function(t){return"object"==typeof t?null!==t:lt(t)||t===pt}:function(t){return"object"==typeof t?null!==t:lt(t)},dt=S.document,yt=vt(dt)&&vt(dt.createElement),gt=function(t){return yt?dt.createElement(t):{}},mt=!ht&&!P((function(){return 7!=Object.defineProperty(gt("div"),"a",{get:function(){return 7}}).a})),bt=ht&&P((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),xt=String,wt=TypeError,Et=function(t){if(vt(t))return t;throw wt(xt(t)+" is not an object")},At=Function.prototype.call,Ot=_?At.bind(At):function(){return At.apply(At,arguments)},St=function(t){return lt(t)?t:void 0},Tt=function(t,e){return arguments.length<2?St(S[t]):S[t]&&S[t][e]},kt=N({}.isPrototypeOf),It=Object,jt=et?function(t){return"symbol"==typeof t}:function(t){var e=Tt("Symbol");return lt(e)&&kt(e.prototype,It(t))},Pt=String,_t=function(t){try{return Pt(t)}catch(t){return"Object"}},Mt=TypeError,Lt=function(t){if(lt(t))return t;throw Mt(_t(t)+" is not a function")},Rt=function(t,e){var r=t[e];return C(r)?void 0:Lt(r)},Nt=TypeError,Ct=TypeError,Dt=it("toPrimitive"),Ft=function(t,e){if(!vt(t)||jt(t))return t;var r,n=Rt(t,Dt);if(n){if(void 0===e&&(e="default"),r=Ot(n,t,e),!vt(r)||jt(r))return r;throw Ct("Can\'t convert object to primitive value")}return void 0===e&&(e="number"),function(t,e){var r,n;if("string"===e&&lt(r=t.toString)&&!vt(n=Ot(r,t)))return n;if(lt(r=t.valueOf)&&!vt(n=Ot(r,t)))return n;if("string"!==e&&lt(r=t.toString)&&!vt(n=Ot(r,t)))return n;throw Nt("Can\'t convert object to primitive value")}(t,e)},Wt=function(t){var e=Ft(t,"string");return jt(e)?e:e+""},zt=TypeError,Bt=Object.defineProperty,Ut=Object.getOwnPropertyDescriptor,Gt={f:ht?bt?function(t,e,r){if(Et(t),e=Wt(e),Et(r),"function"==typeof t&&"prototype"===e&&"value"in r&&"writable"in r&&!r.writable){var n=Ut(t,e);n&&n.writable&&(t[e]=r.value,r={configurable:"configurable"in r?r.configurable:n.configurable,enumerable:"enumerable"in r?r.enumerable:n.enumerable,writable:!1})}return Bt(t,e,r)}:Bt:function(t,e,r){if(Et(t),e=Wt(e),Et(r),mt)try{return Bt(t,e,r)}catch(t){}if("get"in r||"set"in r)throw zt("Accessors not supported");return"value"in r&&(t[e]=r.value),t}},Vt=Function.prototype,Ht=ht&&Object.getOwnPropertyDescriptor,qt=U(Vt,"name"),Zt={EXISTS:qt,PROPER:qt&&"something"===function(){}.name,CONFIGURABLE:qt&&(!ht||ht&&Ht(Vt,"name").configurable)},Yt=N(Function.toString);lt(I.inspectSource)||(I.inspectSource=function(t){return Yt(t)});var $t,Kt,Qt,Xt=I.inspectSource,Jt=S.WeakMap,te=lt(Jt)&&/native code/.test(String(Jt)),ee=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},re=ht?function(t,e,r){return Gt.f(t,e,ee(1,r))}:function(t,e,r){return t[e]=r,t},ne=j("keys"),oe=function(t){return ne[t]||(ne[t]=q(t))},ie={},ae=S.TypeError,ue=S.WeakMap;if(te||I.state){var se=I.state||(I.state=new ue);se.get=se.get,se.has=se.has,se.set=se.set,$t=function(t,e){if(se.has(t))throw ae("Object already initialized");return e.facade=t,se.set(t,e),e},Kt=function(t){return se.get(t)||{}},Qt=function(t){return se.has(t)}}else{var ce=oe("state");ie[ce]=!0,$t=function(t,e){if(U(t,ce))throw ae("Object already initialized");return e.facade=t,re(t,ce,e),e},Kt=function(t){return U(t,ce)?t[ce]:{}},Qt=function(t){return U(t,ce)}}var fe={set:$t,get:Kt,has:Qt,enforce:function(t){return Qt(t)?Kt(t):$t(t,{})},getterFor:function(t){return function(e){var r;if(!vt(e)||(r=Kt(e)).type!==t)throw ae("Incompatible receiver, "+t+" required");return r}}},le=w((function(t){var e=Zt.CONFIGURABLE,r=fe.enforce,n=fe.get,o=String,i=Object.defineProperty,a=N("".slice),u=N("".replace),s=N([].join),c=ht&&!P((function(){return 8!==i((function(){}),"length",{value:8}).length})),f=String(String).split("String"),l=t.exports=function(t,n,l){"Symbol("===a(o(n),0,7)&&(n="["+u(o(n),/^Symbol\\(([^)]*)\\)/,"$1")+"]"),l&&l.getter&&(n="get "+n),l&&l.setter&&(n="set "+n),(!U(t,"name")||e&&t.name!==n)&&(ht?i(t,"name",{value:n,configurable:!0}):t.name=n),c&&l&&U(l,"arity")&&t.length!==l.arity&&i(t,"length",{value:l.arity});try{l&&U(l,"constructor")&&l.constructor?ht&&i(t,"prototype",{writable:!1}):t.prototype&&(t.prototype=void 0)}catch(t){}var h=r(t);return U(h,"source")||(h.source=s(f,"string"==typeof n?n:"")),t};Function.prototype.toString=l((function(){return lt(this)&&n(this).source||Xt(this)}),"toString")})),he=function(t,e,r,n){n||(n={});var o=n.enumerable,i=void 0!==n.name?n.name:e;if(lt(r)&&le(r,i,n),n.global)o?t[e]=r:k(e,r);else{try{n.unsafe?t[e]&&(o=!0):delete t[e]}catch(t){}o?t[e]=r:Gt.f(t,e,{value:r,enumerable:!1,configurable:!n.nonConfigurable,writable:!n.nonWritable})}return t},pe=N({}.toString),ve=N("".slice),de=function(t){return ve(pe(t),8,-1)},ye=it("toStringTag"),ge=Object,me="Arguments"==de(function(){return arguments}()),be=ut?de:function(t){var e,r,n;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=function(t,e){try{return t[e]}catch(t){}}(e=ge(t),ye))?r:me?de(e):"Object"==(n=de(e))&&lt(e.callee)?"Arguments":n},xe=ut?{}.toString:function(){return"[object "+be(this)+"]"};ut||he(Object.prototype,"toString",xe,{unsafe:!0});var we={}.propertyIsEnumerable,Ee=Object.getOwnPropertyDescriptor,Ae={f:Ee&&!we.call({1:2},1)?function(t){var e=Ee(this,t);return!!e&&e.enumerable}:we},Oe=Object,Se=N("".split),Te=P((function(){return!Oe("z").propertyIsEnumerable(0)}))?function(t){return"String"==de(t)?Se(t,""):Oe(t)}:Oe,ke=function(t){return Te(F(t))},Ie=Object.getOwnPropertyDescriptor,je={f:ht?Ie:function(t,e){if(t=ke(t),e=Wt(e),mt)try{return Ie(t,e)}catch(t){}if(U(t,e))return ee(!Ot(Ae.f,t,e),t[e])}},Pe=Math.ceil,_e=Math.floor,Me=Math.trunc||function(t){var e=+t;return(e>0?_e:Pe)(e)},Le=function(t){var e=+t;return e!=e||0===e?0:Me(e)},Re=Math.max,Ne=Math.min,Ce=function(t,e){var r=Le(t);return r<0?Re(r+e,0):Ne(r,e)},De=Math.min,Fe=function(t){return t>0?De(Le(t),9007199254740991):0},We=function(t){return Fe(t.length)},ze=function(t){return function(e,r,n){var o,i=ke(e),a=We(i),u=Ce(n,a);if(t&&r!=r){for(;a>u;)if((o=i[u++])!=o)return!0}else for(;a>u;u++)if((t||u in i)&&i[u]===r)return t||u||0;return!t&&-1}},Be={includes:ze(!0),indexOf:ze(!1)},Ue=Be.indexOf,Ge=N([].push),Ve=function(t,e){var r,n=ke(t),o=0,i=[];for(r in n)!U(ie,r)&&U(n,r)&&Ge(i,r);for(;e.length>o;)U(n,r=e[o++])&&(~Ue(i,r)||Ge(i,r));return i},He=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],qe=He.concat("length","prototype"),Ze={f:Object.getOwnPropertyNames||function(t){return Ve(t,qe)}},Ye={f:Object.getOwnPropertySymbols},$e=N([].concat),Ke=Tt("Reflect","ownKeys")||function(t){var e=Ze.f(Et(t)),r=Ye.f;return r?$e(e,r(t)):e},Qe=function(t,e,r){for(var n=Ke(e),o=Gt.f,i=je.f,a=0;a<n.length;a++){var u=n[a];U(t,u)||r&&U(r,u)||o(t,u,i(e,u))}},Xe=/#|\\.prototype\\./,Je=function(t,e){var r=er[tr(t)];return r==nr||r!=rr&&(lt(e)?P(e):!!e)},tr=Je.normalize=function(t){return String(t).replace(Xe,".").toLowerCase()},er=Je.data={},rr=Je.NATIVE="N",nr=Je.POLYFILL="P",or=Je,ir=je.f,ar=function(t,e){var r,n,o,i,a,u=t.target,s=t.global,c=t.stat;if(r=s?S:c?S[u]||k(u,{}):(S[u]||{}).prototype)for(n in e){if(i=e[n],o=t.dontCallGetSet?(a=ir(r,n))&&a.value:r[n],!or(s?n:u+(c?".":"#")+n,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Qe(i,o)}(t.sham||o&&o.sham)&&re(i,"sham",!0),he(r,n,i,t)}},ur="undefined"!=typeof process&&"process"==de(process),sr=String,cr=TypeError,fr=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,r={};try{(t=function(t,e,r){try{return N(Lt(Object.getOwnPropertyDescriptor(t,e)[r]))}catch(t){}}(Object.prototype,"__proto__","set"))(r,[]),e=r instanceof Array}catch(t){}return function(r,n){return Et(r),function(t){if("object"==typeof t||lt(t))return t;throw cr("Can\'t set "+sr(t)+" as a prototype")}(n),e?t(r,n):r.__proto__=n,r}}():void 0),lr=Gt.f,hr=it("toStringTag"),pr=function(t,e,r){t&&!r&&(t=t.prototype),t&&!U(t,hr)&&lr(t,hr,{configurable:!0,value:e})},vr=function(t,e,r){return r.get&&le(r.get,e,{getter:!0}),r.set&&le(r.set,e,{setter:!0}),Gt.f(t,e,r)},dr=it("species"),yr=function(t){var e=Tt(t);ht&&e&&!e[dr]&&vr(e,dr,{configurable:!0,get:function(){return this}})},gr=TypeError,mr=function(t,e){if(kt(e,t))return t;throw gr("Incorrect invocation")},br=function(){},xr=[],wr=Tt("Reflect","construct"),Er=/^\\s*(?:class|function)\\b/,Ar=N(Er.exec),Or=!Er.exec(br),Sr=function(t){if(!lt(t))return!1;try{return wr(br,xr,t),!0}catch(t){return!1}},Tr=function(t){if(!lt(t))return!1;switch(be(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return Or||!!Ar(Er,Xt(t))}catch(t){return!0}};Tr.sham=!0;var kr,Ir,jr,Pr,_r=!wr||P((function(){var t;return Sr(Sr.call)||!Sr(Object)||!Sr((function(){t=!0}))||t}))?Tr:Sr,Mr=TypeError,Lr=function(t){if(_r(t))return t;throw Mr(_t(t)+" is not a constructor")},Rr=it("species"),Nr=function(t,e){var r,n=Et(t).constructor;return void 0===n||C(r=Et(n)[Rr])?e:Lr(r)},Cr=Function.prototype,Dr=Cr.apply,Fr=Cr.call,Wr="object"==typeof Reflect&&Reflect.apply||(_?Fr.bind(Dr):function(){return Fr.apply(Dr,arguments)}),zr=function(t){if("Function"===de(t))return N(t)},Br=zr(zr.bind),Ur=function(t,e){return Lt(t),void 0===e?t:_?Br(t,e):function(){return t.apply(e,arguments)}},Gr=Tt("document","documentElement"),Vr=N([].slice),Hr=TypeError,qr=function(t,e){if(t<e)throw Hr("Not enough arguments");return t},Zr=/(?:ipad|iphone|ipod).*applewebkit/i.test(Z),Yr=S.setImmediate,$r=S.clearImmediate,Kr=S.process,Qr=S.Dispatch,Xr=S.Function,Jr=S.MessageChannel,tn=S.String,en=0,rn={};P((function(){kr=S.location}));var nn=function(t){if(U(rn,t)){var e=rn[t];delete rn[t],e()}},on=function(t){return function(){nn(t)}},an=function(t){nn(t.data)},un=function(t){S.postMessage(tn(t),kr.protocol+"//"+kr.host)};Yr&&$r||(Yr=function(t){qr(arguments.length,1);var e=lt(t)?t:Xr(t),r=Vr(arguments,1);return rn[++en]=function(){Wr(e,void 0,r)},Ir(en),en},$r=function(t){delete rn[t]},ur?Ir=function(t){Kr.nextTick(on(t))}:Qr&&Qr.now?Ir=function(t){Qr.now(on(t))}:Jr&&!Zr?(Pr=(jr=new Jr).port2,jr.port1.onmessage=an,Ir=Ur(Pr.postMessage,Pr)):S.addEventListener&&lt(S.postMessage)&&!S.importScripts&&kr&&"file:"!==kr.protocol&&!P(un)?(Ir=un,S.addEventListener("message",an,!1)):Ir="onreadystatechange"in gt("script")?function(t){Gr.appendChild(gt("script")).onreadystatechange=function(){Gr.removeChild(this),nn(t)}}:function(t){setTimeout(on(t),0)});var sn={set:Yr,clear:$r},cn=function(){this.head=null,this.tail=null};cn.prototype={add:function(t){var e={item:t,next:null},r=this.tail;r?r.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return null===(this.head=t.next)&&(this.tail=null),t.item}};var fn,ln,hn,pn,vn,dn=cn,yn=/ipad|iphone|ipod/i.test(Z)&&"undefined"!=typeof Pebble,gn=/web0s(?!.*chrome)/i.test(Z),mn=je.f,bn=sn.set,xn=S.MutationObserver||S.WebKitMutationObserver,wn=S.document,En=S.process,An=S.Promise,On=mn(S,"queueMicrotask"),Sn=On&&On.value;if(!Sn){var Tn=new dn,kn=function(){var t,e;for(ur&&(t=En.domain)&&t.exit();e=Tn.get();)try{e()}catch(t){throw Tn.head&&fn(),t}t&&t.enter()};Zr||ur||gn||!xn||!wn?!yn&&An&&An.resolve?((pn=An.resolve(void 0)).constructor=An,vn=Ur(pn.then,pn),fn=function(){vn(kn)}):ur?fn=function(){En.nextTick(kn)}:(bn=Ur(bn,S),fn=function(){bn(kn)}):(ln=!0,hn=wn.createTextNode(""),new xn(kn).observe(hn,{characterData:!0}),fn=function(){hn.data=ln=!ln}),Sn=function(t){Tn.head||fn(),Tn.add(t)}}var In,jn,Pn,_n=Sn,Mn=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Ln=S.Promise,Rn="object"==typeof Deno&&Deno&&"object"==typeof Deno.version,Nn=!Rn&&!ur&&"object"==typeof window&&"object"==typeof document,Cn=(Ln&&Ln.prototype,it("species")),Dn=!1,Fn=lt(S.PromiseRejectionEvent),Wn={CONSTRUCTOR:or("Promise",(function(){var t=Xt(Ln),e=t!==String(Ln);if(!e&&66===X)return!0;if(!X||X<51||!/native code/.test(t)){var r=new Ln((function(t){t(1)})),n=function(t){t((function(){}),(function(){}))};if((r.constructor={})[Cn]=n,!(Dn=r.then((function(){}))instanceof n))return!0}return!e&&(Nn||Rn)&&!Fn})),REJECTION_EVENT:Fn,SUBCLASSING:Dn},zn=TypeError,Bn=function(t){var e,r;this.promise=new t((function(t,n){if(void 0!==e||void 0!==r)throw zn("Bad Promise constructor");e=t,r=n})),this.resolve=Lt(e),this.reject=Lt(r)},Un={f:function(t){return new Bn(t)}},Gn=sn.set,Vn=Wn.CONSTRUCTOR,Hn=Wn.REJECTION_EVENT,qn=Wn.SUBCLASSING,Zn=fe.getterFor("Promise"),Yn=fe.set,$n=Ln&&Ln.prototype,Kn=Ln,Qn=$n,Xn=S.TypeError,Jn=S.document,to=S.process,eo=Un.f,ro=eo,no=!!(Jn&&Jn.createEvent&&S.dispatchEvent),oo=function(t){var e;return!(!vt(t)||!lt(e=t.then))&&e},io=function(t,e){var r,n,o,i=e.value,a=1==e.state,u=a?t.ok:t.fail,s=t.resolve,c=t.reject,f=t.domain;try{u?(a||(2===e.rejection&&fo(e),e.rejection=1),!0===u?r=i:(f&&f.enter(),r=u(i),f&&(f.exit(),o=!0)),r===t.promise?c(Xn("Promise-chain cycle")):(n=oo(r))?Ot(n,r,s,c):s(r)):c(i)}catch(t){f&&!o&&f.exit(),c(t)}},ao=function(t,e){t.notified||(t.notified=!0,_n((function(){for(var r,n=t.reactions;r=n.get();)io(r,t);t.notified=!1,e&&!t.rejection&&so(t)})))},uo=function(t,e,r){var n,o;no?((n=Jn.createEvent("Event")).promise=e,n.reason=r,n.initEvent(t,!1,!0),S.dispatchEvent(n)):n={promise:e,reason:r},!Hn&&(o=S["on"+t])?o(n):"unhandledrejection"===t&&function(t,e){try{1==arguments.length?console.error(t):console.error(t,e)}catch(t){}}("Unhandled promise rejection",r)},so=function(t){Ot(Gn,S,(function(){var e,r=t.facade,n=t.value;if(co(t)&&(e=Mn((function(){ur?to.emit("unhandledRejection",n,r):uo("unhandledrejection",r,n)})),t.rejection=ur||co(t)?2:1,e.error))throw e.value}))},co=function(t){return 1!==t.rejection&&!t.parent},fo=function(t){Ot(Gn,S,(function(){var e=t.facade;ur?to.emit("rejectionHandled",e):uo("rejectionhandled",e,t.value)}))},lo=function(t,e,r){return function(n){t(e,n,r)}},ho=function(t,e,r){t.done||(t.done=!0,r&&(t=r),t.value=e,t.state=2,ao(t,!0))},po=function(t,e,r){if(!t.done){t.done=!0,r&&(t=r);try{if(t.facade===e)throw Xn("Promise can\'t be resolved itself");var n=oo(e);n?_n((function(){var r={done:!1};try{Ot(n,e,lo(po,r,t),lo(ho,r,t))}catch(e){ho(r,e,t)}})):(t.value=e,t.state=1,ao(t,!1))}catch(e){ho({done:!1},e,t)}}};if(Vn&&(Qn=(Kn=function(t){mr(this,Qn),Lt(t),Ot(In,this);var e=Zn(this);try{t(lo(po,e),lo(ho,e))}catch(t){ho(e,t)}}).prototype,(In=function(t){Yn(this,{type:"Promise",done:!1,notified:!1,parent:!1,reactions:new dn,rejection:!1,state:0,value:void 0})}).prototype=he(Qn,"then",(function(t,e){var r=Zn(this),n=eo(Nr(this,Kn));return r.parent=!0,n.ok=!lt(t)||t,n.fail=lt(e)&&e,n.domain=ur?to.domain:void 0,0==r.state?r.reactions.add(n):_n((function(){io(n,r)})),n.promise})),jn=function(){var t=new In,e=Zn(t);this.promise=t,this.resolve=lo(po,e),this.reject=lo(ho,e)},Un.f=eo=function(t){return t===Kn||void 0===t?new jn(t):ro(t)},lt(Ln)&&$n!==Object.prototype)){Pn=$n.then,qn||he($n,"then",(function(t,e){var r=this;return new Kn((function(t,e){Ot(Pn,r,t,e)})).then(t,e)}),{unsafe:!0});try{delete $n.constructor}catch(t){}fr&&fr($n,Qn)}ar({global:!0,constructor:!0,wrap:!0,forced:Vn},{Promise:Kn}),pr(Kn,"Promise",!1),yr("Promise");var vo={},yo=it("iterator"),go=Array.prototype,mo=function(t){return void 0!==t&&(vo.Array===t||go[yo]===t)},bo=it("iterator"),xo=function(t){if(!C(t))return Rt(t,bo)||Rt(t,"@@iterator")||vo[be(t)]},wo=TypeError,Eo=function(t,e){var r=arguments.length<2?xo(t):e;if(Lt(r))return Et(Ot(r,t));throw wo(_t(t)+" is not iterable")},Ao=function(t,e,r){var n,o;Et(t);try{if(!(n=Rt(t,"return"))){if("throw"===e)throw r;return r}n=Ot(n,t)}catch(t){o=!0,n=t}if("throw"===e)throw r;if(o)throw n;return Et(n),r},Oo=TypeError,So=function(t,e){this.stopped=t,this.result=e},To=So.prototype,ko=function(t,e,r){var n,o,i,a,u,s,c,f=r&&r.that,l=!(!r||!r.AS_ENTRIES),h=!(!r||!r.IS_RECORD),p=!(!r||!r.IS_ITERATOR),v=!(!r||!r.INTERRUPTED),d=Ur(e,f),y=function(t){return n&&Ao(n,"normal",t),new So(!0,t)},g=function(t){return l?(Et(t),v?d(t[0],t[1],y):d(t[0],t[1])):v?d(t,y):d(t)};if(h)n=t.iterator;else if(p)n=t;else{if(!(o=xo(t)))throw Oo(_t(t)+" is not iterable");if(mo(o)){for(i=0,a=We(t);a>i;i++)if((u=g(t[i]))&&kt(To,u))return u;return new So(!1)}n=Eo(t,o)}for(s=h?t.next:n.next;!(c=Ot(s,n)).done;){try{u=g(c.value)}catch(t){Ao(n,"throw",t)}if("object"==typeof u&&u&&kt(To,u))return u}return new So(!1)},Io=it("iterator"),jo=!1;try{var Po=0,_o={next:function(){return{done:!!Po++}},return:function(){jo=!0}};_o[Io]=function(){return this},Array.from(_o,(function(){throw 2}))}catch(t){}var Mo=function(t,e){if(!e&&!jo)return!1;var r=!1;try{var n={};n[Io]=function(){return{next:function(){return{done:r=!0}}}},t(n)}catch(t){}return r},Lo=Wn.CONSTRUCTOR||!Mo((function(t){Ln.all(t).then(void 0,(function(){}))}));ar({target:"Promise",stat:!0,forced:Lo},{all:function(t){var e=this,r=Un.f(e),n=r.resolve,o=r.reject,i=Mn((function(){var r=Lt(e.resolve),i=[],a=0,u=1;ko(t,(function(t){var s=a++,c=!1;u++,Ot(r,e,t).then((function(t){c||(c=!0,i[s]=t,--u||n(i))}),o)})),--u||n(i)}));return i.error&&o(i.value),r.promise}});var Ro=Wn.CONSTRUCTOR,No=Ln&&Ln.prototype;if(ar({target:"Promise",proto:!0,forced:Ro,real:!0},{catch:function(t){return this.then(void 0,t)}}),lt(Ln)){var Co=Tt("Promise").prototype.catch;No.catch!==Co&&he(No,"catch",Co,{unsafe:!0})}ar({target:"Promise",stat:!0,forced:Lo},{race:function(t){var e=this,r=Un.f(e),n=r.reject,o=Mn((function(){var o=Lt(e.resolve);ko(t,(function(t){Ot(o,e,t).then(r.resolve,n)}))}));return o.error&&n(o.value),r.promise}}),ar({target:"Promise",stat:!0,forced:Wn.CONSTRUCTOR},{reject:function(t){var e=Un.f(this);return Ot(e.reject,void 0,t),e.promise}});var Do=Wn.CONSTRUCTOR;Tt("Promise");function Fo(t,e){if(!t)throw new Error(e||"web worker helper assertion failed.")}ar({target:"Promise",stat:!0,forced:Do},{resolve:function(t){return function(t,e){if(Et(t),vt(e)&&e.constructor===t)return e;var r=Un.f(t);return(0,r.resolve)(e),r.promise}(this,t)}});var Wo="undefined"!=typeof window&&void 0!==window.orientation,zo=function(){function t(t,e){var r=this;this.name=t,this.workerThread=e,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise((function(t,e){r.resolve=t,r.reject=e}))}return t.prototype.postMessage=function(t,e){this.workerThread.postMessage({source:"Main thread",type:t,payload:e})},t.prototype.done=function(t){Fo(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(t)},t.prototype.error=function(t){Fo(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(t)},t}(),Bo=new Map;function Uo(t){Fo(t.source&&!t.url||!t.source&&t.url);var e=Bo.get(t.source||t.url);return e||(t.url&&(e=function(t){if(!t.startsWith("http"))return t;return Go((e=t,"try {\\n  importScripts(\'"+e+"\');\\n} catch (error) {\\n  console.error(error);\\n  throw error;\\n}"));var e}(t.url),Bo.set(t.url,e)),t.source&&(e=Go(t.source),Bo.set(t.source,e))),Fo(e),e}function Go(t){var e=new Blob([t],{type:"application/javascript"});return URL.createObjectURL(e)}function Vo(t,e,r){void 0===e&&(e=!0);var n=r||new Set;if(t){if(Ho(t))n.add(t);else if(Ho(t.buffer))n.add(t.buffer);else if(ArrayBuffer.isView(t));else if(e&&"object"==typeof t)for(var o in t)Vo(t[o],e,n)}else;return void 0===r?Array.from(n):[]}function Ho(t){return!!t&&(t instanceof ArrayBuffer||("undefined"!=typeof MessagePort&&t instanceof MessagePort||("undefined"!=typeof ImageBitmap&&t instanceof ImageBitmap||"undefined"!=typeof OffscreenCanvas&&t instanceof OffscreenCanvas)))}var qo=function(){},Zo=function(){function t(t){this.terminated=!1,this.loadableURL="";var e=t.name,r=t.source,n=t.url;Fo(r||n),this.name=e,this.source=r,this.url=n,this.onMessage=qo,this.onError=function(t){return console.log(t)},this.worker=this.createBrowserWorker()}return t.isSupported=function(){return"undefined"!=typeof Worker},t.prototype.destroy=function(){this.onMessage=qo,this.onError=qo,this.worker.terminate(),this.terminated=!0},Object.defineProperty(t.prototype,"isRunning",{get:function(){return Boolean(this.onMessage)},enumerable:!1,configurable:!0}),t.prototype.postMessage=function(t,e){e=e||Vo(t),this.worker.postMessage(t,e)},t.prototype.getErrorFromErrorEvent=function(t){var e="Failed to load ";return e+="worker "+this.name+" from "+this.url+". ",t.message&&(e+=t.message+" in "),t.lineno&&(e+=":"+t.lineno+":"+t.colno),new Error(e)},t.prototype.createBrowserWorker=function(){var t=this;this.loadableURL=Uo({source:this.source,url:this.url});var e=new Worker(this.loadableURL,{name:this.name});return e.onmessage=function(e){e.data?t.onMessage(e.data):t.onError(new Error("No data received"))},e.onerror=function(e){t.onError(t.getErrorFromErrorEvent(e)),t.terminated=!0},e.onmessageerror=function(e){return console.error("worker "+t.name+", message error: "+e)},e},t}(),Yo=self&&self.__assign||function(){return(Yo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},$o=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},Ko=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},Qo=function(){function t(t){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=t.source,this.url=t.url,this.setProps(t)}return t.prototype.destroy=function(){this.idleQueue.forEach((function(t){return t.destroy()})),this.isDestroyed=!0},t.prototype.setProps=function(t){this.props=Yo(Yo({},this.props),t),void 0!==t.name&&(this.name=t.name),void 0!==t.maxConcurrency&&(this.maxConcurrency=t.maxConcurrency),void 0!==t.maxMobileConcurrency&&(this.maxMobileConcurrency=t.maxMobileConcurrency),void 0!==t.reuseWorkers&&(this.reuseWorkers=t.reuseWorkers),void 0!==t.onDebug&&(this.onDebug=t.onDebug)},t.prototype.startJob=function(t,e,r){return void 0===e&&(e=function(t,e,r){return t.done(r)}),void 0===r&&(r=function(t,e){return t.error(e)}),$o(this,void 0,void 0,(function(){var n,o=this;return Ko(this,(function(i){switch(i.label){case 0:return n=new Promise((function(n){return o.jobQueue.push({name:t,onMessage:e,onError:r,onStart:n}),o})),this.startQueuedJob(),[4,n];case 1:return[2,i.sent()]}}))}))},t.prototype.startQueuedJob=function(){return $o(this,void 0,void 0,(function(){var t,e,r;return Ko(this,(function(n){switch(n.label){case 0:if(!this.jobQueue.length)return[2];if(!(t=this.getAvailableWorker()))return[2];if(!(e=this.jobQueue.shift()))return[3,4];this.onDebug({message:"Starting job",name:e.name,backlog:this.jobQueue.length,workerThread:t}),r=new zo(e.name,t),t.onMessage=function(t){return e.onMessage(r,t.type,t.payload)},t.onError=function(t){return e.onError(r,t)},e.onStart(r),n.label=1;case 1:return n.trys.push([1,,3,4]),[4,r.result];case 2:return n.sent(),[3,4];case 3:return this.returnWorkerToQueue(t),[7];case 4:return[2]}}))}))},t.prototype.returnWorkerToQueue=function(t){this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency()?(t.destroy(),this.count--):this.idleQueue.push(t),this.isDestroyed||this.startQueuedJob()},t.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var t=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new Zo({name:t,source:this.source,url:this.url})}return null},t.prototype.getMaxConcurrency=function(){return Wo?this.maxMobileConcurrency:this.maxConcurrency},t}(),Xo=self&&self.__assign||function(){return(Xo=Object.assign||function(t){for(var e,r=1,n=arguments.length;r<n;r++)for(var o in e=arguments[r])Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o]);return t}).apply(this,arguments)},Jo=self&&self.__values||function(t){var e="function"==typeof Symbol&&Symbol.iterator,r=e&&t[e],n=0;if(r)return r.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&n>=t.length&&(t=void 0),{value:t&&t[n++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ti={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},ei=(function(){function t(t){this.workerPools=new Map,this.props=Xo({},ti),this.setProps(t),this.workerPools=new Map}t.isSupported=function(){return Zo.isSupported()},t.getWorkerFarm=function(e){return void 0===e&&(e={}),t.workerFarm=t.workerFarm||new t({}),t.workerFarm.setProps(e),t.workerFarm},t.prototype.destroy=function(){var t,e;try{for(var r=Jo(this.workerPools.values()),n=r.next();!n.done;n=r.next()){n.value.destroy()}}catch(e){t={error:e}}finally{try{n&&!n.done&&(e=r.return)&&e.call(r)}finally{if(t)throw t.error}}},t.prototype.setProps=function(t){var e,r;this.props=Xo(Xo({},this.props),t);try{for(var n=Jo(this.workerPools.values()),o=n.next();!o.done;o=n.next()){o.value.setProps(this.getWorkerPoolProps())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(r=n.return)&&r.call(n)}finally{if(e)throw e.error}}},t.prototype.getWorkerPool=function(t){var e=t.name,r=t.source,n=t.url,o=this.workerPools.get(e);return o||((o=new Qo({name:e,source:r,url:n})).setProps(this.getWorkerPoolProps()),this.workerPools.set(e,o)),o},t.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}}}(),new Map),ri=function(){function t(){}return Object.defineProperty(t,"onmessage",{set:function(t){self.onmessage=function(e){if(ni(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}},enumerable:!1,configurable:!0}),t.addEventListener=function(t){var e=ei.get(t);e||(e=function(e){if(ni(e)){var r=e.data,n=r.type,o=r.payload;t(n,o)}}),self.addEventListener("message",e)},t.removeEventListener=function(t){var e=ei.get(t);ei.delete(t),self.removeEventListener("message",e)},t.postMessage=function(t,e){if(self){var r={source:"Worker thread",type:t,payload:e},n=Vo(e);self.postMessage(r,n)}},t}();function ni(t){var e=t.type,r=t.data;return"message"===e&&r&&"string"==typeof r.source&&"Main thread"===r.source}self&&self.__awaiter,self&&self.__generator;var oi,ii,ai=function(){function t(){this._values=[],this._settlers=[],this._closed=!1}return t.prototype[Symbol.asyncIterator]=function(){return this},t.prototype.push=function(t){return this.enqueue(t)},t.prototype.enqueue=function(t){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var e=this._settlers.shift();t instanceof Error?e.reject(t):e.resolve({value:t})}else this._values.push(t)},t.prototype.close=function(){for(;this._settlers.length>0;){this._settlers.shift().resolve({done:!0})}this._closed=!0},t.prototype.next=function(){var t=this;if(this._values.length>0){var e=this._values.shift();return e instanceof Error?Promise.reject(e):Promise.resolve({done:!1,value:e})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise((function(e,r){t._settlers.push({resolve:e,reject:r})}))},t}(),ui=self&&self.__awaiter||function(t,e,r,n){return new(r||(r=Promise))((function(o,i){function a(t){try{s(n.next(t))}catch(t){i(t)}}function u(t){try{s(n.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof r?e:new r((function(t){t(e)}))).then(a,u)}s((n=n.apply(t,e||[])).next())}))},si=self&&self.__generator||function(t,e){var r,n,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(r)throw new TypeError("Generator is already executing.");for(;a;)try{if(r=1,n&&(o=2&i[0]?n.return:i[0]?n.throw||((o=n.return)&&o.call(n),0):n.next)&&!(o=o.call(n,i[1])).done)return o;switch(n=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,n=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=e.call(t,a)}catch(t){i=[6,t],n=0}finally{r=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}},ci=self&&self.__asyncValues||function(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e,r=t[Symbol.asyncIterator];return r?r.call(t):(t="function"==typeof __values?__values(t):t[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(r){e[r]=t[r]&&function(e){return new Promise((function(n,o){(function(t,e,r,n){Promise.resolve(n).then((function(e){t({value:e,done:r})}),e)})(n,o,(e=t[r](e)).done,e.value)}))}}},fi=0;function li(t,e){var r=this;if("undefined"!=typeof self){var n={process:hi};ri.onmessage=function(o,i){return ui(r,void 0,void 0,(function(){var r,a,u,s,c,f,l,h,p,v;return si(this,(function(d){switch(d.label){case 0:switch(d.trys.push([0,19,,20]),o){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!t)throw new Error("Worker does not support atomic processing");return[4,t(i.input,i.options||{},n)];case 2:return r=d.sent(),ri.postMessage("done",{result:r}),[3,18];case 3:if(!e)throw new Error("Worker does not support batched processing");oi=new ai,ii=i.options||{},a=e(oi,ii,n),d.label=4;case 4:d.trys.push([4,9,10,15]),u=ci(a),d.label=5;case 5:return[4,u.next()];case 6:if((s=d.sent()).done)return[3,8];c=s.value,ri.postMessage("output-batch",{result:c}),d.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return f=d.sent(),p={error:f},[3,15];case 10:return d.trys.push([10,,13,14]),s&&!s.done&&(v=u.return)?[4,v.call(u)]:[3,12];case 11:d.sent(),d.label=12;case 12:return[3,14];case 13:if(p)throw p.error;return[7];case 14:return[7];case 15:return ri.postMessage("done",{}),[3,18];case 16:return oi.push(i.input),[3,18];case 17:return oi.close(),[3,18];case 18:return[3,20];case 19:return l=d.sent(),h=l instanceof Error?l.message:"",ri.postMessage("error",{error:h}),[3,20];case 20:return[2]}}))}))}}}function hi(t,e){return void 0===e&&(e={}),new Promise((function(r,n){var o=fi++,i=function(t,e){if(e.id===o)switch(t){case"done":ri.removeEventListener(i),r(e.result);break;case"error":ri.removeEventListener(i),n(e.error)}};ri.addEventListener(i);var a={id:o,input:t,options:e};ri.postMessage("process",a)}))}self&&self.__awaiter,self&&self.__generator;var pi={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},vi=gt("span").classList,di=vi&&vi.constructor&&vi.constructor.prototype,yi=di===Object.prototype?void 0:di,gi=Array.isArray||function(t){return"Array"==de(t)},mi=it("species"),bi=Array,xi=function(t,e){return new(function(t){var e;return gi(t)&&(e=t.constructor,(_r(e)&&(e===bi||gi(e.prototype))||vt(e)&&null===(e=e[mi]))&&(e=void 0)),void 0===e?bi:e}(t))(0===e?0:e)},wi=N([].push),Ei=function(t){var e=1==t,r=2==t,n=3==t,o=4==t,i=6==t,a=7==t,u=5==t||i;return function(s,c,f,l){for(var h,p,v=z(s),d=Te(v),y=Ur(c,f),g=We(d),m=0,b=l||xi,x=e?b(s,g):r||a?b(s,0):void 0;g>m;m++)if((u||m in d)&&(p=y(h=d[m],m,v),t))if(e)x[m]=p;else if(p)switch(t){case 3:return!0;case 5:return h;case 6:return m;case 2:wi(x,h)}else switch(t){case 4:return!1;case 7:wi(x,h)}return i?-1:n||o?o:x}},Ai={forEach:Ei(0),map:Ei(1),filter:Ei(2),some:Ei(3),every:Ei(4),find:Ei(5),findIndex:Ei(6),filterReject:Ei(7)},Oi=function(t,e){var r=[][t];return!!r&&P((function(){r.call(null,e||function(){return 1},1)}))},Si=Ai.forEach,Ti=Oi("forEach")?[].forEach:function(t){return Si(this,t,arguments.length>1?arguments[1]:void 0)},ki=function(t){if(t&&t.forEach!==Ti)try{re(t,"forEach",Ti)}catch(e){t.forEach=Ti}};for(var Ii in pi)pi[Ii]&&ki(S[Ii]&&S[Ii].prototype);ki(yi);var ji=function(t,e,r){var n=Wt(e);n in t?Gt.f(t,n,ee(0,r)):t[n]=r},Pi=it("species"),_i=function(t){return X>=51||!P((function(){var e=[];return(e.constructor={})[Pi]=function(){return{foo:1}},1!==e[t](Boolean).foo}))},Mi=_i("slice"),Li=it("species"),Ri=Array,Ni=Math.max;ar({target:"Array",proto:!0,forced:!Mi},{slice:function(t,e){var r,n,o,i=ke(this),a=We(i),u=Ce(t,a),s=Ce(void 0===e?a:e,a);if(gi(i)&&(r=i.constructor,(_r(r)&&(r===Ri||gi(r.prototype))||vt(r)&&null===(r=r[Li]))&&(r=void 0),r===Ri||void 0===r))return Vr(i,u,s);for(n=new(void 0===r?Ri:r)(Ni(s-u,0)),o=0;u<s;u++,o++)u in i&&ji(n,o,i[u]);return n.length=o,n}});var Ci=Zt.EXISTS,Di=Function.prototype,Fi=N(Di.toString),Wi=/function\\b(?:\\s|\\/\\*[\\S\\s]*?\\*\\/|\\/\\/[^\\n\\r]*[\\n\\r]+)*([^\\s(/]*)/,zi=N(Wi.exec);ht&&!Ci&&vr(Di,"name",{configurable:!0,get:function(){try{return zi(Wi,Fi(this))[1]}catch(t){return""}}});var Bi,Ui=Object.keys||function(t){return Ve(t,He)},Gi={f:ht&&!bt?Object.defineProperties:function(t,e){Et(t);for(var r,n=ke(e),o=Ui(e),i=o.length,a=0;i>a;)Gt.f(t,r=o[a++],n[r]);return t}},Vi=oe("IE_PROTO"),Hi=function(){},qi=function(t){return"<script>"+t+"<\\/script>"},Zi=function(t){t.write(qi("")),t.close();var e=t.parentWindow.Object;return t=null,e},Yi=function(){try{Bi=new ActiveXObject("htmlfile")}catch(t){}var t,e;Yi="undefined"!=typeof document?document.domain&&Bi?Zi(Bi):((e=gt("iframe")).style.display="none",Gr.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(qi("document.F=Object")),t.close(),t.F):Zi(Bi);for(var r=He.length;r--;)delete Yi.prototype[He[r]];return Yi()};ie[Vi]=!0;var $i=Object.create||function(t,e){var r;return null!==t?(Hi.prototype=Et(t),r=new Hi,Hi.prototype=null,r[Vi]=t):r=Yi(),void 0===e?r:Gi.f(r,e)},Ki=Gt.f,Qi=it("unscopables"),Xi=Array.prototype;null==Xi[Qi]&&Ki(Xi,Qi,{configurable:!0,value:$i(null)});var Ji,ta,ea,ra=function(t){Xi[Qi][t]=!0},na=!P((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),oa=oe("IE_PROTO"),ia=Object,aa=ia.prototype,ua=na?ia.getPrototypeOf:function(t){var e=z(t);if(U(e,oa))return e[oa];var r=e.constructor;return lt(r)&&e instanceof r?r.prototype:e instanceof ia?aa:null},sa=it("iterator"),ca=!1;[].keys&&("next"in(ea=[].keys())?(ta=ua(ua(ea)))!==Object.prototype&&(Ji=ta):ca=!0),(!vt(Ji)||P((function(){var t={};return Ji[sa].call(t)!==t})))&&(Ji={}),lt(Ji[sa])||he(Ji,sa,(function(){return this}));var fa={IteratorPrototype:Ji,BUGGY_SAFARI_ITERATORS:ca},la=fa.IteratorPrototype,ha=function(){return this},pa=Zt.PROPER,va=Zt.CONFIGURABLE,da=fa.IteratorPrototype,ya=fa.BUGGY_SAFARI_ITERATORS,ga=it("iterator"),ma=function(){return this},ba=function(t,e,r,n,o,i,a){!function(t,e,r,n){var o=e+" Iterator";t.prototype=$i(la,{next:ee(+!n,r)}),pr(t,o,!1),vo[o]=ha}(r,e,n);var u,s,c,f=function(t){if(t===o&&d)return d;if(!ya&&t in p)return p[t];switch(t){case"keys":case"values":case"entries":return function(){return new r(this,t)}}return function(){return new r(this)}},l=e+" Iterator",h=!1,p=t.prototype,v=p[ga]||p["@@iterator"]||o&&p[o],d=!ya&&v||f(o),y="Array"==e&&p.entries||v;if(y&&(u=ua(y.call(new t)))!==Object.prototype&&u.next&&(ua(u)!==da&&(fr?fr(u,da):lt(u[ga])||he(u,ga,ma)),pr(u,l,!0)),pa&&"values"==o&&v&&"values"!==v.name&&(va?re(p,"name","values"):(h=!0,d=function(){return Ot(v,this)})),o)if(s={values:f("values"),keys:i?d:f("keys"),entries:f("entries")},a)for(c in s)(ya||h||!(c in p))&&he(p,c,s[c]);else ar({target:e,proto:!0,forced:ya||h},s);return p[ga]!==d&&he(p,ga,d,{name:o}),vo[e]=d,s},xa=function(t,e){return{value:t,done:e}},wa=Gt.f,Ea=fe.set,Aa=fe.getterFor("Array Iterator"),Oa=ba(Array,"Array",(function(t,e){Ea(this,{type:"Array Iterator",target:ke(t),index:0,kind:e})}),(function(){var t=Aa(this),e=t.target,r=t.kind,n=t.index++;return!e||n>=e.length?(t.target=void 0,xa(void 0,!0)):xa("keys"==r?n:"values"==r?e[n]:[n,e[n]],!1)}),"values"),Sa=vo.Arguments=vo.Array;if(ra("keys"),ra("values"),ra("entries"),ht&&"values"!==Sa.name)try{wa(Sa,"name",{value:"values"})}catch(t){}var Ta,ka,Ia,ja="undefined"!=typeof ArrayBuffer&&"undefined"!=typeof DataView,Pa=fe.enforce,_a=fe.get,Ma=S.Int8Array,La=Ma&&Ma.prototype,Ra=S.Uint8ClampedArray,Na=Ra&&Ra.prototype,Ca=Ma&&ua(Ma),Da=La&&ua(La),Fa=Object.prototype,Wa=S.TypeError,za=it("toStringTag"),Ba=q("TYPED_ARRAY_TAG"),Ua=ja&&!!fr&&"Opera"!==be(S.opera),Ga=!1,Va={Int8Array:1,Uint8Array:1,Uint8ClampedArray:1,Int16Array:2,Uint16Array:2,Int32Array:4,Uint32Array:4,Float32Array:4,Float64Array:8},Ha={BigInt64Array:8,BigUint64Array:8},qa=function(t){var e=ua(t);if(vt(e)){var r=_a(e);return r&&U(r,"TypedArrayConstructor")?r.TypedArrayConstructor:qa(e)}},Za=function(t){if(!vt(t))return!1;var e=be(t);return U(Va,e)||U(Ha,e)};for(Ta in Va)(Ia=(ka=S[Ta])&&ka.prototype)?Pa(Ia).TypedArrayConstructor=ka:Ua=!1;for(Ta in Ha)(Ia=(ka=S[Ta])&&ka.prototype)&&(Pa(Ia).TypedArrayConstructor=ka);if((!Ua||!lt(Ca)||Ca===Function.prototype)&&(Ca=function(){throw Wa("Incorrect invocation")},Ua))for(Ta in Va)S[Ta]&&fr(S[Ta],Ca);if((!Ua||!Da||Da===Fa)&&(Da=Ca.prototype,Ua))for(Ta in Va)S[Ta]&&fr(S[Ta].prototype,Da);if(Ua&&ua(Na)!==Da&&fr(Na,Da),ht&&!U(Da,za))for(Ta in Ga=!0,vr(Da,za,{configurable:!0,get:function(){return vt(this)?this[Ba]:void 0}}),Va)S[Ta]&&re(S[Ta],Ba,Ta);var Ya={NATIVE_ARRAY_BUFFER_VIEWS:Ua,TYPED_ARRAY_TAG:Ga&&Ba,aTypedArray:function(t){if(Za(t))return t;throw Wa("Target is not a typed array")},aTypedArrayConstructor:function(t){if(lt(t)&&(!fr||kt(Ca,t)))return t;throw Wa(_t(t)+" is not a typed array constructor")},exportTypedArrayMethod:function(t,e,r,n){if(ht){if(r)for(var o in Va){var i=S[o];if(i&&U(i.prototype,t))try{delete i.prototype[t]}catch(r){try{i.prototype[t]=e}catch(t){}}}Da[t]&&!r||he(Da,t,r?e:Ua&&La[t]||e,n)}},exportTypedArrayStaticMethod:function(t,e,r){var n,o;if(ht){if(fr){if(r)for(n in Va)if((o=S[n])&&U(o,t))try{delete o[t]}catch(t){}if(Ca[t]&&!r)return;try{return he(Ca,t,r?e:Ua&&Ca[t]||e)}catch(t){}}for(n in Va)!(o=S[n])||o[t]&&!r||he(o,t,e)}},getTypedArrayConstructor:qa,isView:function(t){if(!vt(t))return!1;var e=be(t);return"DataView"===e||U(Va,e)||U(Ha,e)},isTypedArray:Za,TypedArray:Ca,TypedArrayPrototype:Da},$a=Ya.NATIVE_ARRAY_BUFFER_VIEWS,Ka=S.ArrayBuffer,Qa=S.Int8Array,Xa=!$a||!P((function(){Qa(1)}))||!P((function(){new Qa(-1)}))||!Mo((function(t){new Qa,new Qa(null),new Qa(1.5),new Qa(t)}),!0)||P((function(){return 1!==new Qa(new Ka(2),1,void 0).length})),Ja=function(t,e,r){for(var n in e)he(t,n,e[n],r);return t},tu=RangeError,eu=function(t){if(void 0===t)return 0;var e=Le(t),r=Fe(e);if(e!==r)throw tu("Wrong length or index");return r},ru=Array,nu=Math.abs,ou=Math.pow,iu=Math.floor,au=Math.log,uu=Math.LN2,su=function(t,e,r){var n,o,i,a=ru(r),u=8*r-e-1,s=(1<<u)-1,c=s>>1,f=23===e?ou(2,-24)-ou(2,-77):0,l=t<0||0===t&&1/t<0?1:0,h=0;for((t=nu(t))!=t||t===1/0?(o=t!=t?1:0,n=s):(n=iu(au(t)/uu),t*(i=ou(2,-n))<1&&(n--,i*=2),(t+=n+c>=1?f/i:f*ou(2,1-c))*i>=2&&(n++,i/=2),n+c>=s?(o=0,n=s):n+c>=1?(o=(t*i-1)*ou(2,e),n+=c):(o=t*ou(2,c-1)*ou(2,e),n=0));e>=8;)a[h++]=255&o,o/=256,e-=8;for(n=n<<e|o,u+=e;u>0;)a[h++]=255&n,n/=256,u-=8;return a[--h]|=128*l,a},cu=function(t,e){var r,n=t.length,o=8*n-e-1,i=(1<<o)-1,a=i>>1,u=o-7,s=n-1,c=t[s--],f=127&c;for(c>>=7;u>0;)f=256*f+t[s--],u-=8;for(r=f&(1<<-u)-1,f>>=-u,u+=e;u>0;)r=256*r+t[s--],u-=8;if(0===f)f=1-a;else{if(f===i)return r?NaN:c?-1/0:1/0;r+=ou(2,e),f-=a}return(c?-1:1)*r*ou(2,f-e)},fu=function(t){for(var e=z(this),r=We(e),n=arguments.length,o=Ce(n>1?arguments[1]:void 0,r),i=n>2?arguments[2]:void 0,a=void 0===i?r:Ce(i,r);a>o;)e[o++]=t;return e},lu=Array,hu=Math.max,pu=function(t,e,r){for(var n=We(t),o=Ce(e,n),i=Ce(void 0===r?n:r,n),a=lu(hu(i-o,0)),u=0;o<i;o++,u++)ji(a,u,t[o]);return a.length=u,a},vu=Ze.f,du=Zt.PROPER,yu=Zt.CONFIGURABLE,gu=fe.getterFor("ArrayBuffer"),mu=fe.getterFor("DataView"),bu=fe.set,xu=S.ArrayBuffer,wu=xu,Eu=wu&&wu.prototype,Au=S.DataView,Ou=Au&&Au.prototype,Su=Object.prototype,Tu=S.Array,ku=S.RangeError,Iu=N(fu),ju=N([].reverse),Pu=su,_u=cu,Mu=function(t){return[255&t]},Lu=function(t){return[255&t,t>>8&255]},Ru=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},Nu=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},Cu=function(t){return Pu(t,23,4)},Du=function(t){return Pu(t,52,8)},Fu=function(t,e,r){vr(t.prototype,e,{configurable:!0,get:function(){return r(this)[e]}})},Wu=function(t,e,r,n){var o=eu(r),i=mu(t);if(o+e>i.byteLength)throw ku("Wrong index");var a=i.bytes,u=o+i.byteOffset,s=pu(a,u,u+e);return n?s:ju(s)},zu=function(t,e,r,n,o,i){var a=eu(r),u=mu(t);if(a+e>u.byteLength)throw ku("Wrong index");for(var s=u.bytes,c=a+u.byteOffset,f=n(+o),l=0;l<e;l++)s[c+l]=f[i?l:e-l-1]};if(ja){var Bu=du&&"ArrayBuffer"!==xu.name;if(P((function(){xu(1)}))&&P((function(){new xu(-1)}))&&!P((function(){return new xu,new xu(1.5),new xu(NaN),1!=xu.length||Bu&&!yu})))Bu&&yu&&re(xu,"name","ArrayBuffer");else{(wu=function(t){return mr(this,Eu),new xu(eu(t))}).prototype=Eu;for(var Uu,Gu=vu(xu),Vu=0;Gu.length>Vu;)(Uu=Gu[Vu++])in wu||re(wu,Uu,xu[Uu]);Eu.constructor=wu}fr&&ua(Ou)!==Su&&fr(Ou,Su);var Hu=new Au(new wu(2)),qu=N(Ou.setInt8);Hu.setInt8(0,2147483648),Hu.setInt8(1,2147483649),!Hu.getInt8(0)&&Hu.getInt8(1)||Ja(Ou,{setInt8:function(t,e){qu(this,t,e<<24>>24)},setUint8:function(t,e){qu(this,t,e<<24>>24)}},{unsafe:!0})}else Eu=(wu=function(t){mr(this,Eu);var e=eu(t);bu(this,{type:"ArrayBuffer",bytes:Iu(Tu(e),0),byteLength:e}),ht||(this.byteLength=e,this.detached=!1)}).prototype,Ou=(Au=function(t,e,r){mr(this,Ou),mr(t,Eu);var n=gu(t),o=n.byteLength,i=Le(e);if(i<0||i>o)throw ku("Wrong offset");if(i+(r=void 0===r?o-i:Fe(r))>o)throw ku("Wrong length");bu(this,{type:"DataView",buffer:t,byteLength:r,byteOffset:i,bytes:n.bytes}),ht||(this.buffer=t,this.byteLength=r,this.byteOffset=i)}).prototype,ht&&(Fu(wu,"byteLength",gu),Fu(Au,"buffer",mu),Fu(Au,"byteLength",mu),Fu(Au,"byteOffset",mu)),Ja(Ou,{getInt8:function(t){return Wu(this,1,t)[0]<<24>>24},getUint8:function(t){return Wu(this,1,t)[0]},getInt16:function(t){var e=Wu(this,2,t,arguments.length>1?arguments[1]:void 0);return(e[1]<<8|e[0])<<16>>16},getUint16:function(t){var e=Wu(this,2,t,arguments.length>1?arguments[1]:void 0);return e[1]<<8|e[0]},getInt32:function(t){return Nu(Wu(this,4,t,arguments.length>1?arguments[1]:void 0))},getUint32:function(t){return Nu(Wu(this,4,t,arguments.length>1?arguments[1]:void 0))>>>0},getFloat32:function(t){return _u(Wu(this,4,t,arguments.length>1?arguments[1]:void 0),23)},getFloat64:function(t){return _u(Wu(this,8,t,arguments.length>1?arguments[1]:void 0),52)},setInt8:function(t,e){zu(this,1,t,Mu,e)},setUint8:function(t,e){zu(this,1,t,Mu,e)},setInt16:function(t,e){zu(this,2,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setUint16:function(t,e){zu(this,2,t,Lu,e,arguments.length>2?arguments[2]:void 0)},setInt32:function(t,e){zu(this,4,t,Ru,e,arguments.length>2?arguments[2]:void 0)},setUint32:function(t,e){zu(this,4,t,Ru,e,arguments.length>2?arguments[2]:void 0)},setFloat32:function(t,e){zu(this,4,t,Cu,e,arguments.length>2?arguments[2]:void 0)},setFloat64:function(t,e){zu(this,8,t,Du,e,arguments.length>2?arguments[2]:void 0)}});pr(wu,"ArrayBuffer"),pr(Au,"DataView");var Zu={ArrayBuffer:wu,DataView:Au},Yu=Math.floor,$u=Number.isInteger||function(t){return!vt(t)&&isFinite(t)&&Yu(t)===t},Ku=RangeError,Qu=RangeError,Xu=function(t,e){var r=function(t){var e=Le(t);if(e<0)throw Ku("The argument can\'t be less than 0");return e}(t);if(r%e)throw Qu("Wrong offset");return r},Ju=function(t){var e=be(t);return"BigInt64Array"==e||"BigUint64Array"==e},ts=TypeError,es=function(t){var e=Ft(t,"number");if("number"==typeof e)throw ts("Can\'t convert number to bigint");return BigInt(e)},rs=Ya.aTypedArrayConstructor,ns=function(t){var e,r,n,o,i,a,u,s,c=Lr(this),f=z(t),l=arguments.length,h=l>1?arguments[1]:void 0,p=void 0!==h,v=xo(f);if(v&&!mo(v))for(s=(u=Eo(f,v)).next,f=[];!(a=Ot(s,u)).done;)f.push(a.value);for(p&&l>2&&(h=Ur(h,arguments[2])),r=We(f),n=new(rs(c))(r),o=Ju(n),e=0;r>e;e++)i=p?h(f[e],e):f[e],n[e]=o?es(i):+i;return n},os=function(t,e,r){var n,o;return fr&&lt(n=e.constructor)&&n!==r&&vt(o=n.prototype)&&o!==r.prototype&&fr(t,o),t},is=w((function(t){var e=Ze.f,r=Ai.forEach,n=fe.get,o=fe.set,i=fe.enforce,a=Gt.f,u=je.f,s=Math.round,c=S.RangeError,f=Zu.ArrayBuffer,l=f.prototype,h=Zu.DataView,p=Ya.NATIVE_ARRAY_BUFFER_VIEWS,v=Ya.TYPED_ARRAY_TAG,d=Ya.TypedArray,y=Ya.TypedArrayPrototype,g=Ya.aTypedArrayConstructor,m=Ya.isTypedArray,b=function(t,e){g(t);for(var r=0,n=e.length,o=new t(n);n>r;)o[r]=e[r++];return o},x=function(t,e){vr(t,e,{configurable:!0,get:function(){return n(this)[e]}})},w=function(t){var e;return kt(l,t)||"ArrayBuffer"==(e=be(t))||"SharedArrayBuffer"==e},E=function(t,e){return m(t)&&!jt(e)&&e in t&&$u(+e)&&e>=0},A=function(t,e){return e=Wt(e),E(t,e)?ee(2,t[e]):u(t,e)},O=function(t,e,r){return e=Wt(e),!(E(t,e)&&vt(r)&&U(r,"value"))||U(r,"get")||U(r,"set")||r.configurable||U(r,"writable")&&!r.writable||U(r,"enumerable")&&!r.enumerable?a(t,e,r):(t[e]=r.value,t)};ht?(p||(je.f=A,Gt.f=O,x(y,"buffer"),x(y,"byteOffset"),x(y,"byteLength"),x(y,"length")),ar({target:"Object",stat:!0,forced:!p},{getOwnPropertyDescriptor:A,defineProperty:O}),t.exports=function(t,u,l){var g=t.match(/\\d+/)[0]/8,x=t+(l?"Clamped":"")+"Array",E="get"+t,A="set"+t,O=S[x],T=O,k=T&&T.prototype,I={},j=function(t,e){a(t,e,{get:function(){return function(t,e){var r=n(t);return r.view[E](e*g+r.byteOffset,!0)}(this,e)},set:function(t){return function(t,e,r){var o=n(t);l&&(r=(r=s(r))<0?0:r>255?255:255&r),o.view[A](e*g+o.byteOffset,r,!0)}(this,e,t)},enumerable:!0})};p?Xa&&(T=u((function(t,e,r,n){return mr(t,k),os(vt(e)?w(e)?void 0!==n?new O(e,Xu(r,g),n):void 0!==r?new O(e,Xu(r,g)):new O(e):m(e)?b(T,e):Ot(ns,T,e):new O(eu(e)),t,T)})),fr&&fr(T,d),r(e(O),(function(t){t in T||re(T,t,O[t])})),T.prototype=k):(T=u((function(t,e,r,n){mr(t,k);var i,a,u,s=0,l=0;if(vt(e)){if(!w(e))return m(e)?b(T,e):Ot(ns,T,e);i=e,l=Xu(r,g);var p=e.byteLength;if(void 0===n){if(p%g)throw c("Wrong length");if((a=p-l)<0)throw c("Wrong length")}else if((a=Fe(n)*g)+l>p)throw c("Wrong length");u=a/g}else u=eu(e),i=new f(a=u*g);for(o(t,{buffer:i,byteOffset:l,byteLength:a,length:u,view:new h(i)});s<u;)j(t,s++)})),fr&&fr(T,d),k=T.prototype=$i(y)),k.constructor!==T&&re(k,"constructor",T),i(k).TypedArrayConstructor=T,v&&re(k,v,x);var P=T!=O;I[x]=T,ar({global:!0,constructor:!0,forced:P,sham:!p},I),"BYTES_PER_ELEMENT"in T||re(T,"BYTES_PER_ELEMENT",g),"BYTES_PER_ELEMENT"in k||re(k,"BYTES_PER_ELEMENT",g),yr(x)}):t.exports=function(){}}));is("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}),!0);var as=TypeError,us=function(t,e){if(!delete t[e])throw as("Cannot delete property "+_t(e)+" of "+_t(t))},ss=Math.min,cs=N([].copyWithin||function(t,e){var r=z(this),n=We(r),o=Ce(t,n),i=Ce(e,n),a=arguments.length>2?arguments[2]:void 0,u=ss((void 0===a?n:Ce(a,n))-i,n-o),s=1;for(i<o&&o<i+u&&(s=-1,i+=u-1,o+=u-1);u-- >0;)i in r?r[o]=r[i]:us(r,o),o+=s,i+=s;return r}),fs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("copyWithin",(function(t,e){return cs(fs(this),t,e,arguments.length>2?arguments[2]:void 0)}));var ls=Ai.every,hs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("every",(function(t){return ls(hs(this),t,arguments.length>1?arguments[1]:void 0)}));var ps=Ya.aTypedArray,vs=Ya.exportTypedArrayMethod,ds=N("".slice);vs("fill",(function(t){var e=arguments.length;ps(this);var r="Big"===ds(be(this),0,3)?es(t):+t;return Ot(fu,this,r,e>1?arguments[1]:void 0,e>2?arguments[2]:void 0)}),P((function(){var t=0;return new Int8Array(2).fill({valueOf:function(){return t++}}),1!==t})));var ys=Ya.aTypedArrayConstructor,gs=Ya.getTypedArrayConstructor,ms=function(t){return ys(Nr(t,gs(t)))},bs=function(t,e){return function(t,e){for(var r=0,n=We(e),o=new t(n);n>r;)o[r]=e[r++];return o}(ms(t),e)},xs=Ai.filter,ws=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("filter",(function(t){var e=xs(ws(this),t,arguments.length>1?arguments[1]:void 0);return bs(this,e)}));var Es=Ai.find,As=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("find",(function(t){return Es(As(this),t,arguments.length>1?arguments[1]:void 0)}));var Os=Ai.findIndex,Ss=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("findIndex",(function(t){return Os(Ss(this),t,arguments.length>1?arguments[1]:void 0)}));var Ts=Ai.forEach,ks=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("forEach",(function(t){Ts(ks(this),t,arguments.length>1?arguments[1]:void 0)}));var Is=Be.includes,js=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("includes",(function(t){return Is(js(this),t,arguments.length>1?arguments[1]:void 0)}));var Ps=Be.indexOf,_s=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("indexOf",(function(t){return Ps(_s(this),t,arguments.length>1?arguments[1]:void 0)}));var Ms=it("iterator"),Ls=S.Uint8Array,Rs=N(Oa.values),Ns=N(Oa.keys),Cs=N(Oa.entries),Ds=Ya.aTypedArray,Fs=Ya.exportTypedArrayMethod,Ws=Ls&&Ls.prototype,zs=!P((function(){Ws[Ms].call([1])})),Bs=!!Ws&&Ws.values&&Ws[Ms]===Ws.values&&"values"===Ws.values.name,Us=function(){return Rs(Ds(this))};Fs("entries",(function(){return Cs(Ds(this))}),zs),Fs("keys",(function(){return Ns(Ds(this))}),zs),Fs("values",Us,zs||!Bs,{name:"values"}),Fs(Ms,Us,zs||!Bs,{name:"values"});var Gs=Ya.aTypedArray,Vs=Ya.exportTypedArrayMethod,Hs=N([].join);Vs("join",(function(t){return Hs(Gs(this),t)}));var qs=Math.min,Zs=[].lastIndexOf,Ys=!!Zs&&1/[1].lastIndexOf(1,-0)<0,$s=Oi("lastIndexOf"),Ks=Ys||!$s?function(t){if(Ys)return Wr(Zs,this,arguments)||0;var e=ke(this),r=We(e),n=r-1;for(arguments.length>1&&(n=qs(n,Le(arguments[1]))),n<0&&(n=r+n);n>=0;n--)if(n in e&&e[n]===t)return n||0;return-1}:Zs,Qs=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("lastIndexOf",(function(t){var e=arguments.length;return Wr(Ks,Qs(this),e>1?[t,arguments[1]]:[t])}));var Xs=Ai.map,Js=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("map",(function(t){return Xs(Js(this),t,arguments.length>1?arguments[1]:void 0,(function(t,e){return new(ms(t))(e)}))}));var tc=TypeError,ec=function(t){return function(e,r,n,o){Lt(r);var i=z(e),a=Te(i),u=We(i),s=t?u-1:0,c=t?-1:1;if(n<2)for(;;){if(s in a){o=a[s],s+=c;break}if(s+=c,t?s<0:u<=s)throw tc("Reduce of empty array with no initial value")}for(;t?s>=0:u>s;s+=c)s in a&&(o=r(o,a[s],s,i));return o}},rc={left:ec(!1),right:ec(!0)},nc=rc.left,oc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("reduce",(function(t){var e=arguments.length;return nc(oc(this),t,e,e>1?arguments[1]:void 0)}));var ic=rc.right,ac=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("reduceRight",(function(t){var e=arguments.length;return ic(ac(this),t,e,e>1?arguments[1]:void 0)}));var uc=Ya.aTypedArray,sc=Ya.exportTypedArrayMethod,cc=Math.floor;sc("reverse",(function(){for(var t,e=uc(this).length,r=cc(e/2),n=0;n<r;)t=this[n],this[n++]=this[--e],this[e]=t;return this}));var fc=S.RangeError,lc=S.Int8Array,hc=lc&&lc.prototype,pc=hc&&hc.set,vc=Ya.aTypedArray,dc=Ya.exportTypedArrayMethod,yc=!P((function(){var t=new Uint8ClampedArray(2);return Ot(pc,t,{length:1,0:3},1),3!==t[1]})),gc=yc&&Ya.NATIVE_ARRAY_BUFFER_VIEWS&&P((function(){var t=new lc(2);return t.set(1),t.set("2",1),0!==t[0]||2!==t[1]}));dc("set",(function(t){vc(this);var e=Xu(arguments.length>1?arguments[1]:void 0,1),r=z(t);if(yc)return Ot(pc,this,r,e);var n=this.length,o=We(r),i=0;if(o+e>n)throw fc("Wrong length");for(;i<o;)this[e+i]=r[i++]}),!yc||gc);var mc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("slice",(function(t,e){for(var r=Vr(mc(this),t,e),n=ms(this),o=0,i=r.length,a=new n(i);i>o;)a[o]=r[o++];return a}),P((function(){new Int8Array(1).slice()})));var bc=Ai.some,xc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("some",(function(t){return bc(xc(this),t,arguments.length>1?arguments[1]:void 0)}));var wc=Math.floor,Ec=function(t,e){var r=t.length,n=wc(r/2);return r<8?Ac(t,e):Oc(t,Ec(pu(t,0,n),e),Ec(pu(t,n),e),e)},Ac=function(t,e){for(var r,n,o=t.length,i=1;i<o;){for(n=i,r=t[i];n&&e(t[n-1],r)>0;)t[n]=t[--n];n!==i++&&(t[n]=r)}return t},Oc=function(t,e,r,n){for(var o=e.length,i=r.length,a=0,u=0;a<o||u<i;)t[a+u]=a<o&&u<i?n(e[a],r[u])<=0?e[a++]:r[u++]:a<o?e[a++]:r[u++];return t},Sc=Ec,Tc=Z.match(/firefox\\/(\\d+)/i),kc=!!Tc&&+Tc[1],Ic=/MSIE|Trident/.test(Z),jc=Z.match(/AppleWebKit\\/(\\d+)\\./),Pc=!!jc&&+jc[1],_c=Ya.aTypedArray,Mc=Ya.exportTypedArrayMethod,Lc=S.Uint16Array,Rc=Lc&&zr(Lc.prototype.sort),Nc=!(!Rc||P((function(){Rc(new Lc(2),null)}))&&P((function(){Rc(new Lc(2),{})}))),Cc=!!Rc&&!P((function(){if(X)return X<74;if(kc)return kc<67;if(Ic)return!0;if(Pc)return Pc<602;var t,e,r=new Lc(516),n=Array(516);for(t=0;t<516;t++)e=t%4,r[t]=515-t,n[t]=t-2*e+3;for(Rc(r,(function(t,e){return(t/4|0)-(e/4|0)})),t=0;t<516;t++)if(r[t]!==n[t])return!0}));Mc("sort",(function(t){return void 0!==t&&Lt(t),Cc?Rc(this,t):Sc(_c(this),function(t){return function(e,r){return void 0!==t?+t(e,r)||0:r!=r?-1:e!=e?1:0===e&&0===r?1/e>0&&1/r<0?1:-1:e>r}}(t))}),!Cc||Nc);var Dc=Ya.aTypedArray;(0,Ya.exportTypedArrayMethod)("subarray",(function(t,e){var r=Dc(this),n=r.length,o=Ce(t,n);return new(ms(r))(r.buffer,r.byteOffset+o*r.BYTES_PER_ELEMENT,Fe((void 0===e?n:Ce(e,n))-o))}));var Fc=S.Int8Array,Wc=Ya.aTypedArray,zc=Ya.exportTypedArrayMethod,Bc=[].toLocaleString,Uc=!!Fc&&P((function(){Bc.call(new Fc(1))}));zc("toLocaleString",(function(){return Wr(Bc,Uc?Vr(Wc(this)):Wc(this),Vr(arguments))}),P((function(){return[1,2].toLocaleString()!=new Fc([1,2]).toLocaleString()}))||!P((function(){Fc.prototype.toLocaleString.call([1,2])})));var Gc=Ya.exportTypedArrayMethod,Vc=S.Uint8Array,Hc=Vc&&Vc.prototype||{},qc=[].toString,Zc=N([].join);P((function(){qc.call({})}))&&(qc=function(){return Zc(this)});var Yc=Hc.toString!=qc;Gc("toString",qc,Yc),ar({target:"Array",proto:!0},{fill:fu}),ra("fill");var $c,Kc,Qc=String,Xc=function(t){if("Symbol"===be(t))throw TypeError("Cannot convert a Symbol value to a string");return Qc(t)},Jc=function(){var t=Et(this),e="";return t.hasIndices&&(e+="d"),t.global&&(e+="g"),t.ignoreCase&&(e+="i"),t.multiline&&(e+="m"),t.dotAll&&(e+="s"),t.unicode&&(e+="u"),t.unicodeSets&&(e+="v"),t.sticky&&(e+="y"),e},tf=S.RegExp,ef=P((function(){var t=tf("a","y");return t.lastIndex=2,null!=t.exec("abcd")})),rf=ef||P((function(){return!tf("a","y").sticky})),nf={BROKEN_CARET:ef||P((function(){var t=tf("^r","gy");return t.lastIndex=2,null!=t.exec("str")})),MISSED_STICKY:rf,UNSUPPORTED_Y:ef},of=S.RegExp,af=P((function(){var t=of(".","s");return!(t.dotAll&&t.exec("\\n")&&"s"===t.flags)})),uf=S.RegExp,sf=P((function(){var t=uf("(?<a>b)","g");return"b"!==t.exec("b").groups.a||"bc"!=="b".replace(t,"$<a>c")})),cf=fe.get,ff=j("native-string-replace",String.prototype.replace),lf=RegExp.prototype.exec,hf=lf,pf=N("".charAt),vf=N("".indexOf),df=N("".replace),yf=N("".slice),gf=(Kc=/b*/g,Ot(lf,$c=/a/,"a"),Ot(lf,Kc,"a"),0!==$c.lastIndex||0!==Kc.lastIndex),mf=nf.BROKEN_CARET,bf=void 0!==/()??/.exec("")[1];(gf||bf||mf||af||sf)&&(hf=function(t){var e,r,n,o,i,a,u,s=this,c=cf(s),f=Xc(t),l=c.raw;if(l)return l.lastIndex=s.lastIndex,e=Ot(hf,l,f),s.lastIndex=l.lastIndex,e;var h=c.groups,p=mf&&s.sticky,v=Ot(Jc,s),d=s.source,y=0,g=f;if(p&&(v=df(v,"y",""),-1===vf(v,"g")&&(v+="g"),g=yf(f,s.lastIndex),s.lastIndex>0&&(!s.multiline||s.multiline&&"\\n"!==pf(f,s.lastIndex-1))&&(d="(?: "+d+")",g=" "+g,y++),r=new RegExp("^(?:"+d+")",v)),bf&&(r=new RegExp("^"+d+"$(?!\\\\s)",v)),gf&&(n=s.lastIndex),o=Ot(lf,p?r:s,g),p?o?(o.input=yf(o.input,y),o[0]=yf(o[0],y),o.index=s.lastIndex,s.lastIndex+=o[0].length):s.lastIndex=0:gf&&o&&(s.lastIndex=s.global?o.index+o[0].length:n),bf&&o&&o.length>1&&Ot(ff,o[0],r,(function(){for(i=1;i<arguments.length-2;i++)void 0===arguments[i]&&(o[i]=void 0)})),o&&h)for(o.groups=a=$i(null),i=0;i<h.length;i++)a[(u=h[i])[0]]=o[u[1]];return o});var xf=hf;ar({target:"RegExp",proto:!0,forced:/./.exec!==xf},{exec:xf});var wf,Ef=it("species"),Af=RegExp.prototype,Of=function(t,e,r,n){var o=it(t),i=!P((function(){var e={};return e[o]=function(){return 7},7!=""[t](e)})),a=i&&!P((function(){var e=!1,r=/a/;return"split"===t&&((r={}).constructor={},r.constructor[Ef]=function(){return r},r.flags="",r[o]=/./[o]),r.exec=function(){return e=!0,null},r[o](""),!e}));if(!i||!a||r){var u=zr(/./[o]),s=e(o,""[t],(function(t,e,r,n,o){var a=zr(t),s=e.exec;return s===xf||s===Af.exec?i&&!o?{done:!0,value:u(e,r,n)}:{done:!0,value:a(r,e,n)}:{done:!1}}));he(String.prototype,t,s[0]),he(Af,o,s[1])}n&&re(Af[o],"sham",!0)},Sf=N("".charAt),Tf=N("".charCodeAt),kf=N("".slice),If=function(t){return function(e,r){var n,o,i=Xc(F(e)),a=Le(r),u=i.length;return a<0||a>=u?t?"":void 0:(n=Tf(i,a))<55296||n>56319||a+1===u||(o=Tf(i,a+1))<56320||o>57343?t?Sf(i,a):n:t?kf(i,a,a+2):o-56320+(n-55296<<10)+65536}},jf={codeAt:If(!1),charAt:If(!0)},Pf=jf.charAt,_f=function(t,e,r){return e+(r?Pf(t,e).length:1)},Mf=Math.floor,Lf=N("".charAt),Rf=N("".replace),Nf=N("".slice),Cf=/\\$([$&\'`]|\\d{1,2}|<[^>]*>)/g,Df=/\\$([$&\'`]|\\d{1,2})/g,Ff=function(t,e,r,n,o,i){var a=r+t.length,u=n.length,s=Df;return void 0!==o&&(o=z(o),s=Cf),Rf(i,s,(function(i,s){var c;switch(Lf(s,0)){case"$":return"$";case"&":return t;case"`":return Nf(e,0,r);case"\'":return Nf(e,a);case"<":c=o[Nf(s,1,-1)];break;default:var f=+s;if(0===f)return i;if(f>u){var l=Mf(f/10);return 0===l?i:l<=u?void 0===n[l-1]?Lf(s,1):n[l-1]+Lf(s,1):i}c=n[f-1]}return void 0===c?"":c}))},Wf=TypeError,zf=function(t,e){var r=t.exec;if(lt(r)){var n=Ot(r,t,e);return null!==n&&Et(n),n}if("RegExp"===de(t))return Ot(xf,t,e);throw Wf("RegExp#exec called on incompatible receiver")},Bf=it("replace"),Uf=Math.max,Gf=Math.min,Vf=N([].concat),Hf=N([].push),qf=N("".indexOf),Zf=N("".slice),Yf="$0"==="a".replace(/./,"$0"),$f=!!/./[Bf]&&""===/./[Bf]("a","$0");function Kf(t){this.message=t}Of("replace",(function(t,e,r){var n=$f?"$":"$0";return[function(t,r){var n=F(this),o=C(t)?void 0:Rt(t,Bf);return o?Ot(o,t,n,r):Ot(e,Xc(n),t,r)},function(t,o){var i=Et(this),a=Xc(t);if("string"==typeof o&&-1===qf(o,n)&&-1===qf(o,"$<")){var u=r(e,i,a,o);if(u.done)return u.value}var s=lt(o);s||(o=Xc(o));var c=i.global;if(c){var f=i.unicode;i.lastIndex=0}for(var l=[];;){var h=zf(i,a);if(null===h)break;if(Hf(l,h),!c)break;""===Xc(h[0])&&(i.lastIndex=_f(a,Fe(i.lastIndex),f))}for(var p,v="",d=0,y=0;y<l.length;y++){for(var g=Xc((h=l[y])[0]),m=Uf(Gf(Le(h.index),a.length),0),b=[],x=1;x<h.length;x++)Hf(b,void 0===(p=h[x])?p:String(p));var w=h.groups;if(s){var E=Vf([g],b,m,a);void 0!==w&&Hf(E,w);var A=Xc(Wr(o,void 0,E))}else A=Ff(g,a,m,b,w,o);m>=d&&(v+=Zf(a,d,m)+A,d=m+g.length)}return v+Zf(a,d)}]}),!!P((function(){var t=/./;return t.exec=function(){var t=[];return t.groups={a:"7"},t},"7"!=="".replace(t,"$<a>")}))||!Yf||$f),Kf.prototype=new Error,Kf.prototype.name="InvalidCharacterError",ar({global:!0,forced:S.globalThis!==S},{globalThis:S}),wf="undefined"==typeof window?{devicePixelRatio:1,navigator:{userAgent:"Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/95.0.4638.69 Safari/537.36",browserLanguage:"zh-CN",language:"zh-CN",platform:""},location:"",document:{documentElement:{style:{}},createEvent:function(){return!0},getElementById:function(t){return!0},createElement:function(){return{className:"",classList:{add:function(){return""}}}},createElementNS:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},querySelector:function(){return!1}},performance:{mark:function(t){return null},clearMeasures:function(t){return null},clearMarks:function(t){return null},measure:function(t,e,r){return{duration:0}},now:function(){return(new Date).getTime()}},Blob:"",dispatchEvent:function(t){return!0},Event:function(t,e){return!0},createElement:function(){return!0},createElementNS:function(){return!0},XMLHttpRequest:function(){return!0},addEventListener:function(){return!0},removeEventListener:function(){return!0},requestAnimationFrame:function(){return!0},cancelAnimationFrame:function(){return!0},clearTimeout:function(){return!0}}:window,"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM?my.getSystemInfoSync().pixelRatio:wf.devicePixelRatio;var Qf=TypeError,Xf=Object.getOwnPropertyDescriptor,Jf=ht&&!function(){if(void 0!==this)return!0;try{Object.defineProperty([],"length",{writable:!1}).length=1}catch(t){return t instanceof TypeError}}()?function(t,e){if(gi(t)&&!Xf(t,"length").writable)throw Qf("Cannot set read only .length");return t.length=e}:function(t,e){return t.length=e},tl=TypeError,el=function(t){if(t>9007199254740991)throw tl("Maximum allowed index exceeded");return t},rl=_i("splice"),nl=Math.max,ol=Math.min;ar({target:"Array",proto:!0,forced:!rl},{splice:function(t,e){var r,n,o,i,a,u,s=z(this),c=We(s),f=Ce(t,c),l=arguments.length;for(0===l?r=n=0:1===l?(r=0,n=c-f):(r=l-2,n=ol(nl(Le(e),0),c-f)),el(c+r-n),o=xi(s,n),i=0;i<n;i++)(a=f+i)in s&&ji(o,i,s[a]);if(o.length=n,r<n){for(i=f;i<c-n;i++)u=i+r,(a=i+n)in s?s[u]=s[a]:us(s,u);for(i=c;i>c-n+r;i--)us(s,i-1)}else if(r>n)for(i=c-n;i>f;i--)u=i+r-1,(a=i+n-1)in s?s[u]=s[a]:us(s,u);for(i=0;i<r;i++)s[i+f]=arguments[i+2];return Jf(s,c-n+r),o}});var il=u((function t(e,r){i(this,t),s(this,"cancelBubble",void 0),s(this,"cancelable",void 0),s(this,"target",void 0),s(this,"currentTarget",void 0),s(this,"preventDefault",void 0),s(this,"stopPropagation",void 0),s(this,"type",void 0),s(this,"timeStamp",void 0),this.cancelBubble=!1,this.cancelable=!1,this.target=null,this.currentTarget=null,this.preventDefault=function(){},this.stopPropagation=function(){},this.type=e,this.timeStamp=Date.now()})),al=Object.assign,ul=Object.defineProperty,sl=N([].concat),cl=!al||P((function(){if(ht&&1!==al({b:1},al(ul({},"a",{enumerable:!0,get:function(){ul(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},r=Symbol();return t[r]=7,"abcdefghijklmnopqrst".split("").forEach((function(t){e[t]=t})),7!=al({},t)[r]||"abcdefghijklmnopqrst"!=Ui(al({},e)).join("")}))?function(t,e){for(var r=z(t),n=arguments.length,o=1,i=Ye.f,a=Ae.f;n>o;)for(var u,s=Te(arguments[o++]),c=i?sl(Ui(s),i(s)):Ui(s),f=c.length,l=0;f>l;)u=c[l++],ht&&!Ot(a,s,u)||(r[u]=s[u]);return r}:al;ar({target:"Object",stat:!0,arity:2,forced:Object.assign!==cl},{assign:cl});var fl=Ai.findIndex,ll=!0;"findIndex"in[]&&Array(1).findIndex((function(){ll=!1})),ar({target:"Array",proto:!0,forced:ll},{findIndex:function(t){return fl(this,t,arguments.length>1?arguments[1]:void 0)}}),ra("findIndex");var hl=jf.charAt,pl=fe.set,vl=fe.getterFor("String Iterator");ba(String,"String",(function(t){pl(this,{type:"String Iterator",string:Xc(t),index:0})}),(function(){var t,e=vl(this),r=e.string,n=e.index;return n>=r.length?xa(void 0,!0):(t=hl(r,n),e.index+=t.length,xa(t,!1))}));var dl=!P((function(){return Object.isExtensible(Object.preventExtensions({}))})),yl=Ze.f,gl="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],ml={f:function(t){return gl&&"Window"==de(t)?function(t){try{return yl(t)}catch(t){return pu(gl)}}(t):yl(ke(t))}},bl=P((function(){if("function"==typeof ArrayBuffer){var t=new ArrayBuffer(8);Object.isExtensible(t)&&Object.defineProperty(t,"a",{value:8})}})),xl=Object.isExtensible,wl=P((function(){xl(1)}))||bl?function(t){return!!vt(t)&&((!bl||"ArrayBuffer"!=de(t))&&(!xl||xl(t)))}:xl,El=w((function(t){var e=Gt.f,r=!1,n=q("meta"),o=0,i=function(t){e(t,n,{value:{objectID:"O"+o++,weakData:{}}})},a=t.exports={enable:function(){a.enable=function(){},r=!0;var t=Ze.f,e=N([].splice),o={};o[n]=1,t(o).length&&(Ze.f=function(r){for(var o=t(r),i=0,a=o.length;i<a;i++)if(o[i]===n){e(o,i,1);break}return o},ar({target:"Object",stat:!0,forced:!0},{getOwnPropertyNames:ml.f}))},fastKey:function(t,e){if(!vt(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!U(t,n)){if(!wl(t))return"F";if(!e)return"E";i(t)}return t[n].objectID},getWeakData:function(t,e){if(!U(t,n)){if(!wl(t))return!0;if(!e)return!1;i(t)}return t[n].weakData},onFreeze:function(t){return dl&&r&&wl(t)&&!U(t,n)&&i(t),t}};ie[n]=!0})),Al=(El.enable,El.fastKey,El.getWeakData,El.onFreeze,function(t,e,r){var n=-1!==t.indexOf("Map"),o=-1!==t.indexOf("Weak"),i=n?"set":"add",a=S[t],u=a&&a.prototype,s=a,c={},f=function(t){var e=N(u[t]);he(u,t,"add"==t?function(t){return e(this,0===t?0:t),this}:"delete"==t?function(t){return!(o&&!vt(t))&&e(this,0===t?0:t)}:"get"==t?function(t){return o&&!vt(t)?void 0:e(this,0===t?0:t)}:"has"==t?function(t){return!(o&&!vt(t))&&e(this,0===t?0:t)}:function(t,r){return e(this,0===t?0:t,r),this})};if(or(t,!lt(a)||!(o||u.forEach&&!P((function(){(new a).entries().next()})))))s=r.getConstructor(e,t,n,i),El.enable();else if(or(t,!0)){var l=new s,h=l[i](o?{}:-0,1)!=l,p=P((function(){l.has(1)})),v=Mo((function(t){new a(t)})),d=!o&&P((function(){for(var t=new a,e=5;e--;)t[i](e,e);return!t.has(-0)}));v||((s=e((function(t,e){mr(t,u);var r=os(new a,t,s);return C(e)||ko(e,r[i],{that:r,AS_ENTRIES:n}),r}))).prototype=u,u.constructor=s),(p||d)&&(f("delete"),f("has"),n&&f("get")),(d||h)&&f(i),o&&u.clear&&delete u.clear}return c[t]=s,ar({global:!0,constructor:!0,forced:s!=a},c),pr(s,t),o||r.setStrong(s,t,n),s}),Ol=El.getWeakData,Sl=fe.set,Tl=fe.getterFor,kl=Ai.find,Il=Ai.findIndex,jl=N([].splice),Pl=0,_l=function(t){return t.frozen||(t.frozen=new Ml)},Ml=function(){this.entries=[]},Ll=function(t,e){return kl(t.entries,(function(t){return t[0]===e}))};Ml.prototype={get:function(t){var e=Ll(this,t);if(e)return e[1]},has:function(t){return!!Ll(this,t)},set:function(t,e){var r=Ll(this,t);r?r[1]=e:this.entries.push([t,e])},delete:function(t){var e=Il(this.entries,(function(e){return e[0]===t}));return~e&&jl(this.entries,e,1),!!~e}};var Rl,Nl={getConstructor:function(t,e,r,n){var o=t((function(t,o){mr(t,i),Sl(t,{type:e,id:Pl++,frozen:void 0}),C(o)||ko(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=Tl(e),u=function(t,e,r){var n=a(t),o=Ol(Et(e),!0);return!0===o?_l(n).set(e,r):o[n.id]=r,t};return Ja(i,{delete:function(t){var e=a(this);if(!vt(t))return!1;var r=Ol(t);return!0===r?_l(e).delete(t):r&&U(r,e.id)&&delete r[e.id]},has:function(t){var e=a(this);if(!vt(t))return!1;var r=Ol(t);return!0===r?_l(e).has(t):r&&U(r,e.id)}}),Ja(i,r?{get:function(t){var e=a(this);if(vt(t)){var r=Ol(t);return!0===r?_l(e).get(t):r?r[e.id]:void 0}},set:function(t,e){return u(this,t,e)}}:{add:function(t){return u(this,t,!0)}}),o}},Cl=fe.enforce,Dl=Object,Fl=Array.isArray,Wl=Dl.isExtensible,zl=Dl.isFrozen,Bl=Dl.isSealed,Ul=Dl.freeze,Gl=Dl.seal,Vl={},Hl={},ql=!S.ActiveXObject&&"ActiveXObject"in S,Zl=function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}},Yl=Al("WeakMap",Zl,Nl),$l=Yl.prototype,Kl=N($l.set);if(te)if(ql){Rl=Nl.getConstructor(Zl,"WeakMap",!0),El.enable();var Ql=N($l.delete),Xl=N($l.has),Jl=N($l.get);Ja($l,{delete:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Ql(this,t)||e.frozen.delete(t)}return Ql(this,t)},has:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Xl(this,t)||e.frozen.has(t)}return Xl(this,t)},get:function(t){if(vt(t)&&!Wl(t)){var e=Cl(this);return e.frozen||(e.frozen=new Rl),Xl(this,t)?Jl(this,t):e.frozen.get(t)}return Jl(this,t)},set:function(t,e){if(vt(t)&&!Wl(t)){var r=Cl(this);r.frozen||(r.frozen=new Rl),Xl(this,t)?Kl(this,t,e):r.frozen.set(t,e)}else Kl(this,t,e);return this}})}else dl&&P((function(){var t=Ul([]);return Kl(new Yl,t,1),!zl(t)}))&&Ja($l,{set:function(t,e){var r;return Fl(t)&&(zl(t)?r=Vl:Bl(t)&&(r=Hl)),Kl(this,t,e),r==Vl&&Ul(t),r==Hl&&Gl(t),this}});var th=it("iterator"),eh=it("toStringTag"),rh=Oa.values,nh=function(t,e){if(t){if(t[th]!==rh)try{re(t,th,rh)}catch(e){t[th]=rh}if(t[eh]||re(t,eh,e),pi[e])for(var r in Oa)if(t[r]!==Oa[r])try{re(t,r,Oa[r])}catch(e){t[r]=Oa[r]}}};for(var oh in pi)nh(S[oh]&&S[oh].prototype,oh);nh(yi,"DOMTokenList");var ih,ah,uh,sh,ch=new WeakMap,fh=function(){function t(){i(this,t),ch.set(this,{})}return u(t,[{key:"addEventListener",value:function(t,e){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=ch.get(this);n||(n={}),n[t]||(n[t]=[]),n[t].push(e),ch.set(this,n),r.capture,r.once,r.passive}},{key:"removeEventListener",value:function(t,e){var r=ch.get(this);if(r){var n=r[t];if(n&&n.length>0)for(var o=n.length;o--;o>0)if(n[o]===e){n.splice(o,1);break}}}},{key:"dispatchEvent",value:function(t){var e=ch.get(this)[t.type];if(e){var r,n=function(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=g(t))||e&&t&&"number"==typeof t.length){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,a=!0,u=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return a=t.done,t},e:function(t){u=!0,i=t},f:function(){try{a||null==r.return||r.return()}finally{if(u)throw i}}}}(e);try{for(n.s();!(r=n.n()).done;){(0,r.value)(t)}}catch(t){n.e(t)}finally{n.f()}}}}]),t}(),lh=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),t.className="",t.children=[],t}return u(r,[{key:"setAttribute",value:function(t,e){this[t]=e}},{key:"getAttribute",value:function(t){return this[t]}},{key:"setAttributeNS",value:function(t,e){this[t]=e}},{key:"getAttributeNS",value:function(t){return this[t]}}]),r}(function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"childNodes",void 0),t.childNodes=[],t}return u(r,[{key:"appendChild",value:function(t){this.childNodes.push(t)}},{key:"cloneNode",value:function(){var t=Object.create(this);return Object.assign(t,this),t}},{key:"removeChild",value:function(t){var e=this.childNodes.findIndex((function(e){return e===t}));return e>-1?this.childNodes.splice(e,1):null}}]),r}(fh));if("undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var hh=my.getSystemInfoSync();ih=hh.screenWidth,ah=hh.screenHeight,uh=hh.windowWidth,sh=hh.windowHeight}else{var ph=wf.innerWidth,vh=wf.innerHeight;ih=ph,ah=vh,uh=ph,sh=vh}var dh={width:ih,height:ah,availWidth:uh,availHeight:sh,availLeft:0,availTop:0},yh=dh.availWidth,gh=dh.availHeight,mh={style:[]};function bh(t,e){var r,n;"parentNode"in t||(r=0===e?function(){return null}:1===e?function(){return mh}:function(){return null},Object.defineProperty(t,"parentNode",{enumerable:!0,get:r}));"parentElement"in t||(n=0===e?function(){return null}:1===e?function(){return mh}:function(){return null},Object.defineProperty(t,"parentElement",{enumerable:!0,get:n}))}function xh(t){t.style=t.style||{},Object.assign(t.style,{top:"0px",left:"0px",width:yh+"px",height:gh+"px",margin:"0px",padding:"0px"})}function wh(t){"clientLeft"in t||(t.clientLeft=0,t.clientTop=0),"clientWidth"in t||(t.clientWidth=yh,t.clientHeight=gh),"getBoundingClientRect"in t||(t.getBoundingClientRect=function(){return{x:0,y:0,top:0,left:0,width:this.clientWidth,height:this.clientHeight,right:this.clientWidth,bottom:this.clientHeight}})}function Eh(t){"offsetLeft"in t||(t.offsetLeft=0,t.offsetTop=0),"offsetWidth"in t||(t.offsetWidth=yh,t.offsetHeight=gh)}function Ah(t){"scrollLeft"in t||(t.scrollLeft=0,t.scrollTop=0),"scrollWidth"in t||(t.scrollWidth=yh,t.scrollHeight=gh)}function Oh(t){var e=function(){return!0};t.classList=[],t.classList.add=e,t.classList.remove=e,t.classList.contains=e,t.classList.toggle=e}function Sh(){}var Th=function(t){c(r,t);var e=v(r);function r(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",o=arguments.length>1?arguments[1]:void 0;return i(this,r),s(h(t=e.call(this)),"className",void 0),s(h(t),"children",void 0),s(h(t),"focus",void 0),s(h(t),"blur",void 0),s(h(t),"insertBefore",void 0),s(h(t),"appendChild",void 0),s(h(t),"removeChild",void 0),s(h(t),"remove",void 0),s(h(t),"innerHTML",void 0),s(h(t),"tagName",void 0),t.className="",t.children=[],t.focus=Sh,t.blur=Sh,t.insertBefore=Sh,t.appendChild=Sh,t.removeChild=Sh,t.remove=Sh,t.innerHTML="",t.tagName=n.toUpperCase(),bh(h(t),o),xh(h(t)),Oh(h(t)),wh(h(t)),Eh(h(t)),Ah(h(t)),t}return u(r)}(lh),kh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"video")}return u(r)}(function(t){c(r,t);var e=v(r);function r(t){return i(this,r),e.call(this,t)}return u(r,[{key:"addTextTrack",value:function(){}},{key:"captureStream",value:function(){}},{key:"fastSeek",value:function(){}},{key:"load",value:function(){}},{key:"pause",value:function(){}},{key:"play",value:function(){}}]),r}(Th)),Ih={};function jh(){return Ih}var Ph=u((function t(){i(this,t);var e=jh(),r=e.createImage&&e.createImage()||{};return"tagName"in r||(r.tagName="IMG",r.__proto__=t.prototype),bh(r),Oh(r),Object.assign(r,{addEventListener:function(t,e){r["on".concat(t)]=e.bind(r)},removeEventListener:function(t){r["on".concat(t)]=null}}),r})),_h={href:"",protocol:"",host:""},Mh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"body",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e,r){}},{key:"dispatchEvent",value:function(t){}}]),r}(Th),Lh=function(t){c(r,t);var e=v(r);function r(){return i(this,r),e.call(this,"html",0)}return u(r,[{key:"addEventListener",value:function(t,e){}},{key:"removeEventListener",value:function(t,e){}},{key:"dispatchEvent",value:function(t){}}]),r}(Th),Rh={},Nh={readyState:"complete",visibilityState:"visible",hidden:!1,fullscreen:!0,scripts:[],style:{},location:_h,ontouchstart:null,ontouchmove:null,ontouchend:null,onvisibilitychange:null,parentNode:null,parentElement:null,head:null,body:null,documentElement:{style:[]},createElement:function(t){return"canvas"===(t=t.toLowerCase())?my.createOffscreenCanvas(1024,128,"2d"):"img"===t?new Ph:"video"===t?new kh:new Th(t)},createElementNS:function(t,e){return this.createElement(e)},createTextNode:function(t){return t},getElementById:function(t){return null},getElementsByTagName:function(t){return t=t.toLowerCase(),[]},getElementsByTagNameNS:function(t,e){return this.getElementsByTagName(e)},getElementsByName:function(t){return[]},querySelector:function(t){return null},querySelectorAll:function(t){return[]},addEventListener:function(t,e,r){Rh[t]||(Rh[t]=[]),Rh[t].push(e)},removeEventListener:function(t,e){var r=Rh[t];if(r&&r.length>0)for(var n=r.length;n--;n>0)if(r[n]===e){r.splice(n,1);break}},dispatchEvent:function(t){var e=t.type,r=Rh[e];if(r)for(var n=0;n<r.length;n++)r[n](t);t.target&&"function"==typeof t.target["on"+e]&&t.target["on"+e](t)},createEvent:function(t){return new il(t)}};Nh.documentElement=new Lh,Nh.head=new Th("head"),Nh.body=new Mh,Of("match",(function(t,e,r){return[function(e){var r=F(this),n=C(e)?void 0:Rt(e,t);return n?Ot(n,e,r):new RegExp(e)[t](Xc(r))},function(t){var n=Et(this),o=Xc(t),i=r(e,n,o);if(i.done)return i.value;if(!n.global)return zf(n,o);var a=n.unicode;n.lastIndex=0;for(var u,s=[],c=0;null!==(u=zf(n,o));){var f=Xc(u[0]);s[c]=f,""===f&&(n.lastIndex=_f(o,Fe(n.lastIndex),a)),c++}return 0===c?null:s}]}));var Ch,Dh,Fh=it("isConcatSpreadable"),Wh=X>=51||!P((function(){var t=[];return t[Fh]=!1,t.concat()[0]!==t})),zh=function(t){if(!vt(t))return!1;var e=t[Fh];return void 0!==e?!!e:gi(t)},Bh=!Wh||!_i("concat");if(ar({target:"Array",proto:!0,arity:1,forced:Bh},{concat:function(t){var e,r,n,o,i,a=z(this),u=xi(a,0),s=0;for(e=-1,n=arguments.length;e<n;e++)if(zh(i=-1===e?a:arguments[e]))for(o=We(i),el(s+o),r=0;r<o;r++,s++)r in i&&ji(u,s,i[r]);else el(s+1),ji(u,s++,i);return u.length=s,u}}),"undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM){var Uh=my.getSystemInfoSync();Ch=Uh.system,Uh.platform,Uh.language}else{var Gh={versions:(Dh=wf.navigator.userAgent,{trident:Dh.indexOf("Trident")>-1,presto:Dh.indexOf("Presto")>-1,webKit:Dh.indexOf("AppleWebKit")>-1,gecko:Dh.indexOf("Gecko")>-1&&-1===Dh.indexOf("KHTML"),mobile:!!Dh.match(/AppleWebKit.*Mobile.*/),ios:!!Dh.match(/\\(i[^;]+;( U;)? CPU.+Mac OS X/),android:Dh.indexOf("Android")>-1||Dh.indexOf("Linux")>-1,iPhone:Dh.indexOf("iPhone")>-1,iPad:Dh.indexOf("iPad")>-1,webApp:-1===Dh.indexOf("Safari"),weixin:Dh.indexOf("MicroMessenger")>-1,qq:" qq"===Dh.match(/\\sQQ/i)}),language:(wf.navigator.browserLanguage||wf.navigator.language).toLowerCase()};Gh.versions.android?"android":Gh.versions.trident?"IE":Gh.versions.presto?"Opera":Gh.versions.webKit?"webKit":Gh.versions.gecko?"Firefox":Gh.versions.mobile?"mobile":Gh.versions.ios?"ios":Gh.versions.iPhone?"iPhone":Gh.versions.iPad?"ipad":Gh.versions.webApp?"webApp":Gh.versions.weixin?"weixin":Gh.versions.qq&&"qq",Ch=wf.navigator.userAgent,Gh.language}Ch.toLowerCase().indexOf("android");is("Uint8",(function(t){return function(e,r,n){return t(this,e,r,n)}}));var Vh=El.fastKey,Hh=fe.set,qh=fe.getterFor;Al("Map",(function(t){return function(){return t(this,arguments.length?arguments[0]:void 0)}}),{getConstructor:function(t,e,r,n){var o=t((function(t,o){mr(t,i),Hh(t,{type:e,index:$i(null),first:void 0,last:void 0,size:0}),ht||(t.size=0),C(o)||ko(o,t[n],{that:t,AS_ENTRIES:r})})),i=o.prototype,a=qh(e),u=function(t,e,r){var n,o,i=a(t),u=s(t,e);return u?u.value=r:(i.last=u={index:o=Vh(e,!0),key:e,value:r,previous:n=i.last,next:void 0,removed:!1},i.first||(i.first=u),n&&(n.next=u),ht?i.size++:t.size++,"F"!==o&&(i.index[o]=u)),t},s=function(t,e){var r,n=a(t),o=Vh(e);if("F"!==o)return n.index[o];for(r=n.first;r;r=r.next)if(r.key==e)return r};return Ja(i,{clear:function(){for(var t=a(this),e=t.index,r=t.first;r;)r.removed=!0,r.previous&&(r.previous=r.previous.next=void 0),delete e[r.index],r=r.next;t.first=t.last=void 0,ht?t.size=0:this.size=0},delete:function(t){var e=a(this),r=s(this,t);if(r){var n=r.next,o=r.previous;delete e.index[r.index],r.removed=!0,o&&(o.next=n),n&&(n.previous=o),e.first==r&&(e.first=n),e.last==r&&(e.last=o),ht?e.size--:this.size--}return!!r},forEach:function(t){for(var e,r=a(this),n=Ur(t,arguments.length>1?arguments[1]:void 0);e=e?e.next:r.first;)for(n(e.value,e.key,this);e&&e.removed;)e=e.previous},has:function(t){return!!s(this,t)}}),Ja(i,r?{get:function(t){var e=s(this,t);return e&&e.value},set:function(t,e){return u(this,0===t?0:t,e)}}:{add:function(t){return u(this,t=0===t?0:t,t)}}),ht&&vr(i,"size",{configurable:!0,get:function(){return a(this).size}}),o},setStrong:function(t,e,r){var n=e+" Iterator",o=qh(e),i=qh(n);ba(t,e,(function(t,e){Hh(this,{type:n,target:t,state:o(t),kind:e,last:void 0})}),(function(){for(var t=i(this),e=t.kind,r=t.last;r&&r.removed;)r=r.previous;return t.target&&(t.last=r=r?r.next:t.state.first)?xa("keys"==e?r.key:"values"==e?r.value:[r.key,r.value],!1):(t.target=void 0,xa(void 0,!0))}),r?"entries":"values",!r,!0),yr(e)}});var Zh=N([].join),Yh=Te!=Object||!Oi("join",",");ar({target:"Array",proto:!0,forced:Yh},{join:function(t){return Zh(ke(this),void 0===t?",":t)}});var $h=Ai.map,Kh=_i("map");ar({target:"Array",proto:!0,forced:!Kh},{map:function(t){return $h(this,t,arguments.length>1?arguments[1]:void 0)}});var Qh=P((function(){Ui(1)}));ar({target:"Object",stat:!0,forced:Qh},{keys:function(t){return Ui(z(t))}});var Xh=new Map,Jh=new Map,tp=new Map,ep=function(t){c(r,t);var e=v(r);function r(){var t;return i(this,r),s(h(t=e.call(this)),"onabort",void 0),s(h(t),"onerror",void 0),s(h(t),"onload",void 0),s(h(t),"onloadstart",void 0),s(h(t),"onprogress",void 0),s(h(t),"ontimeout",void 0),s(h(t),"onloadend",void 0),s(h(t),"onreadystatechange",void 0),s(h(t),"readyState",void 0),s(h(t),"response",void 0),s(h(t),"responseText",void 0),s(h(t),"_responseType",void 0),s(h(t),"responseXML",void 0),s(h(t),"status",void 0),s(h(t),"statusText",void 0),s(h(t),"upload",void 0),s(h(t),"withCredentials",void 0),s(h(t),"timeout",void 0),s(h(t),"_url",void 0),s(h(t),"_method",void 0),t.onabort=null,t.onerror=null,t.onload=null,t.onloadstart=null,t.onprogress=null,t.ontimeout=null,t.onloadend=null,t.onreadystatechange=null,t.readyState=0,t.response=null,t.responseText=null,t._responseType="text",t.responseXML=null,t.status=0,t.statusText="",t.upload={},t.withCredentials=!1,Xh.set("requestHeader",{"content-type":"application/x-www-form-urlencoded"}),t}return u(r,[{key:"responseType",set:function(t){this._responseType=t}},{key:"abort",value:function(){var t=tp.get("requestTask");t&&t.abort()}},{key:"getAllResponseHeaders",value:function(){var t=Jh.get("responseHeader");return Object.keys(t).map((function(e){return"".concat(e,": ").concat(t[e])})).join("\\n")}},{key:"getResponseHeader",value:function(t){return Jh.get("responseHeader")[t]}},{key:"open",value:function(t,e,r){this._method=t,this._url=e}},{key:"overrideMimeType",value:function(){}},{key:"send",value:function(){}},{key:"setRequestHeader",value:function(t,e){var r=Xh.get("requestHeader");r[t]=e,Xh.set("requestHeader",r)}},{key:"addEventListener",value:function(t,e){var r=this;"function"==typeof e&&(this["on"+t]=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};t.target=t.target||r,e.call(r,t)})}},{key:"removeEventListener",value:function(t,e){this["on"+t]===e&&(this["on"+t]=null)}}]),r}(fh);s(ep,"UNSEND",void 0),s(ep,"OPENED",void 0),s(ep,"HEADERS_RECEIVED",void 0),s(ep,"LOADING",void 0),s(ep,"DONE",void 0),ep.UNSEND=0,ep.OPENED=1,ep.HEADERS_RECEIVED=2,ep.LOADING=3,ep.DONE=4;var rp="undefined"!=typeof my&&!!my&&"function"==typeof my.showToast&&!0!==my.isFRM,np="undefined"!=typeof wx&&null!==wx&&(void 0!==wx.request||void 0!==wx.miniProgram),op=(rp||np)&&!1;op||wf.XMLHttpRequest,op||wf.location;function ip(t){return[t+1&255,t+1>>8&255,t+1>>8>>8&255]}var ap=Ai.filter,up=_i("filter");function sp(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}function cp(t,e,r){return 2===r.length?[r[0],r[1],0]:[r[0],r[1],r[2]]}function fp(t){return t.filter?[1]:[0]}function lp(t,e){return[e]}ar({target:"Array",proto:!0,forced:!up},{filter:function(t){return ap(this,t,arguments.length>1?arguments[1]:void 0)}});var hp=vp,pp=vp;function vp(t,e,r){r=r||2;var n,o,i,a,u,s,c,f=e&&e.length,l=f?e[0]*r:t.length,h=dp(t,0,l,r,!0),p=[];if(!h||h.next===h.prev)return p;if(f&&(h=function(t,e,r,n){var o,i,a,u,s,c=[];for(o=0,i=e.length;o<i;o++)a=e[o]*n,u=o<i-1?e[o+1]*n:t.length,(s=dp(t,a,u,n,!1))===s.next&&(s.steiner=!0),c.push(Tp(s));for(c.sort(Ep),o=0;o<c.length;o++)r=Ap(c[o],r);return r}(t,e,h,r)),t.length>80*r){n=i=t[0],o=a=t[1];for(var v=r;v<l;v+=r)(u=t[v])<n&&(n=u),(s=t[v+1])<o&&(o=s),u>i&&(i=u),s>a&&(a=s);c=0!==(c=Math.max(i-n,a-o))?32767/c:0}return gp(h,p,r,n,o,c,0),p}function dp(t,e,r,n,o){var i,a;if(o===Wp(t,e,r,n)>0)for(i=e;i<r;i+=n)a=Cp(i,t[i],t[i+1],a);else for(i=r-n;i>=e;i-=n)a=Cp(i,t[i],t[i+1],a);return a&&Pp(a,a.next)&&(Dp(a),a=a.next),a}function yp(t,e){if(!t)return t;e||(e=t);var r,n=t;do{if(r=!1,n.steiner||!Pp(n,n.next)&&0!==jp(n.prev,n,n.next))n=n.next;else{if(Dp(n),(n=e=n.prev)===n.next)break;r=!0}}while(r||n!==e);return e}function gp(t,e,r,n,o,i,a){if(t){!a&&i&&function(t,e,r,n){var o=t;do{0===o.z&&(o.z=Sp(o.x,o.y,e,r,n)),o.prevZ=o.prev,o.nextZ=o.next,o=o.next}while(o!==t);o.prevZ.nextZ=null,o.prevZ=null,function(t){var e,r,n,o,i,a,u,s,c=1;do{for(r=t,t=null,i=null,a=0;r;){for(a++,n=r,u=0,e=0;e<c&&(u++,n=n.nextZ);e++);for(s=c;u>0||s>0&&n;)0!==u&&(0===s||!n||r.z<=n.z)?(o=r,r=r.nextZ,u--):(o=n,n=n.nextZ,s--),i?i.nextZ=o:t=o,o.prevZ=i,i=o;r=n}i.nextZ=null,c*=2}while(a>1)}(o)}(t,n,o,i);for(var u,s,c=t;t.prev!==t.next;)if(u=t.prev,s=t.next,i?bp(t,n,o,i):mp(t))e.push(u.i/r|0),e.push(t.i/r|0),e.push(s.i/r|0),Dp(t),t=s.next,c=s.next;else if((t=s)===c){a?1===a?gp(t=xp(yp(t),e,r),e,r,n,o,i,2):2===a&&wp(t,e,r,n,o,i):gp(yp(t),e,r,n,o,i,1);break}}}function mp(t){var e=t.prev,r=t,n=t.next;if(jp(e,r,n)>=0)return!1;for(var o=e.x,i=r.x,a=n.x,u=e.y,s=r.y,c=n.y,f=o<i?o<a?o:a:i<a?i:a,l=u<s?u<c?u:c:s<c?s:c,h=o>i?o>a?o:a:i>a?i:a,p=u>s?u>c?u:c:s>c?s:c,v=n.next;v!==e;){if(v.x>=f&&v.x<=h&&v.y>=l&&v.y<=p&&kp(o,u,i,s,a,c,v.x,v.y)&&jp(v.prev,v,v.next)>=0)return!1;v=v.next}return!0}function bp(t,e,r,n){var o=t.prev,i=t,a=t.next;if(jp(o,i,a)>=0)return!1;for(var u=o.x,s=i.x,c=a.x,f=o.y,l=i.y,h=a.y,p=u<s?u<c?u:c:s<c?s:c,v=f<l?f<h?f:h:l<h?l:h,d=u>s?u>c?u:c:s>c?s:c,y=f>l?f>h?f:h:l>h?l:h,g=Sp(p,v,e,r,n),m=Sp(d,y,e,r,n),b=t.prevZ,x=t.nextZ;b&&b.z>=g&&x&&x.z<=m;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&kp(u,f,s,l,c,h,b.x,b.y)&&jp(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&kp(u,f,s,l,c,h,x.x,x.y)&&jp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;b&&b.z>=g;){if(b.x>=p&&b.x<=d&&b.y>=v&&b.y<=y&&b!==o&&b!==a&&kp(u,f,s,l,c,h,b.x,b.y)&&jp(b.prev,b,b.next)>=0)return!1;b=b.prevZ}for(;x&&x.z<=m;){if(x.x>=p&&x.x<=d&&x.y>=v&&x.y<=y&&x!==o&&x!==a&&kp(u,f,s,l,c,h,x.x,x.y)&&jp(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function xp(t,e,r){var n=t;do{var o=n.prev,i=n.next.next;!Pp(o,i)&&_p(o,n,n.next,i)&&Rp(o,i)&&Rp(i,o)&&(e.push(o.i/r|0),e.push(n.i/r|0),e.push(i.i/r|0),Dp(n),Dp(n.next),n=t=i),n=n.next}while(n!==t);return yp(n)}function wp(t,e,r,n,o,i){var a=t;do{for(var u=a.next.next;u!==a.prev;){if(a.i!==u.i&&Ip(a,u)){var s=Np(a,u);return a=yp(a,a.next),s=yp(s,s.next),gp(a,e,r,n,o,i,0),void gp(s,e,r,n,o,i,0)}u=u.next}a=a.next}while(a!==t)}function Ep(t,e){return t.x-e.x}function Ap(t,e){var r=function(t,e){var r,n=e,o=t.x,i=t.y,a=-1/0;do{if(i<=n.y&&i>=n.next.y&&n.next.y!==n.y){var u=n.x+(i-n.y)*(n.next.x-n.x)/(n.next.y-n.y);if(u<=o&&u>a&&(a=u,r=n.x<n.next.x?n:n.next,u===o))return r}n=n.next}while(n!==e);if(!r)return null;var s,c=r,f=r.x,l=r.y,h=1/0;n=r;do{o>=n.x&&n.x>=f&&o!==n.x&&kp(i<l?o:a,i,f,l,i<l?a:o,i,n.x,n.y)&&(s=Math.abs(i-n.y)/(o-n.x),Rp(n,t)&&(s<h||s===h&&(n.x>r.x||n.x===r.x&&Op(r,n)))&&(r=n,h=s)),n=n.next}while(n!==c);return r}(t,e);if(!r)return e;var n=Np(r,t);return yp(n,n.next),yp(r,r.next)}function Op(t,e){return jp(t.prev,t,e.prev)<0&&jp(e.next,t,t.next)<0}function Sp(t,e,r,n,o){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-r)*o|0)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-n)*o|0)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Tp(t){var e=t,r=t;do{(e.x<r.x||e.x===r.x&&e.y<r.y)&&(r=e),e=e.next}while(e!==t);return r}function kp(t,e,r,n,o,i,a,u){return(o-a)*(e-u)>=(t-a)*(i-u)&&(t-a)*(n-u)>=(r-a)*(e-u)&&(r-a)*(i-u)>=(o-a)*(n-u)}function Ip(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var r=t;do{if(r.i!==t.i&&r.next.i!==t.i&&r.i!==e.i&&r.next.i!==e.i&&_p(r,r.next,t,e))return!0;r=r.next}while(r!==t);return!1}(t,e)&&(Rp(t,e)&&Rp(e,t)&&function(t,e){var r=t,n=!1,o=(t.x+e.x)/2,i=(t.y+e.y)/2;do{r.y>i!=r.next.y>i&&r.next.y!==r.y&&o<(r.next.x-r.x)*(i-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==t);return n}(t,e)&&(jp(t.prev,t,e.prev)||jp(t,e.prev,e))||Pp(t,e)&&jp(t.prev,t,t.next)>0&&jp(e.prev,e,e.next)>0)}function jp(t,e,r){return(e.y-t.y)*(r.x-e.x)-(e.x-t.x)*(r.y-e.y)}function Pp(t,e){return t.x===e.x&&t.y===e.y}function _p(t,e,r,n){var o=Lp(jp(t,e,r)),i=Lp(jp(t,e,n)),a=Lp(jp(r,n,t)),u=Lp(jp(r,n,e));return o!==i&&a!==u||(!(0!==o||!Mp(t,r,e))||(!(0!==i||!Mp(t,n,e))||(!(0!==a||!Mp(r,t,n))||!(0!==u||!Mp(r,e,n)))))}function Mp(t,e,r){return e.x<=Math.max(t.x,r.x)&&e.x>=Math.min(t.x,r.x)&&e.y<=Math.max(t.y,r.y)&&e.y>=Math.min(t.y,r.y)}function Lp(t){return t>0?1:t<0?-1:0}function Rp(t,e){return jp(t.prev,t,t.next)<0?jp(t,e,t.next)>=0&&jp(t,t.prev,e)>=0:jp(t,e,t.prev)<0||jp(t,t.next,e)<0}function Np(t,e){var r=new Fp(t.i,t.x,t.y),n=new Fp(e.i,e.x,e.y),o=t.next,i=e.prev;return t.next=e,e.prev=t,r.next=o,o.prev=r,n.next=r,r.prev=n,i.next=n,n.prev=i,n}function Cp(t,e,r,n){var o=new Fp(t,e,r);return n?(o.next=n.next,o.prev=n,n.next.prev=o,n.next=o):(o.prev=o,o.next=o),o}function Dp(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function Fp(t,e,r){this.i=t,this.x=e,this.y=r,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function Wp(t,e,r,n){for(var o=0,i=e,a=r-n;i<r;i+=n)o+=(t[a]-t[i])*(t[i+1]+t[a+1]),a=i;return o}vp.deviation=function(t,e,r,n){var o=e&&e.length,i=o?e[0]*r:t.length,a=Math.abs(Wp(t,0,i,r));if(o)for(var u=0,s=e.length;u<s;u++){var c=e[u]*r,f=u<s-1?e[u+1]*r:t.length;a-=Math.abs(Wp(t,c,f,r))}var l=0;for(u=0;u<n.length;u+=3){var h=n[u]*r,p=n[u+1]*r,v=n[u+2]*r;l+=Math.abs((t[h]-t[v])*(t[p+1]-t[h+1])-(t[h]-t[p])*(t[v+1]-t[h+1]))}return 0===a&&0===l?0:Math.abs((l-a)/a)},vp.flatten=function(t){for(var e=t[0][0].length,r={vertices:[],holes:[],dimensions:e},n=0,o=0;o<t.length;o++){for(var i=0;i<t[o].length;i++)for(var a=0;a<e;a++)r.vertices.push(t[o][i][a]);o>0&&(n+=t[o-1].length,r.holes.push(n))}return r},hp.default=pp;var zp=S,Bp=N(1..valueOf),Up="\\t\\n\\v\\f\\r                　\\u2028\\u2029\\ufeff",Gp=N("".replace),Vp=RegExp("^["+Up+"]+"),Hp=RegExp("(^|[^"+Up+"])["+Up+"]+$"),qp=function(t){return function(e){var r=Xc(F(e));return 1&t&&(r=Gp(r,Vp,"")),2&t&&(r=Gp(r,Hp,"$1")),r}},Zp={start:qp(1),end:qp(2),trim:qp(3)},Yp=Ze.f,$p=je.f,Kp=Gt.f,Qp=Zp.trim,Xp=S.Number,Jp=(zp.Number,Xp.prototype),tv=S.TypeError,ev=N("".slice),rv=N("".charCodeAt),nv=function(t){var e=Ft(t,"number");return"bigint"==typeof e?e:ov(e)},ov=function(t){var e,r,n,o,i,a,u,s,c=Ft(t,"number");if(jt(c))throw tv("Cannot convert a Symbol value to a number");if("string"==typeof c&&c.length>2)if(c=Qp(c),43===(e=rv(c,0))||45===e){if(88===(r=rv(c,2))||120===r)return NaN}else if(48===e){switch(rv(c,1)){case 66:case 98:n=2,o=49;break;case 79:case 111:n=8,o=55;break;default:return+c}for(a=(i=ev(c,2)).length,u=0;u<a;u++)if((s=rv(i,u))<48||s>o)return NaN;return parseInt(i,n)}return+c},iv=or("Number",!Xp(" 0o1")||!Xp("0b1")||Xp("+0x1")),av=function(t){return kt(Jp,t)&&P((function(){Bp(t)}))},uv=function(t){var e=arguments.length<1?0:Xp(nv(t));return av(this)?os(Object(e),this,uv):e};uv.prototype=Jp,iv&&(Jp.constructor=uv),ar({global:!0,constructor:!0,wrap:!0,forced:iv},{Number:uv});iv&&function(t,e){for(var r,n=ht?Yp(e):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,isFinite,isInteger,isNaN,isSafeInteger,parseFloat,parseInt,fromString,range".split(","),o=0;n.length>o;o++)U(e,r=n[o])&&!U(t,r)&&Kp(t,r,$p(e,r))}(zp.Number,Xp);var sv=RangeError,cv=RangeError,fv=String,lv=Math.floor,hv=N((function(t){var e=Xc(F(this)),r="",n=Le(t);if(n<0||n==1/0)throw sv("Wrong number of repetitions");for(;n>0;(n>>>=1)&&(e+=e))1&n&&(r+=e);return r})),pv=N("".slice),vv=N(1..toFixed),dv=function(t,e,r){return 0===e?r:e%2==1?dv(t,e-1,r*t):dv(t*t,e/2,r)},yv=function(t,e,r){for(var n=-1,o=r;++n<6;)o+=e*t[n],t[n]=o%1e7,o=lv(o/1e7)},gv=function(t,e){for(var r=6,n=0;--r>=0;)n+=t[r],t[r]=lv(n/e),n=n%e*1e7},mv=function(t){for(var e=6,r="";--e>=0;)if(""!==r||0===e||0!==t[e]){var n=fv(t[e]);r=""===r?n:r+hv("0",7-n.length)+n}return r},bv=P((function(){return"0.000"!==vv(8e-5,3)||"1"!==vv(.9,0)||"1.25"!==vv(1.255,2)||"1000000000000000128"!==vv(0xde0b6b3a7640080,0)}))||!P((function(){vv({})}));function xv(t){return"number"==typeof t}function wv(t){var e=Math.max(Math.min(85.0511287798,t[1]),-85.0511287798),r=Math.PI/180,n=t[0]*r,o=e*r;o=Math.log(Math.tan(Math.PI/4+o/2));return n=(256<<20)*(.5/Math.PI*n+.5),o=(256<<20)*(-.5/Math.PI*o+(r=.5)),[Math.floor(n),Math.floor(o)]}ar({target:"Number",proto:!0,forced:bv},{toFixed:function(t){var e,r,n,o,i=Bp(this),a=Le(t),u=[0,0,0,0,0,0],s="",c="0";if(a<0||a>20)throw cv("Incorrect fraction digits");if(i!=i)return"NaN";if(i<=-1e21||i>=1e21)return fv(i);if(i<0&&(s="-",i=-i),i>1e-21)if(r=(e=function(t){for(var e=0,r=t;r>=4096;)e+=12,r/=4096;for(;r>=2;)e+=1,r/=2;return e}(i*dv(2,69,1))-69)<0?i*dv(2,-e,1):i/dv(2,e,1),r*=4503599627370496,(e=52-e)>0){for(yv(u,0,r),n=a;n>=7;)yv(u,1e7,0),n-=7;for(yv(u,dv(10,n,1),0),n=e-1;n>=23;)gv(u,1<<23),n-=23;gv(u,1<<n),yv(u,1,1),gv(u,2),c=mv(u)}else yv(u,0,r),yv(u,1<<-e,0),c=mv(u)+hv("0",a);return c=a>0?s+((o=c.length)<=a?"0."+hv("0",a-o)+c:pv(c,0,o-a)+"."+pv(c,o-a)):s+c}});var Ev,Av=/"/g,Ov=N("".replace);ar({target:"String",proto:!0,forced:(Ev="sub",P((function(){var t=""[Ev](\'"\');return t!==t.toLowerCase()||t.split(\'"\').length>3})))},{sub:function(){return t="sub",e="",r="",n=Xc(F(this)),o="<"+t,""!==e&&(o+=" "+e+\'="\'+Ov(Xc(r),Av,"&quot;")+\'"\'),o+">"+n+"</"+t+">";var t,e,r,n,o}});var Sv=RegExp.prototype,Tv=Zt.PROPER,kv=RegExp.prototype.toString,Iv=P((function(){return"/a/b"!=kv.call({source:"a",flags:"b"})})),jv=Tv&&"toString"!=kv.name;(Iv||jv)&&he(RegExp.prototype,"toString",(function(){var t=Et(this);return"/"+Xc(t.source)+"/"+Xc(function(t){var e=t.flags;return void 0!==e||"flags"in Sv||U(t,"flags")||!kt(Sv,t)?e:Ot(Jc,t)}(t))}),{unsafe:!0});var Pv="undefined"!=typeof Float32Array?Float32Array:Array;function _v(){var t=new Pv(2);return Pv!=Float32Array&&(t[0]=0,t[1]=0),t}function Mv(t,e){var r=new Pv(2);return r[0]=t,r[1]=e,r}function Lv(t,e){return t[0]=e[0],t[1]=e[1],t}function Rv(t,e,r){return t[0]=e[0]+r[0],t[1]=e[1]+r[1],t}function Nv(t,e,r){return t[0]=e[0]-r[0],t[1]=e[1]-r[1],t}function Cv(t,e){var r=e[0],n=e[1],o=r*r+n*n;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t}function Dv(t,e){return t[0]*e[0]+t[1]*e[1]}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Fv,Wv=Nv,zv=(Fv=_v(),_v()),Bv=(_v(),_v()),Uv=_v(),Gv=_v();function Vv(t,e,r,n,o){return Rv(t,r,n),Cv(t,t),[o/Dv(e=Mv(-t[1],t[0]),Mv(-r[1],r[0])),e]}function Hv(t,e){return function(t,e,r){return t[0]=e,t[1]=r,t}(t,-e[1],e[0])}function qv(t,e,r){return Wv(t,e,r),Cv(t,t),t}function Zv(t,e){return t[0]===e[0]&&t[1]===e[1]}var Yv=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};i(this,t),s(this,"complex",void 0),s(this,"join",void 0),s(this,"cap",void 0),s(this,"miterLimit",void 0),s(this,"thickness",void 0),s(this,"normal",void 0),s(this,"lastFlip",-1),s(this,"miter",Mv(0,0)),s(this,"started",!1),s(this,"dash",!1),s(this,"totalDistance",0),s(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return u(t,[{key:"extrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.segment_gaode2(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"simpleExtrude_gaode2",value:function(t,e){var r=this.complex;if(t.length<=1)return r;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,o=r.startIndex,i=1;i<n;i++){var a,u,s,c=t[i-1];c.push(null!==(a=e[i-1][2])&&void 0!==a?a:0);var f=e[i-1],l=t[i];l.push(null!==(u=e[i][2])&&void 0!==u?u:0);var h=e[i],p=i<t.length-1?[].concat(y(t[i+1]),[null!==(s=e[i+1][2])&&void 0!==s?s:0]):null,v=i<e.length-1?e[i+1]:null;o+=this.simpleSegment(r,o,c,l,p,f,h,v)}if(this.dash)for(var d=0;d<r.positions.length/6;d++)r.positions[6*d+5]=this.totalDistance;return r.startIndex=r.positions.length/6,r}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.segment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,n=e.startIndex,o=1;o<r;o++){var i=t[o-1],a=t[o],u=o<t.length-1?t[o+1]:null;n+=this.simpleSegment(e,n,i,a,u)}if(this.dash)for(var s=0;s<e.positions.length/6;s++)e.positions[6*s+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"segment_gaode2",value:function(t,e,r,n,o,i,a,u){var s=0,c=t.indices,f=t.positions,l=t.normals,h="square"===this.cap,p="bevel"===this.join,v=wv([a[0],a[1]]),g=wv([i[0],i[1]]);qv(Bv,n,r);var m=0;if(this.dash&&(m=this.lineSegmentDistance(v,g),this.totalDistance+=m),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),!this.started)if(this.started=!0,h){var b=_v(),x=_v();Rv(b,this.normal,Bv),Rv(x,this.normal,Bv),l.push(x[0],x[1],0),l.push(b[0],b[1],0),f.push(r[0],r[1],0|r[2],this.totalDistance-m,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),f.push(r[0],r[1],0|r[2],this.totalDistance-m,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,r,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),o){Zv(n,o)&&Rv(o,n,Cv(o,Nv(o,n,r))),qv(Uv,o,n);var w=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),E=w[0],A=w[1],O=Dv(Gv,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join)E>this.miterLimit&&(S=!0);S?(l.push(this.normal[0],this.normal[1],0),l.push(A[0],A[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,y(this.lastFlip!==-O?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),Hv(zv,Uv),Lv(this.normal,zv),l.push(this.normal[0],this.normal[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*O,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,s+=3):(this.extrusions(f,l,n,A,E,this.totalDistance),c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),O=-1,Lv(this.normal,A),s+=2),this.lastFlip=O}else{if(Hv(this.normal,Bv),h){var T=_v(),k=_v();Wv(k,Bv,this.normal),Rv(T,Bv,this.normal),l.push(k[0],k[1],0),l.push(T[0],T[1],0),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),f.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(f,l,n,this.normal,this.thickness,this.totalDistance);c.push.apply(c,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),s+=2}return s}},{key:"simpleSegment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c=wv([n[0],n[1]]),f=wv([r[0],r[1]]);qv(Bv,c,f);var l=0;if(this.dash&&(l=this.lineSegmentDistance(c,f),this.totalDistance+=l),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),this.started||(this.started=!0,this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-l)),a.push(e+0,e+1,e+2),o){var h=wv([o[0],o[1]]);Zv(c,h)&&Rv(h,c,Cv(h,Nv(h,c,f))),qv(Uv,h,c);var p=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),v=p[0],g=p[1];Dv(Gv,this.normal);this.extrusions(u,s,n,g,v,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),-1,Lv(this.normal,g),i+=2,this.lastFlip=-1}else Hv(this.normal,Bv),this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2;return i}},{key:"segment",value:function(t,e,r,n,o){var i=0,a=t.indices,u=t.positions,s=t.normals,c="square"===this.cap,f="bevel"===this.join,l=wv([n[0],n[1]]),h=wv([r[0],r[1]]);qv(Bv,l,h);var p=0;if(this.dash&&(p=this.lineSegmentDistance(l,h),this.totalDistance+=p),this.normal||(this.normal=_v(),Hv(this.normal,Bv)),!this.started)if(this.started=!0,c){var v=_v(),g=_v();Rv(v,this.normal,Bv),Rv(g,this.normal,Bv),s.push(g[0],g[1],0),s.push(v[0],v[1],0),u.push(r[0],r[1],0|r[2],this.totalDistance-p,-this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),u.push(r[0],r[1],0|r[2],this.totalDistance-p,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,r,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),o){var m=wv([o[0],o[1]]);Zv(l,m)&&Rv(m,l,Cv(m,Nv(m,l,h))),qv(Uv,m,l);var b=d(Vv(Gv,_v(),Bv,Uv,this.thickness),2),x=b[0],w=b[1],E=Dv(Gv,this.normal)<0?-1:1,A=f;if(!A&&"miter"===this.join)x>this.miterLimit&&(A=!0);A?(s.push(this.normal[0],this.normal[1],0),s.push(w[0],w[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,y(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),Hv(zv,Uv),Lv(this.normal,zv),s.push(this.normal[0],this.normal[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,-this.thickness*E,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,i+=3):(this.extrusions(u,s,n,w,x,this.totalDistance),a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,Lv(this.normal,w),i+=2),this.lastFlip=E}else{if(Hv(this.normal,Bv),c){var O=_v(),S=_v();Wv(S,Bv,this.normal),Rv(O,Bv,this.normal),s.push(S[0],S[1],0),s.push(O[0],O[1],0),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),u.push(n[0],n[1],0|n[2],this.totalDistance,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(u,s,n,this.normal,this.thickness,this.totalDistance);a.push.apply(a,y(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),i+=2}return i}},{key:"extrusions",value:function(t,e,r,n,o,i){e.push(n[0],n[1],0),e.push(n[0],n[1],0),t.push(r[0],r[1],0|r[2],i,-o,0|r[2]),this.complex.indexes.push(this.currentIndex),t.push(r[0],r[1],0|r[2],i,o,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var r=e[0]-t[0],n=e[1]-t[1];return Math.sqrt(r*r+n*n)}}]),t}();function $v(t){var e=t.coordinates,r=t.originCoordinates,n=t.version,o=new Yv({dash:!0,join:"bevel"});if("GAODE2.x"===n){var i=e;Array.isArray(i[0][0])||(i=[e]);var a=r;Array.isArray(a[0][0])||(a=[r]);for(var u=0;u<i.length;u++){var s=i[u],c=a[u];o.extrude_gaode2(s,c)}}else{var f=e;f[0]&&!Array.isArray(f[0][0])&&(f=[e]),f.forEach((function(t){o.extrude(t)}))}var l=o.complex;return{vertices:l.positions,indices:l.indices,normals:l.normals,indexes:l.indexes,size:6}}function Kv(t){var e=function(t){if(xv(t[0]))return t;if(xv(t[0][0]))throw new Error("当前数据不支持标注");if(xv(t[0][0][0])){var e=0,r=0,n=0;return t.forEach((function(t){t.forEach((function(t){e+=t[0],r+=t[1],n++}))})),[e/n,r/n,0]}throw new Error("当前数据不支持标注")}(t.coordinates);return{vertices:[].concat(y(e),y(e),y(e),y(e)),indices:[0,1,2,2,3,0],size:e.length}}function Qv(t){var e=t.coordinates,r=hp.flatten(e),n=r.vertices,o=r.dimensions,i=r.holes;return{indices:hp(n,i,o),vertices:n,size:o}}var Xv=function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.iconMap,u={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]},a_DistanceAndIndex:function(t,e,r,n,o,i){return void 0===i?[r[3],10]:[r[3],i]},a_Total_Distance:function(t,e,r){return[r[5]]},a_Size:function(t){var e=t.size,r=void 0===e?1:e;return Array.isArray(r)?[r[0],r[1]]:[r,0]},a_Normal:function(t,e,r,n,o){return o},a_Miter:function(t,e,r){return[r[4]]},a_iconMapUV:function(t){var e=t.texture,r=a[e]||{x:0,y:0};return[r.x,r.y]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=$v(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size,p=r.indexes;o.forEach((function(t){f.push(t+c)})),l=h;var v=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=v;for(var d=function(r){var o=(null==a?void 0:a.slice(3*r,3*r+3))||[],s=i.slice(r*h,r*h+h),c=0;p&&void 0!==p[r]&&(c=p[r]),n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,s,r,o,c)))}))},g=0;g<v;g++)d(g)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),Jv={pointFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f,l;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a=e.shape2d,u={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]},a_Shape:function(t){var e=t.shape,r=void 0===e?2:e;return[a.indexOf(r)]},a_Extrude:function(t,e,r,n){var o=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],i=n%4*3;return[o[i],o[i+1],o[i+2]]},a_Size:function(t){var e=t.size,r=void 0===e?5:e;return Array.isArray(r)?[r[0]]:[r]}},s={sizePerElement:0,elements:[]},c=0,f=[],l=3,o.forEach((function(t,e){var r=Kv(t),o=r.indices,i=r.vertices,a=r.normals,h=r.size;o.forEach((function(t){f.push(t+c)})),l=h;var p=i.length/h;s.sizePerElement=l,s.elements.push({featureIdx:e,vertices:i,normals:a,offset:c}),c+=p;for(var v=function(r){var o=[],a=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&u[n.name]&&(i=n.buffer.data).push.apply(i,y(u[n.name](t,e,a,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:s,indices:f});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),line:Xv,polygonFill:function(){var t=o(r().mark((function t(e){var n,o,i,a,u,s,c,f;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.descriptors,o=e.features,i=e.enablePicking,a={a_Color:sp,a_Position:cp,filter:fp,a_vertexId:lp,a_PickingColor:function(t){var e=t.id;return i?ip(e):[0,0,0]}},u={sizePerElement:0,elements:[]},s=0,c=[],f=3,o.forEach((function(t,e){var r=Qv(t),o=r.indices,i=r.vertices,l=r.normals,h=r.size;o.forEach((function(t){c.push(t+s)})),f=h;var p=i.length/h;u.sizePerElement=f,u.elements.push({featureIdx:e,vertices:i,normals:l,offset:s}),s+=p;for(var v=function(r){var o=[],u=i.slice(r*h,r*h+h);n.forEach((function(n){var i;n&&a[n.name]&&(i=n.buffer.data).push.apply(i,y(a[n.name](t,e,u,r,o,0)))}))},d=0;d<p;d++)v(d)})),t.abrupt("return",{descriptors:n,featureLayout:u,indices:c});case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()},td=function(t){for(var r=1;r<arguments.length;r++){var n=null!=arguments[r]?arguments[r]:{};r%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}({},Jv);function ed(t){return rd.apply(this,arguments)}function rd(){return(rd=o(r().mark((function t(e){var n,o;return r().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(n=e.workerType,o=e.data,!td[n]){t.next=3;break}return t.abrupt("return",td[n](o));case 3:return t.abrupt("return",Promise.reject(new Error(\'Worker with type "\'.concat(n,\'" non-existent.\'))));case 4:case"end":return t.stop()}}),t)})))).apply(this,arguments)}return li(ed),t.WorkerSourceMap=Jv,t.createWorker=li,t.worker=ed,t}({});\n',ju="l7-worker",Zu=3,Vu=!0;function Gu(t){Fu(ju,t)}function Hu(){var t=Bu(ju);if(!t)throw new Error("get worker failed by workerName: ".concat(ju,"."));return t}function Wu(t,e){return qu.apply(this,arguments)}function qu(){return qu=(0,J.Z)(tt().mark((function t(e,n){var r,i,o,a,s;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=Hu(),i=zs.getWorkerFarm({maxConcurrency:Zu,reuseWorkers:Vu}),o=i.getWorkerPool({name:ju,source:r}),t.next=5,o.startJob(ju,(function(t,e,n){return t.done(n)}));case 5:return a=t.sent,a.postMessage("process",{input:{workerType:e,data:n}}),t.next=9,a.result;case 9:return s=t.sent,t.abrupt("return",s.result);case 11:case"end":return t.stop()}}),t)}))),qu.apply(this,arguments)}function Xu(t,e){var n=e.extent,r=void 0===n?[121.168,30.2828,121.384,30.4219]:n,i=new Promise((function(e){t instanceof HTMLImageElement||co(t)?e([t]):Yu(t,(function(t){e(t)}))})),o={originData:t,images:i,_id:1,dataArray:[{_id:0,coordinates:[[r[0],r[1]],[r[2],r[3]]]}]};return o}function Yu(t,e){var n=t,r=[];if("string"===typeof n)Nr({url:n},(function(t,n){n&&(r.push(n),e(r))}));else{var i=n.length,o=0;n.forEach((function(t){Nr({url:t},(function(t,n){o++,n&&r.push(n),o===i&&e(r)}))}))}return Xu}Gu(Uu);var Ku=n(32704),Qu=n(53431),Ju=n.n(Qu),$u=function(){function t(e,n,r,i){Ot(this,t),(0,Ft.Z)(this,"vectorLayerCache",{}),this.x=n,this.y=r,this.z=i,this.vectorTile=new Ku.VectorTile(new(Ju())(e))}return zt(t,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var e=this.vectorTile.layers[t];if(Array.isArray(e.features))return this.vectorLayerCache[t]=e.features,e.features;for(var n=[],r=0;r<e.length;r++){var i=e.feature(r),o=i.toGeoJSON(this.x,this.y,this.z);n.push((0,k.Z)((0,k.Z)({},o),{},{properties:(0,k.Z)({id:o.id},o.properties)}))}return this.vectorLayerCache[t]=n,n}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),t}(),tc={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},ec=function(){var t=(0,J.Z)(tt().mark((function t(e,n,r,i,o){var a;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=hs(e,n),t.abrupt("return",new Promise((function(t){if(o)o({x:r.x,y:r.y,z:r.z},(function(e,n){if(e||!n)t(void 0);else{var i=new $u(n,r.x,r.y,r.z);t(i)}}));else{var e=Pr((0,k.Z)((0,k.Z)({},i),{},{url:a}),(function(e,n){if(e||!n)t(void 0);else{var i=new $u(n,r.x,r.y,r.z);t(i)}}));r.xhrCancel=function(){return e.abort()}}})));case 2:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}();function nc(t,e){var n=Array.isArray(t)?t[0]:t,r=function(t,r){return ec(n,t,r,null===e||void 0===e?void 0:e.requestParameters,null===e||void 0===e?void 0:e.getCustomData)},i=(0,k.Z)((0,k.Z)((0,k.Z)({},tc),e),{},{getTileData:r});return{data:n,dataArray:[],tilesetOptions:i,isTile:!0}}function rc(t,e,n){switch(t){case"+":return e+n;case"-":return e-n;case"*":return e*n;case"/":return e/n;case"%":return e%n;case"^":return Math.pow(e,n);case"abs":return Math.abs(e);case"floor":return Math.floor(e);case"round":return Math.round(e);case"ceil":return Math.ceil(e);case"sin":return Math.sin(e);case"cos":return Math.cos(e);case"atan":return-1===n?Math.atan(e):Math.atan2(e,n);case"min":return Math.min(e,n);case"max":return Math.max(e,n);case"log10":return Math.log(e);case"log2":return Math.log2(e);default:return 0}}function ic(t,e){for(var n=e[0],r=n.width,i=n.height,o=e.map((function(t){return t.rasterData})),a=r*i,s=[],u=JSON.stringify(t),c=0;c<a;c++){var l=JSON.parse(u),h=oc(l,o,c);if("number"===typeof h)s.push(h);else{var f=sc(l);s.push(f)}}return s}function oc(t,e,n){if(2===t.length&&"band"===t[0]&&"number"===typeof t[1])try{return e[t[1]][n]}catch(r){return 0}t.map((function(i,o){if(Array.isArray(i)&&i.length>0)switch(i[0]){case"band":try{t[o]=e[i[1]][n]}catch(r){t[o]=0}break;default:oc(i,e,n)}}))}function ac(t){var e=(0,Li.Z)(t,3),n=e[0],r=e[1],i=void 0===r?-1:r,o=e[2],a=void 0===o?-1:o;if(void 0===n)return["+",0,0];var s=n.replace(/\s+/g,"");return[s,i,a]}function sc(t){var e=ac(t),n=e[0],r=e[1],i=e[2];return Array.isArray(r)&&(r=sc(t[1])),Array.isArray(i)&&(i=sc(t[2])),rc(n,r,i)}var uc={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:cc}};function cc(t,e){for(var n=t[0].rasterData,r=t[1].rasterData,i=t[2].rasterData,o=[],a=(null===e||void 0===e?void 0:e.countCut)||[2,98],s=(0,Li.Z)(a,2),u=s[0],c=s[1],l=(null===e||void 0===e?void 0:e.RMinMax)||lc(n,u,c),h=(null===e||void 0===e?void 0:e.GMinMax)||lc(r,u,c),f=(null===e||void 0===e?void 0:e.BMinMax)||lc(i,u,c),p=0;p<n.length;p++)o.push(Math.max(0,n[p]-l[0])),o.push(Math.max(0,r[p]-h[0])),o.push(Math.max(0,i[p]-f[0]));return{rasterData:o,rMinMax:l,gMinMax:h,bMinMax:f}}function lc(t,e,n){var r=t.slice().sort((function(t,e){return t-e})),i=r.length,o=r[Math.ceil(i*e/100)],a=r[Math.ceil(i*n/100)];return[o,a]}function hc(t,e,n){return fc.apply(this,arguments)}function fc(){return fc=(0,J.Z)(tt().mark((function t(e,n,r){var i,o,a,s,u,c;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(0!==e.length){t.next=2;break}return t.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return t.next=4,Promise.all(e.map((function(t){var e=t.data,r=t.bands,i=void 0===r?[0]:r;return n(e,i)})));case 4:i=t.sent,o=[],i.forEach((function(t){Array.isArray(t)?o.push.apply(o,(0,C.Z)(t)):o.push(t)})),a=o[0],s=a.width,u=a.height,t.t0=(0,I.Z)(r),t.next="function"===t.t0?11:"object"===t.t0?13:15;break;case 11:return c=r(o),t.abrupt("break",16);case 13:return c=Array.isArray(r)?{rasterData:ic(r,o)}:pc(r,o),t.abrupt("break",16);case 15:c={rasterData:o[0].rasterData};case 16:return t.abrupt("return",(0,k.Z)((0,k.Z)({},c),{},{width:s,height:u}));case 17:case"end":return t.stop()}}),t)}))),fc.apply(this,arguments)}function pc(t,e){var n=uc[t.type];return"function"===n.type?n.method(e,null===t||void 0===t?void 0:t.options):"operation"===n.type?"rgb"===t.type?dc(n.expression,e):{rasterData:ic(n.expression,e)}:void 0}function dc(t,e){t.r,t.g,t.b;var n=ic(t.r||["band",0],e),r=ic(t.g||["band",0],e),i=ic(t.b||["band",0],e);return[n,r,i]}function vc(t,e,n,r){return mc.apply(this,arguments)}function mc(){return mc=(0,J.Z)(tt().mark((function t(e,n,r,i){var o;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,hc(e,n,r);case 2:o=t.sent,i(null,{data:o});case 4:case"end":return t.stop()}}),t)}))),mc.apply(this,arguments)}function gc(t,e){return t.map((function(t){return 1*t[e]}))}function yc(t){return!!Array.isArray(t)&&(0===t.length||"number"===typeof t[0])}function _c(t,e){var n,r,i,o=e.extent,a=e.width,s=e.height,u=e.min,c=e.max,l=e.format,h=e.operation;if(void 0===l||yc(t))n=Array.from(t),r=a,i=s;else{var f=Array.isArray(t)?t:[t];n=hc(f,l,h)}var p={_id:1,dataArray:[{_id:1,data:n,width:r,height:i,min:u,max:c,coordinates:[[o[0],o[1]],[o[2],o[3]]]}]};return p}n(32861);var xc=n(35993),bc=n(44810),wc={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},Ec=n(89225),Sc=n.n(Ec);function Ac(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Tc(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Tc(t,e){if(t){if("string"===typeof t)return Cc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cc(t,e):void 0}}function Cc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var kc,Mc,Pc=30;function Ic(t){var e=t.characterSet,n=t.getFontWidth,r=t.fontHeight,i=t.buffer,o=t.maxCanvasWidth,a=t.mapping,s=void 0===a?{}:a,u=t.xOffset,c=void 0===u?0:u,l=t.yOffset,h=void 0===l?0:l,f=0,p=c;Array.from(e).forEach((function(t,e){if(!s[t]){var r=n(t,e);p+Pc>o&&(p=0,f++),s[t]={x:p,y:h+f*Pc,width:Pc,height:Pc,advance:r},p+=Pc}}));var d=r+2*i;return{mapping:s,xOffset:p,yOffset:h+f*d,canvasHeight:Oc(h+(f+1)*d)}}function Rc(t,e,n){var r,i=0,o=0,a=0,s=[],u={},c=Ac(t);try{for(c.s();!(r=c.n()).done;){var l=r.value;if(!u[l.id]){var h=l.size;i+h+e>n&&(Lc(u,s,o),i=0,o=a+o+e,a=0,s=[]),s.push({icon:l,xOffset:i}),i=i+h+e,a=Math.max(a,h)}}}catch(p){c.e(p)}finally{c.f()}s.length>0&&Lc(u,s,o);var f=Oc(a+o+e);return{mapping:u,canvasHeight:f}}function Lc(t,e,n){var r,i=Ac(e);try{for(i.s();!(r=i.n()).done;){var o=r.value,a=o.icon,s=o.xOffset;t[a.id]=(0,k.Z)((0,k.Z)({},a),{},{x:s,y:n,image:a.image,width:a.width,height:a.height})}}catch(u){i.e(u)}finally{i.f()}}function Oc(t){return Math.pow(2,Math.ceil(Math.log2(t)))}function Dc(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Nc(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Nc(t,e){if(t){if("string"===typeof t)return zc(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?zc(t,e):void 0}}function zc(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Fc(t){var e=Bc();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Bc(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Uc=Qc(),jc="sans-serif",Zc="normal",Vc=24,Gc=3,Hc=.25,Wc=8,qc=1024,Xc=1,Yc=1,Kc=3;function Qc(){for(var t=[],e=32;e<128;e++)t.push(String.fromCharCode(e));return t}function Jc(t,e,n,r){t.font="".concat(r," ").concat(n,"px ").concat(e),t.fillStyle="black",t.textBaseline="middle"}function $c(t,e){for(var n=0;n<t.length;n++)e.data[4*n+3]=t[n]}var tl,el,nl=(kc=(0,xc.b2)(),kc(Mc=function(t){Yt(n,t);var e=Fc(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"fontAtlas",void 0),(0,Ft.Z)(Kt(t),"iconFontMap",void 0),(0,Ft.Z)(Kt(t),"iconFontGlyphs",{}),(0,Ft.Z)(Kt(t),"fontOptions",void 0),(0,Ft.Z)(Kt(t),"key",void 0),(0,Ft.Z)(Kt(t),"cache",new ya(Kc)),t}return zt(n,[{key:"scale",get:function(){return Yc}},{key:"canvas",get:function(){var t=this.cache.get(this.key);return t&&t.data}},{key:"mapping",get:function(){var t=this.cache.get(this.key);return t&&t.mapping||{}}},{key:"getCanvasByKey",value:function(t){var e=this.cache.get(t);return e&&e.data}},{key:"getMappingByKey",value:function(t){var e=this.cache.get(t);return e&&e.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:jc,fontWeight:Zc,characterSet:Uc,fontSize:Vc,buffer:Gc,sdf:!0,cutoff:Hc,radius:Wc,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(t){var e=this;t.forEach((function(t){e.iconFontGlyphs[t.name]=t.unicode}))}},{key:"addIconFont",value:function(t,e){this.iconFontMap.set(t,e)}},{key:"getIconFontKey",value:function(t){return this.iconFontMap.get(t)||t}},{key:"getGlyph",value:function(t){return this.iconFontGlyphs[t]?String.fromCharCode(parseInt(this.iconFontGlyphs[t],16)):""}},{key:"setFontOptions",value:function(t){this.fontOptions=(0,k.Z)((0,k.Z)({},this.fontOptions),t),this.key=this.getKey();var e=this.getNewChars(this.key,this.fontOptions.characterSet),n=this.cache.get(this.key);if(!n||0!==e.length){var r=this.generateFontAtlas(this.key,e,n);this.fontAtlas=r,this.cache.set(this.key,r)}}},{key:"addFontFace",value:function(t,e){var n=this,r=document.createElement("style");r.type="text/css",r.innerText="\n        @font-face{\n            font-family: '".concat(t,"';\n            src: url('").concat(e,"') format('woff2'),\n            url('").concat(e,"') format('woff'),\n            url('").concat(e,"') format('truetype');\n        }"),r.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(t),"L7text"),document.fonts.ready.then((function(){n.emit("fontloaded",{fontFamily:t})}))}catch(e){}},document.getElementsByTagName("head")[0].appendChild(r)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(t,e,n){var r=this.fontOptions,i=r.fontFamily,o=r.fontWeight,a=r.fontSize,s=r.buffer,u=r.sdf,c=r.radius,l=r.cutoff,h=r.iconfont,f=n&&n.data;f||(f=xr.document.createElement("canvas"),f.width=qc);var p=f.getContext("2d",{willReadFrequently:!0});Jc(p,i,a,o);var d=Ic((0,k.Z)({getFontWidth:function(t){return p.measureText(t).width},fontHeight:a*Yc,buffer:s,characterSet:e,maxCanvasWidth:qc},n&&{mapping:n.mapping,xOffset:n.xOffset,yOffset:n.yOffset})),v=d.mapping,m=d.canvasHeight,g=d.xOffset,y=d.yOffset,_=p.getImageData(0,0,f.width,f.height);if(f.height=m,p.putImageData(_,0,0),Jc(p,i,a,o),u){var x,b=new(Sc())(a,s,c,l,i,o),w=p.getImageData(0,0,b.size,b.size),E=Dc(e);try{for(E.s();!(x=E.n()).done;){var S=x.value;if(h){var A=String.fromCharCode(parseInt(S.replace("&#x","").replace(";",""),16)),T=b.draw(A);$c(T,w)}else $c(b.draw(S),w);p.putImageData(w,v[S].x,v[S].y)}}catch(I){E.e(I)}finally{E.f()}}else{var C,M=Dc(e);try{for(M.s();!(C=M.n()).done;){var P=C.value;p.fillText(P,v[P].x,v[P].y+a*Xc)}}catch(I){M.e(I)}finally{M.f()}}return{xOffset:g,yOffset:y,mapping:v,data:f,width:f.width,height:f.height}}},{key:"getKey",value:function(){var t=this.fontOptions,e=t.fontFamily,n=t.fontWeight;return"".concat(e,"_").concat(n)}},{key:"getNewChars",value:function(t,e){var n=this.cache.get(t);if(!n)return e;var r=[],i=n.mapping,o=new Set(Object.keys(i)),a=new Set(e);return a.forEach((function(t){o.has(t)||r.push(t)})),r}}]),n}(Ma.EventEmitter))||Mc);function rl(t){var e=il();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function il(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ol=3,al=1024,sl=64,ul=(tl=(0,xc.b2)(),tl(el=function(t){Yt(n,t);var e=rl(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"canvasHeight",128),(0,Ft.Z)(Kt(t),"texture",void 0),(0,Ft.Z)(Kt(t),"canvas",void 0),(0,Ft.Z)(Kt(t),"iconData",void 0),(0,Ft.Z)(Kt(t),"iconMap",void 0),(0,Ft.Z)(Kt(t),"ctx",void 0),(0,Ft.Z)(Kt(t),"loadingImageCount",0),t}return zt(n,[{key:"isLoading",value:function(){return 0===this.loadingImageCount}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=xr.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var t=(0,J.Z)(tt().mark((function t(e,n){var r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=new Image,this.loadingImageCount++,this.hasImage(e)||this.iconData.push({id:e,size:sl}),this.updateIconMap(),t.next=6,this.loadImage(n);case 6:r=t.sent,i=this.iconData.find((function(t){return t.id===e})),i&&(i.image=r,i.width=r.width,i.height=r.height),this.update();case 10:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"addImageMini",value:function(t,e,n){var r=this,i=n.getSceneConfig().canvas,o=i.createImage();if(this.loadingImageCount++,this.hasImage(t))throw new Error("Image Id already exists");this.iconData.push({id:t,size:sl}),this.updateIconMap(),this.loadImageMini(e,i).then((function(e){o=e;var n=r.iconData.find((function(e){return e.id===t}));n&&(n.image=o,n.width=o.width,n.height=o.height),r.update()}))}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(t){return this.iconMap.hasOwnProperty(t)}},{key:"removeImage",value:function(t){this.hasImage(t)&&(this.iconData=this.iconData.filter((function(e){return e.id!==t})),delete this.iconMap[t],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(t){return new Promise((function(e,n){if(t instanceof HTMLImageElement)e(t);else{var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e(r)},r.onerror=function(){n(new Error("Could not load image at "+t))},r.src=t instanceof File?URL.createObjectURL(t):t}}))}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,0===this.loadingImageCount&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var t=this;this.canvas.width=al,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach((function(e){var n=t.iconMap[e],r=n.x,i=n.y,o=n.image,a=n.width,s=void 0===a?64:a,u=n.height,c=void 0===u?64:u,l=Math.max(s,c),h=l/sl,f=c/h,p=s/h;o&&t.ctx.drawImage(o,r+(sl-p)/2,i+(sl-f)/2,p,f)}))}},{key:"updateIconMap",value:function(){var t=Rc(this.iconData,ol,al),e=t.mapping,n=t.canvasHeight;this.iconMap=e,this.canvasHeight=n}},{key:"loadImageMini",value:function(t,e){return new Promise((function(n,r){var i=e.createImage();i.crossOrigin="anonymous",i.onload=function(){n(i)},i.onerror=function(){r(new Error("Could not load image at "+t))},i.src=t}))}}]),n}(Ma.EventEmitter))||el);function cl(){var t=new ou(16);return ou!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t}function ll(t){var e=new ou(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function hl(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function fl(t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v){var m=new ou(16);return m[0]=t,m[1]=e,m[2]=n,m[3]=r,m[4]=i,m[5]=o,m[6]=a,m[7]=s,m[8]=u,m[9]=c,m[10]=l,m[11]=h,m[12]=f,m[13]=p,m[14]=d,m[15]=v,m}function pl(t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m){return t[0]=e,t[1]=n,t[2]=r,t[3]=i,t[4]=o,t[5]=a,t[6]=s,t[7]=u,t[8]=c,t[9]=l,t[10]=h,t[11]=f,t[12]=p,t[13]=d,t[14]=v,t[15]=m,t}function dl(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function vl(t,e){if(t===e){var n=e[1],r=e[2],i=e[3],o=e[6],a=e[7],s=e[11];t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=n,t[6]=e[9],t[7]=e[13],t[8]=r,t[9]=o,t[11]=e[14],t[12]=i,t[13]=a,t[14]=s}else t[0]=e[0],t[1]=e[4],t[2]=e[8],t[3]=e[12],t[4]=e[1],t[5]=e[5],t[6]=e[9],t[7]=e[13],t[8]=e[2],t[9]=e[6],t[10]=e[10],t[11]=e[14],t[12]=e[3],t[13]=e[7],t[14]=e[11],t[15]=e[15];return t}function ml(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],p=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=n*s-r*a,_=n*u-i*a,x=n*c-o*a,b=r*u-i*s,w=r*c-o*s,E=i*c-o*u,S=l*v-h*d,A=l*m-f*d,T=l*g-p*d,C=h*m-f*v,k=h*g-p*v,M=f*g-p*m,P=y*M-_*k+x*C+b*T-w*A+E*S;return P?(P=1/P,t[0]=(s*M-u*k+c*C)*P,t[1]=(i*k-r*M-o*C)*P,t[2]=(v*E-m*w+g*b)*P,t[3]=(f*w-h*E-p*b)*P,t[4]=(u*T-a*M-c*A)*P,t[5]=(n*M-i*T+o*A)*P,t[6]=(m*x-d*E-g*_)*P,t[7]=(l*E-f*x+p*_)*P,t[8]=(a*k-s*T+c*S)*P,t[9]=(r*T-n*k-o*S)*P,t[10]=(d*w-v*x+g*y)*P,t[11]=(h*x-l*w-p*y)*P,t[12]=(s*A-a*C-u*S)*P,t[13]=(n*C-r*A+i*S)*P,t[14]=(v*_-d*b-m*y)*P,t[15]=(l*b-h*_+f*y)*P,t):null}function gl(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],p=e[11],d=e[12],v=e[13],m=e[14],g=e[15];return t[0]=s*(f*g-p*m)-h*(u*g-c*m)+v*(u*p-c*f),t[1]=-(r*(f*g-p*m)-h*(i*g-o*m)+v*(i*p-o*f)),t[2]=r*(u*g-c*m)-s*(i*g-o*m)+v*(i*c-o*u),t[3]=-(r*(u*p-c*f)-s*(i*p-o*f)+h*(i*c-o*u)),t[4]=-(a*(f*g-p*m)-l*(u*g-c*m)+d*(u*p-c*f)),t[5]=n*(f*g-p*m)-l*(i*g-o*m)+d*(i*p-o*f),t[6]=-(n*(u*g-c*m)-a*(i*g-o*m)+d*(i*c-o*u)),t[7]=n*(u*p-c*f)-a*(i*p-o*f)+l*(i*c-o*u),t[8]=a*(h*g-p*v)-l*(s*g-c*v)+d*(s*p-c*h),t[9]=-(n*(h*g-p*v)-l*(r*g-o*v)+d*(r*p-o*h)),t[10]=n*(s*g-c*v)-a*(r*g-o*v)+d*(r*c-o*s),t[11]=-(n*(s*p-c*h)-a*(r*p-o*h)+l*(r*c-o*s)),t[12]=-(a*(h*m-f*v)-l*(s*m-u*v)+d*(s*f-u*h)),t[13]=n*(h*m-f*v)-l*(r*m-i*v)+d*(r*f-i*h),t[14]=-(n*(s*m-u*v)-a*(r*m-i*v)+d*(r*u-i*s)),t[15]=n*(s*f-u*h)-a*(r*f-i*h)+l*(r*u-i*s),t}function yl(t){var e=t[0],n=t[1],r=t[2],i=t[3],o=t[4],a=t[5],s=t[6],u=t[7],c=t[8],l=t[9],h=t[10],f=t[11],p=t[12],d=t[13],v=t[14],m=t[15],g=e*a-n*o,y=e*s-r*o,_=e*u-i*o,x=n*s-r*a,b=n*u-i*a,w=r*u-i*s,E=c*d-l*p,S=c*v-h*p,A=c*m-f*p,T=l*v-h*d,C=l*m-f*d,k=h*m-f*v;return g*k-y*C+_*T+x*A-b*S+w*E}function _l(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*h+w*v,t[1]=_*i+x*u+b*f+w*m,t[2]=_*o+x*c+b*p+w*g,t[3]=_*a+x*l+b*d+w*y,_=n[4],x=n[5],b=n[6],w=n[7],t[4]=_*r+x*s+b*h+w*v,t[5]=_*i+x*u+b*f+w*m,t[6]=_*o+x*c+b*p+w*g,t[7]=_*a+x*l+b*d+w*y,_=n[8],x=n[9],b=n[10],w=n[11],t[8]=_*r+x*s+b*h+w*v,t[9]=_*i+x*u+b*f+w*m,t[10]=_*o+x*c+b*p+w*g,t[11]=_*a+x*l+b*d+w*y,_=n[12],x=n[13],b=n[14],w=n[15],t[12]=_*r+x*s+b*h+w*v,t[13]=_*i+x*u+b*f+w*m,t[14]=_*o+x*c+b*p+w*g,t[15]=_*a+x*l+b*d+w*y,t}function xl(t,e,n){var r,i,o,a,s,u,c,l,h,f,p,d,v=n[0],m=n[1],g=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*g+e[12],t[13]=e[1]*v+e[5]*m+e[9]*g+e[13],t[14]=e[2]*v+e[6]*m+e[10]*g+e[14],t[15]=e[3]*v+e[7]*m+e[11]*g+e[15]):(r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],p=e[10],d=e[11],t[0]=r,t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=h,t[9]=f,t[10]=p,t[11]=d,t[12]=r*v+s*m+h*g+e[12],t[13]=i*v+u*m+f*g+e[13],t[14]=o*v+c*m+p*g+e[14],t[15]=a*v+l*m+d*g+e[15]),t}function bl(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function wl(t,e,n,r){var i,o,a,s,u,c,l,h,f,p,d,v,m,g,y,_,x,b,w,E,S,A,T,C,k=r[0],M=r[1],P=r[2],I=Math.hypot(k,M,P);return I<iu?null:(I=1/I,k*=I,M*=I,P*=I,i=Math.sin(n),o=Math.cos(n),a=1-o,s=e[0],u=e[1],c=e[2],l=e[3],h=e[4],f=e[5],p=e[6],d=e[7],v=e[8],m=e[9],g=e[10],y=e[11],_=k*k*a+o,x=M*k*a+P*i,b=P*k*a-M*i,w=k*M*a-P*i,E=M*M*a+o,S=P*M*a+k*i,A=k*P*a+M*i,T=M*P*a-k*i,C=P*P*a+o,t[0]=s*_+h*x+v*b,t[1]=u*_+f*x+m*b,t[2]=c*_+p*x+g*b,t[3]=l*_+d*x+y*b,t[4]=s*w+h*E+v*S,t[5]=u*w+f*E+m*S,t[6]=c*w+p*E+g*S,t[7]=l*w+d*E+y*S,t[8]=s*A+h*T+v*C,t[9]=u*A+f*T+m*C,t[10]=c*A+p*T+g*C,t[11]=l*A+d*T+y*C,e!==t&&(t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t)}function El(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*r,t[5]=a*i+l*r,t[6]=s*i+h*r,t[7]=u*i+f*r,t[8]=c*i-o*r,t[9]=l*i-a*r,t[10]=h*i-s*r,t[11]=f*i-u*r,t}function Sl(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[8],l=e[9],h=e[10],f=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-c*r,t[1]=a*i-l*r,t[2]=s*i-h*r,t[3]=u*i-f*r,t[8]=o*r+c*i,t[9]=a*r+l*i,t[10]=s*r+h*i,t[11]=u*r+f*i,t}function Al(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*r,t[1]=a*i+l*r,t[2]=s*i+h*r,t[3]=u*i+f*r,t[4]=c*i-o*r,t[5]=l*i-a*r,t[6]=h*i-s*r,t[7]=f*i-u*r,t}function Tl(t,e){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=e[0],t[13]=e[1],t[14]=e[2],t[15]=1,t}function Cl(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function kl(t,e,n){var r,i,o,a=n[0],s=n[1],u=n[2],c=Math.hypot(a,s,u);return c<iu?null:(c=1/c,a*=c,s*=c,u*=c,r=Math.sin(e),i=Math.cos(e),o=1-i,t[0]=a*a*o+i,t[1]=s*a*o+u*r,t[2]=u*a*o-s*r,t[3]=0,t[4]=a*s*o-u*r,t[5]=s*s*o+i,t[6]=u*s*o+a*r,t[7]=0,t[8]=a*u*o+s*r,t[9]=s*u*o-a*r,t[10]=u*u*o+i,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t)}function Ml(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=r,t[6]=n,t[7]=0,t[8]=0,t[9]=-n,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Pl(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=0,t[2]=-n,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=n,t[9]=0,t[10]=r,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Il(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=0,t[4]=-n,t[5]=r,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Rl(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=r+r,u=i+i,c=o+o,l=r*s,h=r*u,f=r*c,p=i*u,d=i*c,v=o*c,m=a*s,g=a*u,y=a*c;return t[0]=1-(p+v),t[1]=h+y,t[2]=f-g,t[3]=0,t[4]=h-y,t[5]=1-(l+v),t[6]=d+m,t[7]=0,t[8]=f+g,t[9]=d-m,t[10]=1-(l+p),t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Ll(t,e){var n=new ou(3),r=-e[0],i=-e[1],o=-e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=r*r+i*i+o*o+a*a;return h>0?(n[0]=2*(s*a+l*r+u*o-c*i)/h,n[1]=2*(u*a+l*i+c*r-s*o)/h,n[2]=2*(c*a+l*o+s*i-u*r)/h):(n[0]=2*(s*a+l*r+u*o-c*i),n[1]=2*(u*a+l*i+c*r-s*o),n[2]=2*(c*a+l*o+s*i-u*r)),Rl(t,e,n),t}function Ol(t,e){return t[0]=e[12],t[1]=e[13],t[2]=e[14],t}function Dl(t,e){var n=e[0],r=e[1],i=e[2],o=e[4],a=e[5],s=e[6],u=e[8],c=e[9],l=e[10];return t[0]=Math.hypot(n,r,i),t[1]=Math.hypot(o,a,s),t[2]=Math.hypot(u,c,l),t}function Nl(t,e){var n=new ou(3);Dl(n,e);var r=1/n[0],i=1/n[1],o=1/n[2],a=e[0]*r,s=e[1]*i,u=e[2]*o,c=e[4]*r,l=e[5]*i,h=e[6]*o,f=e[8]*r,p=e[9]*i,d=e[10]*o,v=a+l+d,m=0;return v>0?(m=2*Math.sqrt(v+1),t[3]=.25*m,t[0]=(h-p)/m,t[1]=(f-u)/m,t[2]=(s-c)/m):a>l&&a>d?(m=2*Math.sqrt(1+a-l-d),t[3]=(h-p)/m,t[0]=.25*m,t[1]=(s+c)/m,t[2]=(f+u)/m):l>d?(m=2*Math.sqrt(1+l-a-d),t[3]=(f-u)/m,t[0]=(s+c)/m,t[1]=.25*m,t[2]=(h+p)/m):(m=2*Math.sqrt(1+d-a-l),t[3]=(s-c)/m,t[0]=(f+u)/m,t[1]=(h+p)/m,t[2]=.25*m),t}function zl(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=e[3],u=i+i,c=o+o,l=a+a,h=i*u,f=i*c,p=i*l,d=o*c,v=o*l,m=a*l,g=s*u,y=s*c,_=s*l,x=r[0],b=r[1],w=r[2];return t[0]=(1-(d+m))*x,t[1]=(f+_)*x,t[2]=(p-y)*x,t[3]=0,t[4]=(f-_)*b,t[5]=(1-(h+m))*b,t[6]=(v+g)*b,t[7]=0,t[8]=(p+y)*w,t[9]=(v-g)*w,t[10]=(1-(h+d))*w,t[11]=0,t[12]=n[0],t[13]=n[1],t[14]=n[2],t[15]=1,t}function Fl(t,e,n,r,i){var o=e[0],a=e[1],s=e[2],u=e[3],c=o+o,l=a+a,h=s+s,f=o*c,p=o*l,d=o*h,v=a*l,m=a*h,g=s*h,y=u*c,_=u*l,x=u*h,b=r[0],w=r[1],E=r[2],S=i[0],A=i[1],T=i[2],C=(1-(v+g))*b,k=(p+x)*b,M=(d-_)*b,P=(p-x)*w,I=(1-(f+g))*w,R=(m+y)*w,L=(d+_)*E,O=(m-y)*E,D=(1-(f+v))*E;return t[0]=C,t[1]=k,t[2]=M,t[3]=0,t[4]=P,t[5]=I,t[6]=R,t[7]=0,t[8]=L,t[9]=O,t[10]=D,t[11]=0,t[12]=n[0]+S-(C*S+P*A+L*T),t[13]=n[1]+A-(k*S+I*A+O*T),t[14]=n[2]+T-(M*S+R*A+D*T),t[15]=1,t}function Bl(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=n+n,s=r+r,u=i+i,c=n*a,l=r*a,h=r*s,f=i*a,p=i*s,d=i*u,v=o*a,m=o*s,g=o*u;return t[0]=1-h-d,t[1]=l+g,t[2]=f-m,t[3]=0,t[4]=l-g,t[5]=1-c-d,t[6]=p+v,t[7]=0,t[8]=f+m,t[9]=p-v,t[10]=1-c-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Ul(t,e,n,r,i,o,a){var s=1/(n-e),u=1/(i-r),c=1/(o-a);return t[0]=2*o*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=2*o*u,t[6]=0,t[7]=0,t[8]=(n+e)*s,t[9]=(i+r)*u,t[10]=(a+o)*c,t[11]=-1,t[12]=0,t[13]=0,t[14]=a*o*2*c,t[15]=0,t}function jl(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=(i+r)*o,t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t}var Zl=jl;function Vl(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(o=1/(r-i),t[10]=i*o,t[14]=i*r*o):(t[10]=-1,t[14]=-r),t}function Gl(t,e,n,r){var i=Math.tan(e.upDegrees*Math.PI/180),o=Math.tan(e.downDegrees*Math.PI/180),a=Math.tan(e.leftDegrees*Math.PI/180),s=Math.tan(e.rightDegrees*Math.PI/180),u=2/(a+s),c=2/(i+o);return t[0]=u,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=c,t[6]=0,t[7]=0,t[8]=-(a-s)*u*.5,t[9]=(i-o)*c*.5,t[10]=r/(n-r),t[11]=-1,t[12]=0,t[13]=0,t[14]=r*n/(n-r),t[15]=0,t}function Hl(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*c,t[15]=1,t}var Wl=Hl;function ql(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=o*c,t[15]=1,t}function Xl(t,e,n,r){var i,o,a,s,u,c,l,h,f,p,d=e[0],v=e[1],m=e[2],g=r[0],y=r[1],_=r[2],x=n[0],b=n[1],w=n[2];return Math.abs(d-x)<iu&&Math.abs(v-b)<iu&&Math.abs(m-w)<iu?dl(t):(l=d-x,h=v-b,f=m-w,p=1/Math.hypot(l,h,f),l*=p,h*=p,f*=p,i=y*f-_*h,o=_*l-g*f,a=g*h-y*l,p=Math.hypot(i,o,a),p?(p=1/p,i*=p,o*=p,a*=p):(i=0,o=0,a=0),s=h*a-f*o,u=f*i-l*a,c=l*o-h*i,p=Math.hypot(s,u,c),p?(p=1/p,s*=p,u*=p,c*=p):(s=0,u=0,c=0),t[0]=i,t[1]=s,t[2]=l,t[3]=0,t[4]=o,t[5]=u,t[6]=h,t[7]=0,t[8]=a,t[9]=c,t[10]=f,t[11]=0,t[12]=-(i*d+o*v+a*m),t[13]=-(s*d+u*v+c*m),t[14]=-(l*d+h*v+f*m),t[15]=1,t)}function Yl(t,e,n,r){var i=e[0],o=e[1],a=e[2],s=r[0],u=r[1],c=r[2],l=i-n[0],h=o-n[1],f=a-n[2],p=l*l+h*h+f*f;p>0&&(p=1/Math.sqrt(p),l*=p,h*=p,f*=p);var d=u*f-c*h,v=c*l-s*f,m=s*h-u*l;return p=d*d+v*v+m*m,p>0&&(p=1/Math.sqrt(p),d*=p,v*=p,m*=p),t[0]=d,t[1]=v,t[2]=m,t[3]=0,t[4]=h*m-f*v,t[5]=f*d-l*m,t[6]=l*v-h*d,t[7]=0,t[8]=l,t[9]=h,t[10]=f,t[11]=0,t[12]=i,t[13]=o,t[14]=a,t[15]=1,t}function Kl(t){return"mat4("+t[0]+", "+t[1]+", "+t[2]+", "+t[3]+", "+t[4]+", "+t[5]+", "+t[6]+", "+t[7]+", "+t[8]+", "+t[9]+", "+t[10]+", "+t[11]+", "+t[12]+", "+t[13]+", "+t[14]+", "+t[15]+")"}function Ql(t){return Math.hypot(t[0],t[1],t[2],t[3],t[4],t[5],t[6],t[7],t[8],t[9],t[10],t[11],t[12],t[13],t[14],t[15])}function Jl(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t[3]=e[3]+n[3],t[4]=e[4]+n[4],t[5]=e[5]+n[5],t[6]=e[6]+n[6],t[7]=e[7]+n[7],t[8]=e[8]+n[8],t[9]=e[9]+n[9],t[10]=e[10]+n[10],t[11]=e[11]+n[11],t[12]=e[12]+n[12],t[13]=e[13]+n[13],t[14]=e[14]+n[14],t[15]=e[15]+n[15],t}function $l(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t[3]=e[3]-n[3],t[4]=e[4]-n[4],t[5]=e[5]-n[5],t[6]=e[6]-n[6],t[7]=e[7]-n[7],t[8]=e[8]-n[8],t[9]=e[9]-n[9],t[10]=e[10]-n[10],t[11]=e[11]-n[11],t[12]=e[12]-n[12],t[13]=e[13]-n[13],t[14]=e[14]-n[14],t[15]=e[15]-n[15],t}function th(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t[4]=e[4]*n,t[5]=e[5]*n,t[6]=e[6]*n,t[7]=e[7]*n,t[8]=e[8]*n,t[9]=e[9]*n,t[10]=e[10]*n,t[11]=e[11]*n,t[12]=e[12]*n,t[13]=e[13]*n,t[14]=e[14]*n,t[15]=e[15]*n,t}function eh(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t[3]=e[3]+n[3]*r,t[4]=e[4]+n[4]*r,t[5]=e[5]+n[5]*r,t[6]=e[6]+n[6]*r,t[7]=e[7]+n[7]*r,t[8]=e[8]+n[8]*r,t[9]=e[9]+n[9]*r,t[10]=e[10]+n[10]*r,t[11]=e[11]+n[11]*r,t[12]=e[12]+n[12]*r,t[13]=e[13]+n[13]*r,t[14]=e[14]+n[14]*r,t[15]=e[15]+n[15]*r,t}function nh(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]&&t[4]===e[4]&&t[5]===e[5]&&t[6]===e[6]&&t[7]===e[7]&&t[8]===e[8]&&t[9]===e[9]&&t[10]===e[10]&&t[11]===e[11]&&t[12]===e[12]&&t[13]===e[13]&&t[14]===e[14]&&t[15]===e[15]}function rh(t,e){var n=t[0],r=t[1],i=t[2],o=t[3],a=t[4],s=t[5],u=t[6],c=t[7],l=t[8],h=t[9],f=t[10],p=t[11],d=t[12],v=t[13],m=t[14],g=t[15],y=e[0],_=e[1],x=e[2],b=e[3],w=e[4],E=e[5],S=e[6],A=e[7],T=e[8],C=e[9],k=e[10],M=e[11],P=e[12],I=e[13],R=e[14],L=e[15];return Math.abs(n-y)<=iu*Math.max(1,Math.abs(n),Math.abs(y))&&Math.abs(r-_)<=iu*Math.max(1,Math.abs(r),Math.abs(_))&&Math.abs(i-x)<=iu*Math.max(1,Math.abs(i),Math.abs(x))&&Math.abs(o-b)<=iu*Math.max(1,Math.abs(o),Math.abs(b))&&Math.abs(a-w)<=iu*Math.max(1,Math.abs(a),Math.abs(w))&&Math.abs(s-E)<=iu*Math.max(1,Math.abs(s),Math.abs(E))&&Math.abs(u-S)<=iu*Math.max(1,Math.abs(u),Math.abs(S))&&Math.abs(c-A)<=iu*Math.max(1,Math.abs(c),Math.abs(A))&&Math.abs(l-T)<=iu*Math.max(1,Math.abs(l),Math.abs(T))&&Math.abs(h-C)<=iu*Math.max(1,Math.abs(h),Math.abs(C))&&Math.abs(f-k)<=iu*Math.max(1,Math.abs(f),Math.abs(k))&&Math.abs(p-M)<=iu*Math.max(1,Math.abs(p),Math.abs(M))&&Math.abs(d-P)<=iu*Math.max(1,Math.abs(d),Math.abs(P))&&Math.abs(v-I)<=iu*Math.max(1,Math.abs(v),Math.abs(I))&&Math.abs(m-R)<=iu*Math.max(1,Math.abs(m),Math.abs(R))&&Math.abs(g-L)<=iu*Math.max(1,Math.abs(g),Math.abs(L))}var ih,oh,ah,sh,uh,ch=_l,lh=$l,hh=(ih=(0,xc.b2)(),ih(oh=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"viewport",void 0),(0,Ft.Z)(this,"overridedViewProjectionMatrix",void 0),(0,Ft.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,Ft.Z)(this,"jitteredProjectionMatrix",void 0),(0,Ft.Z)(this,"viewMatrixInverse",void 0),(0,Ft.Z)(this,"cameraPosition",void 0)}return zt(t,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=cl(),ml(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),e=(0,Li.Z)(t,2),n=e[0],r=e[1];return[n,r]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,e){var n=Tl(cl(),[t,e,0]);this.jitteredProjectionMatrix=_l(cl(),n,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=_l(cl(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),t}())||oh);function fh(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=ph(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ph(t,e){if(t){if("string"===typeof t)return dh(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dh(t,e):void 0}}function dh(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}(function(t){t["TOPRIGHT"]="topright",t["TOPLEFT"]="topleft",t["BOTTOMRIGHT"]="bottomright",t["BOTTOMLEFT"]="bottomleft",t["TOPCENTER"]="topcenter",t["BOTTOMCENTER"]="bottomcenter",t["LEFTCENTER"]="leftcenter",t["RIGHTCENTER"]="rightcenter",t["LEFTTOP"]="lefttop",t["RIGHTTOP"]="righttop",t["LEFTBOTTOM"]="leftbottom",t["RIGHTBOTTOM"]="rightbottom"})(ah||(ah={}));var vh,mh,gh,yh,_h,xh,bh,wh,Eh={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Sh=(sh=(0,xc.b2)(),sh(uh=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"container",void 0),(0,Ft.Z)(this,"controlCorners",void 0),(0,Ft.Z)(this,"controlContainer",void 0),(0,Ft.Z)(this,"scene",void 0),(0,Ft.Z)(this,"mapsService",void 0),(0,Ft.Z)(this,"controls",[]),(0,Ft.Z)(this,"unAddControls",[])}return zt(t,[{key:"init",value:function(t,e){this.container=t.container,this.scene=e,this.mapsService=e.get(wc.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,e){var n=e.get(wc.IMapService);n.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find((function(e){return e.controlOption.name===t}))}},{key:"removeControl",value:function(t){var e=this.controls.indexOf(t);return e>-1&&this.controls.splice(e,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach((function(e){e.addTo(t.scene),t.controls.push(e)})),this.unAddControls=[]}},{key:"destroy",value:function(){var t,e=fh(this.controls);try{for(e.s();!(t=e.n()).done;){var n=t.value;n.remove()}}catch(r){e.e(r)}finally{e.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},e="l7-",n=this.controlContainer=Bi("div",e+"control-container",this.container);function r(){var r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],i=r.map((function(t){return e+t})).join(" ");t[r.filter((function(t){return!["row","column"].includes(t)})).join("")]=Bi("div",i,n)}function i(t){var e=t.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,C.Z)(e),[Eh[t]])}Object.values(ah).forEach((function(t){r(i(t))})),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Ui(this.controlCorners[t]);this.controlContainer&&Ui(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var t=this,e=window.MutationObserver;if(e)for(var n=function(){var n=i[r],o=n.match(/^(top|bottom)(left|right)$/);if(o){var a=(0,Li.Z)(o,3),s=a[1],u=a[2],c=t.controlCorners["".concat(s).concat(u)],l=new e((function(t){var e=(0,Li.Z)(t,1),n=e[0].target;c&&(c.style[s]=n.clientHeight+"px")}));l.observe(t.controlCorners["".concat(u).concat(s)],{childList:!0,attributes:!0})}},r=0,i=Object.keys(this.controlCorners);r<i.length;r++)n()}}]),t}())||uh),Ah=(vh=(0,xc.b2)(),vh(mh=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"container",void 0),(0,Ft.Z)(this,"scene",void 0),(0,Ft.Z)(this,"mapsService",void 0),(0,Ft.Z)(this,"markers",[]),(0,Ft.Z)(this,"markerLayers",[]),(0,Ft.Z)(this,"unAddMarkers",[]),(0,Ft.Z)(this,"unAddMarkerLayers",[])}return zt(t,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var e=this.markerLayers.indexOf(t);e>-1&&this.markerLayers.splice(e,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach((function(e){e.addTo(t.scene),t.markers.push(e)})),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach((function(e){t.markerLayers.push(e),e.addTo(t.scene)})),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(wc.IMapService)}},{key:"destroy",value:function(){this.markers.forEach((function(t){t.remove()})),this.markers=[],this.markerLayers.forEach((function(t){t.destroy()})),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),t}())||mh),Th=(gh=(0,xc.b2)(),gh(yh=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"scene",void 0),(0,Ft.Z)(this,"mapsService",void 0),(0,Ft.Z)(this,"popups",[]),(0,Ft.Z)(this,"unAddPopups",[])}return zt(t,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){null!==t&&void 0!==t&&t.isOpen()&&t.remove();var e=this.popups.indexOf(t);e>-1&&this.popups.splice(e,1);var n=this.unAddPopups.indexOf(t);n>-1&&this.unAddPopups.splice(n,1)}},{key:"destroy",value:function(){this.popups.forEach((function(t){return t.remove()}))}},{key:"addPopup",value:function(t){var e=this;t&&t.getOptions().autoClose&&[].concat((0,C.Z)(this.popups),(0,C.Z)(this.unAddPopups)).forEach((function(t){t.getOptions().autoClose&&e.removePopup(t)})),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",(function(){e.removePopup(t)}))}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach((function(e){t.addPopup(e),t.unAddPopups=[]}))}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(wc.IMapService)}}]),t}())||yh);(function(t){t["normal"]="normal",t["additive"]="additive",t["subtractive"]="subtractive",t["min"]="min",t["max"]="max",t["none"]="none"})(_h||(_h={})),function(t){t["MULTIPLE"]="MULTIPLE",t["SINGLE"]="SINGLE"}(xh||(xh={})),function(t){t["AND"]="and",t["OR"]="or"}(bh||(bh={})),function(t){t["INIT"]="init",t["UPDATE"]="update"}(wh||(wh={}));var Ch,kh,Mh={MapToken:"您正在使用 Demo 测试 Token, 生产环境务必自行注册 Token 确保服务稳定",SDK:"请确认引入了mapbox-gl api且在L7之前引入"},Ph=Mh,Ih={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,isMini:!1,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},Rh={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:bh.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},Lh=(Ch=(0,xc.b2)(),Ch(kh=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"sceneConfigCache",{}),(0,Ft.Z)(this,"layerConfigCache",{}),(0,Ft.Z)(this,"layerAttributeConfigCache",{})}return zt(t,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return Ph[t]}},{key:"setSceneConfig",value:function(t,e){this.sceneConfigCache[t]=(0,k.Z)((0,k.Z)({},Ih),e)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,e,n){this.layerConfigCache[e]=(0,k.Z)({},(0,Oi.merge)({},this.sceneConfigCache[t],Rh,n))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,e){this.layerAttributeConfigCache[t]=(0,k.Z)((0,k.Z)({},this.layerAttributeConfigCache[t]),e)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),t}())||kh);function Oh(t,e,n,r){n&&Object.defineProperty(t,e,{enumerable:n.enumerable,configurable:n.configurable,writable:n.writable,value:n.initializer?n.initializer.call(r):void 0})}n(65069);function Dh(t,e,n,r,i){var o={};return Object.keys(r).forEach((function(t){o[t]=r[t]})),o.enumerable=!!o.enumerable,o.configurable=!!o.configurable,("value"in o||o.initializer)&&(o.writable=!0),o=n.slice().reverse().reduce((function(n,r){return r(t,e,n)||n}),o),i&&void 0!==o.initializer&&(o.value=o.initializer?o.initializer.call(i):void 0,o.initializer=void 0),void 0===o.initializer&&(Object.defineProperty(t,e,o),o=null),o}function Nh(){var t=new ou(4);return ou!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0),t}function zh(t,e,n,r){var i=new ou(4);return i[0]=t,i[1]=e,i[2]=n,i[3]=r,i}function Fh(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t}function Bh(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}(function(){var t=Nh()})();var Uh,jh=Math.PI/180,Zh=512,Vh=4003e4;function Gh(t){var e=t.latitude,n=void 0===e?0:e,r=t.zoom,i=void 0===r?0:r,o=t.scale,a=t.highPrecision,s=void 0!==a&&a,u=t.flipY,c=void 0!==u&&u;o=void 0!==o?o:Math.pow(2,i);var l={},h=Zh*o,f=Math.cos(n*jh),p=h/360,d=p/f,v=h/Vh/f;if(l.pixelsPerMeter=[v,-v,v],l.metersPerPixel=[1/v,-1/v,1/v],l.pixelsPerDegree=[p,-d,v],l.degreesPerPixel=[1/p,-1/d,1/v],s){var m=jh*Math.tan(n*jh)/f,g=p*m/2,y=h/Vh*m,_=y/d*v;l.pixelsPerDegree2=[0,-g,y],l.pixelsPerMeter2=[_,0,_],c&&(l.pixelsPerDegree2[1]=-l.pixelsPerDegree2[1],l.pixelsPerMeter2[1]=-l.pixelsPerMeter2[1])}return c&&(l.pixelsPerMeter[1]=-l.pixelsPerMeter[1],l.metersPerPixel[1]=-l.metersPerPixel[1],l.pixelsPerDegree[1]=-l.pixelsPerDegree[1],l.degreesPerPixel[1]=-l.degreesPerPixel[1]),l}(function(t){t[t["LNGLAT"]=1]="LNGLAT",t[t["LNGLAT_OFFSET"]=2]="LNGLAT_OFFSET",t[t["VECTOR_TILE"]=3]="VECTOR_TILE",t[t["IDENTITY"]=4]="IDENTITY",t[t["P20"]=5]="P20",t[t["P20_OFFSET"]=6]="P20_OFFSET",t[t["METER_OFFSET"]=7]="METER_OFFSET",t[t["P20_2"]=8]="P20_2"})(Uh||(Uh={}));var Hh,Wh,qh,Xh,Yh,Kh,Qh,Jh={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},$h=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],tf=(Hh=(0,xc.b2)(),Wh=(0,xc.f3)(wc.ICameraService),Hh((Xh=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"needRefresh",!0),Oh(this,"cameraService",Yh,this),(0,Ft.Z)(this,"coordinateSystem",void 0),(0,Ft.Z)(this,"viewportCenter",void 0),(0,Ft.Z)(this,"viewportCenterProjection",void 0),(0,Ft.Z)(this,"pixelsPerDegree",void 0),(0,Ft.Z)(this,"pixelsPerDegree2",void 0),(0,Ft.Z)(this,"pixelsPerMeter",void 0)}return zt(t,[{key:"refresh",value:function(t){var e=this.cameraService.getZoom(),n=this.cameraService.getZoomScale(),r=t||this.cameraService.getCenter(),i=Gh({latitude:r[1],zoom:e}),o=i.pixelsPerMeter,a=i.pixelsPerDegree;this.viewportCenter=r,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===Uh.LNGLAT||this.coordinateSystem===Uh.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===Uh.LNGLAT_OFFSET?this.calculateLnglatOffset(r,e):this.coordinateSystem===Uh.P20_OFFSET&&this.calculateLnglatOffset(r,e,n,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,e,n,r){var i=Gh({latitude:t[1],zoom:e,scale:n,flipY:r,highPrecision:!0}),o=i.pixelsPerMeter,a=i.pixelsPerDegree,s=i.pixelsPerDegree2,u=this.cameraService.getViewMatrix(),c=this.cameraService.getProjectionMatrix(),l=_l([],c,u),h=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,e));this.viewportCenterProjection=Bh([],[h[0],h[1],0,1],l),u=this.cameraService.getViewMatrixUncentered()||u,l=_l([],c,u),l=_l([],l,$h),this.cameraService.setViewProjectionMatrix(l),this.pixelsPerMeter=o,this.pixelsPerDegree=a,this.pixelsPerDegree2=s}}]),t}(),Yh=Dh(Xh.prototype,"cameraService",[Wh],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qh=Xh))||qh);function ef(t){var e=nf();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function nf(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var rf,of,af,sf,uf,cf,lf=(Kh=(0,xc.b2)(),Kh(Qh=function(t){Yt(n,t);var e=ef(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"renderMap",new Map),(0,Ft.Z)(Kt(t),"enable",!1),(0,Ft.Z)(Kt(t),"renderEnable",!1),(0,Ft.Z)(Kt(t),"cacheLogs",{}),t}return zt(n,[{key:"setEnable",value:function(t){this.enable=!!t}},{key:"log",value:function(t,e){var n=this;if(this.enable){var r=t.split("."),i=null;r.forEach((function(t,o){null!==i?(i[t]||(i[t]={}),o!==r.length-1&&(i=i[t])):(n.cacheLogs[t]||(n.cacheLogs[t]={}),o!==r.length-1&&(i=n.cacheLogs[t])),o===r.length-1&&(i[t]=(0,k.Z)((0,k.Z)({time:Date.now()},i[t]),e))}))}}},{key:"getLog",value:function(t){var e=this;switch((0,I.Z)(t)){case"string":return this.cacheLogs[t];case"object":return t.map((function(t){return e.cacheLogs[t]})).filter((function(t){return void 0!==t}));case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(t){delete this.cacheLogs[t]}},{key:"generateRenderUid",value:function(){return this.renderEnable?ta():""}},{key:"renderDebug",value:function(t){this.renderEnable=t}},{key:"renderStart",value:function(t){if(this.renderEnable&&this.enable){var e=this.renderMap.get(t)||{};this.renderMap.set(t,(0,k.Z)((0,k.Z)({},e),{},{renderUid:t,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(t){if(this.renderEnable&&this.enable){var e=this.renderMap.get(t);if(e){var n=e.renderStart,r=Date.now();this.emit("renderEnd",(0,k.Z)((0,k.Z)({},e),{},{renderEnd:r,renderDuration:r-n})),this.renderMap.delete(t)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),n}(Ma.EventEmitter))||Qh),hf=n(23941),ff=n.n(hf);function pf(t){var e=df();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function df(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(function(t){t["Hover"]="hover",t["Click"]="click",t["Select"]="select",t["Active"]="active",t["Drag"]="drag"})(rf||(rf={}));var vf,mf,gf,yf,_f,xf,bf,wf,Ef,Sf,Af,Tf,Cf,kf,Mf={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},Pf=(of=(0,xc.b2)(),af=(0,xc.f3)(wc.IMapService),of((uf=function(t){Yt(n,t);var e=pf(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"indragging",!1),Oh(Kt(t),"mapService",cf,Kt(t)),(0,Ft.Z)(Kt(t),"hammertime",void 0),(0,Ft.Z)(Kt(t),"lastClickTime",0),(0,Ft.Z)(Kt(t),"lastClickXY",[-1,-1]),(0,Ft.Z)(Kt(t),"clickTimer",void 0),(0,Ft.Z)(Kt(t),"$containter",void 0),(0,Ft.Z)(Kt(t),"onDrag",(function(e){var n=t.interactionEvent(e);n.type=Mf[n.type],"dragging"===n.type?t.indragging=!0:t.indragging=!1,t.emit(rf.Drag,n)})),(0,Ft.Z)(Kt(t),"onHammer",(function(e){e.srcEvent.stopPropagation();var n=t.interactionEvent(e);t.emit(rf.Hover,n)})),(0,Ft.Z)(Kt(t),"onTouch",(function(e){var n=e.touches[0];t.onHover({x:n.pageX,y:n.pageY,type:"touch"})})),(0,Ft.Z)(Kt(t),"onHover",(function(e){var n=e.clientX,r=e.clientY,i=n,o=r,a=e.type,s=t.mapService.getMapContainer();if(s)if(yr)i=i-s.left-0,o=o-s.top-0;else{var u=s.getBoundingClientRect(),c=u.top,l=u.left;i=i-l-s.clientLeft,o=o-c-s.clientTop}var h=t.mapService.containerToLngLat([i,o]);if("click"!==a)"touch"!==a?"click"!==a&&"dblclick"!==a&&t.emit(rf.Hover,{x:i,y:o,lngLat:h,type:a,target:e}):t.isDoubleTap(i,o,h);else{if(!yr&&"ontouchstart"in document.documentElement===!0)return;t.isDoubleTap(i,o,h)}})),t}return zt(n,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(rf.Hover)}},{key:"triggerHover",value:function(t){var e=t.x,n=t.y;this.emit(rf.Hover,{x:e,y:n})}},{key:"triggerSelect",value:function(t){this.emit(rf.Select,{featureId:t})}},{key:"triggerActive",value:function(t){this.emit(rf.Active,{featureId:t})}},{key:"handleMiniEvent",value:function(t){this.onHover({clientX:t.touches[0].pageX,clientY:t.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var t=this.mapService.getMapContainer();if(t)if(yr)xr.document.addEventListener("touchstart",this.handleMiniEvent.bind(this));else{var e=new(ff().Manager)(t);e.add(new(ff().Tap)({event:"dblclick",taps:2})),e.add(new(ff().Tap)({event:"click"})),e.add(new(ff().Pan)({threshold:0,pointers:0})),e.add(new(ff().Press)({})),e.on("dblclick click",this.onHammer),e.on("panstart panmove panend pancancel",this.onDrag),t.addEventListener("mousemove",this.onHover),t.addEventListener("mousedown",this.onHover,!0),t.addEventListener("mouseup",this.onHover),t.addEventListener("contextmenu",this.onHover),this.hammertime=e}}},{key:"removeEventListenerOnMap",value:function(){if(yr)xr.document.removeEventListener("touchstart",this.handleMiniEvent.bind(this));else{var t=this.mapService.getMapContainer();t&&(t.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),t.removeEventListener("mousedown",this.onHover),t.removeEventListener("mouseup",this.onHover),t.removeEventListener("contextmenu",this.onHover))}}},{key:"interactionEvent",value:function(t){var e,n,r=t.type,i=t.pointerType;"touch"===i?(n=Math.floor(t.pointers[0].clientY),e=Math.floor(t.pointers[0].clientX)):(n=Math.floor(t.srcEvent.y),e=Math.floor(t.srcEvent.x));var o=this.mapService.getMapContainer();if(o){var a=o.getBoundingClientRect(),s=a.top,u=a.left;e-=u,n-=s}var c=this.mapService.containerToLngLat([e,n]);return{x:e,y:n,lngLat:c,type:r,target:t.srcEvent}}},{key:"isDoubleTap",value:function(t,e,n){var r=this,i=(new Date).getTime(),o="click";i-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-t)<10&&Math.abs(this.lastClickXY[1]-e)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),o="dblclick",this.emit(rf.Hover,{x:t,y:e,lngLat:n,type:o})):(this.lastClickTime=i,this.lastClickXY=[t,e],this.clickTimer=setTimeout((function(){o="click",r.emit(rf.Hover,{x:t,y:e,lngLat:n,type:o})}),400))}}]),n}(Pa()),cf=Dh(uf.prototype,"mapService",[af],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sf=uf))||sf),If=0;function Rf(t){if(yr)return null;var e=t;if("string"===typeof t&&(e=document.getElementById(t)),e){var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      z-index:2;\n      height: 100%;\n      width: 100%;\n      pointer-events: none;\n    ",n.id="l7-scene-".concat(If++),n.classList.add("l7-scene"),e.appendChild(n),n}return null}function Lf(t){var e,n=!0;if((null===t||void 0===t||null===(e=t.target)||void 0===e?void 0:e.target)instanceof HTMLElement){var r,i=null===t||void 0===t||null===(r=t.target)||void 0===r?void 0:r.target;while(i){var o,a=Array.from(i.classList);if(a.includes("l7-marker")||a.includes("l7-popup")){n=!1;break}i=null===(o=i)||void 0===o?void 0:o.parentElement}}return n}(function(t){t[t["DEPTH_BUFFER_BIT"]=256]="DEPTH_BUFFER_BIT",t[t["STENCIL_BUFFER_BIT"]=1024]="STENCIL_BUFFER_BIT",t[t["COLOR_BUFFER_BIT"]=16384]="COLOR_BUFFER_BIT",t[t["POINTS"]=0]="POINTS",t[t["LINES"]=1]="LINES",t[t["LINE_LOOP"]=2]="LINE_LOOP",t[t["LINE_STRIP"]=3]="LINE_STRIP",t[t["TRIANGLES"]=4]="TRIANGLES",t[t["TRIANGLE_STRIP"]=5]="TRIANGLE_STRIP",t[t["TRIANGLE_FAN"]=6]="TRIANGLE_FAN",t[t["ZERO"]=0]="ZERO",t[t["ONE"]=1]="ONE",t[t["SRC_COLOR"]=768]="SRC_COLOR",t[t["ONE_MINUS_SRC_COLOR"]=769]="ONE_MINUS_SRC_COLOR",t[t["SRC_ALPHA"]=770]="SRC_ALPHA",t[t["ONE_MINUS_SRC_ALPHA"]=771]="ONE_MINUS_SRC_ALPHA",t[t["DST_ALPHA"]=772]="DST_ALPHA",t[t["ONE_MINUS_DST_ALPHA"]=773]="ONE_MINUS_DST_ALPHA",t[t["DST_COLOR"]=774]="DST_COLOR",t[t["ONE_MINUS_DST_COLOR"]=775]="ONE_MINUS_DST_COLOR",t[t["SRC_ALPHA_SATURATE"]=776]="SRC_ALPHA_SATURATE",t[t["FUNC_ADD"]=32774]="FUNC_ADD",t[t["BLEND_EQUATION"]=32777]="BLEND_EQUATION",t[t["BLEND_EQUATION_RGB"]=32777]="BLEND_EQUATION_RGB",t[t["BLEND_EQUATION_ALPHA"]=34877]="BLEND_EQUATION_ALPHA",t[t["FUNC_SUBTRACT"]=32778]="FUNC_SUBTRACT",t[t["FUNC_REVERSE_SUBTRACT"]=32779]="FUNC_REVERSE_SUBTRACT",t[t["MAX_EXT"]=32776]="MAX_EXT",t[t["MIN_EXT"]=32775]="MIN_EXT",t[t["BLEND_DST_RGB"]=32968]="BLEND_DST_RGB",t[t["BLEND_SRC_RGB"]=32969]="BLEND_SRC_RGB",t[t["BLEND_DST_ALPHA"]=32970]="BLEND_DST_ALPHA",t[t["BLEND_SRC_ALPHA"]=32971]="BLEND_SRC_ALPHA",t[t["CONSTANT_COLOR"]=32769]="CONSTANT_COLOR",t[t["ONE_MINUS_CONSTANT_COLOR"]=32770]="ONE_MINUS_CONSTANT_COLOR",t[t["CONSTANT_ALPHA"]=32771]="CONSTANT_ALPHA",t[t["ONE_MINUS_CONSTANT_ALPHA"]=32772]="ONE_MINUS_CONSTANT_ALPHA",t[t["BLEND_COLOR"]=32773]="BLEND_COLOR",t[t["ARRAY_BUFFER"]=34962]="ARRAY_BUFFER",t[t["ELEMENT_ARRAY_BUFFER"]=34963]="ELEMENT_ARRAY_BUFFER",t[t["ARRAY_BUFFER_BINDING"]=34964]="ARRAY_BUFFER_BINDING",t[t["ELEMENT_ARRAY_BUFFER_BINDING"]=34965]="ELEMENT_ARRAY_BUFFER_BINDING",t[t["STREAM_DRAW"]=35040]="STREAM_DRAW",t[t["STATIC_DRAW"]=35044]="STATIC_DRAW",t[t["DYNAMIC_DRAW"]=35048]="DYNAMIC_DRAW",t[t["BUFFER_SIZE"]=34660]="BUFFER_SIZE",t[t["BUFFER_USAGE"]=34661]="BUFFER_USAGE",t[t["CURRENT_VERTEX_ATTRIB"]=34342]="CURRENT_VERTEX_ATTRIB",t[t["FRONT"]=1028]="FRONT",t[t["BACK"]=1029]="BACK",t[t["FRONT_AND_BACK"]=1032]="FRONT_AND_BACK",t[t["CULL_FACE"]=2884]="CULL_FACE",t[t["BLEND"]=3042]="BLEND",t[t["DITHER"]=3024]="DITHER",t[t["STENCIL_TEST"]=2960]="STENCIL_TEST",t[t["DEPTH_TEST"]=2929]="DEPTH_TEST",t[t["SCISSOR_TEST"]=3089]="SCISSOR_TEST",t[t["POLYGON_OFFSET_FILL"]=32823]="POLYGON_OFFSET_FILL",t[t["SAMPLE_ALPHA_TO_COVERAGE"]=32926]="SAMPLE_ALPHA_TO_COVERAGE",t[t["SAMPLE_COVERAGE"]=32928]="SAMPLE_COVERAGE",t[t["NO_ERROR"]=0]="NO_ERROR",t[t["INVALID_ENUM"]=1280]="INVALID_ENUM",t[t["INVALID_VALUE"]=1281]="INVALID_VALUE",t[t["INVALID_OPERATION"]=1282]="INVALID_OPERATION",t[t["OUT_OF_MEMORY"]=1285]="OUT_OF_MEMORY",t[t["CW"]=2304]="CW",t[t["CCW"]=2305]="CCW",t[t["LINE_WIDTH"]=2849]="LINE_WIDTH",t[t["ALIASED_POINT_SIZE_RANGE"]=33901]="ALIASED_POINT_SIZE_RANGE",t[t["ALIASED_LINE_WIDTH_RANGE"]=33902]="ALIASED_LINE_WIDTH_RANGE",t[t["CULL_FACE_MODE"]=2885]="CULL_FACE_MODE",t[t["FRONT_FACE"]=2886]="FRONT_FACE",t[t["DEPTH_RANGE"]=2928]="DEPTH_RANGE",t[t["DEPTH_WRITEMASK"]=2930]="DEPTH_WRITEMASK",t[t["DEPTH_CLEAR_VALUE"]=2931]="DEPTH_CLEAR_VALUE",t[t["DEPTH_FUNC"]=2932]="DEPTH_FUNC",t[t["STENCIL_CLEAR_VALUE"]=2961]="STENCIL_CLEAR_VALUE",t[t["STENCIL_FUNC"]=2962]="STENCIL_FUNC",t[t["STENCIL_FAIL"]=2964]="STENCIL_FAIL",t[t["STENCIL_PASS_DEPTH_FAIL"]=2965]="STENCIL_PASS_DEPTH_FAIL",t[t["STENCIL_PASS_DEPTH_PASS"]=2966]="STENCIL_PASS_DEPTH_PASS",t[t["STENCIL_REF"]=2967]="STENCIL_REF",t[t["STENCIL_VALUE_MASK"]=2963]="STENCIL_VALUE_MASK",t[t["STENCIL_WRITEMASK"]=2968]="STENCIL_WRITEMASK",t[t["STENCIL_BACK_FUNC"]=34816]="STENCIL_BACK_FUNC",t[t["STENCIL_BACK_FAIL"]=34817]="STENCIL_BACK_FAIL",t[t["STENCIL_BACK_PASS_DEPTH_FAIL"]=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",t[t["STENCIL_BACK_PASS_DEPTH_PASS"]=34819]="STENCIL_BACK_PASS_DEPTH_PASS",t[t["STENCIL_BACK_REF"]=36003]="STENCIL_BACK_REF",t[t["STENCIL_BACK_VALUE_MASK"]=36004]="STENCIL_BACK_VALUE_MASK",t[t["STENCIL_BACK_WRITEMASK"]=36005]="STENCIL_BACK_WRITEMASK",t[t["VIEWPORT"]=2978]="VIEWPORT",t[t["SCISSOR_BOX"]=3088]="SCISSOR_BOX",t[t["COLOR_CLEAR_VALUE"]=3106]="COLOR_CLEAR_VALUE",t[t["COLOR_WRITEMASK"]=3107]="COLOR_WRITEMASK",t[t["UNPACK_ALIGNMENT"]=3317]="UNPACK_ALIGNMENT",t[t["PACK_ALIGNMENT"]=3333]="PACK_ALIGNMENT",t[t["MAX_TEXTURE_SIZE"]=3379]="MAX_TEXTURE_SIZE",t[t["MAX_VIEWPORT_DIMS"]=3386]="MAX_VIEWPORT_DIMS",t[t["SUBPIXEL_BITS"]=3408]="SUBPIXEL_BITS",t[t["RED_BITS"]=3410]="RED_BITS",t[t["GREEN_BITS"]=3411]="GREEN_BITS",t[t["BLUE_BITS"]=3412]="BLUE_BITS",t[t["ALPHA_BITS"]=3413]="ALPHA_BITS",t[t["DEPTH_BITS"]=3414]="DEPTH_BITS",t[t["STENCIL_BITS"]=3415]="STENCIL_BITS",t[t["POLYGON_OFFSET_UNITS"]=10752]="POLYGON_OFFSET_UNITS",t[t["POLYGON_OFFSET_FACTOR"]=32824]="POLYGON_OFFSET_FACTOR",t[t["TEXTURE_BINDING_2D"]=32873]="TEXTURE_BINDING_2D",t[t["SAMPLE_BUFFERS"]=32936]="SAMPLE_BUFFERS",t[t["SAMPLES"]=32937]="SAMPLES",t[t["SAMPLE_COVERAGE_VALUE"]=32938]="SAMPLE_COVERAGE_VALUE",t[t["SAMPLE_COVERAGE_INVERT"]=32939]="SAMPLE_COVERAGE_INVERT",t[t["COMPRESSED_TEXTURE_FORMATS"]=34467]="COMPRESSED_TEXTURE_FORMATS",t[t["DONT_CARE"]=4352]="DONT_CARE",t[t["FASTEST"]=4353]="FASTEST",t[t["NICEST"]=4354]="NICEST",t[t["GENERATE_MIPMAP_HINT"]=33170]="GENERATE_MIPMAP_HINT",t[t["BYTE"]=5120]="BYTE",t[t["UNSIGNED_BYTE"]=5121]="UNSIGNED_BYTE",t[t["SHORT"]=5122]="SHORT",t[t["UNSIGNED_SHORT"]=5123]="UNSIGNED_SHORT",t[t["INT"]=5124]="INT",t[t["UNSIGNED_INT"]=5125]="UNSIGNED_INT",t[t["FLOAT"]=5126]="FLOAT",t[t["DEPTH_COMPONENT"]=6402]="DEPTH_COMPONENT",t[t["ALPHA"]=6406]="ALPHA",t[t["RGB"]=6407]="RGB",t[t["RGBA"]=6408]="RGBA",t[t["LUMINANCE"]=6409]="LUMINANCE",t[t["LUMINANCE_ALPHA"]=6410]="LUMINANCE_ALPHA",t[t["UNSIGNED_SHORT_4_4_4_4"]=32819]="UNSIGNED_SHORT_4_4_4_4",t[t["UNSIGNED_SHORT_5_5_5_1"]=32820]="UNSIGNED_SHORT_5_5_5_1",t[t["UNSIGNED_SHORT_5_6_5"]=33635]="UNSIGNED_SHORT_5_6_5",t[t["FRAGMENT_SHADER"]=35632]="FRAGMENT_SHADER",t[t["VERTEX_SHADER"]=35633]="VERTEX_SHADER",t[t["MAX_VERTEX_ATTRIBS"]=34921]="MAX_VERTEX_ATTRIBS",t[t["MAX_VERTEX_UNIFORM_VECTORS"]=36347]="MAX_VERTEX_UNIFORM_VECTORS",t[t["MAX_VARYING_VECTORS"]=36348]="MAX_VARYING_VECTORS",t[t["MAX_COMBINED_TEXTURE_IMAGE_UNITS"]=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",t[t["MAX_VERTEX_TEXTURE_IMAGE_UNITS"]=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",t[t["MAX_TEXTURE_IMAGE_UNITS"]=34930]="MAX_TEXTURE_IMAGE_UNITS",t[t["MAX_FRAGMENT_UNIFORM_VECTORS"]=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",t[t["SHADER_TYPE"]=35663]="SHADER_TYPE",t[t["DELETE_STATUS"]=35712]="DELETE_STATUS",t[t["LINK_STATUS"]=35714]="LINK_STATUS",t[t["VALIDATE_STATUS"]=35715]="VALIDATE_STATUS",t[t["ATTACHED_SHADERS"]=35717]="ATTACHED_SHADERS",t[t["ACTIVE_UNIFORMS"]=35718]="ACTIVE_UNIFORMS",t[t["ACTIVE_ATTRIBUTES"]=35721]="ACTIVE_ATTRIBUTES",t[t["SHADING_LANGUAGE_VERSION"]=35724]="SHADING_LANGUAGE_VERSION",t[t["CURRENT_PROGRAM"]=35725]="CURRENT_PROGRAM",t[t["NEVER"]=512]="NEVER",t[t["LESS"]=513]="LESS",t[t["EQUAL"]=514]="EQUAL",t[t["LEQUAL"]=515]="LEQUAL",t[t["GREATER"]=516]="GREATER",t[t["NOTEQUAL"]=517]="NOTEQUAL",t[t["GEQUAL"]=518]="GEQUAL",t[t["ALWAYS"]=519]="ALWAYS",t[t["KEEP"]=7680]="KEEP",t[t["REPLACE"]=7681]="REPLACE",t[t["INCR"]=7682]="INCR",t[t["DECR"]=7683]="DECR",t[t["INVERT"]=5386]="INVERT",t[t["INCR_WRAP"]=34055]="INCR_WRAP",t[t["DECR_WRAP"]=34056]="DECR_WRAP",t[t["VENDOR"]=7936]="VENDOR",t[t["RENDERER"]=7937]="RENDERER",t[t["VERSION"]=7938]="VERSION",t[t["NEAREST"]=9728]="NEAREST",t[t["LINEAR"]=9729]="LINEAR",t[t["NEAREST_MIPMAP_NEAREST"]=9984]="NEAREST_MIPMAP_NEAREST",t[t["LINEAR_MIPMAP_NEAREST"]=9985]="LINEAR_MIPMAP_NEAREST",t[t["NEAREST_MIPMAP_LINEAR"]=9986]="NEAREST_MIPMAP_LINEAR",t[t["LINEAR_MIPMAP_LINEAR"]=9987]="LINEAR_MIPMAP_LINEAR",t[t["TEXTURE_MAG_FILTER"]=10240]="TEXTURE_MAG_FILTER",t[t["TEXTURE_MIN_FILTER"]=10241]="TEXTURE_MIN_FILTER",t[t["TEXTURE_WRAP_S"]=10242]="TEXTURE_WRAP_S",t[t["TEXTURE_WRAP_T"]=10243]="TEXTURE_WRAP_T",t[t["TEXTURE_2D"]=3553]="TEXTURE_2D",t[t["TEXTURE"]=5890]="TEXTURE",t[t["TEXTURE_CUBE_MAP"]=34067]="TEXTURE_CUBE_MAP",t[t["TEXTURE_BINDING_CUBE_MAP"]=34068]="TEXTURE_BINDING_CUBE_MAP",t[t["TEXTURE_CUBE_MAP_POSITIVE_X"]=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",t[t["TEXTURE_CUBE_MAP_NEGATIVE_X"]=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",t[t["TEXTURE_CUBE_MAP_POSITIVE_Y"]=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",t[t["TEXTURE_CUBE_MAP_NEGATIVE_Y"]=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",t[t["TEXTURE_CUBE_MAP_POSITIVE_Z"]=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",t[t["TEXTURE_CUBE_MAP_NEGATIVE_Z"]=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",t[t["MAX_CUBE_MAP_TEXTURE_SIZE"]=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",t[t["TEXTURE0"]=33984]="TEXTURE0",t[t["TEXTURE1"]=33985]="TEXTURE1",t[t["TEXTURE2"]=33986]="TEXTURE2",t[t["TEXTURE3"]=33987]="TEXTURE3",t[t["TEXTURE4"]=33988]="TEXTURE4",t[t["TEXTURE5"]=33989]="TEXTURE5",t[t["TEXTURE6"]=33990]="TEXTURE6",t[t["TEXTURE7"]=33991]="TEXTURE7",t[t["TEXTURE8"]=33992]="TEXTURE8",t[t["TEXTURE9"]=33993]="TEXTURE9",t[t["TEXTURE10"]=33994]="TEXTURE10",t[t["TEXTURE11"]=33995]="TEXTURE11",t[t["TEXTURE12"]=33996]="TEXTURE12",t[t["TEXTURE13"]=33997]="TEXTURE13",t[t["TEXTURE14"]=33998]="TEXTURE14",t[t["TEXTURE15"]=33999]="TEXTURE15",t[t["TEXTURE16"]=34e3]="TEXTURE16",t[t["TEXTURE17"]=34001]="TEXTURE17",t[t["TEXTURE18"]=34002]="TEXTURE18",t[t["TEXTURE19"]=34003]="TEXTURE19",t[t["TEXTURE20"]=34004]="TEXTURE20",t[t["TEXTURE21"]=34005]="TEXTURE21",t[t["TEXTURE22"]=34006]="TEXTURE22",t[t["TEXTURE23"]=34007]="TEXTURE23",t[t["TEXTURE24"]=34008]="TEXTURE24",t[t["TEXTURE25"]=34009]="TEXTURE25",t[t["TEXTURE26"]=34010]="TEXTURE26",t[t["TEXTURE27"]=34011]="TEXTURE27",t[t["TEXTURE28"]=34012]="TEXTURE28",t[t["TEXTURE29"]=34013]="TEXTURE29",t[t["TEXTURE30"]=34014]="TEXTURE30",t[t["TEXTURE31"]=34015]="TEXTURE31",t[t["ACTIVE_TEXTURE"]=34016]="ACTIVE_TEXTURE",t[t["REPEAT"]=10497]="REPEAT",t[t["CLAMP_TO_EDGE"]=33071]="CLAMP_TO_EDGE",t[t["MIRRORED_REPEAT"]=33648]="MIRRORED_REPEAT",t[t["FLOAT_VEC2"]=35664]="FLOAT_VEC2",t[t["FLOAT_VEC3"]=35665]="FLOAT_VEC3",t[t["FLOAT_VEC4"]=35666]="FLOAT_VEC4",t[t["INT_VEC2"]=35667]="INT_VEC2",t[t["INT_VEC3"]=35668]="INT_VEC3",t[t["INT_VEC4"]=35669]="INT_VEC4",t[t["BOOL"]=35670]="BOOL",t[t["BOOL_VEC2"]=35671]="BOOL_VEC2",t[t["BOOL_VEC3"]=35672]="BOOL_VEC3",t[t["BOOL_VEC4"]=35673]="BOOL_VEC4",t[t["FLOAT_MAT2"]=35674]="FLOAT_MAT2",t[t["FLOAT_MAT3"]=35675]="FLOAT_MAT3",t[t["FLOAT_MAT4"]=35676]="FLOAT_MAT4",t[t["SAMPLER_2D"]=35678]="SAMPLER_2D",t[t["SAMPLER_CUBE"]=35680]="SAMPLER_CUBE",t[t["VERTEX_ATTRIB_ARRAY_ENABLED"]=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",t[t["VERTEX_ATTRIB_ARRAY_SIZE"]=34339]="VERTEX_ATTRIB_ARRAY_SIZE",t[t["VERTEX_ATTRIB_ARRAY_STRIDE"]=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",t[t["VERTEX_ATTRIB_ARRAY_TYPE"]=34341]="VERTEX_ATTRIB_ARRAY_TYPE",t[t["VERTEX_ATTRIB_ARRAY_NORMALIZED"]=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",t[t["VERTEX_ATTRIB_ARRAY_POINTER"]=34373]="VERTEX_ATTRIB_ARRAY_POINTER",t[t["VERTEX_ATTRIB_ARRAY_BUFFER_BINDING"]=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",t[t["COMPILE_STATUS"]=35713]="COMPILE_STATUS",t[t["LOW_FLOAT"]=36336]="LOW_FLOAT",t[t["MEDIUM_FLOAT"]=36337]="MEDIUM_FLOAT",t[t["HIGH_FLOAT"]=36338]="HIGH_FLOAT",t[t["LOW_INT"]=36339]="LOW_INT",t[t["MEDIUM_INT"]=36340]="MEDIUM_INT",t[t["HIGH_INT"]=36341]="HIGH_INT",t[t["FRAMEBUFFER"]=36160]="FRAMEBUFFER",t[t["RENDERBUFFER"]=36161]="RENDERBUFFER",t[t["RGBA4"]=32854]="RGBA4",t[t["RGB5_A1"]=32855]="RGB5_A1",t[t["RGB565"]=36194]="RGB565",t[t["DEPTH_COMPONENT16"]=33189]="DEPTH_COMPONENT16",t[t["STENCIL_INDEX"]=6401]="STENCIL_INDEX",t[t["STENCIL_INDEX8"]=36168]="STENCIL_INDEX8",t[t["DEPTH_STENCIL"]=34041]="DEPTH_STENCIL",t[t["RENDERBUFFER_WIDTH"]=36162]="RENDERBUFFER_WIDTH",t[t["RENDERBUFFER_HEIGHT"]=36163]="RENDERBUFFER_HEIGHT",t[t["RENDERBUFFER_INTERNAL_FORMAT"]=36164]="RENDERBUFFER_INTERNAL_FORMAT",t[t["RENDERBUFFER_RED_SIZE"]=36176]="RENDERBUFFER_RED_SIZE",t[t["RENDERBUFFER_GREEN_SIZE"]=36177]="RENDERBUFFER_GREEN_SIZE",t[t["RENDERBUFFER_BLUE_SIZE"]=36178]="RENDERBUFFER_BLUE_SIZE",t[t["RENDERBUFFER_ALPHA_SIZE"]=36179]="RENDERBUFFER_ALPHA_SIZE",t[t["RENDERBUFFER_DEPTH_SIZE"]=36180]="RENDERBUFFER_DEPTH_SIZE",t[t["RENDERBUFFER_STENCIL_SIZE"]=36181]="RENDERBUFFER_STENCIL_SIZE",t[t["FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE"]=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",t[t["FRAMEBUFFER_ATTACHMENT_OBJECT_NAME"]=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",t[t["FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL"]=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",t[t["FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE"]=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",t[t["COLOR_ATTACHMENT0"]=36064]="COLOR_ATTACHMENT0",t[t["DEPTH_ATTACHMENT"]=36096]="DEPTH_ATTACHMENT",t[t["STENCIL_ATTACHMENT"]=36128]="STENCIL_ATTACHMENT",t[t["DEPTH_STENCIL_ATTACHMENT"]=33306]="DEPTH_STENCIL_ATTACHMENT",t[t["NONE"]=0]="NONE",t[t["FRAMEBUFFER_COMPLETE"]=36053]="FRAMEBUFFER_COMPLETE",t[t["FRAMEBUFFER_INCOMPLETE_ATTACHMENT"]=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",t[t["FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT"]=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",t[t["FRAMEBUFFER_INCOMPLETE_DIMENSIONS"]=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",t[t["FRAMEBUFFER_UNSUPPORTED"]=36061]="FRAMEBUFFER_UNSUPPORTED",t[t["FRAMEBUFFER_BINDING"]=36006]="FRAMEBUFFER_BINDING",t[t["RENDERBUFFER_BINDING"]=36007]="RENDERBUFFER_BINDING",t[t["MAX_RENDERBUFFER_SIZE"]=34024]="MAX_RENDERBUFFER_SIZE",t[t["INVALID_FRAMEBUFFER_OPERATION"]=1286]="INVALID_FRAMEBUFFER_OPERATION",t[t["UNPACK_FLIP_Y_WEBGL"]=37440]="UNPACK_FLIP_Y_WEBGL",t[t["UNPACK_PREMULTIPLY_ALPHA_WEBGL"]=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",t[t["CONTEXT_LOST_WEBGL"]=37442]="CONTEXT_LOST_WEBGL",t[t["UNPACK_COLORSPACE_CONVERSION_WEBGL"]=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",t[t["BROWSER_DEFAULT_WEBGL"]=37444]="BROWSER_DEFAULT_WEBGL"})(vf||(vf={}));var Of,Df,Nf,zf,Ff,Bf,Uf,jf,Zf,Vf=(mf=(0,xc.b2)(),gf=(0,xc.f3)(wc.IMapService),yf=(0,xc.f3)(wc.IRendererService),_f=(0,xc.f3)(wc.IGlobalConfigService),xf=(0,xc.f3)(wc.IInteractionService),bf=(0,xc.f3)(wc.ILayerService),mf((Ef=function(){function t(){var e=this;Ot(this,t),(0,Ft.Z)(this,"pickedColors",void 0),(0,Ft.Z)(this,"pickedTileLayers",[]),Oh(this,"mapService",Sf,this),Oh(this,"rendererService",Af,this),Oh(this,"configService",Tf,this),Oh(this,"interactionService",Cf,this),Oh(this,"layerService",kf,this),(0,Ft.Z)(this,"pickingFBO",void 0),(0,Ft.Z)(this,"width",0),(0,Ft.Z)(this,"height",0),(0,Ft.Z)(this,"alreadyInPicking",!1),(0,Ft.Z)(this,"pickBufferScale",1),(0,Ft.Z)(this,"pickFromPickingFBO",(function(t,n){var r=n.x,i=n.y,o=n.lngLat,a=n.type,s=n.target,u=!1,c=e.rendererService,l=c.readPixels,h=c.getContainer,f=e.getContainerSize(h()),p=f.width,d=f.height;p*=$i,d*=$i;var v=t.getLayerConfig(),m=v.enableHighlight,g=v.enableSelect,y=r*$i,_=i*$i;if(y>p-1*$i||y<0||_>d-1*$i||_<0)return!1;var x=l({x:Math.floor(y/e.pickBufferScale),y:Math.floor((d-(i+1)*$i)/e.pickBufferScale),width:1,height:1,data:new Uint8Array(4),framebuffer:e.pickingFBO});if(e.pickedColors=x,0!==x[0]||0!==x[1]||0!==x[2]){var b=wi(x),w=t.layerPickService.getFeatureById(b);b!==t.getCurrentPickId()&&"mousemove"===a&&(a="mouseenter");var E={x:r,y:i,type:a,lngLat:o,featureId:b,feature:w,target:s};w&&(u=!0,t.setCurrentPickId(b),e.triggerHoverOnLayer(t,E))}else{var S={x:r,y:i,lngLat:o,type:null!==t.getCurrentPickId()&&"mousemove"===a?"mouseout":"un"+a,featureId:null,target:s,feature:null};e.triggerHoverOnLayer(t,(0,k.Z)((0,k.Z)({},S),{},{type:"unpick"})),e.triggerHoverOnLayer(t,S),t.setCurrentPickId(null)}if(m&&t.layerPickService.highlightPickedFeature(x),g&&"click"===a&&(null===x||void 0===x?void 0:x.toString())!==[0,0,0,0].toString()){var A=wi(x);null===t.getCurrentSelectedId()||A!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(x),t.setCurrentSelectedId(A)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return u}))}return zt(t,[{key:"init",value:function(t){var e=this.rendererService,n=e.createTexture2D,r=e.createFramebuffer,i=e.getContainer,o=this.getContainerSize(i()),a=o.width,s=o.height;a*=$i,s*=$i,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,this.pickingFBO=r({color:n({width:Math.round(a/this.pickBufferScale),height:Math.round(s/this.pickBufferScale),wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE})}),this.interactionService.on(rf.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(e,n,r){var i,o,a,s=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:i=this.rendererService,o=i.useFramebuffer,a=i.clear,this.resizePickingFBO(),o(this.pickingFBO,(function(){a({framebuffer:s.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),e.hooks.beforePickingEncode.call(),e.renderModels({ispick:!0}),e.hooks.afterPickingEncode.call();var t=s.pickBox(e,n);r(t)}));case 3:case"end":return t.stop()}}),t,this)})));function e(e,n,r){return t.apply(this,arguments)}return e}()},{key:"pickBox",value:function(t,e){var n=this,r=e.map((function(t){var e=t<0?0:t;return Math.floor(e*$i/n.pickBufferScale)})),i=(0,Li.Z)(r,4),o=i[0],a=i[1],s=i[2],u=i[3],c=this.rendererService,l=c.readPixels,h=c.getContainer,f=this.getContainerSize(h()),p=f.width,d=f.height;if(p*=$i,d*=$i,o>(p-1)*$i/this.pickBufferScale||s<0||a>(d-1)*$i/this.pickBufferScale||u<0)return[];for(var v=Math.min(p/this.pickBufferScale,s)-o,m=Math.min(d/this.pickBufferScale,u)-a,g=l({x:o,y:Math.floor(d/this.pickBufferScale-(u+1)),width:v,height:m,data:new Uint8Array(v*m*4),framebuffer:this.pickingFBO}),y=[],_={},x=0;x<g.length/4;x+=1){var b=g.slice(4*x,4*x+4),w=wi(b);if(-1!==w&&!_[w]){var E=t.layerPickService.getFeatureById(w);y.push((0,k.Z)((0,k.Z)({},E),{},{pickedFeatureIdx:w})),_[w]=!0}}return y}},{key:"handleCursor",value:function(t,e){var n=t.getLayerConfig(),r=n.cursor,i=void 0===r?"":r,o=n.cursorEnabled;if(o){var a=this.mapService.version,s="GAODE2.x"===a?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),u=null===s||void 0===s?void 0:s.style.getPropertyValue("cursor");"unmousemove"===e&&""!==u?null===s||void 0===s||s.style.setProperty("cursor",""):"mousemove"===e&&(null===s||void 0===s||s.style.setProperty("cursor",i))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/$i,height:t.height/$i}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.layerService.needPick(e.type)&&this.isPickingAllLayer()){t.next=2;break}return t.abrupt("return");case 2:return this.alreadyInPicking=!0,t.next=5,this.pickingLayers(e);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"isPickingAllLayer",value:function(){return!this.alreadyInPicking&&(!this.layerService.alreadyInRendering&&(!this.interactionService.indragging&&!!this.layerService.getShaderPickStat()))}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,e=this.getContainerSize(t()),n=e.width,r=e.height;n*=$i,r*=$i,this.width===n&&this.height===r||(this.pickingFBO.resize({width:Math.round(n/this.pickBufferScale),height:Math.round(r/this.pickBufferScale)}),this.width=n,this.height=r)}},{key:"pickingLayers",value:function(){var t=(0,J.Z)(tt().mark((function t(e){var n,r,i,o=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=this.rendererService,r=n.useFramebuffer,i=n.clear,this.resizePickingFBO(),r(this.pickingFBO,(function(){var t=o.layerService.getRenderList();t.filter((function(t){return t.needPick(e.type)})).reverse().some((function(t){i({framebuffer:o.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),t.layerPickService.pickRender(e);var n=o.pickFromPickingFBO(t,e);return o.layerService.pickedLayerId=n?+t.id:-1,n&&!t.getLayerConfig().enablePropagation}))}));case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"triggerHoverOnLayer",value:function(t,e){Lf(e)&&(this.handleCursor(t,e.type),t.emit(e.type,e))}}]),t}(),Sf=Dh(Ef.prototype,"mapService",[gf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Af=Dh(Ef.prototype,"rendererService",[yf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Tf=Dh(Ef.prototype,"configService",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cf=Dh(Ef.prototype,"interactionService",[xf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kf=Dh(Ef.prototype,"layerService",[bf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wf=Ef))||wf),Gf=function(){function t(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];Ot(this,t),(0,Ft.Z)(this,"autoStart",void 0),(0,Ft.Z)(this,"startTime",0),(0,Ft.Z)(this,"oldTime",0),(0,Ft.Z)(this,"running",!1),(0,Ft.Z)(this,"elapsedTime",0),this.autoStart=e}return zt(t,[{key:"start",value:function(){this.startTime=("undefined"===typeof performance?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var e=("undefined"===typeof performance?Date:performance).now();t=(e-this.oldTime)/1e3,this.oldTime=e,this.elapsedTime+=t}return t}}]),t}();function Hf(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Wf(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Wf(t,e){if(t){if("string"===typeof t)return qf(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?qf(t,e):void 0}}function qf(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Xf(t){var e=Yf();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Yf(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Kf=(Of=(0,xc.b2)(),Df=(0,xc.f3)(wc.IRendererService),Nf=(0,xc.f3)(wc.IMapService),zf=(0,xc.f3)(wc.IDebugService),Of((Bf=function(t){Yt(n,t);var e=Xf(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"pickedLayerId",-1),(0,Ft.Z)(Kt(t),"clock",new Gf),(0,Ft.Z)(Kt(t),"alreadyInRendering",!1),(0,Ft.Z)(Kt(t),"layers",[]),(0,Ft.Z)(Kt(t),"layerList",[]),(0,Ft.Z)(Kt(t),"layerRenderID",void 0),(0,Ft.Z)(Kt(t),"sceneInited",!1),(0,Ft.Z)(Kt(t),"animateInstanceCount",0),(0,Ft.Z)(Kt(t),"shaderPicking",!0),(0,Ft.Z)(Kt(t),"enableRender",!0),Oh(Kt(t),"renderService",Uf,Kt(t)),Oh(Kt(t),"mapService",jf,Kt(t)),Oh(Kt(t),"debugService",Zf,Kt(t)),(0,Ft.Z)(Kt(t),"reRender",(0,Oi.throttle)((function(){t.renderLayers()}),32)),(0,Ft.Z)(Kt(t),"throttleRenderLayers",(0,Oi.throttle)((function(){t.renderLayers()}),16)),t}return zt(n,[{key:"needPick",value:function(t){return this.layerList.some((function(e){return e.needPick(t)}))}},{key:"add",value:function(t){var e=this;this.layers.push(t),this.sceneInited&&t.init().then((function(){e.renderLayers()}))}},{key:"addMask",value:function(t){var e=this;this.sceneInited&&t.init().then((function(){e.renderLayers()}))}},{key:"initLayers",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var t=(0,J.Z)(tt().mark((function t(n){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(n.startInit){t.next=4;break}return t.next=3,n.init();case 3:e.updateLayerRenderList();case 4:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}());case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(t){return this.layers.find((function(e){return e.id===t}))}},{key:"getLayerByName",value:function(t){return this.layers.find((function(e){return e.name===t}))}},{key:"remove",value:function(){var t=(0,J.Z)(tt().mark((function t(e,n){var r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:n?(r=n.layerChildren.indexOf(e),r>-1&&n.layerChildren.splice(r,1)):(i=this.layers.indexOf(e),i>-1&&this.layers.splice(i,1)),e.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"removeAllLayers",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:this.destroy(),this.reRender();case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"setEnableRender",value:function(t){this.enableRender=t}},{key:"renderLayers",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.alreadyInRendering&&this.enableRender){t.next=2;break}return t.abrupt("return");case 2:this.updateLayerRenderList(),e=this.debugService.generateRenderUid(),this.debugService.renderStart(e),this.alreadyInRendering=!0,this.clear(),n=Hf(this.layerList),t.prev=8,n.s();case 10:if((r=n.n()).done){t.next=23;break}if(i=r.value,o=i.getLayerConfig(),a=o.enableMask,i.masks.filter((function(t){return t.inited})).length>0&&a&&this.renderMask(i.masks),!i.getLayerConfig().enableMultiPassRenderer){t.next=19;break}return t.next=17,i.renderMultiPass();case 17:t.next=21;break;case 19:return t.next=21,i.render();case 21:t.next=10;break;case 23:t.next=28;break;case 25:t.prev=25,t.t0=t["catch"](8),n.e(t.t0);case 28:return t.prev=28,n.f(),t.finish(28);case 31:this.debugService.renderEnd(e),this.alreadyInRendering=!1;case 33:case"end":return t.stop()}}),t,this,[[8,25,28,31]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"renderMask",value:function(t){var e=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var n,r=t.length>1?xh.MULTIPLE:xh.SINGLE,i=Hf(t);try{for(i.s();!(n=i.n()).done;){var o=n.value;o.render({isStencil:!0,stencilType:r,stencilIndex:e++})}}catch(a){i.e(a)}finally{i.f()}}},{key:"beforeRenderData",value:function(){var t=(0,J.Z)(tt().mark((function t(e){var n;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.hooks.beforeRenderData.promise();case 2:n=t.sent,n&&this.renderLayers();case 4:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"renderTileLayerMask",value:function(t){var e=0,n=t.getLayerConfig(),r=n.enableMask,i=void 0===r||r,o=t.tileMask?1:0,a=t.masks.filter((function(t){return t.inited}));o+=i?a.length:1;var s=o>1?xh.MULTIPLE:xh.SINGLE;if((t.tileMask||a.length&&i)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),a.length&&i){var u,c=Hf(a);try{for(c.s();!(u=c.n()).done;){var l=u.value;l.render({isStencil:!0,stencilType:s,stencilIndex:e++})}}catch(h){c.e(h)}finally{c.f()}}t.tileMask&&t.tileMask.render({isStencil:!0,stencilType:s,stencilIndex:e++,stencilOperation:bh.OR})}},{key:"renderTileLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.renderTileLayerMask(e),!e.getLayerConfig().enableMultiPassRenderer){t.next=6;break}return t.next=4,e.renderMultiPass();case 4:t.next=8;break;case 6:return t.next=8,e.render();case 8:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"updateLayerRenderList",value:function(){var t=this;this.layerList=[],this.layers.filter((function(t){return t.inited})).filter((function(t){return t.isVisible()})).sort((function(t,e){return t.zIndex-e.zIndex})).forEach((function(e){t.layerList.push(e)}))}},{key:"destroy",value:function(){this.layers.forEach((function(t){t.destroy()})),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){0===this.animateInstanceCount++&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){0===--this.animateInstanceCount&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var t=bi(this.mapService.bgColor);this.renderService.clear({color:t,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=xr.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){xr.cancelAnimationFrame(this.layerRenderID)}}]),n}(Ma.EventEmitter),Uf=Dh(Bf.prototype,"renderService",[Df],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jf=Dh(Bf.prototype,"mapService",[Nf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zf=Dh(Bf.prototype,"debugService",[zf],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ff=Bf))||Ff);function Qf(t,e){if(null==t)return{};var n,r,i={},o=Object.keys(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||(i[n]=t[n]);return i}function Jf(t,e){if(null==t)return{};var n,r,i=Qf(t,e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);for(r=0;r<o.length;r++)n=o[r],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(i[n]=t[n])}return i}var $f,tp,ep,np,rp,ip,op=function(){function t(e){var n=this;Ot(this,t),(0,Ft.Z)(this,"name",void 0),(0,Ft.Z)(this,"type",void 0),(0,Ft.Z)(this,"scale",void 0),(0,Ft.Z)(this,"descriptor",void 0),(0,Ft.Z)(this,"featureBufferLayout",[]),(0,Ft.Z)(this,"needRescale",!1),(0,Ft.Z)(this,"needRemapping",!1),(0,Ft.Z)(this,"needRegenerateVertices",!1),(0,Ft.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,Ft.Z)(this,"vertexAttribute",void 0),(0,Ft.Z)(this,"defaultCallback",(function(t){var e;return 0===t.length?(null===(e=n.scale)||void 0===e?void 0:e.defaultValues)||[]:t.map((function(t,e){var r,i=null===(r=n.scale)||void 0===r?void 0:r.scalers[e].func,o=i(t);return o}))})),this.setProps(e)}return zt(t,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var e;if(null!==(e=this.scale)&&void 0!==e&&e.callback){var n,r=null===(n=this.scale)||void 0===n?void 0:n.callback.apply(n,(0,C.Z)(t));if(!(0,Oi.isNil)(r))return[r]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),t}(),ap=["buffer","update","name"],sp=["buffer","update","name"],up=($f={},(0,Ft.Z)($f,vf.FLOAT,4),(0,Ft.Z)($f,vf.UNSIGNED_BYTE,1),(0,Ft.Z)($f,vf.UNSIGNED_SHORT,2),$f),cp=(tp=(0,xc.b2)(),ep=(0,xc.f3)(wc.IRendererService),tp((rp=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"attributesAndIndices",void 0),Oh(this,"rendererService",ip,this),(0,Ft.Z)(this,"attributes",[]),(0,Ft.Z)(this,"triangulation",void 0),(0,Ft.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return zt(t,[{key:"registerStyleAttribute",value:function(t){var e=this.getLayerStyleAttribute(t.name||"");return e?e.setProps(t):(e=new op(t),this.attributes.push(e)),e}},{key:"unRegisterStyleAttribute",value:function(t){var e=this.attributes.findIndex((function(e){return e.name===t}));e>-1&&this.attributes.splice(e,1)}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach((function(e){var n,r=e.name,i=null===(n=e.scale)||void 0===n?void 0:n.field;(t[r]||i&&t[i])&&(e.needRescale=!0,e.needRemapping=!0,e.needRegenerateVertices=!0)}))}},{key:"updateStyleAttribute",value:function(t,e,n){var r=this.getLayerStyleAttribute(t);r||(r=this.registerStyleAttribute((0,k.Z)((0,k.Z)({},e),{},{name:t})));var i=e.scale;i&&r&&(r.scale=i,r.needRescale=!0,r.needRemapping=!0,r.needRegenerateVertices=!0,n&&n.featureRange&&(r.featureRange=n.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find((function(e){return e.name===t}))}},{key:"getLayerAttributeScale",value:function(t){var e,n=this.getLayerStyleAttribute(t),r=null===n||void 0===n||null===(e=n.scale)||void 0===e?void 0:e.scalers;return r&&r[0]?r[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=arguments.length>3?arguments[3]:void 0,i=arguments.length>4?arguments[4]:void 0,o=this.attributes.find((function(e){return e.name===t}));if(o&&o.descriptor){var a=o.descriptor,s=a.update,u=a.buffer,c=a.size,l=void 0===c?0:c,h=up[u.type||vf.FLOAT];if(s){var f=this.featureLayout,p=f.elements,d=f.sizePerElement,v=p.slice(n,r);if(!v.length)return;var m=v[0].offset,g=m*l*h,y=v.map((function(t,n){for(var r=t.featureIdx,i=t.vertices,o=t.normals,a=i.length/d,u=[],c=0;c<a;c++){var l=o?o.slice(3*c,3*c+3):[];u.push.apply(u,(0,C.Z)(s(e[r],r,i.slice(c*d,c*d+d),n,l)))}return u})).reduce((function(t,e){return t.push.apply(t,(0,C.Z)(e)),t}),[]);o.vertexAttribute.updateBuffer({data:y,offset:g}),null===i||void 0===i||i.emit("legend:".concat(t),{type:t,attr:o})}}}},{key:"createAttributesAndIndices",value:function(t,e,n){var r=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var i=this.attributes.map((function(t){return t.resetDescriptor(),t.descriptor})),o=0,a=0,s=[],u=3;t.forEach((function(t,e){var c=r.triangulation(t,n),l=c.indices,h=c.vertices,f=c.normals,p=c.size,d=c.indexes,v=c.count;"number"===typeof v&&(a+=v),l.forEach((function(t){s.push(t+o)})),u=p;var m=h.length/p;r.featureLayout.sizePerElement=u,r.featureLayout.elements.push({featureIdx:e,vertices:h,normals:f,offset:o}),o+=m;for(var g=function(n){var r=(null===f||void 0===f?void 0:f.slice(3*n,3*n+3))||[],o=h.slice(n*p,n*p+p),a=0;d&&void 0!==d[n]&&(a=d[n]),i.forEach((function(i,s){var u;i&&i.update&&(u=i.buffer.data).push.apply(u,(0,C.Z)(i.update(t,e,o,n,r,a)))}))},y=0;y<m;y++)g(y)}));var c=this.rendererService,l=c.createAttribute,h=c.createBuffer,f=c.createElements,p={};i.forEach((function(t,e){if(t){var n=t.buffer,i=(t.update,t.name,Jf(t,ap)),o=l((0,k.Z)({buffer:h(n)},i));p[t.name||""]=o,r.attributes[e].vertexAttribute=o}}));var d=f({data:s,type:vf.UNSIGNED_INT,count:s.length});return this.attributesAndIndices={attributes:p,elements:d,count:a},this.attributesAndIndices}},{key:"createAttributes",value:function(t,e){var n=this;this.featureLayout={sizePerElement:0,elements:[]},e&&(this.triangulation=e);var r=this.attributes.map((function(t){return t.resetDescriptor(),t.descriptor})),i=0,o=[],a=3;t.forEach((function(t,e){var s=n.triangulation(t),u=s.indices,c=s.vertices,l=s.normals,h=s.size,f=s.indexes;u.forEach((function(t){o.push(t+i)})),a=h;var p=c.length/h;n.featureLayout.sizePerElement=a,n.featureLayout.elements.push({featureIdx:e,vertices:c,normals:l,offset:i}),i+=p;for(var d=function(n){var i=(null===l||void 0===l?void 0:l.slice(3*n,3*n+3))||[],o=c.slice(n*h,n*h+h),a=0;f&&void 0!==f[n]&&(a=f[n]),r.forEach((function(r,s){var u;r&&r.update&&(u=r.buffer.data).push.apply(u,(0,C.Z)(r.update(t,e,o,n,i,a)))}))},v=0;v<p;v++)d(v)}));var s=this.rendererService,u=s.createAttribute,c=s.createBuffer,l={};return r.forEach((function(t,e){if(t){var r=t.buffer,i=(t.update,t.name,Jf(t,sp)),o=u((0,k.Z)({buffer:c(r)},i));l[t.name||""]=o,n.attributes[e].vertexAttribute=o}})),{attributes:l}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach((function(t){t.vertexAttribute&&t.vertexAttribute.destroy()})),null===(t=this.attributesAndIndices)||void 0===t||t.elements.destroy(),this.attributes=[]}}]),t}(),ip=Dh(rp.prototype,"rendererService",[ep],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),np=rp))||np);n(85844),n(84633);function lp(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function a(t){try{u(r.next(t))}catch(e){o(e)}}function s(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(a,s)}u((r=r.apply(t,e||[])).next())}))}function hp(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(t){return function(e){return u([t,e])}}function u(o){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(i=2&o[0]?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}}function fp(t,e){var n="function"===typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),a=[];try{while((void 0===e||e-- >0)&&!(r=o.next()).done)a.push(r.value)}catch(s){i={error:s}}finally{try{r&&!r.done&&(n=o["return"])&&n.call(o)}finally{if(i)throw i.error}}return a}function pp(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}function dp(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t["default"]:t}var vp={exports:{}},mp={exports:{}},gp={exports:{}};(function(t,e){function n(t){return t&&"number"===typeof t.length&&t.length>=0&&t.length%1===0}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n,t.exports=e["default"]})(gp,gp.exports);var yp={},_p={exports:{}},xp={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return function(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];var r=e.pop();return t.call(this,e,r)}},t.exports=e["default"]})(xp,xp.exports);var bp={};Object.defineProperty(bp,"__esModule",{value:!0}),bp.fallback=Tp,bp.wrap=Cp;var wp,Ep=bp.hasQueueMicrotask="function"===typeof queueMicrotask&&queueMicrotask,Sp=bp.hasSetImmediate="function"===typeof setImmediate&&setImmediate,Ap=bp.hasNextTick="object"===("undefined"===typeof process?"undefined":(0,I.Z)(process))&&"function"===typeof process.nextTick;function Tp(t){setTimeout(t,0)}function Cp(t){return function(e){var n=[],r=arguments.length-1;while(r-- >0)n[r]=arguments[r+1];return t((function(){return e.apply(void 0,n)}))}}wp=Ep?queueMicrotask:Sp?setImmediate:Ap?process.nextTick:Tp,bp.default=Cp(wp),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=u;var n=xp.exports,r=s(n),i=bp,o=s(i),a=yp;function s(t){return t&&t.__esModule?t:{default:t}}function u(t){return(0,a.isAsync)(t)?function(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];var r=e.pop(),i=t.apply(this,e);return c(i,r)}:(0,r.default)((function(e,n){var r;try{r=t.apply(this,e)}catch(i){return n(i)}if(r&&"function"===typeof r.then)return c(r,n);n(null,r)}))}function c(t,e){return t.then((function(t){l(e,null,t)}),(function(t){l(e,t&&t.message?t:new Error(t))}))}function l(t,e,n){try{t(e,n)}catch(r){(0,o.default)((function(t){throw t}),r)}}t.exports=e["default"]}(_p,_p.exports),Object.defineProperty(yp,"__esModule",{value:!0}),yp.isAsyncIterable=yp.isAsyncGenerator=yp.isAsync=void 0;var kp=_p.exports,Mp=Pp(kp);function Pp(t){return t&&t.__esModule?t:{default:t}}function Ip(t){return"AsyncFunction"===t[Symbol.toStringTag]}function Rp(t){return"AsyncGenerator"===t[Symbol.toStringTag]}function Lp(t){return"function"===typeof t[Symbol.asyncIterator]}function Op(t){if("function"!==typeof t)throw new Error("expected a function");return Ip(t)?(0,Mp.default)(t):t}yp.default=Op,yp.isAsync=Ip,yp.isAsyncGenerator=Rp,yp.isAsyncIterable=Lp;var Dp={exports:{}};(function(t,e){function n(t,e){if(void 0===e&&(e=t.length),!e)throw new Error("arity is undefined");function n(){var n=this,r=[],i=arguments.length;while(i--)r[i]=arguments[i];return"function"===typeof r[e-1]?t.apply(this,r):new Promise((function(i,o){r[e-1]=function(t){var e=[],n=arguments.length-1;while(n-- >0)e[n]=arguments[n+1];if(t)return o(t);i(e.length>1?e:e[0])},t.apply(n,r)}))}return n}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n,t.exports=e["default"]})(Dp,Dp.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=gp.exports,r=u(n),i=yp,o=u(i),a=Dp.exports,s=u(a);function u(t){return t&&t.__esModule?t:{default:t}}e.default=(0,s.default)((function(t,e,n){var i=(0,r.default)(e)?[]:{};t(e,(function(t,e,n){(0,o.default)(t)((function(t){var r,o=[],a=arguments.length-1;while(a-- >0)o[a]=arguments[a+1];o.length<2&&(r=o,o=r[0]),i[e]=o,n(t)}))}),(function(t){return n(t,i)}))}),3),t.exports=e["default"]}(mp,mp.exports);var Np={exports:{}},zp={exports:{}},Fp={exports:{}},Bp={exports:{}};(function(t,e){function n(t){function e(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];if(null!==t){var r=t;t=null,r.apply(this,e)}}return Object.assign(e,t),e}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n,t.exports=e["default"]})(Bp,Bp.exports);var Up={exports:{}},jp={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},t.exports=e["default"]})(jp,jp.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=l;var n=gp.exports,r=a(n),i=jp.exports,o=a(i);function a(t){return t&&t.__esModule?t:{default:t}}function s(t){var e=-1,n=t.length;return function(){return++e<n?{value:t[e],key:e}:null}}function u(t){var e=-1;return function(){var n=t.next();return n.done?null:(e++,{value:n.value,key:e})}}function c(t){var e=t?Object.keys(t):[],n=-1,r=e.length;return function i(){var o=e[++n];return"__proto__"===o?i():n<r?{value:t[o],key:o}:null}}function l(t){if((0,r.default)(t))return s(t);var e=(0,o.default)(t);return e?u(e):c(t)}t.exports=e["default"]}(Up,Up.exports);var Zp={exports:{}};(function(t,e){function n(t){return function(){var e=[],n=arguments.length;while(n--)e[n]=arguments[n];if(null===t)throw new Error("Callback was already called.");var r=t;t=null,r.apply(this,e)}}Object.defineProperty(e,"__esModule",{value:!0}),e.default=n,t.exports=e["default"]})(Zp,Zp.exports);var Vp={exports:{}},Gp={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n={};e.default=n,t.exports=e["default"]})(Gp,Gp.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=o;var n=Gp.exports,r=i(n);function i(t){return t&&t.__esModule?t:{default:t}}function o(t,e,n,i){var o=!1,a=!1,s=!1,u=0,c=0;function l(){u>=e||s||o||(s=!0,t.next().then((function(t){var e=t.value,r=t.done;if(!a&&!o){if(s=!1,r)return o=!0,void(u<=0&&i(null));u++,n(e,c,h),c++,l()}})).catch(f))}function h(t,e){if(u-=1,!a)return t?f(t):!1===t?(o=!0,void(a=!0)):e===r.default||o&&u<=0?(o=!0,i(null)):void l()}function f(t){a||(s=!1,o=!0,i(t))}l()}t.exports=e["default"]}(Vp,Vp.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=Bp.exports,r=p(n),i=Up.exports,o=p(i),a=Zp.exports,s=p(a),u=yp,c=Vp.exports,l=p(c),h=Gp.exports,f=p(h);function p(t){return t&&t.__esModule?t:{default:t}}e.default=function(t){return function(e,n,i){if(i=(0,r.default)(i),t<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!e)return i(null);if((0,u.isAsyncGenerator)(e))return(0,l.default)(e,t,n,i);if((0,u.isAsyncIterable)(e))return(0,l.default)(e[Symbol.asyncIterator](),t,n,i);var a=(0,o.default)(e),c=!1,h=!1,p=0,d=!1;function v(t,e){if(!h)if(p-=1,t)c=!0,i(t);else if(!1===t)c=!0,h=!0;else{if(e===f.default||c&&p<=0)return c=!0,i(null);d||m()}}function m(){d=!0;while(p<t&&!c){var e=a();if(null===e)return c=!0,void(p<=0&&i(null));p+=1,n(e.value,e.key,(0,s.default)(v))}d=!1}m()}},t.exports=e["default"]}(Fp,Fp.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=Fp.exports,r=u(n),i=yp,o=u(i),a=Dp.exports,s=u(a);function u(t){return t&&t.__esModule?t:{default:t}}function c(t,e,n,i){return(0,r.default)(e)(t,(0,o.default)(n),i)}e.default=(0,s.default)(c,4),t.exports=e["default"]}(zp,zp.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=zp.exports,r=a(n),i=Dp.exports,o=a(i);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e,n){return(0,r.default)(t,1,e,n)}e.default=(0,o.default)(s,3),t.exports=e["default"]}(Np,Np.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=mp.exports,r=a(n),i=Np.exports,o=a(i);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){return(0,r.default)(o.default,t,e)}t.exports=e["default"]}(vp,vp.exports);var Hp=dp(vp.exports),Wp=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.call=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,Hp(this.tasks)},t.prototype.tap=function(t,e){var n=this;this.tasks.push((function(r){e.apply(void 0,pp([],fp(n.args),!1)),r(null,t)}))},t}(),qp={exports:{}},Xp={exports:{}};(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=gp.exports,r=m(n),i=Gp.exports,o=m(i),a=zp.exports,s=m(a),u=Bp.exports,c=m(u),l=Zp.exports,h=m(l),f=yp,p=m(f),d=Dp.exports,v=m(d);function m(t){return t&&t.__esModule?t:{default:t}}function g(t,e,n){n=(0,c.default)(n);var r=0,i=0,a=t.length,s=!1;function u(t,e){!1===t&&(s=!0),!0!==s&&(t?n(t):++i!==a&&e!==o.default||n(null))}for(0===a&&n(null);r<a;r++)e(t[r],r,(0,h.default)(u))}function y(t,e,n){return(0,s.default)(t,1/0,e,n)}function _(t,e,n){var i=(0,r.default)(t)?g:y;return i(t,(0,p.default)(e),n)}e.default=(0,v.default)(_,3),t.exports=e["default"]})(Xp,Xp.exports),function(t,e){Object.defineProperty(e,"__esModule",{value:!0}),e.default=s;var n=Xp.exports,r=a(n),i=mp.exports,o=a(i);function a(t){return t&&t.__esModule?t:{default:t}}function s(t,e){return(0,o.default)(r.default,t,e)}t.exports=e["default"]}(qp,qp.exports);var Yp=dp(qp.exports),Kp=(function(){function t(){this.tasks=[]}t.prototype.promise=function(){return Yp(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push((function(r){return lp(n,void 0,void 0,(function(){return hp(this,(function(n){switch(n.label){case 0:return[4,e()];case 1:return n.sent(),r(null,t),[2]}}))}))}))}}(),{exports:{}});(function(t,e){Object.defineProperty(e,"__esModule",{value:!0});var n=Bp.exports,r=l(n),i=Zp.exports,o=l(i),a=yp,s=l(a),u=Dp.exports,c=l(u);function l(t){return t&&t.__esModule?t:{default:t}}function h(t,e){if(e=(0,r.default)(e),!Array.isArray(t))return e(new Error("First argument to waterfall must be an array of functions"));if(!t.length)return e();var n=0;function i(e){var r=(0,s.default)(t[n++]);r.apply(void 0,e.concat([(0,o.default)(a)]))}function a(r){var o=[],a=arguments.length-1;while(a-- >0)o[a]=arguments[a+1];if(!1!==r)return r||n===t.length?e.apply(void 0,[r].concat(o)):void i(o)}i([])}e.default=(0,c.default)(h),t.exports=e["default"]})(Kp,Kp.exports);var Qp,Jp,$p,td,ed,nd,rd,id,od,ad,sd,ud,cd,ld,hd,fd,pd,dd,vd,md,gd,yd,_d,xd,bd,wd,Ed,Sd,Ad,Td,Cd,kd,Md,Pd,Id,Rd=dp(Kp.exports),Ld=(function(){function t(){this.tasks=[]}t.prototype.call=function(){return Rd(this.tasks)},t.prototype.tap=function(t,e){0===this.tasks.length?this.tasks.push((function(t){var n=e();t(!!n&&null,n)})):this.tasks.push((function(n,r){var i=e.apply(void 0,pp([],fp(n),!1));r(!!i&&null,t)}))}}(),function(){function t(){this.tasks=[]}return t.prototype.call=function(){return Hp(this.tasks)},t.prototype.tap=function(t,e){this.tasks.push((function(n){var r=e();n(r,t)}))},t}()),Od=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,Hp(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push((function(r){return lp(n,void 0,void 0,(function(){return hp(this,(function(n){switch(n.label){case 0:return[4,e.apply(void 0,pp([],fp(this.args),!1))];case 1:return n.sent(),r(null,t),[2]}}))}))}))},t}(),Dd=function(){function t(){this.args=[],this.tasks=[]}return t.prototype.promise=function(){for(var t=arguments,e=[],n=0;n<arguments.length;n++)e[n]=t[n];return this.args=e,Hp(this.tasks)},t.prototype.tapPromise=function(t,e){var n=this;this.tasks.push((function(r){return lp(n,void 0,void 0,(function(){var n;return hp(this,(function(i){switch(i.label){case 0:return[4,e.apply(void 0,pp([],fp(this.args),!1))];case 1:return n=i.sent(),r(n,t),[2]}}))}))}))},t}(),Nd=function(){function t(){this.tasks=[]}return t.prototype.promise=function(){return Rd(this.tasks)},t.prototype.tapPromise=function(t,e){0===this.tasks.length?this.tasks.push((function(t){e().then((function(e){t(null,e)}))})):this.tasks.push((function(t,n){e(t).then((function(t){n(null,t)}))}))},t}(),zd=n(96425),Fd=n.n(zd);function Bd(t){var e=Ud();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Ud(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var jd=(Qp=(0,xc.b2)(),Jp=(0,xc.f3)(wc.SceneID),$p=(0,xc.f3)(wc.IIconService),td=(0,xc.f3)(wc.IFontService),ed=(0,xc.f3)(wc.IControlService),nd=(0,xc.f3)(wc.IGlobalConfigService),rd=(0,xc.f3)(wc.IMapService),id=(0,xc.f3)(wc.ICoordinateSystemService),od=(0,xc.f3)(wc.IRendererService),ad=(0,xc.f3)(wc.ILayerService),sd=(0,xc.f3)(wc.IDebugService),ud=(0,xc.f3)(wc.ICameraService),cd=(0,xc.f3)(wc.IInteractionService),ld=(0,xc.f3)(wc.IPickingService),hd=(0,xc.f3)(wc.IShaderModuleService),fd=(0,xc.f3)(wc.IMarkerService),pd=(0,xc.f3)(wc.IPopupService),Qp((vd=function(t){Yt(n,t);var e=Bd(n);function n(){var t;return Ot(this,n),t=e.call(this),(0,Ft.Z)(Kt(t),"destroyed",!1),(0,Ft.Z)(Kt(t),"loaded",!1),Oh(Kt(t),"id",md,Kt(t)),Oh(Kt(t),"iconService",gd,Kt(t)),Oh(Kt(t),"fontService",yd,Kt(t)),Oh(Kt(t),"controlService",_d,Kt(t)),Oh(Kt(t),"configService",xd,Kt(t)),Oh(Kt(t),"map",bd,Kt(t)),Oh(Kt(t),"coordinateSystemService",wd,Kt(t)),Oh(Kt(t),"rendererService",Ed,Kt(t)),Oh(Kt(t),"layerService",Sd,Kt(t)),Oh(Kt(t),"debugService",Ad,Kt(t)),Oh(Kt(t),"cameraService",Td,Kt(t)),Oh(Kt(t),"interactionService",Cd,Kt(t)),Oh(Kt(t),"pickingService",kd,Kt(t)),Oh(Kt(t),"shaderModuleService",Md,Kt(t)),Oh(Kt(t),"markerService",Pd,Kt(t)),Oh(Kt(t),"popupService",Id,Kt(t)),(0,Ft.Z)(Kt(t),"inited",!1),(0,Ft.Z)(Kt(t),"initPromise",void 0),(0,Ft.Z)(Kt(t),"rendering",!1),(0,Ft.Z)(Kt(t),"$container",void 0),(0,Ft.Z)(Kt(t),"canvas",void 0),(0,Ft.Z)(Kt(t),"markerContainer",void 0),(0,Ft.Z)(Kt(t),"hooks",void 0),(0,Ft.Z)(Kt(t),"handleWindowResized",(function(){t.emit("resize"),t.$container&&(t.initContainer(),Yi(),t.coordinateSystemService.needRefresh=!0,t.render())})),(0,Ft.Z)(Kt(t),"handleMapCameraChanged",(function(e){t.cameraService.update(e),t.render()})),t.hooks={init:new Od},t}return zt(n,[{key:"init",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return e.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.debugService.log("map.mapInitStart",{type:e.map.version}),t.next=3,new Promise((function(t){e.map.onCameraChanged((function(n){e.cameraService.init(),e.cameraService.update(n),t()})),e.map.init()}));case 3:e.map.onCameraChanged(e.handleMapCameraChanged),e.map.addMarkerContainer(),e.markerService.addMarkers(),e.markerService.addMarkerLayers(),e.popupService.initPopup(),e.interactionService.init(),e.interactionService.on(rf.Drag,e.addSceneEvent.bind(e));case 10:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",(0,J.Z)(tt().mark((function n(){var r,i;return tt().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=e.map.getOverlayContainer(),e.$container=r||Rf(e.configService.getSceneConfig(e.id).id||""),!e.$container){n.next=13;break}return e.canvas=Bi("canvas","",e.$container),e.setCanvas(),n.next=7,e.rendererService.init(e.canvas,e.configService.getSceneConfig(e.id),t.gl);case 7:e.registerContextLost(),e.initContainer(),Fd()(e.$container,e.handleWindowResized),xr.matchMedia&&(null===(i=xr.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))||void 0===i||i.addListener(e.handleWindowResized)),n.next=14;break;case 13:case 14:e.pickingService.init(e.id);case 15:case"end":return n.stop()}}),n)})))),this.render()}},{key:"registerContextLost",value:function(){var t=this,e=this.rendererService.getCanvas();e&&e.addEventListener("webglcontextlost",(function(){return t.emit("webglcontextlost")}))}},{key:"initMiniScene",value:function(t){var e=this;this.configService.setSceneConfig(this.id,t),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",(function(){return e.render()})),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,new Promise((function(t){e.map.onCameraChanged((function(n){e.cameraService.init(),e.cameraService.update(n),"GAODE2.x"!==e.map.version&&t()})),e.map.initMiniMap()}));case 2:e.map.onCameraChanged(e.handleMapCameraChanged),e.interactionService.init(),e.interactionService.on(rf.Drag,e.addSceneEvent.bind(e));case 5:case"end":return t.stop()}}),t)})))),this.hooks.init.tapPromise("initRenderer",(0,J.Z)(tt().mark((function n(){var r;return tt().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r=t.canvas,e.$container=r||null,!e.$container){n.next=7;break}return n.next=5,e.rendererService.init(t.canvas,e.configService.getSceneConfig(e.id),void 0);case 5:n.next=8;break;case 7:case 8:e.pickingService.init(e.id);case 9:case"end":return n.stop()}}),n)})))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(t){this.layerService.sceneService=this,this.layerService.add(t)}},{key:"addMask",value:function(t){this.layerService.sceneService=this,this.layerService.addMask(t)}},{key:"render",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!this.rendering&&!this.destroyed){t.next=2;break}return t.abrupt("return");case 2:if(this.rendering=!0,this.inited){t.next=16;break}return t.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),t.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,t.next=20;break;case 16:return t.next=18,this.layerService.initLayers();case 18:return t.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"addFontFace",value:function(t,e){this.fontService.addFontFace(t,e)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var t=(0,J.Z)(tt().mark((function t(e){var n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=null===(n=this.$container)||void 0===n?void 0:n.getElementsByTagName("canvas")[0],t.next=3,this.render();case 3:return i="jpg"===e?null===r||void 0===r?void 0:r.toDataURL("image/jpeg"):null===r||void 0===r?void 0:r.toDataURL("image/png"),t.abrupt("return",i);case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var t=this.$container.parentElement;null!==t&&(this.markerContainer=Bi("div","l7-marker-container",t))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var t,e,n=this;if(this.inited){var r;if((0,zd.unbind)(this.$container,this.handleWindowResized),xr.matchMedia)null===(r=xr.matchMedia("screen and (min-resolution: 2dppx)"))||void 0===r||r.removeListener(this.handleWindowResized);this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout((function(){var t;null===(t=n.$container)||void 0===t||t.removeChild(n.canvas),n.canvas=null,n.rendererService.destroy()})),null===(t=this.$container)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$container),this.emit("destroy")}else this.destroyed=!0}},{key:"initContainer",value:function(){var t,e,n=$i,r=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o&&(o.width=r*n,o.height=i*n),this.rendererService.viewport({x:0,y:0,width:n*r,height:n*i})}},{key:"setCanvas",value:function(){var t,e,n=$i,r=(null===(t=this.$container)||void 0===t?void 0:t.clientWidth)||400,i=(null===(e=this.$container)||void 0===e?void 0:e.clientHeight)||300,o=this.canvas;o.width=r*n,o.height=i*n,o.style.width="100%",o.style.height="100%"}},{key:"addSceneEvent",value:function(t){this.emit(t.type,t)}}]),n}(Ma.EventEmitter),md=Dh(vd.prototype,"id",[Jp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),gd=Dh(vd.prototype,"iconService",[$p],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yd=Dh(vd.prototype,"fontService",[td],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_d=Dh(vd.prototype,"controlService",[ed],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xd=Dh(vd.prototype,"configService",[nd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bd=Dh(vd.prototype,"map",[rd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd=Dh(vd.prototype,"coordinateSystemService",[id],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ed=Dh(vd.prototype,"rendererService",[od],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Sd=Dh(vd.prototype,"layerService",[ad],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Ad=Dh(vd.prototype,"debugService",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Td=Dh(vd.prototype,"cameraService",[ud],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Cd=Dh(vd.prototype,"interactionService",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),kd=Dh(vd.prototype,"pickingService",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Md=Dh(vd.prototype,"shaderModuleService",[hd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pd=Dh(vd.prototype,"markerService",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Id=Dh(vd.prototype,"popupService",[pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dd=vd))||dd);function Zd(t){var e=0;switch(t){case"vec2":case"ivec2":e=2;break;case"vec3":case"ivec3":e=3;break;case"vec4":case"ivec4":case"mat2":e=4;break;case"mat3":e=9;break;case"mat4":e=16;break;default:}return e}var Vd,Gd,Hd=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function Wd(t){var e={};return t=t.replace(Hd,(function(t,n,r){var i=r.split(":"),o=i[0].trim(),a="";switch(i.length>1&&(a=i[1].trim()),n){case"bool":a="true"===a;break;case"float":case"int":a=Number(a);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":a=a?a.replace("[","").replace("]","").split(",").reduce((function(t,e){return t.push(Number(e.trim())),t}),[]):new Array(Zd(n)).fill(0);break;default:}return e[o]=a,"uniform ".concat(n," ").concat(o,";\n")})),{content:t,uniforms:e}}var qd,Xd,Yd,Kd="#define PI 3.14159265359",Qd="#ifdef USE_ATTRIBUTE_OPACITY\n  attribute float a_Opacity;\n#endif\n\n#ifdef USE_ATTRIBUTE_OFFSETS\n  attribute vec2 a_Offsets;\n#endif\n\n#ifdef USE_ATTRIBUTE_STROKE\n  attribute vec4 a_Stroke;\n#endif",Jd="#define SHIFT_RIGHT17 1.0 / 131072.0\n#define SHIFT_RIGHT18 1.0 / 262144.0\n#define SHIFT_RIGHT19 1.0 / 524288.0\n#define SHIFT_RIGHT20 1.0 / 1048576.0\n#define SHIFT_RIGHT21 1.0 / 2097152.0\n#define SHIFT_RIGHT22 1.0 / 4194304.0\n#define SHIFT_RIGHT23 1.0 / 8388608.0\n#define SHIFT_RIGHT24 1.0 / 16777216.0\n\n#define SHIFT_LEFT17 131072.0\n#define SHIFT_LEFT18 262144.0\n#define SHIFT_LEFT19 524288.0\n#define SHIFT_LEFT20 1048576.0\n#define SHIFT_LEFT21 2097152.0\n#define SHIFT_LEFT22 4194304.0\n#define SHIFT_LEFT23 8388608.0\n#define SHIFT_LEFT24 16777216.0\n\nvec2 unpack_float(float packedValue) {\n  int packedIntValue = int(packedValue);\n  int v0 = packedIntValue / 256;\n  return vec2(v0, packedIntValue - v0 * 256);\n}\n\nvec4 decode_color(vec2 encodedColor) {\n  return vec4(\n    unpack_float(encodedColor[0]) / 255.0,\n    unpack_float(encodedColor[1]) / 255.0\n  );\n}\n",$d="#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n      // //cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(vec3(1, -10.5, 12));\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n      // //lambert\n    float lambert = dot(worldNormal, lightDir);\n        //specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n        //sum to light weight\n    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;\n\n    return lightWeight;\n}\n",tv="// Blinn-Phong model\n// apply lighting in vertex shader instead of fragment shader\n// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting\nuniform float u_Ambient : 1.0;\nuniform float u_Diffuse : 1.0;\nuniform float u_Specular : 1.0;\nuniform int u_NumOfDirectionalLights : 1;\nuniform int u_NumOfSpotLights : 0;\n\n#define SHININESS 32.0\n#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3\n#define MAX_NUM_OF_SPOT_LIGHTS 3\n\nstruct DirectionalLight {\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n};\n\nstruct SpotLight {\n  vec3 position;\n  vec3 direction;\n  vec3 ambient;\n  vec3 diffuse;\n  vec3 specular;\n  float constant;\n  float linear;\n  float quadratic;\n  float angle;\n  float blur;\n  float exponent;\n};\n\nuniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];\nuniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];\n\nvec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {\n  vec3 lightDir = normalize(light.direction);\n  // diffuse shading\n  float diff = max(dot(normal, lightDir), 0.0);\n  // Blinn-Phong specular shading\n  vec3 halfwayDir = normalize(lightDir + viewDir);\n  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);\n\n  vec3 ambient = light.ambient * u_Ambient;\n  vec3 diffuse = light.diffuse * diff * u_Diffuse;\n  vec3 specular = light.specular * spec * u_Specular;\n\n  return ambient + diffuse + specular;\n}\n\n// vec3 calc_spot_light(SpotLight light, vec3 normal, vec3 fragPos, vec3 viewDir) {\n//   vec3 lightDir = normalize(light.position - fragPos);\n//   // diffuse shading\n//   float diff = max(dot(normal, lightDir), 0.0);\n//   // specular shading\n//   vec3 reflectDir = reflect(-lightDir, normal);\n//   float spec = pow(max(dot(viewDir, reflectDir), 0.0), SHININESS);\n//   // attenuation\n//   float distance = length(light.position - fragPos);\n//   float attenuation = 1.0 / (light.constant + light.linear * distance +\n//           light.quadratic * (distance * distance));\n\n//   vec3 ambient = light.ambient * u_Ambient;\n//   vec3 diffuse = light.diffuse * diff * u_Diffuse;\n//   vec3 specular = light.specular * spec * u_Specular;\n\n//   float spotEffect = dot(normalize(light.direction), -lightDir);\n//   float spotCosCutoff = cos(light.angle / 180.0 * PI);\n//   float spotCosOuterCutoff = cos((light.angle + light.blur) / 180.0 * PI);\n//   float spotCosInnerCutoff = cos((light.angle - light.blur) / 180.0 * PI);\n//   if (spotEffect > spotCosCutoff) {\n//     spotEffect = pow(smoothstep(spotCosOuterCutoff, spotCosInnerCutoff, spotEffect), light.exponent);\n//   } else {\n//     spotEffect = 0.0;\n//   }\n\n//   return ambient + attenuation * (spotEffect * diffuse + specular);\n// }\n\nvec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {\n  vec3 weight = vec3(0.0);\n  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {\n    if (i >= u_NumOfDirectionalLights) {\n      break;\n    }\n    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);\n  }\n  // for (int i = 0; i < MAX_NUM_OF_SPOT_LIGHTS; i++) {\n  //   if (i >= u_NumOfSpotLights) {\n  //     break;\n  //   }\n  //   weight += calc_spot_light(u_SpotLights[i], normal, position, viewDir);\n  // }\n  return weight;\n}\n",ev="float opacity = u_opacity;\n\n#ifdef USE_ATTRIBUTE_OPACITY\n    opacity = a_Opacity;\n#endif",nv="varying vec4 v_PickingResult;\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_shaderPick;\n\nuniform float u_activeMix: 0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\n/*\n * Returns highlight color if this item is selected.\n */\nvec4 filterHighlightColor(vec4 color, float weight) {\n  // float selected = v_PickingResult.a;\n  bool selected = bool(v_PickingResult.a);\n\n  // if (selected == SELECT) {\n  if (selected) {\n  //   // 点击选中状态\n  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;\n  //   return selectColor;\n  // } else if (selected == HIGHLIGHT) {\n  //   // hover 高亮状态\n    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;\n\n    float highLightAlpha = highLightColor.a;\n    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));\n\n    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);\n    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);\n  } else {\n    return color;\n  }\n}\n\n/*\n * Returns picking color if picking enabled else unmodified argument.\n */\nvec4 filterPickingColor(vec4 color) {\n  vec3 pickingColor = v_PickingResult.rgb;\n  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {\n    discard;\n  }\n  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;\n}\n\n/*\n * Returns picking color if picking is enabled if not\n * highlight color if this item is selected, otherwise unmodified argument.\n */\nvec4 filterColor(vec4 color) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, 1.0));\n  }\n  \n}\n\nvec4 filterColorAlpha(vec4 color, float alpha) {\n  // 过滤多余的 shader 计算\n  // return color;\n  if(u_shaderPick < 0.5) {\n    return color; // 暂时去除 直接取消计算在选中时拖拽地图会有问题\n  } else {\n    return filterPickingColor(filterHighlightColor(color, alpha));\n  }\n}\n\n",rv="attribute vec3 a_PickingColor;\nvarying vec4 v_PickingResult;\n\nuniform vec3 u_PickingColor : [0, 0, 0];\nuniform vec3 u_CurrentSelectedId : [0, 0, 0];\nuniform vec4 u_HighlightColor : [0, 0, 0, 0];\nuniform vec4 u_SelectColor : [0, 0, 0, 0];\nuniform float u_PickingStage : 0.0;\nuniform float u_PickingThreshold : 1.0;\nuniform float u_PickingBuffer: 0.0;\nuniform float u_shaderPick;\nuniform float u_EnableSelect: 0.0;\n\n#define PICKING_NONE 0.0\n#define PICKING_ENCODE 1.0\n#define PICKING_HIGHLIGHT 2.0\n#define COLOR_SCALE 1. / 255.\n\n#define NORMAL 0.0\n#define HIGHLIGHT 1.0\n#define SELECT 2.0\n\nbool isVertexPicked(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_PickingColor.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_PickingColor.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_PickingColor.b) < u_PickingThreshold;\n}\n\n// 判断当前点是否已经被 select 选中\nbool isVertexSelected(vec3 vertexColor) {\n  return\n    abs(vertexColor.r - u_CurrentSelectedId.r) < u_PickingThreshold &&\n    abs(vertexColor.g - u_CurrentSelectedId.g) < u_PickingThreshold &&\n    abs(vertexColor.b - u_CurrentSelectedId.b) < u_PickingThreshold;\n}\n\nvoid setPickingColor(vec3 pickingColor) {\n  if(u_shaderPick < 0.5) {\n    return;\n  }\n  // compares only in highlight stage\n\n  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));\n\n  // if (u_EnableSelect == 1.0 && u_PickingStage == PICKING_HIGHLIGHT && isVertexSelected(pickingColor)) {\n  //   // 选中态\n  //   v_PickingResult.a = SELECT;\n  // } else if (u_PickingStage == PICKING_HIGHLIGHT && isVertexPicked(pickingColor)) {\n  //   // 高亮态\n  //   v_PickingResult.a = HIGHLIGHT;\n  // } else {\n  //   v_PickingResult.a = NORMAL;\n  // }\n\n  // Stores the picking color so that the fragment shader can render it during picking\n  v_PickingResult.rgb = pickingColor * COLOR_SCALE;\n}\n\nfloat setPickingSize(float x) {\n   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;\n}\n\nfloat setPickingOrder(float z) {\n   bool selected = bool(v_PickingResult.a);\n   return selected ? z + 1. : 0.;\n}\n",iv="\n#define E 2.718281828459045\nvec2 ProjectFlat(vec2 lnglat){\n  float maxs=85.0511287798;\n  float lat=max(min(maxs,lnglat.y),-maxs);\n  float scale= 268435456.;\n  float d=PI/180.;\n  float x=lnglat.x*d;\n  float y=lat*d;\n  y=log(tan((PI/4.)+(y/2.)));\n\n  float a=.5/PI,\n  b=.5,\n  c=-.5/PI;\n  d=.5;\n  x=scale*(a*x+b);\n  y=scale*(c*y+d);\n  return vec2(x,y);\n}\n\nvec2 unProjectFlat(vec2 px){\n  float a=.5/PI;\n  float b=.5;\n  float c=-.5/PI;\n  float d=.5;\n  float scale = 268435456.;\n  float x=(px.x/scale-b)/a;\n  float y=(px.y/scale-d)/c;\n  y=(atan(pow(E,y))-(PI/4.))*2.;\n  d=PI/180.;\n  float lat=y/d;\n  float lng=x/d;\n  return vec2(lng,lat);\n}\n\nfloat pixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}\n\n// gaode2.0\nvec2 customProject(vec2 lnglat) { // 经纬度 => 平面坐标\n  float t = lnglat.x;\n  float e = lnglat.y;\n  float Sm = 180.0 / PI;\n  float Tm = 6378137.0;\n  float Rm = PI / 180.0;\n  float r = 85.0511287798;\n  e = max(min(r, e), -r);\n  t *= Rm;\n  e *= Rm;\n  e = log(tan(PI / 4.0 + e / 2.0));\n  return vec2(t * Tm, e * Tm);\n}\n\nvec2 unProjCustomCoord(vec2 point) { // 平面坐标 => 经纬度\n  float Sm = 57.29577951308232; //180 / Math.PI\n  float Tm = 6378137.0;\n  float t = point.x;\n  float e = point.y;\n  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);\n}\n\n\nfloat customPixelDistance(vec2 from, vec2 to) {\n vec2 a1 = ProjectFlat(from);\n vec2 b1 = ProjectFlat(to);\n return distance(a1, b1);\n}",ov="#define TILE_SIZE 512.0\n#define PI 3.1415926536\n#define WORLD_SCALE TILE_SIZE / (PI * 2.0)\n\n#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox\n#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset\n#define COORDINATE_SYSTEM_VECTOR_TILE 3.0\n#define COORDINATE_SYSTEM_IDENTITY 4.0\n#define COORDINATE_SYSTEM_P20 5.0           // amap\n#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset\n#define COORDINATE_SYSTEM_METER_OFFSET 7.0\n\n#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0\n\nuniform mat4 u_ViewMatrix;\nuniform mat4 u_ProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrix;\nuniform float u_Zoom : 1;\nuniform float u_ZoomScale : 1;\n\nuniform float u_CoordinateSystem;\nuniform vec2 u_ViewportCenter;\nuniform vec4 u_ViewportCenterProjection;\nuniform vec3 u_PixelsPerDegree;\nuniform vec3 u_PixelsPerDegree2;\nuniform vec3 u_PixelsPerMeter;\n\nuniform vec2 u_ViewportSize;\nuniform float u_DevicePixelRatio;\nuniform float u_FocalDistance;\nuniform vec3 u_CameraPosition;\n\n// uniform mat4 u_Mvp;\n\n// web mercator coords -> world coords\nvec2 project_mercator(vec2 lnglat) {\n  float x = lnglat.x;\n  return vec2(\n    radians(x) + PI,\n    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))\n  );\n}\n\nfloat project_scale(float meters) {\n  return meters * u_PixelsPerMeter.z;\n}\n\n\n// offset coords -> world coords\nvec4 project_offset(vec4 offset) {\n  float dy = offset.y;\n  dy = clamp(dy, -1., 1.);\n  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;\n  return vec4(offset.xyz * pixels_per_unit, offset.w);\n}\n\nvec3 project_normal(vec3 normal) {\n  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);\n  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);\n}\n\nvec3 project_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01\n    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // normals generated by the polygon tesselator are in lnglat offsets instead of meters\n    return normalize(vector * u_PixelsPerDegree);\n  }\n  return project_normal(vector);\n}\n// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01\n// reverse Y\nvec3 reverse_offset_normal(vec3 vector) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {\n    return vector * vec3(1.0, -1.0, 1.0);\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0\n    return vector;\n  }\n  return vector;\n}\n\nvec4 project_mvt_offset_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return project_offset(vec4(0.0, 0.0, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n  return position;\n}\n\nvec4 project_position(vec4 position) {\n  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;\n  float b = COORDINATE_SYSTEM_P20_OFFSET;\n  float c = COORDINATE_SYSTEM_LNGLAT;\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET\n    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    float X = position.x - u_ViewportCenter.x;\n    float Y = position.y - u_ViewportCenter.y;\n    return project_offset(vec4(X, Y, position.z, position.w));\n  }\n  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {\n    return vec4(\n      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return vec4(\n      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),\n      project_scale(position.z),\n      position.w\n    );\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // return vec4(\n    //   (position.xy * WORLD_SCALE * u_ZoomScale) * vec2(1., -1.), \n    //   project_scale(position.z), \n    //   position.w);\n\n     return vec4(\n      position.xy, \n      project_scale(position.z), \n      position.w);\n  }\n  return position;\n\n  // TODO: 瓦片坐标系 & 常规世界坐标系\n}\nvec2 project_pixel_size_to_clipspace(vec2 pixels) {\n  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;\n  return offset * u_FocalDistance;\n}\n\nfloat project_pixel_allmap(float pixel) {\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {\n    return pixel * pow(2.0, u_Zoom);\n  }\n  return pixel * u_FocalDistance ;\n}\n\n// 适配纹理贴图的等像素大小\nfloat project_pixel_texture(float pixel) {\n  // mapbox zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;\n  }\n\n  // amap2 zoom > 12\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n\n  // amap zoom > 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;\n  }\n  \n  // amap zoom < 12\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {\n    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * 2.0 *  u_FocalDistance;;\n}\n\n// 在不论什么底图下需要统一处理的时候使用\nfloat project_float_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // mapbox P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom));\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\n\nfloat project_pixel(float pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // amap P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // amap2 P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * u_FocalDistance;\n}\nvec2 project_pixel(vec2 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\nvec3 project_pixel(vec3 pixel) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n    // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;\n  }\n  return pixel * -1. * u_FocalDistance;\n}\n\nvec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n    position.w *= u_PixelsPerMeter.z;\n  }\n\n  return viewProjectionMatrix * position + center;\n}\n\n// Projects from common space coordinates to clip space\nvec4 project_common_position_to_clipspace(vec4 position) {\n  return project_common_position_to_clipspace(\n    position,\n    u_ViewProjectionMatrix,\n    u_ViewportCenterProjection\n  );\n}\n\nvec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {\n  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);\n\n  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||\n    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    // Needs to be divided with project_uCommonUnitsPerMeter\n     pos.w = pos.w / u_PixelsPerMeter.z;\n  }\n  return pos;\n}\n\n\nbool isEqual( float a,  float b) {\n    return  a< b + 0.001 && a > b - 0.001;\n}",av="/**\n * 2D signed distance field functions\n * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm\n */\n\nfloat ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }\n\nfloat sdCircle(vec2 p, float r) {\n  return length(p) - r;\n}\n\nfloat sdEquilateralTriangle(vec2 p) {\n  float k = sqrt(3.0);\n  p.x = abs(p.x) - 1.0;\n  p.y = p.y + 1.0/k;\n  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;\n  p.x -= clamp( p.x, -2.0, 0.0 );\n  return -length(p)*sign(p.y);\n}\n\nfloat sdBox(vec2 p, vec2 b) {\n  vec2 d = abs(p)-b;\n  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);\n}\n\nfloat sdPentagon(vec2 p, float r) {\n  vec3 k = vec3(0.809016994,0.587785252,0.726542528);\n  p.x = abs(p.x);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagon(vec2 p, float r) {\n  vec3 k = vec3(-0.866025404,0.5,0.577350269);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdOctogon(vec2 p, float r) {\n  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );\n  p = abs(p);\n  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);\n  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);\n  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdHexagram(vec2 p, float r) {\n  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);\n  p = abs(p);\n  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;\n  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;\n  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);\n  return length(p)*sign(p.y);\n}\n\nfloat sdRhombus(vec2 p, vec2 b) {\n  vec2 q = abs(p);\n  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);\n  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );\n  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );\n}\n\nfloat sdVesica(vec2 p, float r, float d) {\n  p = abs(p);\n  float b = sqrt(r*r-d*d); // can delay this sqrt\n  return ((p.y-b)*d>p.x*b)\n          ? length(p-vec2(0.0,b))\n          : length(p-vec2(-d,0.0))-r;\n}\n",sv=/precision\s+(high|low|medium)p\s+float/,uv="#ifdef GL_FRAGMENT_PRECISION_HIGH\n precision highp float;\n #else\n precision mediump float;\n#endif\n",cv=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,lv=/void\s+main\s*\([^)]*\)\s*\{\n?/,hv=(Vd=(0,xc.b2)(),Vd(Gd=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"moduleCache",{}),(0,Ft.Z)(this,"rawContentCache",{})}return zt(t,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:Kd,fs:Kd}),this.registerModule("decode",{vs:Jd,fs:""}),this.registerModule("projection",{vs:ov,fs:""}),this.registerModule("project",{vs:iv,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:av}),this.registerModule("lighting",{vs:tv,fs:""}),this.registerModule("light",{vs:$d,fs:""}),this.registerModule("picking",{vs:rv,fs:nv}),this.registerModule("commom_attr_vert",{vs:Qd,fs:""}),this.registerModule("opacity_attr_vert",{vs:ev,fs:""})}},{key:"registerModule",value:function(t,e){var n=e.vs,r=e.fs,i=e.uniforms,o=e.inject,a=Wd(n),s=a.content,u=a.uniforms,c=Wd(r),l=c.content,h=c.uniforms;this.rawContentCache[t]={fs:l,inject:o,uniforms:(0,k.Z)((0,k.Z)((0,k.Z)({},u),h),i),vs:s}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var e=this,n=this.rawContentCache[t].vs,r=this.rawContentCache[t].fs,i=this.rawContentCache[t].inject,o={};null!==i&&void 0!==i&&i["vs:#decl"]&&(n=(null===i||void 0===i?void 0:i["vs:#decl"])+n,o=Wd(null===i||void 0===i?void 0:i["vs:#decl"]).uniforms),null!==i&&void 0!==i&&i["vs:#main-start"]&&(n=n.replace(lv,(function(t){return t+(null===i||void 0===i?void 0:i["vs:#main-start"])})));var a=this.processModule(n,[],"vs"),s=a.content,u=a.includeList,c=this.processModule(r,[],"fs"),l=c.content,h=c.includeList,f="",p=(0,Oi.uniq)(u.concat(h).concat(t)).reduce((function(t,n){return(0,k.Z)((0,k.Z)({},t),e.rawContentCache[n].uniforms)}),(0,k.Z)({},o));return sv.test(l)||(f+=uv),f+=l,this.moduleCache[t]={fs:f.trim(),uniforms:p,vs:s.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,e,n){var r=this,i=t.replace(cv,(function(t,i){var o=i.split(" "),a=o[0].replace(/"/g,"");if(e.indexOf(a)>-1)return"";var s=r.rawContentCache[a][n];e.push(a);var u=r.processModule(s,e,n),c=u.content;return c}));return{content:i,includeList:e}}},{key:"injectDefines",value:function(t){var e=Object.keys(t).reduce((function(e,n){return e+"#define ".concat(n.toUpperCase()," ").concat(t[n],";\n")}),"\n");return e}}]),t}())||Gd);function fv(t,e){while(!Object.prototype.hasOwnProperty.call(t,e))if(t=Jt(t),null===t)break;return t}function pv(){return pv="undefined"!==typeof Reflect&&Reflect.get?Reflect.get.bind():function(t,e,n){var r=fv(t,e);if(r){var i=Object.getOwnPropertyDescriptor(r,e);return i.get?i.get.call(arguments.length<3?t:n):i.value}},pv.apply(this,arguments)}(function(t){t["Normal"]="normal",t["PostProcessing"]="post-processing"})(qd||(qd={}));var dv,vv,mv=(Xd=(0,xc.b2)(),Xd(Yd=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"shaderModuleService",void 0),(0,Ft.Z)(this,"rendererService",void 0),(0,Ft.Z)(this,"cameraService",void 0),(0,Ft.Z)(this,"mapService",void 0),(0,Ft.Z)(this,"interactionService",void 0),(0,Ft.Z)(this,"layerService",void 0),(0,Ft.Z)(this,"config",void 0)}return zt(t,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return qd.Normal}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(wc.IRendererService),this.cameraService=t.getContainer().get(wc.ICameraService),this.mapService=t.getContainer().get(wc.IMapService),this.interactionService=t.getContainer().get(wc.IInteractionService),this.layerService=t.getContainer().get(wc.ILayerService),this.shaderModuleService=t.getContainer().get(wc.IShaderModuleService)}},{key:"render",value:function(t){}}]),t}())||Yd);function gv(t){var e=yv();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function yv(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var _v,xv,bv,wv,Ev,Sv=(dv=(0,xc.b2)(),dv(vv=function(t){Yt(n,t);var e=gv(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(t,e){pv(Jt(n.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),n}(mv))||vv);function Av(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Tv(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Tv(t,e){if(t){if("string"===typeof t)return Cv(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Cv(t,e):void 0}}function Cv(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var kv,Mv,Pv=(_v=(0,xc.b2)(),xv=(0,xc.f3)(wc.IPostProcessor),_v((wv=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"passes",[]),Oh(this,"postProcessor",Ev,this),(0,Ft.Z)(this,"layer",void 0),(0,Ft.Z)(this,"renderFlag",void 0),(0,Ft.Z)(this,"width",0),(0,Ft.Z)(this,"height",0)}return zt(t,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=Av(this.passes),t.prev=1,e.s();case 3:if((n=e.n()).done){t.next=9;break}return r=n.value,t.next=7,r.render(this.layer);case 7:t.next=3;break;case 9:t.next=14;break;case 11:t.prev=11,t.t0=t["catch"](1),e.e(t.t0);case 14:return t.prev=14,e.f(),t.finish(14);case 17:return t.next=19,this.postProcessor.render(this.layer);case 19:case"end":return t.stop()}}),t,this,[[1,11,14,17]])})));function e(){return t.apply(this,arguments)}return e}()},{key:"resize",value:function(t,e){this.width===t&&this.height===e||(this.postProcessor.resize(t,e),this.width=t,this.height=e)}},{key:"add",value:function(t,e){t.getType()===qd.PostProcessing?this.postProcessor.add(t,this.layer,e):(t.init(this.layer,e),this.passes.push(t))}},{key:"insert",value:function(t,e,n){t.init(this.layer,e),this.passes.splice(n,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),t}(),Ev=Dh(wv.prototype,"postProcessor",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bv=wv))||bv);function Iv(t){var e=Rv();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Rv(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Lv,Ov,Dv,Nv,zv,Fv,Bv,Uv=(kv=(0,xc.b2)(),kv(Mv=function(t){Yt(n,t);var e=Iv(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"pickingFBO",void 0),(0,Ft.Z)(Kt(t),"layer",void 0),(0,Ft.Z)(Kt(t),"width",0),(0,Ft.Z)(Kt(t),"height",0),(0,Ft.Z)(Kt(t),"alreadyInRendering",!1),(0,Ft.Z)(Kt(t),"pickFromPickingFBO",(function(e){var n=e.x,r=e.y,i=e.lngLat,o=e.type;if(t.layer.isVisible()&&t.layer.needPick(o)){var a,s=t.rendererService,u=s.getViewportSize,c=s.readPixels,l=s.useFramebuffer,h=u(),f=h.width,p=h.height,d=t.layer.getLayerConfig(),v=d.enableHighlight,m=d.enableSelect,g=n*$i,y=r*$i;if(!(g>f||g<0||y>p||y<0))l(t.pickingFBO,(function(){var e;if(a=c({x:Math.round(g),y:Math.round(p-(r+1)*$i),width:1,height:1,data:new Uint8Array(4),framebuffer:t.pickingFBO}),0!==a[0]||0!==a[1]||0!==a[2]){var s=wi(a),u=t.layer.getSource().getFeatureById(s),l={x:n,y:r,type:o,lngLat:i,featureId:s,feature:u};u&&(t.layer.setCurrentPickId(s),t.triggerHoverOnLayer(l))}else{var h={x:n,y:r,lngLat:i,type:null===t.layer.getCurrentPickId()?"un"+o:"mouseout",featureId:null,feature:null};t.triggerHoverOnLayer((0,k.Z)((0,k.Z)({},h),{},{type:"unpick"})),t.triggerHoverOnLayer(h),t.layer.setCurrentPickId(null)}v&&t.highlightPickedFeature(a),m&&"click"===o&&(null===(e=a)||void 0===e?void 0:e.toString())!==[0,0,0,0].toString()&&t.selectFeature(a)}))}})),t}return zt(n,[{key:"getType",value:function(){return qd.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(t,e){pv(Jt(n.prototype),"init",this).call(this,t,e),this.layer=t;var r=this.rendererService,i=r.createTexture2D,o=r.createFramebuffer,a=r.getViewportSize,s=a(),u=s.width,c=s.height;this.pickingFBO=o({color:i({width:u,height:c,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE})}),this.interactionService.on(rf.Hover,this.pickFromPickingFBO),this.interactionService.on(rf.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(rf.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(t){var e=this;if(!this.alreadyInRendering){var n=this.rendererService,r=n.getViewportSize,i=n.useFramebuffer,o=n.clear,a=r(),s=a.width,u=a.height;this.alreadyInRendering=!0,this.width===s&&this.height===u||(this.pickingFBO.resize({width:s,height:u}),this.width=s,this.height=u),i(this.pickingFBO,(function(){o({framebuffer:e.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var n=e.layer.multiPassRenderer.getRenderFlag();e.layer.multiPassRenderer.setRenderFlag(!1),t.hooks.beforePickingEncode.call(),t.render(),t.hooks.afterPickingEncode.call(),e.layer.multiPassRenderer.setRenderFlag(n),e.alreadyInRendering=!1}))}}},{key:"triggerHoverOnLayer",value:function(t){this.layer.emit(t.type,t)}},{key:"highlightPickedFeature",value:function(t){var e=(0,Li.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeHighlight.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(t){var e=(0,Li.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeSelect.call([n,r,i]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(t){var e=t.featureId,n=Ei(e);this.selectFeature(new Uint8Array(n))}},{key:"highlightFeatureHandle",value:function(t){var e=t.featureId,n=Ei(e);this.highlightPickedFeature(new Uint8Array(n))}}]),n}(mv))||Mv),jv="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",Zv=(Lv=(0,xc.b2)(),Ov=(0,xc.f3)(wc.IShaderModuleService),Lv((Nv=function(){function t(){Ot(this,t),Oh(this,"shaderModuleService",zv,this),(0,Ft.Z)(this,"rendererService",void 0),(0,Ft.Z)(this,"config",void 0),(0,Ft.Z)(this,"quad",jv),(0,Ft.Z)(this,"enabled",!0),(0,Ft.Z)(this,"renderToScreen",!1),(0,Ft.Z)(this,"model",void 0),(0,Ft.Z)(this,"name",void 0),(0,Ft.Z)(this,"optionsToUpdate",{})}return zt(t,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return qd.PostProcessing}},{key:"init",value:function(t,e){this.config=e,this.rendererService=t.getContainer().get(wc.IRendererService),this.shaderModuleService=t.getContainer().get(wc.IShaderModuleService);var n=this.rendererService,r=n.createAttribute,i=n.createBuffer,o=n.createModel,a=this.setupShaders(),s=a.vs,u=a.fs,c=a.uniforms;this.model=o({vs:s,fs:u,attributes:{a_Position:r({buffer:i({data:[-4,-4,4,-4,0,4],type:vf.FLOAT}),size:2})},uniforms:(0,k.Z)((0,k.Z)({u_Texture:null},c),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:"copy"===this.getName()}})}},{key:"render",value:function(t,e){var n=this,r=t.multiPassRenderer.getPostProcessor(),i=this.rendererService,o=i.useFramebuffer,a=i.getViewportSize,s=i.clear,u=a(),c=u.width,l=u.height;o(this.renderToScreen?null:r.getWriteFBO(),(function(){s({framebuffer:r.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var t=(0,k.Z)({u_BloomFinal:0,u_Texture:r.getReadFBO(),u_ViewportSize:[c,l]},n.convertOptionsToUniforms(n.optionsToUpdate));e&&(t.u_BloomFinal=1,t.u_Texture2=e),n.model.draw({uniforms:t})}))}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,k.Z)((0,k.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var e={};return Object.keys(t).forEach((function(n){(0,Oi.isNil)(t[n])||(e["u_".concat((0,Oi.upperFirst)((0,Oi.camelCase)(n)))]=t[n])})),e}}]),t}(),zv=Dh(Nv.prototype,"shaderModuleService",[Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dv=Nv))||Dv);function Vv(t){var e=Gv();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Gv(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Hv,Wv,qv="varying vec2 v_UV;\n\nuniform float u_BloomFinal: 0.0;\nuniform sampler2D u_Texture;\nuniform sampler2D u_Texture2;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_radius: 5.0;\nuniform float u_intensity: 0.3;\nuniform float u_baseRadio: 0.5;\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nfloat luminance(vec4 color) {\n  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;\n}\n\nvoid main() {\n  // vec4 baseColor = texture2D(u_Texture, v_UV);\n\n  float r = sqrt(u_radius);\n\n  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));\n  // c1 *= luminance(c1);\n  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));\n  // c2 *= luminance(c2);\n  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));\n  // c3 *= luminance(c3);\n  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));\n  // c4 *= luminance(c4);\n  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;\n\n  // float lum = luminance(inbloomColor);\n  // inbloomColor.rgb *= lum;\n\n  if(u_BloomFinal > 0.0) {\n    vec4 baseColor = texture2D(u_Texture2, v_UV);\n    float baselum = luminance(baseColor);\n    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);\n    if(baselum <= 0.2) {\n      gl_FragColor = inbloomColor * u_intensity;\n    }\n  } else {\n    gl_FragColor = inbloomColor;\n  }\n}",Xv="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",Yv=(Fv=(0,xc.b2)(),Fv(Bv=function(t){Yt(n,t);var e=Vv(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:Xv,fs:qv});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,k.Z)((0,k.Z)({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return(0,Oi.isNil)(t.bloomRadius)||(e.u_radius=t.bloomRadius),(0,Oi.isNil)(t.bloomIntensity)||(e.u_intensity=t.bloomIntensity),(0,Oi.isNil)(t.bloomBaseRadio)||(e.u_baseRadio=t.bloomBaseRadio),e}}]),n}(Zv))||Bv);function Kv(t){var e=Qv();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Qv(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Jv,$v,tm="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}",em="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",nm=(Hv=(0,xc.b2)(),Hv(Wv=function(t){Yt(n,t);var e=Kv(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:em,fs:tm});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,k.Z)((0,k.Z)({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return(0,Oi.isNil)(t.blurRadius)||(e.u_BlurDir=[t.blurRadius,0]),e}}]),n}(Zv))||Wv);function rm(t){var e=im();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function im(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var om,am,sm="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_BlurDir: [1.0, 0.0];\n\n// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl\nvec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {\n  vec4 color = vec4(0.0);\n  vec2 off1 = vec2(1.3846153846) * direction;\n  vec2 off2 = vec2(3.2307692308) * direction;\n  color += texture2D(image, uv) * 0.2270270270;\n  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;\n  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;\n  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);\n}",um="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",cm=(Jv=(0,xc.b2)(),Jv($v=function(t){Yt(n,t);var e=rm(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:um,fs:sm});var t=this.shaderModuleService.getModule("blur-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,k.Z)((0,k.Z)({},r),{},{u_ViewportSize:[o,a]})}}},{key:"convertOptionsToUniforms",value:function(t){var e={};return(0,Oi.isNil)(t.blurRadius)||(e.u_BlurDir=[0,t.blurRadius]),e}}]),n}(Zv))||$v);function lm(t){var e=hm();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function hm(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var fm,pm,dm='varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Angle : 0;\nuniform float u_Size : 8;\n\n#pragma include "common"\n\nfloat scale = PI / u_Size;\n\nfloat pattern(float u_Angle, vec2 texSize, vec2 texCoord) {\n  float s = sin(u_Angle), c = cos(u_Angle);\n  vec2 tex = texCoord * texSize - u_Center * texSize;\n  vec2 point = vec2(\n    c * tex.x - s * tex.y,\n    s * tex.x + c * tex.y\n  ) * scale;\n  return (sin(point.x) * sin(point.y)) * 4.0;\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js\nvec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {\n  vec3 cmy = 1.0 - color.rgb;\n  float k = min(cmy.x, min(cmy.y, cmy.z));\n  cmy = (cmy - k) / (1.0 - k);\n  cmy = clamp(\n    cmy * 10.0 - 3.0 + vec3(\n      pattern(u_Angle + 0.26179, texSize, texCoord),\n      pattern(u_Angle + 1.30899, texSize, texCoord),\n      pattern(u_Angle, texSize, texCoord)\n    ),\n    0.0,\n    1.0\n  );\n  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);\n  return vec4(1.0 - cmy - k, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);\n}',vm="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",mm=(om=(0,xc.b2)(),om(am=function(t){Yt(n,t);var e=lm(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:vm,fs:dm});var t=this.shaderModuleService.getModule("colorhalftone-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,k.Z)((0,k.Z)({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(Zv))||am);function gm(t){var e=ym();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function ym(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var _m,xm,bm="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",wm="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",Em=(fm=(0,xc.b2)(),fm(pm=function(t){Yt(n,t);var e=gm(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:wm,fs:bm}),this.shaderModuleService.getModule("copy-pass")}}]),n}(Zv))||pm);function Sm(t){var e=Am();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Am(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Tm,Cm,km="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform vec2 u_Center : [0.5, 0.5];\nuniform float u_Scale : 10;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js\nvec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;\n  tex.y /= 0.866025404;\n  tex.x -= tex.y * 0.5;\n  vec2 a;\n  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {\n    a = vec2(floor(tex.x), floor(tex.y));\n  }\n  else a = vec2(ceil(tex.x), ceil(tex.y));\n  vec2 b = vec2(ceil(tex.x), floor(tex.y));\n  vec2 c = vec2(floor(tex.x), ceil(tex.y));\n  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);\n  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);\n  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);\n  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);\n  float alen = length(TEX - A);\n  float blen = length(TEX - B);\n  float clen = length(TEX - C);\n  vec2 choice;\n  if (alen < blen) {\n    if (alen < clen) choice = a;\n    else choice = c;\n  } else {\n    if (blen < clen) choice = b;\n    else choice = c;\n  }\n  choice.x += choice.y * 0.5;\n  choice.y *= 0.866025404;\n  choice *= u_Scale / texSize;\n  return texture2D(texture, choice + u_Center);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}",Mm="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",Pm=(_m=(0,xc.b2)(),_m(xm=function(t){Yt(n,t);var e=Sm(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Mm,fs:km});var t=this.shaderModuleService.getModule("hexagonalpixelate-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,k.Z)((0,k.Z)({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(Zv))||xm);function Im(t){var e=Rm();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Rm(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Lm,Om,Dm="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform vec2 u_ViewportSize: [1.0, 1.0];\nuniform float u_Strength : 0.6;\n\nvec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {\n  vec2 dx = vec2(1.0 / texSize.x, 0.0);\n  vec2 dy = vec2(0.0, 1.0 / texSize.y);\n  vec4 color = texture2D(texture, texCoord);\n  float bigTotal = 0.0;\n  float smallTotal = 0.0;\n  vec3 bigAverage = vec3(0.0);\n  vec3 smallAverage = vec3(0.0);\n  for (float x = -2.0; x <= 2.0; x += 1.0) {\n    for (float y = -2.0; y <= 2.0; y += 1.0) {\n      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;\n      bigAverage += sample;\n      bigTotal += 1.0;\n      if (abs(x) + abs(y) < 2.0) {\n        smallAverage += sample;\n        smallTotal += 1.0;\n      }\n    }\n  }\n  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);\n  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;\n  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);\n}",Nm="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",zm=(Tm=(0,xc.b2)(),Tm(Cm=function(t){Yt(n,t);var e=Im(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:Nm,fs:Dm});var t=this.shaderModuleService.getModule("ink-pass"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService.getViewportSize(),o=i.width,a=i.height;return{vs:e,fs:n,uniforms:(0,k.Z)((0,k.Z)({},r),{},{u_ViewportSize:[o,a]})}}}]),n}(Zv))||Cm);function Fm(t){var e=Bm();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Bm(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Um,jm,Zm="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\nuniform float u_Amount : 0.5;\n\nfloat rand(vec2 co) {\n  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);\n}\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js\nvec4 noise_filterColor(vec4 color, vec2 texCoord) {\n  float diff = (rand(texCoord) - 0.5) * u_Amount;\n  color.r += diff;\n  color.g += diff;\n  color.b += diff;\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);\n}",Vm="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",Gm=(Lm=(0,xc.b2)(),Lm(Om=function(t){Yt(n,t);var e=Fm(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:Vm,fs:Zm}),this.shaderModuleService.getModule("noise-pass")}}]),n}(Zv))||Om);function Hm(t){var e=Wm();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Wm(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var qm,Xm,Ym,Km,Qm,Jm,$m,tg,eg="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}",ng="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nuniform float u_Amount : 0.5;\n\n// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js\nvec4 sepia_filterColor(vec4 color) {\n  float r = color.r;\n  float g = color.g;\n  float b = color.b;\n  color.r =\n    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));\n  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));\n  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));\n  return color;\n}\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n  gl_FragColor = sepia_filterColor(gl_FragColor);\n}",rg=(Um=(0,xc.b2)(),Um(jm=function(t){Yt(n,t);var e=Hm(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:eg,fs:ng}),this.shaderModuleService.getModule("sepia-pass")}}]),n}(Zv))||jm),ig=(qm=(0,xc.b2)(),Xm=(0,xc.f3)(wc.IRendererService),Ym=(0,xc.zY)(),qm((Qm=function(){function t(){Ot(this,t),Oh(this,"rendererService",Jm,this),(0,Ft.Z)(this,"passes",[]),(0,Ft.Z)(this,"readFBO",void 0),(0,Ft.Z)(this,"writeFBO",void 0)}return zt(t,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,e=t.getViewportSize,n=t.createTexture2D,r=e(),i=r.width,o=r.height;return n({x:0,y:0,width:i,height:o,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,e=this.rendererService.useFramebuffer;return new Promise((function(n){e(t.readFBO,(0,J.Z)(tt().mark((function e(){return tt().wrap((function(e){while(1)switch(e.prev=e.next){case 0:n(t.getCurrentFBOTex());case 1:case"end":return e.stop()}}),e)}))))}))}},{key:"renderBloomPass",value:function(){var t=(0,J.Z)(tt().mark((function t(e,n){var r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.getReadFBOTex();case 2:r=t.sent,i=0;case 4:if(!(i<4)){t.next=11;break}return t.next=7,n.render(e,r);case 7:this.swap(),i++,t.next=4;break;case 11:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"render",value:function(){var t=(0,J.Z)(tt().mark((function t(e){var n,r;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:n=0;case 1:if(!(n<this.passes.length)){t.next=15;break}if(r=this.passes[n],r.setRenderToScreen(this.isLastEnabledPass(n)),"bloom"!==r.getName()){t.next=9;break}return t.next=7,this.renderBloomPass(e,r);case 7:t.next=12;break;case 9:return t.next=11,r.render(e);case 11:n!==this.passes.length-1&&this.swap();case 12:n++,t.next=1;break;case 15:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"resize",value:function(t,e){this.readFBO.resize({width:t,height:e}),this.writeFBO.resize({width:t,height:e})}},{key:"add",value:function(t,e,n){t.init(e,n),this.passes.push(t)}},{key:"insert",value:function(t,e,n,r){t.init(n,r),this.passes.splice(e,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find((function(e){return e.getName()===t}))}},{key:"init",value:function(){var t=this.rendererService,e=t.createFramebuffer,n=t.createTexture2D;this.readFBO=e({color:n({width:1,height:1,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE})}),this.writeFBO=e({color:n({width:1,height:1,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var e=t+1;e<this.passes.length;e++)if(this.passes[e].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),t}(),Jm=Dh(Qm.prototype,"rendererService",[Xm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Dh(Qm.prototype,"init",[Ym],Object.getOwnPropertyDescriptor(Qm.prototype,"init"),Qm.prototype),Km=Qm))||Km);function og(t){var e=ag();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function ag(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var sg,ug,cg,lg,hg,fg=($m=(0,xc.b2)(),$m(tg=function(t){Yt(n,t);var e=og(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getType",value:function(){return qd.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(t,e){pv(Jt(n.prototype),"init",this).call(this,t,e)}},{key:"render",value:function(t){var e=this.rendererService,n=e.useFramebuffer,r=e.clear,i=t.multiPassRenderer.getPostProcessor().getReadFBO();n(i,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i}),t.multiPassRenderer.setRenderFlag(!1),t.models.forEach((function(e){e.draw({uniforms:t.layerModel.getUninforms()})})),t.multiPassRenderer.setRenderFlag(!0)}))}}]),n}(mv))||tg);function pg(t){var e=dg();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function dg(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var vg="uniform float u_opacity : 1.0;\nuniform float u_MixRatio : 0.5;\n\nuniform sampler2D u_Diffuse1;\nuniform sampler2D u_Diffuse2;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  vec4 texel1 = texture2D(u_Diffuse1, v_UV);\n  vec4 texel2 = texture2D(u_Diffuse2, v_UV);\n  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);\n}\n",mg="varying vec2 v_UV;\n\nuniform sampler2D u_Texture;\n\nvoid main() {\n  gl_FragColor = vec4(texture2D(u_Texture, v_UV));\n}",gg="attribute vec2 a_Position;\n\nvarying vec2 v_UV;\n\nvoid main() {\n  v_UV = 0.5 * (a_Position + 1.0);\n  gl_Position = vec4(a_Position, 0., 1.);\n}";function yg(t,e){var n=0,r=1/e,i=t;while(i>0)n+=r*(i%e),i=Math.floor(i/e),r/=e;return n}var _g=1,xg=(sg=(0,xc.b2)(),ug=(0,xc.f3)(wc.IShaderModuleService),sg((lg=function(t){Yt(n,t);var e=pg(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),Oh(Kt(t),"shaderModuleService",hg,Kt(t)),(0,Ft.Z)(Kt(t),"haltonSequence",[]),(0,Ft.Z)(Kt(t),"accumulatingId",0),(0,Ft.Z)(Kt(t),"frame",0),(0,Ft.Z)(Kt(t),"timer",void 0),(0,Ft.Z)(Kt(t),"sampleRenderTarget",void 0),(0,Ft.Z)(Kt(t),"prevRenderTarget",void 0),(0,Ft.Z)(Kt(t),"outputRenderTarget",void 0),(0,Ft.Z)(Kt(t),"copyRenderTarget",void 0),(0,Ft.Z)(Kt(t),"blendModel",void 0),(0,Ft.Z)(Kt(t),"outputModel",void 0),(0,Ft.Z)(Kt(t),"copyModel",void 0),t}return zt(n,[{key:"getType",value:function(){return qd.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(t,e){pv(Jt(n.prototype),"init",this).call(this,t,e);var r=this.rendererService,i=r.createFramebuffer,o=r.createTexture2D;this.sampleRenderTarget=i({color:o({width:1,height:1,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE})}),this.prevRenderTarget=i({color:o({width:1,height:1,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE})}),this.outputRenderTarget=i({color:o({width:1,height:1,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE})}),this.copyRenderTarget=i({color:o({width:1,height:1,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE})});for(var a=0;a<30;a++)this.haltonSequence.push([yg(a,2),yg(a,3)]);this.blendModel=this.createTriangleModel("blend-pass",vg),this.outputModel=this.createTriangleModel("copy-pass",mg,{blend:{enable:!0,func:{srcRGB:vf.ONE,dstRGB:vf.ONE_MINUS_SRC_ALPHA,srcAlpha:vf.ONE,dstAlpha:vf.ONE_MINUS_SRC_ALPHA},equation:{rgb:vf.FUNC_ADD,alpha:vf.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",mg)}},{key:"render",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height;this.sampleRenderTarget.resize({width:s,height:u}),this.prevRenderTarget.resize({width:s,height:u}),this.outputRenderTarget.resize({width:s,height:u}),this.copyRenderTarget.resize({width:s,height:u}),this.resetFrame(),this.stopAccumulating();var c=t.multiPassRenderer.getPostProcessor().getReadFBO();o(c,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:c}),t.multiPassRenderer.setRenderFlag(!1),t.render(),t.multiPassRenderer.setRenderFlag(!0)}));var l=function n(r){e.accumulatingId&&r===e.accumulatingId&&(e.isFinished()||(e.doRender(t),xr.requestAnimationFrame((function(){n(r)}))))};this.accumulatingId=_g++,this.timer=xr.setTimeout((function(){l(e.accumulatingId)}),50)}},{key:"doRender",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.getViewportSize,o=n.useFramebuffer,a=i(),s=a.width,u=a.height,c=t.getLayerConfig(),l=c.jitterScale,h=void 0===l?1:l,f=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((2*f[0]-1)/s*h,(2*f[1]-1)/u*h),t.multiPassRenderer.setRenderFlag(!1),t.hooks.beforeRender.call(),o(this.sampleRenderTarget,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.sampleRenderTarget}),t.render()})),t.hooks.afterRender.call(),t.multiPassRenderer.setRenderFlag(!0);var p=t.getLayerConfig();o(this.outputRenderTarget,(function(){e.blendModel.draw({uniforms:{u_opacity:p.opacity||1,u_MixRatio:0===e.frame?1:.9,u_Diffuse1:e.sampleRenderTarget,u_Diffuse2:0===e.frame?t.multiPassRenderer.getPostProcessor().getReadFBO():e.prevRenderTarget}})})),0===this.frame&&r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(o(this.copyRenderTarget,(function(){e.outputModel.draw({uniforms:{u_Texture:e.outputRenderTarget}})})),o(t.multiPassRenderer.getPostProcessor().getReadFBO(),(function(){e.copyModel.draw({uniforms:{u_Texture:e.copyRenderTarget}})})),t.multiPassRenderer.getPostProcessor().render(t));var d=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=d,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,xr.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(t,e,n){this.shaderModuleService.registerModule(t,{vs:gg,fs:e});var r=this.shaderModuleService.getModule(t),i=r.vs,o=r.fs,a=r.uniforms,s=this.rendererService,u=s.createAttribute,c=s.createBuffer,l=s.createModel;return l((0,k.Z)({vs:i,fs:o,attributes:{a_Position:u({buffer:c({data:[-4,-4,4,-4,0,4],type:vf.FLOAT}),size:2})},uniforms:(0,k.Z)({},a),depth:{enable:!1},count:3},n))}}]),n}(mv),hg=Dh(lg.prototype,"shaderModuleService",[ug],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cg=lg))||cg),bg=new xc.W2;bg.bind(wc.IGlobalConfigService).to(Lh).inSingletonScope(),(0,xc.GW)((0,xc.b2)(),Ma.EventEmitter),bg.bind(wc.IEventEmitter).to(Ma.EventEmitter);var wg=(0,bc.Z)(bg,!1),Eg=function(t){var e=wg.lazyInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}},Sg=function(t){var e=wg.lazyMultiInject(t);return function(t,n,r){e.call(this,t,n),r&&(r.initializer=function(){return t[n]})}},Ag=bg,Tg=0;function Cg(){var t=new xc.W2;return t.parent=bg,t.bind(wc.SceneID).toConstantValue("".concat(Tg++)),t.bind(wc.IShaderModuleService).to(hv).inSingletonScope(),t.bind(wc.ILayerService).to(Kf).inSingletonScope(),t.bind(wc.IDebugService).to(lf).inSingletonScope(),t.bind(wc.ISceneService).to(jd).inSingletonScope(),t.bind(wc.ICameraService).to(hh).inSingletonScope(),t.bind(wc.ICoordinateSystemService).to(tf).inSingletonScope(),t.bind(wc.IInteractionService).to(Pf).inSingletonScope(),t.bind(wc.IPickingService).to(Vf).inSingletonScope(),t.bind(wc.IControlService).to(Sh).inSingletonScope(),t.bind(wc.IMarkerService).to(Ah).inSingletonScope(),t.bind(wc.IIconService).to(ul).inSingletonScope(),t.bind(wc.IFontService).to(nl).inSingletonScope(),t.bind(wc.IPopupService).to(Th).inSingletonScope(),t.bind(wc.INormalPass).to(Sv).whenTargetNamed("clear"),t.bind(wc.INormalPass).to(Uv).whenTargetNamed("pixelPicking"),t.bind(wc.INormalPass).to(fg).whenTargetNamed("render"),t.bind(wc.INormalPass).to(xg).whenTargetNamed("taa"),t.bind(wc.IFactoryNormalPass).toFactory((function(t){return function(e){return t.container.getNamed(wc.INormalPass,e)}})),t.bind(wc.IPostProcessingPass).to(Em).whenTargetNamed("copy"),t.bind(wc.IPostProcessingPass).to(Yv).whenTargetNamed("bloom"),t.bind(wc.IPostProcessingPass).to(nm).whenTargetNamed("blurH"),t.bind(wc.IPostProcessingPass).to(cm).whenTargetNamed("blurV"),t.bind(wc.IPostProcessingPass).to(Gm).whenTargetNamed("noise"),t.bind(wc.IPostProcessingPass).to(rg).whenTargetNamed("sepia"),t.bind(wc.IPostProcessingPass).to(mm).whenTargetNamed("colorHalftone"),t.bind(wc.IPostProcessingPass).to(Pm).whenTargetNamed("hexagonalPixelate"),t.bind(wc.IPostProcessingPass).to(zm).whenTargetNamed("ink"),t.bind(wc.IFactoryPostProcessingPass).toFactory((function(t){return function(e){var n=t.container.getNamed(wc.IPostProcessingPass,e);return n.setName(e),n}})),t}function kg(t){var e=new xc.W2;return e.parent=t,e.bind(wc.IStyleAttributeService).to(cp).inSingletonScope(),e.bind(wc.IMultiPassRenderer).to(Pv).inSingletonScope(),e.bind(wc.IPostProcessor).to(ig).inSingletonScope(),e}var Mg=["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"];function Pg(t){return Mg.indexOf(t)}var Ig=64,Rg=131072,Lg=524288,Og=2097152,Dg=8388608;function Ng(t,e){return t=(0,Oi.clamp)(Math.floor(t),0,255),e=(0,Oi.clamp)(Math.floor(e),0,255),256*t+e}function zg(t){var e=t.color,n=t.radius,r=t.tileX,i=t.tileY,o=t.shape,a=t.opacity,s=t.stroke,u=t.strokeWidth,c=t.strokeOpacity,l=[],h=[],f=[],p=[Ng(e[0],e[1]),Ng(e[2],e[3])],d=[Ng(s[0],s[1]),Ng(s[2],s[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach((function(t){var e=(0,Li.Z)(t,2),s=e[0],v=e[1];l.push([].concat(p,[(s+1)*Dg+(v+1)*Og+Pg(o)*Rg+n,(r+512)*Lg+(i+512)*Ig])),h.push([].concat(d,[u,c])),f.push([a,0,0,0])})),{packedBuffer:l,packedBuffer2:h,packedBuffer3:f}}var Fg,Bg,Ug,jg={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},Zg={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"};(function(t){t["LINEAR"]="linear",t["SEQUENTIAL"]="sequential",t["POWER"]="power",t["LOG"]="log",t["IDENTITY"]="identity",t["TIME"]="time",t["QUANTILE"]="quantile",t["QUANTIZE"]="quantize",t["THRESHOLD"]="threshold",t["CAT"]="cat",t["DIVERGING"]="diverging"})(Fg||(Fg={})),function(t){t["CONSTANT"]="constant",t["VARIABLE"]="variable"}(Bg||(Bg={})),function(t){t[t["Attribute"]=0]="Attribute",t[t["InstancedAttribute"]=1]="InstancedAttribute",t[t["Uniform"]=2]="Uniform"}(Ug||(Ug={}));var Vg,Gg=["mapload","mapchange","mapAfterFrameChange"],Hg=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"];(function(t){t["IMAGE"]="image",t["CUSTOMIMAGE"]="customImage",t["ARRAYBUFFER"]="arraybuffer",t["RGB"]="rgb",t["TERRAINRGB"]="terrainRGB",t["CUSTOMRGB"]="customRGB",t["CUSTOMARRAYBUFFER"]="customArrayBuffer",t["CUSTOMTERRAINRGB"]="customTerrainRGB"})(Vg||(Vg={}));var Wg=function(){var t=(0,J.Z)(tt().mark((function t(e,n,r,i){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,o){n({x:e.x,y:e.y,z:e.z},(function(e,n){e||0===n.length?o(e):n&&vc([{data:n,bands:[0]}],r,i,(function(e,n){e?o(e):n&&t(n)}))}))})));case 1:case"end":return t.stop()}}),t)})));return function(e,n,r,i){return t.apply(this,arguments)}}(),qg=function(){var t=(0,J.Z)(tt().mark((function t(e,n){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,r){n({x:e.x,y:e.y,z:e.z},(function(e,n){!e&&n?n instanceof ArrayBuffer?zr(n,(function(e,n){e&&r(e),t(n)})):n instanceof HTMLImageElement?t(n):r(e):r(e)}))})));case 1:case"end":return t.stop()}}),t)})));return function(e,n){return t.apply(this,arguments)}}();function Xg(t,e){return Array.isArray(t)?"string"===typeof t[0]?t.map((function(t){return hs(t,e)})):t.map((function(t){return{url:hs(t.url,e),bands:t.bands||[0]}})):hs(t,e)}function Yg(t){return"string"===typeof t?[{url:t,bands:[0]}]:"string"===typeof t[0]?t.map((function(t){return{url:t,bands:[0]}})):t}function Kg(t,e){t.xhrCancel=function(){e.map((function(t){t.abort()}))}}var Qg=function(){var t=(0,J.Z)(tt().mark((function t(e,n,r,i,o){var a,s,u,c,l,h;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(a=Yg(n.url),!(a.length>1)){t.next=15;break}return t.next=4,Jg(a,n);case 4:if(s=t.sent,u=s.rasterFiles,c=s.xhrList,l=s.errList,Kg(e,c),!(l.length>0)){t.next=12;break}return r(l,null),t.abrupt("return");case 12:vc(u,i,o,r),t.next=17;break;case 15:h=Pr(n,(function(t,e){if(t)r(t);else if(e){var n=[{data:e,bands:a[0].bands}];vc(n,i,o,r)}})),Kg(e,[h]);case 17:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}();function Jg(t,e){return $g.apply(this,arguments)}function $g(){return $g=(0,J.Z)(tt().mark((function t(e,n){var r,i,o,a,s,u,c,l,h,f,p;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:r=[],i=[],o=[],a=0;case 4:if(!(a<e.length)){t.next=20;break}return s=e[a],u=(0,k.Z)((0,k.Z)({},n),{},{url:s.url}),c=s.bands,t.next=10,Cr((0,k.Z)((0,k.Z)({},u),{},{type:"arrayBuffer"}));case 10:l=t.sent,h=l.err,f=l.data,p=l.xhr,h&&o.push(h),i.push(p),r.push({data:f,bands:c});case 17:a++,t.next=4;break;case 20:return t.abrupt("return",{rasterFiles:r,xhrList:i,errList:o});case 21:case"end":return t.stop()}}),t)}))),$g.apply(this,arguments)}var ty=function(){var t=(0,J.Z)(tt().mark((function t(e,n,r,i,o){var a;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a={url:Xg(e,n)},t.abrupt("return",new Promise((function(t,e){Qg(r,a,(function(n,r){n?e(n):r&&t(r)}),i,o)})));case 2:case"end":return t.stop()}}),t)})));return function(e,n,r,i,o){return t.apply(this,arguments)}}(),ey=function(){var t=(0,J.Z)(tt().mark((function t(e,n,r,i){var o,a,s,u;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return a=Array.isArray(e)?e[0]:e,i.wmtsOptions?(s=(null===i||void 0===i?void 0:i.getURLFromTemplate)||fs,o=s(a,(0,k.Z)((0,k.Z)({},n),i.wmtsOptions))):(u=(null===i||void 0===i?void 0:i.getURLFromTemplate)||hs,o=u(a,n)),t.abrupt("return",new Promise((function(t,e){var n,a=Nr({url:o,type:(null===i||void 0===i||null===(n=i.requestParameters)||void 0===n?void 0:n.type)||"arrayBuffer"},(function(n,r){n?e(n):r&&t(r)}),i.transformResponse);r.xhrCancel=function(){return a.abort()}})));case 3:case"end":return t.stop()}}),t)})));return function(e,n,r,i){return t.apply(this,arguments)}}(),ny=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},ry={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0};Vg.ARRAYBUFFER,Vg.RGB;function iy(t){return!(!Array.isArray(t)||0!==t.length)||!Array.isArray(t)&&"string"!==typeof t}function oy(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(iy(t))throw new Error("tile server url is error");var n=(null===e||void 0===e?void 0:e.dataType)||Vg.IMAGE;n===Vg.RGB&&(n=Vg.ARRAYBUFFER);var r=function(r,i){switch(n){case Vg.IMAGE:return ey(t,r,i,e);case Vg.CUSTOMIMAGE:case Vg.CUSTOMTERRAINRGB:return qg(i,null===e||void 0===e?void 0:e.getCustomData);case Vg.ARRAYBUFFER:return ty(t,r,i,(null===e||void 0===e?void 0:e.format)||ny,null===e||void 0===e?void 0:e.operation);case Vg.CUSTOMARRAYBUFFER:case Vg.CUSTOMRGB:return Wg(i,null===e||void 0===e?void 0:e.getCustomData,(null===e||void 0===e?void 0:e.format)||ny,null===e||void 0===e?void 0:e.operation);default:return ey(t,r,i,e)}},i=(0,k.Z)((0,k.Z)((0,k.Z)({},ry),e),{},{getTileData:r});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}}var ay=["extent","min","max","width","height","format","operation"];function sy(t,e){var n,r=e.extent,i=e.min,o=e.max,a=e.width,s=e.height,u=e.format,c=e.operation,l=Jf(e,ay);if(void 0===u||yc(t))n=Array.from(t);else{var h=Array.isArray(t)?t:[t];n=hc(h,u,c)}var f={_id:1,dataArray:[(0,k.Z)((0,k.Z)({_id:1,data:n,width:a,height:s},l),{},{min:i,max:o,coordinates:[[r[0],r[1]],[r[2],r[3]]]})]};return f}var uy={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},cy=function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t){var n=(0,Li.Z)(e.bounds,4),r=n[0],i=n[1],o=n[2],a=n[3],s={layers:{testTile:{features:[{type:"Feature",properties:{key:e.x+"/"+e.y+"/"+e.z,x:(r+o)/2,y:(i+a)/2},geometry:{type:"LineString",coordinates:[[o,a],[o,i],[r,i],[r,i]]}}]}}};t(s)})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function ly(t,e){var n=function(t){return cy(t)},r=(0,k.Z)((0,k.Z)((0,k.Z)({},uy),e),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:r,isTile:!0}}var hy=n(44378),fy=n.n(hy);function py(t,e){var n=e.radius,r=void 0===n?40:n,i=e.maxZoom,o=void 0===i?18:i,a=e.minZoom,s=void 0===a?0:a,u=e.zoom,c=void 0===u?2:u;if(t.pointIndex){var l=t.pointIndex.getClusters(t.extent,Math.floor(c));return t.dataArray=dy(l),t}var h=new(fy())({radius:r,minZoom:s,maxZoom:o}),f={type:"FeatureCollection",features:[]};return f.features=t.dataArray.map((function(t){return{type:"Feature",geometry:{type:"Point",coordinates:t.coordinates},properties:(0,k.Z)({},t)}})),h.load(f.features),h}function dy(t){return t.map((function(t,e){return(0,k.Z)({coordinates:t.geometry.coordinates,_id:e+1},t.properties)}))}function vy(t){if(0===t.length)throw new Error("max requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]>e&&(e=t[n]);return e}function gy(t){if(0===t.length)throw new Error("min requires at least one data point");for(var e=t[0],n=1;n<t.length;n++)t[n]<e&&(e=t[n]);return e}function yy(t){if(0===t.length)return 0;for(var e,n=t[0],r=0,i=1;i<t.length;i++)e=n+1*t[i],Math.abs(n)>=Math.abs(t[i])?r+=n-e+t[i]:r+=t[i]-e+n,n=e;return n+1*r}function _y(t){if(0===t.length)throw new Error("mean requires at least one data point");return yy(t)/t.length}var xy={min:gy,max:vy,mean:_y,sum:yy};function by(t){var e=wy();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function wy(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Ey(t,e){if(Array.isArray(e))return e}var Sy=function(t){Yt(n,t);var e=by(n);function n(t,r){var i;return Ot(this,n),i=e.call(this),(0,Ft.Z)(Kt(i),"type","source"),(0,Ft.Z)(Kt(i),"isTile",!1),(0,Ft.Z)(Kt(i),"inited",!1),(0,Ft.Z)(Kt(i),"hooks",{init:new Wp}),(0,Ft.Z)(Kt(i),"parser",{type:"geojson"}),(0,Ft.Z)(Kt(i),"transforms",[]),(0,Ft.Z)(Kt(i),"cluster",!1),(0,Ft.Z)(Kt(i),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,Ft.Z)(Kt(i),"invalidExtent",!1),(0,Ft.Z)(Kt(i),"dataArrayChanged",!1),(0,Ft.Z)(Kt(i),"cfg",{autoRender:!0}),i.originData=t,i.initCfg(r),i.init().then((function(){i.inited=!0,i.emit("update",{type:"inited"})})),i}return zt(n,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(t){return this.clusterIndex.getClusters(this.caculClusterExtent(2),t)}},{key:"getClustersLeaves",value:function(t){return this.clusterIndex.getLeaves(t,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(t){var e=this,n=this.clusterOptions,r=n.method,i=void 0===r?"sum":r,o=n.field,a=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(t));this.clusterOptions.zoom=t,a.forEach((function(t){t.id||(t.properties.point_count=1)})),(o||(0,Oi.isFunction)(i))&&(a=a.map((function(t){var n=t.id;if(n){var r,a=e.clusterIndex.getLeaves(n,1/0),s=a.map((function(t){return t.properties}));if((0,Oi.isString)(i)&&o){var u=gc(s,o);r=xy[i](u)}(0,Oi.isFunction)(i)&&(r=i(s)),t.properties.stat=r}else t.properties.point_count=1;return t}))),this.data=c("geojson")({type:"FeatureCollection",features:a}),this.executeTrans()}},{key:"getFeatureById",value:function(t){var e=this.parser,n=e.type,r=void 0===n?"geojson":n,i=e.geometry;if("geojson"!==r||this.cluster)return"json"===r&&i?this.data.dataArray.find((function(e){return e._id===t})):t<this.data.dataArray.length?this.data.dataArray[t]:"null";var o=t<this.originData.features.length?this.originData.features[t]:"null",a=(0,Oi.cloneDeep)(o);if(null!==a&&void 0!==a&&a.properties&&(0!==this.transforms.length||this.dataArrayChanged)){var s=this.data.dataArray.find((function(e){return e._id===t}));a.properties=s}return a}},{key:"updateFeaturePropertiesById",value:function(t,e){this.data.dataArray=this.data.dataArray.map((function(n){return n._id===t?(0,k.Z)((0,k.Z)({},n),e):n})),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(t,e){var n=this.data.dataArray.find((function(n){return n[t]===e}));return null===n||void 0===n?void 0:n._id}},{key:"setData",value:function(t,e){var n=this;this.originData=t,this.dataArrayChanged=!1,this.initCfg(e),this.init().then((function(){n.emit("update",{type:"update"})}))}},{key:"reloadAllTile",value:function(){var t;null===(t=this.tileset)||void 0===t||t.reloadAll()}},{key:"reloadTilebyId",value:function(t,e,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileById(t,e,n)}},{key:"reloadTileByLnglat",value:function(t,e,n){var r;null===(r=this.tileset)||void 0===r||r.reloadTileByLnglat(t,e,n)}},{key:"getTileExtent",value:function(t,e){var n;return null===(n=this.tileset)||void 0===n?void 0:n.getTileExtent(t,e)}},{key:"getTileByZXY",value:function(t,e,n){var r;return null===(r=this.tileset)||void 0===r?void 0:r.getTileByZXY(t,e,n)}},{key:"reloadTileByExtent",value:function(t,e){var n;null===(n=this.tileset)||void 0===n||n.reloadTileByExtent(t,e)}},{key:"destroy",value:function(){var t;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,null===(t=this.tileset)||void 0===t||t.destroy()}},{key:"processData",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){try{e.excuteParser(),e.initCluster(),e.executeTrans(),t({})}catch(r){n(r)}})));case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()},{key:"initCfg",value:function(t){this.cfg=(0,Oi.mergeWith)(this.cfg,t,Ey);var e=this.cfg;e&&(e.parser&&(this.parser=e.parser),e.transforms&&(this.transforms=e.transforms),this.cluster=e.cluster||!1,e.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,k.Z)((0,k.Z)({},this.clusterOptions),e.clusterOptions)))}},{key:"init",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.inited=!1,t.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"excuteParser",value:function(){var t=this.parser,e=t.type||"geojson",n=c(e);this.data=n(this.originData,t),this.tileset=this.initTileset(),t.cancelExtent||(this.extent=So(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(t){this.center=[(t[0]+t[2])/2,(t[1]+t[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var t=this.data.tilesetOptions;if(t){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(t),this.tileset;var e=new us((0,k.Z)({},t));return e}}},{key:"executeTrans",value:function(){var t=this,e=this.transforms;e.forEach((function(e){var n=e.type,r=h(n)(t.data,e);Object.assign(t.data,r)}))}},{key:"initCluster",value:function(){if(this.cluster){var t=this.clusterOptions||{};this.clusterIndex=py(this.data,t)}}},{key:"caculClusterExtent",value:function(t){var e=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(e=Bo(jo(this.extent),t)),e[0].concat(e[1])}}]),n}(Ma.EventEmitter);function Ay(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.filter(n)),t}function Ty(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Cy(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Cy(t,e){if(t){if("string"===typeof t)return ky(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ky(t,e):void 0}}function ky(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var My=6378e3;function Py(t,e){var n=t.dataArray,r=e.size,i=void 0===r?10:r,o=i/(2*Math.PI*My)*(256<<20)/2,a=Iy(n,i),s=a.gridHash,u=a.gridOffset,c=Dy(s,u,e);return{yOffset:o,xOffset:o,radius:o,type:"grid",dataArray:c}}function Iy(t,e){var n,r,i=1/0,o=-1/0,a=Ty(t);try{for(a.s();!(r=a.n()).done;){var s=r.value;n=s.coordinates[1],Number.isFinite(n)&&(i=n<i?n:i,o=n>o?n:o)}}catch(_){a.e(_)}finally{a.f()}var u=(i+o)/2,c=Ry(e,u);if(c.xOffset<=0||c.yOffset<=0)return{gridHash:{},gridOffset:c};var l,h={},f=Ty(t);try{for(f.s();!(l=f.n()).done;){var p=l.value,d=p.coordinates[1],v=p.coordinates[0];if(Number.isFinite(d)&&Number.isFinite(v)){var m=Math.floor((d+90)/c.yOffset),g=Math.floor((v+180)/c.xOffset),y="".concat(m,"-").concat(g);h[y]=h[y]||{count:0,points:[]},h[y].count+=1,h[y].points.push(p)}}}catch(_){f.e(_)}finally{f.f()}return{gridHash:h,gridOffset:c}}function Ry(t,e){var n=Ly(t),r=Oy(e,t);return{yOffset:n,xOffset:r}}function Ly(t){return t/My*(180/Math.PI)}function Oy(t,e){return e/My*(180/Math.PI)/Math.cos(t*Math.PI/180)}function Dy(t,e,n){return Object.keys(t).reduce((function(r,i,o){var a=i.split("-"),s=parseInt(a[0],10),u=parseInt(a[1],10),c={};if(n.field&&n.method){var l=Aa(t[i].points,n.field);c[n.method]=Sa[n.method](l)}return Object.assign(c,{_id:o,coordinates:Lo([e.xOffset*(u+.5)-180,e.yOffset*(s+.5)-90]),rawData:t[i].points,count:t[i].count}),r.push(c),r}),[])}var Ny=Math.PI/3,zy=[0,Ny,2*Ny,3*Ny,4*Ny,5*Ny];function Fy(t){return t[0]}function By(t){return t[1]}function Uy(){var t,e,n,r=0,i=0,o=1,a=1,s=Fy,u=By;function c(t){var r,i={},o=[],a=t.length;for(r=0;r<a;++r)if(!isNaN(l=+s.call(null,c=t[r],r,t))&&!isNaN(h=+u.call(null,c,r,t))){var c,l,h,f=Math.round(h/=n),p=Math.round(l=l/e-(1&f)/2),d=h-f;if(3*Math.abs(d)>1){var v=l-p,m=p+(l<p?-1:1)/2,g=f+(h<f?-1:1),y=l-m,_=h-g;v*v+d*d>y*y+_*_&&(p=m+(1&f?1:-1)/2,f=g)}var x=p+"-"+f,b=i[x];b?b.push(c):(o.push(b=i[x]=[c]),b.x=(p+(1&f)/2)*e,b.y=f*n)}return o}function l(t){var e=0,n=0;return zy.map((function(r){var i=Math.sin(r)*t,o=-Math.cos(r)*t,a=i-e,s=o-n;return e=i,n=o,[a,s]}))}return c.hexagon=function(e){return"m"+l(null==e?t:+e).join("l")+"z"},c.centers=function(){for(var s=[],u=Math.round(i/n),c=Math.round(r/e),l=u*n;l<a+t;l+=n,++u)for(var h=c*e+(1&u)*e/2;h<o+e/2;h+=e)s.push([h,l]);return s},c.mesh=function(){var e=l(t).slice(0,4).join("l");return c.centers().map((function(t){return"M"+t+"m"+e})).join("")},c.x=function(t){return arguments.length?(s=t,c):s},c.y=function(t){return arguments.length?(u=t,c):u},c.radius=function(r){return arguments.length?(t=+r,e=2*t*Math.sin(Ny),n=1.5*t,c):t},c.size=function(t){return arguments.length?(r=i=0,o=+t[0],a=+t[1],c):[o-r,a-i]},c.extent=function(t){return arguments.length?(r=+t[0][0],i=+t[0][1],o=+t[1][0],a=+t[1][1],c):[[r,i],[o,a]]},c.radius(1)}var jy=6378e3;function Zy(t,e){var n=t.dataArray,r=e.size,i=void 0===r?10:r,o=e.method,a=void 0===o?"sum":o,s=i/(2*Math.PI*jy)*(256<<20)/2,u=n.map((function(t){var e=Lo(t.coordinates),n=(0,Li.Z)(e,2),r=n[0],i=n[1];return(0,k.Z)((0,k.Z)({},t),{},{coordinates:[r,i]})})),c=Uy().radius(s).x((function(t){return t.coordinates[0]})).y((function(t){return t.coordinates[1]})),l=c(u),h={dataArray:l.map((function(t,n){var r;if(e.field&&a){var i=Aa(t,e.field);t[a]=Sa[a](i)}return r={},(0,Ft.Z)(r,e.method,t[a]),(0,Ft.Z)(r,"count",t.length),(0,Ft.Z)(r,"rawData",t),(0,Ft.Z)(r,"coordinates",[t.x,t.y]),(0,Ft.Z)(r,"_id",n),r})),radius:s,xOffset:s,yOffset:s,type:"hexagon"};return h}function Vy(t,e){var n=e.sourceField,r=e.targetField,i=e.data,o={};return i.forEach((function(t){o[t[n]]=t})),t.dataArray=t.dataArray.map((function(t){var e=t[r];return(0,k.Z)((0,k.Z)({},t),o[e])})),t}function Gy(t,e){var n=e.callback;return n&&(t.dataArray=t.dataArray.map(n)),t}l("rasterTile",oy),l("mvt",nc),l("geojsonvt",qt),l("testTile",ly),l("geojson",Q),l("image",Xu),l("csv",X),l("json",q),l("raster",_c),l("rasterRgb",sy),f("cluster",py),f("filter",Ay),f("join",Vy),f("map",Gy),f("grid",Py),f("hexagon",Zy);var Hy=Sy;function Wy(t){var e=qy();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function qy(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Xy=function(t){Yt(n,t);var e=Wy(n);function n(t){var r;return Ot(this,n),r=e.call(this),(0,Ft.Z)(Kt(r),"added",!1),(0,Ft.Z)(Kt(r),"eventHandle",(function(t){r.polyfillEvent(t),r.emit(t.type,{target:t,data:r.markerOption.extData,lngLat:r.lngLat})})),r.markerOption=(0,k.Z)((0,k.Z)({},r.getDefault()),t),go(["update","onMove","onMapClick"],Kt(r)),r.init(),r}return zt(n,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:Fr.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(t){this.scene=t,this.mapsService=t.get(wc.IMapService),this.sceneSerive=t.get(wc.ISceneService);var e=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(e),this.registerMarkerEvent(e),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var t=this.markerOption.element;return t&&Ui(t),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(t){return this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(t){var e=this;if(!this.added)return this.once("added",(function(){e.setElement(t)})),this;var n=this.markerOption.element;return n&&Ui(n),this.markerOption.element=t,this.init(),this.mapsService.getMarkerContainer().appendChild(t),this.registerMarkerEvent(t),this.update(),this}},{key:"openPopup",value:function(){var t=this;if(!this.added)return this.once("added",(function(){t.openPopup()})),this;var e=this.popup;return e?(e.isOpen()||e.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var t=this;this.added||this.once("added",(function(){t.closePopup()}));var e=this.popup;return e&&e.remove(),this}},{key:"setPopup",value:function(t){return this.popup=t,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var t=this.popup;return t?(t.isOpen()?t.remove():t.addTo(this.scene),this):this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(t){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(t){this.markerOption.extData=t}},{key:"update",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.anchor;this.updatePosition(),Xi(e,"".concat(Br[n]))}}},{key:"onMapClick",value:function(t){var e=this.markerOption.element;this.popup&&e&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var t=this.mapsService.getContainer();return{containerHeight:(null===t||void 0===t?void 0:t.scrollHeight)||0,containerWidth:(null===t||void 0===t?void 0:t.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var t=this.markerOption,e=t.element,n=t.offsets,r=this.lngLat,i=r.lng,o=r.lat,a=this.mapsService.lngLatToContainer([i,o]);if(e){e.style.display="block",e.style.whiteSpace="nowrap";var s=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),u=s.containerHeight,c=s.containerWidth,l=s.bounds;if(!l)return;if(Math.abs(l[0][0])>180||Math.abs(l[1][0])>180){if(a.x>c){var h=this.mapsService.lngLatToContainer([i-360,o]);a.x=h.x}if(a.x<0){var f=this.mapsService.lngLatToContainer([i+360,o]);a.x=f.x}}(a.x>c||a.x<0||a.y>u||a.y<0)&&(e.style.display="none"),e.style.left=a.x+n[0]+"px",e.style.top=a.y-n[1]+"px"}}}},{key:"init",value:function(){var t=this,e=this.markerOption.element,n=this.markerOption,r=n.color,i=n.anchor;if(!e){this.defaultMarker=!0,e=Bi("div"),this.markerOption.element=e;var o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","48px"),o.setAttributeNS(null,"width","48px"),o.setAttributeNS(null,"viewBox","0 0 1024 1024");var a=document.createElementNS("http://www.w3.org/2000/svg","path");a.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),a.setAttributeNS(null,"fill",r),o.appendChild(a),e.appendChild(o)}ji(e,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach((function(n){var r,i,o=(null===(r=t.markerOption)||void 0===r?void 0:r.style)&&(null===(i=t.markerOption)||void 0===i?void 0:i.style[n]);e&&(e.style[n]=o)})),Ur(e,i,"marker")}},{key:"registerMarkerEvent",value:function(t){t.addEventListener("click",this.onMapClick),t.addEventListener("mousemove",this.eventHandle),t.addEventListener("click",this.eventHandle),t.addEventListener("mousedown",this.eventHandle),t.addEventListener("mouseup",this.eventHandle),t.addEventListener("dblclick",this.eventHandle),t.addEventListener("contextmenu",this.eventHandle),t.addEventListener("mouseover",this.eventHandle),t.addEventListener("mouseout",this.eventHandle),t.addEventListener("touchstart",this.eventHandle),t.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var t=this.getElement();t.removeEventListener("click",this.onMapClick),t.removeEventListener("mousemove",this.eventHandle),t.removeEventListener("click",this.eventHandle),t.removeEventListener("mousedown",this.eventHandle),t.removeEventListener("mouseup",this.eventHandle),t.removeEventListener("dblclick",this.eventHandle),t.removeEventListener("contextmenu",this.eventHandle),t.removeEventListener("mouseover",this.eventHandle),t.removeEventListener("mouseout",this.eventHandle),t.removeEventListener("touchstart",this.eventHandle),t.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(t){this.mapsService&&"GAODE2.x"===this.mapsService.version&&(mo()||("touchstart"===t.type&&(this.touchStartTime=Date.now()),"touchend"===t.type&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:t,data:this.markerOption.extData,lngLat:this.lngLat})))}},{key:"addDragHandler",value:function(t){return null}},{key:"onUp",value:function(t){throw new Error("Method not implemented.")}}]),n}(Ma.EventEmitter);function Yy(t){var e=Ky();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Ky(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Qy=function(t){Yt(n,t);var e=Yy(n);function n(t){var r,i;return Ot(this,n),i=e.call(this),(0,Ft.Z)(Kt(i),"markers",[]),(0,Ft.Z)(Kt(i),"points",[]),(0,Ft.Z)(Kt(i),"clusterMarkers",[]),i.markerLayerOption=(0,Oi.merge)(i.getDefault(),t),go(["update"],Kt(i)),i.zoom=(null===(r=i.markerLayerOption.clusterOption)||void 0===r?void 0:r.zoom)||-99,i}return zt(n,[{key:"getDefault",value:function(){return{cluster:!1,clusterOption:{radius:80,maxZoom:20,minZoom:0,zoom:-99,style:{},className:""}}}},{key:"addTo",value:function(t){return this.scene=t,this.mapsService=t.get(wc.IMapService),this.markerLayerOption.cluster&&(this.initCluster(),this.update(),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.mapsService.on("camerachange",this.setContainerSize.bind(this)),this.mapsService.on("viewchange",this.setContainerSize.bind(this)),this.addMarkers(),this.inited=!0,this}},{key:"setContainerSize",value:function(){if(this.mapsService){var t=this.mapsService.getContainer();this.containerSize={containerWidth:(null===t||void 0===t?void 0:t.scrollWidth)||0,containerHeight:(null===t||void 0===t?void 0:t.scrollHeight)||0,bounds:this.mapsService.getBounds()}}}},{key:"getContainerSize",value:function(){return this.containerSize}},{key:"addMarker",value:function(t){var e=this.markerLayerOption.cluster;if(t.getMarkerLayerContainerSize=this.getContainerSize.bind(this),e&&(this.addPoint(t,this.markers.length),this.mapsService)){var n=this.mapsService.getZoom(),r=this.mapsService.getBounds();this.bbox=Bo(r,.5),this.zoom=Math.floor(n),this.getClusterMarker(this.bbox,this.zoom)}this.markers.push(t)}},{key:"removeMarker",value:function(t){this.markers.indexOf(t);var e=this.markers.indexOf(t);e>-1&&this.markers.splice(e,1)}},{key:"hide",value:function(){this.markers.map((function(t){t.getElement().style.opacity="0"})),this.clusterMarkers.map((function(t){t.getElement().style.opacity="0"}))}},{key:"show",value:function(){this.markers.map((function(t){t.getElement().style.opacity="1"})),this.clusterMarkers.map((function(t){t.getElement().style.opacity="1"}))}},{key:"getMarkers",value:function(){var t=this.markerLayerOption.cluster;return t?this.clusterMarkers:this.markers}},{key:"addMarkers",value:function(){var t=this;this.getMarkers().forEach((function(e){e.addTo(t.scene)}))}},{key:"clear",value:function(){this.markers.forEach((function(t){t.remove()})),this.clusterMarkers.forEach((function(t){t.remove()})),this.markers=[],this.points=[],this.clusterMarkers=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners(),this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.off("camerachange",this.setContainerSize.bind(this)),this.mapsService.off("viewchange",this.setContainerSize.bind(this))}},{key:"addPoint",value:function(t,e){var n=t.getLnglat(),r=n.lng,i=n.lat,o={geometry:{type:"Point",coordinates:[r,i]},properties:(0,k.Z)((0,k.Z)({},t.getExtData()),{},{marker_id:e})};this.points.push(o),this.clusterIndex&&this.clusterIndex.load(this.points)}},{key:"initCluster",value:function(){if(this.markerLayerOption.cluster){var t=this.markerLayerOption.clusterOption,e=t.radius,n=t.minZoom,r=void 0===n?0:n,i=t.maxZoom;this.clusterIndex=new(fy())({radius:e,minZoom:r,maxZoom:i}),this.clusterIndex.load(this.points)}}},{key:"getClusterMarker",value:function(t,e){var n=this,r=t[0].concat(t[1]),i=this.clusterIndex.getClusters(r,e);this.clusterMarkers.forEach((function(t){t.remove()})),this.clusterMarkers=[],i.forEach((function(t){var e,r=n.markerLayerOption.clusterOption,i=r.field,o=r.method;if(null!==(e=t.properties)&&void 0!==e&&e.cluster_id){var a,s=n.getLeaves(null===(a=t.properties)||void 0===a?void 0:a.cluster_id);if(t.properties.clusterData=s,i&&o){var u=null===s||void 0===s?void 0:s.map((function(t){var e=(0,Ft.Z)({},i,t.properties[i]);return e})),c=Aa(u,i),l=Ta(o,c),h="point_"+o;t.properties[h]=l.toFixed(2)}}var f=n.clusterMarker(t);n.clusterMarkers.push(f),f.addTo(n.scene)}))}},{key:"getLeaves",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1/0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return t?this.clusterIndex.getLeaves(t,e,n):null}},{key:"clusterMarker",value:function(t){var e=this.markerLayerOption.clusterOption,n=e,r=n.element,i=void 0===r?this.generateElement.bind(this):r,o=new Xy({element:i(t)}).setLnglat({lng:t.geometry.coordinates[0],lat:t.geometry.coordinates[1]});return o}},{key:"normalMarker",value:function(t){var e=t.properties.marker_id;return this.markers[e]}},{key:"update",value:function(){if(this.mapsService&&0!==this.markers.length){var t=this.mapsService.getZoom(),e=this.mapsService.getBounds();(!this.bbox||Math.abs(t-this.zoom)>=1||!Uo(this.bbox,e))&&(this.bbox=Bo(e,.5),this.zoom=Math.floor(t),this.getClusterMarker(this.bbox,this.zoom))}}},{key:"generateElement",value:function(t){var e=Bi("div","l7-marker-cluster"),n=Bi("div","",e),r=Bi("span","",n),i=this.markerLayerOption.clusterOption,o=i.field,a=i.method;t.properties.point_count=t.properties.point_count||1;var s=o&&a?t.properties["point_"+a]||t.properties[o]:t.properties.point_count;return r.textContent=s,e}}]),n}(Ma.EventEmitter);n(95285);function Jy(t){var e=$y();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function $y(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var t_=function(t){Yt(n,t);var e=Jy(n);function n(t){var r;return Ot(this,n),r=e.call(this),n.controlCount++,r.controlOption=(0,k.Z)((0,k.Z)({},r.getDefault(t)),t||{}),r}return zt(n,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(t){var e=this.getDefault(t);Object.entries(t).forEach((function(n){var r=(0,Li.Z)(n,2),i=r[0],o=r[1];void 0===o&&(t[i]=e[i])})),"position"in t&&this.setPosition(t.position),"className"in t&&this.setClassName(t.className),"style"in t&&this.setStyle(t.style),this.controlOption=(0,k.Z)((0,k.Z)({},this.controlOption),t)}},{key:"addTo",value:function(t){this.mapsService=t.get(wc.IMapService),this.renderService=t.get(wc.IRendererService),this.layerService=t.get(wc.ILayerService),this.controlService=t.get(wc.IControlService),this.configService=t.get(wc.IGlobalConfigService),this.scene=t.get(wc.ISceneService),this.sceneContainer=t,this.isShow=!0,this.container=this.onAdd(),ji(this.container,"l7-control");var e=this.controlOption,n=e.className,r=e.style;return n&&this.setClassName(n),r&&this.setStyle(r),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Ui(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return Bi("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var t=this.container;Zi(t,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var t=this.container;ji(t,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(t){return{position:ah.TOPRIGHT,name:"".concat(n.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(t){if(this.mapsService&&t&&t.screenX>0&&t.screenY>0){var e=this.mapsService.getContainer();null!==e&&e.focus()}}},{key:"setPosition",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:ah.TOPLEFT,e=this.controlService;return e&&e.removeControl(this),this.controlOption.position=t,e&&e.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(t){var e=this.container,n=this.controlOption.className;n&&Zi(e,n),t&&ji(e,t)}},{key:"setStyle",value:function(t){var e=this.container;t?e.setAttribute("style",t):e.removeAttribute("style")}},{key:"insertContainer",value:function(){var t=this.controlOption.position,e=this.container;if(t instanceof Element)t.appendChild(e);else{var n=this.controlService.controlCorners[t];["bottomleft","bottomright","righttop","rightbottom"].includes(t)?n.insertBefore(e,n.firstChild):n.appendChild(e)}}},{key:"checkUpdateOption",value:function(t,e){return e.some((function(e){return e in t}))}}]),n}(Pa());function e_(t){var e=n_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function n_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(0,Ft.Z)(t_,"controlCount",0);var r_=function(t){Yt(n,t);var e=e_(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"isDisable",!1),t}return zt(n,[{key:"setIsDisable",value:function(t){var e,n;(this.isDisable=t,t)?null===(e=this.button)||void 0===e||e.setAttribute("disabled","true"):null===(n=this.button)||void 0===n||n.removeAttribute("disabled")}},{key:"createButton",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return Bi("button","l7-button-control ".concat(t))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var t=this.controlOption,e=t.title,n=t.btnText,r=t.btnIcon;return this.setBtnTitle(e),this.setBtnText(n),this.setBtnIcon(r),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(t){var e=t.title,r=t.btnText,i=t.btnIcon;this.checkUpdateOption(t,["title"])&&this.setBtnTitle(e),this.checkUpdateOption(t,["btnIcon"])&&this.setBtnIcon(i),this.checkUpdateOption(t,["btnText"])&&this.setBtnText(r),pv(Jt(n.prototype),"setOptions",this).call(this,t)}},{key:"setBtnTitle",value:function(t){var e;null===(e=this.button)||void 0===e||e.setAttribute("title",null!==t&&void 0!==t?t:"")}},{key:"setBtnIcon",value:function(t){if(this.buttonIcon&&Ui(this.buttonIcon),t){var e,n,r,i=null===(e=this.button)||void 0===e?void 0:e.firstChild;if(i)null===(n=this.button)||void 0===n||n.insertBefore(t,i);else null===(r=this.button)||void 0===r||r.appendChild(t);this.buttonIcon=t}}},{key:"setBtnText",value:function(t){if(this.button)if(Zi(this.button,"l7-button-control--row"),Zi(this.button,"l7-button-control--column"),t){var e,n=this.buttonText;if(!n)n=Bi("div","l7-button-control__text"),null===(e=this.button)||void 0===e||e.appendChild(n),this.buttonText=n;n.innerText=t,ji(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!t&&this.buttonText&&(Ui(this.buttonText),this.buttonText=void 0)}}]),n}(t_);function i_(t){var e=o_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function o_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var a_=function(t){Yt(n,t);var e=i_(n);function n(t,r){var i;return Ot(this,n),i=e.call(this),(0,Ft.Z)(Kt(i),"isShow",!1),(0,Ft.Z)(Kt(i),"timeout",null),(0,Ft.Z)(Kt(i),"show",(function(){return i.isShow||!i.contentDOM.innerHTML||(i.resetPopperPosition(),Zi(i.popperDOM,"l7-popper-hide"),i.isShow=!0,i.option.unique&&n.conflictPopperList.forEach((function(t){t!==Kt(i)&&t.isShow&&t.hide()})),i.emit("show")),Kt(i)})),(0,Ft.Z)(Kt(i),"hide",(function(){return i.isShow?(ji(i.popperDOM,"l7-popper-hide"),i.isShow=!1,i.emit("hide"),Kt(i)):Kt(i)})),(0,Ft.Z)(Kt(i),"setHideTimeout",(function(){i.timeout||(i.timeout=window.setTimeout((function(){i.isShow&&(i.hide(),i.timeout=null)}),300))})),(0,Ft.Z)(Kt(i),"clearHideTimeout",(function(){i.timeout&&(window.clearTimeout(i.timeout),i.timeout=null)})),(0,Ft.Z)(Kt(i),"onBtnClick",(function(){i.isShow?i.hide():i.show()})),(0,Ft.Z)(Kt(i),"onBtnMouseLeave",(function(){i.setHideTimeout()})),(0,Ft.Z)(Kt(i),"onBtnMouseMove",(function(){i.clearHideTimeout(),i.isShow||i.show()})),i.button=t,i.option=r,i.init(),r.unique&&n.conflictPopperList.push(Kt(i)),i}return zt(n,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(t){"string"===typeof t?this.contentDOM.innerHTML=t:t instanceof HTMLElement&&(ao(this.contentDOM),this.contentDOM.appendChild(t)),this.content=t}},{key:"init",value:function(){var t=this.option.trigger;this.popperDOM=this.createPopper(),"click"===t?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Ui(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var t={},e=this.option,n=e.container,r=e.offset,i=void 0===r?[0,0]:r,o=e.placement,a=(0,Li.Z)(i,2),s=a[0],u=a[1],c=this.button.getBoundingClientRect(),l=n.getBoundingClientRect(),h=io(c,l),f=h.left,p=h.right,d=h.top,v=h.bottom,m=!1,g=!1;/^(left|right)/.test(o)?(o.includes("left")?t.right="".concat(c.width+p,"px"):o.includes("right")&&(t.left="".concat(c.width+f,"px")),o.includes("start")?t.top="".concat(d,"px"):o.includes("end")?t.bottom="".concat(v,"px"):(t.top="".concat(d+c.height/2,"px"),g=!0,t.transform="translate(".concat(s,"px, calc(").concat(u,"px - 50%))"))):/^(top|bottom)/.test(o)&&(o.includes("top")?t.bottom="".concat(c.height+v,"px"):o.includes("bottom")&&(t.top="".concat(c.height+d,"px")),o.includes("start")?t.left="".concat(f,"px"):o.includes("end")?t.right="".concat(p,"px"):(t.left="".concat(f+c.width/2,"px"),m=!0,t.transform="translate(calc(".concat(s,"px - 50%), ").concat(u,"px)"))),t.transform="translate(calc(".concat(s,"px - ").concat(m?"50%":"0%","), calc(").concat(u,"px - ").concat(g?"50%":"0%",")");var y=o.split("-");y.length&&ji(this.popperDOM,y.map((function(t){return"l7-popper-".concat(t)})).join(" ")),to(this.popperDOM,ro(t))}},{key:"createPopper",value:function(){var t=this.option,e=t.container,n=t.className,r=void 0===n?"":n,i=t.content,o=Bi("div","l7-popper l7-popper-hide ".concat(r)),a=Bi("div","l7-popper-content"),s=Bi("div","l7-popper-arrow");return o.appendChild(a),o.appendChild(s),e.appendChild(o),this.popperDOM=o,this.contentDOM=a,i&&this.setContent(i),o}}]),n}(Ma.EventEmitter);function s_(t){var e=u_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function u_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(0,Ft.Z)(a_,"conflictPopperList",[]);var c_={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},l_=function(t){Yt(n,t);var e=s_(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),pv(Jt(n.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(t){var e,r=pv(Jt(n.prototype),"getDefault",this).call(this,t),i=null!==(e=null===t||void 0===t?void 0:t.position)&&void 0!==e?e:r.position;return(0,k.Z)((0,k.Z)({},pv(Jt(n.prototype),"getDefault",this).call(this,t)),{},{popperPlacement:i instanceof Element?"bottom":c_[i],popperTrigger:"click"})}},{key:"onAdd",value:function(){var t=pv(Jt(n.prototype),"onAdd",this).call(this);return this.initPopper(),t}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var t=this,e=this.controlOption,n=e.popperClassName,r=e.popperPlacement,i=e.popperTrigger,o=this.mapsService.getMapContainer();return this.popper=new a_(this.button,{className:n,placement:r,trigger:i,container:o,unique:!0}),this.popper.on("show",(function(){t.emit("popperShow",t)})).on("hide",(function(){t.emit("popperHide",t)})),this.popper}},{key:"setOptions",value:function(t){if(pv(Jt(n.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["popperPlacement","popperTrigger","popperClassName"])){var e=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(e)}}}]),n}(r_);function h_(t){var e=f_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function f_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var p_=function(t){return t["ActiveOptionClassName"]="l7-select-control-item-active",t["OptionValueAttrKey"]="data-option-value",t["OptionIndexAttrKey"]="data-option-index",t}(p_||{}),d_=function(t){Yt(n,t);var e=h_(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"selectValue",[]),(0,Ft.Z)(Kt(t),"createNormalOption",(function(e){var n=t.selectValue.includes(e.value),r=Bi("div","l7-select-control-item ".concat(n?p_.ActiveOptionClassName:""));t.getIsMultiple()&&r.appendChild(t.createCheckbox(n)),e.icon&&r.appendChild(e.icon);var i=Bi("span");return i.innerText=e.text,r.appendChild(i),r})),(0,Ft.Z)(Kt(t),"onItemClick",(function(e){if(t.getIsMultiple()){var n=t.selectValue.findIndex((function(t){return t===e.value}));n>-1?t.selectValue.splice(n,1):t.selectValue=[].concat((0,C.Z)(t.selectValue),[e.value])}else t.selectValue=[e.value];t.setSelectValue(t.selectValue)})),t}return zt(n,[{key:"setOptions",value:function(t){pv(Jt(n.prototype),"setOptions",this).call(this,t);var e=t.options;e&&this.popper.setContent(this.getPopperContent(e))}},{key:"onAdd",value:function(){var t=pv(Jt(n.prototype),"onAdd",this).call(this),e=this.controlOption.defaultValue;return e&&(this.selectValue=this.transSelectValue(e)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),t}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(t){var e=this,n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],r=this.transSelectValue(t);this.optionDOMList.forEach((function(t){var n=t.getAttribute(p_.OptionValueAttrKey),i=e.getIsMultiple()?t.querySelector("input[type=checkbox]"):void 0;r.includes(n)?(ji(t,p_.ActiveOptionClassName),i&&oo(i,!0)):(Zi(t,p_.ActiveOptionClassName),i&&oo(i,!1))})),this.selectValue=r,n&&this.emit("selectChange",this.getIsMultiple()?r:r[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(t){var e=this,n=this.isImageOptions(),r=Bi("div",n?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&ji(r,"l7-select-control--multiple");var i=t.map((function(t,r){var i=n?e.createImageOption(t):e.createNormalOption(t);return i.setAttribute(p_.OptionValueAttrKey,t.value),i.setAttribute(p_.OptionIndexAttrKey,window.String(r)),i.addEventListener("click",e.onItemClick.bind(e,t)),i}));return r.append.apply(r,(0,C.Z)(i)),this.optionDOMList=i,r}},{key:"createImageOption",value:function(t){var e=this.selectValue.includes(t.value),n=Bi("div","l7-select-control-item ".concat(e?p_.ActiveOptionClassName:"")),r=Bi("img");r.setAttribute("src",t.img),so(r),n.appendChild(r);var i=Bi("div","l7-select-control-item-row");this.getIsMultiple()&&n.appendChild(this.createCheckbox(e));var o=Bi("span");return o.innerText=t.text,i.appendChild(o),n.appendChild(i),n}},{key:"createCheckbox",value:function(t){var e=Bi("input");return e.setAttribute("type","checkbox"),t&&oo(e,!0),e}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find((function(t){return t.img}))}},{key:"transSelectValue",value:function(t){return Array.isArray(t)?t:[t]}}]),n}(l_),v_=function(t){var e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.classList.add("l7-iconfont"),e.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(t)),e.appendChild(n),e};function m_(t){var e=g_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function g_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var y_=function(t){Yt(n,t);var e=m_(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"onClick",(0,J.Z)(tt().mark((function e(){var n;return tt().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(n=t.controlOption.onExport,null!==n&&void 0!==n){e.next=5;break}e.next=10;break;case 5:return e.t0=n,e.next=8,t.getImage();case 8:e.t1=e.sent,(0,e.t0)(e.t1);case 10:case"end":return e.stop()}}),e)})))),(0,Ft.Z)(Kt(t),"mergeImage",(0,J.Z)(tt().mark((function e(){var n,r,i,o,a,s,u,c,l,h,f,p,d,v,m=arguments;return tt().wrap((function(e){while(1)switch(e.prev=e.next){case 0:for(i=t.controlOption.imageType,o=null!==(n=null===(r=t.mapsService.getContainer())||void 0===r?void 0:r.getBoundingClientRect())&&void 0!==n?n:{},a=o.width,s=void 0===a?0:a,u=o.height,c=void 0===u?0:u,l=document.createElement("canvas"),l.width=s,l.height=c,h=l.getContext("2d"),f=m.length,p=new Array(f),d=0;d<f;d++)p[d]=m[d];return e.next=9,Promise.all(p.map((function(t){return new Promise((function(e){var n=new Image;n.onload=function(){e(n)},n.src=t}))})));case 9:return v=e.sent,v.forEach((function(t){null===h||void 0===h||h.drawImage(t,0,0,s,c)})),e.abrupt("return",l.toDataURL("image/".concat(i)));case 12:case"end":return e.stop()}}),e)})))),t}return zt(n,[{key:"onAdd",value:function(){var t=pv(Jt(n.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}},{key:"getDefault",value:function(t){return(0,k.Z)((0,k.Z)({},pv(Jt(n.prototype),"getDefault",this).call(this,t)),{},{title:"导出图片",btnIcon:v_("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.mapsService.exportMap("png");case 2:return e=t.sent,t.next=5,this.scene.exportPng("png");case 5:return n=t.sent,t.abrupt("return",this.mergeImage.apply(this,(0,C.Z)([e,n].filter((function(t){return t})))));case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}]),n}(r_);function __(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=x_(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function x_(t,e){if(t){if("string"===typeof t)return b_(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?b_(t,e):void 0}}function b_(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var w_=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],E_=function(){if("undefined"===typeof document)return!1;for(var t=w_[0],e={},n=0,r=w_;n<r.length;n++){var i=r[n],o=null===i||void 0===i?void 0:i[1];if(o in document){var a,s=__(i.entries());try{for(s.s();!(a=s.n()).done;){var u=(0,Li.Z)(a.value,2),c=u[0],l=u[1];e[t[c]]=l}}catch(h){s.e(h)}finally{s.f()}return e}}return!1}(),S_={change:E_.fullscreenchange,error:E_.fullscreenerror},A_={request:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:document.documentElement,e=arguments.length>1?arguments[1]:void 0;return new Promise((function(n,r){var i=function t(){A_.off("change",t),n()};A_.on("change",i);var o=t[E_.requestFullscreen](e);o instanceof Promise&&o.then(i).catch(r)}))},exit:function(){return new Promise((function(t,e){if(A_.isFullscreen){var n=function e(){A_.off("change",e),t()};A_.on("change",n);var r=document[E_.exitFullscreen]();r instanceof Promise&&r.then(n).catch(e)}else t()}))},toggle:function(t,e){return A_.isFullscreen?A_.exit():A_.request(t,e)},onchange:function(t){A_.on("change",t)},onerror:function(t){A_.on("error",t)},on:function(t,e){var n=S_[t];n&&document.addEventListener(n,e,!1)},off:function(t,e){var n=S_[t];n&&document.removeEventListener(n,e,!1)},raw:E_};Object.defineProperties(A_,{isFullscreen:{get:function(){return Boolean(document[E_.fullscreenElement])}},element:{enumerable:!0,get:function(){var t;return null!==(t=document[E_.fullscreenElement])&&void 0!==t?t:void 0}},isEnabled:{enumerable:!0,get:function(){return Boolean(document[E_.fullscreenEnabled])}}}),E_||(A_={isEnabled:!1});var T_=A_;function C_(t){var e=k_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function k_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var M_=function(t){Yt(n,t);var e=C_(n);function n(t){var r;return Ot(this,n),r=e.call(this,t),(0,Ft.Z)(Kt(r),"isFullscreen",!1),(0,Ft.Z)(Kt(r),"toggleFullscreen",(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!T_.isEnabled){t.next=3;break}return t.next=3,T_.toggle(r.mapContainer);case 3:case"end":return t.stop()}}),t)})))),(0,Ft.Z)(Kt(r),"onClick",(function(){r.toggleFullscreen()})),(0,Ft.Z)(Kt(r),"onFullscreenChange",(function(){r.isFullscreen=!!document.fullscreenElement;var t=r.controlOption,e=t.btnText,n=t.btnIcon,i=t.title,o=t.exitBtnText,a=t.exitBtnIcon,s=t.exitTitle;r.isFullscreen?(r.setBtnTitle(s),r.setBtnText(o),r.setBtnIcon(a)):(r.setBtnTitle(i),r.setBtnText(e),r.setBtnIcon(n)),r.emit("fullscreenChange",r.isFullscreen)})),T_.isEnabled,r}return zt(n,[{key:"setOptions",value:function(t){var e=t.exitBtnText,r=t.exitBtnIcon,i=t.exitTitle;this.isFullscreen&&(this.checkUpdateOption(t,["exitBtnIcon"])&&this.setBtnIcon(r),this.checkUpdateOption(t,["exitBtnText"])&&this.setBtnText(e),this.checkUpdateOption(t,["exitTitle"])&&this.setBtnTitle(i)),pv(Jt(n.prototype),"setOptions",this).call(this,t)}},{key:"onAdd",value:function(){var t=pv(Jt(n.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),this.mapContainer=Di(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),t}},{key:"onRemove",value:function(){pv(Jt(n.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(t){return(0,k.Z)((0,k.Z)({},pv(Jt(n.prototype),"getDefault",this).call(this,t)),{},{title:"全屏",btnIcon:v_("l7-icon-fullscreen"),exitTitle:"退出全屏",exitBtnIcon:v_("l7-icon-exit-fullscreen")})}}]),n}(r_);function P_(t){var e=I_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function I_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var R_=function(t){Yt(n,t);var e=P_(n);function n(t){var r;return Ot(this,n),r=e.call(this,t),(0,Ft.Z)(Kt(r),"getGeoLocation",(function(){return new Promise((function(t,e){window.navigator.geolocation.getCurrentPosition((function(n){var r=n.coords,i=null!==r&&void 0!==r?r:{},o=i.longitude,a=i.latitude;(0,Oi.isNaN)(o)||(0,Oi.isNaN)(a)?e():t([o,a])}),(function(t){e(t)}))}))})),(0,Ft.Z)(Kt(r),"onClick",(0,J.Z)(tt().mark((function t(){var e,n,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(window.navigator.geolocation){t.next=2;break}return t.abrupt("return");case 2:return e=r.controlOption.transform,t.next=5,r.getGeoLocation();case 5:if(n=t.sent,i=r.mapsService.getZoom(),t.t0=r.mapsService,t.t1=i>15?i:15,!e){t.next=15;break}return t.next=12,e(n);case 12:t.t2=t.sent,t.next=16;break;case 15:t.t2=n;case 16:t.t3=t.t2,t.t0.setZoomAndCenter.call(t.t0,t.t1,t.t3);case 18:case"end":return t.stop()}}),t)})))),window.navigator.geolocation,r}return zt(n,[{key:"getDefault",value:function(t){return(0,k.Z)((0,k.Z)({},pv(Jt(n.prototype),"getDefault",this).call(this,t)),{},{title:"定位",btnIcon:v_("l7-icon-reposition")})}},{key:"onAdd",value:function(){var t=pv(Jt(n.prototype),"onAdd",this).call(this);return t.addEventListener("click",this.onClick),t}}]),n}(r_);function L_(t){var e=O_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function O_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var D_=function(t){Yt(n,t);var e=L_(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"onLayerChange",(function(){var e;null!==(e=t.controlOption.layers)&&void 0!==e&&e.length||(t.selectValue=t.getLayerVisible(),t.setOptions({options:t.getLayerOptions()}))})),(0,Ft.Z)(Kt(t),"onLayerVisibleChane",(function(){t.setSelectValue(t.getLayerVisible())})),(0,Ft.Z)(Kt(t),"onSelectChange",(function(){t.layers.forEach((function(e){var n=t.selectValue.includes(e.name),r=e.isVisible();n&&!r&&e.show(),!n&&r&&e.hide()}))})),t}return zt(n,[{key:"layers",get:function(){var t=this.layerService,e=this.controlOption.layers;if(Array.isArray(e)&&e.length){var n=[];return e.forEach((function(e){if(e instanceof Object&&n.push(e),"string"===typeof e){var r=t.getLayer(e)||t.getLayerByName(e);r&&n.push(r)}})),n}return t.getLayers()||[]}},{key:"getDefault",value:function(t){return(0,k.Z)((0,k.Z)({},pv(Jt(n.prototype),"getDefault",this).call(this,t)),{},{title:"图层控制",btnIcon:v_("l7-icon-layer"),options:[]})}},{key:"getLayerVisible",value:function(){return this.layers.filter((function(t){return t.isVisible()})).map((function(t){return t.name}))}},{key:"getLayerOptions",value:function(){return this.layers.map((function(t){return{text:t.name,value:t.name}}))}},{key:"setOptions",value:function(t){var e=this.checkUpdateOption(t,["layers"]);pv(Jt(n.prototype),"setOptions",this).call(this,t),e&&(this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"onAdd",value:function(){var t;return null!==(t=this.controlOption.options)&&void 0!==t&&t.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),pv(Jt(n.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return!0}}]),n}(d_);function N_(t){var e=z_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function z_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var F_=function(t){Yt(n,t);var e=N_(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getDefault",value:function(){return{position:ah.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var t=Bi("div","l7-control-logo");return this.setLogoContent(t),t}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(t){pv(Jt(n.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["img","href"])&&(ao(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(t){var e=this.controlOption,n=e.href,r=e.img,i=Bi("img");if(i.setAttribute("src",r),i.setAttribute("aria-label","AntV logo"),so(i),n){var o=Bi("a","l7-control-logo-link");o.target="_blank",o.href=n,o.rel="noopener nofollow",o.setAttribute("rel","noopener nofollow"),o.appendChild(i),t.appendChild(o)}else t.appendChild(i)}}]),n}(t_),B_={normal:{text:"标准",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"月光银",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"幻影黑",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"草色青",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"雅士灰",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"涂鸦",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"马卡龙",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"极夜蓝",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"酱籽",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},U_={normal:{text:"标准",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"亮",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"暗",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"卫星",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"户外",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function j_(t){var e=Z_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Z_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var V_=function(t){Yt(n,t);var e=j_(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"onMapThemeChange",(function(){t.mapsService.setMapStyle(t.selectValue[0])})),t}return zt(n,[{key:"getDefault",value:function(t){return(0,k.Z)((0,k.Z)({},pv(Jt(n.prototype),"getDefault",this).call(this,t)),{},{title:"地图样式",btnIcon:v_("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var t="mapbox"===this.mapsService.getType()?U_:B_;return Object.entries(this.mapsService.getMapStyleConfig()).filter((function(t){var e=(0,Li.Z)(t,2),n=e[0],r=e[1];return"string"===typeof r&&"blank"!==n})).map((function(e){var n,r=(0,Li.Z)(e,2),i=r[0],o=r[1],a=null!==(n=t[i])&&void 0!==n?n:{},s=a.text,u=a.img;return{text:null!==s&&void 0!==s?s:i,value:o,img:u,key:i}}))}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var t,e=this;if(null!==(t=this.controlOption.options)&&void 0!==t&&t.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var r,i,o=this.controlOption.defaultValue;this.controlOption.defaultValue=null!==(r=null===(i=this.controlOption.options.find((function(t){return t.key===o})))||void 0===i?void 0:i.value)&&void 0!==r?r:o}else{var a=this.getMapStyle();a?this.controlOption.defaultValue=a:this.mapsService.map.once("styledata",(function(){var t=e.mapsService.getMapStyle();e.controlOption.defaultValue=t,e.setSelectValue(t,!1)}))}return this.on("selectChange",this.onMapThemeChange),pv(Jt(n.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),n}(d_);function G_(t){var e=H_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function H_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var W_=function(t){Yt(n,t);var e=G_(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"location",[0,0]),(0,Ft.Z)(Kt(t),"onMouseMove",(function(e){var n=t.location,r=e.lngLat||e.lnglat,i=t.controlOption.transform;r&&(n=[r.lng,r.lat]),t.location=n,i&&(n=i(n)),t.insertLocation2HTML(n),t.emit("locationChange",n)})),t}return zt(n,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(t){return(0,k.Z)((0,k.Z)({},pv(Jt(n.prototype),"getDefault",this).call(this,t)),{},{position:ah.BOTTOMLEFT,transform:function(t){var e=(0,Li.Z)(t,2),n=e[0],r=e[1];return[+(+n).toFixed(6),+(+r).toFixed(6)]}})}},{key:"onAdd",value:function(){var t=Bi("div","l7-control-mouse-location");return t.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),t}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(t){this.container.innerText=t.join(", ")}}]),n}(t_);function q_(t){var e=X_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function X_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Y_=function(t){Yt(n,t);var e=q_(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"update",(function(){var e=t.mapsService,n=t.controlOption.maxWidth,r=e.getSize()[1]/2,i=e.containerToLngLat([0,r]),o=e.containerToLngLat([n,r]),a=zo([i.lng,i.lat],[o.lng,o.lat]);t.updateScales(a)})),t}return zt(n,[{key:"getDefault",value:function(t){return(0,k.Z)((0,k.Z)({},pv(Jt(n.prototype),"getDefault",this).call(this,t)),{},{name:"scale",position:ah.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var t="l7-control-scale",e=Bi("div",t);this.resetScaleLines(e);var n=this.controlOption.updateWhenIdle;return this.mapsService.on(n?"moveend":"mapmove",this.update),this.mapsService.on(n?"zoomend":"zoomchange",this.update),e}},{key:"onRemove",value:function(){var t=this.controlOption.updateWhenIdle;this.mapsService.off(t?"zoomend":"zoomchange",this.update),this.mapsService.off(t?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(t){pv(Jt(n.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(t){var e=this.controlOption,n=e.metric,r=e.imperial;n&&t&&this.updateMetric(t),r&&t&&this.updateImperial(t)}},{key:"resetScaleLines",value:function(t){ao(t);var e=this.controlOption,n=e.metric,r=e.imperial,i=e.maxWidth,o=e.lockWidth;o&&to(t,"width: ".concat(i,"px")),n&&(this.mScale=Bi("div","l7-control-scale-line",t)),r&&(this.iScale=Bi("div","l7-control-scale-line",t)),this.update()}},{key:"updateScale",value:function(t,e,n){var r=this.controlOption.maxWidth;t.style.width=Math.round(r*n)+"px",t.innerHTML=e}},{key:"getRoundNum",value:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,e*n}},{key:"updateMetric",value:function(t){var e=this.getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this.updateScale(this.mScale,n,e/t)}},{key:"updateImperial",value:function(t){var e,n,r,i=3.2808399*t;i>5280?(e=i/5280,n=this.getRoundNum(e),this.updateScale(this.iScale,n+" mi",n/e)):(r=this.getRoundNum(i),this.updateScale(this.iScale,r+" ft",r/i))}}]),n}(t_);function K_(t){var e=Q_();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Q_(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var J_=function(t){Yt(n,t);var e=K_(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"zoomIn",(function(){!t.disabled&&t.mapsService.getZoom()<t.mapsService.getMaxZoom()&&t.mapsService.zoomIn()})),(0,Ft.Z)(Kt(t),"zoomOut",(function(){!t.disabled&&t.mapsService.getZoom()>t.mapsService.getMinZoom()&&t.mapsService.zoomOut()})),(0,Ft.Z)(Kt(t),"updateDisabled",(function(){var e=t.mapsService;t.zoomInButton.removeAttribute("disabled"),t.zoomOutButton.removeAttribute("disabled"),(t.disabled||e.getZoom()<=e.getMinZoom())&&t.zoomOutButton.setAttribute("disabled","true"),(t.disabled||e.getZoom()>=e.getMaxZoom())&&t.zoomInButton.setAttribute("disabled","true")})),t}return zt(n,[{key:"getDefault",value:function(t){return(0,k.Z)((0,k.Z)({},pv(Jt(n.prototype),"getDefault",this).call(this,t)),{},{position:ah.BOTTOMRIGHT,name:"zoom",zoomInText:v_("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:v_("l7-icon-narrow"),zoomOutTitle:"Zoom out"})}},{key:"setOptions",value:function(t){pv(Jt(n.prototype),"setOptions",this).call(this,t),this.checkUpdateOption(t,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var t=Bi("div","l7-control-zoom");return this.resetButtonGroup(t),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),t}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(t){ao(t),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",t,this.zoomIn),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",t,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(t,e,n,r,i){var o=Bi("button",n,r);return"string"===typeof t?o.innerHTML=t:o.append(t),o.title=e,o.addEventListener("click",i),o}}]),n}(t_);function $_(t){var e=tx();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function tx(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ex=function(t){Yt(n,t);var e=$_(n);function n(t){var r;Ot(this,n),r=e.call(this),(0,Ft.Z)(Kt(r),"isShow",!0),(0,Ft.Z)(Kt(r),"onMouseMove",(function(t){var e,n=r.mapsService.getMapContainer(),i=null!==(e=null===n||void 0===n?void 0:n.getBoundingClientRect())&&void 0!==e?e:{},o=i.left,a=void 0===o?0:o,s=i.top,u=void 0===s?0:s;r.setPopupPosition(t.clientX-a,t.clientY-u)})),(0,Ft.Z)(Kt(r),"updateLngLatPosition",(function(){if(r.mapsService&&!r.popupOption.followCursor){var t=r.lngLat,e=t.lng,n=t.lat,i=r.mapsService.lngLatToContainer([e,n]),o=i.x,a=i.y;r.setPopupPosition(o,a)}})),(0,Ft.Z)(Kt(r),"onKeyDown",(function(t){27===t.keyCode&&r.remove()})),(0,Ft.Z)(Kt(r),"onCloseButtonClick",(function(t){t.stopPropagation&&t.stopPropagation(),r.hide()})),(0,Ft.Z)(Kt(r),"update",(function(){var t=!!r.lngLat,e=r.popupOption,n=e.className,i=e.style,o=e.maxWidth,a=e.anchor,s=e.stopPropagation;if(r.mapsService&&t&&r.content){var u=r.mapsService.getMarkerContainer();if(!r.container&&u&&(r.container=Bi("div","l7-popup ".concat(null!==n&&void 0!==n?n:""," ").concat(r.isShow?"":"l7-popup-hide"),u),i&&r.container.setAttribute("style",i),r.tip=Bi("div","l7-popup-tip",r.container),r.container.appendChild(r.content),s&&["mousemove","mousedown","mouseup","click","dblclick"].forEach((function(t){r.container.addEventListener(t,(function(t){t.stopPropagation()}))})),r.container.style.whiteSpace="nowrap"),r.updateLngLatPosition(),Xi(r.container,"".concat(Br[a])),Ur(r.container,a,"popup"),o){var c=r.container.getBoundingClientRect(),l=c.width;l>parseFloat(o)&&(r.container.style.width=o)}else r.container.style.removeProperty("width")}})),r.popupOption=(0,k.Z)((0,k.Z)({},r.getDefault(null!==t&&void 0!==t?t:{})),t);var i=r.popupOption.lngLat;return i&&(r.lngLat=i),r}return zt(n,[{key:"lngLat",get:function(){var t;return null!==(t=this.popupOption.lngLat)&&void 0!==t?t:{lng:0,lat:0}},set:function(t){this.popupOption.lngLat=t}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(t){this.mapsService=t.get(wc.IMapService),this.sceneService=t.get(wc.ISceneService),this.layerService=t.get(wc.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=t,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var e=this.popupOption,n=e.html,r=e.text,i=e.title;return n?this.setHTML(n):r&&this.setText(r),i&&this.setTitle(i),this.emit("open"),this}},{key:"remove",value:function(){if(null!==this&&void 0!==this&&this.isOpen())return this.content&&Ui(this.content),this.container&&(Ui(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(t){return this.show(),this.popupOption=(0,k.Z)((0,k.Z)({},this.popupOption),t),this.checkUpdateOption(t,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Ui(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(t,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(t,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(t,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(t,["html"])&&t.html?this.setHTML(t.html):this.checkUpdateOption(t,["text"])&&t.text&&this.setText(t.text),this.checkUpdateOption(t,["lngLat"])&&t.lngLat&&this.setLnglat(t.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&Zi(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&ji(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(t){return this.popupOption.html=t,this.setDOMContent(t)}},{key:"setText",value:function(t){return this.popupOption.text=t,this.setDOMContent(window.document.createTextNode(t))}},{key:"setTitle",value:function(t){this.show(),this.popupOption.title=t,t?(this.contentTitle||(this.contentTitle=Bi("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),ao(this.contentTitle),uo(this.contentTitle,t)):this.contentTitle&&(Ui(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var t=this.lngLat,e=t.lng,n=t.lat;return this.popupOption.autoPan&&this.mapsService.panTo([e,n]),this}},{key:"setLngLat",value:function(t){return this.setLnglat(t)}},{key:"setLnglat",value:function(t){var e=this;return this.show(),this.lngLat=t,Array.isArray(t)&&(this.lngLat={lng:t[0],lat:t[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout((function(){e.panToPopup()}),0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(t){return this.popupOption.maxWidth=t,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(t){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:Fr.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(t){return this.show(),this.createContent(),uo(this.contentPanel,t),this.update(),this}},{key:"updateCloseOnClick",value:function(t){var e=this,n=this.mapsService;n&&(null===n||void 0===n||n.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!t&&requestAnimationFrame((function(){null===n||void 0===n||n.on("click",e.onCloseButtonClick)})))}},{key:"updateCloseOnEsc",value:function(t){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!t&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(t){var e,n=null===(e=this.mapsService)||void 0===e?void 0:e.getContainer();n&&(null===n||void 0===n||n.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!t&&(null===n||void 0===n||n.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var t=this;if(this.content&&Ui(this.content),this.contentTitle=void 0,this.content=Bi("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var e=v_("l7-icon-guanbi");ji(e,"l7-popup-close-button"),this.content.appendChild(e),this.popupOption.closeButtonOffsets&&(e.style.right=this.popupOption.closeButtonOffsets[0]+"px",e.style.top=this.popupOption.closeButtonOffsets[1]+"px"),e.setAttribute("aria-label","Close popup"),e.addEventListener("click",(function(){t.hide()})),this.closeButton=e}else this.closeButton=void 0;this.contentPanel=Bi("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(t,e){if(this.container){var n=this.popupOption.offsets;this.container.style.left=t+n[0]+"px",this.container.style.top=e-n[1]+"px"}}},{key:"checkUpdateOption",value:function(t,e){return e.some((function(e){return e in t}))}}]),n}(Ma.EventEmitter);function nx(t){var e=rx();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function rx(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ix,ox=function(t){Yt(n,t);var e=nx(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"layerConfigMap",new WeakMap),t}return zt(n,[{key:"layerConfigItems",get:function(){var t,e=this.popupOption,n=e.config,r=e.items;return null!==(t=null!==n&&void 0!==n?n:r)&&void 0!==t?t:[]}},{key:"addTo",value:function(t){return pv(Jt(n.prototype),"addTo",this).call(this,t),this.bindLayerEvent(),this.hide(),this}},{key:"remove",value:function(){return pv(Jt(n.prototype),"remove",this).call(this),this.unbindLayerEvent(),this}},{key:"setOptions",value:function(t){return this.unbindLayerEvent(),pv(Jt(n.prototype),"setOptions",this).call(this,t),this.bindLayerEvent(),this}},{key:"getDefault",value:function(t){var e="click"===t.trigger;return(0,k.Z)((0,k.Z)({},pv(Jt(n.prototype),"getDefault",this).call(this,t)),{},{trigger:"hover",followCursor:!e,lngLat:{lng:0,lat:0},offsets:[0,10],closeButton:!1,closeOnClick:!1,autoClose:!1,closeOnEsc:!1})}},{key:"bindLayerEvent",value:function(){var t=this,e=this.popupOption.trigger;this.layerConfigItems.forEach((function(n){var r,i=t.getLayerByConfig(n);if(i){var o=(0,k.Z)({},n);if("hover"===e){var a=t.onLayerMouseMove.bind(t,i),s=t.onLayerMouseOut.bind(t,i);o.onMouseMove=a,o.onMouseOut=s,null===i||void 0===i||i.on("mousemove",a),null===i||void 0===i||i.on("mouseout",s)}else{var u=t.onLayerClick.bind(t,i);o.onClick=u,null===i||void 0===i||i.on("click",u)}var c=null===i||void 0===i||null===(r=i.getSource)||void 0===r?void 0:r.call(i),l=t.onSourceUpdate.bind(t,i);null===c||void 0===c||c.on("update",l),o.onSourceUpdate=l,t.layerConfigMap.set(i,o)}}))}},{key:"unbindLayerEvent",value:function(){var t=this;this.layerConfigItems.forEach((function(e){var n=t.getLayerByConfig(e),r=n&&t.layerConfigMap.get(n);if(r){var i,o=r.onMouseMove,a=r.onMouseOut,s=r.onClick,u=r.onSourceUpdate;if(o&&n.off("mousemove",o),a&&n.off("mouseout",a),s&&n.off("click",s),u)null===n||void 0===n||null===(i=n.getSource())||void 0===i||i.off("update",u)}}))}},{key:"onLayerMouseMove",value:function(t,e){if(!this.isSameFeature(t,e.featureId)){var n=this.getLayerInfoFrag(t,e),r=n.title,i=n.content;this.setDOMContent(i),this.setTitle(r),this.displayFeatureInfo={layer:t,featureId:e.featureId},this.show()}}},{key:"onLayerMouseOut",value:function(t,e){this.displayFeatureInfo=void 0,this.isShow&&this.hide()}},{key:"onLayerClick",value:function(t,e){if(this.isShow&&this.isSameFeature(t,e.featureId))this.hide();else{var n=this.getLayerInfoFrag(t,e),r=n.title,i=n.content;this.setDOMContent(i),this.setLnglat(e.lngLat),this.setTitle(r),this.displayFeatureInfo={layer:t,featureId:e.featureId},this.show()}}},{key:"onSourceUpdate",value:function(t){this.hide(),this.displayFeatureInfo=void 0}},{key:"getLayerInfoFrag",value:function(t,e){var n,r=this.layerConfigMap.get(t),i=document.createDocumentFragment();if(r){var o=e.feature;"Feature"===o.type&&"properties"in o&&"geometry"in o&&(o=o.properties);var a=r.title,s=r.fields,u=r.customContent;if(a){n=document.createDocumentFragment();var c=a instanceof Function?a(o):a;uo(n,c)}if(u){var l=u instanceof Function?u(o):u;uo(i,l)}else null!==s&&void 0!==s&&s.length&&(null===s||void 0===s||s.forEach((function(t){var n,r,a="string"===typeof t?{field:t}:t,s=a.field,u=a.formatField,c=a.formatValue,l=a.getValue,h=Bi("div","l7-layer-popup__row"),f=l?l(e.feature):(0,Oi.get)(o,s),p=null!==(n=u instanceof Function?u(s,o):u)&&void 0!==n?n:s,d=null!==(r=c instanceof Function?c(f,o):c)&&void 0!==r?r:f,v=Bi("span","l7-layer-popup__key",h);uo(v,p),uo(v,document.createTextNode("："));var m=Bi("span","l7-layer-popup__value",h);Array.isArray(d)&&d.every((function(t){return!(t instanceof Object)}))&&(d=d.map((function(t){return String(t)})).join(",")),uo(m,d),i.appendChild(h)})))}return{title:n,content:i}}},{key:"getLayerByConfig",value:function(t){var e=t.layer;return e instanceof Object?e:"string"===typeof e?this.layerService.getLayer(e)||this.layerService.getLayerByName(e):void 0}},{key:"isSameFeature",value:function(t,e){var n=this.displayFeatureInfo;return n&&t===n.layer&&e===n.featureId}}]),n}(ex);function ax(t,e){var n="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,r="undefined"!==typeof wx&&null!==wx&&("undefined"!==typeof wx.request||"undefined"!==typeof wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a),a}}ax(".l7-marker-container {\n  position: absolute;\n  width: 100%;\n  height: 100%;\n  overflow: hidden;\n}\n.l7-marker {\n  position: absolute !important;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  cursor: pointer;\n}\n.l7-marker-cluster {\n  width: 40px;\n  height: 40px;\n  background-color: rgba(181, 226, 140, 0.6);\n  background-clip: padding-box;\n  border-radius: 20px;\n}\n.l7-marker-cluster div {\n  width: 30px;\n  height: 30px;\n  margin-top: 5px;\n  margin-left: 5px;\n  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  text-align: center;\n  background-color: rgba(110, 204, 57, 0.6);\n  border-radius: 15px;\n}\n.l7-marker-cluster span {\n  line-height: 30px;\n}\n.l7-touch .l7-control-attribution,\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  -webkit-box-shadow: none;\n          box-shadow: none;\n}\n.l7-touch .l7-control-layers,\n.l7-touch .l7-bar {\n  background-clip: padding-box;\n  border: 2px solid rgba(0, 0, 0, 0.2);\n}\n.mapboxgl-ctrl-logo,\n.amap-logo {\n  display: none !important;\n}\n.l7-select-box {\n  border: 3px dashed gray;\n  border-radius: 2px;\n  position: absolute;\n  z-index: 1000;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n}\n.l7-control-container {\n  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;\n}\n.l7-control-container .l7-control {\n  position: relative;\n  z-index: 800;\n  float: left;\n  clear: both;\n  color: #595959;\n  font-size: 12px;\n  pointer-events: visiblePainted;\n  /* IE 9-10 doesn't have auto */\n  pointer-events: auto;\n}\n.l7-control-container .l7-control.l7-control--hide {\n  display: none;\n}\n.l7-control-container .l7-top {\n  top: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {\n  margin-top: 8px;\n}\n.l7-control-container .l7-right {\n  right: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {\n  margin-right: 8px;\n}\n.l7-control-container .l7-bottom {\n  bottom: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-left {\n  left: 0;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  position: absolute;\n  z-index: 1000;\n  pointer-events: none;\n}\n.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {\n  margin-left: 8px;\n}\n.l7-control-container .l7-center {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n}\n.l7-control-container .l7-center.l7-top,\n.l7-control-container .l7-center.l7-bottom {\n  width: 100%;\n}\n.l7-control-container .l7-center.l7-left,\n.l7-control-container .l7-center.l7-right {\n  height: 100%;\n}\n.l7-control-container .l7-center .l7-control {\n  margin-right: 8px;\n  margin-bottom: 8px;\n}\n.l7-control-container .l7-row {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-control-container .l7-row.l7-top {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-row.l7-bottom {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-control-container .l7-column {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-container .l7-column.l7-left {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-control-container .l7-column.l7-right {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-button-control {\n  min-width: 28px;\n  height: 28px;\n  background-color: #fff;\n  border-width: 0;\n  border-radius: 2px;\n  outline: 0;\n  cursor: pointer;\n  -webkit-transition: all 0.2s;\n  transition: all 0.2s;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 6px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  line-height: 16px;\n}\n.l7-button-control .l7-iconfont {\n  fill: #595959;\n  color: #595959;\n  width: 16px;\n  height: 16px;\n}\n.l7-button-control.l7-button-control--row {\n  padding: 0 16px 0 13px;\n}\n.l7-button-control.l7-button-control--row * + .l7-button-control__text {\n  margin-left: 8px;\n}\n.l7-button-control.l7-button-control--column {\n  height: 44px;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-button-control.l7-button-control--column .l7-iconfont {\n  margin-top: 3px;\n}\n.l7-button-control.l7-button-control--column .l7-button-control__text {\n  margin-top: 3px;\n  font-size: 10px;\n  -webkit-transform: scale(0.83333);\n          transform: scale(0.83333);\n}\n.l7-button-control:not(:disabled):hover {\n  background-color: #f3f3f3;\n}\n.l7-button-control:not(:disabled):active {\n  background-color: #f3f3f3;\n}\n.l7-button-control:disabled {\n  background-color: #fafafa;\n  color: #bdbdbd;\n  cursor: not-allowed;\n}\n.l7-button-control:disabled .l7-iconfont {\n  fill: #bdbdbd;\n  color: #bdbdbd;\n}\n.l7-button-control:disabled:hover {\n  background-color: #fafafa;\n}\n.l7-button-control:disabled:active {\n  background-color: #fafafa;\n}\n.l7-popper {\n  position: absolute;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  z-index: 5;\n  color: #595959;\n}\n.l7-popper.l7-popper-hide {\n  display: none;\n}\n.l7-popper .l7-popper-content {\n  min-height: 28px;\n  background: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper .l7-popper-arrow {\n  width: 0;\n  height: 0;\n  border-width: 4px;\n  border-style: solid;\n  border-top-color: transparent;\n  border-bottom-color: transparent;\n  border-left-color: transparent;\n  border-right-color: transparent;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n}\n.l7-popper.l7-popper-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popper.l7-popper-left .l7-popper-arrow {\n  border-left-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popper.l7-popper-right .l7-popper-arrow {\n  border-right-color: #fff;\n  margin: 10px 0;\n}\n.l7-popper.l7-popper-top {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popper.l7-popper-top .l7-popper-arrow {\n  border-top-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-bottom {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popper.l7-popper-bottom .l7-popper-arrow {\n  border-bottom-color: #fff;\n  margin: 0 10px;\n}\n.l7-popper.l7-popper-start {\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-popper.l7-popper-end {\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-select-control--normal {\n  padding: 4px 0;\n}\n.l7-select-control--normal .l7-select-control-item {\n  height: 24px;\n  line-height: 24px;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  padding: 0 16px;\n  font-size: 12px;\n}\n.l7-select-control--normal .l7-select-control-item > * + * {\n  margin-left: 6px;\n}\n.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {\n  height: 14px;\n  width: 14px;\n}\n.l7-select-control--normal .l7-select-control-item:hover {\n  background-color: #f3f3f3;\n}\n.l7-select-control--image {\n  padding: 12px 12px 0 12px;\n  width: 474px;\n  height: 320px;\n  overflow: auto;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -ms-flex-wrap: wrap;\n      flex-wrap: wrap;\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  -webkit-box-align: start;\n      -ms-flex-align: start;\n          align-items: flex-start;\n}\n.l7-select-control--image .l7-select-control-item {\n  margin-right: 12px;\n  border-radius: 2px;\n  overflow: hidden;\n  border: 1px solid #fff;\n  -webkit-box-sizing: content-box;\n          box-sizing: content-box;\n  width: calc((100% - 36px) / 3);\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  margin-bottom: 12px;\n  position: relative;\n  font-size: 12px;\n}\n.l7-select-control--image .l7-select-control-item img {\n  width: 142px;\n  height: 80px;\n}\n.l7-select-control--image .l7-select-control-item input[type='checkbox'] {\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-pack: center;\n      -ms-flex-pack: center;\n          justify-content: center;\n  -webkit-box-align: center;\n      -ms-flex-align: center;\n          align-items: center;\n  line-height: 26px;\n}\n.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {\n  margin-left: 8px;\n}\n.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {\n  border-color: #0370fe;\n}\n.l7-select-control--image .l7-select-control-item:nth-child(3n) {\n  margin-right: 0;\n}\n.l7-select-control-item {\n  cursor: pointer;\n}\n.l7-select-control-item input[type='checkbox'] {\n  margin: 0;\n  cursor: pointer;\n}\n.l7-select-control--multiple .l7-select-control-item:hover {\n  background-color: transparent;\n}\n.l7-control-logo {\n  width: 89px;\n  height: 16px;\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n}\n.l7-control-logo img {\n  height: 100%;\n  width: 100%;\n}\n.l7-control-logo .l7-control-logo-link {\n  display: block;\n  cursor: pointer;\n}\n.l7-control-logo .l7-control-logo-link img {\n  cursor: pointer;\n}\n.l7-control-mouse-location {\n  background-color: #fff;\n  border-radius: 2px;\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  padding: 2px 4px;\n  min-width: 130px;\n}\n.l7-control-zoom {\n  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);\n  border-radius: 2px;\n  overflow: hidden;\n}\n.l7-control-zoom .l7-button-control {\n  -webkit-box-shadow: 0 0 0;\n          box-shadow: 0 0 0;\n  border-radius: 0;\n  font-size: 16px;\n}\n.l7-control-zoom .l7-button-control .l7-iconfont {\n  width: 14px;\n  height: 14px;\n}\n.l7-control-zoom .l7-button-control:first-child {\n  border-bottom: 1px solid #f0f0f0;\n}\n.l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-control-scale .l7-control-scale-line {\n  -webkit-box-sizing: border-box;\n          box-sizing: border-box;\n  padding: 2px 5px 1px;\n  overflow: hidden;\n  color: #595959;\n  font-size: 10px;\n  line-height: 1.1;\n  white-space: nowrap;\n  background: #fff;\n  border: 2px solid #000;\n  border-top: 0;\n  -webkit-transition: width 0.1s;\n  transition: width 0.1s;\n}\n.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {\n  margin-top: -2px;\n  border-top: 2px solid #777;\n  border-bottom: none;\n}\n.l7-right .l7-control-scale {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  -webkit-box-align: end;\n      -ms-flex-align: end;\n          align-items: flex-end;\n}\n.l7-right .l7-control-scale .l7-control-scale-line {\n  text-align: right;\n}\n.l7-popup {\n  position: absolute;\n  top: 0;\n  left: 0;\n  z-index: 5;\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n  will-change: transform;\n  pointer-events: none;\n}\n.l7-popup.l7-popup-hide {\n  display: none;\n}\n.l7-popup .l7-popup-content {\n  position: relative;\n  padding: 16px;\n  font-size: 14px;\n  background: #fff;\n  border-radius: 3px;\n  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n.l7-popup .l7-popup-content .l7-popup-content__title {\n  margin-bottom: 8px;\n  font-weight: bold;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button,\n.l7-popup .l7-popup-content .l7-popup-content__title,\n.l7-popup .l7-popup-content .l7-popup-content__panel {\n  white-space: normal;\n  -webkit-user-select: text;\n     -moz-user-select: text;\n      -ms-user-select: text;\n          user-select: text;\n  pointer-events: initial;\n}\n.l7-popup .l7-popup-content .l7-popup-close-button {\n  position: absolute;\n  top: 0;\n  right: 0;\n  width: 18px;\n  height: 18px;\n  padding: 0;\n  font-size: 14px;\n  line-height: 18px;\n  text-align: center;\n  background-color: transparent;\n  border: 0;\n  border-radius: 0 3px 0 0;\n  cursor: pointer;\n}\n.l7-popup .l7-popup-tip {\n  position: relative;\n  z-index: 1;\n  width: 0;\n  height: 0;\n  border: 10px solid transparent;\n}\n.l7-popup.l7-popup-anchor-bottom,\n.l7-popup.l7-popup-anchor-bottom-left,\n.l7-popup.l7-popup-anchor-bottom-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: column-reverse;\n          flex-direction: column-reverse;\n}\n.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {\n  bottom: 1px;\n}\n.l7-popup.l7-popup-anchor-top,\n.l7-popup.l7-popup-anchor-top-left,\n.l7-popup.l7-popup-anchor-top-right {\n  -webkit-box-orient: vertical;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: column;\n          flex-direction: column;\n}\n.l7-popup.l7-popup-anchor-top .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,\n.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {\n  top: 1px;\n}\n.l7-popup.l7-popup-anchor-left {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: normal;\n      -ms-flex-direction: row;\n          flex-direction: row;\n}\n.l7-popup.l7-popup-anchor-right {\n  -webkit-box-orient: horizontal;\n  -webkit-box-direction: reverse;\n      -ms-flex-direction: row-reverse;\n          flex-direction: row-reverse;\n}\n.l7-popup-anchor-top .l7-popup-tip {\n  position: relative;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top: none;\n  border-bottom-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-top-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top: none;\n  border-right: none;\n  border-bottom-color: #fff;\n}\n.l7-popup-anchor-bottom .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-top-color: #fff;\n  border-bottom: none;\n}\n.l7-popup-anchor-bottom-left .l7-popup-tip {\n  -webkit-align-self: flex-start;\n  -ms-flex-item-align: start;\n      align-self: flex-start;\n  border-top-color: #fff;\n  border-bottom: none;\n  border-left: none;\n}\n.l7-popup-anchor-bottom-right .l7-popup-tip {\n  -webkit-align-self: flex-end;\n  -ms-flex-item-align: end;\n      align-self: flex-end;\n  border-top-color: #fff;\n  border-right: none;\n  border-bottom: none;\n}\n.l7-popup-anchor-left .l7-popup-tip {\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right-color: #fff;\n  border-left: none;\n}\n.l7-popup-anchor-right .l7-popup-tip {\n  right: 1px;\n  -webkit-align-self: center;\n  -ms-flex-item-align: center;\n      align-self: center;\n  border-right: none;\n  border-left-color: #fff;\n}\n.l7-popup-anchor-top-left .l7-popup-content {\n  border-top-left-radius: 0;\n}\n.l7-popup-anchor-top-right .l7-popup-content {\n  border-top-right-radius: 0;\n}\n.l7-popup-anchor-bottom-left .l7-popup-content {\n  border-bottom-left-radius: 0;\n}\n.l7-popup-anchor-bottom-right .l7-popup-content {\n  border-bottom-right-radius: 0;\n}\n.l7-popup-track-pointer {\n  display: none;\n}\n.l7-popup-track-pointer * {\n  -webkit-user-select: none;\n     -moz-user-select: none;\n      -ms-user-select: none;\n          user-select: none;\n  pointer-events: none;\n}\n.l7-map:hover .l7-popup-track-pointer {\n  display: -webkit-box;\n  display: -ms-flexbox;\n  display: flex;\n}\n.l7-map:active .l7-popup-track-pointer {\n  display: none;\n}\n.l7-layer-popup__row {\n  font-size: 12px;\n}\n.l7-layer-popup__row + .l7-layer-popup__row {\n  margin-top: 4px;\n}\n");var sx=(ix={},(0,Ft.Z)(ix,_h.additive,{enable:!0,func:{srcRGB:vf.ONE,dstRGB:vf.ONE,srcAlpha:1,dstAlpha:1}}),(0,Ft.Z)(ix,_h.none,{enable:!1}),(0,Ft.Z)(ix,_h.normal,{enable:!0,func:{srcRGB:vf.SRC_ALPHA,dstRGB:vf.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,Ft.Z)(ix,_h.subtractive,{enable:!0,func:{srcRGB:vf.ONE,dstRGB:vf.ONE,srcAlpha:vf.ZERO,dstAlpha:vf.ONE_MINUS_SRC_COLOR},equation:{rgb:vf.FUNC_SUBTRACT,alpha:vf.FUNC_SUBTRACT}}),(0,Ft.Z)(ix,_h.max,{enable:!0,func:{srcRGB:vf.ONE,dstRGB:vf.ONE},equation:{rgb:vf.MAX_EXT}}),(0,Ft.Z)(ix,_h.min,{enable:!0,func:{srcRGB:vf.ONE,dstRGB:vf.ONE},equation:{rgb:vf.MIN_EXT}}),ix),ux=function(t){return t["GAODE1.x"]="GAODE1.x",t["GAODE2.x"]="GAODE2.x",t["MAPBOX"]="MAPBOX",t["DEFUALT"]="DEFUALTMAP",t["SIMPLE"]="SIMPLE",t["GLOBEL"]="GLOBEL",t}({});function cx(t,e){var n=[e[0]-t[0],e[1]-t[1]],r=Zo(n),i=[t[0]+1e-4*r[0],t[1]+1e-4*r[1]];return i}function lx(t,e,n){if(t.length>0&&e.version===ux["GAODE2.x"]){var r=n.coordCenter;t[0].coordinates[0],t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=ux["GAODE2.x"],t.originCoordinates=(0,Oi.cloneDeep)(t.coordinates),t.coordinates=e.coordToAMap2RelativeCoordinates(t.coordinates,r)}))}}function hx(t,e){t.length>0&&e.version===ux.SIMPLE&&t.map((function(t){t.simpleCoordinate||(t.coordinates=fx(t.coordinates,e),t.simpleCoordinate=!0)}))}function fx(t,e){if("number"===typeof t[0])return e.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var n=[];return t.map((function(t){var r=[];t.map((function(t){r.push(e.simpleMapCoord.unproject(t))})),n.push(r)})),n}var r=[];return t.map((function(t){r.push(e.simpleMapCoord.unproject(t))})),r}function px(t,e){var n;if(!t.scale)return[];var r=(null===t||void 0===t||null===(n=t.scale)||void 0===n?void 0:n.scalers)||[],i=[];r.forEach((function(n){var r,o=n.field;(e.hasOwnProperty(o)||"variable"===(null===(r=t.scale)||void 0===r?void 0:r.type))&&i.push(e[o])}));var o=t.mapping?t.mapping(i):[];return o}function dx(t,e,n,r,i){var o=null===i||void 0===i?void 0:i.getLayerConfig(),a=o.arrow,s=void 0===a?{enable:!1}:a,u=e.map((function(e){var r={id:e._id,coordinates:e.coordinates};if(t.filter((function(t){return void 0!==t.scale})).forEach((function(t){var i=px(t,e);t.needRemapping=!1,"color"===t.name&&(i=i.map((function(t){return bi(t)}))),r[t.name]=Array.isArray(i)&&1===i.length?i[0]:i,"shape"===t.name&&(r.shape=n.getIconFontKey(r[t.name]))})),"line"===r.shape&&s.enable){var i=r.coordinates,o=cx(i[0],i[1]);r.coordinates.splice(1,0,o,o)}return r}));return lx(u,r,i),hx(u,r),u}function vx(t,e,n,r,i,o){var a=new Hy(i,o),s=r.getLayerStyleAttributes()||[],u=a.data.dataArray,c=u,l=dx(s,c,e,n,t);return a.destroy(),l}function mx(t){return t.map((function(t){return"string"===typeof t&&(t=[t,{}]),t}))}function gx(t,e,n,r){var i=t.multiPassRenderer,o=t.getLayerConfig(),a=o.enableTAA;return a?i.add(r("taa")):i.add(r("render")),mx(e).forEach((function(t){var e=(0,Li.Z)(t,2),r=e[0],o=e[1];i.add(n(r),o)})),i.add(n("copy")),i}var yx,_x,xx,bx=function(){function t(e){Ot(this,t),this.layer=e}return zt(t,[{key:"pickRender",value:function(t){var e=this.layer.getContainer(),n=e.get(wc.ILayerService),r=this.layer;if(r.tileLayer)return r.tileLayer.pickRender(t);r.hooks.beforePickingEncode.call(),n.renderTileLayerMask(r),r.renderModels({ispick:!0}),r.hooks.afterPickingEncode.call()}},{key:"pick",value:function(t,e){var n=this.layer.getContainer(),r=n.get(wc.IPickingService);return"RasterLayer"===t.type?this.pickRasterLayer(t,e):(this.pickRender(e),r.pickFromPickingFBO(t,e))}},{key:"pickRasterLayer",value:function(t,e,n){var r=this.layer.getContainer(),i=r.get(wc.IPickingService),o=r.get(wc.IMapService),a=this.layer.getSource().extent,s=Eo(e.lngLat,a),u={x:e.x,y:e.y,type:e.type,lngLat:e.lngLat,target:e,rasterValue:null},c=n||t;if(s){var l=this.readRasterValue(t,a,o,e.x,e.y);return u.rasterValue=l,i.triggerHoverOnLayer(c,u),!0}return u.type="mousemove"===e.type?"mouseout":"un"+e.type,i.triggerHoverOnLayer(c,(0,k.Z)((0,k.Z)({},u),{},{type:"unpick"})),i.triggerHoverOnLayer(c,u),!1}},{key:"readRasterValue",value:function(t,e,n,r,i){var o=t.getSource().data.dataArray[0],a=(0,Li.Z)(e,4),s=a[0],u=void 0===s?0:s,c=a[1],l=void 0===c?0:c,h=a[2],f=void 0===h?10:h,p=a[3],d=void 0===p?-10:p,v=n.lngLatToContainer([u,l]),m=n.lngLatToContainer([f,d]),g=m.x-v.x,y=v.y-m.y,_=[(r-v.x)/g,(i-m.y)/y],x=o.width||1,b=o.height||1,w=Math.floor(_[0]*x),E=Math.floor(_[1]*b),S=Math.max(0,E-1)*x+w,A=o.data[S];return A}},{key:"selectFeature",value:function(t){var e=this.layer,n=(0,Li.Z)(t,3),r=n[0],i=n[1],o=n[2];e.hooks.beforeSelect.call([r,i,o])}},{key:"highlightPickedFeature",value:function(t){var e=(0,Li.Z)(t,3),n=e[0],r=e[1],i=e[2];this.layer.hooks.beforeHighlight.call([n,r,i])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),t}(),Ex=function(){function t(e){Ot(this,t),this.layer=e;var n=this.layer.getContainer();this.rendererService=n.get(wc.IRendererService)}return zt(t,[{key:"getColorTexture",value:function(t,e){var n=this.getTextureKey(t,e);return this.key===n||(this.createColorTexture(t,e),this.key=n),this.colorTexture}},{key:"createColorTexture",value:function(t,e){var n=this.rendererService.createTexture2D,r=this.getColorRampBar(t,e),i=n({data:new Uint8Array(r.data),width:r.width,height:r.height,flipY:!1});return this.colorTexture=i,i}},{key:"setColorTexture",value:function(t,e,n){this.key=this.getTextureKey(e,n),this.colorTexture=t}},{key:"destroy",value:function(){var t;null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"getColorRampBar",value:function(t,e){switch(t.type){case"cat":return Ti(t);case"quantize":return Ci(t);case"custom":return ki(t,e);case"linear":return Ai(t,e);default:return Si(t)}}},{key:"getTextureKey",value:function(t,e){var n;return"".concat(t.colors.join("_"),"_").concat(null===t||void 0===t||null===(n=t.positions)||void 0===n?void 0:n.join("_"),"_").concat(t.type,"_").concat(null===e||void 0===e?void 0:e.join("_"))}}]),t}(),Sx=["passes"],Ax=["moduleName","vertexShader","fragmentShader","inject","triangulation","segmentNumber"];function Tx(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=Cx(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function Cx(t,e){if(t){if("string"===typeof t)return kx(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kx(t,e):void 0}}function kx(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Mx(t){var e=Px();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Px(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Ix,Rx,Lx,Ox=0,Dx=(yx=Eg(wc.IGlobalConfigService),_x=function(t){Yt(n,t);var e=Mx(n);function n(){var t,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ot(this,n),t=e.call(this),(0,Ft.Z)(Kt(t),"id","".concat(Ox++)),(0,Ft.Z)(Kt(t),"name","".concat(Ox)),(0,Ft.Z)(Kt(t),"visible",!0),(0,Ft.Z)(Kt(t),"zIndex",0),(0,Ft.Z)(Kt(t),"inited",!1),(0,Ft.Z)(Kt(t),"layerModelNeedUpdate",!1),(0,Ft.Z)(Kt(t),"pickedFeatureID",null),(0,Ft.Z)(Kt(t),"selectedFeatureID",null),(0,Ft.Z)(Kt(t),"styleNeedUpdate",!1),(0,Ft.Z)(Kt(t),"forceRender",!1),(0,Ft.Z)(Kt(t),"clusterZoom",0),(0,Ft.Z)(Kt(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,Ft.Z)(Kt(t),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,Ft.Z)(Kt(t),"hooks",{init:new Dd,afterInit:new Ld,beforeRender:new Ld,beforeRenderData:new Nd,afterRender:new Wp,beforePickingEncode:new Wp,afterPickingEncode:new Wp,beforeHighlight:new Wp(["pickedColor"]),afterHighlight:new Wp,beforeSelect:new Wp(["pickedColor"]),afterSelect:new Wp,beforeDestroy:new Wp,afterDestroy:new Wp}),(0,Ft.Z)(Kt(t),"models",[]),(0,Ft.Z)(Kt(t),"startInit",!1),(0,Ft.Z)(Kt(t),"layerChildren",[]),(0,Ft.Z)(Kt(t),"masks",[]),Oh(Kt(t),"configService",xx,Kt(t)),(0,Ft.Z)(Kt(t),"animateOptions",{enable:!1}),(0,Ft.Z)(Kt(t),"currentPickId",null),(0,Ft.Z)(Kt(t),"encodeStyleAttribute",{}),(0,Ft.Z)(Kt(t),"enableEncodeStyles",[]),(0,Ft.Z)(Kt(t),"pendingStyleAttributes",[]),(0,Ft.Z)(Kt(t),"scaleOptions",{}),(0,Ft.Z)(Kt(t),"animateStatus",!1),(0,Ft.Z)(Kt(t),"isDestroyed",!1),(0,Ft.Z)(Kt(t),"encodeDataLength",0),(0,Ft.Z)(Kt(t),"sourceEvent",(function(){t.dataState.dataSourceNeedUpdate=!0;var e=t.getLayerConfig();e&&e.autoFit&&t.fitBounds(e.fitBoundsOptions);var n=t.layerSource.getSourceCfg().autoRender;n&&t.reRender()})),t.name=r.name||t.id,t.zIndex=r.zIndex||0,t.rawConfig=r,t}return zt(n,[{key:"addMask",value:function(t){this.masks.push(t),this.enableMask()}},{key:"removeMask",value:function(t){var e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1)}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(t){this.masks.push(t)}},{key:"removeMaskLayer",value:function(t){var e=this.masks.indexOf(t);e>-1&&this.masks.splice(e,1),t.destroy()}},{key:"getAttribute",value:function(t){return this.styleAttributeService.getLayerStyleAttribute(t)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(t){var e=this;if(Object.keys(t).map((function(n){n in e.rawConfig&&(e.rawConfig[n]=t[n])})),this.startInit){var n=this.container.get(wc.SceneID);this.configService.setLayerConfig(n,this.id,(0,k.Z)((0,k.Z)((0,k.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),t)),this.needUpdateConfig={}}else this.needUpdateConfig=(0,k.Z)((0,k.Z)({},this.needUpdateConfig),t)}},{key:"setContainer",value:function(t,e){this.container=t,this.sceneContainer=e}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(t){return this.plugins.push(t),this}},{key:"init",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=this.container.get(wc.SceneID),this.startInit=!0,this.configService.setLayerConfig(e,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(wc.IIconService),this.fontService=this.container.get(wc.IFontService),this.rendererService=this.container.get(wc.IRendererService),this.layerService=this.container.get(wc.ILayerService),this.debugService=this.container.get(wc.IDebugService),this.interactionService=this.container.get(wc.IInteractionService),this.pickingService=this.container.get(wc.IPickingService),this.mapService=this.container.get(wc.IMapService),n=this.getLayerConfig(),r=n.enableMultiPassRenderer,i=n.passes,r&&null!==i&&void 0!==i&&i.length&&i.length>0&&this.mapService.on("mapAfterFrameChange",(function(){u.renderLayers()})),this.cameraService=this.container.get(wc.ICameraService),this.coordinateService=this.container.get(wc.ICoordinateSystemService),this.shaderModuleService=this.container.get(wc.IShaderModuleService),this.postProcessingPassFactory=this.container.get(wc.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(wc.IFactoryNormalPass),this.styleAttributeService=this.container.get(wc.IStyleAttributeService),r&&(this.multiPassRenderer=this.container.get(wc.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach((function(t){var e=t.attributeName,n=t.attributeField,r=t.attributeValues,i=t.updateOptions;u.styleAttributeService.updateStyleAttribute(e,{scale:(0,k.Z)({field:n},u.splitValuesAndCallbackInAttribute(r,u.getLayerConfig()[e]))},i)})),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(wc.ILayerPlugin),o=Tx(this.plugins);try{for(o.s();!(a=o.n()).done;)s=a.value,s.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(c){o.e(c)}finally{o.f()}return this.layerPickService=new bx(this),this.textureService=new Ex(this),this.log(Zg.LayerInitStart),t.next=31,this.hooks.init.promise();case 31:this.log(Zg.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"log",value:function(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"init";if(!this.tileLayer&&!this.isTileLayer){var r="".concat(this.id,".").concat(n,".").concat(t),i={id:this.id,type:this.type};null===(e=this.debugService)||void 0===e||e.log(r,i)}}},{key:"updateModelData",value:function(t){t.attributes&&t.elements&&this.models.map((function(e){e.updateAttributesAndElements(t.attributes,t.elements)}))}},{key:"createModelData",value:function(t,e){var n;if(null!==(n=this.layerModel)&&void 0!==n&&n.createModelData)return this.layerModel.createModelData(e);var r=this.calculateEncodeData(t,e),i=this.triangulation;return r&&i?this.styleAttributeService.createAttributesAndIndices(r,i):{attributes:void 0,elements:void 0}}},{key:"setLayerPickService",value:function(t){this.layerPickService=t}},{key:"calculateEncodeData",value:function(t,e){return this.inited?vx(this,this.fontService,this.mapService,this.styleAttributeService,t,e):null}},{key:"prepareBuildModel",value:function(){0!==Object.keys(this.needUpdateConfig||{}).length&&this.updateLayerConfig({});var t=this.getLayerConfig(),e=t.animateOption;null!==e&&void 0!==e&&e.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(t,e,n){return this.updateStyleAttribute("color",t,e,n),this}},{key:"texture",value:function(t,e,n){return this.updateStyleAttribute("texture",t,e,n),this}},{key:"rotate",value:function(t,e,n){return this.updateStyleAttribute("rotate",t,e,n),this}},{key:"size",value:function(t,e,n){return this.updateStyleAttribute("size",t,e,n),this}},{key:"filter",value:function(t,e,n){var r=this.updateStyleAttribute("filter",t,e,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"shape",value:function(t,e,n){this.shapeOption={field:t,values:e};var r=this.updateStyleAttribute("shape",t,e,n);return this.dataState.dataSourceNeedUpdate=r&&this.inited,this}},{key:"label",value:function(t,e,n){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:t,attributeValues:e,updateOptions:n}),this}},{key:"animate",value:function(t){var e={};return(0,Oi.isObject)(t)?(e.enable=!0,e=(0,k.Z)((0,k.Z)({},e),t)):e.enable=t,this.updateLayerConfig({animateOption:e}),this}},{key:"source",value:function(t,e){return"source"===(null===t||void 0===t?void 0:t.type)?(this.setSource(t),this):(this.sourceOption={data:t,options:e},this.clusterZoom=0,this)}},{key:"setData",value:function(t,e){var n=this;return this.inited?(this.log(Zg.SourceInitStart,wh.UPDATE),this.layerSource.setData(t,e),this.log(Zg.SourceInitEnd,wh.UPDATE)):this.on("inited",(function(){n.log(Zg.SourceInitStart,wh.UPDATE);var r=n.getSource();r?n.layerSource.setData(t,e):n.source(new Hy(t,e)),n.layerSource.once("update",(function(){n.log(Zg.SourceInitEnd,wh.UPDATE)}))})),this}},{key:"style",value:function(t){var e=this,n=t.passes,r=Jf(t,Sx);n&&mx(n).forEach((function(t){var n=e.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(t[0]);n&&n.updateOptions(t[1])}));var i=r;return Object.keys(r).forEach((function(t){var e=r[t];!Array.isArray(e)||2!==e.length||(0,Oi.isNumber)(e[0])||(0,Oi.isNumber)(e[1])||(i[t]={field:e[0],value:e[1]})})),this.encodeStyle(i),this.updateLayerConfig(i),this}},{key:"encodeStyle",value:function(t){var e=this;Object.keys(t).forEach((function(n){e.enableEncodeStyles.includes(n)&&(0,Oi.isPlainObject)(t[n])&&(t[n].field||t[n].value)&&!(0,Oi.isEqual)(e.encodeStyleAttribute[n],t[n])?(e.encodeStyleAttribute[n]=t[n],e.updateStyleAttribute(n,t[n].field,t[n].value),e.styleNeedUpdate=!0):e.encodeStyleAttribute[n]&&delete e.encodeStyleAttribute[n]}))}},{key:"scale",value:function(t,e){var n=(0,k.Z)({},this.scaleOptions);if((0,Oi.isObject)(t)?this.scaleOptions=(0,k.Z)((0,k.Z)({},this.scaleOptions),t):this.scaleOptions[t]=e,this.styleAttributeService&&!(0,Oi.isEqual)(n,this.scaleOptions)){var r=(0,Oi.isObject)(t)?t:(0,Ft.Z)({},t,e);this.styleAttributeService.updateScaleAttribute(r)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"render",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender||this.renderModels(t),this)}},{key:"renderMultiPass",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!(this.encodeDataLength<=0)||this.forceRender){t.next=2;break}return t.abrupt("return");case 2:if(!this.multiPassRenderer||!this.multiPassRenderer.getRenderFlag()){t.next=7;break}return t.next=5,this.multiPassRenderer.render();case 5:t.next=8;break;case 7:this.multiPassRenderer,this.renderModels();case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"active",value:function(t){var e={};return e.enableHighlight=!!(0,Oi.isObject)(t)||t,(0,Oi.isObject)(t)?(e.enableHighlight=!0,t.color&&(e.highlightColor=t.color),t.mix&&(e.activeMix=t.mix)):e.enableHighlight=!!t,this.updateLayerConfig(e),this}},{key:"setActive",value:function(t,e){var n=this;if((0,Oi.isObject)(t)){var r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;this.updateLayerConfig({highlightColor:(0,Oi.isObject)(e)?e.color:this.getLayerConfig().highlightColor,activeMix:(0,Oi.isObject)(e)?e.mix:this.getLayerConfig().activeMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,highlightColor:(0,Oi.isObject)(e)?e.color:this.getLayerConfig().highlightColor,activeMix:(0,Oi.isObject)(e)?e.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(Ei(t)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"select",value:function(t){var e={};return e.enableSelect=!!(0,Oi.isObject)(t)||t,(0,Oi.isObject)(t)?(e.enableSelect=!0,t.color&&(e.selectColor=t.color),t.mix&&(e.selectMix=t.mix)):e.enableSelect=!!t,this.updateLayerConfig(e),this}},{key:"setSelect",value:function(t,e){var n=this;if((0,Oi.isObject)(t)){var r=t.x,i=void 0===r?0:r,o=t.y,a=void 0===o?0:o;this.updateLayerConfig({selectColor:(0,Oi.isObject)(e)?e.color:this.getLayerConfig().selectColor,selectMix:(0,Oi.isObject)(e)?e.mix:this.getLayerConfig().selectMix}),this.pick({x:i,y:a})}else this.updateLayerConfig({pickedFeatureID:t,selectColor:(0,Oi.isObject)(e)?e.color:this.getLayerConfig().selectColor,selectMix:(0,Oi.isObject)(e)?e.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(Ei(t)).then((function(){setTimeout((function(){n.reRender()}),1)}))}},{key:"setBlend",value:function(t){return this.updateLayerConfig({blend:t}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(t){return this.zIndex=t,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(t){this.currentPickId=t}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(t){this.selectedFeatureID=t}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var t=this.mapService.getZoom(),e=this.getLayerConfig(),n=e.visible,r=e.minZoom,i=void 0===r?-1/0:r,o=e.maxZoom,a=void 0===o?1/0:o;return!!n&&t>=i&&t<a}},{key:"setMultiPass",value:function(t,e){if(this.updateLayerConfig({enableMultiPassRenderer:t}),e&&this.updateLayerConfig({passes:e}),t){var n=this.getLayerConfig(),r=n.passes,i=void 0===r?[]:r;this.multiPassRenderer=gx(this,i,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var o=this.rendererService.getViewportSize(),a=o.width,s=o.height;this.multiPassRenderer.resize(a,s)}return this}},{key:"setMinZoom",value:function(t){return this.updateLayerConfig({minZoom:t}),this}},{key:"getMinZoom",value:function(){var t=this.getLayerConfig(),e=t.minZoom;return e}},{key:"getMaxZoom",value:function(){var t=this.getLayerConfig(),e=t.maxZoom;return e}},{key:"get",value:function(t){var e=this.getLayerConfig();return e[t]}},{key:"setMaxZoom",value:function(t){return this.updateLayerConfig({maxZoom:t}),this}},{key:"setAutoFit",value:function(t){return this.updateLayerConfig({autoFit:t}),this}},{key:"fitBounds",value:function(t){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var e=this.getSource(),n=e.extent,r=n.some((function(t){return Math.abs(t)===1/0}));return r||this.mapService.fitBounds([[n[0],n[1]],[n[2],n[3]]],t),this}},{key:"destroy",value:function(){var t,e,n,r,i=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!this.isDestroyed){this.layerChildren.map((function(t){return t.destroy(!1)})),this.layerChildren=[];var o=this.getLayerConfig(),a=o.maskfence;a&&(this.masks.map((function(t){return t.destroy(!1)})),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),null===(t=this.multiPassRenderer)||void 0===t||t.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),null===(e=this.layerModel)||void 0===e||e.clearModels(i),null===(n=this.tileLayer)||void 0===n||n.destroy(),this.models=[],null===(r=this.debugService)||void 0===r||r.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var t;this.models.forEach((function(t){return t.destroy()})),null===(t=this.layerModel)||void 0===t||t.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter((function(t){return t.needRescale||t.needRemapping||t.needRegenerateVertices})).length}},{key:"setSource",value:function(t){var e=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=t,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var n=this.mapService.getZoom();this.layerSource.updateClusterData(n)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",(function(t){var n=t.type;if(void 0===e.coordCenter){var r,i=e.layerSource.center;e.coordCenter=i,null!==(r=e.mapService)&&void 0!==r&&r.setCoordCenter&&e.mapService.setCoordCenter(i)}if("update"===n){if(e.tileLayer)return void e.tileLayer.reload();e.sourceEvent()}}))}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(t){this.encodedData=t,this.encodeDataLength=t.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(t){return this.styleAttributeService.getLayerAttributeScale(t)}},{key:"getLegend",value:function(t){var e,n,r,i=this.styleAttributeService.getLayerStyleAttribute(t),o=(null===i||void 0===i||null===(e=i.scale)||void 0===e?void 0:e.scalers)||[];return{type:null===(n=o[0].option)||void 0===n?void 0:n.type,field:null===i||void 0===i||null===(r=i.scale)||void 0===r?void 0:r.field,items:this.getLegendItems(t)}}},{key:"getLegendItems",value:function(t){var e=this.styleAttributeService.getLayerAttributeScale(t);if(!e)return[];if(e.invertExtent){var n=e.range().map((function(n){return(0,Ft.Z)({value:e.invertExtent(n)},t,n)}));return n}if(e.ticks){var r=e.ticks().map((function(n){return(0,Ft.Z)({value:n},t,e(n))}));return r}if(null!==e&&void 0!==e&&e.domain){var i=e.domain().filter((function(t){return!(0,Oi.isUndefined)(t)})).map((function(n){return(0,Ft.Z)({value:n},t,e(n))}));return i}return[]}},{key:"pick",value:function(t){var e=t.x,n=t.y;this.interactionService.triggerHover({x:e,y:n})}},{key:"boxSelect",value:function(t,e){this.pickingService.boxPickLayer(this,t,e)}},{key:"buildLayerModel",value:function(){var t=(0,J.Z)(tt().mark((function t(e){var n,r,i,o,a,s,u,c,l,h,f,p,d=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=e.moduleName,r=e.vertexShader,i=e.fragmentShader,o=e.inject,a=e.triangulation,s=e.segmentNumber,u=Jf(e,Ax),this.shaderModuleService.registerModule(n,{vs:r,fs:i,inject:o}),c=this.shaderModuleService.getModule(n),l=c.vs,h=c.fs,f=c.uniforms,p=this.rendererService.createModel,t.abrupt("return",new Promise((function(t){var e=d.styleAttributeService.createAttributesAndIndices(d.encodedData,a,s),n=e.attributes,r=e.elements,i=e.count,o=(0,k.Z)({attributes:n,uniforms:f,fs:h,vs:l,elements:r,blend:sx[_h.normal]},u);i&&(o.count=i);var c=p(o);t(c)})));case 5:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"createAttributes",value:function(t){var e=t.triangulation,n=this.styleAttributeService.createAttributes(this.encodedData,e),r=n.attributes;return r}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(t){var e=this.getLayerConfig(),n=e.enableHighlight,r=void 0===n||n,i=e.enableSelect,o=void 0===i||i,a=-1!==this.eventNames().indexOf(t)||-1!==this.eventNames().indexOf("un"+t);return"click"!==t&&"dblclick"!==t||!o||(a=!0),"mousemove"!==t||!r&&-1===this.eventNames().indexOf("mouseenter")&&-1===this.eventNames().indexOf("unmousemove")&&-1===this.eventNames().indexOf("mouseout")||(a=!0),this.isVisible()&&a}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()},{key:"rebuildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.buildModels();case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"renderMulPass",value:function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.render();case 2:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"renderModels",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach((function(n){n.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(e)},(null===e||void 0===e?void 0:e.ispick)||!1)})),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(t,e,n,r){var i=this.configService.getAttributeConfig(this.id)||{};return!(0,Oi.isEqual)(i[t],{field:e,values:n})&&(-1!==["color","size","texture","rotate","filter","label","shape"].indexOf(t)&&this.configService.setAttributeConfig(this.id,(0,Ft.Z)({},t,{field:e,values:n})),this.startInit?this.styleAttributeService.updateStyleAttribute(t,{scale:(0,k.Z)({field:e},this.splitValuesAndCallbackInAttribute(n,this.getLayerConfig()[e]))},r):this.pendingStyleAttributes.push({attributeName:t,attributeField:e,attributeValues:n,updateOptions:r}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(t){}},{key:"processData",value:function(t){return t}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.models.forEach((function(t){return t.destroy()})),this.models=[],t.next=4,this.layerModel.initModels();case 4:this.models=t.sent;case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(t,e){return{values:(0,Oi.isFunction)(t)?void 0:t||e,callback:(0,Oi.isFunction)(t)?t:void 0}}}]),n}(Ma.EventEmitter),xx=Dh(_x.prototype,"configService",[yx],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_x);function Nx(t,e){return{enable:t,mask:255,func:{cmp:vf.EQUAL,ref:e?1:0,mask:1}}}function zx(t){return t.maskOperation===bh.OR?{enable:!0,mask:255,func:{cmp:vf.ALWAYS,ref:1,mask:255},opFront:{fail:vf.KEEP,zfail:vf.REPLACE,zpass:vf.REPLACE}}:{enable:!0,mask:255,func:{cmp:t.stencilType===xh.SINGLE||0===t.stencilIndex?vf.ALWAYS:vf.LESS,ref:t.stencilType===xh.SINGLE?1:0===t.stencilIndex?2:1,mask:255},opFront:{fail:vf.KEEP,zfail:vf.REPLACE,zpass:vf.REPLACE}}}function Fx(t){switch(t){case"stroke":return{name:"stroke",type:Ug.Attribute,descriptor:{name:"a_Stroke",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:4,update:function(t){var e=t.stroke,n=void 0===e?[1,1,1,1]:e;return n}}};case"opacity":return{name:"opacity",type:Ug.Attribute,descriptor:{name:"a_Opacity",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.opacity,n=void 0===e?1:e;return[n]}}};case"offsets":return{name:"offsets",type:Ug.Attribute,descriptor:{name:"a_Offsets",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t){var e=t.offsets;return e}}};default:return}}var Bx=(Ix=Eg(wc.IGlobalConfigService),Rx=function(){function t(e){Ot(this,t),(0,Ft.Z)(this,"preStyleAttribute",{}),(0,Ft.Z)(this,"encodeStyleAttribute",{}),Oh(this,"configService",Lx,this),this.layer=e,this.rendererService=e.getContainer().get(wc.IRendererService),this.pickingService=e.getContainer().get(wc.IPickingService),this.shaderModuleService=e.getContainer().get(wc.IShaderModuleService),this.styleAttributeService=e.getContainer().get(wc.IStyleAttributeService),this.mapService=e.getContainer().get(wc.IMapService),this.iconService=e.getContainer().get(wc.IIconService),this.fontService=e.getContainer().get(wc.IFontService),this.cameraService=e.getContainer().get(wc.ICameraService),this.layerService=e.getContainer().get(wc.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var n=this.rendererService.createTexture2D;this.createTexture2D=n}return zt(t,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),e=t.blend,n=void 0===e?"normal":e;return sx[_h[n]]}},{key:"getStencil",value:function(t){var e=this.layer.getLayerConfig(),n=e.mask,r=void 0!==n&&n,i=e.maskInside,o=void 0===i||i,a=e.enableMask,s=e.maskOperation,u=void 0===s?bh.AND:s;if("MaskLayer"===this.layer.type)return zx({isStencil:!0,stencilType:xh.SINGLE});if(t.isStencil)return zx((0,k.Z)((0,k.Z)({},t),{},{maskOperation:u}));var c=r||a&&0!==this.layer.masks.length||void 0!==this.layer.tileMask;return Nx(c,o)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",!1);case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"render",value:function(t){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption;e.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var t=this.layer.encodeStyleAttribute,e="",n={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2"};this.layer.enableEncodeStyles.forEach((function(r){t[r]&&(e+="#define USE_ATTRIBUTE_".concat(r.toUpperCase()," 0.0; \n\n")),e+="\n      #ifdef USE_ATTRIBUTE_".concat(r.toUpperCase(),"\n  attribute ").concat(n[r]," a_").concat(r.charAt(0).toUpperCase()+r.slice(1),";\n#else\n  uniform ").concat(n[r]," u_").concat(r,";\n#endif\n\n")}));var r="";return this.layer.enableEncodeStyles.forEach((function(t){r+="\n\n#ifdef USE_ATTRIBUTE_".concat(t.toUpperCase(),"\n  ").concat(n[t]," ").concat(t,"  = a_").concat(t.charAt(0).toUpperCase()+t.slice(1),";\n#else\n  ").concat(n[t]," ").concat(t," = u_").concat(t,";\n#endif\n\n")})),{"vs:#decl":e,"vs:#main-start":r}}},{key:"getStyleAttribute",value:function(){var t=this,e={},n={opacity:1,stroke:[1,0,0,1],offsets:[0,0]};return this.layer.enableEncodeStyles.forEach((function(r){if(!t.layer.encodeStyleAttribute[r]){var i=t.layer.getLayerConfig()[r],o="undefined"===typeof i?n[r]:i;"stroke"===r&&(o=bi(o)),e["u_"+r]=o}})),e}},{key:"registerStyleAttribute",value:function(){var t=this;Object.keys(this.layer.encodeStyleAttribute).forEach((function(e){var n=Fx(e);n&&t.styleAttributeService.registerStyleAttribute(n)}))}},{key:"updateEncodeAttribute",value:function(t,e){this.encodeStyleAttribute[t]=e}}]),t}(),Lx=Dh(Rx.prototype,"configService",[Ix],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Rx),Ux=function(t){return t[t["solid"]=0]="solid",t[t["dash"]=1]="dash",t}({}),jx=function(t){return t["VERTICAL"]="vertical",t["HORIZONTAL"]="horizontal",t}({}),Zx=function(t){return t["NORMAL"]="normal",t["REPLACE"]="replace",t}({}),Vx=function(t){return t[t["pixel"]=0]="pixel",t[t["meter"]=1]="meter",t}({}),Gx=function(t){return t["ALWAYS"]="always",t["DRAGEND"]="dragend",t}({});function Hx(t){var e=Wx();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Wx(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var qx=function(t){Yt(n,t);var e=Hx(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"updateMode",Gx.ALWAYS),(0,Ft.Z)(Kt(t),"renderUpdate",(function(){var e=t.layer.getLayerConfig(),n=e.zIndex,r=void 0===n?10:n,i=e.update,o=void 0===i?Gx.ALWAYS:i,a=e.animateOption,s=void 0===a?{enable:!1,duration:20}:a;+t.canvas.style.zIndex===r&&(t.canvas.style.zIndex=r+""),t.updateMode!==o&&(t.updateMode=o,t.unBindListener(),t.bindListener()),t.updateMode===Gx.ALWAYS&&s.enable&&t.renderCanvas()})),(0,Ft.Z)(Kt(t),"unBindListener",(function(){t.mapService.off("mapchange",t.renderCanvas),t.mapService.off("zoomstart",t.clearCanvas),t.mapService.off("zoomend",t.renderCanvas),t.mapService.off("movestart",t.clearCanvas),t.mapService.off("moveend",t.renderCanvas)})),(0,Ft.Z)(Kt(t),"bindListener",(function(){t.updateMode===Gx.ALWAYS?t.mapService.on("mapchange",t.renderCanvas):(t.mapService.on("zoomstart",t.clearCanvas),t.mapService.on("zoomend",t.renderCanvas),t.mapService.on("movestart",t.clearCanvas),t.mapService.on("moveend",t.renderCanvas))})),(0,Ft.Z)(Kt(t),"clearCanvas",(function(){if(t.ctx){var e=t.rendererService.getViewportSize(),n=e.width,r=e.height;t.ctx.clearRect(0,0,n,r)}})),(0,Ft.Z)(Kt(t),"renderCanvas",(function(){var e=t.rendererService.getViewportSize(),n=e.width,r=e.height;if(t.prevSize[0]!==n||t.prevSize[1]!==r){t.prevSize=[n,r];var i=t.mapService.getSize(),o=(0,Li.Z)(i,2),a=o[0],s=o[1];t.canvas.width=n,t.canvas.height=r,t.canvas.style.width=a+"px",t.canvas.style.height=s+"px"}var u=t.layer.getLayerConfig(),c=u.drawingOnCanvas;t.ctx&&c({canvas:t.canvas,ctx:t.ctx,mapService:t.mapService,size:[n,r]})})),t}return zt(n,[{key:"clearModels",value:function(){var t;this.canvas&&(null===(t=this.mapService.getContainer())||void 0===t||t.removeChild(this.canvas),this.canvas=null);this.unBindListener()}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.update,r=void 0===n?Gx.ALWAYS:n,this.updateMode=r,this.initCanvas(),this.renderCanvas(),this.bindListener(),this.mapService.getContainer(),t.abrupt("return",[]);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"initCanvas",value:function(){var t,e=this.layer.getLayerConfig(),n=e.zIndex,r=this.mapService.getSize(),i=(0,Li.Z)(r,2),o=i[0],a=i[1],s=this.rendererService.getViewportSize(),u=s.width,c=s.height;this.prevSize=[u,c];var l=document.createElement("canvas");this.canvas=l,l.width=u,l.height=c,l.style.pointerEvents="none",l.style.width=o+"px",l.style.height=a+"px",l.style.position="absolute",l.style.top="0",l.style.left="0",l.style.zIndex=n+"",null===(t=this.mapService.getContainer())||void 0===t||t.appendChild(l);var h=l.getContext("2d");this.ctx=h}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){}}]),n}(Bx),Xx={canvas:qx},Yx=Xx;function Kx(t){var e=Qx();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Qx(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Jx=function(t){Yt(n,t);var e=Kx(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","CanvasLayer"),(0,Ft.Z)(Kt(t),"forceRender",!0),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new Yx[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"hide",value:function(){return this.layerModel.clearCanvas&&this.layerModel.clearCanvas(),this.updateLayerConfig({visible:!1}),this.reRender(),this}},{key:"renderModels",value:function(){var t,e=this;return null!==this&&void 0!==this&&null!==(t=this.layerModel)&&void 0!==t&&t.renderUpdate&&this.layerModel.renderUpdate(),this.models.forEach((function(t){t.draw({uniforms:e.layerModel.getUninforms()},!1)})),this}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),e={canvas:{}};return e[t]}},{key:"getModelType",value:function(){return"canvas"}}]),n}(Dx);n(84944),n(33792);function $x(){var t=new ou(3);return ou!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function tb(t){var e=new ou(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function eb(t){var e=t[0],n=t[1],r=t[2];return Math.hypot(e,n,r)}function nb(t,e,n){var r=new ou(3);return r[0]=t,r[1]=e,r[2]=n,r}function rb(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function ib(t,e,n,r){return t[0]=e,t[1]=n,t[2]=r,t}function ob(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function ab(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function sb(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ub(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t}function cb(t,e){return t[0]=Math.ceil(e[0]),t[1]=Math.ceil(e[1]),t[2]=Math.ceil(e[2]),t}function lb(t,e){return t[0]=Math.floor(e[0]),t[1]=Math.floor(e[1]),t[2]=Math.floor(e[2]),t}function hb(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function fb(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function pb(t,e){return t[0]=Math.round(e[0]),t[1]=Math.round(e[1]),t[2]=Math.round(e[2]),t}function db(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function vb(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function mb(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return Math.hypot(n,r,i)}function gb(t,e){var n=e[0]-t[0],r=e[1]-t[1],i=e[2]-t[2];return n*n+r*r+i*i}function yb(t){var e=t[0],n=t[1],r=t[2];return e*e+n*n+r*r}function _b(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t}function xb(t,e){return t[0]=1/e[0],t[1]=1/e[1],t[2]=1/e[2],t}function bb(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function wb(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function Eb(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t}function Sb(t,e,n,r){var i=e[0],o=e[1],a=e[2];return t[0]=i+r*(n[0]-i),t[1]=o+r*(n[1]-o),t[2]=a+r*(n[2]-a),t}function Ab(t,e,n,r,i,o){var a=o*o,s=a*(2*o-3)+1,u=a*(o-2)+o,c=a*(o-1),l=a*(3-2*o);return t[0]=e[0]*s+n[0]*u+r[0]*c+i[0]*l,t[1]=e[1]*s+n[1]*u+r[1]*c+i[1]*l,t[2]=e[2]*s+n[2]*u+r[2]*c+i[2]*l,t}function Tb(t,e,n,r,i,o){var a=1-o,s=a*a,u=o*o,c=s*a,l=3*o*s,h=3*u*a,f=u*o;return t[0]=e[0]*c+n[0]*l+r[0]*h+i[0]*f,t[1]=e[1]*c+n[1]*l+r[1]*h+i[1]*f,t[2]=e[2]*c+n[2]*l+r[2]*h+i[2]*f,t}function Cb(t,e){e=e||1;var n=2*au()*Math.PI,r=2*au()-1,i=Math.sqrt(1-r*r)*e;return t[0]=Math.cos(n)*i,t[1]=Math.sin(n)*i,t[2]=r*e,t}function kb(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[3]*r+n[7]*i+n[11]*o+n[15];return a=a||1,t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/a,t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/a,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/a,t}function Mb(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t}function Pb(t,e,n){var r=n[0],i=n[1],o=n[2],a=n[3],s=e[0],u=e[1],c=e[2],l=i*c-o*u,h=o*s-r*c,f=r*u-i*s,p=i*f-o*h,d=o*l-r*f,v=r*h-i*l,m=2*a;return l*=m,h*=m,f*=m,p*=2,d*=2,v*=2,t[0]=s+l+p,t[1]=u+h+d,t[2]=c+f+v,t}function Ib(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0],o[1]=i[1]*Math.cos(r)-i[2]*Math.sin(r),o[2]=i[1]*Math.sin(r)+i[2]*Math.cos(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Rb(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[2]*Math.sin(r)+i[0]*Math.cos(r),o[1]=i[1],o[2]=i[2]*Math.cos(r)-i[0]*Math.sin(r),t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Lb(t,e,n,r){var i=[],o=[];return i[0]=e[0]-n[0],i[1]=e[1]-n[1],i[2]=e[2]-n[2],o[0]=i[0]*Math.cos(r)-i[1]*Math.sin(r),o[1]=i[0]*Math.sin(r)+i[1]*Math.cos(r),o[2]=i[2],t[0]=o[0]+n[0],t[1]=o[1]+n[1],t[2]=o[2]+n[2],t}function Ob(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2],u=Math.sqrt(n*n+r*r+i*i),c=Math.sqrt(o*o+a*a+s*s),l=u*c,h=l&&wb(t,e)/l;return Math.acos(Math.min(Math.max(h,-1),1))}function Db(t){return t[0]=0,t[1]=0,t[2]=0,t}function Nb(t){return"vec3("+t[0]+", "+t[1]+", "+t[2]+")"}function zb(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]}function Fb(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],a=e[1],s=e[2];return Math.abs(n-o)<=iu*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-a)<=iu*Math.max(1,Math.abs(r),Math.abs(a))&&Math.abs(i-s)<=iu*Math.max(1,Math.abs(i),Math.abs(s))}var Bb=ab,Ub=sb,jb=ub,Zb=mb,Vb=gb,Gb=eb,Hb=yb,Wb=function(){var t=$x();return function(e,n,r,i,o,a){var s,u;for(n||(n=3),r||(r=0),u=i?Math.min(i*n+r,e.length):e.length,s=r;s<u;s+=n)t[0]=e[s],t[1]=e[s+1],t[2]=e[s+2],o(t,t,a),e[s]=t[0],e[s+1]=t[1],e[s+2]=t[2];return e}}(),qb=100,Xb=36,Yb=40;function Kb(t){return t/180*Math.acos(-1)}function Qb(t){var e=Kb(t[0])+Math.PI/2,n=Kb(t[1]),r=qb+.4*Math.random(),i=r*Math.cos(n)*Math.cos(e),o=r*Math.cos(n)*Math.sin(e),a=r*Math.sin(n);return[o,a,i]}function Jb(t,e){var n=cl(),r=cl(),i=nb(0,1,0),o=nb(0,0,0);e=e||{},t="undefined"!==typeof t?t:1;for(var a="undefined"!==typeof e.segments?e.segments:32,s=2+a,u=2*s,c=[],l=[],h=[],f=[],p=[],d=[],v=0;v<=s;v++){for(var m=v/s,g=m*Math.PI,y=0;y<=u;y++){var _=y/u,x=_*Math.PI*2;dl(r),Al(r,r,-g),dl(n),Sl(n,n,x),kb(o,i,r),kb(o,o,n),db(o,o,-t),h.push(o.slice()),f.push.apply(f,(0,C.Z)(o.slice())),bb(o,o),p.push.apply(p,(0,C.Z)(o.slice())),d.push([_,1-m]),f.push(_,1-m)}if(v>0)for(var b=h.length,w=b-2*(u+1);w+u+2<b;w++)c.push([w,w+1,w+u+1]),l.push(w,w+1,w+u+1),c.push([w+u+1,w+1,w+u+2]),l.push(w+u+1,w+1,w+u+2)}return{cells:c,positions:h,uvs:d,positionsArr:f,indicesArr:l,normalArr:p}}var $b=su(),tw=(su(),su()),ew=su(),nw=su();function rw(t,e,n,r,i){hu(t,n,r),du(t,t),e=uu(-t[1],t[0]);var o=uu(-n[1],n[0]);return[i/vu(e,o),e]}function iw(t,e){return lu(t,-e[1],e[0])}function ow(t,e,n){return gu(t,e,n),du(t,t),t}function aw(t,e){return t[0]===e[0]&&t[1]===e[1]}var sw,uw=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Ot(this,t),(0,Ft.Z)(this,"lastFlip",-1),(0,Ft.Z)(this,"miter",uu(0,0)),(0,Ft.Z)(this,"started",!1),(0,Ft.Z)(this,"dash",!1),(0,Ft.Z)(this,"totalDistance",0),(0,Ft.Z)(this,"currentIndex",0),this.join=e.join||"miter",this.cap=e.cap||"butt",this.miterLimit=e.miterLimit||10,this.thickness=e.thickness||1,this.dash=e.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return zt(t,[{key:"simpleExtrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null,u=this.simpleSegment(e,r,o,a,s);r+=u}if(this.dash)for(var c=0;c<e.positions.length/6;c++)e.positions[6*c+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleExtrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=t[o-1];c.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var l=e[o-1],h=t[o];h.push(null!==(s=e[o][2])&&void 0!==s?s:0);var f=e[o],p=o<t.length-1?[].concat((0,C.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null,v=this.simpleSegment(n,i,c,h,p,l,f,d);i+=v}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude_gaode2",value:function(t,e){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var r=t.length,i=n.startIndex,o=1;o<r;o++){var a,s,u,c=t[o-1];c.push(null!==(a=e[o-1][2])&&void 0!==a?a:0);var l=e[o-1],h=t[o];h.push(null!==(s=e[o][2])&&void 0!==s?s:0);var f=e[o],p=o<t.length-1?[].concat((0,C.Z)(t[o+1]),[null!==(u=e[o+1][2])&&void 0!==u?u:0]):null,d=o<e.length-1?e[o+1]:null,v=this.segment_gaode2(n,i,c,h,p,l,f,d);i+=v}if(this.dash)for(var m=0;m<n.positions.length/6;m++)n.positions[6*m+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"extrude",value:function(t){var e=this.complex;if(t.length<=1)return e;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var n=t.length,r=e.startIndex,i=1;i<n;i++){var o=t[i-1],a=t[i],s=i<t.length-1?t[i+1]:null,u=this.segment(e,r,o,a,s);r+=u}if(this.dash)for(var c=0;c<e.positions.length/6;c++)e.positions[6*c+5]=this.totalDistance;return e.startIndex=e.positions.length/6,e}},{key:"simpleSegment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,c=Lo([r[0],r[1]]),l=Lo([n[0],n[1]]);ow(tw,c,l);var h=0;if(this.dash&&(h=this.lineSegmentDistance(c,l),this.totalDistance+=h),this.normal||(this.normal=su(),iw(this.normal,tw)),this.started||(this.started=!0,this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-h)),a.push(e+0,e+1,e+2),i){var f=Lo([i[0],i[1]]);aw(c,f)&&hu(f,c,du(f,fu(f,c,l))),ow(ew,f,c);var p=rw(nw,su(),tw,ew,this.thickness),d=(0,Li.Z)(p,2),v=d[0],m=d[1],g=vu(nw,this.normal)<0?-1:1;this.extrusions(s,u,r,m,v,this.totalDistance),a.push.apply(a,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),g=-1,cu(this.normal,m),o+=2,this.lastFlip=g}else iw(this.normal,tw),this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance),a.push.apply(a,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2;return o}},{key:"segment_gaode2",value:function(t,e,n,r,i,o,a,s){var u=0,c=t.indices,l=t.positions,h=t.normals,f="square"===this.cap,p="bevel"===this.join,d=Lo([a[0],a[1]]),v=Lo([o[0],o[1]]);ow(tw,r,n);var m=0;if(this.dash&&(m=this.lineSegmentDistance(d,v),this.totalDistance+=m),this.normal||(this.normal=su(),iw(this.normal,tw)),!this.started)if(this.started=!0,f){var g=su(),y=su();hu(g,this.normal,tw),hu(y,this.normal,tw),h.push(y[0],y[1],0),h.push(g[0],g[1],0),l.push(n[0],n[1],0|n[2],this.totalDistance-m,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),l.push(n[0],n[1],0|n[2],this.totalDistance-m,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,n,this.normal,this.thickness,this.totalDistance-m);if(c.push(e+0,e+1,e+2),i){aw(r,i)&&hu(i,r,du(i,fu(i,r,n))),ow(ew,i,r);var _=rw(nw,su(),tw,ew,this.thickness),x=(0,Li.Z)(_,2),b=x[0],w=x[1],E=vu(nw,this.normal)<0?-1:1,S=p;if(!S&&"miter"===this.join){var A=b;A>this.miterLimit&&(S=!0)}S?(h.push(this.normal[0],this.normal[1],0),h.push(w[0],w[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,c.push.apply(c,(0,C.Z)(this.lastFlip!==-E?[e,e+2,e+3]:[e+2,e+1,e+3])),c.push(e+2,e+3,e+4),iw($b,ew),cu(this.normal,$b),h.push(this.normal[0],this.normal[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*E,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,u+=3):(this.extrusions(l,h,r,w,b,this.totalDistance),c.push.apply(c,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),E=-1,cu(this.normal,w),u+=2),this.lastFlip=E}else{if(iw(this.normal,tw),f){var T=su(),k=su();gu(k,tw,this.normal),hu(T,tw,this.normal),h.push(k[0],k[1],0),h.push(T[0],T[1],0),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),l.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(l,h,r,this.normal,this.thickness,this.totalDistance);c.push.apply(c,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),u+=2}return u}},{key:"segment",value:function(t,e,n,r,i){var o=0,a=t.indices,s=t.positions,u=t.normals,c="square"===this.cap,l="bevel"===this.join,h=Lo([r[0],r[1]]),f=Lo([n[0],n[1]]);ow(tw,h,f);var p=0;if(this.dash&&(p=this.lineSegmentDistance(h,f),this.totalDistance+=p),this.normal||(this.normal=su(),iw(this.normal,tw)),!this.started)if(this.started=!0,c){var d=su(),v=su();hu(d,this.normal,tw),hu(v,this.normal,tw),u.push(v[0],v[1],0),u.push(d[0],d[1],0),s.push(n[0],n[1],0|n[2],this.totalDistance-p,-this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),s.push(n[0],n[1],0|n[2],this.totalDistance-p,this.thickness,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,n,this.normal,this.thickness,this.totalDistance-p);if(a.push(e+0,e+1,e+2),i){var m=Lo([i[0],i[1]]);aw(h,m)&&hu(m,h,du(m,fu(m,h,f))),ow(ew,m,h);var g=rw(nw,su(),tw,ew,this.thickness),y=(0,Li.Z)(g,2),_=y[0],x=y[1],b=vu(nw,this.normal)<0?-1:1,w=l;if(!w&&"miter"===this.join){var E=_;E>this.miterLimit&&(w=!0)}w?(u.push(this.normal[0],this.normal[1],0),u.push(x[0],x[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,a.push.apply(a,(0,C.Z)(this.lastFlip!==-b?[e,e+2,e+3]:[e+2,e+1,e+3])),a.push(e+2,e+3,e+4),iw($b,ew),cu(this.normal,$b),u.push(this.normal[0],this.normal[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,-this.thickness*b,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++,o+=3):(this.extrusions(s,u,r,x,_,this.totalDistance),a.push.apply(a,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),b=-1,cu(this.normal,x),o+=2),this.lastFlip=b}else{if(iw(this.normal,tw),c){var S=su(),A=su();gu(A,tw,this.normal),hu(S,tw,this.normal),u.push(A[0],A[1],0),u.push(S[0],S[1],0),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),s.push(r[0],r[1],0|r[2],this.totalDistance,this.thickness,0|r[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(s,u,r,this.normal,this.thickness,this.totalDistance);a.push.apply(a,(0,C.Z)(1===this.lastFlip?[e,e+2,e+3]:[e+2,e+1,e+3])),o+=2}return o}},{key:"extrusions",value:function(t,e,n,r,i,o){e.push(r[0],r[1],0),e.push(r[0],r[1],0),t.push(n[0],n[1],0|n[2],o,-i,0|n[2]),this.complex.indexes.push(this.currentIndex),t.push(n[0],n[1],0|n[2],o,i,0|n[2]),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}}]),t}();function cw(t){var e=t[0][0],n=t[0][t[0].length-1];e[0]===n[0]&&e[1]===n[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var r=t[0].length,i=ru().flatten(t),o=i.vertices,a=i.dimensions,s=[],u=[],c=0;c<o.length/a;c++)2===a?s.push(o[2*c],o[2*c+1],1):s.push(o[3*c],o[3*c+1],1);var l=ru()(i.vertices,i.holes,i.dimensions);u.push.apply(u,(0,C.Z)(l));for(var h=function(){var t=i.vertices.slice(f*a,(f+1)*a),e=i.vertices.slice((f+1)*a,(f+2)*a);0===e.length&&(e=i.vertices.slice(0,a));var n=s.length/3;s.push(t[0],t[1],1,e[0],e[1],1,t[0],t[1],0,e[0],e[1],0),u.push.apply(u,(0,C.Z)([0,2,1,2,3,1].map((function(t){return t+n}))))},f=0;f<r;f++)h();return{positions:s,index:u}}function lw(t){var e=ru().flatten(t),n=ru()(e.vertices,e.holes,e.dimensions);return{positions:e.vertices,index:n}}function hw(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t[0][0],r=t[0][t[0].length-1];n[0]===r[0]&&n[1]===r[1]&&(t[0]=t[0].slice(0,t[0].length-1));for(var i=t[0].length,o=ru().flatten(t),a=o.vertices,s=o.dimensions,u=[],c=[],l=[],h=0;h<a.length/s;h++)u.push(a[h*s],a[h*s+1],1,-1,-1),l.push(0,0,1);var f=ru()(o.vertices,o.holes,o.dimensions);c.push.apply(c,(0,C.Z)(f));for(var p=function(){var t=o.vertices.slice(d*s,(d+1)*s),n=o.vertices.slice((d+1)*s,(d+2)*s);0===n.length&&(n=o.vertices.slice(0,s));var r=u.length/5;u.push(t[0],t[1],1,0,0,n[0],n[1],1,.1,0,t[0],t[1],0,0,.8,n[0],n[1],0,.1,.8);var i=fw([n[0],n[1],1],[t[0],t[1],0],[t[0],t[1],1],e);l.push.apply(l,(0,C.Z)(i).concat((0,C.Z)(i),(0,C.Z)(i),(0,C.Z)(i))),c.push.apply(c,(0,C.Z)([1,2,0,3,2,1].map((function(t){return t+r}))))},d=0;d<i;d++)p();return{positions:u,index:c,normals:l}}function fw(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=$x(),o=$x(),s=$x();r&&(t=ko(t),e=ko(e),n=ko(n));var u=nb.apply(a,(0,C.Z)(t)),c=nb.apply(a,(0,C.Z)(e)),l=nb.apply(a,(0,C.Z)(n));Bb(i,l,c),Bb(o,u,c),Eb(s,i,o);var h=$x();return bb(h,s),h}var pw=function(t){return t["CYLINDER"]="cylinder",t["SQUARECOLUMN"]="squareColumn",t["TRIANGLECOLUMN"]="triangleColumn",t["HEXAGONCOLUMN"]="hexagonColumn",t["PENTAGONCOLUMN"]="pentagonColumn",t}({}),dw=function(t){return t["CIRCLE"]="circle",t["SQUARE"]="square",t["TRIANGLE"]="triangle",t["HEXAGON"]="hexagon",t["PENTAGON"]="pentagon",t}({});function vw(t){for(var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=2*Math.PI/t,r=[],i=0;i<t;i++)r.push(n*i+e*Math.PI/12);var o=r.map((function(t){var e=Math.sin(t+Math.PI/4),n=Math.cos(t+Math.PI/4);return[e,n,0]}));return o}function mw(){return vw(30)}function gw(){return vw(4)}function yw(){return vw(3)}function _w(){return vw(6,1)}function xw(){return vw(5)}var bw=(sw={},(0,Ft.Z)(sw,dw.CIRCLE,mw),(0,Ft.Z)(sw,dw.HEXAGON,_w),(0,Ft.Z)(sw,dw.TRIANGLE,yw),(0,Ft.Z)(sw,dw.SQUARE,gw),(0,Ft.Z)(sw,dw.PENTAGON,xw),(0,Ft.Z)(sw,pw.CYLINDER,mw),(0,Ft.Z)(sw,pw.HEXAGONCOLUMN,_w),(0,Ft.Z)(sw,pw.TRIANGLECOLUMN,yw),(0,Ft.Z)(sw,pw.SQUARECOLUMN,gw),(0,Ft.Z)(sw,pw.PENTAGONCOLUMN,xw),sw),ww={};function Ew(t){var e=Yo(t.coordinates);return{vertices:[].concat((0,C.Z)(e),(0,C.Z)(e),(0,C.Z)(e),(0,C.Z)(e)),indices:[0,1,2,2,3,0],size:e.length}}function Sw(t){var e=Yo(t.coordinates),n=Qb(e);return{vertices:[].concat((0,C.Z)(n),(0,C.Z)(n),(0,C.Z)(n),(0,C.Z)(n)),indices:[0,1,2,2,3,0],size:n.length}}function Aw(t){var e=t.shape,n=jw(e,!1),r=n.positions,i=n.index,o=n.normals;return{vertices:r,indices:i,normals:o,size:5}}function Tw(t){var e=Yo(t.coordinates);return{vertices:(0,C.Z)(e),indices:[0],size:e.length}}function Cw(t){var e=t.coordinates,n=t.originCoordinates,r=t.version,i=new uw({dash:!0,join:"bevel"});if("GAODE2.x"===r){var o=e;Array.isArray(o[0][0])||(o=[e]);var a=n;Array.isArray(a[0][0])||(a=[n]);for(var s=0;s<o.length;s++){var u=o[s],c=a[s];i.extrude_gaode2(u,c)}}else{var l=e;l[0]&&!Array.isArray(l[0][0])&&(l=[e]),l.forEach((function(t){i.extrude(t)}))}var h=i.complex;return{vertices:h.positions,indices:h.indices,normals:h.normals,indexes:h.indexes,size:6}}function kw(t){var e=t.coordinates.flat(),n=1,r=1;return{vertices:[1,0,0].concat((0,C.Z)(e),[1,2,-3],(0,C.Z)(e),[1,1,-3],(0,C.Z)(e),[0,1,0],(0,C.Z)(e),[0,0,0],(0,C.Z)(e),[1,0,0],(0,C.Z)(e),[1,2,-3],(0,C.Z)(e),[1,1,-3],(0,C.Z)(e),[0,1,0],(0,C.Z)(e),[0,0,0],(0,C.Z)(e)),normals:[-n,2*r,1,2*r,-r,1,r,-r,1,r,-r,1,-n,-r,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function Mw(t){var e=t.coordinates,n=[];if(!Array.isArray(e[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var r=Rw(e),i=r.results,o=r.totalDistance;return i.map((function(t){n.push(t[0],t[1],t[2],t[3],0,o)})),{vertices:n,indices:[],normals:[],size:6,count:i.length}}function Pw(t,e){var n=e[0]-t[0],r=e[1]-t[1];return Math.sqrt(n*n+r*r)}function Iw(t,e){return t.length<3&&t.push(0),void 0!==e&&t.push(e),t}function Rw(t){var e=t;Array.isArray(e)&&Array.isArray(e[0])&&Array.isArray(e[0][0])&&(e=t.flat());var n=0;if(e.length<2)return{results:e,totalDistance:0};var r=[],i=Iw(e[0],n);r.push(i);for(var o=1;o<e.length-1;o++){var a=Pw(e[o-1],e[o]);n+=a;var s=Iw(e[o],n);r.push(s),r.push(s)}var u=Pw(e[e.length-2],e[e.length-1]);return n+=u,r.push(Iw(e[e.length-1],n)),{results:r,totalDistance:n}}function Lw(t){var e=t.coordinates,n=ru().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:ru()(r,o,i),vertices:r,size:i}}function Ow(t){var e=t.coordinates,n=ru().flatten(e),r=n.vertices,i=n.dimensions,o=n.holes;return{indices:ru()(r,o,i),vertices:Dw(r),size:i+4}}function Dw(t){for(var e=[],n=Ko(t),r=n.center,i=n.radius,o=0;o<t.length;o+=2){var a=t[o],s=t[o+1];e.push.apply(e,[a,s,0].concat((0,C.Z)(r),[i]))}return e}function Nw(t){var e=t.coordinates,n=hw(e,!0),r=n.positions,i=n.index,o=n.normals;return{vertices:r,indices:i,normals:o,size:5}}function zw(t){var e=t.shape,n=Zw(e),r=n.positions,i=n.index;return{vertices:r,indices:i,size:3}}function Fw(t){var e=t.coordinates,n=[].concat((0,C.Z)(e[0]),[0,0,1,e[1][0],e[0][1],0,1,1],(0,C.Z)(e[1]),[0,1,0],(0,C.Z)(e[0]),[0,0,1],(0,C.Z)(e[1]),[0,1,0,e[0][0],e[1][1],0,0,0]),r=[0,1,2,3,4,5];return{vertices:n,indices:r,size:5}}function Bw(t,e){for(var n=e||30,r=t.coordinates,i=[],o=[],a=function(t){i.push(t,1,t,r[0][0],r[0][1],r[1][0],r[1][1],t,-1,t,r[0][0],r[0][1],r[1][0],r[1][1]),t!==n-1&&o.push.apply(o,(0,C.Z)([0,1,2,1,3,2].map((function(e){return 2*t+e}))))},s=0;s<n;s++)a(s);return{vertices:i,indices:o,size:7}}function Uw(t){var e=t.coordinates;2===e.length&&e.push(0);var n=Vw(-1,1),r=Vw(1,1),i=Vw(-1,-1),o=Vw(1,-1),a=[].concat((0,C.Z)(e),(0,C.Z)(n),(0,C.Z)(e),(0,C.Z)(i),(0,C.Z)(e),(0,C.Z)(o),(0,C.Z)(e),(0,C.Z)(r)),s=[0,1,2,3,0,2];return{vertices:a,indices:s,size:5}}function jw(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(ww&&ww[t])return ww[t];var n=bw[t]?bw[t]():bw.cylinder(),r=hw([n],e);return ww[t]=r,r}function Zw(t){var e=["cylinder","triangleColumn","hexagonColumn","squareColumn"],n=bw[t]?bw[t]():bw.circle(),r=-1===e.indexOf(t)?lw([n]):cw([n]);return r}function Vw(t,e){var n=(t+1)/2,r=(e+1)/2;return[n,r]}function Gw(){var t=Jb(qb,{segments:Xb}),e=t.positionsArr,n=t.indicesArr,r=t.normalArr;return{vertices:e,indices:n,size:5,normals:r}}function Hw(){var t=Jb(qb+Yb,{segments:Xb}),e=t.positionsArr,n=t.indicesArr,r=t.normalArr;return{vertices:e,indices:n,size:5,normals:r}}function Ww(t){var e=qw();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function qw(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Xw='uniform float u_opacity: 1.0;\nuniform vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];\nuniform vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];\nuniform float u_near : 0;\nuniform float u_far : 1;\nvarying vec4 v_Color;\nvarying vec2 v_texCoord;\nuniform float u_Zoom : 1;\nuniform float u_time;\n\nuniform float u_circleSweep;\nuniform float u_cityMinSize;\nuniform vec3 u_circleSweepColor;\nuniform float u_circleSweepSpeed;\n\nvarying float v_worldDis;\n\n#pragma include "picking"\n\nvec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {\n    float s = step(hot, n);\n    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);\n\n    return mix(darkColor, color, s);\n}\nfloat random (vec2 st) {\n    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);\n}\n\nfloat LinearizeDepth()\n{\n    float z = gl_FragCoord.z * 2.0 - 1.0;\n    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));\n}\n\nvec3 fog(vec3 color, vec3 fogColor, float depth){\n    float fogFactor=clamp(depth,0.0,1.0);\n    vec3 output_color=mix(fogColor,color,fogFactor);\n    return output_color;\n}\n\nfloat sdRect(vec2 p, vec2 sz) {\n  vec2 d = abs(p) - sz;\n  float outside = length(max(d, 0.));\n  float inside = min(max(d.x, d.y), 0.);\n  return outside + inside;\n}\n\nvoid main() {\n  gl_FragColor = v_Color;\n  vec3 baseColor = u_baseColor.xyz;\n  vec3 brightColor = u_brightColor.xyz;\n  vec3 windowColor = u_windowColor.xyz;\n  float targetColId = 5.;\n  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;\n  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);\n  if(v_texCoord.x < 0.) { //顶部颜色\n       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);\n       gl_FragColor = vec4( foggedColor, v_Color.w);\n  }else { // 侧面颜色\n        vec2 st = v_texCoord;\n        vec2  UvScale = v_texCoord;\n        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));\n        float tStart = 0.25 * tStep;\n        float tEnd = 0.75 * tStep;\n        float u = mod(UvScale.x, tStep);\n        float v = mod(UvScale.y, tStep);\n        float ux = floor(UvScale.x/tStep);\n        float uy = floor(UvScale.y/tStep);\n        float n = random(vec2(ux,uy));\n        float lightP = u_time;\n        float head = 1.0- step(0.005,st.y);\n        /*step3*/\n        // 将窗户颜色和墙面颜色区别开来\n        float sU = step(tStart, u) - step(tEnd, u);\n        float sV = step(tStart, v) - step(tEnd, v);\n        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));\n        float dist = sdRect(vec2(u,v), windowSize);\n        float s = sU * sV;\n\n        float curColId = floor(UvScale.x / tStep);\n        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);\n\n        float mLightP = mod(lightP, 2.);\n        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);\n        if(ux == targetColId){\n            n =0.;\n        }\n        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );\n        float hot = smoothstep(1.0,0.0,timeP);\n        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);\n        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);\n        float sFinal = s * sCol * sRow;\n        color += mix(baseColor, brightColor, sFinal*n);\n        if (st.y<0.01){\n        color = baseColor;\n         }\n        if(head ==1.0) { // 顶部亮线\n            color = brightColor;\n        }\n        color = color * v_Color.rgb;\n\n        vec3 foggedColor = fog(color,fogColor,depth);\n\n        gl_FragColor = vec4(foggedColor,1.0);\n  }\n\n\n  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {\n    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);\n    gl_FragColor.rgb += r * r * u_circleSweepColor;\n  }\n   \n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',Yw='precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\n\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvarying vec4 v_Color;\nuniform mat4 u_Mvp;\n\nuniform float u_circleSweep;\nuniform vec2 u_cityCenter;\n\nvarying float v_worldDis;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n   v_texCoord = a_Uv;\n\n  if(u_circleSweep > 0.0) {\n     vec2 lnglatscale = vec2(0.0);\n    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {\n      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);\n    }\n    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);\n  }\n \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  // v_Color = a_Color;\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',Kw=function(t){Yt(n,t);var e=Ww(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.baseColor,i=void 0===r?"rgb(16,16,16)":r,o=t.brightColor,a=void 0===o?"rgb(255,176,38)":o,s=t.windowColor,u=void 0===s?"rgb(30,60,89)":s,c=t.time,l=void 0===c?0:c,h=t.sweep,f=void 0===h?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:h;return{u_cityCenter:f.sweepCenter||this.cityCenter,u_cityMinSize:this.cityMinSize*f.sweepRadius,u_circleSweep:f.enable?1:0,u_circleSweepColor:bi(f.sweepColor).slice(0,3),u_circleSweepSpeed:f.sweepSpeed,u_opacity:n,u_baseColor:bi(i),u_brightColor:bi(a),u_windowColor:bi(u),u_time:this.layer.getLayerAnimateTime()||l}}},{key:"calCityGeo",value:function(){var t=(0,Li.Z)(this.layer.getSource().extent,4),e=t[0],n=t[1],r=t[2],i=t[3];if("GAODE2.x"===this.mapService.version){this.cityCenter=this.mapService.lngLatToCoord([(r+e)/2,(i+n)/2]);var o=this.mapService.lngLatToCoord([r,i]),a=this.mapService.lngLatToCoord([e,n]);this.cityMinSize=Math.sqrt(Math.pow(o[0]-a[0],2)+Math.pow(o[1]-a[1],2))/4}else{var s=r-e,u=i-n;this.cityCenter=[(r+e)/2,(i+n)/2],this.cityMinSize=Math.sqrt(Math.pow(s,2)+Math.pow(u,2))/4}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.calCityGeo(),this.startModelAnimate(),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Yw,fragmentShader:Xw,triangulation:Nw,depth:{enable:!0},cull:{enable:!0,face:vf.BACK}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?10:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),n}(Bx);function Qw(t){var e=Jw();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Jw(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var $w=function(t){Yt(n,t);var e=Qw(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","CityBuildingLayer"),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.layerModel=new Kw(this),t.next=3,this.initLayerModels();case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"setLight",value:function(t){this.updateLayerConfig({time:t})}},{key:"getModelType",value:function(){return"citybuilding"}}]),n}(Dx);function tE(t){var e=eE();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function eE(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var nE='\nuniform sampler2D u_texture;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "picking"\nvoid main() {\n  gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n  gl_FragColor.a *= u_opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',rE='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform float u_raisingHeight: 0.0;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform vec2 u_size: [1.0, 1.0];\nuniform mat2 u_RotateMatrix;\n\nattribute vec3 a_Extrude;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   vec3 extrude = a_Extrude;\n   v_Color = a_Color;\n   v_uv = a_Uv;\n\n   float raiseHeight = u_raisingHeight;\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raiseHeight = u_raisingHeight * mapboxZoomScale;\n   }\n\n   // 计算经纬度点位坐标\n   vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n   // 计算绕 z 轴旋转后的偏移\n   vec2 offsetXY = project_pixel(u_RotateMatrix * vec2(extrude.x * u_size.x, 0.0));\n   // 绕 z 轴旋转\n   float x = project_pos.x + offsetXY.x;\n   float y = project_pos.y + offsetXY.y;\n   // z 轴不参与旋转\n   float z = project_pixel(extrude.y * u_size.y + raiseHeight);\n\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      // gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n      gl_Position = u_Mvp * (vec4(x, y, z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(x , y, z , 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',iE=function(t){Yt(n,t);var e=tE(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"radian",0),(0,Ft.Z)(Kt(t),"planeGeometryTriangulation",(function(){var e=t.layer.getLayerConfig(),n=e.center,r=void 0===n?[120,30]:n;return{size:4,indices:[0,1,2,2,3,0],vertices:[].concat((0,C.Z)(r),[1,1],(0,C.Z)(r),[0,1],(0,C.Z)(r),[0,0],(0,C.Z)(r),[1,0])}})),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.width,r=void 0===n?1:n,i=t.height,o=void 0===i?1:i,a=t.raisingHeight,s=void 0===a?0:a,u=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(u=-1),this.radian=u*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_opacity:e||1,u_texture:this.texture,u_size:[r,o]}}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.drawCanvas,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),n&&this.updateTexture(n),t.next=6,this.layer.buildLayerModel({moduleName:"geometryBillboard",vertexShader:rE,fragmentShader:nE,triangulation:this.planeGeometryTriangulation,primitive:vf.TRIANGLES,depth:{enable:!0}});case 6:return i=t.sent,t.abrupt("return",[i]);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"updateTexture",value:function(t){var e=this.rendererService.createTexture2D,n=this.layer.getLayerConfig(),r=n.canvasWidth,i=void 0===r?1:r,o=n.canvasHeight,a=void 0===o?1:o,s=document.createElement("canvas");s.width=i,s.height=a;var u=s.getContext("2d");u&&(t(s),this.texture=e({data:s,width:s.width,height:s.height,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE}),this.layerService.reRender())}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ug.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[2],n[3]]}}})}}]),n}(Bx);function oE(t){var e=aE();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function aE(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var sE='\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "picking"\nvoid main() {\n  // gl_FragColor = vec4(v_Color, u_opacity);\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, vec2(v_uv.x, 1.0 - v_uv.y));\n    gl_FragColor.a *= u_opacity;\n  } else {\n    // gl_FragColor = vec4(v_uv, 0.0, u_opacity);\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n  gl_FragColor.a *= v_clip;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',uE='precision highp float;\nuniform mat4 u_ModelMatrix;\n\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_terrainClipHeight;\n\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nattribute vec3 a_Color;\n\nvarying vec3 v_Color;\nvarying vec2 v_uv;\nvarying float v_clip;\n\n#pragma include "projection"\n#pragma include "picking"\nvoid main() {\n   v_Color = a_Color;\n   v_uv = a_Uv;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_clip = 1.0;\n   if(a_Position.z < u_terrainClipHeight) {\n      v_clip = 0.0;\n   }\n  \n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n\n   // float x = 1.0;\n   // float y = 0.0;\n   // float z = 0.0;\n   // mat3 translateMatrix = mat3(\n   //    1.0, 0.0, 0.0 \n   //    0.0, 1.0, 0.0\n   //    -project_pos.x,    -project_pos.y,  1.0\n   // );\n   //  mat4 translateMatrix = mat4(\n   //    1.0, 0.0, 0.0, 0.0 ,\n   //    0.0, 1.0, 0.0, 0.0,\n   //    0.0, 0.0, 1.0, 0.0,\n   //    1.0, 0.0, 0.0, 1.0\n   // );\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   setPickingColor(a_PickingColor);\n}\n',cE=function(t){Yt(n,t);var e=oE(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"terrainImageLoaded",!1),(0,Ft.Z)(Kt(t),"planeGeometryTriangulation",(function(){var e,n=t.layer.getLayerConfig(),r=n.width,i=void 0===r?1:r,o=n.height,a=void 0===o?1:o,s=n.widthSegments,u=void 0===s?1:s,c=n.heightSegments,l=void 0===c?1:c,h=n.center,f=void 0===h?[120,30]:h,p=n.terrainTexture,d=(e=t).initPlane.apply(e,[i,a,u,l].concat((0,C.Z)(f))),v=d.indices,m=d.positions;return p&&t.loadTerrainTexture(m,v),{vertices:m,indices:v,size:5}})),t}return zt(n,[{key:"initPlane",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:120,o=arguments.length>5&&void 0!==arguments[5]?arguments[5]:30,a=t/2,s=e/2,u=Math.floor(n),c=Math.floor(r),l=u+1,h=c+1,f=t/u,p=e/c,d=[],v=[],m=0;m<h;m++)for(var g=m*p-s,y=0;y<l;y++){var _=y*f-a;if(this.mapService.version===ux["GAODE2.x"]){var x=this.mapService.lngLatToCoord([_+i,-g+o]),b=(0,Li.Z)(x,2),w=b[0],E=b[1];v.push(w,E,0)}else v.push(_+i,-g+o,0);v.push(y/u),v.push(1-m/c)}for(var S=0;S<c;S++)for(var A=0;A<u;A++){var T=A+l*S,C=A+l*(S+1),k=A+1+l*(S+1),M=A+1+l*S;d.push(T,C,M),d.push(C,k,M)}return{indices:d,positions:v}}},{key:"getUninforms",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.mapTexture,i=e.terrainClipHeight,o=void 0===i?0:i,a=e.terrainTexture;this.mapTexture!==r&&(this.mapTexture=r,null===(t=this.texture)||void 0===t||t.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_terrainClipHeight:a?o:-1,u_texture:this.texture}}},{key:"clearModels",value:function(){var t;this.terrainImage=null,null===(t=this.texture)||void 0===t||t.destroy()}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.mapTexture,this.mapTexture=n,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),this.updateTexture(n),t.next=7,this.layer.buildLayerModel({moduleName:"geometryPlane",vertexShader:uE,fragmentShader:sE,triangulation:this.planeGeometryTriangulation,primitive:vf.TRIANGLES,depth:{enable:!0},cull:{enable:!0,face:vf.BACK}});case 7:return i=t.sent,t.abrupt("return",[i]);case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"createModelData",value:function(t){if(t){var e=this.layer.getLayerConfig(),n=e.widthSegments,r=e.heightSegments,i=e.width,o=e.height,a=t,s=a.widthSegments,u=a.heightSegments,c=a.width,l=a.height;this.layer.style({widthSegments:void 0!==s?s:n,heightSegments:void 0!==u?u:r,width:void 0!==c?c:i,height:void 0!==l?l:o})}var h=this.layer.getEncodedData(),f=this.styleAttributeService.createAttributesAndIndices(h,this.planeGeometryTriangulation);return f}},{key:"updateTexture",value:function(t){var e=this,n=this.rendererService.createTexture2D;if(t){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE}),e.layerService.reRender()},r.src=t}else this.texture=n({width:0,height:0})}},{key:"getImageData",value:function(t){var e=document.createElement("canvas"),n=e.getContext("2d"),r=t.width,i=t.height;e.width=r,e.height=i,n.drawImage(t,0,0,r,i);var o=n.getImageData(0,0,r,i);return o}},{key:"translateVertex",value:function(t,e,n,r,i,o){for(var a=n.width,s=n.height,u=this.getImageData(n).data,c=Math.floor(r),l=Math.floor(i),h=c+1,f=l+1,p=a/c,d=s/l,v=0;v<f;v++)for(var m=Math.floor(v*d),g=m*a,y=0;y<h;y++){var _=Math.floor(y*p),x=4*(g+_),b=u[x],w=u[x+1],E=u[x+2],S=5*(v*h+y)+2;t[S]=o(b,w,E)}var A=this.layer.getEncodedData(),T=this.styleAttributeService.createAttributesAndIndices(A,(function(){return{vertices:t,indices:e,size:5}}));this.layer.updateModelData(T),this.layerService.throttleRenderLayers()}},{key:"loadTerrainTexture",value:function(t,e){var n=this,r=this.layer.getLayerConfig(),i=r.widthSegments,o=void 0===i?1:i,a=r.heightSegments,s=void 0===a?1:a,u=r.terrainTexture,c=r.rgb2height,l=void 0===c?function(t,e,n){return t+e+n}:c;if(this.terrainImage)this.terrainImageLoaded?this.translateVertex(t,e,this.terrainImage,o,s,l):this.terrainImage.onload=function(){n.translateVertex(t,e,n.terrainImage,o,s,l)};else{var h=new Image;this.terrainImage=h,h.crossOrigin="anonymous",h.onload=function(){n.terrainImageLoaded=!0,setTimeout((function(){return n.layer.emit("terrainImageLoaded",null)})),n.translateVertex(t,e,h,o,s,l)},h.src=u}}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),n}(Bx);function lE(t){var e=hE();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function hE(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var fE="\nuniform sampler2D u_texture;\nuniform float u_mapFlag;\nuniform float u_opacity;\n\nvarying vec3 v_Color;\nvarying float v_d;\n\nvoid main() {\n\n  if(v_d < 0.0) {\n    discard;\n  }\n\n  if(u_mapFlag > 0.0) {\n    gl_FragColor = texture2D(u_texture, gl_PointCoord);\n    gl_FragColor.a *= u_opacity;\n  } else {\n    gl_FragColor = vec4(v_Color, u_opacity);\n  }\n}\n",pE='precision highp float;\n\nattribute vec3 a_Position;\nattribute vec3 a_Color;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_opacity;\nuniform float u_Scale;\nvarying vec3 v_Color;\nvarying float v_d;\n\n#pragma include "projection"\nvoid main() {\n   v_Color = a_Color;\n  \n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   v_d = a_Position.z;\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy, a_Position.z, 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, a_Position.z, 1.0));\n   }\n\n   gl_PointSize = pow((u_Zoom - 1.0), 2.0) * u_Scale;\n}\n',dE=function(t){return t["UP"]="up",t["DOWN"]="down",t}(dE||{}),vE=function(t){Yt(n,t);var e=lE(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"planeGeometryUpdateTriangulation",(function(){for(var e=t.layer.getLayerConfig(),n=e.spriteBottom,r=void 0===n?-1e5:n,i=t.spriteUpdate,o=r,a=t.spriteTop,s=0;s<t.positions.length;s+=5)t.spriteAnimate===dE.UP?(t.positions[s+2]+=i,t.positions[s+2]>a&&(t.positions[s+2]=o)):(t.positions[s+2]-=i,t.positions[s+2]<o&&(t.positions[s+2]=a));return{vertices:t.positions,indices:t.indices,size:5}})),(0,Ft.Z)(Kt(t),"updateModel",(function(){var e=t.layer.createAttributes({triangulation:t.planeGeometryUpdateTriangulation});t.layer.models.map((function(t){t.updateAttributes(e)})),t.layerService.throttleRenderLayers(),t.timer=requestAnimationFrame(t.updateModel)})),(0,Ft.Z)(Kt(t),"planeGeometryTriangulation",(function(){var e,n=t.layer.getLayerConfig(),r=n.center,i=void 0===r?[120,30]:r,o=n.spriteCount,a=void 0===o?100:o,s=n.spriteRadius,u=void 0===s?10:s,c=(e=t).initSprite.apply(e,[u,a].concat((0,C.Z)(i))),l=c.indices,h=c.positions;return t.positions=h,t.indices=l,{vertices:h,indices:l,size:5}})),t}return zt(n,[{key:"initSprite",value:function(){for(var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:120,r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:30,i=[],o=[],a=this.mapService,s=this.spriteAnimate===dE.UP?-this.spriteTop:this.spriteTop,u=0;u<e;u++){var c=Math.random()*s;o.push.apply(o,(0,C.Z)(h(c)))}for(var l=0;l<e;l++)i.push(l);function h(e){var i=t*Math.random(),o=t*Math.random(),s=-t/2+i,u=-t/2+o;if(a.version===ux["GAODE2.x"]){var c=a.lngLatToCoord([s+n,-u+r]),l=(0,Li.Z)(c,2),h=l[0],f=l[1];return[h,f,e,0,0]}return[s+n,-u+r,e,0,0]}return{indices:i,positions:o}}},{key:"getUninforms",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.mapTexture,i=e.spriteScale,o=void 0===i?1:i;this.mapTexture!==r&&(this.mapTexture=r,null===(t=this.texture)||void 0===t||t.destroy(),this.updateTexture(r));return{u_opacity:n||1,u_mapFlag:r?1:0,u_texture:this.texture,u_Scale:o}}},{key:"clearModels",value:function(){var t;cancelAnimationFrame(this.timer),null===(t=this.texture)||void 0===t||t.destroy()}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l,h=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.mapTexture,r=e.spriteTop,i=void 0===r?5e6:r,o=e.spriteUpdate,a=void 0===o?1e4:o,s=e.spriteAnimate,u=void 0===s?dE.DOWN:s,this.mapTexture=n,this.spriteTop=i,this.spriteUpdate=a,this.spriteAnimate="up"===u?dE.UP:dE.DOWN,c=this.rendererService.createTexture2D,this.texture=c({height:0,width:0}),this.updateTexture(n),setTimeout((function(){h.updateModel()}),100),t.next=11,this.layer.buildLayerModel({moduleName:"geometrySprite",vertexShader:pE,fragmentShader:fE,triangulation:this.planeGeometryTriangulation,primitive:vf.POINTS,depth:{enable:!1},blend:this.getBlend()});case 11:return l=t.sent,t.abrupt("return",[l]);case 13:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"updateTexture",value:function(t){var e=this,n=this.rendererService.createTexture2D;if(t){var r=new Image;r.crossOrigin="anonymous",r.onload=function(){e.texture=n({data:r,width:r.width,height:r.height,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE}),e.layerService.reRender()},r.src=t}else this.texture=n({width:0,height:0})}},{key:"registerBuiltinAttributes",value:function(){return""}}]),n}(Bx),mE={plane:cE,sprite:vE,billboard:iE},gE=mE;function yE(t){var e=_E();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function _E(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var xE=function(t){Yt(n,t);var e=yE(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","GeometryLayer"),(0,Ft.Z)(Kt(t),"defaultSourceConfig",{data:[{x:0,y:0}],options:{parser:{type:"json",x:"x",y:"y"}}}),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new gE[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),e={plane:{},sprite:{},billboard:{}};return e[t]}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null===e||void 0===e||null===(t=e.scale)||void 0===t?void 0:t.field;return"plane"===n?"plane":"sprite"===n?"sprite":"billboard"===n?"billboard":"plane"}}]),n}(Dx);function bE(t){var e=wE();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function wE(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var EE='precision highp float;\r\n// 多边形顶点坐标\r\nattribute vec3 a_Position;\r\n// 多边形经纬度坐标\r\nattribute vec3 a_Pos;\r\nattribute float a_Size;\r\nattribute vec4 a_Color;\r\nuniform vec2 u_radius;\r\nuniform float u_coverage: 0.9;\r\nuniform float u_angle: 0;\r\nuniform mat4 u_ModelMatrix;\r\nuniform mat4 u_Mvp;\r\nvarying vec4 v_color;\r\n\r\nuniform vec2 u_sceneCenterMercator;\r\n\r\n#pragma include "projection"\r\n#pragma include "project"\r\n#pragma include "picking"\r\n\r\nvoid main() {\r\n  v_color = a_Color;\r\n\r\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r\n  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r\n  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n  // gl_Position = project_common_position_to_clipspace(project_pos);\r\n\r\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\r\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r\n    gl_Position = u_Mvp * (project_pos);\r\n  } else {\r\n     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r\n    gl_Position = project_common_position_to_clipspace(project_pos);\r\n  }\r\n\r\n  setPickingColor(a_PickingColor);\r\n}\r\n',SE='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',AE=function(t){Yt(n,t);var e=bE(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.coverage,r=t.angle;return{u_opacity:e||1,u_coverage:n||.9,u_angle:r||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:EE,fragmentShader:SE,triangulation:zw,primitive:vf.TRIANGLES,depth:{enable:!1}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ug.Attribute,descriptor:{name:"a_Pos",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),n}(Bx);function TE(t){var e=CE();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function CE(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var kE,ME,PE='precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\n\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "light"\n#pragma include "picking"\n\n\nvoid main() {\n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n \n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 经纬度\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // 将经纬度转换为高德2.0需要的平面坐标\n    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));\n\n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n  \n    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);\n  } else {\n    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // 实际的经纬度\n    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));\n    \n    float lightWeight = calc_lighting(project_pos);\n    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);\n    \n    gl_Position = project_common_position_to_clipspace(project_pos);\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',IE='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',RE=function(t){Yt(n,t);var e=TE(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.coverage,r=t.angle;return{u_opacity:e||1,u_coverage:n||1,u_angle:r||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:PE,fragmentShader:IE,triangulation:Aw,primitive:vf.TRIANGLES,depth:{enable:!0}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size;return Array.isArray(e)?[e[0]]:[e]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ug.Attribute,descriptor:{name:"a_Pos",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),n}(Bx);function LE(t,e){for(var n=[],r=[],i=[],o=t+1,a=e+1,s=t/2,u=e/2,c=0;c<a;c++)for(var l=c-u,h=0;h<o;h++){var f=h-s;r.push(f/s,-l/u,0),i.push(h/t),i.push(1-c/e)}for(var p=0;p<e;p++)for(var d=0;d<t;d++){var v=d+o*p,m=d+o*(p+1),g=d+1+o*(p+1),y=d+1+o*p;n.push(v,m,y),n.push(m,g,y)}return{vertices:r,indices:n,uvs:i}}function OE(t){var e=DE();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function DE(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var NE="uniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_opacity;\nvarying vec2 v_texCoord;\nvarying float v_intensity;\n\nvoid main(){\n   \n     float intensity = texture2D(u_texture, v_texCoord).r;\n    vec4 color = texture2D(u_colorTexture,vec2(intensity, 0));\n    gl_FragColor = color;\n    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;\n     gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n}\n",zE='precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_InverseViewProjectionMatrix;\nuniform mat4 u_ViewProjectionMatrixUncentered;\nvarying float v_intensity;\n\n\nvec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {\n    float t2 = t * t;\n    float one_minus_t = 1.0 - t;\n    float one_minus_t2 = one_minus_t * one_minus_t;\n    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);\n}\nvec2 toBezier(float t, vec4 p){\n    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));\n}\n#pragma include "projection"\nvoid main() {\n  v_texCoord = a_Uv;\n\n  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // 将原本 0 -> 1 的 uv 转换为 -1 -> 1 的标准坐标空间（NDC）\n\n  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y 平面上的点（z == 0）可以认为是三维上的点被投影到平面后的点\n\tvec4 p2 = vec4(pos, 1.0, 1.0); // 平行于x/y平面、z==1 的平面上的点\n\n\tvec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // 根据视图投影矩阵的逆矩阵平面上的反算出三维空间中的点（p1平面上的点）\n\tvec4 inverseP2 = u_InverseViewProjectionMatrix * p2;\n\n  inverseP1 = inverseP1 / inverseP1.w; // 归一化操作（归一化后为世界坐标）\n\tinverseP2 = inverseP2 / inverseP2.w;\n\n\tfloat zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??\n\tvec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);\n\n  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);\n  float fh;\n\n  v_intensity = texture2D(u_texture, v_texCoord).r;\n  fh = toBezier(v_intensity, b).y;\n  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);\n \n}\n',FE="uniform sampler2D u_texture;        // 热力强度图\nuniform sampler2D u_colorTexture;   // 根据强度分布的色带\nuniform float u_opacity;\nvarying vec2 v_texCoord;\n\nuniform vec2 u_ViewportSize;\n\nfloat getBlurIndusty() {\n    float vW = 2.0/u_ViewportSize.x;\n    float vH = 2.0/u_ViewportSize.y;\n    vec2 vUv = v_texCoord;\n    float i11 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i12 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;\n    float i13 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;\n\n    float i21 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y) ).r;\n    float i22 = texture2D( u_texture, vec2( vUv.x , vUv.y) ).r;\n    float i23 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y) ).r;\n\n    float i31 = texture2D( u_texture, vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;\n    float i32 = texture2D( u_texture, vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;\n    float i33 = texture2D( u_texture, vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;\n\n    return(\n        i11 + \n        i12 + \n        i13 + \n        i21 + \n        i21 + \n        i22 + \n        i23 + \n        i31 + \n        i32 + \n        i33\n        )/9.0;\n}\n\n\nvoid main(){\n    // float intensity = texture2D(u_texture, v_texCoord).r;\n    float intensity = getBlurIndusty();\n    vec4 color = texture2D(u_colorTexture, vec2(intensity, 0.0));\n\n    gl_FragColor =color;\n    gl_FragColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;\n\n}\n",BE="precision highp float;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  v_texCoord = a_Uv;\n\n  gl_Position = vec4(a_Position.xy, 0, 1.);\n}\n",UE="precision highp float;\nuniform float u_intensity;\nvarying float v_weight;\nvarying vec2 v_extrude;\n#define GAUSS_COEF  0.3989422804014327\nvoid main(){\n    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);\n    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);\n    gl_FragColor = vec4(val, 1., 1., 1.);\n}\n",jE='precision highp float;\nattribute vec3 a_Position;\nattribute float a_Size;\nattribute vec2 a_Dir;\nuniform float u_intensity;\nuniform float u_radius;\nvarying vec2 v_extrude;\nvarying float v_weight;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#define GAUSS_COEF  0.3989422804014327\n\n#pragma include "projection"\n\nvoid main(){\n    v_weight = a_Size;\n    float ZERO = 1.0 / 255.0 / 16.0;\n    float extrude_x = a_Dir.x * 2.0 -1.0;\n    float extrude_y = a_Dir.y * 2.0 -1.0;\n    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));\n    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;\n    v_extrude = extrude_dir * S;\n\n    vec2 offset = project_pixel(v_extrude * u_radius);\n    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n\n    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));\n    } else {\n        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n    }\n}\n',ZE=(kE=(0,xc.b2)(),kE(ME=function(t){Yt(n,t);var e=OE(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"render",value:function(t){var e=this,n=this.rendererService,r=n.clear,i=n.useFramebuffer,o=this.layer.getLayerConfig(),a=o.rampColors;i(this.heatmapFramerBuffer,(function(){r({color:[0,0,0,0],depth:1,stencil:0,framebuffer:e.heatmapFramerBuffer}),e.drawIntensityMode()})),(0,Oi.isEqual)(this.preRampColors,a)||this.updateColorTexture(),"heatmap"===this.shapeType?this.drawColorMode(t):this.draw3DHeatMap(t)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return n=this.rendererService,r=n.createFramebuffer,i=n.getViewportSize,o=n.createTexture2D,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=(null===a||void 0===a||null===(e=a.scale)||void 0===e?void 0:e.field)||"heatmap",this.shapeType=s,t.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=t.sent,this.colorModel="heatmap"===s?this.buildHeatmapColor():this.build3dHeatMap(),u=i(),c=u.width,l=u.height,this.heatmapFramerBuffer=r({color:o({width:Math.floor(c/4),height:Math.floor(l/4),wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE,min:vf.LINEAR,mag:vf.LINEAR}),depth:!1}),this.updateColorTexture(),t.abrupt("return",[this.intensityModel,this.colorModel]);case 12:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Ug.Attribute,descriptor:{name:"a_Dir",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return[n]}}})}},{key:"buildHeatMapIntensity",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.layer.triangulation=Uw,t.next=3,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:jE,fragmentShader:UE,triangulation:Uw,depth:{enable:!1},cull:{enable:!0,face:Ri(this.mapService.version)}});case 3:return e=t.sent,t.abrupt("return",e);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildHeatmapColor",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:BE,fs:FE});var t=this.shaderModuleService.getModule("heatmapColor"),e=t.vs,n=t.fs,r=t.uniforms,i=this.rendererService,o=i.createAttribute,a=i.createElements,s=i.createBuffer,u=i.createModel;return u({vs:e,fs:n,attributes:{a_Position:o({buffer:s({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:vf.FLOAT}),size:3}),a_Uv:o({buffer:s({data:[0,1,1,1,0,0,1,0],type:vf.FLOAT}),size:2})},uniforms:(0,k.Z)({},r),depth:{enable:!1},elements:a({data:[0,2,1,2,3,1],type:vf.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var t,e=this.layer.getLayerConfig(),n=e.opacity,r=e.intensity,i=void 0===r?10:r,o=e.radius,a=void 0===o?5:o;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),null===(t=this.intensityModel)||void 0===t||t.draw({uniforms:{u_opacity:n||1,u_radius:a,u_intensity:i},blend:{enable:!0,func:{srcRGB:vf.ONE,srcAlpha:1,dstRGB:vf.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawColorMode",value:function(t){var e,n=this.layer.getLayerConfig(),r=n.opacity;null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:r||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},blend:this.getBlend(),stencil:this.getStencil(t)})}},{key:"draw3DHeatMap",value:function(t){var e,n=this.layer.getLayerConfig(),r=n.opacity,i=cl();ml(i,this.cameraService.getViewProjectionMatrixUncentered()),null===(e=this.colorModel)||void 0===e||e.draw({uniforms:{u_opacity:r||1,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,C.Z)(i)},blend:{enable:!0,func:{srcRGB:vf.SRC_ALPHA,srcAlpha:1,dstRGB:vf.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(t)})}},{key:"build3dHeatMap",value:function(){var t=this.rendererService.getViewportSize,e=t(),n=e.width,r=e.height,i=LE(n/4,r/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:zE,fs:NE});var o=this.shaderModuleService.getModule("heatmap3dColor"),a=o.vs,s=o.fs,u=o.uniforms,c=this.rendererService,l=c.createAttribute,h=c.createElements,f=c.createBuffer,p=c.createModel;return p({vs:a,fs:s,attributes:{a_Position:l({buffer:f({data:i.vertices,type:vf.FLOAT}),size:3}),a_Uv:l({buffer:f({data:i.uvs,type:vf.FLOAT}),size:2})},primitive:vf.TRIANGLES,uniforms:(0,k.Z)({},u),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:vf.SRC_ALPHA,srcAlpha:1,dstRGB:vf.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:h({data:i.indices,type:vf.UNSIGNED_INT,count:i.indices.length})})}},{key:"updateStyle",value:function(){this.updateColorTexture()}},{key:"updateColorTexture",value:function(){var t=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var e=this.layer.getLayerConfig(),n=e.rampColors,r=Si(n);this.colorTexture=t({data:new Uint8Array(r.data),width:r.width,height:r.height,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE,min:vf.NEAREST,mag:vf.NEAREST,flipY:!1}),this.preRampColors=n}}]),n}(Bx))||ME);function VE(t){var e=GE();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function GE(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var HE='precision highp float;\nvarying vec4 v_color;\nuniform float u_opacity: 1;\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',WE='precision highp float;\n// 多边形顶点坐标\nattribute vec3 a_Position;\n// 多边形经纬度坐标\nattribute vec3 a_Pos;\nattribute float a_Size;\nattribute vec4 a_Color;\nuniform vec2 u_radius;\nuniform float u_coverage: 0.9;\nuniform float u_angle: 0;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform vec2 u_sceneCenterMercator;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nvoid main() {\n  v_color = a_Color;\n    \n  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\n  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));\n  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\n \n  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));\n    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));\n    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;\n    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\n    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',qE=function(t){Yt(n,t);var e=VE(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.coverage,r=t.angle;return{u_opacity:e||1,u_coverage:n||.9,u_angle:r||0,u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset]}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:WE,fragmentShader:HE,triangulation:zw,depth:{enable:!1},primitive:vf.TRIANGLES});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ug.Attribute,descriptor:{name:"a_Pos",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t){var e="GAODE2.x"===t.version?t.originCoordinates:t.coordinates;return[e[0],e[1],0]}}})}}]),n}(Bx),XE={heatmap:ZE,heatmap3d:ZE,grid:AE,grid3d:RE,hexagon:qE},YE=XE;function KE(t){var e=QE();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function QE(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var JE=function(t){Yt(n,t);var e=KE(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","HeatMapLayer"),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new YE[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"renderModels",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.getModelType();return"heatmap"===n?(this.layerModel&&this.layerModel.render(e),this):(this.encodeDataLength<=0&&!this.forceRender||(this.hooks.beforeRender.call(),this.models.forEach((function(n){return n.draw({uniforms:t.layerModel.getUninforms(),blend:t.layerModel.getBlend(),stencil:t.layerModel.getStencil(e)})})),this.hooks.afterRender.call()),this)}},{key:"updateModelData",value:function(t){t.attributes&&t.elements&&this.models[0].updateAttributesAndElements(t.attributes,t.elements)}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=this.getLayerConfig(),r=n.shape3d,i=this.getSource(),o=i.data.type,a=(null===e||void 0===e||null===(t=e.scale)||void 0===t?void 0:t.field)||"heatmap";return"heatmap"===a||"heatmap3d"===a?"heatmap":"hexagon"===o?-1===(null===r||void 0===r?void 0:r.indexOf(a))?"hexagon":"grid3d":"grid"===o?-1===(null===r||void 0===r?void 0:r.indexOf(a))?"grid":"grid3d":"heatmap"}}]),n}(Dx);function $E(t){var e=tS();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function tS(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var eS="precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n  if(gl_FragColor.a < 0.01)\n    discard;\n}\n",nS='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',rS=function(t){Yt(n,t);var e=$E(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity;return{u_opacity:e||1,u_texture:this.texture}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.layer.getSource(),n=this.rendererService.createTexture2D,this.texture=n({height:0,width:0}),!yr){t.next=11;break}r=this.layerService.sceneService.getSceneConfig().canvas,i=r.createImage(),i.crossOrigin="anonymous",i.src=e.data.originData,i.onload=function(){s.texture=n({data:i,width:i.width,height:i.height}),s.layerService.reRender()},t.next=15;break;case 11:return t.next=13,e.data.images;case 13:o=t.sent,this.texture=n({data:o[0],width:o[0].width,height:o[0].height,mag:vf.LINEAR,min:vf.LINEAR});case 15:return t.next=17,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:nS,fragmentShader:eS,triangulation:Fw,primitive:vf.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 17:return a=t.sent,t.abrupt("return",[a]);case 19:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),n}(Bx),iS={image:rS},oS=iS;function aS(t){var e=sS();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function sS(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var uS=function(t){Yt(n,t);var e=aS(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","ImageLayer"),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new oS[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),e={image:{}};return e[t]}},{key:"getModelType",value:function(){return"image"}}]),n}(Dx);function cS(t){var e=lS();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function lS(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var hS='\nuniform float u_opacity;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying float v_distance_ratio;\n\nuniform float segmentNumber;\n\n\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n\n\n  float flag = 0.;\n  float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    flag = 1.;\n  };\n  gl_FragColor.a *=flag;\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}',fS='\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\n\n\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_lineDir: 1.0;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\n\nuniform float u_thetaOffset: 0.314;\n\nuniform float u_opacity: 1.0;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n  // dash: index / (segmentNumber - 1.);\n  // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  \n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n\n  vec2 s = source;\n  vec2 t = target;\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    s = unProjCustomCoord(source);\n    t = unProjCustomCoord(target);\n  }\n  float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n\n  v_distance_ratio = segmentIndex / segmentNumber;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n \n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  gl_PointSize = 5.0;\n  setPickingColor(a_PickingColor);\n}\n',pS='\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\n\nuniform float segmentNumber;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_color;\n  \n  gl_FragColor.a *= u_opacity;\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 当存在贴图时在底色上贴上贴图\n  if(u_line_texture == LineTexture) { // while load texture\n    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));\n    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);\n\n    float count = v_lineData.g; // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n    float v = v_lineData.a; // 横向 v\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= u_opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n    \n  } else {\n     gl_FragColor = filterColor(gl_FragColor);\n  }\n}',dS='#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_lineDir: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_lineData;\nvarying vec2 v_distance_ratio;\n\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    // dash: index / (segmentNumber - 1.);\n    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n    //  return index / (segmentNumber - 1.);\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  \n  if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n      if(u_lineDir != 1.0) {\n        d_distance_ratio = 1.0 - d_distance_ratio;\n      }\n  }\n\n v_lineData.b = d_distance_ratio;\n\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n v_lineData.r = d_segmentIndex;\n\n  if(LineTexture == u_line_texture) { // 开启贴图模式\n\n    float arcDistrance = length(source - target); // 起始点和终点的距离\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      arcDistrance *= 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      // arcDistrance *= 8.0;\n      arcDistrance = project_pixel_allmap(arcDistrance);\n    }\n    v_iconMapUV = a_iconMapUV;\n\n    float pixelLen = project_pixel_texture(u_icon_step); // 贴图沿弧线方向的长度 - 随地图缩放改变\n    float texCount = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n    v_lineData.g = texCount;\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size); // 定点位置偏移\n    v_lineData.a = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',vS='varying vec4 v_color;\n\n#pragma include "picking"\n\nvoid main() {\n// 当前顶点在弧线中所处的分段位置\n\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}',mS='\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nvarying vec4 v_color;\nvarying float v_segmentIndex;\n\nuniform float u_lineDir: 1.0;\nuniform float u_opacity: 1.0;\n\nuniform float u_thetaOffset: 0.314;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\nvec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = arcThetaOffset;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  if(u_lineDir == 1.0) { // 正向\n    return mid;\n  } else { // 逆向\n    // (mid + vmin)/2 = (s + t)/2\n    vec2 vmid = source + target - mid;\n    return vmid;\n  }\n  // return mid;\n}\nfloat getSegmentRatio(float index) {\n    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));\n}\nvec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  vec2 mid = midPoint(source, target, arcThetaOffset);\n  vec3 x = vec3(source.x, mid.x, target.x);\n  vec3 y = vec3(source.y, mid.y, target.y);\n  return vec2(bezier3(x ,t), bezier3(y,t));\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nvoid main() {\n  v_color = a_Color;\n\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  float d_distance_ratio;\n  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, u_thetaOffset), 0.0, 1.0));\n  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, u_thetaOffset), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  //unProjCustomCoord\n  \n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n\n\n  float d_segmentIndex = a_Position.x + 1.0; // 当前顶点在弧线中所处的分段位置\n\n  v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  v_color.a *= u_opacity;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, 0, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, 0, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n',gS={solid:0,dash:1},yS=function(t){Yt(n,t);var e=cS(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:vf.NEAREST,min:vf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,c=t.dashArray,l=void 0===c?[10,5]:c,h=t.forward,f=void 0===h||h,p=t.lineTexture,d=void 0!==p&&p,v=t.iconStep,m=void 0===v?100:v,g=t.segmentNumber,y=void 0===g?30:g,_=t.thetaOffset,x=void 0===_?.314:_;2===l.length&&l.push(0,0);var b=0,w=[0,0,0,0],E=[0,0,0,0];return r&&i&&(w=bi(r),E=bi(i),b=1),this.rendererService.getDirty()&&this.texture.bind(),{u_thetaOffset:x,u_opacity:(0,Oi.isNumber)(n)?n:1,u_textureBlend:"normal"===a?0:1,segmentNumber:y,u_line_type:gS[u||"solid"],u_dash_array:l,u_blur:.9,u_lineDir:f?1:-1,u_texture:this.texture,u_line_texture:d?1:0,u_icon_step:m,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:b,u_sourceColor:w,u_targetColor:E}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor,r=t.lineType;return"dash"===r?{frag:hS,vert:fS,type:"Dash"}:e&&n?{frag:vS,vert:mS,type:"Linear"}:{frag:pS,vert:dS,type:""}}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,t.next=4,this.layer.buildLayerModel({moduleName:"lineArc2d"+s,vertexShader:a,fragmentShader:o,triangulation:Bw,depth:{enable:!1},segmentNumber:r});case 4:return u=t.sent,t.abrupt("return",[u]);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ug.Attribute,descriptor:{name:"a_Instance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap(),r=e.texture,i=n[r]||{x:0,y:0},o=i.x,a=i.y;return[o,a]}}})}}]),n}(Bx);function _S(t){var e=xS();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function xS(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var bS='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_opacity;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',wS='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',ES='\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',SS='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // 运动速度\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',AS={solid:0,dash:1},TS=function(t){Yt(n,t);var e=_S(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:vf.NEAREST,min:vf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor,r=t.textureBlend,i=void 0===r?"normal":r,o=t.lineType,a=void 0===o?"solid":o,s=t.dashArray,u=void 0===s?[10,5]:s,c=t.lineTexture,l=void 0!==c&&c,h=t.iconStep,f=void 0===h?100:h,p=t.segmentNumber,d=void 0===p?30:p,v=t.globalArcHeight,m=void 0===v?10:v;2===u.length&&u.push(0,0);var g=0,y=[0,0,0,0],_=[0,0,0,0];return e&&n&&(y=bi(e),_=bi(n),g=1),this.rendererService.getDirty()&&this.texture.bind(),(0,k.Z)({u_globel:"GLOBEL"===this.mapService.version?1:0,u_globel_radius:qb,u_global_height:m,u_textureBlend:"normal"===i?0:1,segmentNumber:d,u_line_type:AS[a]||0,u_dash_array:u,u_texture:this.texture,u_line_texture:l?1:0,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:g,u_sourceColor:y,u_targetColor:_},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:ES,vert:SS,type:"Linear"}:{frag:bS,vert:wS,type:""}}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,t.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:Bw,segmentNumber:r});case 4:return u=t.sent,t.abrupt("return",[u]);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ug.Attribute,descriptor:{name:"a_Instance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap(),r=e.texture,i=n[r]||{x:0,y:0},o=i.x,a=i.y;return[o,a]}}})}}]),n}(Bx);function CS(t){var e=kS();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function kS(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var MS='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec4 v_line_data;\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying float v_segmentIndex;\nuniform float segmentNumber;\nuniform float u_opacity;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_line_data.g; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float flag = 0.;\n    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      flag = 1.;\n    }\n    gl_FragColor.a *=flag;\n  }\n\n  if(u_animate.x == Animate && u_line_texture != LineTexture) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture\n    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));\n    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // // 贴图在弧线上重复的数量\n\n    float time = 0.0;\n    if(u_animate.x == Animate) {\n      time = u_time / u_animate.y;\n    }\n    float redioCount = arcRadio * count;\n\n    float u = fract(redioCount - time);\n\n    float v = v_line_data.a;  // 线图层贴图部分的 v 坐标值\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_animate.x == Animate) {\n      float currentPlane = floor(redioCount - time);\n      float textureStep = floor(count * u_animate.z);\n      float a = mod(currentPlane, textureStep);\n      if(a < textureStep - 1.0) {\n        pattern = vec4(0.0);\n      }\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n          discard;\n        } else {\n          gl_FragColor = filterColor(pattern);\n        }\n    }\n\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',PS='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_segmentIndex;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      d_distance_ratio = segmentIndex / segmentNumber;\n  }\n  v_line_data.g = d_distance_ratio; // 当前点位距离占线总长的比例\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n\n\n  v_segmentIndex = a_Position.x;\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // 开启贴图模式  \n\n    float arcDistrance = length(source - target);\n    float pixelLen =  project_pixel_texture(u_icon_step);\n    v_line_data.b = floor(arcDistrance/pixelLen); // 贴图在弧线上重复的数量\n\n    vec2 projectOffset = project_pixel(offset);\n    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\n    v_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n  \n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',IS='\n#define Animate 0.0\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_Color;\n\nvarying float v_distance_ratio;\n#pragma include "picking"\n\nvoid main() {\n\n  float animateSpeed = 0.0; // 运动速度\n  gl_FragColor = v_Color;\n\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      // alpha = smoothstep(0., 1., alpha);\n      alpha = clamp(alpha, 0.0, 1.0);\n      gl_FragColor.a *= alpha;\n\n      // u_animate \n      // x enable\n      // y duration\n      // z interval\n      // w trailLength\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',RS='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute vec2 a_iconMapUV;\n\nuniform float u_globel;\nuniform float u_globel_radius;\nuniform float u_global_height: 10;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\nvarying float v_distance_ratio;\n\nvarying vec4 v_dash_array;\nvarying vec4 v_color;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_Color;\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n  vec2 x = mix(source, target, ratio);\n  vec2 center = mix(source, target, 0.5);\n  float dSourceCenter = distance(source, center);\n  float dXCenter = distance(x, center);\n  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n  float vertex_height = paraboloid(source, target, segmentRatio);\n\n  return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n  );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;\n\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\n\nfloat torad(float deg) {\n  return (deg / 180.0) * acos(-1.0);\n}\n\nvec3 lglt2xyz(vec2 lnglat) {\n  float pi = 3.1415926;\n  // + Math.PI/2 是为了对齐坐标\n  float lng = torad(lnglat.x) + pi / 2.0;\n  float lat = torad(lnglat.y);\n\n  // 手动增加一些偏移，减轻面的冲突\n  float radius = u_globel_radius;\n\n  float z = radius * cos(lat) * cos(lng);\n  float x = radius * cos(lat) * sin(lng);\n  float y = radius * sin(lat);\n  return vec3(x, y, z);\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = a_Color;\n  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;\n  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  float d_distance_ratio;\n   if(u_line_type == LineTypeDash) {\n    d_distance_ratio = segmentIndex / segmentNumber;\n    // float total_Distance = pixelDistance(a_Instance.rg, a_Instance.ba) / 2.0 * PI;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);\n  }\n    if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  vec3 curr = getPos(source, target, segmentRatio);\n  vec3 next = getPos(source, target, nextSegmentRatio);\n  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);\n\n  float animateSpeed = 0.0; // 运动速度\n  v_Color = mix(u_sourceColor, u_targetColor, a_Position.x/segmentNumber);\n\n  v_Color.a *= opacity;\n\n\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + project_pixel(offset), curr.z, 1.0));\n  }\n\n  // 地球模式\n  if(u_globel > 0.0) {\n    vec3 startLngLat = lglt2xyz(a_Instance.rg);\n    vec3 endLngLat = lglt2xyz(a_Instance.ba);\n    float globalRadius = length(startLngLat);\n\n    vec3 lineDir = normalize(endLngLat - startLngLat);\n    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);\n\n    // 线的偏移\n    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;\n    // 计算起始点和终止点的距离\n    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;\n    // 计算飞线各个节点相应的高度\n    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;\n    // 地球点位\n    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;\n    \n    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);\n  }\n \n\n  setPickingColor(a_PickingColor);\n}\n',LS={solid:0,dash:1},OS=function(t){Yt(n,t);var e=CS(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:vf.NEAREST,min:vf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,c=t.dashArray,l=void 0===c?[10,5]:c,h=t.lineTexture,f=void 0!==h&&h,p=t.iconStep,d=void 0===p?100:p,v=t.segmentNumber,m=void 0===v?30:v,g=t.globalArcHeight,y=void 0===g?10:g;2===l.length&&l.push(0,0);var _=0,x=[0,0,0,0],b=[0,0,0,0];return r&&i&&(x=bi(r),b=bi(i),_=1),this.rendererService.getDirty()&&this.texture.bind(),{u_globel:1,u_globel_radius:qb,u_global_height:y,u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:m,u_line_type:LS[u]||0,u_dash_array:l,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:_,u_sourceColor:x,u_targetColor:b}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:IS,vert:RS,type:"Linear"}:{frag:MS,vert:PS,type:""}}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.segmentNumber,r=void 0===n?30:n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,t.next=4,this.layer.buildLayerModel({moduleName:"lineEarthArc3d"+s,vertexShader:a,fragmentShader:o,triangulation:Bw,depth:{enable:!0},segmentNumber:r});case 4:return u=t.sent,t.abrupt("return",[u]);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ug.Attribute,descriptor:{name:"a_Instance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap(),r=e.texture,i=n[r]||{x:0,y:0},o=i.x,a=i.y;return[o,a]}}})}}]),n}(Bx);function DS(t){var e=NS();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function NS(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var zS='#extension GL_OES_standard_derivatives : enable\n\nvarying vec4 v_color;\n\n\n// line texture\n\n#pragma include "picking"\n\nvoid main() {\ngl_FragColor = v_color;\ngl_FragColor = filterColor(gl_FragColor);\n}\n',FS='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec4 a_Instance;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n#pragma include "picking"\nvarying vec4 v_color;\nuniform float u_gap_width: 1.0;\nuniform float u_stroke_width: 1.0;\nuniform float u_stroke_opacity: 1.0;\n\n\nvoid main() {\n\n// #ifdef USE_ATTRIBUTE_OPACITY\n//   float opacity  = a_Opacity;\n// #else\n//   float opacity = u_opacity;\n// #endif\n\n\n// #ifdef USE_ATTRIBUTE_OFFSETS\n//   vec2 offsets  = a_Offsets;\n// #else\n//   vec2 offsets = u_offsets;\n// #endif\n\n  // float opacity = u_opacity;\n// 透明度计算\n  vec2 source = a_Instance.rg;  // 起始点\n  vec2 target =  a_Instance.ba; // 终点\n  vec2 flowlineDir = normalize(target - source);\n  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x);\n\n\n  vec2 position = mix(source, target, a_Position.x);\n\n  float lengthCommon = length(target - source);    \n  vec2 offsetDistances = a_Size.x * project_pixel(a_Position.yz);\n  vec2 limitedOffsetDistances = clamp(   \n   offsetDistances,\n    -lengthCommon*.8, lengthCommon*.8\n  );\n\n  float startOffsetCommon = project_pixel(offsets[0]);\n  float endOffsetCommon = project_pixel(offsets[1]);\n  float endpointOffset = mix(\n    clamp(startOffsetCommon, 0.0, lengthCommon*.2),\n    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),\n    a_Position.x\n  );\n\n  vec2 normalsCommon =  u_stroke_width * project_pixel(a_Normal.xy);\n\n  float gapCommon =  project_pixel(u_gap_width);\n  vec3 offsetCommon = vec3(\n    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -\n    perpendicularDir * (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),\n    0.0\n  );\n\n\n  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));\n\n  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);\n  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offsetCommon.xy, 0., 1.0);\n  } else {\n     gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offsetCommon.xy, 0., 1.0));\n  }\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',BS=function(t){Yt(n,t);var e=DS(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.gapWidth,n=void 0===e?2:e,r=t.strokeWidth,i=void 0===r?1:r,o=t.stroke,a=void 0===o?"#000":o,s=t.strokeOpacity,u=void 0===s?1:s;return(0,k.Z)({u_gap_width:n,u_stroke_width:i,u_stroke:bi(a),u_stroke_opacity:u},this.getStyleAttribute())}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:FS,fragmentShader:zS,inject:this.getInject(),triangulation:kw,primitive:vf.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ug.Attribute,descriptor:{name:"a_Instance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}})}}]),n}(Bx);function US(t){var e=jS();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function jS(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ZS='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nuniform float u_opacity;\nuniform float u_textureBlend;\nuniform float u_blur : 0.9;\nuniform float u_line_type: 0.0;\n// varying vec2 v_normal;\nvarying vec4 v_dash_array;\nvarying float v_distance_ratio;\nvarying vec4 v_color;\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\nuniform float u_line_texture: 0.0;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float segmentNumber;\n\nvarying vec2 v_iconMapUV;\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nvarying vec4 v_line_data;\n\n#pragma include "picking"\n#pragma include "project"\n#pragma include "projection"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0;\n  float d_segmentIndex = v_line_data.g;\n  \n  // 设置弧线的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));\n  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));\n  gl_FragColor.a *= opacity;\n  if(u_line_type == LineTypeDash) {\n    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n      // 实线部分\n    } else {\n      // 虚线部分\n      discard;\n    };\n  }\n\n  // 设置弧线的动画模式\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  // 设置弧线的贴图\n  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { \n    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));\n    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);\n    float count = v_line_data.b; // 贴图在弧线上重复的数量\n    float u = fract(arcRadio * count - animateSpeed * count);\n    // float u = fract(arcRadio * count - animateSpeed);\n    if(u_animate.x == Animate) {\n      u = gl_FragColor.a/opacity;\n    }\n\n    float v = v_line_data.a; // 线图层贴图部分的 v 坐标值\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n    \n    // 设置贴图和底色的叠加模式\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  // gl_FragColor = filterColor(gl_FragColor);\n}',VS='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n#define LineTexture 1.0\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec4 a_Instance;\nattribute float a_Size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float segmentNumber;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nvarying vec4 v_color;\n\nvarying float v_distance_ratio;\nuniform float u_line_type: 0.0;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\nvarying vec4 v_dash_array;\n\nuniform float u_icon_step: 100;\nuniform float u_line_texture: 0.0;\n\nattribute vec2 a_iconMapUV;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_line_data;\n\n\n#pragma include "projection"\n#pragma include "project"\n#pragma include "picking"\n\nfloat maps (float value, float start1, float stop1, float start2, float stop2) {\n    return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));\n}\n\nfloat getSegmentRatio(float index) {\n    return index / (segmentNumber - 1.);\n}\n\nfloat paraboloid(vec2 source, vec2 target, float ratio) {\n    vec2 x = mix(source, target, ratio);\n    vec2 center = mix(source, target, 0.5);\n    float dSourceCenter = distance(source, center);\n    float dXCenter = distance(x, center);\n    return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);\n}\n\nvec3 getPos(vec2 source, vec2 target, float segmentRatio) {\n     float vertex_height = paraboloid(source, target, segmentRatio);\n\n    return vec3(\n    mix(source, target, segmentRatio),\n    sqrt(max(0.0, vertex_height))\n    );\n}\nvec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;\n  return offset;\n}\nvec2 getNormal(vec2 line_clipspace, float offset_direction) {\n  // normalized direction of the line\n  vec2 dir_screenspace = normalize(line_clipspace);\n  // rotate by 90 degrees\n   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);\n   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);\n}\nfloat getAngularDist (vec2 source, vec2 target) {\n  vec2 delta = source - target;\n  vec2 sin_half_delta = sin(delta / 2.0);\n  float a =\n    sin_half_delta.y * sin_half_delta.y +\n    cos(source.y) * cos(target.y) *\n    sin_half_delta.x * sin_half_delta.x;\n  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));\n}\n\nvec2 midPoint(vec2 source, vec2 target) {\n  vec2 center = target - source;\n  float r = length(center);\n  float theta = atan(center.y, center.x);\n  float thetaOffset = 0.314;\n  float r2 = r / 2.0 / cos(thetaOffset);\n  float theta2 = theta + thetaOffset;\n  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);\n  return mid;\n}\nfloat bezier3(vec3 arr, float t) {\n  float ut = 1. - t;\n  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;\n}\n\nvec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {\n  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    vec2 mid = midPoint(source, target);\n    vec3 x = vec3(source.x, mid.x, target.x);\n    vec3 y = vec3(source.y, mid.y, target.y);\n    return vec2(bezier3(x ,t), bezier3(y,t));\n  }else {\n    if(abs(angularDist - PI) < 0.001) {\n      return (1.0 - t) * source + t * target;\n    }\n    float a = sin((1.0 - t) * angularDist) / sin(angularDist);\n    float b = sin(t * angularDist) / sin(angularDist);\n    vec2 sin_source = sin(source);\n    vec2 cos_source = cos(source);\n    vec2 sin_target = sin(target);\n    vec2 cos_target = cos(target);\n    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;\n    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;\n    float z = a * sin_source.y + b * sin_target.y;\n    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));\n  }\n}\n\nvoid main() {\n  \n\n  v_color = a_Color;\n  vec2 source = radians(a_Instance.rg);\n  vec2 target = radians(a_Instance.ba);\n  float angularDist = getAngularDist(source, target);\n  float segmentIndex = a_Position.x;\n  float segmentRatio = getSegmentRatio(segmentIndex);\n  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));\n\n  if(u_line_type == LineTypeDash) {\n    v_distance_ratio = segmentIndex / segmentNumber;\n    vec2 s = source;\n    vec2 t = target;\n    \n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      s = unProjCustomCoord(source);\n      t = unProjCustomCoord(target);\n    }\n    float total_Distance = pixelDistance(s, t) / 2.0 * PI;\n    total_Distance = total_Distance*16.0; // total_Distance*16.0 调整默认的效果\n    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;\n  }\n\n  if(u_animate.x == Animate) {\n      v_distance_ratio = segmentIndex / segmentNumber;\n  }\n\n  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);\n  v_distance_ratio = segmentIndex / segmentNumber;\n  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));\n  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));\n  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);\n  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));\n  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n\nv_line_data.g = a_Position.x; // 该顶点在弧线上的分段排序\n  if(LineTexture == u_line_texture) { // 开启贴图模式  \n    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;\n    float d_arcDistrance = length(source - target);\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap\n      d_arcDistrance = d_arcDistrance * 1000000.0;\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox\n      d_arcDistrance = project_pixel_allmap(d_arcDistrance);\n    }\n    float d_pixelLen = project_pixel(u_icon_step)/8.0;\nv_line_data.b = floor(d_arcDistrance/d_pixelLen); // 贴图在弧线上重复的数量\n\n    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // 线横向偏移的距离\n    float linePixelSize = project_pixel(a_Size);  // 定点位置偏移，按地图等级缩放后的距离\nv_line_data.a = lineOffsetWidth/linePixelSize;  // 线图层贴图部分的 v 坐标值\n\n    v_iconMapUV = a_iconMapUV;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(curr.xy + offset, curr.z, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));\n  }\n  setPickingColor(a_PickingColor);\n}\n\n',GS={solid:0,dash:1},HS=function(t){Yt(n,t);var e=US(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:vf.NEAREST,min:vf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,c=t.dashArray,l=void 0===c?[10,5]:c,h=t.lineTexture,f=void 0!==h&&h,p=t.iconStep,d=void 0===p?100:p,v=t.segmentNumber,m=void 0===v?30:v;2===l.length&&l.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var g=0,y=[0,0,0,0],_=[0,0,0,0];return r&&i&&(y=bi(r),_=bi(i),g=1),{u_opacity:n,u_textureBlend:"normal"===a?0:1,segmentNumber:m,u_line_type:GS[u]||0,u_dash_array:l,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:g,u_sourceColor:y,u_targetColor:_}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:VS,fragmentShader:ZS,triangulation:Bw,depth:{enable:!1}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Ug.Attribute,descriptor:{name:"a_Instance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:4,update:function(t,e,n){return[n[3],n[4],n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap(),r=e.texture,i=n[r]||{x:0,y:0},o=i.x,a=i.y;return[o,a]}}})}}]),n}(Bx);function WS(t){var e=qS();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function qS(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var XS='#define LineTypeSolid 0.0\nvarying vec4 v_color;\n\n// dash\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动\n\n// [animate, duration, interval, trailLength],\nvoid main() {\n\n  gl_FragColor = v_color;\n\n \n  float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);\n  if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {\n    // 实线部分\n  } else {\n    // 虚线部分\n    discard;\n  };\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',YS='#define LineTypeSolid 0.0\n#define LineTypeDash 1.0\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_dash_array: [10.0, 5., 0, 0];\n\nuniform float u_vertexScale: 1.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\nvarying vec4 v_dash_array;\nvarying float v_d_distance_ratio;\n\nuniform float u_opacity: 1.0;\n\nvoid main() {\n\n  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  vec2 offset = project_pixel(size.xy);\n  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, project_pixel(a_Size.y), 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n \n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',KS='#extension GL_OES_standard_derivatives : enable\n#define Animate 0.0\n#define LineTexture 1.0\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\n\nuniform float u_borderWidth: 0.0;\n\nuniform vec3 u_blur;\nuniform vec4 u_borderColor;\nvarying vec4 v_color;\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nvarying vec2 v_iconMapUV;\nvarying vec4 v_texture_data;\n\n\n#pragma include "picking"\n\nuniform float u_time;\nuniform vec4 u_animate: [ 1, 2., 1.0, 0.2 ]; // 控制运动\n// [animate, duration, interval, trailLength],\nvoid main() {\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_texture_data.r; // 当前点位距离占线总长的比例\n  gl_FragColor = v_color;\n  // anti-alias\n  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));\n  gl_FragColor.a *= u_opacity; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_texture_data.g;      // 当前顶点的距离\n    float d_texPixelLen = v_texture_data.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_texture_data.a;  // 线图层贴图部分的 v 坐标值\n\n    // v = max(smoothstep(0.95, 1.0, v), v);\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n     vec4 pattern = texture2D(u_texture, uv);\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor += pattern;\n    } else { // replace\n        pattern.a *= u_opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = pattern;\n    }\n  } \n\n  float v = v_texture_data.a;\n  float borderWidth = min(0.5, u_borderWidth);\n  // 绘制 border\n  if(borderWidth > 0.01) {\n    float borderOuterWidth = borderWidth / 2.0;\n\n\n    if(v >= 1.0 - borderWidth || v <= borderWidth) {\n      if(v > borderWidth) { // 外侧\n        float linear = smoothstep(0.0, 1.0, (v - (1.0 - borderWidth))/borderWidth);\n        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);\n        gl_FragColor.rgb = mix(gl_FragColor.rgb, u_borderColor.rgb, linear);\n      } else if(v <= borderWidth) {\n        float linear = smoothstep(0.0, 1.0, v/borderWidth);\n        gl_FragColor.rgb = mix(u_borderColor.rgb, gl_FragColor.rgb, linear);\n      }\n    }\n\n    if(v < borderOuterWidth) {\n      gl_FragColor.a = mix(0.0, gl_FragColor.a, v/borderOuterWidth);\n    } else if(v > 1.0 - borderOuterWidth) {\n      gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);\n    }\n  }\n\n  // blur\n  float blurV = v_texture_data.a;\n  if(blurV < 0.5) {\n    gl_FragColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);\n  } else {\n    gl_FragColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);\n  }\n  \n  gl_FragColor = filterColor(gl_FragColor);\n}\n',QS='\n#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\nattribute vec2 a_iconMapUV;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvarying vec4 v_color;\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\n\n\nuniform float u_linearColor: 0;\nuniform float u_arrow: 0.0;\nuniform float u_arrowHeight: 3.0;\nuniform float u_arrowWidth: 2.0;\nuniform float u_tailWidth: 1.0;\n\nvarying vec4 v_texture_data;\n\nvec2 calculateArrow(vec2 offset) {\n  /*\n  * 在支持箭头的时候，第二、第三组顶点是额外插入用于构建顶点的\n  */\n  float arrowFlag = -1.0;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    // 高德 2.0 的旋转角度不同\n    arrowFlag = 1.0;\n  }\n  float pi = arrowFlag * 3.1415926/2.;\n  if(a_Miter < 0.) {\n    // 根据线的两侧偏移不同、旋转的方向相反\n    pi = -pi;\n  }\n  highp float angle_sin = sin(pi);\n  highp float angle_cos = cos(pi);\n  // 计算垂直与线方向的旋转矩阵\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float arrowWidth = u_arrowWidth;\n  float arrowHeight = u_arrowHeight;\n\n  vec2 arrowOffset = vec2(0.0);\n  /*\n  * a_DistanceAndIndex.y 用于标记当前顶点属于哪一组（两个顶点一组，构成线的其实是矩形，最简需要四个顶点、两组顶点构成）\n  */\n  if(a_DistanceAndIndex.y == 0.0) {\n    // 箭头尖部\n    offset = vec2(0.0);\n  } else if(a_DistanceAndIndex.y == 1.0) {\n    // 箭头两侧\n    arrowOffset = rotation_matrix*(offset * arrowHeight);\n    offset += arrowOffset; // 沿线偏移\n    offset = offset * arrowWidth; // 垂直线向外偏移（是构建箭头两侧的顶点）\n  } else if(a_DistanceAndIndex.y == 2.0 || a_DistanceAndIndex.y == 3.0 || a_DistanceAndIndex.y == 4.0) {\n    // 偏移其余的点位（将长度让位给箭头）\n    arrowOffset = rotation_matrix*(offset * arrowHeight) * arrowWidth;\n    offset += arrowOffset;// 沿线偏移\n  }\n\n  return offset;\n}\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  \n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  d_texPixelLen = project_float_pixel(u_icon_step);\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  v_color = a_Color;\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n  if(u_arrow > 0.0) {\n      //  计算箭头\n    offset = calculateArrow(offset);\n\n    if(a_DistanceAndIndex.y > 4.0) {\n      offset *= mix(1.0, u_tailWidth, currentLinePointRatio);\n    }\n  }\n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n  \n  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);\n  // 设置数据集的参数\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',JS='varying vec4 v_color;\nvarying vec4 v_texture_data;\nuniform float u_linearDir: 1.0;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity: 1.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n  float linearRadio = v_texture_data.r; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    linearRadio = v_texture_data.a;\n  }\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, linearRadio);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= u_opacity; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',$S={solid:0,dash:1},tA=function(t){Yt(n,t);var e=WS(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"textureEventFlag",!1),(0,Ft.Z)(Kt(t),"texture",t.createTexture2D({data:[0,0,0,0],mag:vf.NEAREST,min:vf.NEAREST,premultiplyAlpha:!1,width:1,height:1})),(0,Ft.Z)(Kt(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:vf.NEAREST,min:vf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.lineType,u=void 0===s?"solid":s,c=t.dashArray,l=void 0===c?[10,5,0,0]:c,h=t.lineTexture,f=void 0!==h&&h,p=t.iconStep,d=void 0===p?100:p,v=t.vertexHeightScale,m=void 0===v?20:v,g=t.borderWidth,y=void 0===g?0:g,_=t.borderColor,x=void 0===_?"#ccc":_,b=t.raisingHeight,w=void 0===b?0:b,E=t.heightfixed,S=void 0!==E&&E,A=t.linearDir,T=void 0===A?jx.VERTICAL:A,C=t.blur,k=void 0===C?[1,1,1]:C,M=t.arrow,P=void 0===M?{enable:!1,arrowWidth:2,arrowHeight:3,tailWidth:1}:M;2===l.length&&l.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var I=0,R=[0,0,0,0],L=[0,0,0,0];return r&&i&&(R=bi(r),L=bi(i),I=1),{u_opacity:(0,Oi.isNumber)(n)?n:1,u_textureBlend:a===Zx.NORMAL?0:1,u_line_type:$S[u],u_dash_array:l,u_blur:k,u_texture:this.texture,u_line_texture:f?1:0,u_icon_step:d,u_textSize:[1024,this.iconService.canvasHeight||128],u_borderWidth:y,u_borderColor:bi(x),u_linearDir:T===jx.VERTICAL?1:0,u_linearColor:I,u_sourceColor:R,u_targetColor:L,u_heightfixed:Number(S),u_vertexScale:m,u_raisingHeight:Number(w),u_arrow:Number(P.enable),u_arrowHeight:P.arrowHeight||3,u_arrowWidth:P.arrowWidth||2,u_tailWidth:void 0===P.tailWidth?1:P.tailWidth}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.depth,r=void 0!==n&&n,i=this.getShaders(),o=i.frag,a=i.vert,s=i.type,this.layer.triangulation=Cu,t.next=5,this.layer.buildLayerModel({moduleName:"line"+s,vertexShader:a,fragmentShader:o,triangulation:Cu,depth:{enable:r}});case 5:return u=t.sent,t.abrupt("return",[u]);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor,r=t.lineType;return"dash"===r?{frag:XS,vert:YS,type:"Dash"}:e&&n?{frag:JS,vert:QS,type:"Linear"}:{frag:KS,vert:QS,type:""}}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Ug.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ug.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ug.Attribute,descriptor:{name:"a_Miter",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap(),r=e.texture,i=n[r]||{x:0,y:0},o=i.x,a=i.y;return[o,a]}}})}}]),n}(Bx);function eA(t){var e=nA();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function nA(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var rA='\nvarying vec4 v_Color;\n#pragma include "picking"\nvoid main() {\n\n  gl_FragColor = v_Color; // 全局透明度\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',iA='\nattribute float a_Miter;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\n\n// dash line\nattribute float a_Total_Distance;\nattribute vec2 a_DistanceAndIndex;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0;\nuniform float u_vertexScale: 1.0;\nuniform float u_raisingHeight: 0.0;\nuniform float u_opacity : 1.0;\nuniform sampler2D u_texture;\nuniform float u_linearDir: 1.0;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n\n\n  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);\n  \n  vec2 offset = project_pixel(size.xy);\n\n  float lineDistance = a_DistanceAndIndex.x;\n  float currentLinePointRatio = lineDistance / a_Total_Distance;\n \n\n  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // 线横向偏移的距离（向两侧偏移的和）\n  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // 定点位置偏移，按地图等级缩放后的距离 单侧 * 2\n  float texV = lineOffsetWidth/linePixelSize; // 线图层贴图部分的 v 坐标值\n\n  float linearRadio =currentLinePointRatio; // 当前点位距离占线总长的比例\n  if(u_linearDir < 1.0) {\n    linearRadio = texV;\n  }\n\n  v_Color = texture2D(u_texture, vec2(linearRadio, 0.5));\n\n  v_Color.a *= u_opacity; // 全局透明度\n\n\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况 vertex height\n  float lineHeight = a_Size.y; // size 第二个参数代表的高度 [linewidth, lineheight]\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    lineHeight *= 0.2; // 保持和 amap/mapbox 一致的效果\n    h *= 0.2;\n    if(u_heightfixed < 1.0) {\n      lineHeight = project_pixel(a_Size.y);\n    }\n    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));\n  } else {\n    // mapbox -  amap\n    \n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // mapbox\n      // 保持高度相对不变\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      h *= mapboxZoomScale;\n      h += u_raisingHeight * mapboxZoomScale;\n      if(u_heightfixed > 0.0) {\n        lineHeight *= mapboxZoomScale;\n      }\n      \n    } else {\n      // amap\n      h += u_raisingHeight;\n      // lineHeight 顶点偏移高度\n      if(u_heightfixed < 1.0) {\n        lineHeight *= pow(2.0, 20.0 - u_Zoom);\n      }\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',oA=function(t){Yt(n,t);var e=eA(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;t.colorTexture&&t.colorTexture.destroy();var n=t.layer.getLayerConfig(),r=n.rampColors,i=Si(r);t.colorTexture=e({data:new Uint8Array(i.data),width:i.width,height:i.height,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE,min:vf.NEAREST,mag:vf.NEAREST,flipY:!1})})),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.vertexHeightScale,i=void 0===r?20:r,o=t.raisingHeight,a=void 0===o?0:o,s=t.heightfixed,u=void 0!==s&&s,c=t.linearDir,l=void 0===c?jx.VERTICAL:c;return this.rendererService.getDirty()&&this.colorTexture.bind(),{u_linearDir:l===jx.VERTICAL?1:0,u_opacity:(0,Oi.isNumber)(n)?n:1,u_texture:this.colorTexture,u_heightfixed:Number(u),u_vertexScale:i,u_raisingHeight:Number(a)}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.updateTexture(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.colorTexture)||void 0===t||t.destroy()}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.depth,r=void 0!==n&&n,this.layer.triangulation=Cw,t.next=4,this.layer.buildLayerModel({moduleName:"lineRampColors",vertexShader:iA,fragmentShader:rA,triangulation:Cw,depth:{enable:r}});case 4:return i=t.sent,t.abrupt("return",[i]);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Ug.Attribute,descriptor:{name:"a_DistanceAndIndex",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n,r,i,o){return void 0===o?[n[3],10]:[n[3],o]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ug.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ug.Attribute,descriptor:{name:"a_Miter",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}})}}]),n}(Bx);function aA(t){var e=sA();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function sA(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var uA="\nvarying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n\n}\n",cA="uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float opacity;\nvoid main() {\n  gl_FragColor = mix(u_sourceColor, u_targetColor, v_distanceScale);\n  gl_FragColor.a *= opacity; // 全局透明度\n}\n",lA='attribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Position;\n\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_opacity: 1.0;\nuniform float u_vertexScale: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\n\n\n#pragma include "projection"\n\nvarying vec4 v_color;\nvarying float v_distanceScale;\n\nvoid main() {\n\n  v_color = a_Color; \n  v_distanceScale = a_Distance / a_Total_Distance;\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity); \n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float h = float(a_Position.z) * u_vertexScale; // 线顶点的高度 - 兼容不存在第三个数值的情况\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_Size.y) + h * 0.2, 1.0));\n  } else {\n    float lineHeight = a_Size.y;\n    // 兼容 mapbox 在线高度上的效果表现基本一致\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      // 保持高度相对不变\n      h *= 2.0/pow(2.0, 20.0 - u_Zoom);\n    }\n\n    // #define COORDINATE_SYSTEM_P20 5.0\n    // #define COORDINATE_SYSTEM_P20_OFFSET 6.0\n    // amap1.x\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // 保持高度相对不变\n      lineHeight *= pow(2.0, 20.0 - u_Zoom);\n    }\n\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));\n    gl_PointSize = 10.0;\n  }\n}\n',hA=function(t){Yt(n,t);var e=aA(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.vertexHeightScale,a=void 0===o?20:o,s=0,u=[0,0,0,0],c=[0,0,0,0];return r&&i&&(u=bi(r),c=bi(i),s=1),{u_opacity:(0,Oi.isNumber)(n)?n:1,u_linearColor:s,u_sourceColor:u,u_targetColor:c,u_vertexScale:a}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.sourceColor,n=t.targetColor;return e&&n?{frag:cA,vert:lA,type:"lineSimpleLinear"}:{frag:uA,vert:lA,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getShaders(),n=e.frag,r=e.vert,i=e.type,t.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,triangulation:Mw,primitive:vf.LINES,depth:{enable:!1},pick:!1});case 3:return o=t.sent,t.abrupt("return",[o]);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"distance",type:Ug.Attribute,descriptor:{name:"a_Distance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t,e,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ug.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}})}}]),n}(Bx);function fA(t){var e=pA();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function pA(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var dA='#define Animate 0.0\n#define LineTexture 1.0\n\n// line texture\nuniform float u_line_texture;\nuniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacity : 1.0;\nuniform float u_textureBlend;\nuniform float u_iconStepCount;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ]; // 控制运动\n\nvarying vec2 v_iconMapUV;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_color;\nvarying vec4 v_dataset;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float animateSpeed = 0.0; // 运动速度\n  float d_distance_ratio = v_dataset.r; // 当前点位距离占线总长的比例\n  float v = v_dataset.a;\n\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    gl_FragColor = mix(u_sourceColor, u_targetColor, v);\n  } else { // 使用 color 方法传入的颜色\n     gl_FragColor = v_color;\n  }\n\n  gl_FragColor.a *= opacity; // 全局透明度\n  if(u_animate.x == Animate) {\n      animateSpeed = u_time / u_animate.y;\n       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);\n      alpha = (alpha + u_animate.w -1.0) / u_animate.w;\n      alpha = smoothstep(0., 1., alpha);\n      gl_FragColor.a *= alpha;\n  }\n\n  if(u_line_texture == LineTexture) { // while load texture\n    float aDistance = v_dataset.g;      // 当前顶点的距离\n    float d_texPixelLen = v_dataset.b;  // 贴图的像素长度，根据地图层级缩放\n    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);\n    float v = v_dataset.a;  // 线图层贴图部分的 v 坐标值\n\n    // 计算纹理间隔 start\n    float flag = 0.0;\n    if(u > 1.0/u_iconStepCount) {\n      flag = 1.0;\n    }\n    u = fract(u*u_iconStepCount);\n    // 计算纹理间隔 end\n\n    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;\n    vec4 pattern = texture2D(u_texture, uv);\n\n    // Tip: 判断纹理间隔\n    if(flag > 0.0) {\n      pattern = vec4(0.0);\n    }\n\n    if(u_textureBlend == 0.0) { // normal\n      pattern.a = 0.0;\n      gl_FragColor = filterColor(gl_FragColor + pattern);\n    } else { // replace\n        pattern.a *= opacity;\n        if(gl_FragColor.a <= 0.0) {\n          pattern.a = 0.0;\n        }\n        gl_FragColor = filterColor(pattern);\n    }\n  }\n  \n\n  // blur - AA\n  if(v < v_blur) {\n    gl_FragColor.a = mix(0.0, gl_FragColor.a, v/v_blur);\n  } else if(v > 1.0 - v_blur) {\n    gl_FragColor.a = mix(gl_FragColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',vA='#define Animate 0.0\n\nattribute float a_Miter;\nattribute vec4 a_Color;\nattribute vec2 a_Size;\nattribute vec3 a_Normal;\nattribute vec3 a_Position;\nattribute vec2 a_iconMapUV;\nattribute float a_Total_Distance;\nattribute float a_Distance;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\nuniform float u_icon_step: 100;\nuniform float u_heightfixed;\nuniform float u_linearColor: 0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\n// texV 线图层 - 贴图部分的 v 坐标（线的宽度方向）\nvarying vec2 v_iconMapUV;\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_radio;\nvarying vec4 v_dataset;\n\nvoid main() {\n\n\n  float d_distance_ratio; // 当前点位距离占线总长的比例\n  float d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n\n  v_iconMapUV = a_iconMapUV;\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    d_texPixelLen = project_pixel(u_icon_step);\n  } else {\n    d_texPixelLen = u_icon_step;\n  }\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n    d_texPixelLen *= 10.0;\n  }\n\n  if(u_animate.x == Animate || u_linearColor == 1.0) {\n      d_distance_ratio = a_Distance / a_Total_Distance;\n  }\n\n  float miter = (a_Miter + 1.0)/2.0;\n  // 设置数据集的参数\n  v_dataset[0] = d_distance_ratio; // 当前点位距离占线总长的比例\n  v_dataset[1] = a_Distance;       // 当前顶点的距离\n  v_dataset[2] = d_texPixelLen;    // 贴图的像素长度，根据地图层级缩放\n  v_dataset[3] = miter;          // 线图层贴图部分的 v 坐标值 0 - 1\n\n  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));\n\n  float originSize = a_Size.x;  // 固定高度\n  if(u_heightfixed < 1.0) {     // 高度随 zoom 调整\n    originSize = project_float_pixel(a_Size.x);\n  }\n\n  float wallHeight = originSize * miter;\n  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));\n\n  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);\n  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',mA=function(t){Yt(n,t);var e=fA(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas()}),void t.layer.render();t.texture=e({data:t.iconService.getCanvas(),mag:vf.NEAREST,min:vf.NEAREST,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128})})),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.sourceColor,i=t.targetColor,o=t.textureBlend,a=void 0===o?"normal":o,s=t.heightfixed,u=void 0!==s&&s,c=t.lineTexture,l=void 0!==c&&c,h=t.iconStep,f=void 0===h?100:h,p=t.iconStepCount,d=void 0===p?1:p;this.rendererService.getDirty()&&this.texture.bind();var v=0,m=[0,0,0,0],g=[0,0,0,0];return r&&i&&(m=bi(r),g=bi(i),v=1),{u_heightfixed:Number(u),u_opacity:(0,Oi.isNumber)(n)?n:1,u_textureBlend:"normal"===a?0:1,u_texture:this.texture,u_line_texture:l?1:0,u_iconStepCount:d,u_icon_step:f,u_textSize:[1024,this.iconService.canvasHeight||128],u_linearColor:v,u_sourceColor:m,u_targetColor:g}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption;return{u_animate:this.animateOption2Array(e),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:vA,fragmentShader:dA,triangulation:Cw,depth:{enable:!1},blend:this.getBlend()});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Ug.Attribute,descriptor:{name:"a_Distance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t,e,n){return[n[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Ug.Attribute,descriptor:{name:"a_Total_Distance",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t,e,n){return[n[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0],n[1]]:[n,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Ug.Attribute,descriptor:{name:"a_Miter",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t,e,n){return[n[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_iconMapUV",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap(),r=e.texture,i=n[r]||{x:0,y:0},o=i.x,a=i.y;return[o,a]}}})}}]),n}(Bx),gA={arc:yS,arc3d:TS,greatcircle:HS,wall:mA,line:tA,simple:hA,linearline:oA,earthArc3d:OS,flowline:BS},yA=gA;function _A(t){var e=xA();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function xA(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var bA=function(t){Yt(n,t);var e=_A(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","LineLayer"),(0,Ft.Z)(Kt(t),"enableEncodeStyles",["opacity","offsets","stroke"]),(0,Ft.Z)(Kt(t),"arrowInsertCount",0),(0,Ft.Z)(Kt(t),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new yA[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),e={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{}};return e[t]}},{key:"getModelType",value:function(){var t;if(this.layerType)return this.layerType;var e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null===e||void 0===e||null===(t=e.scale)||void 0===t?void 0:t.field;return n||"line"}},{key:"processData",value:function(t){if("simple"!==this.getModelType())return t;var e=[];return t.map((function(t){if(Array.isArray(t.coordinates)&&Array.isArray(t.coordinates[0])&&Array.isArray(t.coordinates[0][0])){var n=(0,k.Z)({},t);t.coordinates.map((function(t){e.push((0,k.Z)((0,k.Z)({},n),{},{coordinates:t}))}))}else e.push(t)})),e}}]),n}(Dx);function wA(t){var e=EA();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function EA(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var SA='varying vec4 v_color;\nuniform float u_opacity: 1.0;\n\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nuniform float u_linearColor: 0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\n\nuniform float u_opacitylinear: 0.0;\nuniform float u_opacitylinear_dir: 1.0;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\nvoid main() {\n\n   gl_FragColor = v_color;\n\n  // 开启透明度渐变\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;\n  }\n\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',AA='precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_globel;\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n// 用于将在顶点着色器中计算好的样式值传递给片元\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n  \n  float textureOffset = 0.0; // 在 cell 中取值的偏移量\n\n  textureOffset = opacityAndOffset.g;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec3 size = a_Size * a_Position;\n\n  // a_Position.z 是在构建网格的时候传入的标准值 0 - 1，在插值器插值可以获取 0～1 线性渐变的值\n  v_barLinearZ =  a_Position.z;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // 圆柱光照效果\n  float lightWeight = 1.0;\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n  v_lightWeight = lightWeight;\n  // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, barLinearZ);\n    v_color.rgb *= lightWeight;\n  } else { // 使用 color 方法传入的颜色\n     v_color = a_Color;\n  }\n  v_color.a *= u_opacity;\n\n    \n  // 在地球模式下，将原本垂直于 xy 平面的圆柱调整姿态到适应圆的角度\n  //旋转矩阵mx，创建绕x轴旋转矩阵\n  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);\n  float xRadian = getXRadian(a_Pos.y, r);\n  float xcos = cos(xRadian);//求解旋转角度余弦值\n  float xsin = sin(xRadian);//求解旋转角度正弦值\n  mat4 mx = mat4(\n    1,0,0,0,  \n    0,xcos,-xsin,0,  \n    0,xsin,xcos,0,  \n    0,0,0,1);\n\n  //旋转矩阵my，创建绕y轴旋转矩阵\n  float yRadian = getYRadian(a_Pos.x, a_Pos.z);\n  float ycos = cos(yRadian);//求解旋转角度余弦值\n  float ysin = sin(yRadian);//求解旋转角度正弦值\n  mat4 my = mat4(\n    ycos,0,-ysin,0,  \n    0,1,0,0,  \n    ysin,0,ycos,0,  \n    0,0,0,1);\n\n  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);\n  \n\n  setPickingColor(a_PickingColor);\n}\n',TA=function(t){Yt(n,t);var e=wA(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"raiseCount",0),(0,Ft.Z)(Kt(t),"raiseRepeat",0),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1,speed:.01,repeat:!1}:e,r=t.opacity,i=void 0===r?1:r,o=t.sourceColor,a=t.targetColor,s=t.pickLight,u=void 0!==s&&s,c=t.heightfixed,l=void 0!==c&&c,h=t.opacityLinear,f=void 0===h?{enable:!1,dir:"up"}:h,p=t.lightEnable,d=void 0===p||p,v=0,m=[0,0,0,0],g=[0,0,0,0];if(o&&a&&(m=bi(o),g=bi(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(l),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:(0,Oi.isNumber)(i)?i:1,u_linearColor:v,u_sourceColor:m,u_targetColor:g,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:"up"===f.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.animateOption.repeat,r=void 0===n?1:n,this.raiseRepeat=r,t.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:AA,fragmentShader:SA,triangulation:Aw,depth:{enable:!0},cull:{enable:!0,face:Ri(this.mapService.version)},blend:this.getBlend()});case 4:return i=t.sent,t.abrupt("return",[i]);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t){var e=t.size;if(e){var n=[];return Array.isArray(e)&&(n=2===e.length?[e[0],e[0],e[1]]:e),Array.isArray(e)||(n=[e,e,e]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ug.Attribute,descriptor:{name:"a_Pos",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t){var e=Yo(t.coordinates);return Qb([e[0],e[1]])}}})}}]),n}(Bx);function CA(t){var e=kA();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function kA(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var MA="uniform float u_additive;\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n\n  vec4 strokeColor = textrueStroke == vec4(0) ? v_color : textrueStroke;\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + strokeWidth);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  if(outer_df > antialiasblur + 0.018) discard;\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = strokeWidth < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(strokeWidth < 0.01) {\n    gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n  } else {\n    gl_FragColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), u_stroke_color * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",PA='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\n\nuniform float u_opacity : 1;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\nuniform vec2 u_offsets;\n\nuniform float u_blur : 0.0;\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n  // radius(16-bit)\n  v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);\n\n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + u_offsets, 1.0);\n\n  setPickingColor(a_PickingColor);\n}\n',IA=function(t){Yt(n,t);var e=CA(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.strokeOpacity,i=void 0===r?1:r,o=t.strokeWidth,a=void 0===o?0:o,s=t.stroke,u=void 0===s?"rgba(0,0,0,0)":s,c=t.blend,l=t.blur,h=void 0===l?0:l;return{u_blur:h,u_additive:"additive"===c?1:0,u_opacity:n,u_stroke_opacity:i,u_stroke_width:a,u_stroke_color:bi(u)}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(n),u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.layer.triangulation=Sw,t.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:PA,fragmentShader:MA,triangulation:Sw,depth:{enable:!0},blend:this.getBlend()});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ug.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r){var i=(0,Li.Z)(n,3),o=i[0],a=i[1],s=i[2],u=nb(0,0,1),c=nb(o,0,s),l=o>=0?Ob(u,c):2*Math.PI-Ob(u,c),h=2*Math.PI-Math.asin(a/100),f=cl();Sl(f,f,l),El(f,f,h);var p=nb(1,1,0);kb(p,p,f),bb(p,p);var d=nb(-1,1,0);kb(d,d,f),bb(d,d);var v=nb(-1,-1,0);kb(v,v,f),bb(v,v);var m=nb(1,-1,0);kb(m,m,f),bb(m,m);var g=[].concat((0,C.Z)(p),(0,C.Z)(d),(0,C.Z)(v),(0,C.Z)(m)),y=r%4*3;return[g[y],g[y+1],g[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ug.Attribute,descriptor:{name:"a_Shape",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(e){var n=e.shape,r=void 0===n?2:n,i=t.layer.getLayerConfig().shape2d,o=i.indexOf(r);return[o]}}})}}]),n}(Bx);function RA(t){var e=LA();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function LA(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var OA='varying vec4 v_color;\nvarying float v_lightWeight;\nuniform float u_pickLight: 0.0;\n\n#pragma include "picking"\n\n\nvoid main() {\n\n  gl_FragColor = v_color;\n  // 开启透明度渐变\n  // picking\n  if(u_pickLight > 0.0) {\n    gl_FragColor = filterColorAlpha(gl_FragColor, v_lightWeight);\n  } else {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n',DA='precision highp float;\n\n#define pi 3.1415926535\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec3 a_Position;\nattribute vec3 a_Pos;\nattribute vec4 a_Color;\nattribute vec3 a_Size;\nattribute vec3 a_Normal;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_r;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nvarying vec4 v_color;\nvarying float v_lightWeight;\nvarying float v_barLinearZ;\n\nuniform float u_opacity : 1;\nuniform float u_lightEnable: 1;\nuniform float u_opacitylinear: 0.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_opacitylinear_dir: 1.0;\nuniform float  u_linearColor: 0.0;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nfloat getYRadian(float x, float z) {\n  if(x > 0.0 && z > 0.0) {\n    return atan(x/z);\n  } else if(x > 0.0 && z <= 0.0){\n    return atan(-z/x) + pi/2.0;\n  } else if(x <= 0.0 && z <= 0.0) {\n    return  pi + atan(x/z); //atan(x/z) + \n  } else {\n    return atan(z/-x) + pi*3.0/2.0;\n  }\n}\n\nfloat getXRadian(float y, float r) {\n  return atan(y/r);\n}\n\nvoid main() {\n\n\n  vec3 size = a_Size * a_Position;\n\n  vec3 offset = size; // 控制圆柱体的大小 - 从标准单位圆柱体进行偏移\n\n  if(u_heightfixed < 1.0) { // 圆柱体不固定高度\n    \n    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {\n      // P20 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减1\n      offset = offset * pow(2.0, (19.0 - u_Zoom));\n    }\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {\n      // P20_2 坐标系下，为了和 Web 墨卡托坐标系统一，zoom 默认减3\n      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));\n    }\n  } else {// 圆柱体固定高度 （ 处理 mapbox ）\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);\n    }\n  }\n\n\n  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));\n\n  // u_r 控制圆柱的生长\n  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);\n\n  // // 圆柱光照效果\n  float lightWeight = 1.0;\n\n  if(u_lightEnable > 0.0) { // 取消三元表达式，增强健壮性\n    lightWeight = calc_lighting(pos);\n  }\n\n  v_lightWeight = lightWeight;\n\n  v_color = a_Color;\n\n    // 设置圆柱的底色\n  if(u_linearColor == 1.0) { // 使用渐变颜色\n    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);\n    v_color.a =  v_color.a * u_opacity;\n  } else {\n    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * u_opacity);\n  }\n\n    if(u_opacitylinear > 0.0) {\n    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;\n  }\n\n\n  // gl_Position = project_common_position_to_clipspace(pos);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * pos;\n  } else {\n    gl_Position = project_common_position_to_clipspace(pos);\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',NA=function(t){Yt(n,t);var e=RA(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"raiseCount",0),(0,Ft.Z)(Kt(t),"raiseRepeat",0),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1,speed:.01,repeat:!1}:e,r=t.opacity,i=void 0===r?1:r,o=t.sourceColor,a=t.targetColor,s=t.pickLight,u=void 0!==s&&s,c=t.heightfixed,l=void 0!==c&&c,h=t.opacityLinear,f=void 0===h?{enable:!1,dir:"up"}:h,p=t.lightEnable,d=void 0===p||p,v=0,m=[0,0,0,0],g=[0,0,0,0];if(o&&a&&(m=bi(o),g=bi(a),v=1),this.raiseCount<1&&this.raiseRepeat>0&&n.enable){var y=n.speed,_=void 0===y?.01:y;this.raiseCount+=_,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}return{u_pickLight:Number(u),u_heightfixed:Number(l),u_r:n.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:i,u_linearColor:v,u_sourceColor:m,u_targetColor:g,u_opacitylinear:Number(f.enable),u_opacitylinear_dir:"up"===f.dir?1:0,u_lightEnable:Number(d)}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.depth,r=void 0===n||n,i=e.animateOption.repeat,o=void 0===i?1:i,this.raiseRepeat=o,t.next=4,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:DA,fragmentShader:OA,triangulation:Aw,cull:{enable:!0,face:Ri(this.mapService.version)},depth:{enable:r}});case 4:return a=t.sent,t.abrupt("return",[a]);case 6:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t){var e=t.size;if(e){var n=[];return Array.isArray(e)&&(n=2===e.length?[e[0],e[0],e[1]]:e),Array.isArray(e)||(n=[e,e,e]),n}return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Ug.Attribute,descriptor:{name:"a_Pos",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t){var e=Yo(t.coordinates);return[e[0],e[1],0]}}})}}]),n}(Bx);function zA(t){var e=FA();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function FA(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var BA="\nuniform float u_additive;\n\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nuniform float u_time;\nuniform vec4 u_animate: [ 1., 2., 1.0, 0.2 ];\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  \n  outer_df = sdCircle(v_data.xy, 1.0);\n  inner_df = sdCircle(v_data.xy, r);\n\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n  float PI = 3.14159;\n  float N_RINGS = 3.0;\n  float FREQ = 1.0;\n\n  gl_FragColor = v_color;\n\n  float d = length(v_data.xy);\n  if(d > 0.5) {\n    discard;\n  }\n  float intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);\n  \n  // 根据叠加模式选择效果\n  if(u_additive > 0.0) {\n    gl_FragColor *= intensity;\n    // 优化水波点 blend additive 模式下有的拾取效果 \n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor = vec4(gl_FragColor.xyz, gl_FragColor.a * intensity);\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n}\n",UA="uniform float u_additive;\nuniform float u_stroke_opacity : 1;\nuniform float u_stroke_width : 2;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n\n\n#pragma include \"sdf_2d\"\n#pragma include \"picking\"\n\n\nvoid main() {\n  int shape = int(floor(v_data.w + 0.5));\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius + u_stroke_width);\n\n  float outer_df;\n  float inner_df;\n  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'\n  if (shape == 0) {\n    outer_df = sdCircle(v_data.xy, 1.0);\n    inner_df = sdCircle(v_data.xy, r);\n  } else if (shape == 1) {\n    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);\n    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);\n  } else if (shape == 2) {\n    outer_df = sdBox(v_data.xy, vec2(1.));\n    inner_df = sdBox(v_data.xy, vec2(r));\n  } else if (shape == 3) {\n    outer_df = sdPentagon(v_data.xy, 0.8);\n    inner_df = sdPentagon(v_data.xy, r * 0.8);\n  } else if (shape == 4) {\n    outer_df = sdHexagon(v_data.xy, 0.8);\n    inner_df = sdHexagon(v_data.xy, r * 0.8);\n  } else if (shape == 5) {\n    outer_df = sdOctogon(v_data.xy, 1.0);\n    inner_df = sdOctogon(v_data.xy, r);\n  } else if (shape == 6) {\n    outer_df = sdHexagram(v_data.xy, 0.52);\n    inner_df = sdHexagram(v_data.xy, r * 0.52);\n  } else if (shape == 7) {\n    outer_df = sdRhombus(v_data.xy, vec2(1.0));\n    inner_df = sdRhombus(v_data.xy, vec2(r));\n  } else if (shape == 8) {\n    outer_df = sdVesica(v_data.xy, 1.1, 0.8);\n    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);\n  }\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(\n    antialiasblur,\n    0.0,\n    inner_df\n  );\n\n  if(u_stroke_width < 0.01) {\n    gl_FragColor = v_color;\n  } else {\n    gl_FragColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);\n  }\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n    gl_FragColor = filterColorAlpha(gl_FragColor, gl_FragColor.a);\n  } else {\n    gl_FragColor.a *= opacity_t;\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n   // 作为 mask 模板时需要丢弃透明的像素\n  if(gl_FragColor.a < 0.01) {\n    discard;\n  } \n}\n",jA='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute float a_Shape;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec4 v_stroke;\n\n// uniform float u_opacity : 1;\nuniform float u_stroke_width: 2;\nuniform vec3 u_blur_height_fixed: [0, 0, 0];\n\n\n#pragma include "projection"\n#pragma include "picking"\n\n\nvoid main() {\n  // 透明度计算\n  v_stroke = stroke;  \n  vec3 extrude = a_Extrude;\n  float shape_type = a_Shape;\n  /*\n  *  setPickingSize 设置拾取大小\n  *  u_meter2coord 在等面积大小的时候设置单位\n  */\n  float newSize = setPickingSize(a_Size);\n  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;\n\n\n\n  // unpack color(vec2)\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n   v_radius = newSize;\n\n  // anti-alias\n  //  float antialiased_blur = -max(u_blur, antialiasblur);\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);\n\n  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n  \n  // TODP: /abs(extrude.x) 是为了兼容地球模式\n  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);\n\n\n  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n\n  float raisingHeight = u_blur_height_fixed.y;\n\n  if(u_blur_height_fixed.z < 1.0) { // false\n    raisingHeight = project_pixel(u_blur_height_fixed.y);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;\n    }\n  }\n \n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position =  u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',ZA=function(t){Yt(n,t);var e=zA(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.strokeOpacity,n=void 0===e?1:e,r=t.strokeWidth,i=void 0===r?0:r,o=t.blend,a=t.blur,s=void 0===a?0:a,u=t.raisingHeight,c=void 0===u?0:u,l=t.heightfixed,h=void 0!==l&&l,f=t.unit,p=void 0===f?"pixel":f;return(0,k.Z)({u_blur_height_fixed:[s,Number(c),Number(h)],u_additive:"additive"===o?1:0,u_stroke_opacity:n,u_stroke_width:i,u_size_unit:Vx[p]},this.getStyleAttribute())}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(n),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),ku)}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.animateOption,r=void 0===n?{enable:!1}:n,i=this.getShaders(r),o=i.frag,a=i.vert,s=i.type,this.layer.triangulation=ku,t.next=5,this.layer.buildLayerModel({moduleName:s,vertexShader:a,fragmentShader:o,inject:this.getInject(),triangulation:ku,depth:{enable:!1}});case 5:return u=t.sent,t.abrupt("return",[u]);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getShaders",value:function(t){if(!t.enable)return{frag:UA,vert:jA,type:"pointFill"};switch(t.type){case"wave":return{frag:BA,vert:jA,type:"pointWave"};default:return{frag:BA,vert:jA,type:"pointWave"}}}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ug.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Ug.Attribute,descriptor:{name:"a_Shape",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(e){var n=e.shape,r=void 0===n?2:n,i=t.indexOf(r);return[i]}}})}}]),n}(Bx);function VA(t){var e=GA();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function GA(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var HA='uniform sampler2D u_texture;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "sdf_2d"\n#pragma include "picking"\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv;\n\nvoid main() {\n\n  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;\n  gl_FragColor = texture2D(u_texture, pos);\n  gl_FragColor.a *= u_opacity;\n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',WA='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nattribute vec2 a_Uv;\nattribute float a_Rotate;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform mat2 u_RotateMatrix;\nuniform int u_size_unit;\n\nvarying vec2 v_uv; // 本身的 uv 坐标\nvarying vec2 v_Iconuv; // icon 贴图的 uv 坐标\n\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  v_uv = (a_Extrude.xy + 1.0)/2.0;\n  v_uv.y = 1.0 - v_uv.y;\n  v_Iconuv = a_Uv;\n\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  float newSize = a_Size;\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n\n  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);\n  vec2 offset = (rotation_matrix * u_RotateMatrix * extrude.xy * (newSize) + u_offsets);\n  vec3 aPosition = a_Position;\n\n  offset = project_pixel(offset);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // height fixed\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp *vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n \n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));\n\n  setPickingColor(a_PickingColor);\n}\n',qA=function(t){Yt(n,t);var e=VA(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"meter2coord",1),(0,Ft.Z)(Kt(t),"isMeter",!1),(0,Ft.Z)(Kt(t),"radian",0),(0,Ft.Z)(Kt(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void t.layerService.throttleRenderLayers();t.texture=e({data:t.iconService.getCanvas(),mag:vf.LINEAR,min:vf.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,i=void 0===r?[0,0]:r,o=t.rotation,a=t.raisingHeight,s=void 0===a?0:a,u=t.heightfixed,c=void 0!==u&&u,l=t.unit,h=void 0===l?"pixel":l;this.rendererService.getDirty()&&this.texture.bind();var f=1;return"GAODE2.x"!==this.mapService.version&&"GAODE1.x"!==this.mapService.version||(f=-1),this.radian=void 0!==o?f*Math.PI*o/180:f*Math.PI*(this.mapService.getRotation()%360)/180,{u_raisingHeight:Number(s),u_heightfixed:Number(c),u_size_unit:Vx[h],u_RotateMatrix:new Float32Array([Math.cos(this.radian),Math.sin(this.radian),-Math.sin(this.radian),Math.cos(this.radian)]),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ew)}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:WA,fragmentShader:HA,triangulation:Ew,depth:{enable:!1},cull:{enable:!0,face:Ri(this.mapService.version)}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;this.iconService.off("imageUpdate",this.updateTexture),null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Ug.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.rotate,n=void 0===e?0:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap(),r=e.shape,i=n[r]||{x:-64,y:-64},o=i.x,a=i.y;return[o,a]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ug.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),n}(Bx);function XA(t){var e=YA();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function YA(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var KA='\nuniform sampler2D u_texture;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform vec2 u_textSize;\nuniform float u_opacity : 1;\n\n#pragma include "picking"\n\nvoid main(){\n      vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;\n      vec4 textureColor;\n\n      // Y = 0.299R + 0.587G + 0.114B // 亮度提取\n     \n      textureColor = texture2D(u_texture, pos);\n\n      // Tip: 去除边缘部分 mipmap 导致的混合变暗\n      float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);\n      if(fragmengTocenter >= 0.5) {\n            float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;\n            textureColor.a *= luma;\n      }\n      \n      \n\n      if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){\n            gl_FragColor= textureColor;\n      }else {\n            gl_FragColor= step(0.01, textureColor.z) * v_color;\n      }\n\n      gl_FragColor.a = gl_FragColor.a * u_opacity;\n      \n      if (gl_FragColor.a < 0.01) {\n         discard;\n      }\n      gl_FragColor = filterColor(gl_FragColor);\n}\n',QA='precision highp float;\nattribute vec3 a_Position;\nattribute vec4 a_Color;\nattribute vec2 a_Uv;\nattribute float a_Size;\nvarying vec4 v_color;\nvarying vec2 v_uv;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec2 u_offsets;\n\nuniform float u_opacity : 1;\nuniform float u_raisingHeight: 0.0;\nuniform float u_heightfixed: 0.0;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n\n  // cal style mapping - 数据纹理映射部分的计算\n  v_color = a_Color;\n  v_uv = a_Uv;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n  vec2 offset = project_pixel(u_offsets);\n\n  float raisingHeight = u_raisingHeight;\n  if(u_heightfixed < 1.0) { // false\n    raisingHeight = project_pixel(u_raisingHeight);\n  } else {\n     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      raisingHeight = u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(project_pos.xy + offset, raisingHeight, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, raisingHeight, 1.0));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n',JA=function(t){Yt(n,t);var e=XA(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"updateTexture",(function(){var e=t.rendererService.createTexture2D;if(t.texture)return t.texture.update({data:t.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),void setTimeout((function(){t.layerService.throttleRenderLayers()}));t.texture=e({data:t.iconService.getCanvas(),mag:vf.LINEAR,min:vf.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:t.iconService.canvasHeight||128,mipmap:!0})})),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,i=void 0===r?[0,0]:r,o=t.raisingHeight,a=void 0===o?0:o,s=t.heightfixed,u=void 0!==s&&s;return this.rendererService.getDirty()&&this.texture.bind(),{u_raisingHeight:Number(a),u_heightfixed:Number(u),u_texture:this.texture,u_textSize:[1024,this.iconService.canvasHeight||128],u_opacity:n,u_offsets:i}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:QA,fragmentShader:KA,triangulation:Tw,depth:{enable:!1},primitive:vf.POINTS});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var t=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(e){var n=t.iconService.getIconMap(),r=e.shape,i=n[r]||{x:-64,y:-64},o=i.x,a=i.y;return[o,a]}}})}}]),n}(Bx);function $A(t){var e=tT();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function tT(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var eT="varying vec4 v_color;\nvoid main() {\n  gl_FragColor = v_color;\n}\n",nT='\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform float u_opacity : 1;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\n\nvarying vec4 v_color;\n\n#pragma include "projection"\n#pragma include "project"\n\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy, a_Position.z, 1.0);\n  } else {\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n}\n';function rT(t){var e=t.coordinates;return{vertices:(0,C.Z)(e),indices:[0],size:e.length}}var iT=function(t){Yt(n,t);var e=$A(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e;return{u_opacity:(0,Oi.isNumber)(n)?n:1}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.layer.triangulation=rT,t.next=3,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:nT,fragmentShader:eT,triangulation:rT,depth:{enable:!1},primitive:vf.POINTS,pick:!1});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),n}(Bx);function oT(t){var e=aT();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function aT(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var sT='\nuniform float u_additive;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n#pragma include "sdf_2d"\n#pragma include "picking"\n\nvoid main() {\n\n  lowp float antialiasblur = v_data.z;\n  float r = v_radius / (v_radius);\n\n  float outer_df = sdCircle(v_data.xy, 1.0);\n  float inner_df = sdCircle(v_data.xy, r);\n\n  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);\n\n  gl_FragColor = vec4(v_color.rgb, v_color.a * u_opacity);\n\n  if(u_additive > 0.0) {\n    gl_FragColor *= opacity_t;\n  } else {\n    gl_FragColor.a *= opacity_t;\n  }\n\n  if(gl_FragColor.a > 0.0) {\n    gl_FragColor = filterColor(gl_FragColor);\n  }\n\n  vec2 extrude =  v_exteude;\n  vec2 dir = normalize(extrude);\n  vec2 baseDir = vec2(1.0, 0.0);\n  float pi = 3.14159265359;\n  // full circle\n  // float rades = dot(dir, baseDir);\n  // float flag = sign(dir.y);\n  // float radar_v = (flag - 1.0) * -0.5 + flag * acos(rades)/pi/2.0;\n  \n  // half circle\n  float flag = sign(dir.y);\n  float rades = dot(dir, baseDir);\n  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;\n  // simple AA\n  if(radar_v > 0.99) {\n    radar_v = 1.0 - (radar_v - 0.99)/0.01;\n  }\n\n  gl_FragColor.a *= radar_v;\n}\n',uT='attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Extrude;\nattribute float a_Size;\nuniform float u_speed: 1.0;\nuniform float u_time;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform int u_size_unit;\n\nvarying vec4 v_data;\nvarying vec4 v_color;\nvarying float v_radius;\nvarying vec2 v_exteude;\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  vec3 extrude = a_Extrude;\n  float newSize = setPickingSize(a_Size);\n\n  float time = u_time * u_speed;\n  mat2 rotateMatrix = mat2( \n    cos(time), sin(time), \n    -sin(time), cos(time)\n  );\n  v_exteude = rotateMatrix * a_Extrude.xy;\n\n  // unpack color(vec2)\n  v_color = a_Color;\n\n\n\n  // anti-alias\n  float blur = 0.0;\n  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);\n\n  if(u_size_unit == 1) {\n    newSize = newSize  * u_PixelsPerMeter.z;\n  }\n  // radius(16-bit)\n  v_radius = newSize;\n\n  vec2 offset = (extrude.xy * (newSize));\n  vec3 aPosition = a_Position;\n  \n    // 不以米为实际单位\n  offset = project_pixel(offset);\n  \n  v_data = vec4(extrude.x, extrude.y, antialiasblur, -1.0);\n\n  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp *vec4(project_pos.xy + offset, 0.0, 1.0);\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n',cT=function(t){Yt(n,t);var e=oT(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.blend,i=t.speed,o=void 0===i?1:i,a=t.unit,s=void 0===a?"pixel":a;return{u_size_unit:Vx[s],u_speed:o,u_additive:"additive"===r?1:0,u_opacity:n}}},{key:"getAnimateUniforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=void 0===e?{enable:!1}:e;return{u_animate:this.animateOption2Array(n),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Ew)}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:uT,fragmentShader:sT,triangulation:Ew,depth:{enable:!1}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.speed||1,t.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Ug.Attribute,descriptor:{name:"a_Extrude",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r){var i=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],o=r%4*3;return[i[o],i[o+1],i[o+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?5:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),n}(Bx);function lT(t){var e=hT();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function hT(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var fT='\nuniform float u_additive;\nuniform float u_stroke_opacity : 1;\n\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\nvarying vec4 v_color;\nvarying float v_blur;\nvarying float v_innerRadius;\n\n#pragma include "picking"\nvoid main() {\n  vec2 center = vec2(0.5);\n\n  // Tip: 片元到中心点的距离 0 - 1\n  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;\n  // Tip: 片元的剪切成圆形\n  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);\n\n\n  if(v_innerRadius < 0.99) {\n    // 当存在 stroke 且 stroke > 0.01\n    float blurWidth = (1.0 - v_blur)/2.0;\n    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);\n    if(fragmengTocenter > v_innerRadius + blurWidth) {\n      gl_FragColor = stroke;\n    } else if(fragmengTocenter > v_innerRadius - blurWidth){\n      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);\n      gl_FragColor = mix(v_color, stroke, mixR);\n    } else {\n      gl_FragColor = v_color;\n    }\n  } else {\n    // 当不存在 stroke 或 stroke <= 0.01\n    gl_FragColor = v_color;\n  }\n\n  gl_FragColor = filterColor(gl_FragColor);\n  \n  if(u_additive > 0.0) {\n    gl_FragColor *= circleClipOpacity;\n  } else {\n    gl_FragColor.a *= circleClipOpacity;\n  }\n\n}\n',pT='\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute float a_Size;\nattribute vec4 a_Color;\nvarying vec4 v_color;\n\nuniform float u_opacity : 1;\nuniform vec2 u_offsets;\nuniform float u_stroke_width;\n\nvarying float v_blur;\nvarying float v_innerRadius;\n\n\n\n#pragma include "projection"\n#pragma include "picking"\n#pragma include "project"\nvoid main() {\n  v_color = vec4(a_Color.xyz, a_Color.w * u_opacity);\n  v_blur = 1.0 - max(2.0/a_Size, 0.05);\n  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);\n  \n  vec2 offset = project_pixel(u_offsets);\n  \n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);\n  } else { // else\n    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);\n    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));\n  }\n\n  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;\n  setPickingColor(a_PickingColor);\n}\n';function dT(t){var e=t.coordinates;return{vertices:(0,C.Z)(e),indices:[0],size:e.length}}var vT=function(t){Yt(n,t);var e=lT(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.offsets,i=void 0===r?[0,0]:r,o=t.blend,a=t.strokeOpacity,s=void 0===a?1:a,u=t.strokeWidth,c=void 0===u?0:u,l=t.stroke,h=void 0===l?"#fff":l;return{u_additive:"additive"===o?1:0,u_opacity:n,u_offsets:i,u_stroke_opacity:s,u_stroke_width:c,u_stroke_color:bi(h)}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.layer.triangulation=dT,t.next=3,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:pT,fragmentShader:fT,triangulation:dT,depth:{enable:!1},primitive:vf.POINTS});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}})}}]),n}(Bx);function mT(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=gT(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function gT(t,e){if(t){if("string"===typeof t)return yT(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?yT(t,e):void 0}}function yT(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var _T=function(){function t(e,n,r){Ot(this,t),(0,Ft.Z)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(n/r);for(var o=0;o<this.xCellCount*this.yCellCount;o++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=e,this.height=n,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/n,this.boxUid=0}return zt(t,[{key:"insert",value:function(t,e,n,r,i){this.forEachCell(e,n,r,i,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}},{key:"query",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!1,i)}},{key:"hitTest",value:function(t,e,n,r,i){return this.queryHitTest(t,e,n,r,!0,i)}},{key:"insertBoxCell",value:function(t,e,n,r,i,o){this.boxCells[i].push(o)}},{key:"queryHitTest",value:function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});return o?a.filter(o):a}var u={hitTest:i,seenUids:{box:{},circle:{}}};return this.forEachCell(t,e,n,r,this.queryCell,a,u,o),i?a.length>0:a}},{key:"queryCell",value:function(t,e,n,r,i,o,a,s){var u=a.seenUids,c=this.boxCells[i];if(null!==c){var l,h=this.bboxes,f=mT(c);try{for(f.s();!(l=f.n()).done;){var p=l.value;if(!u.box[p]){u.box[p]=!0;var d=4*p;if(t<=h[d+2]&&e<=h[d+3]&&n>=h[d+0]&&r>=h[d+1]&&(!s||s(this.boxKeys[p]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:h[d],y1:h[d+1],x2:h[d+2],y2:h[d+3]})}}}}catch(v){f.e(v)}finally{f.f()}}return!1}},{key:"forEachCell",value:function(t,e,n,r,i,o,a,s){for(var u=this.convertToXCellCoord(t),c=this.convertToYCellCoord(e),l=this.convertToXCellCoord(n),h=this.convertToYCellCoord(r),f=u;f<=l;f++)for(var p=c;p<=h;p++){var d=this.xCellCount*p+f;if(i.call(this,t,e,n,r,d,o,a,s))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),t}(),xT=_T,bT=function(){function t(e,n){Ot(this,t),(0,Ft.Z)(this,"viewportPadding",100),this.width=e,this.height=n,this.viewportPadding=Math.max(e,n),this.grid=new xT(e+this.viewportPadding,n+this.viewportPadding,25),this.screenRightBoundary=e+this.viewportPadding,this.screenBottomBoundary=n+this.viewportPadding,this.gridRightBoundary=e+2*this.viewportPadding,this.gridBottomBoundary=n+2*this.viewportPadding}return zt(t,[{key:"placeCollisionBox",value:function(t){var e=t.x1+t.anchorPointX+this.viewportPadding,n=t.y1+t.anchorPointY+this.viewportPadding,r=t.x2+t.anchorPointX+this.viewportPadding,i=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(e,n,r,i)||this.grid.hitTest(e,n,r,i)?{box:[]}:{box:[e,n,r,i]}}},{key:"insertCollisionBox",value:function(t,e){var n={featureIndex:e};this.grid.insert(n,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,e,n){var r=zh(e,n,0,1),i=Nh(),a=fl.apply(o,(0,C.Z)(t));return Bh(i,r,a),{x:(i[0]/i[3]+1)/2*this.width+this.viewportPadding,y:(-i[1]/i[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}}]),t}();function wT(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=ET(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function ET(t,e){if(t){if("string"===typeof t)return ST(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ST(t,e):void 0}}function ST(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function AT(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0;break;default:e=.5}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0;break;default:n=.5}return{horizontalAlign:e,verticalAlign:n}}function TT(t,e,n,r,i){if(i){var o=t[r],a=o.glyph;if(a)for(var s=e[a].advance*o.scale,u=(t[r].x+s)*i,c=n;c<=r;c++)t[c].x-=u}}function CT(t,e,n,r,i,o,a){var s,u=(e-n)*i,c=(-r*a+.5)*o,l=wT(t);try{for(l.s();!(s=l.n()).done;){var h=s.value;h.x+=u,h.y+=c}}catch(f){l.e(f)}finally{l.f()}}function kT(t,e,n,r,i,o,a){var s=-8,u=0,c=s,l=0,h=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,p=h.length;n.forEach((function(t){if(t.split("").forEach((function(t){var n=e[t],r=0;n&&(h.push({glyph:t,x:u,y:c+r,vertical:!1,scale:1,metrics:n}),u+=n.advance+a)})),h.length!==p){var n=u-a;l=Math.max(n,l),TT(h,e,p,h.length-1,f)}u=0,c-=r+5}));var d=AT(i),v=d.horizontalAlign,m=d.verticalAlign;CT(h,f,v,m,l,r,n.length);var g=c-s;t.top+=-m*g,t.bottom=t.top-g,t.left+=-v*l,t.right=t.left+l}function MT(t,e,n,r,i,o,a){var s=-8,u=0,c=s,l=0,h=t.positionedGlyphs,f="right"===o?1:"left"===o?0:.5,p=h.length;n.forEach((function(t){var n=e[t],i=0;if(n&&(h.push({glyph:t,x:n.advance/2,y:c+i,vertical:!1,scale:1,metrics:n}),u+=n.advance+a),h.length!==p){var o=u-a;l=Math.max(o,l),TT(h,e,p,h.length-1,f)}u=0,c-=r+5}));var d=AT(i),v=d.horizontalAlign,m=d.verticalAlign;CT(h,f,v,m,l,r,n.length);var g=c-s;t.top+=-m*g,t.bottom=t.top-g,t.left+=-v*l,t.right=t.left+l}function PT(t,e,n,r,i,o){var a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:[0,0],s=arguments.length>7?arguments[7]:void 0,u=t.split("\n"),c=[],l={positionedGlyphs:c,top:a[1],bottom:a[1],left:a[0],right:a[0],lineCount:u.length,text:t};return s?MT(l,e,u,n,r,i,o):kT(l,e,u,n,r,i,o),!!c.length&&l}function IT(t){var e,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[0,0],r=arguments.length>2?arguments[2]:void 0,i=t.positionedGlyphs,o=void 0===i?[]:i,a=[],s=wT(o);try{for(s.s();!(e=s.n()).done;){var u=e.value,c=u.metrics,l=4,h=c.advance*u.scale/2,f=r?[u.x+h,u.y]:[0,0],p=r?[0,0]:[u.x+h+n[0],u.y+n[1]],d=(0-l)*u.scale-h+p[0],v=(0-l)*u.scale+p[1],m=d+c.width*u.scale,g=v+c.height*u.scale,y={x:d,y:v},_={x:m,y:v},x={x:d,y:g},b={x:m,y:g};a.push({tl:y,tr:_,bl:x,br:b,tex:c,glyphOffset:f})}}catch(w){s.e(w)}finally{s.f()}return a}function RT(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=LT(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function LT(t,e){if(t){if("string"===typeof t)return OT(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?OT(t,e):void 0}}function OT(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function DT(t){var e=NT();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function NT(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var zT='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 48.0\nuniform sampler2D u_sdf_map;\nuniform float u_gamma_scale : 0.5;\nuniform float u_stroke_width : 2.0;\nuniform float u_halo_blur : 0.5;\nuniform float u_DevicePixelRatio;\n\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying float v_fontScale;\n\n\n#pragma include "picking"\nvoid main() {\n  // get style data mapping\n\n  // get sdf from atlas\n  float dist = texture2D(u_sdf_map, v_uv).a;\n\n  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;\n  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;\n\n  highp float gamma_scaled = gamma * v_gamma_scale;\n\n  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);\n\n  gl_FragColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));\n\n  gl_FragColor.a *= alpha;\n   // 作为 mask 模板时需要丢弃透明的像素\n  if (gl_FragColor.a < 0.01) {\n    discard;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',FT='#define SDF_PX 8.0\n#define EDGE_GAMMA 0.105\n#define FONT_SIZE 24.0\nattribute vec3 a_Position;\nattribute vec2 a_tex;\nattribute vec2 a_textOffsets;\nattribute vec4 a_Color;\nattribute float a_Size;\nattribute float a_Rotate;\n\nuniform vec2 u_sdf_map_size;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_uv;\nvarying float v_gamma_scale;\nvarying vec4 v_color;\nvarying vec4 v_stroke_color;\nvarying float v_fontScale;\n// uniform float u_opacity : 1;\nuniform float u_stroke_width : 2;\nuniform vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n  \n  v_uv = a_tex / u_sdf_map_size;\n\n\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);\n\n  // 文本缩放比例\n  float fontScale = a_Size / FONT_SIZE;\n  v_fontScale = fontScale;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  highp float angle_sin = sin(a_Rotate);\n  highp float angle_cos = cos(a_Rotate);\n  mat2 rotation_matrix = mat2(angle_cos, -1.0 * angle_sin, angle_sin, angle_cos);\n  \n  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n\n  float raiseHeight = u_raisingHeight;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    raiseHeight = u_raisingHeight * mapboxZoomScale;\n  }\n\n  vec4 projected_position;\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n   projected_position  = u_Mvp *(vec4(a_Position.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  } else { // else\n   projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));\n  }\n\n  gl_Position = vec4(\n    projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);\n  v_gamma_scale = gl_Position.w;\n  setPickingColor(a_PickingColor);\n\n}\n';function BT(t){var e=this,n=t.id,r=[],i=[];if(!e.glyphInfoMap||!e.glyphInfoMap[n])return{vertices:[],indices:[],size:7};var o=e.glyphInfoMap[n].centroid,a=2===o.length?[o[0],o[1],0]:o;return e.glyphInfoMap[n].glyphQuads.forEach((function(t,e){r.push.apply(r,(0,C.Z)(a).concat([t.tex.x,t.tex.y+t.tex.height,t.tl.x,t.tl.y],(0,C.Z)(a),[t.tex.x+t.tex.width,t.tex.y+t.tex.height,t.tr.x,t.tr.y],(0,C.Z)(a),[t.tex.x+t.tex.width,t.tex.y,t.br.x,t.br.y],(0,C.Z)(a),[t.tex.x,t.tex.y,t.bl.x,t.bl.y])),i.push(0+4*e,1+4*e,2+4*e,2+4*e,3+4*e,0+4*e)})),{vertices:r,indices:i,size:7}}var UT=function(t){Yt(n,t);var e=DT(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"glyphInfoMap",{}),(0,Ft.Z)(Kt(t),"currentZoom",-1),(0,Ft.Z)(Kt(t),"textureHeight",0),(0,Ft.Z)(Kt(t),"textCount",0),(0,Ft.Z)(Kt(t),"preTextStyle",{}),(0,Ft.Z)(Kt(t),"mapping",(0,J.Z)(tt().mark((function e(){return tt().wrap((function(e){while(1)switch(e.prev=e.next){case 0:return t.initGlyph(),t.updateTexture(),e.next=4,t.reBuildModel();case 4:case"end":return e.stop()}}),e)})))),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=(t.opacity,t.stroke),n=void 0===e?"#fff":e,r=t.strokeWidth,i=void 0===r?0:r,o=t.halo,a=void 0===o?.5:o,s=t.gamma,u=void 0===s?2:s,c=t.raisingHeight,l=void 0===c?0:c,h=this.getFontServiceMapping(),f=this.getFontServiceCanvas();return h&&Object.keys(h).length!==this.textCount&&f&&(this.updateTexture(),this.textCount=Object.keys(h).length),this.preTextStyle=this.getTextStyle(),(0,k.Z)({u_raisingHeight:Number(l),u_stroke_width:i,u_stroke_color:bi(n),u_sdf_map:this.texture,u_halo_blur:a,u_gamma_scale:u,u_sdf_map_size:[(null===f||void 0===f?void 0:f.width)||1,(null===f||void 0===f?void 0:f.height)||1]},this.getStyleAttribute())}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),t.abrupt("return",this.buildModels());case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.textAllowOverlap,r=void 0!==n&&n,this.initGlyph(),this.updateTexture(),r||this.filterGlyphs(),t.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:FT,fragmentShader:zT,inject:this.getInject(),triangulation:BT.bind(this),depth:{enable:!1}});case 6:return i=t.sent,t.abrupt("return",[i]);case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"needUpdate",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l,h,f;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.getTextStyle(),n=e.textAllowOverlap,r=void 0!==n&&n,i=e.textAnchor,o=void 0===i?"center":i,a=e.textOffset,s=e.padding,u=e.fontFamily,c=e.fontWeight,(0,Oi.isEqual)(s,this.preTextStyle.padding)&&(0,Oi.isEqual)(a,this.preTextStyle.textOffset)&&(0,Oi.isEqual)(o,this.preTextStyle.textAnchor)&&(0,Oi.isEqual)(u,this.preTextStyle.fontFamily)&&(0,Oi.isEqual)(c,this.preTextStyle.fontWeight)){t.next=5;break}return t.next=4,this.mapping();case 4:return t.abrupt("return",!0);case 5:if(!r){t.next=7;break}return t.abrupt("return",!1);case 7:if(l=this.mapService.getZoom(),h=this.mapService.getBounds(),f=Uo(this.extent,h),!(Math.abs(this.currentZoom-l)>.5)&&f&&r===this.preTextStyle.textAllowOverlap){t.next=14;break}return t.next=13,this.reBuildModel();case 13:return t.abrupt("return",!0);case 14:return t.abrupt("return",!1);case 15:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"rotate",type:Ug.Attribute,descriptor:{name:"a_Rotate",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.rotate,n=void 0===e?0:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Ug.Attribute,descriptor:{name:"a_textOffsets",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[5],n[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?12:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Ug.Attribute,descriptor:{name:"a_tex",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var t=this.mapService.getBounds();return Bo(t,.5)}},{key:"initTextFont",value:function(){var t=this.getTextStyle(),e=t.fontWeight,n=t.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(t){var e=t.shape,n=void 0===e?"":e;n=n.toString();var r,o=RT(n);try{for(o.s();!(r=o.n()).done;){var a=r.value;-1===i.indexOf(a)&&i.push(a)}}catch(s){o.e(s)}finally{o.f()}})),this.fontService.setFontOptions({characterSet:i,fontWeight:e,fontFamily:n,iconfont:!1})}},{key:"initIconFontTex",value:function(){var t=this.getTextStyle(),e=t.fontWeight,n=t.fontFamily,r=this.rawEncodeData,i=[];r.forEach((function(t){var e=t.shape,n=void 0===e?"":e;n="".concat(n),-1===i.indexOf(n)&&i.push(n)})),this.fontService.setFontOptions({characterSet:i,fontWeight:e,fontFamily:n,iconfont:!0})}},{key:"getTextStyle",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r,o=t.textAllowOverlap,a=void 0!==o&&o,s=t.padding,u=void 0===s?[0,0]:s,c=t.textAnchor,l=void 0===c?"center":c,h=t.textOffset,f=void 0===h?[0,0]:h,p=t.opacity,d=void 0===p?1:p,v=t.strokeOpacity,m=void 0===v?1:v,g=t.strokeWidth,y=void 0===g?0:g,_=t.stroke,x=void 0===_?"#000":_;return{fontWeight:n,fontFamily:i,textAllowOverlap:a,padding:u,textAnchor:l,textOffset:f,opacity:d,strokeOpacity:m,strokeWidth:y,stroke:x}}},{key:"generateGlyphLayout",value:function(t){var e=this,n=this.getFontServiceMapping(),r=this.layer.getLayerConfig(),i=r.spacing,o=void 0===i?2:i,a=r.textAnchor,s=void 0===a?"center":a,u=r.textOffset,c=this.rawEncodeData;this.glyphInfo=c.map((function(r){var i=r.shape,a=void 0===i?"":i,c=r.id,l=r.size,h=void 0===l?1:l,f=PT(a.toString(),n,h,s,"left",o,u,t),p=IT(f,u,!1);return r.shaping=f,r.glyphQuads=p,r.centroid=Yo(r.coordinates),r.originCentroid="GAODE2.x"===r.version?Yo(r.originCoordinates):r.originCentroid=r.centroid,e.glyphInfoMap[c]={shaping:f,glyphQuads:p,centroid:Yo(r.coordinates)},r}))}},{key:"getFontServiceMapping",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getMappingByKey("".concat(i,"_").concat(n))}},{key:"getFontServiceCanvas",value:function(){var t=this.layer.getLayerConfig(),e=t.fontWeight,n=void 0===e?"400":e,r=t.fontFamily,i=void 0===r?"sans-serif":r;return this.fontService.getCanvasByKey("".concat(i,"_").concat(n))}},{key:"filterGlyphs",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.padding,r=void 0===n?[0,0]:n,i=e.textAllowOverlap,o=void 0!==i&&i;if(!o){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var a=this.rendererService.getViewportSize(),s=a.width,u=a.height,c=new bT(s,u),l=this.glyphInfo.filter((function(e){var n=e.shaping,i=e.id,o=void 0===i?0:i,a="GAODE2.x"===e.version?e.originCentroid:e.centroid,s=e.size,u=s/16,l=t.mapService.lngLatToContainer(a),h=c.placeCollisionBox({x1:n.left*u-r[0],x2:n.right*u+r[0],y1:n.top*u-r[1],y2:n.bottom*u+r[1],anchorPointX:l.x,anchorPointY:l.y}),f=h.box;return!(!f||!f.length)&&(c.insertCollisionBox(f,o),!0)}));l.forEach((function(e){t.glyphInfoMap[e.id]=e}))}}},{key:"initGlyph",value:function(){var t=this.layer.getLayerConfig(),e=t.iconfont,n=void 0!==e&&e;n?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(n)}},{key:"updateTexture",value:function(){var t=this.rendererService.createTexture2D,e=this.getFontServiceCanvas();this.textureHeight=e.height,this.texture&&this.texture.destroy(),this.texture=t({data:e,mag:vf.LINEAR,min:vf.LINEAR,width:e.width,height:e.height})}},{key:"reBuildModel",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.filterGlyphs(),t.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:FT,fragmentShader:zT,triangulation:BT.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:e=t.sent,this.layer.models=[e];case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}]),n}(Bx),jT={fillImage:qA,fill:ZA,radar:cT,image:JA,normal:iT,simplePoint:vT,extrude:NA,text:UT,earthFill:IA,earthExtrude:TA},ZT=jT;function VT(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=GT(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function GT(t,e){if(t){if("string"===typeof t)return HT(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?HT(t,e):void 0}}function HT(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function WT(t){var e=qT();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function qT(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var XT=function(t){Yt(n,t);var e=WT(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","PointLayer"),(0,Ft.Z)(Kt(t),"enableEncodeStyles",["opacity","offsets","stroke"]),(0,Ft.Z)(Kt(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new ZT[e](this),t.next=5,this.initLayerModels();case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"rebuildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.buildModels();case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var t=this.shapeOption,e=t.field,n=t.values,r=this.getLayerConfig(),i=r.shape2d,o=this.iconService.getIconMap();if(e&&-1!==(null===i||void 0===i?void 0:i.indexOf(e)))return"fill";if("text"===n)return"text";if(n&&n instanceof Array){var a,s=VT(n);try{for(s.s();!(a=s.n()).done;){var u=a.value;if("string"===typeof u&&o.hasOwnProperty(u))return"image"}}catch(c){s.e(c)}finally{s.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),e={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return e[t]}},{key:"getModelType",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find((function(t){return t.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"normal":"simple"===a?"simplePoint":"radar"===a?"radar":"fillImage"===this.layerType?"fillImage":-1!==(null===n||void 0===n?void 0:n.indexOf(a))?"GLOBEL"===this.mapService.version?"earthFill":"fill":-1!==(null===r||void 0===r?void 0:r.indexOf(a))?"GLOBEL"===this.mapService.version?"earthExtrude":"extrude":i.hasOwnProperty(a)?"image":"text"}return this.getModelTypeWillEmptyData()}}]),n}(Dx);function YT(t){var e=KT();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function KT(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var QT='uniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\n\n#pragma include "picking"\n\nvoid main() {\n\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = v_Color;\n  \n\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',JT='precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  float isSide = a_Position.z;\n float topU = a_uvs[0];\n float topV = 1.0 - a_uvs[1];\n float sidey = a_uvs[2];\n\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    // if(u_sidesurface < 1.0) {\n    //   discard;\n    // }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      v_Color = linearColor;\n    } else {\n      v_Color = a_Color;\n    }\n\n  } else {\n    v_Color = a_Color;\n  }\n\n  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);\n\n\n  setPickingColor(a_PickingColor);\n}\n',$T='uniform sampler2D u_texture;\nuniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide = v_texture_data.x;\n  float lightWeight = v_texture_data.y;\n  float topU = v_uvs[0];\n  float topV = 1.0 - v_uvs[1];\n  float sidey = v_uvs[2];\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {// 是否是边缘\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n\n    if(u_linearColor == 1.0) {\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      gl_FragColor = v_Color;\n    }\n  } else {\n\n     // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n\n    gl_FragColor = texture2D(u_texture, vec2(topU, topV));\n    // gl_FragColor = vec4(1.0, 0., 0., 1.0);\n  }\n  \n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',tC='precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform sampler2D u_texture;\n\n\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\nvarying vec4 v_Color;\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\nuniform float u_linearColor: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n \n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  float lightWeight = calc_lighting(pos);\n  vec4 project_pos = project_position(pos);\n  v_uvs = a_uvs;\n\n  v_texture_data = vec2(a_Position.z, lightWeight);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n\n\n\n  setPickingColor(a_PickingColor);\n}\n',eC='uniform float u_opacity: 1.0;\nuniform vec4 u_sourceColor;\nuniform vec4 u_targetColor;\nuniform float u_linearColor: 0;\n\nuniform float u_topsurface: 1.0;\nuniform float u_sidesurface: 1.0;\n\nvarying vec4 v_Color;\nvarying vec3 v_uvs;\nvarying vec2 v_texture_data;\n\n#pragma include "picking"\n\nvoid main() {\n  float opacity = u_opacity;\n  float isSide =  v_texture_data.x;\n  float sidey = v_uvs[2];\n  float lightWeight = v_texture_data.y;\n\n  // Tip: 部分机型 GPU 计算精度兼容\n  if(isSide < 0.999) {\n    // side face\n    if(u_sidesurface < 1.0) {\n      discard;\n    }\n    \n    if( u_linearColor == 1.0) {\n      // side use linear\n      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);\n      linearColor.rgb *= lightWeight;\n      gl_FragColor = linearColor;\n    } else {\n      // side notuse linear\n       gl_FragColor = v_Color;\n    }\n  } else {\n    // top face\n    if(u_topsurface < 1.0) {\n      discard;\n    }\n    gl_FragColor = v_Color;\n  }\n\n  gl_FragColor.a *= opacity;\n  gl_FragColor = filterColorAlpha(gl_FragColor, lightWeight);\n}\n',nC='precision highp float;\n\n#define ambientRatio 0.5\n#define diffuseRatio 0.3\n#define specularRatio 0.2\n\nattribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute float a_Size;\nattribute vec3 a_uvs;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_heightfixed: 0.0; // 默认不固定\nuniform float u_raisingHeight: 0.0;\n\nvarying vec2 v_texture_data;\nvarying vec3 v_uvs;\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "light"\n#pragma include "picking"\n\nvoid main() {\n\n\n  v_uvs = a_uvs;\n  // cal style mapping - 数据纹理映射部分的计算\n  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);\n  vec4 project_pos = project_position(pos);\n\n  if(u_heightfixed > 0.0) { // 判断几何体是否固定高度\n    project_pos.z = a_Position.z * a_Size;\n    project_pos.z += u_raisingHeight;\n    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n      project_pos.z *= mapboxZoomScale;\n      project_pos.z += u_raisingHeight * mapboxZoomScale;\n    }\n  }\n\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    // gl_Position = u_Mvp * (vec4(project_pos.xyz * vec3(1.0, 1.0, -1.0), 1.0));\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  float lightWeight = calc_lighting(pos);\n  v_texture_data = vec2(a_Position.z,lightWeight);\n\n  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);\n\n  setPickingColor(a_PickingColor);\n}\n',rC=function(t){Yt(n,t);var e=YT(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.heightfixed,n=void 0!==e&&e,r=t.raisingHeight,i=void 0===r?0:r,o=t.topsurface,a=void 0===o||o,s=t.sidesurface,u=void 0===s||s,c=t.sourceColor,l=t.targetColor,h=0,f=[1,1,1,1],p=[1,1,1,1];return c&&l&&(f=bi(c),p=bi(l),h=1),(0,k.Z)({u_topsurface:Number(a),u_sidesurface:Number(u),u_heightfixed:Number(n),u_raisingHeight:Number(i),u_linearColor:h,u_sourceColor:f,u_targetColor:p,u_texture:this.texture},this.getStyleAttribute())}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.loadTexture();case 2:return t.abrupt("return",this.buildModels());case 3:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getShaders(),n=e.frag,r=e.vert,i=e.type,t.next=3,this.layer.buildLayerModel({moduleName:i,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:Nw});case 3:return o=t.sent,t.abrupt("return",[o]);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getShaders",value:function(){var t=this.layer.getLayerConfig(),e=t.pickLight,n=t.mapTexture;return n?{frag:$T,vert:tC,type:"polygonExtrudeTexture"}:e?{frag:eC,vert:nC,type:"polygonExtrudePickLight"}:{frag:QT,vert:JT,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=t,n=this.layer.coordCenter||this.layer.getSource().center,r=e[2]-e[0],i=e[3]-e[1];if("GAODE2.x"===this.mapService.version){var o=this.mapService.coordToAMap2RelativeCoordinates([t[0],t[1]],n),a=(0,Li.Z)(o,2),s=a[0],u=a[1],c=this.mapService.coordToAMap2RelativeCoordinates([t[2],t[3]],n),l=(0,Li.Z)(c,2),h=l[0],f=l[1];r=h-s,i=f-u,e=[s,u,h,f]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Ug.Attribute,descriptor:{name:"a_uvs",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,n,o){var a=o[0],s=o[1];return[(a-e[0])/r,(s-e[1])/i,o[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?10:e;return Array.isArray(n)?[n[0]]:[n]}}})}},{key:"loadTexture",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.layer.getLayerConfig(),n=e.mapTexture,r=this.rendererService.createTexture2D,this.texture=r({height:0,width:0}),!n){t.next=5;break}return t.abrupt("return",new Promise((function(t,e){var o=new Image;o.crossOrigin="anonymous",o.src=n,o.onload=function(){return i.texture=r({data:o,width:o.width,height:o.height,wrapS:vf.CLAMP_TO_EDGE,wrapT:vf.CLAMP_TO_EDGE,min:vf.LINEAR,mag:vf.LINEAR}),t(null)},o.onerror=function(){e(new Error("image load error"))}})));case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()}]),n}(Bx);function iC(t){var e=oC();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function oC(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var aC='varying vec4 v_color;\n#pragma include "picking"\n\nvoid main() {\n  gl_FragColor = v_color;\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',sC='#pragma include "picking"\nuniform float u_opacitylinear: 0.0;\nuniform float u_dir: 1.0;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\nvarying vec4 v_Color;\n\n\nvoid main() {\n   gl_FragColor = v_Color;\n  if(u_opacitylinear > 0.0) {\n    gl_FragColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;\n  }\n  gl_FragColor = filterColor(gl_FragColor);\n}\n',uC='attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_Color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nuniform float u_opacitylinear: 0.0;\n\nattribute vec3 a_linear;\nvarying vec3 v_linear;\nvarying vec2 v_pos;\n\nvoid main() {\n  if(u_opacitylinear > 0.0) {\n    v_linear = a_linear;\n    v_pos = a_Position.xy;\n  }\n  v_Color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}',cC='attribute vec4 a_Color;\nattribute vec3 a_Position;\n\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nuniform float u_raisingHeight: 0.0;\n\nvarying vec4 v_color;\n\n\n#pragma include "projection"\n#pragma include "picking"\n\nvoid main() {\n  // cal style mapping - 数据纹理映射部分的计算\n\n  // cal style mapping - 数据纹理映射部分的计算\n\n  v_color = vec4(a_Color.xyz, a_Color.w * opacity);\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n\n  project_pos.z += u_raisingHeight;\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {\n    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);\n    project_pos.z *= mapboxZoomScale;\n    project_pos.z += u_raisingHeight * mapboxZoomScale;\n  }\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n\n  setPickingColor(a_PickingColor);\n}\n\n',lC=function(t){Yt(n,t);var e=iC(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.raisingHeight,n=void 0===e?0:e,r=t.opacityLinear,i=void 0===r?{enable:!1,dir:"in"}:r;return(0,k.Z)({u_raisingHeight:Number(n),u_opacitylinear:Number(i.enable),u_dir:"in"===i.dir?1:0},this.getStyleAttribute())}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelParams(),n=e.frag,r=e.vert,i=e.triangulation,o=e.type,a=this.layer.getLayerConfig(),s=a.workerEnabled,u=void 0!==s&&s,c=a.enablePicking,this.layer.triangulation=i,t.next=5,this.layer.buildLayerModel({moduleName:o,vertexShader:r,fragmentShader:n,inject:this.getInject(),triangulation:i,primitive:vf.TRIANGLES,depth:{enable:!1},workerEnabled:u,workerOptions:{modelType:o,enablePicking:c}});case 5:return l=t.sent,t.abrupt("return",[l]);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getLayerConfig(),e=t.opacityLinear,n=void 0===e?{enable:!1,dir:"in"}:e;n.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Ug.Attribute,descriptor:{name:"a_linear",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n){return[n[3],n[4],n[5]]}}})}},{key:"getModelParams",value:function(){var t=this.layer.getLayerConfig(),e=t.opacityLinear,n=void 0===e?{enable:!1}:e;return n.enable?{frag:sC,vert:uC,type:"polygonLinear",triangulation:Ow}:{frag:aC,vert:cC,type:"polygonFill",triangulation:Mu}}}]),n}(Bx);function hC(t){var e=fC();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function fC(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var pC="\nuniform float u_time: 0.0;\nuniform float u_opacity: 1.0;\n\nvarying vec2 v_uv;\n\nfloat coast2water_fadedepth = 0.10;\nfloat large_waveheight      = .750; // change to adjust the \"heavy\" waves\nfloat large_wavesize        = 3.4;  // factor to adjust the large wave size\nfloat small_waveheight      = 0.6;  // change to adjust the small random waves\nfloat small_wavesize        = 0.5;   // factor to ajust the small wave size\nfloat water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)\nfloat water_glossylight_fact= 120.; // range [1..200]\nfloat particle_amount       = 70.;\n// vec3 watercolor             = vec3(0.43, 0.60, 0.66); // 'transparent' low-water color (RGB)\n// vec3 watercolor2            = vec3(0.06, 0.07, 0.11); // deep-water color (RGB, should be darker than the low-water color)\nuniform vec4 u_watercolor;\nuniform vec4 u_watercolor2;\nvec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights\n#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun\n\nuniform sampler2D u_texture1;\nuniform sampler2D u_texture2;\nuniform sampler2D u_texture3;\n\n  \n\nfloat hash( float n ) {\n    return fract(sin(n)*43758.5453123);\n}\n\n// 2d noise function\nfloat noise1( in vec2 x ) {\n  vec2 p  = floor(x);\n  vec2 f  = smoothstep(0.0, 1.0, fract(x));\n  float n = p.x + p.y*57.0;\n  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),\n    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);\n}\n\nfloat noise(vec2 p) {\n    return texture2D(u_texture2,p*vec2(1./256.)).x;\n}\n\nvec4 highness(vec2 p) {\n    vec4 t = texture2D(u_texture1,fract(p));\n    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;\n    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);\n}\n\nfloat height_map( vec2 p ) {\n    vec4 height=highness(p);\n    /*\n    height = -0.5+\n        0.5*smoothstep(-100.,0.,-height)+\n        2.75*smoothstep(0.,2.,height)+\n        1.75*smoothstep(2.,4.,height)+\n        2.75*smoothstep(4.,16.,height)+\n        1.5*smoothstep(16.,1000.,height);\n    */\n\n    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );\n    //p = p*6.;\n    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;\n    f += 0.2500*noise( p ); p = m*p*1.32;\n    f += 0.1666*noise( p ); p = m*p*1.11;\n    f += 0.0834*noise( p ); p = m*p*1.12;\n    f += 0.0634*noise( p ); p = m*p*1.13;\n    f += 0.0444*noise( p ); p = m*p*1.14;\n    f += 0.0274*noise( p ); p = m*p*1.15;\n    f += 0.0134*noise( p ); p = m*p*1.16;\n    f += 0.0104*noise( p ); p = m*p*1.17;\n    f += 0.0084*noise( p );\n    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;\n        const float FLAT_LEVEL = 0.92525;\n        //f = f*0.25+height*0.75;\n    if (f<FLAT_LEVEL)\n        f = f;\n    else\n        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase\n    return clamp(f, 0., 10.);\n}\n\nvec3 plasma_quintic( float x ) {\n    x = clamp( x, 0.0, 1.0);\n    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3\n    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7\n    return vec3(\n        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),\n        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),\n        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );\n}\n\nvec4 color(vec2 p){\n    vec4 c1 = vec4(1.7,1.6,.9,1);\n    vec4 c2 = vec4(.2,.94,.1,1);\n    vec4 c3 = vec4(.3,.2,.0,1);\n    vec4 c4 = vec4(.99,.99,1.6,1);\n    vec4 v = highness(p);\n    float los = smoothstep(0.1,1.1,v.b);\n    float his = smoothstep(3.5,6.5,v.b);\n    float ces = smoothstep(1.,5.,v.a);\n    vec4 lo = mix(c1,c2,los);\n    vec4 hi = mix(c3,c4,his);\n    vec4 ce = mix(lo,hi,ces);\n\n    return vec4(plasma_quintic(ces),1).ragb;\n}\n\nvec3 terrain_map( vec2 p )\n{\n  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture2D(u_texture3, fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'\n}\n\nconst mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );\n\nfloat water_map( vec2 p, float height ) {\n    vec2 p2 = p*large_wavesize;\n    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );\n    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );\n\n    // coarse crossing 'ocean' waves...\n    float f = 0.6000*noise( p );\n    f += 0.2500*noise( p*m );\n    f += 0.1666*noise( p*m*m );\n    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;\n\n    p *= small_wavesize;\n    f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<9; i++)\n    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }\n    \n    return wave+f*small_waveheight;\n}\n\nfloat nautic(vec2 p) {\n    p *= 18.;\n    float f = 0.;\n    float amp = 1.0, s = .5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }\n    return pow(1.-f, 5.);\n}\n\nfloat particles(vec2 p) {\n    p *= 200.;\n    float f = 0.;\n    float amp = 1.0, s = 1.5;\n    for (int i=0; i<3; i++)\n    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }\n    return pow(f*.35, 7.)*particle_amount;\n}\n\nfloat test_shadow( vec2 xy, float height) {\n    vec3 r0 = vec3(xy, height);\n    vec3 rd = normalize( light - r0 );\n    \n    float hit = 1.0;\n    float t   = 0.001;\n    for (int j=1; j<25; j++)\n    {\n        vec3 p = r0 + t*rd;\n        float h = height_map( p.xy );\n        float height_diff = p.z - h;\n        if (height_diff<0.0)\n        {\n            return 0.0;\n        }\n        t += 0.01+height_diff*.02;\n        hit = min(hit, 2.*height_diff/t); // soft shaddow   \n    }\n    return hit;\n}\n\nvec3 CalcTerrain(vec2 uv, float height) {\n    vec3 col = terrain_map( uv );\n    vec2 iResolution = vec2(512.);\n    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);\n    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);\n    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);\n    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);\n    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));\n    vec3 r0 = vec3(uv, height);\n    vec3 rd = normalize( light - r0 );\n    float grad = dot(norm, rd);\n    col *= grad+pow(grad, 8.);\n    float terrainshade = test_shadow( uv, height );\n    col = mix(col*.25, col, terrainshade);\n    return col;\n}\n\n\nvoid main() {\n  vec3 watercolor = u_watercolor.rgb;\n  vec3 watercolor2 = u_watercolor2.rgb;\n  vec2 uv = v_uv;\n  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)\n  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;\n  float height = height_map( uv );\n  vec3 col;\n\n    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);\n    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);\n    if (height > level)\n    {\n        col = CalcTerrain(uv, height);\n    }\n    if (height <= level)\n    {\n        vec2 dif = vec2(.0, .01);\n        vec2 pos = uv*15. + vec2(u_time*.01);\n        float h1 = water_map(pos-dif,waveheight);\n        float h2 = water_map(pos+dif,waveheight);\n        float h3 = water_map(pos-dif.yx,waveheight);\n        float h4 = water_map(pos+dif.yx,waveheight);\n        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane\n        uv += normwater.xy*.002*(level-height);\n        \n        col = CalcTerrain(uv, height);\n\n        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);\n        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);\n        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;\n        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));\n\n        vec3 r0 = vec3(uv, WATER_LEVEL);\n        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position\n        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction\n        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          \n        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights\n        float gradpos  = dot(vec3(0., 0., 1.), rd);\n        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          \n        float watershade  = test_shadow( uv, level );\n        watercolor *= 2.2+watershade;\n        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;\n        watercolor /= (1.+specular1*1.25);\n        watercolor += watershade*specular2*water_specularcolor;\n        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));\n        \n        col = mix(col, watercolor, coastfade);\n    }\n    \n\n  float opacity = u_opacity;\n  gl_FragColor = vec4(col, opacity);  \n}\n",dC='attribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec2 v_uv;\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',vC=function(t){Yt(n,t);var e=hC(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.watercolor,i=void 0===r?"#6D99A8":r,o=t.watercolor2,a=void 0===o?"#0F121C":o;return{u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3,u_watercolor:bi(i),u_watercolor2:bi(a),u_opacity:(0,Oi.isNumber)(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadTexture(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:dC,fragmentShader:pC,triangulation:Lw,primitive:vf.TRIANGLES,depth:{enable:!1}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t,e,n;null===(t=this.texture1)||void 0===t||t.destroy(),null===(e=this.texture2)||void 0===e||e.destroy(),null===(n=this.texture3)||void 0===n||n.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=(0,Li.Z)(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Ug.Attribute,descriptor:{name:"a_uv",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,i,o){var u=t.version===ux["GAODE2.x"]?t.originCoordinates[0][o]:i,c=(0,Li.Z)(u,2),l=c[0],h=c[1];return[(l-n)/a,(h-r)/s]}}})}},{key:"loadTexture",value:function(){var t=this,e=this.rendererService.createTexture2D,n={height:0,width:0};function r(t){var e=0,n=[],r=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];r.map((function(r){var i=new Image;i.crossOrigin="",i.src=r,n.push(i),i.onload=function(){e++,3===e&&t(n)}}))}function i(t){return e({data:t,width:t.width,height:t.height,wrapS:vf.MIRRORED_REPEAT,wrapT:vf.MIRRORED_REPEAT,min:vf.LINEAR,mag:vf.LINEAR})}this.texture1=e(n),this.texture2=e(n),this.texture3=e(n),r((function(e){t.texture1=i(e[0]),t.texture2=i(e[1]),t.texture3=i(e[2]),t.layerService.reRender()}))}}]),n}(Bx);function mC(t){var e=gC();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function gC(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var yC="uniform sampler2D u_texture;\nuniform float u_time: 0.0;\nuniform float u_speed: 1.0;\nuniform float u_opacity: 1.0;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\n\nfloat rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }\n\nfloat water(vec3 p) {\n  float t = u_time * u_speed;\n  p.z += t * 2.; p.x += t * 2.;\n  vec3 c1 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 3.; p.x += t * 0.52;\n  vec3 c2 = texture2D(u_texture, p.xz / 30.).xyz;\n  p.z += t * 4.; p.x += t * 0.8;\n  vec3 c3 = texture2D(u_texture, p.xz / 30.).xyz;\n  c1 += c2 - c3;\n  float z = (c1.x + c1.y + c1.z) / 3.;\n  return p.y + z / 4.;\n}\n\nfloat map(vec3 p) {\n  float d = 100.0;\n  d = water(p);\n  return d;\n}\n\nfloat intersect(vec3 ro, vec3 rd) {\n  float d = 0.0;\n  for (int i = 0; i <= 100; i++) {\n    float h = map(ro + rd * d);\n    if (h < 0.1) return  d;\n    d += h;\n  }\n  return 0.0;\n}\n\nvec3 norm(vec3 p) {\n  float eps = .1;\n  return normalize(vec3(\n    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),\n    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),\n    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))\n  ));\n} \n\nfloat calSpc() {\n  vec3 l1 = normalize(vec3(1, 1, 1));\n  vec3 ro = vec3(-3, 20, -8);\n  vec3 rc = vec3(0, 0, 0);\n  vec3 ww = normalize(rc - ro);\n  vec3 uu = normalize(cross(vec3(0,1,0), ww));\n  vec3 vv = normalize(cross(rc - ro, uu));\n  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);\n  float d = intersect(ro, rd);\n  vec3 p = ro + rd * d;\n  vec3 n = norm(p);\n  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);\n  return spc;\n}\n\nvoid main() {\n  float opacity = u_opacity;\n  gl_FragColor = v_Color;\n  gl_FragColor.a *= opacity;\n\n  float spc = calSpc();\n  gl_FragColor += spc * 0.4;\n}\n",_C='attribute vec4 a_Color;\nattribute vec2 a_uv;\nattribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\nvarying vec4 v_Color;\nvarying vec2 v_uv;\nuniform float u_opacity: 1.0;\n\n\n#pragma include "projection"\n\nvoid main() {\n  v_uv = a_uv;\n\n  v_Color = a_Color;\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',xC=function(t){Yt(n,t);var e=mC(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.speed,i=void 0===r?.5:r;return{u_texture:this.texture,u_speed:i,u_opacity:(0,Oi.isNumber)(n)?n:1}}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.loadTexture(),t.abrupt("return",this.buildModels());case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:_C,fragmentShader:yC,triangulation:Lw,primitive:vf.TRIANGLES,depth:{enable:!1}});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){var t=this.layer.getSource().extent,e=(0,Li.Z)(t,4),n=e[0],r=e[1],i=e[2],o=e[3],a=i-n,s=o-r;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Ug.Attribute,descriptor:{name:"a_uv",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,i,o){var u=t.version===ux["GAODE2.x"]?t.originCoordinates[0][o]:i,c=(0,Li.Z)(u,2),l=c[0],h=c[1];return[(l-n)/a,(h-r)/s]}}})}},{key:"loadTexture",value:function(){var t=this,e=this.layer.getLayerConfig(),n=e.waterTexture,r=this.rendererService.createTexture2D;this.texture=r({height:0,width:0});var i=new Image;i.crossOrigin="",i.src=n||"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",i.onload=function(){t.texture=r({data:i,width:i.width,height:i.height,wrapS:vf.MIRRORED_REPEAT,wrapT:vf.MIRRORED_REPEAT,min:vf.LINEAR,mag:vf.LINEAR}),t.layerService.reRender()}}}]),n}(Bx),bC={fill:lC,line:tA,extrude:rC,text:UT,point_fill:ZA,point_image:JA,point_normal:iT,point_extrude:NA,water:xC,ocean:vC},wC=bC;function EC(t){var e=SC();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function SC(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var AC=function(t){Yt(n,t);var e=EC(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","PolygonLayer"),(0,Ft.Z)(Kt(t),"enableEncodeStyles",["opacity"]),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new wC[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=null===e||void 0===e||null===(t=e.scale)||void 0===t?void 0:t.field;return"fill"!==n&&n?"extrude"===n?"extrude":"water"===n?"water":"ocean"===n?"ocean":"line"===n?"line":this.getPointModelType():"fill"}},{key:"getPointModelType",value:function(){var t=this.getEncodedData(),e=this.getLayerConfig(),n=e.shape2d,r=e.shape3d,i=this.iconService.getIconMap(),o=t.find((function(t){return t.hasOwnProperty("shape")}));if(o){var a=o.shape;return"dot"===a?"point_normal":-1!==(null===n||void 0===n?void 0:n.indexOf(a))?"point_fill":-1!==(null===r||void 0===r?void 0:r.indexOf(a))?"point_extrude":i.hasOwnProperty(a)?"point_image":"text"}return"fill"}}]),n}(Dx);function TC(t){var e=CC();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function CC(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var kC="precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\nuniform float u_min;\nuniform float u_max;\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nvarying vec2 v_texCoord;\nbool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }\n\n\nvoid main() {\n\n  float value = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).r;\n  if (value == u_noDataValue || isnan_emu(value))\n      discard;\n  else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1]))\n     discard;\n  else {\n    float normalisedValue =(value - u_domain[0]) / (u_domain[1] -u_domain[0]);\n    vec4 color = texture2D(u_colorTexture,vec2(normalisedValue, 0));\n    \n    gl_FragColor = color;\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n    if(gl_FragColor.a < 0.01)\n      discard;\n   \n  }\n}\n",MC='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',PC=function(t){Yt(n,t);var e=TC(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.clampLow,i=void 0===r||r,o=t.clampHigh,a=void 0===o||o,s=t.noDataValue,u=void 0===s?-9999999:s,c=t.domain,l=t.rampColors,h=c||Pi(l);return this.colorTexture=this.layer.textureService.getColorTexture(l,h),{u_opacity:n||1,u_texture:this.texture,u_domain:h,u_clampLow:i,u_clampHigh:"undefined"!==typeof a?a:i,u_noDataValue:u,u_colorTexture:this.colorTexture}}},{key:"getRasterData",value:function(){var t=(0,J.Z)(tt().mark((function t(e){var n,r,i,o;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!Array.isArray(e.data)){t.next=4;break}return t.abrupt("return",{data:e.data,width:e.width,height:e.height});case 4:return t.next=6,e.data;case 6:return n=t.sent,r=n.rasterData,i=n.width,o=n.height,t.abrupt("return",{data:Array.from(r),width:i,height:o});case 11:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getSource(),n=this.rendererService.createTexture2D,r=e.data.dataArray[0],t.next=5,this.getRasterData(r);case 5:return i=t.sent,o=i.data,a=i.width,s=i.height,this.texture=n({data:o,width:a,height:s,format:vf.LUMINANCE,type:vf.FLOAT}),t.next=12,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:MC,fragmentShader:kC,triangulation:Fw,primitive:vf.TRIANGLES,depth:{enable:!1}});case 12:return u=t.sent,t.abrupt("return",[u]);case 14:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.colorTexture)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),n}(Bx),IC=["data"],RC=["rasterData"];function LC(t){var e=OC();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function OC(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var DC='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',NC="precision mediump float;\nuniform vec2 u_rminmax: vec2(0,255); \nuniform vec2 u_gminmax: vec2(0,255);\nuniform vec2 u_bminmax: vec2(0,255);\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nuniform float u_noDataValue : 0.0;\nvarying vec2 v_texCoord;\n\nvoid main() {\n  vec3 rgb = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y)).rgb;\n  if(rgb == vec3(u_noDataValue)) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n    gl_FragColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);\n  }\n  if(gl_FragColor.a < 0.01)\n    discard;\n \n}",zC=function(t){Yt(n,t);var e=LC(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"dataOption",{}),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.noDataValue,i=void 0===r?0:r,o=this.dataOption,a=o.rMinMax,s=o.gMinMax,u=o.bMinMax;return{u_opacity:n||1,u_texture:this.texture,u_noDataValue:i,u_rminmax:a,u_gminmax:s,u_bminmax:u}}},{key:"getRasterData",value:function(){var t=(0,J.Z)(tt().mark((function t(e){var n,r,i,o,a;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(!Array.isArray(e.data)){t.next=4;break}return n=e.data,r=Jf(e,IC),this.dataOption=r,t.abrupt("return",(0,k.Z)({data:n},r));case 4:return t.next=6,e.data;case 6:if(i=t.sent,o=i.rasterData,a=Jf(i,RC),this.dataOption=a,!Array.isArray(o)){t.next=14;break}return t.abrupt("return",(0,k.Z)({data:o},a));case 14:return t.abrupt("return",(0,k.Z)({data:Array.from(o)},a));case 15:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getSource(),n=this.rendererService.createTexture2D,r=e.data.dataArray[0],t.next=5,this.getRasterData(r);case 5:return i=t.sent,o=i.data,a=i.width,s=i.height,this.texture=n({data:o,width:a,height:s,format:vf.RGB,type:vf.FLOAT}),t.next=12,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:DC,fragmentShader:NC,triangulation:Fw,primitive:vf.TRIANGLES,depth:{enable:!1}});case 12:return u=t.sent,t.abrupt("return",[u]);case 14:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),n}(Bx);function FC(t){var e=BC();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function BC(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var UC="precision mediump float;\nuniform float u_opacity: 1.0;\n\nuniform sampler2D u_texture;\nuniform sampler2D u_colorTexture;\n\nvarying vec2 v_texCoord;\n\nuniform vec2 u_domain;\nuniform float u_noDataValue;\nuniform bool u_clampLow: true;\nuniform bool u_clampHigh: true;\nuniform vec4 u_unpack;\n\nfloat getElevation(vec2 coord, float bias) {\n    // Convert encoded elevation value to meters\n    vec4 data = texture2D(u_texture, coord,bias) * 255.0;\n    data.a = -1.0;\n    return dot(data, u_unpack);\n}\n\nvec4 getColor(float value) {\n   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);\n    vec2 coord = vec2(normalisedValue, 0);\n    return texture2D(u_colorTexture, coord);\n}\n\nvoid main() {\n  float value = getElevation(v_texCoord,0.0);\n  if (value == u_noDataValue) {\n    gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {\n     gl_FragColor = vec4(0.0, 0, 0, 0.0);\n  } else {\n   \n    gl_FragColor = getColor(value);\n    gl_FragColor.a =  gl_FragColor.a * u_opacity ;\n      if(gl_FragColor.a < 0.01)\n      discard;\n  }\n}\n",jC='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',ZC=function(t){Yt(n,t);var e=FC(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=t.clampLow,r=void 0===n||n,i=t.clampHigh,o=void 0===i||i,a=t.noDataValue,s=void 0===a?-9999999:a,u=t.domain,c=t.rampColors,l=t.colorTexture,h=t.rScaler,f=void 0===h?6553.6:h,p=t.gScaler,d=void 0===p?25.6:p,v=t.bScaler,m=void 0===v?.1:v,g=t.offset,y=void 0===g?1e4:g,_=u||Pi(c),x=l;return l?this.layer.textureService.setColorTexture(l,c,_):x=this.layer.textureService.getColorTexture(c,_),{u_opacity:e||1,u_texture:this.texture,u_domain:_,u_clampLow:r,u_clampHigh:"undefined"!==typeof o?o:r,u_noDataValue:s,u_unpack:[f,d,m,y],u_colorTexture:x}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getSource(),n=this.rendererService.createTexture2D,t.next=4,e.data.images;case 4:return r=t.sent,this.texture=n({data:r[0],width:r[0].width,height:r[0].height,min:vf.LINEAR,mag:vf.LINEAR}),t.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:jC,fragmentShader:UC,triangulation:Fw,primitive:vf.TRIANGLES,depth:{enable:!1}});case 8:return i=t.sent,t.abrupt("return",[i]);case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t;null===(t=this.texture)||void 0===t||t.destroy()}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),n}(Bx),VC={raster:PC,rasterRgb:zC,raster3d:PC,rasterTerrainRgb:ZC},GC=VC;function HC(t){var e=WC();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function WC(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var qC=function(t){Yt(n,t);var e=HC(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","RasterLayer"),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new GC[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),e={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return e[t]}},{key:"getModelType",value:function(){var t=this.layerSource.getParserType();switch(t){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),n}(Dx);function XC(t){var e=YC();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function YC(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var KC=function(t){Yt(n,t);var e=XC(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","TileDebugLayer"),(0,Ft.Z)(Kt(t),"zIndex",1e4),(0,Ft.Z)(Kt(t),"defaultSourceConfig",{data:[],options:{parser:{type:"testTile"}}}),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return");case 1:case"end":return t.stop()}}),t)})));function e(){return t.apply(this,arguments)}return e}()}]),n}(Dx);function QC(t){var e=JC();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function JC(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var $C="\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\n\nvarying vec3 vVertexNormal;\nvarying float v_offset;\nvarying vec4 v_Color;\nvoid main() {\n    \n    \n    // float intensity = pow(0.5 + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    float intensity = pow(v_offset + dot(normalize(vVertexNormal), normalize(u_CameraPosition)), 3.0);\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",tk="\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nvarying float v_CamreaDistance;\n\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\nvarying float v_offset;\n\nvoid main() {\n    float EARTH_RADIUS = 100.0;\n    \n    v_Color = a_Color;\n\n    v_offset = min(((length(u_CameraPosition) - EARTH_RADIUS)/600.0) * 0.5 + 0.4, 1.0);\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",ek=function(t){Yt(n,t);var e=QC(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e;return{u_opacity:(0,Oi.isNumber)(n)?n:1}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.layer.zIndex=-997,t.next=3,this.layer.buildLayerModel({moduleName:"earthAtmoSphere",vertexShader:tk,fragmentShader:$C,triangulation:Gw,depth:{enable:!1},blend:this.getBlend()});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),n}(Bx);function nk(t){var e=rk();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function rk(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ik="\nuniform sampler2D u_texture;\n\nvarying vec2 v_texCoord;\nvarying float v_lightWeight;\n\n\nvoid main() {\n\n    vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n    color.xyz = color.xyz * v_lightWeight;\n    gl_FragColor = color;\n}\n",ok="// attribute vec4 a_Color;\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n\n// attribute vec2 a_Extrude;\n// attribute float a_Size;\n// attribute float a_Shape;\n\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform float u_ambientRatio : 0.5;\nuniform float u_diffuseRatio : 0.3;\nuniform float u_specularRatio : 0.2;\nuniform vec3 u_sunLight: [1.0, -10.5, 12.0];\n\n\n\nfloat calc_lighting(vec4 pos) {\n\n    vec3 worldPos = vec3(pos * u_ModelMatrix);\n\n    vec3 worldNormal = a_Normal;\n\n    // cal light weight\n    vec3 viewDir = normalize(u_CameraPosition - worldPos);\n\n    vec3 lightDir = normalize(u_sunLight);\n\n    vec3 halfDir = normalize(viewDir+lightDir);\n    // lambert\n    float lambert = dot(worldNormal, lightDir);\n    // specular\n    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);\n    //sum to light weight\n    float lightWeight = u_ambientRatio + u_diffuseRatio * lambert + u_specularRatio * specular;\n\n    return lightWeight;\n}\n\nvarying float v_lightWeight;\nvoid main() {\n\n    v_texCoord = a_Uv;\n\n    float lightWeight = calc_lighting(vec4(a_Position, 1.0));\n    v_lightWeight = lightWeight;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",ak=function(t){Yt(n,t);var e=nk(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"earthTime",3.4),(0,Ft.Z)(Kt(t),"sunX",1e3),(0,Ft.Z)(Kt(t),"sunY",1e3),(0,Ft.Z)(Kt(t),"sunZ",1e3),(0,Ft.Z)(Kt(t),"sunRadius",Math.sqrt(t.sunX*t.sunX+t.sunY*t.sunY+t.sunZ*t.sunZ)),t}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.animateOption,n=t.globalOptions;return null!==e&&void 0!==e&&e.enable&&(this.mapService.rotateY({reg:.002}),this.earthTime+=.02,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY)),{u_ambientRatio:(null===n||void 0===n?void 0:n.ambientRatio)||.6,u_diffuseRatio:(null===n||void 0===n?void 0:n.diffuseRatio)||.4,u_specularRatio:(null===n||void 0===n?void 0:n.specularRatio)||.1,u_sunLight:[this.sunX,this.sunY,this.sunZ],u_texture:this.texture}}},{key:"setEarthTime",value:function(t){this.earthTime=t,this.sunY=10,this.sunX=Math.cos(this.earthTime)*(this.sunRadius-this.sunY),this.sunZ=Math.sin(this.earthTime)*(this.sunRadius-this.sunY),this.layerService.throttleRenderLayers()}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.layer.getLayerConfig(),n=e.globalOptions,void 0!==(null===n||void 0===n?void 0:n.earthTime)&&this.setEarthTime(n.earthTime),r=this.layer.getSource(),i=this.rendererService.createTexture2D,this.texture=i({height:0,width:0}),r.data.images.then((function(t){o.texture=i({data:t[0],width:t[0].width,height:t[0].height}),o.layerService.reRender()})),t.abrupt("return",this.buildModels());case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.layer.zIndex=-998,t.next=3,this.layer.buildLayerModel({moduleName:"earthBase",vertexShader:ok,fragmentShader:ik,triangulation:Gw,depth:{enable:!0},blend:this.getBlend()});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),n}(Bx);function sk(t){var e=uk();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function uk(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var ck="\nuniform float u_opacity;\nuniform vec3 u_CameraPosition;\nvarying vec3 vVertexNormal;\n\nvarying vec4 v_Color;\nvoid main() {\n\n\n    float intensity =  - dot(normalize(vVertexNormal), normalize(u_CameraPosition));\n    // 去除背面\n    if(intensity > 1.0) intensity = 0.0;\n\n    gl_FragColor = vec4(v_Color.rgb, v_Color.a * intensity * u_opacity);\n}\n",lk="\nattribute vec3 a_Position;\nattribute vec3 a_Normal;\nattribute vec2 a_Uv;\nattribute vec4 a_Color;\nuniform vec3 u_CameraPosition;\nuniform mat4 u_ViewProjectionMatrix;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_ViewMatrix;\n\nvarying vec3 vVertexNormal;\nvarying vec4 v_Color;\n\nvoid main() {\n    v_Color = a_Color;\n\n    vVertexNormal = a_Normal;\n\n    gl_Position = u_ViewProjectionMatrix * u_ModelMatrix * vec4(a_Position, 1.0);\n}\n",hk=function(t){Yt(n,t);var e=sk(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e;return{u_opacity:(0,Oi.isNumber)(n)?n:1}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){return""}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return this.layer.zIndex=-999,t.next=3,this.layer.buildLayerModel({moduleName:"earthBloom",vertexShader:lk,fragmentShader:ck,triangulation:Hw,depth:{enable:!1},blend:this.getBlend()});case 3:return e=t.sent,t.abrupt("return",[e]);case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Ug.Attribute,descriptor:{name:"a_Size",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.size,n=void 0===e?1:e;return Array.isArray(n)?[n[0]]:[n]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Ug.Attribute,descriptor:{name:"a_Normal",buffer:{usage:vf.STATIC_DRAW,data:[],type:vf.FLOAT},size:3,update:function(t,e,n,r,i){return i}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}}]),n}(Bx);function fk(t){var e=pk();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function pk(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var dk={base:ak,atomSphere:ek,bloomSphere:hk},vk=["base","atomSphere","bloomSphere"],mk=function(t){Yt(n,t);var e=fk(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","EarthLayer"),(0,Ft.Z)(Kt(t),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new dk[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"setEarthTime",value:function(t){this.layerModel&&this.layerModel.setEarthTime&&this.layerModel.setEarthTime(t)}},{key:"getModelType",value:function(){var t,e=this.styleAttributeService.getLayerStyleAttribute("shape"),n=(null===e||void 0===e||null===(t=e.scale)||void 0===t?void 0:t.field)||"base";return vk.indexOf(n)<0&&(n="base"),n}}]),n}(Dx);function gk(t){var e=yk();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function yk(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var _k="uniform float u_opacity : 1.0;\nuniform vec4 u_color;\n\nvoid main() {\n  gl_FragColor = u_color;\n  gl_FragColor.a *= u_opacity;\n}\n",xk='attribute vec3 a_Position;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\n\n#pragma include "projection"\n\nvoid main() {\n  vec4 project_pos = project_position(vec4(a_Position, 1.0));\n\n  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));\n  } else {\n    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));\n  }\n}\n\n',bk=function(t){Yt(n,t);var e=gk(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getUninforms",value:function(){var t=this.layer.getLayerConfig(),e=t.opacity,n=void 0===e?1:e,r=t.color,i=void 0===r?"#000":r;return{u_opacity:(0,Oi.isNumber)(n)?n:0,u_color:bi(i)}}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.buildModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layer.buildLayerModel({moduleName:"mask",vertexShader:xk,fragmentShader:_k,triangulation:Lw,depth:{enable:!1},pick:!1});case 2:return e=t.sent,t.abrupt("return",[e]);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];t&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),n}(Bx),wk={fill:bk},Ek=wk;function Sk(t){var e=Ak();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Ak(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Tk=function(t){Yt(n,t);var e=Sk(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","MaskLayer"),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new Ek[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getModelType",value:function(){return"fill"}}]),n}(Dx);function Ck(t,e,n){var r=kk(t,t.VERTEX_SHADER,e),i=kk(t,t.FRAGMENT_SHADER,n);if(!r||!i)return null;var o=t.createProgram();if(!o)return null;t.attachShader(o,r),t.attachShader(o,i),t.linkProgram(o);var a=t.getProgramParameter(o,t.LINK_STATUS);if(!a){t.getProgramInfoLog(o);return t.deleteProgram(o),t.deleteShader(i),t.deleteShader(r),null}for(var s=t.getProgramParameter(o,t.ACTIVE_ATTRIBUTES),u=0;u<s;u++){var c=t.getActiveAttrib(o,u);o[c.name]=t.getAttribLocation(o,c.name)}for(var l=t.getProgramParameter(o,t.ACTIVE_UNIFORMS),h=0;h<l;h++){var f=t.getActiveUniform(o,h);o[f.name]=t.getUniformLocation(o,f.name)}return o.vertexShader=r,o.fragmentShader=i,o}function kk(t,e,n){var r=t.createShader(e);if(null==r)return null;t.shaderSource(r,n),t.compileShader(r);var i=t.getShaderParameter(r,t.COMPILE_STATUS);if(!i){t.getShaderInfoLog(r);return t.deleteShader(r),null}return r}function Mk(t,e,n,r,i){var o=t.createTexture();return t.bindTexture(t.TEXTURE_2D,o),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,r,i,0,t.RGBA,t.UNSIGNED_BYTE,n),t.bindTexture(t.TEXTURE_2D,null),o}function Pk(t,e,n){var r=t.createTexture();return t.bindTexture(t.TEXTURE_2D,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,e),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,e),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,n),t.bindTexture(t.TEXTURE_2D,null),r}function Ik(t,e,n){t.activeTexture(t.TEXTURE0+n),t.bindTexture(t.TEXTURE_2D,e)}function Rk(t,e){var n=t.createBuffer();return t.bindBuffer(t.ARRAY_BUFFER,n),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),n}var Lk="\n precision mediump float;\n\n attribute float a_index;\n\n uniform sampler2D u_particles;\n uniform float u_particles_res;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec4 color = texture2D(u_particles, vec2(\n         fract(a_index / u_particles_res),\n         floor(a_index / u_particles_res) / u_particles_res)\n     );\n\n     // decode current particle position from the pixel's RGBA value\n     v_particle_pos = vec2( color.r / 255.0 + color.b, color.g / 255.0 + color.a);\n\n     gl_PointSize = 1.0;\n     gl_Position = vec4(2.0 * v_particle_pos.x - 1.0, 1.0 - 2.0 * v_particle_pos.y, 0, 1);\n }",Ok="\n precision mediump float;\n\n uniform sampler2D u_wind;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform sampler2D u_color_ramp;\n\n varying vec2 v_particle_pos;\n\n void main() {\n     vec2 velocity = mix(u_wind_min, u_wind_max, texture2D(u_wind, v_particle_pos).rg);\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // color ramp is encoded in a 16x16 texture\n     vec2 ramp_pos = vec2( fract(16.0 * speed_t), floor(16.0 * speed_t) / 16.0);\n\n     gl_FragColor = texture2D(u_color_ramp, ramp_pos);\n }",Dk="\n precision mediump float;\n\n attribute vec2 a_pos;\n\n varying vec2 v_tex_pos;\n\n void main() {\n     v_tex_pos = a_pos;\n     gl_Position = vec4(1.0 - 2.0 * a_pos, 0, 1);\n     // framebuffer 始终用铺满屏幕的 texture\n }",Nk="\n precision highp float;\n\n uniform sampler2D u_particles;\n uniform sampler2D u_wind;\n uniform vec2 u_wind_res;\n uniform vec2 u_wind_min;\n uniform vec2 u_wind_max;\n uniform float u_rand_seed;\n uniform float u_speed_factor;\n uniform float u_drop_rate;\n uniform float u_drop_rate_bump;\n\n varying vec2 v_tex_pos;\n\n // pseudo-random generator\n const vec3 rand_constants = vec3(12.9898, 78.233, 4375.85453);\n float rand(const vec2 co) {\n float t = dot(rand_constants.xy, co);\n     return fract(sin(t) * (rand_constants.z + t));\n }\n\n // wind speed lookup; use manual bilinear filtering based on 4 adjacent pixels for smooth interpolation\n vec2 lookup_wind(const vec2 uv) {\n     // return texture2D(u_wind, uv).rg; // lower-res hardware filtering\n     vec2 px = 1.0 / u_wind_res;\n     vec2 vc = (floor(uv * u_wind_res)) * px;\n     vec2 f = fract(uv * u_wind_res);\n     vec2 tl = texture2D(u_wind, vc).rg;\n     vec2 tr = texture2D(u_wind, vc + vec2(px.x, 0)).rg;\n     vec2 bl = texture2D(u_wind, vc + vec2(0, px.y)).rg;\n     vec2 br = texture2D(u_wind, vc + px).rg;\n     return mix(mix(tl, tr, f.x), mix(bl, br, f.x), f.y);\n }\n\n void main() {\n     vec4 color = texture2D(u_particles, v_tex_pos);\n     vec2 pos = vec2(\n         color.r / 255.0 + color.b,\n         color.g / 255.0 + color.a); // decode particle position from pixel RGBA\n     vec2 velocity = mix(u_wind_min, u_wind_max, lookup_wind(pos));\n     float speed_t = length(velocity) / length(u_wind_max);\n\n     // take EPSG:4236 distortion into account for calculating where the particle moved\n     float distortion = cos(radians(pos.y * 180.0 - 90.0));\n     vec2 offset = vec2(velocity.x / distortion, -velocity.y) * 0.0001 * u_speed_factor;\n\n     // update particle position, wrapping around the date line\n     pos = fract(1.0 + pos + offset);\n\n     // a random seed to use for the particle drop\n     vec2 seed = (pos + v_tex_pos) * u_rand_seed;\n\n     // drop rate is a chance a particle will restart at random position, to avoid degeneration\n     float drop_rate = u_drop_rate + speed_t * u_drop_rate_bump;\n     float drop = step(1.0 - drop_rate, rand(seed));\n\n     vec2 random_pos = vec2(\n         rand(seed + 1.3),\n         rand(seed + 2.1));\n         pos = mix(pos, random_pos, drop);\n\n     // encode the new particle position back into RGBA\n     gl_FragColor = vec4(\n         fract(pos * 255.0),\n         floor(pos * 255.0) / 255.0);\n }",zk="\n     precision mediump float;\n\n     attribute vec2 a_pos;\n\n     varying vec2 v_tex_pos;\n\n     void main() {\n         v_tex_pos = a_pos;\n         gl_Position = vec4(1.0 - 2.0 * a_pos, 0.0, 1.0);\n         gl_PointSize = 100.0;\n }",Fk="\n precision mediump float;\n\n uniform sampler2D u_screen;\n uniform float u_opacity;\n varying vec2 v_tex_pos;\n\n void main() {\n     vec4 color = texture2D(u_screen, 1.0 - v_tex_pos);\n\n     // a hack to guarantee opacity fade out even with a value close to 1.0\n     gl_FragColor = vec4(floor(255.0 * color * u_opacity) / 255.0);\n }";function Bk(t){var e=document.createElement("canvas"),n=e.getContext("2d");e.width=256,e.height=1;for(var r=n.createLinearGradient(0,0,256,0),i=0,o=Object.keys(t);i<o.length;i++){var a=o[i];r.addColorStop(+a,t[+a])}return n.fillStyle=r,n.fillRect(0,0,256,1),e=null,new Uint8Array(n.getImageData(0,0,256,1).data)}function Uk(t,e,n,r){t.bindBuffer(t.ARRAY_BUFFER,e),t.enableVertexAttribArray(n),t.vertexAttribPointer(n,r,t.FLOAT,!1,0,0)}function jk(t,e,n){t.bindFramebuffer(t.FRAMEBUFFER,e),n&&t.framebufferTexture2D(t.FRAMEBUFFER,t.COLOR_ATTACHMENT0,t.TEXTURE_2D,n,0)}var Zk=function(){function t(e){Ot(this,t),(0,Ft.Z)(this,"width",512),(0,Ft.Z)(this,"height",512),(0,Ft.Z)(this,"numParticles",65536),this.gl=e.glContext,this.width=e.imageWidth,this.height=e.imageHeight,this.fadeOpacity=e.fadeOpacity,this.speedFactor=e.speedFactor,this.dropRate=e.dropRate,this.dropRateBump=e.dropRateBump,this.rampColors=e.rampColors,this.init()}return zt(t,[{key:"init",value:function(){var t=this.gl;this.fadeOpacity=.996,this.speedFactor=.25,this.dropRate=.003,this.dropRateBump=.01,this.drawProgram=Ck(t,Lk,Ok),this.fullScreenProgram=Ck(t,zk,Fk),this.updateProgram=Ck(t,Dk,Nk),this.quadBuffer=Rk(t,new Float32Array([0,0,1,0,0,1,0,1,1,0,1,1])),this.framebuffer=t.createFramebuffer(),this.colorRampTexture=Mk(this.gl,this.gl.LINEAR,Bk(this.rampColors),16,16);var e=new Uint8Array(this.width*this.height*4);this.backgroundTexture=Mk(t,t.NEAREST,e,this.width,this.height),this.screenTexture=Mk(t,t.NEAREST,e,this.width,this.height);var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=Mk(t,t.NEAREST,r,n,n),this.particleStateTexture1=Mk(t,t.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=Rk(t,o)}},{key:"setWind",value:function(t){this.windData=t,this.windTexture=Pk(this.gl,this.gl.LINEAR,t.image)}},{key:"updateParticelNum",value:function(t){var e=this.gl;if(t!==this.numParticles){this.numParticles=t;var n=this.particleStateResolution=Math.ceil(Math.sqrt(this.numParticles));this.numParticlesSize=n*n;for(var r=new Uint8Array(4*this.numParticlesSize),i=0;i<r.length;i++)r[i]=Math.floor(256*Math.random());this.particleStateTexture0=Mk(e,e.NEAREST,r,n,n),this.particleStateTexture1=Mk(e,e.NEAREST,r,n,n);for(var o=new Float32Array(this.numParticlesSize),a=0;a<this.numParticlesSize;a++)o[a]=a;this.particleIndexBuffer=Rk(e,o)}}},{key:"updateWindDir",value:function(t,e,n,r){this.windData.uMin=t,this.windData.uMax=e,this.windData.vMin=n,this.windData.vMax=r}},{key:"updateColorRampTexture",value:function(t){if(this.isColorChanged(t)){this.rampColors=t;var e=this.gl;e.deleteTexture(this.colorRampTexture),this.colorRampTexture=Mk(e,e.LINEAR,Bk(t),16,16)}}},{key:"isColorChanged",value:function(t){for(var e=Object.keys(t),n=0,r=e;n<r.length;n++){var i=r[n],o=Number(i);if(!this.rampColors[o])return!0;if(this.rampColors[o]&&this.rampColors[o]!==t[o])return!0}return!1}},{key:"reSize",value:function(t,e){if(t!==this.width||e!==this.height){var n=this.gl;n.deleteTexture(this.backgroundTexture),n.deleteTexture(this.screenTexture),this.width=t,this.height=e;var r=new Uint8Array(t*e*4);this.backgroundTexture=Mk(n,n.NEAREST,r,t,e),this.screenTexture=Mk(n,n.NEAREST,r,t,e)}}},{key:"draw",value:function(){var t;if(null!==(t=this.windData)&&void 0!==t&&t.image){var e=this.gl;return Ik(e,this.windTexture,0),Ik(e,this.particleStateTexture0,1),this.drawScreen(),this.updateParticles(),{d:this.pixels,w:this.width,h:this.height}}return{d:new Uint8Array([0,0,0,0]),w:1,h:1}}},{key:"drawScreen",value:function(){var t=this.gl;jk(t,this.framebuffer,this.screenTexture),t.viewport(0,0,this.width,this.height),t.disable(t.BLEND),this.drawFullTexture(this.backgroundTexture,this.fadeOpacity),this.drawParticles(),this.pixels=new Uint8Array(4*this.width*this.height),t.readPixels(0,0,this.width,this.height,t.RGBA,t.UNSIGNED_BYTE,this.pixels),jk(t,null,null),t.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height);var e=this.backgroundTexture;this.backgroundTexture=this.screenTexture,this.screenTexture=e}},{key:"drawFullTexture",value:function(t,e){var n=this.gl,r=this.fullScreenProgram;n.useProgram(r),n.bindBuffer(n.ARRAY_BUFFER,this.quadBuffer),n.vertexAttribPointer(r.a_pos,2,n.FLOAT,!1,0,0),n.enableVertexAttribArray(r.a_pos),n.bindBuffer(n.ARRAY_BUFFER,null),Ik(n,t,2),n.uniform1i(r.u_screen,2),n.uniform1f(r.u_opacity,e),n.drawArrays(n.TRIANGLES,0,6)}},{key:"drawParticles",value:function(){var t=this.gl,e=this.drawProgram;t.useProgram(e),Uk(t,this.particleIndexBuffer,e.a_index,1),Ik(t,this.colorRampTexture,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1i(e.u_color_ramp,2),t.uniform1f(e.u_particles_res,this.particleStateResolution),t.uniform2f(e.u_wind_min,this.windData.uMin,this.windData.vMin),t.uniform2f(e.u_wind_max,this.windData.uMax,this.windData.vMax),t.drawArrays(t.POINTS,0,this.numParticlesSize)}},{key:"updateParticles",value:function(){var t=this.gl;jk(t,this.framebuffer,this.particleStateTexture1),t.viewport(0,0,this.particleStateResolution,this.particleStateResolution);var e=this.updateProgram;t.useProgram(e),Uk(t,this.quadBuffer,e.a_pos,2),t.uniform1i(e.u_wind,0),t.uniform1i(e.u_particles,1),t.uniform1f(e.u_rand_seed,Math.random()),t.uniform2f(e.u_wind_res,2*this.windData.image.width,2*this.windData.image.height),t.uniform2f(e.u_wind_min,this.windData.uMin,this.windData.vMin),t.uniform2f(e.u_wind_max,this.windData.uMax,this.windData.vMax),t.uniform1f(e.u_speed_factor,this.speedFactor),t.uniform1f(e.u_drop_rate,this.dropRate),t.uniform1f(e.u_drop_rate_bump,this.dropRateBump),t.drawArrays(t.TRIANGLES,0,6);var n=this.particleStateTexture0;this.particleStateTexture0=this.particleStateTexture1,this.particleStateTexture1=n,jk(t,null,null)}},{key:"destroy",value:function(){this.gl.deleteBuffer(this.quadBuffer),this.gl.deleteBuffer(this.particleIndexBuffer),this.gl.deleteFramebuffer(this.framebuffer),this.gl.deleteShader(this.drawProgram.vertexShader),this.gl.deleteShader(this.drawProgram.fragmentShader),this.gl.deleteProgram(this.drawProgram),this.gl.deleteShader(this.fullScreenProgram.vertexShader),this.gl.deleteShader(this.fullScreenProgram.fragmentShader),this.gl.deleteProgram(this.fullScreenProgram),this.gl.deleteShader(this.updateProgram.vertexShader),this.gl.deleteShader(this.updateProgram.fragmentShader),this.gl.deleteProgram(this.updateProgram),this.gl.deleteTexture(this.colorRampTexture),this.gl.deleteTexture(this.backgroundTexture),this.gl.deleteTexture(this.screenTexture),this.gl.deleteTexture(this.particleStateTexture0),this.gl.deleteTexture(this.particleStateTexture1),this.gl.deleteTexture(this.windTexture)}}]),t}();function Vk(t){var e=Gk();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Gk(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var Hk="precision mediump float;\nuniform float u_opacity: 1.0;\nuniform sampler2D u_texture;\nvarying vec2 v_texCoord;\nvoid main() {\n  vec4 color = texture2D(u_texture,vec2(v_texCoord.x,v_texCoord.y));\n  gl_FragColor = color;\n  gl_FragColor.a *= u_opacity;\n}\n",Wk='precision highp float;\nuniform mat4 u_ModelMatrix;\nuniform mat4 u_Mvp;\nattribute vec3 a_Position;\nattribute vec2 a_Uv;\nvarying vec2 v_texCoord;\n#pragma include "projection"\nvoid main() {\n   v_texCoord = a_Uv;\n   vec4 project_pos = project_position(vec4(a_Position, 1.0));\n   \n   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\n      gl_Position = u_Mvp * (vec4(project_pos.xy,0., 1.0));\n   } else {\n      gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy,0., 1.0));\n   }\n}\n',qk={0:"#3288bd",.1:"#66c2a5",.2:"#abdda4",.3:"#e6f598",.4:"#fee08b",.5:"#fdae61",.6:"#f46d43",1:"#d53e4f"},Xk=function(t){Yt(n,t);var e=Vk(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"sizeScale",.5),(0,Ft.Z)(Kt(t),"frequency",new yo(7.2)),t}return zt(n,[{key:"render",value:function(t){var e=this;this.drawColorMode(t),this.frequency.run((function(){e.drawWind()}))}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m,g,y,_,x,b,w,E,S,A,T,C,k,M=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i=this.layer.getLayerConfig(),o=i.uMin,a=void 0===o?-21.32:o,s=i.uMax,u=void 0===s?26.8:s,c=i.vMin,l=void 0===c?-21.57:c,h=i.vMax,f=void 0===h?21.42:h,p=i.fadeOpacity,d=void 0===p?.996:p,v=i.speedFactor,m=void 0===v?.25:v,g=i.dropRate,y=void 0===g?.003:g,_=i.dropRateBump,x=void 0===_?.01:_,b=i.rampColors,w=void 0===b?qk:b,E=i.sizeScale,S=void 0===E?.5:E,A=this.rendererService.createTexture2D,T=this.layer.getSource(),this.texture=A({height:0,width:0}),this.cacheZoom=Math.floor(this.mapService.getZoom()),C=this.rendererService.getGLContext(),this.imageCoords=null===(e=T.data)||void 0===e?void 0:e.dataArray[0].coordinates,null===(n=T.data)||void 0===n||null===(r=n.images)||void 0===r||r.then((function(t){var e;M.sizeScale=S*M.getZoomScale();var n=M.getWindSize(),r=n.imageWidth,i=n.imageHeight,o={glContext:C,imageWidth:r,imageHeight:i,fadeOpacity:d,speedFactor:m,dropRate:y,dropRateBump:x,rampColors:w};M.wind=new Zk(o),M.wind.setWind({uMin:a,uMax:u,vMin:l,vMax:f,image:t[0]}),null===(e=M.texture)||void 0===e||e.destroy(),M.texture=A({width:r,height:i}),M.layerService.reRender()})),t.next=10,this.layer.buildLayerModel({moduleName:"wind",vertexShader:Wk,fragmentShader:Hk,triangulation:Fw,primitive:vf.TRIANGLES,depth:{enable:!1}});case 10:return k=t.sent,this.colorModel=k,t.abrupt("return",[k]);case 13:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getWindSize",value:function(){var t=this.mapService.lngLatToPixel(this.imageCoords[0]),e=this.mapService.lngLatToPixel(this.imageCoords[1]),n=Math.min(Math.floor((e.x-t.x)*this.sizeScale),2048),r=Math.min(Math.floor((t.y-e.y)*this.sizeScale),2048);return{imageWidth:n,imageHeight:r}}},{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.initModels());case 1:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"clearModels",value:function(){var t,e;null===(t=this.texture)||void 0===t||t.destroy(),null===(e=this.wind)||void 0===e||e.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Ug.Attribute,descriptor:{name:"a_Uv",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:2,update:function(t,e,n){return[n[3],n[4]]}}})}},{key:"getZoomScale",value:function(){return Math.min((this.cacheZoom+4)/30*2,2)}},{key:"drawWind",value:function(){if(this.wind){var t=this.layer.getLayerConfig(),e=t.uMin,n=void 0===e?-21.32:e,r=t.uMax,i=void 0===r?26.8:r,o=t.vMin,a=void 0===o?-21.57:o,s=t.vMax,u=void 0===s?21.42:s,c=t.numParticles,l=void 0===c?65535:c,h=t.fadeOpacity,f=void 0===h?.996:h,p=t.speedFactor,d=void 0===p?.25:p,v=t.dropRate,m=void 0===v?.003:v,g=t.dropRateBump,y=void 0===g?.01:g,_=t.rampColors,x=void 0===_?qk:_,b=t.sizeScale,w=void 0===b?.5:b,E=l,S=Math.floor(this.mapService.getZoom());if("number"===typeof w&&w!==this.sizeScale||S!==this.cacheZoom){var A=this.getZoomScale();this.sizeScale=w,E*=A;var T=this.getWindSize(),C=T.imageWidth,k=T.imageHeight;this.wind.reSize(C,k),this.cacheZoom=S}this.wind.updateWindDir(n,i,a,u),this.wind.updateParticelNum(E),this.wind.updateColorRampTexture(x),this.wind.fadeOpacity=f,this.wind.speedFactor=d,this.wind.dropRate=m,this.wind.dropRateBump=y;var M=this.wind.draw(),P=M.d,I=M.w,R=M.h;this.rendererService.setBaseState(),this.texture.update({data:P,width:I,height:R})}}},{key:"drawColorMode",value:function(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.layer.getLayerConfig(),r=n.opacity;this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),this.layerService.renderMask(this.layer.masks),null===(t=this.colorModel)||void 0===t||t.draw({uniforms:{u_opacity:r||1,u_texture:this.texture},blend:this.getBlend(),stencil:this.getStencil(e)}),this.layer.hooks.afterRender.call()}}]),n}(Bx),Yk={wind:Xk},Kk=Yk;function Qk(t){var e=Jk();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Jk(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var $k,tM,eM,nM,rM,iM,oM,aM,sM,uM=function(t){Yt(n,t);var e=Qk(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","WindLayer"),t}return zt(n,[{key:"buildModels",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getModelType(),this.layerModel=new Kk[e](this),t.next=4,this.initLayerModels();case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"renderModels",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return this.layerModel&&this.layerModel.render(t),this}},{key:"getDefaultConfig",value:function(){var t=this.getModelType(),e={wind:{}};return e[t]}},{key:"getModelType",value:function(){return"wind"}}]),n}(Dx),cM=($k=(0,xc.b2)(),tM=(0,xc.f3)(wc.IMapService),eM=(0,xc.f3)(wc.IFontService),$k((rM=function(){function t(){Ot(this,t),Oh(this,"mapService",iM,this),Oh(this,"fontService",oM,this)}return zt(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",(0,J.Z)(tt().mark((function e(){return tt().wrap((function(e){while(1)switch(e.prev=e.next){case 0:t.log(Zg.MappingStart,wh.INIT),n.generateMaping(t,{styleAttributeService:r}),t.log(Zg.MappingEnd,wh.INIT);case 3:case"end":return e.stop()}}),e)})))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var e=(0,J.Z)(tt().mark((function e(i){var o;return tt().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",i);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(Zg.MappingStart,wh.UPDATE),o=n.generateMaping(t,{styleAttributeService:r}),t.log(Zg.MappingEnd,wh.UPDATE),e.abrupt("return",o);case 7:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",(function(){var e=t.getSource();if(!t.layerModelNeedUpdate&&e&&e.inited){var i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=e.data.dataArray;if(!Array.isArray(a)||0!==a.length){var s=i.filter((function(t){return t.needRemapping})),u=a;if(null!==o&&void 0!==o&&o.needRemapping&&null!==o&&void 0!==o&&o.scale&&(u=a.filter((function(t){return n.applyAttributeMapping(o,t)[0]}))),s.length){var c=n.mapping(t,s,u,t.getEncodedData());t.setEncodedData(c)}}}}))}},{key:"generateMaping",value:function(t,e){var n=this,r=e.styleAttributeService,i=r.getLayerStyleAttributes()||[],o=r.getLayerStyleAttribute("filter"),a=t.getSource().data.dataArray,s=a;null!==o&&void 0!==o&&o.scale&&(s=a.filter((function(t){return n.applyAttributeMapping(o,t)[0]}))),s=t.processData(s);var u=this.mapping(t,i,s,void 0);return t.setEncodedData(u),(0!==a.length||0!==t.encodeDataLength)&&(t.emit("dataUpdate",null),!0)}},{key:"mapping",value:function(t,e,n,r){var i=this,o=t.getLayerConfig(),a=o.arrow,s=void 0===a?{enable:!1}:a,u=e.filter((function(t){return void 0!==t.scale})).filter((function(t){return"filter"!==t.name})),c=n.map((function(e,n){var o=r?r[n]:{},a=(0,k.Z)({id:e._id,coordinates:e.coordinates},o);if(u.forEach((function(t){var n=i.applyAttributeMapping(t,e);"color"!==t.name&&"stroke"!==t.name||(n=n.map((function(t){return bi(t)}))),a[t.name]=Array.isArray(n)&&1===n.length?n[0]:n,"shape"===t.name&&(a.shape=i.fontService.getIconFontKey(a[t.name]))})),s.enable&&"line"===a.shape){var c=a.coordinates;if(t.arrowInsertCount<t.encodeDataLength){var l=i.getArrowPoints(c[0],c[1]);a.coordinates.splice(1,0,l,l),t.arrowInsertCount++}}return a}));return e.forEach((function(t){t.needRemapping=!1})),this.adjustData2Amap2Coordinates(c,t),this.adjustData2SimpleCoordinates(c),c}},{key:"adjustData2Amap2Coordinates",value:function(t,e){var n=this;if(t.length>0&&this.mapService.version===ux["GAODE2.x"]){var r=e.coordCenter||e.getSource().center;t.filter((function(t){return!t.originCoordinates})).map((function(t){t.version=ux["GAODE2.x"],t.originCoordinates=(0,Oi.cloneDeep)(t.coordinates),t.coordinates=n.mapService.coordToAMap2RelativeCoordinates(t.coordinates,r)}))}}},{key:"adjustData2SimpleCoordinates",value:function(t){var e=this;t.length>0&&this.mapService.version===ux.SIMPLE&&t.map((function(t){t.simpleCoordinate||(t.coordinates=e.unProjectCoordinates(t.coordinates),t.simpleCoordinate=!0)}))}},{key:"unProjectCoordinates",value:function(t){var e=this;if("number"===typeof t[0])return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var n=[];return t.map((function(t){var r=[];t.map((function(t){r.push(e.mapService.simpleMapCoord.unproject(t))})),n.push(r)})),n}var r=[];return t.map((function(t){r.push(e.mapService.simpleMapCoord.unproject(t))})),r}},{key:"applyAttributeMapping",value:function(t,e){var n;if(!t.scale)return[];var r=(null===t||void 0===t||null===(n=t.scale)||void 0===n?void 0:n.scalers)||[],i=[];r.forEach((function(n){var r,o=n.field;(e.hasOwnProperty(o)||"variable"===(null===(r=t.scale)||void 0===r?void 0:r.type))&&i.push(e[o])}));var o=t.mapping?t.mapping(i):[];return o}},{key:"getArrowPoints",value:function(t,e){var n=[e[0]-t[0],e[1]-t[1]],r=Zo(n),i=[t[0]+1e-4*r[0],t[1]+1e-4*r[1]];return i}}]),t}(),iM=Dh(rM.prototype,"mapService",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),oM=Dh(rM.prototype,"fontService",[eM],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nM=rM))||nM),lM=(aM=(0,xc.b2)(),aM(sM=function(){function t(){Ot(this,t)}return zt(t,[{key:"apply",value:function(t){var e=this;this.mapService=t.getContainer().get(wc.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",(0,J.Z)(tt().mark((function n(){var r,i,o,a;return tt().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(t.log(Zg.SourceInitStart,wh.INIT),r=t.getSource(),r||(i=t.sourceOption||t.defaultSourceConfig,o=i.data,a=i.options,r=new Hy(o,a),t.setSource(r)),!r.inited){n.next=8;break}e.updateClusterData(t),t.log(Zg.SourceInitEnd,wh.INIT),n.next=10;break;case 8:return n.next=10,new Promise((function(n){r.on("update",(function(r){"inited"===r.type&&(e.updateClusterData(t),t.log(Zg.SourceInitEnd,wh.INIT)),n(null)}))}));case 10:case"end":return n.stop()}}),n)})))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,J.Z)(tt().mark((function n(){var r,i,o;return tt().wrap((function(n){while(1)switch(n.prev=n.next){case 0:return r=e.updateClusterData(t),i=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,o=r||i,n.abrupt("return",o);case 5:case"end":return n.stop()}}),n)}))))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var e=t.getSource(),n=e.cluster,r=e.clusterOptions.zoom,i=void 0===r?0:r,o=this.mapService.getZoom()-1,a=t.dataState.dataSourceNeedUpdate;return n&&a&&e.updateClusterData(Math.floor(o)),!!(n&&Math.abs(t.clusterZoom-o)>=1)&&(i!==Math.floor(o)&&e.updateClusterData(Math.floor(o)),t.clusterZoom=o,!0)}}]),t}())||sM);function hM(t,e){return t<e?-1:t>e?1:t>=e?0:NaN}function fM(t){return 1===t.length&&(t=pM(t)),{left:function(e,n,r,i){null==r&&(r=0),null==i&&(i=e.length);while(r<i){var o=r+i>>>1;t(e[o],n)<0?r=o+1:i=o}return r},right:function(e,n,r,i){null==r&&(r=0),null==i&&(i=e.length);while(r<i){var o=r+i>>>1;t(e[o],n)>0?i=o:r=o+1}return r}}}function pM(t){return function(e,n){return hM(t(e),n)}}var dM=fM(hM),vM=dM.right,mM=(dM.left,vM);function gM(t,e){var n,r,i,o=t.length,a=-1;if(null==e){while(++a<o)if(null!=(n=t[a])&&n>=n){r=i=n;while(++a<o)null!=(n=t[a])&&(r>n&&(r=n),i<n&&(i=n))}}else while(++a<o)if(null!=(n=e(t[a],a,t))&&n>=n){r=i=n;while(++a<o)null!=(n=e(t[a],a,t))&&(r>n&&(r=n),i<n&&(i=n))}return[r,i]}var yM=Array.prototype,_M=(yM.slice,yM.map,Math.sqrt(50)),xM=Math.sqrt(10),bM=Math.sqrt(2);function wM(t,e,n){var r,i,o,a,s=-1;if(e=+e,t=+t,n=+n,t===e&&n>0)return[t];if((r=e<t)&&(i=t,t=e,e=i),0===(a=EM(t,e,n))||!isFinite(a))return[];if(a>0){t=Math.ceil(t/a),e=Math.floor(e/a),o=new Array(i=Math.ceil(e-t+1));while(++s<i)o[s]=(t+s)*a}else{t=Math.floor(t*a),e=Math.ceil(e*a),o=new Array(i=Math.ceil(t-e+1));while(++s<i)o[s]=(t-s)/a}return r&&o.reverse(),o}function EM(t,e,n){var r=(e-t)/Math.max(0,n),i=Math.floor(Math.log(r)/Math.LN10),o=r/Math.pow(10,i);return i>=0?(o>=_M?10:o>=xM?5:o>=bM?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(o>=_M?10:o>=xM?5:o>=bM?2:1)}function SM(t,e,n){var r=Math.abs(e-t)/Math.max(0,n),i=Math.pow(10,Math.floor(Math.log(r)/Math.LN10)),o=r/i;return o>=_M?i*=10:o>=xM?i*=5:o>=bM&&(i*=2),e<t?-i:i}function AM(t){return null===t?NaN:+t}function TM(t,e,n){if(null==n&&(n=AM),r=t.length){if((e=+e)<=0||r<2)return+n(t[0],0,t);if(e>=1)return+n(t[r-1],r-1,t);var r,i=(r-1)*e,o=Math.floor(i),a=+n(t[o],o,t),s=+n(t[o+1],o+1,t);return a+(s-a)*(i-o)}}function CM(t,e,n,r,i){var o=t*t,a=o*t;return((1-3*t+3*o-a)*e+(4-6*o+3*a)*n+(1+3*t+3*o-3*a)*r+a*i)/6}function kM(t){var e=t.length-1;return function(n){var r=n<=0?n=0:n>=1?(n=1,e-1):Math.floor(n*e),i=t[r],o=t[r+1],a=r>0?t[r-1]:2*i-o,s=r<e-1?t[r+2]:2*o-i;return CM((n-r/e)*e,a,i,o,s)}}function MM(t){var e=t.length;return function(n){var r=Math.floor(((n%=1)<0?++n:n)*e),i=t[(r+e-1)%e],o=t[r%e],a=t[(r+1)%e],s=t[(r+2)%e];return CM((n-r/e)*e,i,o,a,s)}}function PM(t){return function(){return t}}function IM(t,e){return function(n){return t+n*e}}function RM(t,e,n){return t=Math.pow(t,n),e=Math.pow(e,n)-t,n=1/n,function(r){return Math.pow(t+r*e,n)}}function LM(t){return 1===(t=+t)?OM:function(e,n){return n-e?RM(e,n,t):PM(isNaN(e)?n:e)}}function OM(t,e){var n=e-t;return n?IM(t,n):PM(isNaN(t)?e:t)}var DM=function t(e){var n=LM(e);function r(t,e){var r=n((t=li(t)).r,(e=li(e)).r),i=n(t.g,e.g),o=n(t.b,e.b),a=OM(t.opacity,e.opacity);return function(e){return t.r=r(e),t.g=i(e),t.b=o(e),t.opacity=a(e),t+""}}return r.gamma=t,r}(1);function NM(t){return function(e){var n,r,i=e.length,o=new Array(i),a=new Array(i),s=new Array(i);for(n=0;n<i;++n)r=li(e[n]),o[n]=r.r||0,a[n]=r.g||0,s[n]=r.b||0;return o=t(o),a=t(a),s=t(s),r.opacity=1,function(t){return r.r=o(t),r.g=a(t),r.b=s(t),r+""}}}var zM=NM(kM),FM=(NM(MM),"$");function BM(){}function UM(t,e){var n=new BM;if(t instanceof BM)t.each((function(t,e){n.set(e,t)}));else if(Array.isArray(t)){var r,i=-1,o=t.length;if(null==e)while(++i<o)n.set(i,t[i]);else while(++i<o)n.set(e(r=t[i],i,t),r)}else if(t)for(var a in t)n.set(a,t[a]);return n}BM.prototype=UM.prototype={constructor:BM,has:function(t){return FM+t in this},get:function(t){return this[FM+t]},set:function(t,e){return this[FM+t]=e,this},remove:function(t){var e=FM+t;return e in this&&delete this[e]},clear:function(){for(var t in this)t[0]===FM&&delete this[t]},keys:function(){var t=[];for(var e in this)e[0]===FM&&t.push(e.slice(1));return t},values:function(){var t=[];for(var e in this)e[0]===FM&&t.push(this[e]);return t},entries:function(){var t=[];for(var e in this)e[0]===FM&&t.push({key:e.slice(1),value:this[e]});return t},size:function(){var t=0;for(var e in this)e[0]===FM&&++t;return t},empty:function(){for(var t in this)if(t[0]===FM)return!1;return!0},each:function(t){for(var e in this)e[0]===FM&&t(this[e],e.slice(1),this)}};var jM=UM;function ZM(){}var VM=jM.prototype;function GM(t,e){var n=new ZM;if(t instanceof ZM)t.each((function(t){n.add(t)}));else if(t){var r=-1,i=t.length;if(null==e)while(++r<i)n.add(t[r]);else while(++r<i)n.add(e(t[r],r,t))}return n}ZM.prototype=GM.prototype={constructor:ZM,has:VM.has,add:function(t){return t+="",this[FM+t]=t,this},remove:VM.remove,clear:VM.clear,values:VM.keys,size:VM.size,empty:VM.empty,each:VM.each};var HM=Array.prototype,WM=HM.map,qM=HM.slice;function XM(t,e){switch(arguments.length){case 0:break;case 1:this.range(t);break;default:this.range(e).domain(t);break}return this}function YM(t,e){switch(arguments.length){case 0:break;case 1:this.interpolator(t);break;default:this.interpolator(e).domain(t);break}return this}var KM={name:"implicit"};function QM(){var t=jM(),e=[],n=[],r=KM;function i(i){var o=i+"",a=t.get(o);if(!a){if(r!==KM)return r;t.set(o,a=e.push(i))}return n[(a-1)%n.length]}return i.domain=function(n){if(!arguments.length)return e.slice();e=[],t=jM();var r,o,a=-1,s=n.length;while(++a<s)t.has(o=(r=n[a])+"")||t.set(o,e.push(r));return i},i.range=function(t){return arguments.length?(n=qM.call(t),i):n.slice()},i.unknown=function(t){return arguments.length?(r=t,i):r},i.copy=function(){return QM(e,n).unknown(r)},XM.apply(i,arguments),i}function JM(t,e){var n,r=e?e.length:0,i=t?Math.min(r,t.length):0,o=new Array(i),a=new Array(r);for(n=0;n<i;++n)o[n]=cP(t[n],e[n]);for(;n<r;++n)a[n]=e[n];return function(t){for(n=0;n<i;++n)a[n]=o[n](t);return a}}function $M(t,e){var n=new Date;return t=+t,e=+e,function(r){return n.setTime(t*(1-r)+e*r),n}}function tP(t,e){return t=+t,e=+e,function(n){return t*(1-n)+e*n}}function eP(t,e){var n,r={},i={};for(n in null!==t&&"object"===(0,I.Z)(t)||(t={}),null!==e&&"object"===(0,I.Z)(e)||(e={}),e)n in t?r[n]=cP(t[n],e[n]):i[n]=e[n];return function(t){for(n in r)i[n]=r[n](t);return i}}var nP=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,rP=new RegExp(nP.source,"g");function iP(t){return function(){return t}}function oP(t){return function(e){return t(e)+""}}function aP(t,e){var n,r,i,o=nP.lastIndex=rP.lastIndex=0,a=-1,s=[],u=[];t+="",e+="";while((n=nP.exec(t))&&(r=rP.exec(e)))(i=r.index)>o&&(i=e.slice(o,i),s[a]?s[a]+=i:s[++a]=i),(n=n[0])===(r=r[0])?s[a]?s[a]+=r:s[++a]=r:(s[++a]=null,u.push({i:a,x:tP(n,r)})),o=rP.lastIndex;return o<e.length&&(i=e.slice(o),s[a]?s[a]+=i:s[++a]=i),s.length<2?u[0]?oP(u[0].x):iP(e):(e=u.length,function(t){for(var n,r=0;r<e;++r)s[(n=u[r]).i]=n.x(t);return s.join("")})}function sP(t,e){e||(e=[]);var n,r=t?Math.min(e.length,t.length):0,i=e.slice();return function(o){for(n=0;n<r;++n)i[n]=t[n]*(1-o)+e[n]*o;return i}}function uP(t){return ArrayBuffer.isView(t)&&!(t instanceof DataView)}function cP(t,e){var n,r=(0,I.Z)(e);return null==e||"boolean"===r?PM(e):("number"===r?tP:"string"===r?(n=ai(e))?(e=n,DM):aP:e instanceof ai?DM:e instanceof Date?$M:uP(e)?sP:Array.isArray(e)?JM:"function"!==typeof e.valueOf&&"function"!==typeof e.toString||isNaN(e)?eP:tP)(t,e)}function lP(t,e){return t=+t,e=+e,function(n){return Math.round(t*(1-n)+e*n)}}function hP(t){return function(){return t}}function fP(t){return+t}var pP=[0,1];function dP(t){return t}function vP(t,e){return(e-=t=+t)?function(n){return(n-t)/e}:hP(isNaN(e)?NaN:.5)}function mP(t){var e,n=t[0],r=t[t.length-1];return n>r&&(e=n,n=r,r=e),function(t){return Math.max(n,Math.min(r,t))}}function gP(t,e,n){var r=t[0],i=t[1],o=e[0],a=e[1];return i<r?(r=vP(i,r),o=n(a,o)):(r=vP(r,i),o=n(o,a)),function(t){return o(r(t))}}function yP(t,e,n){var r=Math.min(t.length,e.length)-1,i=new Array(r),o=new Array(r),a=-1;t[r]<t[0]&&(t=t.slice().reverse(),e=e.slice().reverse());while(++a<r)i[a]=vP(t[a],t[a+1]),o[a]=n(e[a],e[a+1]);return function(e){var n=mM(t,e,1,r)-1;return o[n](i[n](e))}}function _P(t,e){return e.domain(t.domain()).range(t.range()).interpolate(t.interpolate()).clamp(t.clamp()).unknown(t.unknown())}function xP(){var t,e,n,r,i,o,a=pP,s=pP,u=cP,c=dP;function l(){return r=Math.min(a.length,s.length)>2?yP:gP,i=o=null,h}function h(e){return isNaN(e=+e)?n:(i||(i=r(a.map(t),s,u)))(t(c(e)))}return h.invert=function(n){return c(e((o||(o=r(s,a.map(t),tP)))(n)))},h.domain=function(t){return arguments.length?(a=WM.call(t,fP),c===dP||(c=mP(a)),l()):a.slice()},h.range=function(t){return arguments.length?(s=qM.call(t),l()):s.slice()},h.rangeRound=function(t){return s=qM.call(t),u=lP,l()},h.clamp=function(t){return arguments.length?(c=t?mP(a):dP,h):c!==dP},h.interpolate=function(t){return arguments.length?(u=t,l()):u},h.unknown=function(t){return arguments.length?(n=t,h):n},function(n,r){return t=n,e=r,l()}}function bP(t,e){return xP()(t,e)}var wP,EP=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function SP(t){if(!(e=EP.exec(t)))throw new Error("invalid format: "+t);var e;return new AP({fill:e[1],align:e[2],sign:e[3],symbol:e[4],zero:e[5],width:e[6],comma:e[7],precision:e[8]&&e[8].slice(1),trim:e[9],type:e[10]})}function AP(t){this.fill=void 0===t.fill?" ":t.fill+"",this.align=void 0===t.align?">":t.align+"",this.sign=void 0===t.sign?"-":t.sign+"",this.symbol=void 0===t.symbol?"":t.symbol+"",this.zero=!!t.zero,this.width=void 0===t.width?void 0:+t.width,this.comma=!!t.comma,this.precision=void 0===t.precision?void 0:+t.precision,this.trim=!!t.trim,this.type=void 0===t.type?"":t.type+""}function TP(t){return Math.abs(t=Math.round(t))>=1e21?t.toLocaleString("en").replace(/,/g,""):t.toString(10)}function CP(t,e){if((n=(t=e?t.toExponential(e-1):t.toExponential()).indexOf("e"))<0)return null;var n,r=t.slice(0,n);return[r.length>1?r[0]+r.slice(2):r,+t.slice(n+1)]}function kP(t){return t=CP(Math.abs(t)),t?t[1]:NaN}function MP(t,e){return Math.max(0,3*Math.max(-8,Math.min(8,Math.floor(kP(e)/3)))-kP(Math.abs(t)))}function PP(t,e){return function(n,r){var i=n.length,o=[],a=0,s=t[0],u=0;while(i>0&&s>0){if(u+s+1>r&&(s=Math.max(1,r-u)),o.push(n.substring(i-=s,i+s)),(u+=s+1)>r)break;s=t[a=(a+1)%t.length]}return o.reverse().join(e)}}function IP(t){return function(e){return e.replace(/[0-9]/g,(function(e){return t[+e]}))}}function RP(t){t:for(var e,n=t.length,r=1,i=-1;r<n;++r)switch(t[r]){case".":i=e=r;break;case"0":0===i&&(i=r),e=r;break;default:if(!+t[r])break t;i>0&&(i=0);break}return i>0?t.slice(0,i)+t.slice(e+1):t}function LP(t,e){var n=CP(t,e);if(!n)return t+"";var r=n[0],i=n[1],o=i-(wP=3*Math.max(-8,Math.min(8,Math.floor(i/3))))+1,a=r.length;return o===a?r:o>a?r+new Array(o-a+1).join("0"):o>0?r.slice(0,o)+"."+r.slice(o):"0."+new Array(1-o).join("0")+CP(t,Math.max(0,e+o-1))[0]}function OP(t,e){var n=CP(t,e);if(!n)return t+"";var r=n[0],i=n[1];return i<0?"0."+new Array(-i).join("0")+r:r.length>i+1?r.slice(0,i+1)+"."+r.slice(i+1):r+new Array(i-r.length+2).join("0")}SP.prototype=AP.prototype,AP.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(void 0===this.width?"":Math.max(1,0|this.width))+(this.comma?",":"")+(void 0===this.precision?"":"."+Math.max(0,0|this.precision))+(this.trim?"~":"")+this.type};var DP={"%":function(t,e){return(100*t).toFixed(e)},b:function(t){return Math.round(t).toString(2)},c:function(t){return t+""},d:TP,e:function(t,e){return t.toExponential(e)},f:function(t,e){return t.toFixed(e)},g:function(t,e){return t.toPrecision(e)},o:function(t){return Math.round(t).toString(8)},p:function(t,e){return OP(100*t,e)},r:OP,s:LP,X:function(t){return Math.round(t).toString(16).toUpperCase()},x:function(t){return Math.round(t).toString(16)}};function NP(t){return t}var zP,FP,BP,UP=Array.prototype.map,jP=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function ZP(t){var e=void 0===t.grouping||void 0===t.thousands?NP:PP(UP.call(t.grouping,Number),t.thousands+""),n=void 0===t.currency?"":t.currency[0]+"",r=void 0===t.currency?"":t.currency[1]+"",i=void 0===t.decimal?".":t.decimal+"",o=void 0===t.numerals?NP:IP(UP.call(t.numerals,String)),a=void 0===t.percent?"%":t.percent+"",s=void 0===t.minus?"-":t.minus+"",u=void 0===t.nan?"NaN":t.nan+"";function c(t){t=SP(t);var c=t.fill,l=t.align,h=t.sign,f=t.symbol,p=t.zero,d=t.width,v=t.comma,m=t.precision,g=t.trim,y=t.type;"n"===y?(v=!0,y="g"):DP[y]||(void 0===m&&(m=12),g=!0,y="g"),(p||"0"===c&&"="===l)&&(p=!0,c="0",l="=");var _="$"===f?n:"#"===f&&/[boxX]/.test(y)?"0"+y.toLowerCase():"",x="$"===f?r:/[%p]/.test(y)?a:"",b=DP[y],w=/[defgprs%]/.test(y);function E(t){var n,r,a,f=_,E=x;if("c"===y)E=b(t)+E,t="";else{t=+t;var S=t<0||1/t<0;if(t=isNaN(t)?u:b(Math.abs(t),m),g&&(t=RP(t)),S&&0===+t&&"+"!==h&&(S=!1),f=(S?"("===h?h:s:"-"===h||"("===h?"":h)+f,E=("s"===y?jP[8+wP/3]:"")+E+(S&&"("===h?")":""),w){n=-1,r=t.length;while(++n<r)if(a=t.charCodeAt(n),48>a||a>57){E=(46===a?i+t.slice(n+1):t.slice(n))+E,t=t.slice(0,n);break}}}v&&!p&&(t=e(t,1/0));var A=f.length+t.length+E.length,T=A<d?new Array(d-A+1).join(c):"";switch(v&&p&&(t=e(T+t,T.length?d-E.length:1/0),T=""),l){case"<":t=f+t+E+T;break;case"=":t=f+T+t+E;break;case"^":t=T.slice(0,A=T.length>>1)+f+t+E+T.slice(A);break;default:t=T+f+t+E;break}return o(t)}return m=void 0===m?6:/[gprs]/.test(y)?Math.max(1,Math.min(21,m)):Math.max(0,Math.min(20,m)),E.toString=function(){return t+""},E}function l(t,e){var n=c((t=SP(t),t.type="f",t)),r=3*Math.max(-8,Math.min(8,Math.floor(kP(e)/3))),i=Math.pow(10,-r),o=jP[8+r/3];return function(t){return n(i*t)+o}}return{format:c,formatPrefix:l}}function VP(t){return zP=ZP(t),FP=zP.format,BP=zP.formatPrefix,zP}function GP(t,e){return t=Math.abs(t),e=Math.abs(e)-t,Math.max(0,kP(e)-kP(t))+1}function HP(t){return Math.max(0,-kP(Math.abs(t)))}function WP(t,e,n,r){var i,o=SM(t,e,n);switch(r=SP(null==r?",f":r),r.type){case"s":var a=Math.max(Math.abs(t),Math.abs(e));return null!=r.precision||isNaN(i=MP(o,a))||(r.precision=i),BP(r,a);case"":case"e":case"g":case"p":case"r":null!=r.precision||isNaN(i=GP(o,Math.max(Math.abs(t),Math.abs(e))))||(r.precision=i-("e"===r.type));break;case"f":case"%":null!=r.precision||isNaN(i=HP(o))||(r.precision=i-2*("%"===r.type));break}return FP(r)}function qP(t){var e=t.domain;return t.ticks=function(t){var n=e();return wM(n[0],n[n.length-1],null==t?10:t)},t.tickFormat=function(t,n){var r=e();return WP(r[0],r[r.length-1],null==t?10:t,n)},t.nice=function(n){null==n&&(n=10);var r,i=e(),o=0,a=i.length-1,s=i[o],u=i[a];return u<s&&(r=s,s=u,u=r,r=o,o=a,a=r),r=EM(s,u,n),r>0?(s=Math.floor(s/r)*r,u=Math.ceil(u/r)*r,r=EM(s,u,n)):r<0&&(s=Math.ceil(s*r)/r,u=Math.floor(u*r)/r,r=EM(s,u,n)),r>0?(i[o]=Math.floor(s/r)*r,i[a]=Math.ceil(u/r)*r,e(i)):r<0&&(i[o]=Math.ceil(s*r)/r,i[a]=Math.floor(u*r)/r,e(i)),t},t}function XP(){var t=bP(dP,dP);return t.copy=function(){return _P(t,XP())},XM.apply(t,arguments),qP(t)}function YP(t,e){t=t.slice();var n,r=0,i=t.length-1,o=t[r],a=t[i];return a<o&&(n=r,r=i,i=n,n=o,o=a,a=n),t[r]=e.floor(o),t[i]=e.ceil(a),t}function KP(t){return Math.log(t)}function QP(t){return Math.exp(t)}function JP(t){return-Math.log(-t)}function $P(t){return-Math.exp(-t)}function tI(t){return isFinite(t)?+("1e"+t):t<0?0:t}function eI(t){return 10===t?tI:t===Math.E?Math.exp:function(e){return Math.pow(t,e)}}function nI(t){return t===Math.E?Math.log:10===t&&Math.log10||2===t&&Math.log2||(t=Math.log(t),function(e){return Math.log(e)/t})}function rI(t){return function(e){return-t(-e)}}function iI(t){var e,n,r=t(KP,QP),i=r.domain,o=10;function a(){return e=nI(o),n=eI(o),i()[0]<0?(e=rI(e),n=rI(n),t(JP,$P)):t(KP,QP),r}return r.base=function(t){return arguments.length?(o=+t,a()):o},r.domain=function(t){return arguments.length?(i(t),a()):i()},r.ticks=function(t){var r,a=i(),s=a[0],u=a[a.length-1];(r=u<s)&&(f=s,s=u,u=f);var c,l,h,f=e(s),p=e(u),d=null==t?10:+t,v=[];if(!(o%1)&&p-f<d){if(f=Math.round(f)-1,p=Math.round(p)+1,s>0){for(;f<p;++f)for(l=1,c=n(f);l<o;++l)if(h=c*l,!(h<s)){if(h>u)break;v.push(h)}}else for(;f<p;++f)for(l=o-1,c=n(f);l>=1;--l)if(h=c*l,!(h<s)){if(h>u)break;v.push(h)}}else v=wM(f,p,Math.min(p-f,d)).map(n);return r?v.reverse():v},r.tickFormat=function(t,i){if(null==i&&(i=10===o?".0e":","),"function"!==typeof i&&(i=FP(i)),t===1/0)return i;null==t&&(t=10);var a=Math.max(1,o*t/r.ticks().length);return function(t){var r=t/n(Math.round(e(t)));return r*o<o-.5&&(r*=o),r<=a?i(t):""}},r.nice=function(){return i(YP(i(),{floor:function(t){return n(Math.floor(e(t)))},ceil:function(t){return n(Math.ceil(e(t)))}}))},r}function oI(){var t=iI(xP()).domain([1,10]);return t.copy=function(){return _P(t,oI()).base(t.base())},XM.apply(t,arguments),t}function aI(t){return function(e){return e<0?-Math.pow(-e,t):Math.pow(e,t)}}function sI(t){return t<0?-Math.sqrt(-t):Math.sqrt(t)}function uI(t){return t<0?-t*t:t*t}function cI(t){var e=t(dP,dP),n=1;function r(){return 1===n?t(dP,dP):.5===n?t(sI,uI):t(aI(n),aI(1/n))}return e.exponent=function(t){return arguments.length?(n=+t,r()):n},qP(e)}function lI(){var t=cI(xP());return t.copy=function(){return _P(t,lI()).exponent(t.exponent())},XM.apply(t,arguments),t}function hI(){var t,e=[],n=[],r=[];function i(){var t=0,i=Math.max(1,n.length);r=new Array(i-1);while(++t<i)r[t-1]=TM(e,t/i);return o}function o(e){return isNaN(e=+e)?t:n[mM(r,e)]}return o.invertExtent=function(t){var i=n.indexOf(t);return i<0?[NaN,NaN]:[i>0?r[i-1]:e[0],i<r.length?r[i]:e[e.length-1]]},o.domain=function(t){if(!arguments.length)return e.slice();e=[];for(var n,r=0,o=t.length;r<o;++r)n=t[r],null==n||isNaN(n=+n)||e.push(n);return e.sort(hM),i()},o.range=function(t){return arguments.length?(n=qM.call(t),i()):n.slice()},o.unknown=function(e){return arguments.length?(t=e,o):t},o.quantiles=function(){return r.slice()},o.copy=function(){return hI().domain(e).range(n).unknown(t)},XM.apply(o,arguments)}function fI(){var t,e=0,n=1,r=1,i=[.5],o=[0,1];function a(e){return e<=e?o[mM(i,e,0,r)]:t}function s(){var t=-1;i=new Array(r);while(++t<r)i[t]=((t+1)*n-(t-r)*e)/(r+1);return a}return a.domain=function(t){return arguments.length?(e=+t[0],n=+t[1],s()):[e,n]},a.range=function(t){return arguments.length?(r=(o=qM.call(t)).length-1,s()):o.slice()},a.invertExtent=function(t){var a=o.indexOf(t);return a<0?[NaN,NaN]:a<1?[e,i[0]]:a>=r?[i[r-1],n]:[i[a-1],i[a]]},a.unknown=function(e){return arguments.length?(t=e,a):a},a.thresholds=function(){return i.slice()},a.copy=function(){return fI().domain([e,n]).range(o).unknown(t)},XM.apply(qP(a),arguments)}function pI(){var t,e=[.5],n=[0,1],r=1;function i(i){return i<=i?n[mM(e,i,0,r)]:t}return i.domain=function(t){return arguments.length?(e=qM.call(t),r=Math.min(e.length,n.length-1),i):e.slice()},i.range=function(t){return arguments.length?(n=qM.call(t),r=Math.min(e.length,n.length-1),i):n.slice()},i.invertExtent=function(t){var r=n.indexOf(t);return[e[r-1],e[r]]},i.unknown=function(e){return arguments.length?(t=e,i):t},i.copy=function(){return pI().domain(e).range(n).unknown(t)},XM.apply(i,arguments)}VP({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});var dI=new Date,vI=new Date;function mI(t,e,n,r){function i(e){return t(e=0===arguments.length?new Date:new Date(+e)),e}return i.floor=function(e){return t(e=new Date(+e)),e},i.ceil=function(n){return t(n=new Date(n-1)),e(n,1),t(n),n},i.round=function(t){var e=i(t),n=i.ceil(t);return t-e<n-t?e:n},i.offset=function(t,n){return e(t=new Date(+t),null==n?1:Math.floor(n)),t},i.range=function(n,r,o){var a,s=[];if(n=i.ceil(n),o=null==o?1:Math.floor(o),!(n<r)||!(o>0))return s;do{s.push(a=new Date(+n)),e(n,o),t(n)}while(a<n&&n<r);return s},i.filter=function(n){return mI((function(e){if(e>=e)while(t(e),!n(e))e.setTime(e-1)}),(function(t,r){if(t>=t)if(r<0)while(++r<=0)while(e(t,-1),!n(t));else while(--r>=0)while(e(t,1),!n(t));}))},n&&(i.count=function(e,r){return dI.setTime(+e),vI.setTime(+r),t(dI),t(vI),Math.floor(n(dI,vI))},i.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?i.filter(r?function(e){return r(e)%t===0}:function(e){return i.count(0,e)%t===0}):i:null}),i}var gI=mI((function(t){t.setMonth(0,1),t.setHours(0,0,0,0)}),(function(t,e){t.setFullYear(t.getFullYear()+e)}),(function(t,e){return e.getFullYear()-t.getFullYear()}),(function(t){return t.getFullYear()}));gI.every=function(t){return isFinite(t=Math.floor(t))&&t>0?mI((function(e){e.setFullYear(Math.floor(e.getFullYear()/t)*t),e.setMonth(0,1),e.setHours(0,0,0,0)}),(function(e,n){e.setFullYear(e.getFullYear()+n*t)})):null};var yI=gI,_I=(gI.range,mI((function(t){t.setDate(1),t.setHours(0,0,0,0)}),(function(t,e){t.setMonth(t.getMonth()+e)}),(function(t,e){return e.getMonth()-t.getMonth()+12*(e.getFullYear()-t.getFullYear())}),(function(t){return t.getMonth()}))),xI=_I,bI=(_I.range,1e3),wI=6e4,EI=36e5,SI=864e5,AI=6048e5;function TI(t){return mI((function(e){e.setDate(e.getDate()-(e.getDay()+7-t)%7),e.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+7*e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*wI)/AI}))}var CI=TI(0),kI=TI(1),MI=TI(2),PI=TI(3),II=TI(4),RI=TI(5),LI=TI(6),OI=(CI.range,kI.range,MI.range,PI.range,II.range,RI.range,LI.range,mI((function(t){t.setHours(0,0,0,0)}),(function(t,e){t.setDate(t.getDate()+e)}),(function(t,e){return(e-t-(e.getTimezoneOffset()-t.getTimezoneOffset())*wI)/SI}),(function(t){return t.getDate()-1}))),DI=OI,NI=(OI.range,mI((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*bI-t.getMinutes()*wI)}),(function(t,e){t.setTime(+t+e*EI)}),(function(t,e){return(e-t)/EI}),(function(t){return t.getHours()}))),zI=NI,FI=(NI.range,mI((function(t){t.setTime(t-t.getMilliseconds()-t.getSeconds()*bI)}),(function(t,e){t.setTime(+t+e*wI)}),(function(t,e){return(e-t)/wI}),(function(t){return t.getMinutes()}))),BI=FI,UI=(FI.range,mI((function(t){t.setTime(t-t.getMilliseconds())}),(function(t,e){t.setTime(+t+e*bI)}),(function(t,e){return(e-t)/bI}),(function(t){return t.getUTCSeconds()}))),jI=UI,ZI=(UI.range,mI((function(){}),(function(t,e){t.setTime(+t+e)}),(function(t,e){return e-t})));ZI.every=function(t){return t=Math.floor(t),isFinite(t)&&t>0?t>1?mI((function(e){e.setTime(Math.floor(e/t)*t)}),(function(e,n){e.setTime(+e+n*t)}),(function(e,n){return(n-e)/t})):ZI:null};var VI=ZI;ZI.range;function GI(t){return mI((function(e){e.setUTCDate(e.getUTCDate()-(e.getUTCDay()+7-t)%7),e.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+7*e)}),(function(t,e){return(e-t)/AI}))}var HI=GI(0),WI=GI(1),qI=GI(2),XI=GI(3),YI=GI(4),KI=GI(5),QI=GI(6),JI=(HI.range,WI.range,qI.range,XI.range,YI.range,KI.range,QI.range,mI((function(t){t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCDate(t.getUTCDate()+e)}),(function(t,e){return(e-t)/SI}),(function(t){return t.getUTCDate()-1}))),$I=JI,tR=(JI.range,mI((function(t){t.setUTCMonth(0,1),t.setUTCHours(0,0,0,0)}),(function(t,e){t.setUTCFullYear(t.getUTCFullYear()+e)}),(function(t,e){return e.getUTCFullYear()-t.getUTCFullYear()}),(function(t){return t.getUTCFullYear()})));tR.every=function(t){return isFinite(t=Math.floor(t))&&t>0?mI((function(e){e.setUTCFullYear(Math.floor(e.getUTCFullYear()/t)*t),e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)}),(function(e,n){e.setUTCFullYear(e.getUTCFullYear()+n*t)})):null};var eR=tR;tR.range;function nR(t){if(0<=t.y&&t.y<100){var e=new Date(-1,t.m,t.d,t.H,t.M,t.S,t.L);return e.setFullYear(t.y),e}return new Date(t.y,t.m,t.d,t.H,t.M,t.S,t.L)}function rR(t){if(0<=t.y&&t.y<100){var e=new Date(Date.UTC(-1,t.m,t.d,t.H,t.M,t.S,t.L));return e.setUTCFullYear(t.y),e}return new Date(Date.UTC(t.y,t.m,t.d,t.H,t.M,t.S,t.L))}function iR(t,e,n){return{y:t,m:e,d:n,H:0,M:0,S:0,L:0}}function oR(t){var e=t.dateTime,n=t.date,r=t.time,i=t.periods,o=t.days,a=t.shortDays,s=t.months,u=t.shortMonths,c=dR(i),l=vR(i),h=dR(o),f=vR(o),p=dR(a),d=vR(a),v=dR(s),m=vR(s),g=dR(u),y=vR(u),_={a:L,A:O,b:D,B:N,c:null,d:NR,e:NR,f:jR,g:JR,G:tL,H:zR,I:FR,j:BR,L:UR,m:ZR,M:VR,p:z,q:F,Q:EL,s:SL,S:GR,u:HR,U:WR,V:XR,w:YR,W:KR,x:null,X:null,y:QR,Y:$R,Z:eL,"%":wL},x={a:B,A:U,b:j,B:Z,c:null,d:nL,e:nL,f:sL,g:yL,G:xL,H:rL,I:iL,j:oL,L:aL,m:uL,M:cL,p:V,q:G,Q:EL,s:SL,S:lL,u:hL,U:fL,V:dL,w:vL,W:mL,x:null,X:null,y:gL,Y:_L,Z:bL,"%":wL},b={a:T,A:C,b:k,B:M,c:P,d:TR,e:TR,f:RR,g:wR,G:bR,H:kR,I:kR,j:CR,L:IR,m:AR,M:MR,p:A,q:SR,Q:OR,s:DR,S:PR,u:gR,U:yR,V:_R,w:mR,W:xR,x:I,X:R,y:wR,Y:bR,Z:ER,"%":LR};function w(t,e){return function(n){var r,i,o,a=[],s=-1,u=0,c=t.length;n instanceof Date||(n=new Date(+n));while(++s<c)37===t.charCodeAt(s)&&(a.push(t.slice(u,s)),null!=(i=uR[r=t.charAt(++s)])?r=t.charAt(++s):i="e"===r?" ":"0",(o=e[r])&&(r=o(n,i)),a.push(r),u=s+1);return a.push(t.slice(u,s)),a.join("")}}function E(t,e){return function(n){var r,i,o=iR(1900,void 0,1),a=S(o,t,n+="",0);if(a!=n.length)return null;if("Q"in o)return new Date(o.Q);if("s"in o)return new Date(1e3*o.s+("L"in o?o.L:0));if(e&&!("Z"in o)&&(o.Z=0),"p"in o&&(o.H=o.H%12+12*o.p),void 0===o.m&&(o.m="q"in o?o.q:0),"V"in o){if(o.V<1||o.V>53)return null;"w"in o||(o.w=1),"Z"in o?(r=rR(iR(o.y,0,1)),i=r.getUTCDay(),r=i>4||0===i?WI.ceil(r):WI(r),r=$I.offset(r,7*(o.V-1)),o.y=r.getUTCFullYear(),o.m=r.getUTCMonth(),o.d=r.getUTCDate()+(o.w+6)%7):(r=nR(iR(o.y,0,1)),i=r.getDay(),r=i>4||0===i?kI.ceil(r):kI(r),r=DI.offset(r,7*(o.V-1)),o.y=r.getFullYear(),o.m=r.getMonth(),o.d=r.getDate()+(o.w+6)%7)}else("W"in o||"U"in o)&&("w"in o||(o.w="u"in o?o.u%7:"W"in o?1:0),i="Z"in o?rR(iR(o.y,0,1)).getUTCDay():nR(iR(o.y,0,1)).getDay(),o.m=0,o.d="W"in o?(o.w+6)%7+7*o.W-(i+5)%7:o.w+7*o.U-(i+6)%7);return"Z"in o?(o.H+=o.Z/100|0,o.M+=o.Z%100,rR(o)):nR(o)}}function S(t,e,n,r){var i,o,a=0,s=e.length,u=n.length;while(a<s){if(r>=u)return-1;if(i=e.charCodeAt(a++),37===i){if(i=e.charAt(a++),o=b[i in uR?e.charAt(a++):i],!o||(r=o(t,n,r))<0)return-1}else if(i!=n.charCodeAt(r++))return-1}return r}function A(t,e,n){var r=c.exec(e.slice(n));return r?(t.p=l[r[0].toLowerCase()],n+r[0].length):-1}function T(t,e,n){var r=p.exec(e.slice(n));return r?(t.w=d[r[0].toLowerCase()],n+r[0].length):-1}function C(t,e,n){var r=h.exec(e.slice(n));return r?(t.w=f[r[0].toLowerCase()],n+r[0].length):-1}function k(t,e,n){var r=g.exec(e.slice(n));return r?(t.m=y[r[0].toLowerCase()],n+r[0].length):-1}function M(t,e,n){var r=v.exec(e.slice(n));return r?(t.m=m[r[0].toLowerCase()],n+r[0].length):-1}function P(t,n,r){return S(t,e,n,r)}function I(t,e,r){return S(t,n,e,r)}function R(t,e,n){return S(t,r,e,n)}function L(t){return a[t.getDay()]}function O(t){return o[t.getDay()]}function D(t){return u[t.getMonth()]}function N(t){return s[t.getMonth()]}function z(t){return i[+(t.getHours()>=12)]}function F(t){return 1+~~(t.getMonth()/3)}function B(t){return a[t.getUTCDay()]}function U(t){return o[t.getUTCDay()]}function j(t){return u[t.getUTCMonth()]}function Z(t){return s[t.getUTCMonth()]}function V(t){return i[+(t.getUTCHours()>=12)]}function G(t){return 1+~~(t.getUTCMonth()/3)}return _.x=w(n,_),_.X=w(r,_),_.c=w(e,_),x.x=w(n,x),x.X=w(r,x),x.c=w(e,x),{format:function(t){var e=w(t+="",_);return e.toString=function(){return t},e},parse:function(t){var e=E(t+="",!1);return e.toString=function(){return t},e},utcFormat:function(t){var e=w(t+="",x);return e.toString=function(){return t},e},utcParse:function(t){var e=E(t+="",!0);return e.toString=function(){return t},e}}}var aR,sR,uR={"-":"",_:" ",0:"0"},cR=/^\s*\d+/,lR=/^%/,hR=/[\\^$*+?|[\]().{}]/g;function fR(t,e,n){var r=t<0?"-":"",i=(r?-t:t)+"",o=i.length;return r+(o<n?new Array(n-o+1).join(e)+i:i)}function pR(t){return t.replace(hR,"\\$&")}function dR(t){return new RegExp("^(?:"+t.map(pR).join("|")+")","i")}function vR(t){var e={},n=-1,r=t.length;while(++n<r)e[t[n].toLowerCase()]=n;return e}function mR(t,e,n){var r=cR.exec(e.slice(n,n+1));return r?(t.w=+r[0],n+r[0].length):-1}function gR(t,e,n){var r=cR.exec(e.slice(n,n+1));return r?(t.u=+r[0],n+r[0].length):-1}function yR(t,e,n){var r=cR.exec(e.slice(n,n+2));return r?(t.U=+r[0],n+r[0].length):-1}function _R(t,e,n){var r=cR.exec(e.slice(n,n+2));return r?(t.V=+r[0],n+r[0].length):-1}function xR(t,e,n){var r=cR.exec(e.slice(n,n+2));return r?(t.W=+r[0],n+r[0].length):-1}function bR(t,e,n){var r=cR.exec(e.slice(n,n+4));return r?(t.y=+r[0],n+r[0].length):-1}function wR(t,e,n){var r=cR.exec(e.slice(n,n+2));return r?(t.y=+r[0]+(+r[0]>68?1900:2e3),n+r[0].length):-1}function ER(t,e,n){var r=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(e.slice(n,n+6));return r?(t.Z=r[1]?0:-(r[2]+(r[3]||"00")),n+r[0].length):-1}function SR(t,e,n){var r=cR.exec(e.slice(n,n+1));return r?(t.q=3*r[0]-3,n+r[0].length):-1}function AR(t,e,n){var r=cR.exec(e.slice(n,n+2));return r?(t.m=r[0]-1,n+r[0].length):-1}function TR(t,e,n){var r=cR.exec(e.slice(n,n+2));return r?(t.d=+r[0],n+r[0].length):-1}function CR(t,e,n){var r=cR.exec(e.slice(n,n+3));return r?(t.m=0,t.d=+r[0],n+r[0].length):-1}function kR(t,e,n){var r=cR.exec(e.slice(n,n+2));return r?(t.H=+r[0],n+r[0].length):-1}function MR(t,e,n){var r=cR.exec(e.slice(n,n+2));return r?(t.M=+r[0],n+r[0].length):-1}function PR(t,e,n){var r=cR.exec(e.slice(n,n+2));return r?(t.S=+r[0],n+r[0].length):-1}function IR(t,e,n){var r=cR.exec(e.slice(n,n+3));return r?(t.L=+r[0],n+r[0].length):-1}function RR(t,e,n){var r=cR.exec(e.slice(n,n+6));return r?(t.L=Math.floor(r[0]/1e3),n+r[0].length):-1}function LR(t,e,n){var r=lR.exec(e.slice(n,n+1));return r?n+r[0].length:-1}function OR(t,e,n){var r=cR.exec(e.slice(n));return r?(t.Q=+r[0],n+r[0].length):-1}function DR(t,e,n){var r=cR.exec(e.slice(n));return r?(t.s=+r[0],n+r[0].length):-1}function NR(t,e){return fR(t.getDate(),e,2)}function zR(t,e){return fR(t.getHours(),e,2)}function FR(t,e){return fR(t.getHours()%12||12,e,2)}function BR(t,e){return fR(1+DI.count(yI(t),t),e,3)}function UR(t,e){return fR(t.getMilliseconds(),e,3)}function jR(t,e){return UR(t,e)+"000"}function ZR(t,e){return fR(t.getMonth()+1,e,2)}function VR(t,e){return fR(t.getMinutes(),e,2)}function GR(t,e){return fR(t.getSeconds(),e,2)}function HR(t){var e=t.getDay();return 0===e?7:e}function WR(t,e){return fR(CI.count(yI(t)-1,t),e,2)}function qR(t){var e=t.getDay();return e>=4||0===e?II(t):II.ceil(t)}function XR(t,e){return t=qR(t),fR(II.count(yI(t),t)+(4===yI(t).getDay()),e,2)}function YR(t){return t.getDay()}function KR(t,e){return fR(kI.count(yI(t)-1,t),e,2)}function QR(t,e){return fR(t.getFullYear()%100,e,2)}function JR(t,e){return t=qR(t),fR(t.getFullYear()%100,e,2)}function $R(t,e){return fR(t.getFullYear()%1e4,e,4)}function tL(t,e){var n=t.getDay();return t=n>=4||0===n?II(t):II.ceil(t),fR(t.getFullYear()%1e4,e,4)}function eL(t){var e=t.getTimezoneOffset();return(e>0?"-":(e*=-1,"+"))+fR(e/60|0,"0",2)+fR(e%60,"0",2)}function nL(t,e){return fR(t.getUTCDate(),e,2)}function rL(t,e){return fR(t.getUTCHours(),e,2)}function iL(t,e){return fR(t.getUTCHours()%12||12,e,2)}function oL(t,e){return fR(1+$I.count(eR(t),t),e,3)}function aL(t,e){return fR(t.getUTCMilliseconds(),e,3)}function sL(t,e){return aL(t,e)+"000"}function uL(t,e){return fR(t.getUTCMonth()+1,e,2)}function cL(t,e){return fR(t.getUTCMinutes(),e,2)}function lL(t,e){return fR(t.getUTCSeconds(),e,2)}function hL(t){var e=t.getUTCDay();return 0===e?7:e}function fL(t,e){return fR(HI.count(eR(t)-1,t),e,2)}function pL(t){var e=t.getUTCDay();return e>=4||0===e?YI(t):YI.ceil(t)}function dL(t,e){return t=pL(t),fR(YI.count(eR(t),t)+(4===eR(t).getUTCDay()),e,2)}function vL(t){return t.getUTCDay()}function mL(t,e){return fR(WI.count(eR(t)-1,t),e,2)}function gL(t,e){return fR(t.getUTCFullYear()%100,e,2)}function yL(t,e){return t=pL(t),fR(t.getUTCFullYear()%100,e,2)}function _L(t,e){return fR(t.getUTCFullYear()%1e4,e,4)}function xL(t,e){var n=t.getUTCDay();return t=n>=4||0===n?YI(t):YI.ceil(t),fR(t.getUTCFullYear()%1e4,e,4)}function bL(){return"+0000"}function wL(){return"%"}function EL(t){return+t}function SL(t){return Math.floor(+t/1e3)}function AL(t){return aR=oR(t),sR=aR.format,aR.parse,aR.utcFormat,aR.utcParse,aR}AL({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});var TL,CL,kL,ML=1e3,PL=60*ML,IL=60*PL,RL=24*IL,LL=7*RL,OL=30*RL,DL=365*RL;function NL(t){return new Date(t)}function zL(t){return t instanceof Date?+t:+new Date(+t)}function FL(t,e,n,r,i,o,a,s,u){var c=bP(dP,dP),l=c.invert,h=c.domain,f=u(".%L"),p=u(":%S"),d=u("%I:%M"),v=u("%I %p"),m=u("%a %d"),g=u("%b %d"),y=u("%B"),_=u("%Y"),x=[[a,1,ML],[a,5,5*ML],[a,15,15*ML],[a,30,30*ML],[o,1,PL],[o,5,5*PL],[o,15,15*PL],[o,30,30*PL],[i,1,IL],[i,3,3*IL],[i,6,6*IL],[i,12,12*IL],[r,1,RL],[r,2,2*RL],[n,1,LL],[e,1,OL],[e,3,3*OL],[t,1,DL]];function b(s){return(a(s)<s?f:o(s)<s?p:i(s)<s?d:r(s)<s?v:e(s)<s?n(s)<s?m:g:t(s)<s?y:_)(s)}function w(e,n,r,i){if(null==e&&(e=10),"number"===typeof e){var o=Math.abs(r-n)/e,a=fM((function(t){return t[2]})).right(x,o);a===x.length?(i=SM(n/DL,r/DL,e),e=t):a?(a=x[o/x[a-1][2]<x[a][2]/o?a-1:a],i=a[1],e=a[0]):(i=Math.max(SM(n,r,e),1),e=s)}return null==i?e:e.every(i)}return c.invert=function(t){return new Date(l(t))},c.domain=function(t){return arguments.length?h(WM.call(t,zL)):h().map(NL)},c.ticks=function(t,e){var n,r=h(),i=r[0],o=r[r.length-1],a=o<i;return a&&(n=i,i=o,o=n),n=w(t,i,o,e),n=n?n.range(i,o+1):[],a?n.reverse():n},c.tickFormat=function(t,e){return null==e?b:u(e)},c.nice=function(t,e){var n=h();return(t=w(t,n[0],n[n.length-1],e))?h(YP(n,t)):c},c.copy=function(){return _P(c,FL(t,e,n,r,i,o,a,s,u))},c}function BL(){return XM.apply(FL(yI,xI,CI,DI,zI,BI,jI,VI,sR).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function UL(){var t,e,n,r,i,o=0,a=1,s=dP,u=!1;function c(e){return isNaN(e=+e)?i:s(0===n?.5:(e=(r(e)-t)*n,u?Math.max(0,Math.min(1,e)):e))}return c.domain=function(i){return arguments.length?(t=r(o=+i[0]),e=r(a=+i[1]),n=t===e?0:1/(e-t),c):[o,a]},c.clamp=function(t){return arguments.length?(u=!!t,c):u},c.interpolator=function(t){return arguments.length?(s=t,c):s},c.unknown=function(t){return arguments.length?(i=t,c):i},function(i){return r=i,t=i(o),e=i(a),n=t===e?0:1/(e-t),c}}function jL(t,e){return e.domain(t.domain()).interpolator(t.interpolator()).clamp(t.clamp()).unknown(t.unknown())}function ZL(){var t=qP(UL()(dP));return t.copy=function(){return jL(t,ZL())},YM.apply(t,arguments)}function VL(){var t,e,n,r,i,o,a,s=0,u=.5,c=1,l=dP,h=!1;function f(t){return isNaN(t=+t)?a:(t=.5+((t=+o(t))-e)*(t<e?r:i),l(h?Math.max(0,Math.min(1,t)):t))}return f.domain=function(a){return arguments.length?(t=o(s=+a[0]),e=o(u=+a[1]),n=o(c=+a[2]),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),f):[s,u,c]},f.clamp=function(t){return arguments.length?(h=!!t,f):h},f.interpolator=function(t){return arguments.length?(l=t,f):l},f.unknown=function(t){return arguments.length?(a=t,f):a},function(a){return o=a,t=a(s),e=a(u),n=a(c),r=t===e?0:.5/(e-t),i=e===n?0:.5/(n-e),f}}function GL(){var t=qP(VL()(dP));return t.copy=function(){return jL(t,GL())},YM.apply(t,arguments)}function HL(t){var e,n=[];function r(t){return null==t?e:t}return r.invert=r,r.domain=r.range=function(t){return t?(n=t,t):n},r.unknown=function(t){return t?(e=t,t):e},r.copy=function(){return HL(t).unknown(e)},r}var WL,qL,XL,YL,KL=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,QL=(TL={},(0,Ft.Z)(TL,Fg.LINEAR,XP),(0,Ft.Z)(TL,Fg.POWER,lI),(0,Ft.Z)(TL,Fg.LOG,oI),(0,Ft.Z)(TL,Fg.IDENTITY,HL),(0,Ft.Z)(TL,Fg.SEQUENTIAL,ZL),(0,Ft.Z)(TL,Fg.TIME,BL),(0,Ft.Z)(TL,Fg.QUANTILE,hI),(0,Ft.Z)(TL,Fg.QUANTIZE,fI),(0,Ft.Z)(TL,Fg.THRESHOLD,pI),(0,Ft.Z)(TL,Fg.CAT,QM),(0,Ft.Z)(TL,Fg.DIVERGING,GL),TL),JL=(CL=(0,xc.b2)(),CL(kL=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"scaleOptions",{})}return zt(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",(0,J.Z)(tt().mark((function e(){var i,o,a;return tt().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(t.log(Zg.ScaleInitStart,wh.INIT),n.scaleOptions=t.getScaleOptions(),o=r.getLayerStyleAttributes(),a=null===(i=t.getSource())||void 0===i?void 0:i.data.dataArray,!Array.isArray(a)||0!==a.length){e.next=8;break}return e.abrupt("return");case 8:n.caculateScalesForAttributes(o||[],a);case 9:t.log(Zg.ScaleInitEnd,wh.INIT);case 10:case"end":return e.stop()}}),e)})))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var e=(0,J.Z)(tt().mark((function e(i){var o,a;return tt().wrap((function(e){while(1)switch(e.prev=e.next){case 0:if(i){e.next=2;break}return e.abrupt("return",i);case 2:if(t.log(Zg.ScaleInitStart,wh.UPDATE),n.scaleOptions=t.getScaleOptions(),o=r.getLayerStyleAttributes(),a=t.getSource().data.dataArray,!Array.isArray(a)||0!==a.length){e.next=8;break}return e.abrupt("return",!0);case 8:return n.caculateScalesForAttributes(o||[],a),t.log(Zg.ScaleInitEnd,wh.UPDATE),t.layerModelNeedUpdate=!0,e.abrupt("return",!0);case 12:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",(function(){if(!t.layerModelNeedUpdate){n.scaleOptions=t.getScaleOptions();var e=r.getLayerStyleAttributes(),i=t.getSource().data.dataArray;if((!Array.isArray(i)||0!==i.length)&&e){var o=e.filter((function(t){return t.needRescale}));o.length&&n.caculateScalesForAttributes(o,i)}}}))}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,e){var n=this;t.forEach((function(t){if(t.scale){var r=t.scale;r.names=n.parseFields(t.scale.field||[]);var i=[];r.names.forEach((function(r){var o;i.push(n.createScale(r,t.name,null===(o=t.scale)||void 0===o?void 0:o.values,e))})),i.some((function(t){return t.type===Bg.VARIABLE}))?(r.type=Bg.VARIABLE,i.forEach((function(t){var e,n;if(!r.callback&&"text"!==r.values)switch(null===(e=t.option)||void 0===e?void 0:e.type){case Fg.LOG:case Fg.LINEAR:case Fg.POWER:if(r.values&&r.values.length>2){var i=t.scale.ticks(r.values.length);t.scale.domain(i)}r.values?t.scale.range(r.values):t.scale.range(t.option.domain);break;case Fg.QUANTILE:case Fg.QUANTIZE:case Fg.THRESHOLD:t.scale.range(r.values);break;case Fg.IDENTITY:break;case Fg.CAT:r.values?t.scale.range(r.values):t.scale.range(t.option.domain);break;case Fg.DIVERGING:case Fg.SEQUENTIAL:t.scale.interpolator(zM(r.values));break}"text"===r.values&&t.scale.range(null===(n=t.option)||void 0===n?void 0:n.domain)}))):(r.type=Bg.CONSTANT,r.defaultValues=i.map((function(t,e){return t.scale(r.names[e])}))),r.scalers=i.map((function(t){return{field:t.field,func:t.scale,option:t.option}})),t.needRescale=!1}}))}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:(0,Oi.isString)(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,e,n,r){var i,o,a=this.scaleOptions[e]&&(null===(i=this.scaleOptions[e])||void 0===i?void 0:i.field)===t?this.scaleOptions[e]:this.scaleOptions[t],s={field:t,scale:void 0,type:Bg.VARIABLE,option:a};if(!r||!r.length)return a&&a.type?s.scale=this.createDefaultScale(a):(s.scale=QM([t]),s.type=Bg.CONSTANT),s;var u=null===(o=r.find((function(e){return!(0,Oi.isNil)(e[t])})))||void 0===o?void 0:o[t];if(this.isNumber(t)||(0,Oi.isNil)(u)&&!a)s.scale=QM([t]),s.type=Bg.CONSTANT;else{var c=a&&a.type||this.getDefaultType(u);"text"===n&&(c=Fg.CAT);var l=this.createScaleConfig(c,t,a,r);s.scale=this.createDefaultScale(l),s.option=l}return s}},{key:"getDefaultType",value:function(t){var e=Fg.LINEAR;return"string"===typeof t&&(e=KL.test(t)?Fg.TIME:Fg.CAT),e}},{key:"createScaleConfig",value:function(t,e,n,r){var i={type:t},o=(null===r||void 0===r?void 0:r.map((function(t){return t[e]})))||[];if(null!==n&&void 0!==n&&n.domain)i.domain=null===n||void 0===n?void 0:n.domain;else if(t===Fg.CAT||t===Fg.IDENTITY)i.domain=(0,Oi.uniq)(o);else if(t===Fg.QUANTILE)i.domain=o;else if(t===Fg.DIVERGING){var a=gM(o),s=void 0!==(null===n||void 0===n?void 0:n.neutral)?null===n||void 0===n?void 0:n.neutral:(a[0]+a[1])/2;i.domain=[a[0],s,a[1]]}else i.domain=gM(o);return(0,k.Z)((0,k.Z)({},i),n)}},{key:"createDefaultScale",value:function(t){var e=t.type,n=t.domain,r=t.unknown,i=t.clamp,o=t.nice,a=QL[e]();return n&&a.domain&&a.domain(n),r&&a.unknown(r),void 0!==i&&a.clamp&&a.clamp(i),void 0!==o&&a.nice&&a.nice(o),a}}]),t}())||kL),$L=(WL=(0,xc.b2)(),WL(qL=function(){function t(){Ot(this,t)}return zt(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",(function(){var e=t.animateStatus;e&&t.models.forEach((function(e){e.addUniforms((0,k.Z)({},t.layerModel.getAnimateUniforms()))}))}))}}]),t}())||qL),tO=(XL=(0,xc.b2)(),XL(YL=function(){function t(){Ot(this,t)}return zt(t,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",(function(){var e,n=t.getLayerConfig(),r=n.maskLayers,i=n.enableMask;!t.tileLayer&&r&&r.length>0&&((e=t.masks).push.apply(e,(0,C.Z)(r)),t.updateLayerConfig({mask:i}))}))}}]),t}())||YL),eO=function(){function t(e){var n=e.rendererService,r=e.layerService,i=e.parent;Ot(this,t),(0,Ft.Z)(this,"tileResource",new Map),(0,Ft.Z)(this,"layerTiles",[]),this.rendererService=n,this.layerService=r,this.parent=i}return zt(t,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some((function(e){return e.key===t}))}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find((function(e){return e.key===t}))}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find((function(e){return e.isLoaded&&e.visible&&e.lnglatInBounds(t)}))}},{key:"removeTile",value:function(t){var e=this.layerTiles.findIndex((function(e){return e.key===t})),n=this.layerTiles.splice(e,1);n[0]&&n[0].destroy()}},{key:"updateTileVisible",value:function(t){var e=this.getTile(t.key);null===e||void 0===e||e.updateVisible(t.isVisible)}},{key:"isParentLoaded",value:function(t){var e=t.parent;if(!e)return!0;var n=this.getTile(null===e||void 0===e?void 0:e.key);return!(null===n||void 0===n||!n.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var e=this,n=null===t||void 0===t?void 0:t.children;return 0===n.length||n.some((function(t){var n=e.getTile(null===t||void 0===t?void 0:t.key);return!1===(null===n||void 0===n?void 0:n.isLoaded)}))}},{key:"render",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getRenderLayers(),n=e.map(function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,r.layerService.renderTileLayer(e);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),t.next=4,Promise.all(n);case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter((function(t){return t.visible&&t.isLoaded})),e=[];return t.map((function(t){return e.push.apply(e,(0,C.Z)(t.getLayers()))})),e}},{key:"getLayers",value:function(){var t=this.layerTiles.filter((function(t){return t.isLoaded})),e=[];return t.map((function(t){return e.push.apply(e,(0,C.Z)(t.getLayers()))})),e}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach((function(t){return t.destroy()})),this.tileResource.clear()}}]),t}(),nO=n(46345);function rO(t,e,n){void 0===n&&(n={});var r=V(t),i=V(e),o=nO.union(r.coordinates,i.coordinates);return 0===o.length?null:1===o.length?D(o[0],n.properties):F(o,n.properties)}var iO=rO,oO=function(){function t(){Ot(this,t)}return zt(t,[{key:"getCombineFeature",value:function(t){var e=null,n=t[0];return t.map((function(t){var n=D(t.coordinates);e=null===e?n:iO(e,n)})),n&&(e.properties=(0,k.Z)({},n)),e}}]),t}(),aO="select",sO="active",uO=function(){function t(e){var n=e.layerService,r=e.tileLayerService,i=e.parent;Ot(this,t),(0,Ft.Z)(this,"tilePickID",new Map),this.layerService=n,this.tileLayerService=r,this.parent=i,this.tileSourceService=new oO}return zt(t,[{key:"pickRender",value:function(t){var e=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(e){var n=e.getMainLayer();null===n||void 0===n||n.layerPickService.pickRender(t)}}},{key:"pick",value:function(t,e){var n=this.parent.getContainer(),r=n.get(wc.IPickingService);if("RasterLayer"===t.type){var i=this.tileLayerService.getVisibleTileBylngLat(e.lngLat);if(i&&void 0!==i.getMainLayer()){var o=i.getMainLayer();return o.layerPickService.pickRasterLayer(o,e,this.parent)}return!1}return this.pickRender(e),r.pickFromPickingFBO(t,e)}},{key:"selectFeature",value:function(t){var e=(0,Li.Z)(t,3),n=e[0],r=e[1],i=e[2],o=this.color2PickId(n,r,i);this.tilePickID.set(aO,o),this.updateHighLight(n,r,i,aO)}},{key:"highlightPickedFeature",value:function(t){var e=(0,Li.Z)(t,3),n=e[0],r=e[1],i=e[2],o=this.color2PickId(n,r,i);this.tilePickID.set(sO,o),this.updateHighLight(n,r,i,sO)}},{key:"updateHighLight",value:function(t,e,n,r){this.tileLayerService.tiles.map((function(i){var o=i.getMainLayer();switch(r){case aO:null===o||void 0===o||o.hooks.beforeSelect.call([t,e,n]);break;case sO:null===o||void 0===o||o.hooks.beforeHighlight.call([t,e,n]);break}}))}},{key:"setPickState",value:function(){var t=this.tilePickID.get(aO),e=this.tilePickID.get(sO);if(t){var n=this.pickId2Color(t),r=(0,Li.Z)(n,3),i=r[0],o=r[1],a=r[2];this.updateHighLight(i,o,a,aO)}else if(e){var s=this.pickId2Color(e),u=(0,Li.Z)(s,3),c=u[0],l=u[1],h=u[2];this.updateHighLight(c,l,h,sO)}else;}},{key:"color2PickId",value:function(t,e,n){return wi(new Uint8Array([t,e,n]))}},{key:"pickId2Color",value:function(t){return Ei(t)}},{key:"getFeatureById",value:function(t){var e=this.tileLayerService.getTiles().filter((function(t){return t.visible})),n=[];return e.forEach((function(e){n.push.apply(n,(0,C.Z)(e.getFeatureById(t)))})),n}},{key:"pickRasterLayer",value:function(t,e,n){return!1}}]),t}(),cO=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask"];function lO(t){return"PolygonLayer"===t?AC:"LineLayer"===t?bA:XT}function hO(t){return-1!==["PolygonLayer","LineLayer"].indexOf(t)}var fO=function(){function t(e,n){Ot(this,t),(0,Ft.Z)(this,"visible",!0),(0,Ft.Z)(this,"layers",[]),(0,Ft.Z)(this,"isLoaded",!1),(0,Ft.Z)(this,"tileMaskLayers",[]),this.parent=n,this.sourceTile=e,this.x=e.x,this.y=e.y,this.z=e.z,this.key="".concat(this.x,"_").concat(this.y,"_").concat(this.z)}return zt(t,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(t){var e=(0,Li.Z)(this.sourceTile.bounds,4),n=e[0],r=e[1],i=e[2],o=e[3],a=t.lng,s=t.lat;return a>=n&&a<=i&&s>=r&&s<=o}},{key:"getLayerOptions",value:function(){var t,e=this.parent.getLayerConfig();return(0,k.Z)((0,k.Z)({},e),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:hO(this.parent.type),mask:e.mask||0!==(null===(t=e.maskLayers)||void 0===t?void 0:t.length)&&e.enableMask})}},{key:"getMaskLayer",value:function(){var t=this,e=this.parent.getLayerConfig(),n=e.maskLayers,r=[];return null===n||void 0===n||n.forEach((function(e){if(!e.tileLayer)return r.push(e),e;var n=e.tileLayer,i=n.getTile(t.sourceTile.key),o=null===i||void 0===i?void 0:i.getLayers()[0];o&&r.push(o)})),r}},{key:"addTileMask",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=new AC({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill"),n=kg(this.parent.sceneContainer),e.setContainer(n,this.parent.sceneContainer),t.next=5,e.init();case 5:return this.tileMask=e,r=this.getMainLayer(),void 0!==r&&(r.tileMask=e),t.abrupt("return",e);case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"addMask",value:function(){var t=(0,J.Z)(tt().mark((function t(e,n){var r;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return r=kg(this.parent.sceneContainer),n.setContainer(r,this.parent.sceneContainer),t.next=4,n.init();case 4:e.addMask(n),this.tileMaskLayers.push(n);case 6:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"addLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(e){var n;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isTileLayer=!0,n=kg(this.parent.sceneContainer),e.setContainer(n,this.parent.sceneContainer),this.layers.push(e),t.next=6,e.init();case 6:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"updateVisible",value:function(t){this.visible=t,this.updateOptions("visible",t)}},{key:"updateOptions",value:function(t,e){this.layers.forEach((function(n){n.updateLayerConfig((0,Ft.Z)({},t,e))}))}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(t){return[]}},{key:"getFeatureById",value:function(t){return[]}},{key:"destroy",value:function(){var t;null===(t=this.tileMask)||void 0===t||t.destroy(),this.layers.forEach((function(t){return t.destroy()}))}}]),t}();function pO(t){var e=dO();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function dO(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var vO=function(t){Yt(n,t);var e=pO(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"initTileLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.getSourceOption(),n=e.data.features[0].properties,r=(new bA).source(e.data,e.options).size(1).shape("line").color("red"),i=new XT({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([n],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),t.next=6,this.addLayer(r);case 6:return t.next=8,this.addLayer(i);case 8:this.isLoaded=!0;case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:e},options:{parser:{type:"geojson"},transforms:t.transforms}}}}]),n}(fO);function mO(t){var e=gO();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function gO(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var yO=function(t){Yt(n,t);var e=mO(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"initTileLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new uS((0,k.Z)({},n)).source(r.data,r.options),e&&Object.keys(e).forEach((function(t){var n,r,o=t;i[o](null===(n=e[o])||void 0===n?void 0:n.field,null===(r=e[o])||void 0===r?void 0:r.values)})),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),n}(fO);function _O(t){var e=xO();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function xO(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var bO=function(t){Yt(n,t);var e=_O(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"initTileLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new Tk((0,k.Z)({},n)).source(r.data,r.options),e&&Object.keys(e).forEach((function(t){var n,r,o=t;i[o](null===(n=e[o])||void 0===n?void 0:n.field,null===(r=e[o])||void 0===r?void 0:r.values)})),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getFeatures",value:function(t){if(!t)return[];var e=this.sourceTile.data;return e.getTileData(t)}},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.parent.getLayerConfig(),n=e.sourceLayer,r=e.featureId,i=this.getFeatures(n);return{data:{type:"FeatureCollection",features:i},options:{parser:{type:"geojson",featureId:r},transforms:t.transforms}}}}]),n}(fO),wO=["rasterData"];function EO(t){var e=SO();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function SO(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var AO=function(t){Yt(n,t);var e=EO(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"initTileLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new qC((0,k.Z)({},n)).source(r.data,r.options),e&&Object.keys(e).forEach((function(t){var n,r,o=t;i[o](null===(n=e[o])||void 0===n?void 0:n.field,null===(r=e[o])||void 0===r?void 0:r.values)})),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.sourceTile.data.data,n=e.rasterData,r=Jf(e,wO);return{data:n,options:{parser:(0,k.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},r),transforms:t.transforms}}}}]),n}(fO);function TO(t){var e=CO();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function CO(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var kO=function(t){Yt(n,t);var e=TO(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"initTileLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=new qC((0,k.Z)({},n)).source(r.data,r.options),e&&Object.keys(e).forEach((function(t){var n,r,o=t;i[o](null===(n=e[o])||void 0===n?void 0:n.field,null===(r=e[o])||void 0===r?void 0:r.values)})),t.next=7,this.addLayer(i);case 7:this.isLoaded=!0;case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:t.transforms}}}}]),n}(fO),MO=["rasterData"];function PO(t){var e=IO();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function IO(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var RO={positions:[0,1],colors:["#000","#fff"]},LO=function(t){Yt(n,t);var e=PO(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"initTileLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=this.getSourceOption(),i=this.getLayerOptions(),o=i.rampColors,a=i.domain,this.colorTexture=this.parent.textureService.getColorTexture(o,a),s=new qC((0,k.Z)((0,k.Z)({},n),{},{colorTexture:this.colorTexture})).source(r.data,r.options),e&&Object.keys(e).forEach((function(t){var n,r,i=t;s[i](null===(n=e[i])||void 0===n?void 0:n.field,null===(r=e[i])||void 0===r?void 0:r.values)})),t.next=9,this.addLayer(s);case 9:this.isLoaded=!0;case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.sourceTile.data.data,n=e.rasterData,r=Jf(e,MO);return{data:n,options:{parser:(0,k.Z)({type:"raster",extent:this.sourceTile.bounds},r),transforms:t.transforms}}}},{key:"styleUpdate",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=n,o=i.rampColors,a=void 0===o?RO:o,s=i.domain;this.colorTexture=this.parent.textureService.getColorTexture(a,s||Pi(a)),this.layers.forEach((function(e){return e.style({colorTexture:t.colorTexture})}))}},{key:"destroy",value:function(){this.layers.forEach((function(t){return t.destroy()}))}}]),n}(fO);function OO(t){var e=DO();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function DO(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var NO=function(t){Yt(n,t);var e=OO(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"initTileLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.parent.getLayerAttributeConfig(),n=this.getLayerOptions(),r=lO(this.parent.type),i=this.getSourceOption(),i){t.next=7;break}return this.isLoaded=!0,t.abrupt("return");case 7:return o=new r((0,k.Z)({},n)).source(i.data,i.options),Object.keys(e).forEach((function(t){var n,r,i=t;o[i](null===(n=e[i])||void 0===n?void 0:n.field,null===(r=e[i])||void 0===r?void 0:r.values)})),t.next=11,this.addLayer(o);case 11:if(!n.tileMask){t.next=14;break}return t.next=14,this.addTileMask();case 14:this.setLayerMinMaxZoom(o),this.isLoaded=!0;case 16:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getSourceOption",value:function(){var t=this.parent.getSource(),e=this.parent.getLayerConfig(),n=e.sourceLayer,r=void 0===n?"defaultLayer":n,i=e.featureId,o=void 0===i?"id":i,a=this.getFeatures(r);return{data:{type:"FeatureCollection",features:a},options:{parser:{type:"geojson",featureId:o},transforms:t.transforms}}}},{key:"setLayerMinMaxZoom",value:function(t){"text"===t.getModelType()&&t.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(t){var e=this.sourceTile.data;return e.getTileData(t)}},{key:"getFeatureById",value:function(t){var e=this.getMainLayer();if(!e)return[];var n=e.getSource().data.dataArray.filter((function(e){return e._id===t}));return n}}]),n}(fO);function zO(t){var e=t.type;switch(e){case"PolygonLayer":return NO;case"LineLayer":return NO;case"PointLayer":return NO;case"TileDebugLayer":return vO;case"MaskLayer":return bO;case"RasterLayer":var n=t.getSource().parser.dataType;switch(n){case Vg.RGB:case Vg.CUSTOMRGB:return AO;case Vg.ARRAYBUFFER:case Vg.CUSTOMARRAYBUFFER:return LO;case Vg.TERRAINRGB:case Vg.CUSTOMTERRAINRGB:return kO;default:return yO}default:return NO}}var FO,BO,UO,jO,ZO,VO,GO=function(){function t(e){var n=this;Ot(this,t),(0,Ft.Z)(this,"initedTileset",!1),(0,Ft.Z)(this,"mapchange",(function(){var t,e=n.getCurrentView(),r=e.latLonBounds,i=e.zoom;if("GAODE1.x"===n.mapService.version){var o=n.parent.getLayerConfig(),a=o.visible;i<2&&a?(n.parent.updateLayerConfig({visible:!1}),n.layerService.reRender()):i>=2&&!a&&(n.parent.updateLayerConfig({visible:!0}),n.layerService.reRender())}n.lastViewStates&&n.lastViewStates.zoom===i&&n.lastViewStates.latLonBounds.toString()===r.toString()||(n.lastViewStates={zoom:i,latLonBounds:r},null===(t=n.tilesetManager)||void 0===t||t.throttleUpdate(i,r))})),(0,Ft.Z)(this,"viewchange",(0,Oi.debounce)(this.mapchange,24)),this.parent=e;var r=this.parent.getContainer();this.rendererService=r.get(wc.IRendererService),this.layerService=r.get(wc.ILayerService),this.mapService=r.get(wc.IMapService),this.pickingService=r.get(wc.IPickingService),this.tileLayerService=new eO({rendererService:this.rendererService,layerService:this.layerService,parent:e}),this.tilePickService=new uO({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:e}),this.parent.setLayerPickService(this.tilePickService),this.proxy(e),this.initTileSetManager()}return zt(t,[{key:"initTileSetManager",value:function(){var t,e=this.parent.getSource();this.tilesetManager=e.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0);var n=this.getCurrentView(),r=n.latLonBounds,i=n.zoom;null===(t=this.tilesetManager)||void 0===t||t.update(i,r)}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),e=[t[0][0],t[0][1],t[1][0],t[1][1]],n=this.mapService.getZoom();return{latLonBounds:e,zoom:n}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",(function(t){})),this.tilesetManager.on("tile-unload",(function(e){t.tileUnLoad(e)})),this.tilesetManager.on("tile-error",(function(e,n){t.tileError(e)})),this.tilesetManager.on("tile-update",(function(){t.tileUpdate()})),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),null===(t=this.tilesetManager)||void 0===t||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var t;this.tilesetManager.clear();var e=this.getCurrentView(),n=e.latLonBounds,r=e.zoom;null===(t=this.tilesetManager)||void 0===t||t.update(r,n)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.tilesetManager){t.next=2;break}return t.abrupt("return");case 2:return e=this.parent.getMinZoom(),n=this.parent.getMaxZoom(),t.next=6,Promise.all(this.tilesetManager.tiles.filter((function(t){return t.isLoaded})).filter((function(t){return t.isVisibleChange})).filter((function(t){return t.data})).filter((function(t){return t.z>=e&&t.z<n})).map(function(){var t=(0,J.Z)(tt().mark((function t(e){var n,i;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(r.tileLayerService.hasTile(e.key)){t.next=9;break}return n=zO(r.parent),i=new n(e,r.parent),t.next=5,i.initTileLayer();case 5:r.tilePickService.setPickState(),0!==i.getLayers().length&&(r.tileLayerService.addTile(i),r.tileLayerService.updateTileVisible(e),r.layerService.reRender()),t.next=12;break;case 9:r.tileLayerService.updateTileVisible(e),r.tilePickService.setPickState(),r.layerService.reRender();case 12:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var e=this;cO.forEach((function(n){var r=t[n].bind(t);t[n]=function(){for(var i=arguments.length,o=new Array(i),a=0;a<i;a++)o[a]=arguments[a];return r.apply(void 0,o),e.getLayers().map((function(t){t[n].apply(t,o)})),"style"===n&&e.getTiles().forEach((function(t){return t.styleUpdate.apply(t,o)})),t}}))}}]),t}(),HO=(FO=(0,xc.b2)(),FO(BO=function(){function t(){Ot(this,t)}return zt(t,[{key:"build",value:function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.prepareBuildModel(),t.next=3,e.buildModels();case 3:case"end":return t.stop()}}),t)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"initLayerModel",value:function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.build(e);case 2:e.styleNeedUpdate=!1;case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"prepareLayerModel",value:function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.build(e);case 2:e.styleNeedUpdate=!1;case 3:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"apply",value:function(t){var e=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,J.Z)(tt().mark((function n(){return tt().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(!t.getSource().isTile){n.next=4;break}return t.prepareBuildModel(),t.tileLayer=new GO(t),n.abrupt("return");case 4:return t.log(Zg.BuildModelStart,wh.INIT),n.next=7,e.initLayerModel(t);case 7:t.log(Zg.BuildModelEnd,wh.INIT);case 8:case"end":return n.stop()}}),n)})))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var n=(0,J.Z)(tt().mark((function n(r){return tt().wrap((function(n){while(1)switch(n.prev=n.next){case 0:if(r){n.next=2;break}return n.abrupt("return",!1);case 2:if(!t.getSource().isTile){n.next=5;break}return t.tileLayer=new GO(t),n.abrupt("return",!1);case 5:return t.log(Zg.BuildModelStart,wh.UPDATE),n.next=8,e.prepareLayerModel(t);case 8:return t.log(Zg.BuildModelEnd,wh.UPDATE),n.abrupt("return",!0);case 10:case"end":return n.stop()}}),n)})));return function(t){return n.apply(this,arguments)}}()),t.hooks.beforeRender.tap("LayerModelPlugin",(function(){t.styleNeedUpdate&&e.prepareLayerModel(t).then((function(){t.styleNeedUpdate=!1,t.renderLayers()})),t.styleNeedUpdate=!1}))}}]),t}())||BO),WO=(UO=(0,xc.b2)(),UO(jO=function(){function t(){Ot(this,t)}return zt(t,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",(function(){var e=t.getLayerConfig(),n=e.autoFit,r=e.fitBoundsOptions;n&&t.fitBounds(r)}))}}]),t}())||jO),qO=["type"],XO={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},YO={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},KO={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},QO={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function JO(t){var e={u_DirectionalLights:new Array(3).fill((0,k.Z)({},KO)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,k.Z)({},QO)),u_NumOfSpotLights:0};return t&&t.length||(t=[YO]),t.forEach((function(t){var n=t.type,r=void 0===n?"directional":n,i=Jf(t,qO),o=XO[r].lights,a=XO[r].num,s=e[a];e[o][s]=(0,k.Z)((0,k.Z)({},e[o][s]),i),e[a]++})),e}var $O,tD,eD,nD,rD,iD,oD=(ZO=(0,xc.b2)(),ZO(VO=function(){function t(){Ot(this,t)}return zt(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",(function(){var e=t.getLayerConfig(),n=e.enableLighting;n&&t.models.forEach((function(t){return t.addUniforms((0,k.Z)({},JO()))}))}))}}]),t}())||VO),aD=($O=(0,xc.b2)(),$O(tD=function(){function t(){Ot(this,t)}return zt(t,[{key:"apply",value:function(t,e){var n=this,r=e.rendererService,i=e.postProcessingPassFactory,o=e.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",(function(){var e=t.getLayerConfig(),r=e.enableMultiPassRenderer,a=e.passes,s=void 0===a?[]:a;n.enabled=!!r&&!1!==t.getLayerConfig().enableMultiPassRenderer,n.enabled&&(t.multiPassRenderer=gx(t,s,i,o),t.multiPassRenderer.setRenderFlag(!0))})),t.hooks.beforeRender.tap("MultiPassRendererPlugin",(function(){if(n.enabled){var e=r.getViewportSize(),i=e.width,o=e.height;t.multiPassRenderer.resize(i,o)}}))}}]),t}())||tD),sD={NONE:0,ENCODE:1,HIGHLIGHT:2},uD=(eD=(0,xc.b2)(),eD(nD=function(){function t(){Ot(this,t)}return zt(t,[{key:"apply",value:function(t,e){var n=e.styleAttributeService;t.hooks.init.tapPromise("PixelPickingPlugin",(function(){var e=t.getLayerConfig(),r=e.enablePicking;n.registerStyleAttribute({name:"pickingColor",type:Ug.Attribute,descriptor:{name:"a_PickingColor",buffer:{data:[],type:vf.FLOAT},size:3,update:function(t){var e=t.id;return r?Ei(e):[0,0,0]}}})})),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",(function(){var e=t.getLayerConfig(),n=e.enablePicking;n&&t.isVisible()&&t.models.forEach((function(t){return t.addUniforms({u_PickingStage:sD.ENCODE})}))})),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",(function(){var e=t.getLayerConfig(),n=e.enablePicking;n&&t.isVisible()&&t.models.forEach((function(t){return t.addUniforms({u_PickingStage:sD.HIGHLIGHT})}))})),t.hooks.beforeHighlight.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.highlightColor,i=n.activeMix,o=void 0===i?0:i,a="string"===typeof r?bi(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:wi(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:sD.HIGHLIGHT,u_PickingColor:e,u_HighlightColor:a.map((function(t){return 255*t})),u_activeMix:o})}))})),t.hooks.beforeSelect.tap("PixelPickingPlugin",(function(e){var n=t.getLayerConfig(),r=n.selectColor,i=n.selectMix,o=void 0===i?0:i,a="string"===typeof r?bi(r):r||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:wi(new Uint8Array(e))}),t.models.forEach((function(t){return t.addUniforms({u_PickingStage:sD.HIGHLIGHT,u_PickingColor:e,u_HighlightColor:a.map((function(t){return 255*t})),u_activeMix:o,u_CurrentSelectedId:e,u_SelectColor:a.map((function(t){return 255*t})),u_EnableSelect:1})}))}))}}]),t}())||nD),cD=["mvt","geojsonvt","testTile"];function lD(t){var e=t.getSource();return cD.includes(e.parser.type)}var hD,fD,pD,dD,vD,mD,gD,yD,_D,xD,bD,wD,ED,SD,AD,TD,CD,kD,MD=(rD=(0,xc.b2)(),rD(iD=function(){function t(){Ot(this,t)}return zt(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",(function(){lD(t)||n.registerBuiltinAttributes(r,t)}))}},{key:"registerBuiltinAttributes",value:function(t,e){"MaskLayer"!==e.type?(this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)):this.registerPositionAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:Ug.Attribute,descriptor:{name:"a_Position",buffer:{data:[],type:vf.FLOAT},size:3,update:function(t,e,n){return 2===n.length?[n[0],n[1],0]:[n[0],n[1],n[2]]}}})}},{key:"registerFilterAttribute",value:function(t){t.registerStyleAttribute({name:"filter",type:Ug.Attribute,descriptor:{name:"filter",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t){var e=t.filter;return e?[1]:[0]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:Ug.Attribute,descriptor:{name:"a_Color",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:4,update:function(t){var e=t.color;return e&&e.length?e:[1,1,1,1]}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:Ug.Attribute,descriptor:{name:"a_vertexId",buffer:{usage:vf.DYNAMIC_DRAW,data:[],type:vf.FLOAT},size:1,update:function(t,e){return[e]}}})}}]),t}())||iD),PD=(hD=(0,xc.b2)(),fD=(0,xc.f3)(wc.ICameraService),pD=(0,xc.f3)(wc.ICoordinateSystemService),dD=(0,xc.f3)(wc.IRendererService),vD=(0,xc.f3)(wc.IMapService),hD((gD=function(){function t(){Ot(this,t),Oh(this,"cameraService",yD,this),Oh(this,"coordinateSystemService",_D,this),Oh(this,"rendererService",xD,this),Oh(this,"mapService",bD,this)}return zt(t,[{key:"apply",value:function(t){var e=this,n=this.mapService.version,r=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],i=[0,0];t.hooks.beforeRender.tap("ShaderUniformPlugin",(function(){var o=t.getLayerConfig().tileOrigin;e.coordinateSystemService.refresh(o),"GAODE2.x"===n&&(e.setLayerCenter(t),r=e.mapService.map.customCoords.getMVPMatrix(),i=e.mapService.getCustomCoordCenter());var a=e.rendererService.getViewportSize(),s=a.width,u=a.height;t.models.forEach((function(n){var o;n.addUniforms((o={},(0,Ft.Z)(o,jg.ProjectionMatrix,e.cameraService.getProjectionMatrix()),(0,Ft.Z)(o,jg.ViewMatrix,e.cameraService.getViewMatrix()),(0,Ft.Z)(o,jg.ViewProjectionMatrix,e.cameraService.getViewProjectionMatrix()),(0,Ft.Z)(o,jg.Zoom,e.cameraService.getZoom()),(0,Ft.Z)(o,jg.ZoomScale,e.cameraService.getZoomScale()),(0,Ft.Z)(o,jg.FocalDistance,e.cameraService.getFocalDistance()),(0,Ft.Z)(o,jg.CameraPosition,e.cameraService.getCameraPosition()),(0,Ft.Z)(o,Jh.CoordinateSystem,e.coordinateSystemService.getCoordinateSystem()),(0,Ft.Z)(o,Jh.ViewportCenter,e.coordinateSystemService.getViewportCenter()),(0,Ft.Z)(o,Jh.ViewportCenterProjection,e.coordinateSystemService.getViewportCenterProjection()),(0,Ft.Z)(o,Jh.PixelsPerDegree,e.coordinateSystemService.getPixelsPerDegree()),(0,Ft.Z)(o,Jh.PixelsPerDegree2,e.coordinateSystemService.getPixelsPerDegree2()),(0,Ft.Z)(o,Jh.PixelsPerMeter,e.coordinateSystemService.getPixelsPerMeter()),(0,Ft.Z)(o,Jh.Mvp,r),(0,Ft.Z)(o,"u_sceneCenterMercator",i),(0,Ft.Z)(o,"u_ViewportSize",[s,u]),(0,Ft.Z)(o,"u_ModelMatrix",e.cameraService.getModelMatrix()),(0,Ft.Z)(o,"u_DevicePixelRatio",xr.devicePixelRatio),(0,Ft.Z)(o,"u_PickingBuffer",t.getLayerConfig().pickingBuffer||0),(0,Ft.Z)(o,"u_shaderPick",Number(t.getShaderPickStat())),o))}))}))}},{key:"setLayerCenter",value:function(t){void 0===t.coordCenter&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}}]),t}(),yD=Dh(gD.prototype,"cameraService",[fD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),_D=Dh(gD.prototype,"coordinateSystemService",[pD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xD=Dh(gD.prototype,"rendererService",[dD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bD=Dh(gD.prototype,"mapService",[vD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mD=gD))||mD),ID=(wD=(0,xc.b2)(),wD(ED=function(){function t(){Ot(this,t)}return zt(t,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",(function(){t.layerModel&&t.layerModel.needUpdate().then((function(e){e&&t.renderLayers()}))})),t.hooks.afterRender.tap("UpdateModelPlugin",(function(){t.layerModelNeedUpdate=!1}))}}]),t}())||ED),RD=(SD=(0,xc.b2)(),SD(AD=function(){function t(){Ot(this,t)}return zt(t,[{key:"apply",value:function(t,e){var n=this,r=e.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",(function(){n.initStyleAttribute(t,{styleAttributeService:r})})),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",(function(){t.layerModelNeedUpdate||t.inited&&n.updateStyleAttribute(t,{styleAttributeService:r})}))}},{key:"updateStyleAttribute",value:function(t,e){var n=e.styleAttributeService,r=n.getLayerStyleAttributes()||[],i=n.getLayerStyleAttribute("filter");if(i&&i.needRegenerateVertices)return t.layerModelNeedUpdate=!0,void r.forEach((function(t){return t.needRegenerateVertices=!1}));r.filter((function(t){return t.needRegenerateVertices})).forEach((function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex,t),e.needRegenerateVertices=!1}))}},{key:"initStyleAttribute",value:function(t,e){var n=e.styleAttributeService,r=n.getLayerStyleAttributes()||[];r.filter((function(t){return t.needRegenerateVertices})).forEach((function(e){n.updateAttributeByFeatureRange(e.name,t.getEncodedData(),e.featureRange.startIndex,e.featureRange.endIndex),e.needRegenerateVertices=!1}))}}]),t}())||AD);Ag.bind(wc.ILayerPlugin).to(lM).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(MD).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(JL).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(cM).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(WO).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(tO).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(RD).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(ID).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(aD).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(PD).inRequestScope(),Ag.bind(wc.ILayerPlugin).to($L).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(oD).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(uD).inRequestScope(),Ag.bind(wc.ILayerPlugin).to(HO).inRequestScope();var LD=(TD=Eg(wc.IGlobalConfigService),CD=function(){function t(e){Ot(this,t),Oh(this,"configService",kD,this),this.config=e}return zt(t,[{key:"setContainer",value:function(t,e,n,r){t.bind(wc.MapConfig).toConstantValue((0,k.Z)((0,k.Z)({},this.config),{},{id:e,canvas:n,hasBaseMap:r})),t.bind(wc.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),t}(),kD=Dh(CD.prototype,"configService",[TD],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),CD),OD=n(46512),DD=n.n(OD),ND=function(){function t(e){Ot(this,t),(0,Ft.Z)(this,"size",1e4),this.size=e||1e4}return zt(t,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var e=180-360*(1-t/this.size);return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}},{key:"project",value:function(t){var e=this.mercatorXfromLng(t[0]),n=this.mercatorYfromLat(t[1]);return[e,n]}},{key:"unproject",value:function(t){var e=this.lngFromMercatorX(t[0]),n=this.latFromMercatorY(t[1]);return[e,n]}}]),t}();function zD(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e={top:0,right:0,bottom:0,left:0};if("number"===typeof t)return{top:t,right:t,bottom:t,left:t};if(Array.isArray(t)){if(4===t.length)return{top:t[0],right:t[1],bottom:t[2],left:t[3]};if(2===t.length)return{top:t[0],right:t[1],bottom:t[0],left:t[1]}}return(0,k.Z)((0,k.Z)({},e),t)}function FD(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function BD(t,e){var n=Bh([],e,t);return Fh(n,n,1/n[3]),n}function UD(t,e){if(!t)throw new Error(e||"viewport-mercator-project: assertion failed.")}var jD=Math.PI,ZD=jD/4,VD=jD/180,GD=180/jD,HD=512,WD=4003e4,qD=1.5;function XD(t){return Math.pow(2,t)}function YD(t,e){var n=(0,Li.Z)(t,2),r=n[0],i=n[1];UD(Number.isFinite(r)&&Number.isFinite(e)),UD(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),e*=HD;var o=r*VD,a=i*VD,s=e*(o+jD)/(2*jD),u=e*(jD-Math.log(Math.tan(ZD+.5*a)))/(2*jD);return[s,u]}function KD(t,e){var n=(0,Li.Z)(t,2),r=n[0],i=n[1];e*=HD;var o=r/e*(2*jD)-jD,a=2*(Math.atan(Math.exp(jD-i/e*(2*jD)))-ZD);return[o*GD,a*GD]}function QD(t){var e=t.latitude,n=t.longitude,r=t.zoom,i=t.scale,o=t.highPrecision,a=void 0!==o&&o;i=void 0!==i?i:XD(r),UD(Number.isFinite(e)&&Number.isFinite(n)&&Number.isFinite(i));var s={},u=HD*i,c=Math.cos(e*VD),l=u/360,h=l/c,f=u/WD/c;if(s.pixelsPerMeter=[f,-f,f],s.metersPerPixel=[1/f,-1/f,1/f],s.pixelsPerDegree=[l,-h,f],s.degreesPerPixel=[1/l,-1/h,1/f],a){var p=VD*Math.tan(e*VD)/c,d=l*p/2,v=u/WD*p,m=v/h*f;s.pixelsPerDegree2=[0,-d,v],s.pixelsPerMeter2=[m,0,m]}return s}function JD(t){var e=t.height,n=t.pitch,r=t.bearing,i=t.altitude,o=t.center,a=void 0===o?null:o,s=t.flipY,u=void 0!==s&&s,c=FD();return xl(c,c,[0,0,-i]),bl(c,c,[1,1,1/e]),El(c,c,-n*VD),Al(c,c,r*VD),u&&bl(c,c,[1,-1,1]),a&&xl(c,c,_b([],a)),c}function $D(t){var e=t.width,n=t.height,r=t.altitude,i=void 0===r?qD:r,o=t.pitch,a=void 0===o?0:o,s=t.nearZMultiplier,u=void 0===s?1:s,c=t.farZMultiplier,l=void 0===c?1:c,h=a*VD,f=Math.atan(.5/i),p=Math.sin(f)*i/Math.sin(Math.PI/2-h-f),d=Math.cos(Math.PI/2-h)*p+i;return{fov:2*Math.atan(n/2/i),aspect:e/n,focalDistance:i,near:u,far:d*l}}function tN(t){var e=t.width,n=t.height,r=t.pitch,i=t.altitude,o=t.nearZMultiplier,a=t.farZMultiplier,s=$D({width:e,height:n,altitude:i,pitch:r,nearZMultiplier:o,farZMultiplier:a}),u=s.fov,c=s.aspect,l=s.near,h=s.far,f=Zl([],u,c,l,h);return f}function eN(t,e){var n=(0,Li.Z)(t,3),r=n[0],i=n[1],o=n[2],a=void 0===o?0:o;return UD(Number.isFinite(r)&&Number.isFinite(i)&&Number.isFinite(a)),BD(e,[r,i,a,1])}function nN(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=(0,Li.Z)(t,3),i=r[0],o=r[1],a=r[2];if(UD(Number.isFinite(i)&&Number.isFinite(o),"invalid pixel coordinate"),Number.isFinite(a)){var s=BD(e,[i,o,a,1]);return s}var u=BD(e,[i,o,0,1]),c=BD(e,[i,o,1,1]),l=u[2],h=c[2],f=l===h?0:((n||0)-l)/(h-l);return mu([],u,c,f)}var rN=FD(),iN=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=e.width,r=e.height,i=e.viewMatrix,o=void 0===i?rN:i,a=e.projectionMatrix,s=void 0===a?rN:a;Ot(this,t),this.width=n||1,this.height=r||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=o,this.projectionMatrix=s;var u=FD();_l(u,u,this.projectionMatrix),_l(u,u,this.viewMatrix),this.viewProjectionMatrix=u;var c=FD();bl(c,c,[this.width/2,-this.height/2,1]),xl(c,c,[1,-1,0]),_l(c,c,this.viewProjectionMatrix);var l=ml(FD(),c);if(!l)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=c,this.pixelUnprojectionMatrix=l,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return zt(t,[{key:"equals",value:function(e){return e instanceof t&&(e.width===this.width&&e.height===this.height&&rh(e.projectionMatrix,this.projectionMatrix)&&rh(e.viewMatrix,this.viewMatrix))}},{key:"project",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=this.projectPosition(t),o=eN(i,this.pixelProjectionMatrix),a=(0,Li.Z)(o,2),s=a[0],u=a[1],c=r?u:this.height-u;return 2===t.length?[s,c]:[s,c,o[2]]}},{key:"unproject",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.topLeft,r=void 0===n||n,i=e.targetZ,o=(0,Li.Z)(t,3),a=o[0],s=o[1],u=o[2],c=r?s:this.height-s,l=i&&i*this.pixelsPerMeter,h=nN([a,c,u],this.pixelUnprojectionMatrix,l),f=this.unprojectPosition(h),p=(0,Li.Z)(f,3),d=p[0],v=p[1],m=p[2];return Number.isFinite(u)?[d,v,m]:Number.isFinite(i)?[d,v,i]:[d,v]}},{key:"projectPosition",value:function(t){var e=this.projectFlat(t),n=(0,Li.Z)(e,2),r=n[0],i=n[1],o=(t[2]||0)*this.pixelsPerMeter;return[r,i,o]}},{key:"unprojectPosition",value:function(t){var e=this.unprojectFlat(t),n=(0,Li.Z)(e,2),r=n[0],i=n[1],o=(t[2]||0)/this.pixelsPerMeter;return[r,i,o]}},{key:"projectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]||this.scale;return t}},{key:"unprojectFlat",value:function(t){arguments.length>1&&void 0!==arguments[1]||this.scale;return t}}]),t}();function oN(t){var e=t.width,n=t.height,r=t.bounds,i=t.minExtent,o=void 0===i?0:i,a=t.maxZoom,s=void 0===a?24:a,u=t.padding,c=void 0===u?0:u,l=t.offset,h=void 0===l?[0,0]:l,f=(0,Li.Z)(r,2),p=(0,Li.Z)(f[0],2),d=p[0],v=p[1],m=(0,Li.Z)(f[1],2),g=m[0],y=m[1];if(Number.isFinite(c)){var _=c;c={top:_,bottom:_,left:_,right:_}}else UD(Number.isFinite(c.top)&&Number.isFinite(c.bottom)&&Number.isFinite(c.left)&&Number.isFinite(c.right));var x=new gN({width:e,height:n,longitude:0,latitude:0,zoom:0}),b=x.project([d,y]),w=x.project([g,v]),E=[Math.max(Math.abs(w[0]-b[0]),o),Math.max(Math.abs(w[1]-b[1]),o)],S=[e-c.left-c.right-2*Math.abs(h[0]),n-c.top-c.bottom-2*Math.abs(h[1])];UD(S[0]>0&&S[1]>0);var A=S[0]/E[0],T=S[1]/E[1],C=(c.right-c.left)/2/A,k=(c.bottom-c.top)/2/T,M=[(w[0]+b[0])/2+C,(w[1]+b[1])/2+k],P=x.unproject(M),I=x.zoom+Math.log2(Math.abs(Math.min(A,T)));return{longitude:P[0],latitude:P[1],zoom:Math.min(I,s)}}var aN,sN,uN,cN,lN,hN,fN,pN,dN,vN,mN,gN=function(t){function e(){var t,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=n.width,i=n.height,o=n.latitude,a=void 0===o?0:o,s=n.longitude,u=void 0===s?0:s,c=n.zoom,l=void 0===c?0:c,h=n.pitch,f=void 0===h?0:h,p=n.bearing,d=void 0===p?0:p,v=n.altitude,m=void 0===v?1.5:v,g=n.nearZMultiplier,y=n.farZMultiplier;Ot(this,e),r=r||1,i=i||1;var _=XD(l);m=Math.max(.75,m);var x=YD([u,a],_);x[2]=0;var b=tN({width:r,height:i,pitch:f,bearing:d,altitude:m,nearZMultiplier:g||1/i,farZMultiplier:y||1.01}),w=JD({height:i,center:x,pitch:f,bearing:d,altitude:m,flipY:!0});return t=Qt(this,Jt(e).call(this,{width:r,height:i,viewMatrix:w,projectionMatrix:b})),t.latitude=a,t.longitude=u,t.zoom=l,t.pitch=f,t.bearing=d,t.altitude=m,t.scale=_,t.center=x,t.pixelsPerMeter=QD(Kt(Kt(t))).pixelsPerMeter[2],Object.freeze(Kt(Kt(t))),t}return Yt(e,t),zt(e,[{key:"projectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return YD(t,e)}},{key:"unprojectFlat",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.scale;return KD(t,e)}},{key:"getMapCenterByLngLatPosition",value:function(t){var e=t.lngLat,n=t.pos,r=nN(n,this.pixelUnprojectionMatrix),i=YD(e,this.scale),o=hu([],i,pu([],r)),a=hu([],this.center,o);return KD(a,this.scale)}},{key:"getLocationAtPoint",value:function(t){var e=t.lngLat,n=t.pos;return this.getMapCenterByLngLatPosition({lngLat:e,pos:n})}},{key:"fitBounds",value:function(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=this.width,i=this.height,o=oN(Object.assign({width:r,height:i,bounds:t},n)),a=o.longitude,s=o.latitude,u=o.zoom;return new e({width:r,height:i,longitude:a,latitude:s,zoom:u})}}]),e}(iN),yN=function(){function t(){Ot(this,t)}return zt(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth,s=this.viewport?{width:this.viewport.width,height:this.viewport.height,longitude:this.viewport.center[0],latitude:this.viewport.center[1],zoom:this.viewport.zoom,pitch:this.viewport.pitch,bearing:this.viewport.bearing}:{};this.viewport=new gN((0,k.Z)((0,k.Z)({},s),{},{width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i}))}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),_N={normal:"amap://styles/normal",light:"amap://styles/c422f5c0cfced5be9fe3a83f05f28a68?isPublic=true",dark:"amap://styles/c9f1d10cae34f8ab05e425462c5a58d7?isPublic=true",blank:"amap://styles/07c17002b38775b32a7a76c66cf90e99?isPublic=true",fresh:"amap://styles/fresh",grey:"amap://styles/grey",graffiti:"amap://styles/graffiti",macaron:"amap://styles/macaron",darkblue:"amap://styles/darkblue",wine:"amap://styles/wine"},xN=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];function bN(t,e){var n="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,r="undefined"!==typeof wx&&null!==wx&&("undefined"!==typeof wx.request||"undefined"!==typeof wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a),a}}bN(".amap-logo{\n display: none !important;\n}\n");var wN={contextmenu:"rightclick"},EN={contextmenu:"rightclick",camerachange:"viewchange"},SN={"GAODE1.x":wN,"GAODE2.x":EN},AN=0;window.forceWebGL=!0;var TN="15cd8a57710d40c9b7c0e3cc120f1200",CN="1.4.15",kN="amap-script",MN=!1,PN=[],IN=12,RN=(aN=(0,xc.b2)(),sN=(0,xc.f3)(wc.IGlobalConfigService),uN=(0,xc.f3)(wc.MapConfig),cN=(0,xc.f3)(wc.ICoordinateSystemService),lN=(0,xc.f3)(wc.IEventEmitter),aN((fN=function(){function t(){var e=this;Ot(this,t),(0,Ft.Z)(this,"version",ux["GAODE1.x"]),(0,Ft.Z)(this,"simpleMapCoord",new ND),(0,Ft.Z)(this,"bgColor","rgba(0, 0, 0, 0)"),Oh(this,"configService",pN,this),Oh(this,"config",dN,this),Oh(this,"coordinateSystemService",vN,this),Oh(this,"eventEmitter",mN,this),(0,Ft.Z)(this,"handleCameraChanged",(function(t){var n=t.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,c=n.aspect,l=n.position,h=e.getCenter(),f=h.lng,p=h.lat;if(e.emit("mapchange"),e.cameraChangedCallback){e.viewport.syncWithMapCamera({aspect:c,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:e.map.getZoom()-1,center:[f,p],offsetOrigin:[l.x,l.y]});var d=e.config.offsetZoom,v=void 0===d?IN:d;e.viewport.getZoom()>v?e.coordinateSystemService.setCoordinateSystem(Uh.P20_OFFSET):e.coordinateSystemService.setCoordinateSystem(Uh.P20),e.cameraChangedCallback(e.viewport)}}))}return zt(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];this.markerContainer=Bi("div","l7-marker-container",e)}}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"on",value:function(t,e){-1!==Gg.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(SN[this.version][t]||t,e)}},{key:"off",value:function(t,e){-1!==Gg.indexOf(t)?this.eventEmitter.off(t,e):this.map.off(SN[this.version][t]||t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){var t;return null===(t=this.map.getContainer())||void 0===t?void 0:t.getElementsByClassName("amap-maps")[0]}},{key:"getSize",value:function(){var t=this.map.getSize();return[t.getWidth(),t.getHeight()]}},{key:"getType",value:function(){return"amap"}},{key:"getZoom",value:function(){return this.map.getZoom()-1}},{key:"setZoom",value:function(t){return this.map.setZoom(t+1)}},{key:"getCenter",value:function(t){if(null!==t&&void 0!==t&&t.padding){var e=this.getCenter(),n=zD(t.padding),r=this.lngLatToPixel([e.lng,e.lat]),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x-i[0],r.y-i[1]]);return o}var a=this.map.getCenter();return{lng:a.getLng(),lat:a.getLat()}}},{key:"setCenter",value:function(t,e){if(null!==e&&void 0!==e&&e.padding){var n=zD(e.padding),r=this.lngLatToPixel(t),i=[(n.right-n.left)/2,(n.bottom-n.top)/2],o=this.pixelToLngLat([r.x+i[0],r.y+i[1]]);this.map.setCenter([o.lng,o.lat])}else this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return 360-this.map.getRotation()}},{key:"getBounds",value:function(){var t=this.map.getBounds().toBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng(),o=r.lng<n.getLng()?n.getLng()-180:n.getLng();return[[o,n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.get("zooms");return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.get("zooms");return t[1]-1}},{key:"setRotation",value:function(t){return this.map.setRotation(t)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"zoomIn",value:function(){this.map.zoomIn()}},{key:"zoomOut",value:function(){this.map.zoomOut()}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy(t,e)}},{key:"fitBounds",value:function(t){this.map.setBounds(new AMap.Bounds([t[0][0],t[0][1],t[1][0],t[1][1]]))}},{key:"setZoomAndCenter",value:function(t,e){this.map.setZoomAndCenter(t+1,e)}},{key:"setMapStyle",value:function(t){this.map.setMapStyle(this.getMapStyleValue(t))}},{key:"setMapStatus",value:function(t){this.map.setStatus(t)}},{key:"getMapStyleConfig",value:function(){return _N}},{key:"getMapStyleValue",value:function(t){return this.getMapStyleConfig()[t]||t}},{key:"getMapStyle",value:function(){return this.map.getMapStyle()}},{key:"pixelToLngLat",value:function(t){var e=this.map.pixelToLngLat(new AMap.Pixel(t[0],t[1]));return{lng:e.getLng(),lat:e.getLat()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lnglatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"containerToLngLat",value:function(t){var e=new AMap.Pixel(t[0],t[1]),n=this.map.containerToLngLat(e);return{lng:null===n||void 0===n?void 0:n.getLng(),lat:null===n||void 0===n?void 0:n.getLat()}}},{key:"lngLatToContainer",value:function(t){var e=new AMap.LngLat(t[0],t[1]),n=this.map.lngLatToContainer(e);return{x:n.getX(),y:n.getY()}}},{key:"lngLatToCoord",value:function(t){var e=this.map.lngLatToGeodeticCoord(t),n=e.x,r=e.y;return[n,-r]}},{key:"lngLatToMercator",value:function(t,e){return{x:0,y:0,z:0}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=cl();return xl(o,o,nb(i[0],i[1],e)),bl(o,o,nb(r[0],r[1],r[2])),El(o,o,n[0]),Sl(o,o,n[1]),Al(o,o,n[2]),o}},{key:"init",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l,h,f,p,d,v=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,c=e.token,l=void 0===c?TN:c,h=e.mapInstance,f=e.plugin,p=void 0===f?[]:f,d=Jf(e,xN),t.next=3,new Promise((function(t){var e=function(){if(h)v.map=h,v.$mapContainer=v.map.getContainer(),setTimeout((function(){v.map.on("camerachange",v.handleCameraChanged),t()}),30);else{v.$mapContainer=v.creatMapContainer(n);var e=(0,k.Z)({mapStyle:v.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);e.zoom&&(e.zoom+=1);var r=new AMap.Map(v.$mapContainer,e);r.on("camerachange",v.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return v.handleAfterMapChange()}))})),v.map=r,setTimeout((function(){t()}),10)}};MN||h?MN&&window.AMap||h?e():PN.push(e):(MN=!0,p.push("Map3D"),DD().load({key:l,version:CN,plugins:p}).then((function(){e(),PN.length&&(PN.forEach((function(t){return t()})),PN=[])})).catch((function(t){throw new Error(t)})))}));case 3:this.viewport=new yN;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance(ee(AMap.LngLat,(0,C.Z)(t)),ee(AMap.LngLat,(0,C.Z)(e))),r=this.lngLatToCoord(t),i=(0,Li.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,Li.Z)(s,2),c=u[0],l=u[1],h=Math.sqrt(Math.pow(o-c,2)+Math.pow(a-l,2));return h/n}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0],r="jpg"===t?null===n||void 0===n?void 0:n.toDataURL("image/jpeg"):null===n||void 0===n?void 0:n.toDataURL("image/png");return r}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),delete window.initAMap;var n=document.getElementById(kN);n&&document.head.removeChild(n),this.map.destroy()}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"handleAfterMapChange",value:function(){this.emit("mapAfterFrameChange")}},{key:"creatMapContainer",value:function(t){var e=t;"string"===typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n       position: absolute;\n       top: 0;\n       height: 100%;\n       width: 100%;\n     ",n.id="l7_amap_div"+AN++,e.appendChild(n),n}}]),t}(),pN=Dh(fN.prototype,"configService",[sN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),dN=Dh(fN.prototype,"config",[uN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vN=Dh(fN.prototype,"coordinateSystemService",[cN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mN=Dh(fN.prototype,"eventEmitter",[lN],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),hN=fN))||hN);if(!window)throw Error("AMap JSAPI can only be used in Browser.");var LN=function(t){return t["notload"]="notload",t["loading"]="loading",t["loaded"]="loaded",t["failed"]="failed",t}(LN||{}),ON={key:"",AMap:{version:"2.0",plugins:[]}},DN={AMap:LN.notload},NN=[],zN=function(t){if("function"===typeof t){if(DN.AMap===LN.loaded)return void t(window.AMap);NN.push(t)}},FN=function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){if(DN.AMap===LN.failed)n("");else if(DN.AMap===LN.notload){var r=e.key,i=e.version,o=e.plugins;if(!r)return void n("请填写key");window.AMap&&"lbs.amap.com"!==location.host&&n("禁止多种API加载方式混用"),ON.key=r,ON.AMap.version=i||ON.AMap.version,ON.AMap.plugins=o||ON.AMap.plugins,DN.AMap=LN.loading;var a=document.body||document.head;window._onAPILoaded=function(e){e?(DN.AMap=LN.failed,n(e)):(DN.AMap=LN.loaded,t(null))};var s=document.createElement("script");s.type="text/javascript",s.async=!1,s.src="https://webapi.amap.com/maps?callback=_onAPILoaded&v="+ON.AMap.version+"&key="+r+"&plugin="+ON.AMap.plugins.join(","),s.onerror=function(t){DN.AMap=LN.failed,n(t)},a.appendChild(s)}else if(DN.AMap===LN.loaded){if(e.key&&e.key!==ON.key)return void n("多个不一致的 key");if(e.version&&e.version!==ON.AMap.version)return void n("不允许多个版本 JSAPI 混用");var u=[];e.plugins&&e.plugins.forEach((function(t){-1===ON.AMap.plugins.indexOf(t)&&u.push(t)})),u.length&&window.AMap.plugin(u,(function(){t(window.AMap)}))}else{if(e.key&&e.key!==ON.key)return void n("多个不一致的 key");if(e.version&&e.version!==ON.AMap.version)return void n("不允许多个版本 JSAPI 混用");var c=[];e.plugins&&e.plugins.forEach((function(t){-1===ON.AMap.plugins.indexOf(t)&&c.push(t)})),zN((function(){c.length&&window.AMap.plugin(c,(function(){t(window.AMap)}))}))}})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();function BN(){delete window.AMap,ON={key:"",AMap:{version:"1.4.15",plugins:[]}},DN={AMap:LN.notload},{AMap:[]}}var UN,jN,ZN={load:FN,reset:BN},VN=Math.PI/180,GN=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"projectionMatrix",cl()),(0,Ft.Z)(this,"viewMatrix",cl()),(0,Ft.Z)(this,"viewProjectionMatrix",cl()),(0,Ft.Z)(this,"ViewProjectionMatrixUncentered",cl()),(0,Ft.Z)(this,"viewUncenteredMatrix",cl())}return zt(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=void 0===e?1:e,r=t.pitch,i=void 0===r?0:r,o=t.bearing,a=void 0===o?0:o,s=t.center,u=void 0===s?[0,0]:s,c=t.offsetOrigin,l=void 0===c?[0,0]:c,h=t.cameraHeight,f=void 0===h?1:h,p=t.aspect,d=void 0===p?1:p,v=t.near,m=void 0===v?.1:v,g=t.far,y=void 0===g?1e3:g,_=t.fov,x=void 0===_?0:_;this.zoom=n,this.center=u;var b=i*VN,w=(360-a)*VN;Zl(this.projectionMatrix,x,d,m,y);var E=nb(f*Math.sin(b)*Math.sin(w),-f*Math.sin(b)*Math.cos(w),f*Math.cos(b)),S=nb(-Math.cos(b)*Math.sin(w),Math.cos(b)*Math.cos(w),Math.sin(b));Xl(this.viewMatrix,E,nb(0,0,0),S),this.viewUncenteredMatrix=ll(this.viewMatrix),xl(this.viewMatrix,this.viewMatrix,nb(-l[0],l[1],0)),_l(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),_l(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 524288}},{key:"getCenter",value:function(){var t=(0,Li.Z)(this.center,2),e=t[0],n=t[1];return[e,n]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));var s=.5/Math.PI,u=.5,c=-.5/Math.PI;return i=.5,o=r*(s*o+u)-215440491,a=-(r*(c*a+i)-106744817),[o,a]}}]),t}(),HN=["id","style","minZoom","maxZoom","token","mapInstance","plugin"];function WN(t){var e=qN();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function qN(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}window.forceWebGL=!0;var XN="15cd8a57710d40c9b7c0e3cc120f1200",YN="1.4.15",KN=!1,QN=[],JN=12,$N=(UN=(0,xc.b2)(),UN(jN=function(t){Yt(n,t);var e=WN(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"version",ux["GAODE1.x"]),(0,Ft.Z)(Kt(t),"handleCameraChanged",(function(e){var n=e.camera,r=n.fov,i=n.near,o=n.far,a=n.height,s=n.pitch,u=n.rotation,c=n.aspect,l=n.position,h=t.getCenter(),f=h.lng,p=h.lat;if(t.emit("mapchange"),t.cameraChangedCallback){t.viewport.syncWithMapCamera({aspect:c,bearing:360-u,far:o,fov:r,cameraHeight:a,near:i,pitch:s,zoom:t.map.getZoom()-1,center:[f,p],offsetOrigin:[l.x,l.y]});var d=t.config.offsetZoom,v=void 0===d?JN:d;t.viewport.getZoom()>v?t.coordinateSystemService.setCoordinateSystem(Uh.P20_OFFSET):t.coordinateSystemService.setCoordinateSystem(Uh.P20),t.cameraChangedCallback(t.viewport)}})),t}return zt(n,[{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.viewport.projectFlat(t),o=cl();return xl(o,o,nb(i[0],i[1],e)),bl(o,o,nb(r[0],r[1],r[2])),El(o,o,n[0]),Sl(o,o,n[1]),Al(o,o,n[2]),o}},{key:"init",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l,h,f,p,d,v=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,c=e.token,l=void 0===c?XN:c,h=e.mapInstance,f=e.plugin,p=void 0===f?[]:f,d=Jf(e,HN),t.next=3,new Promise((function(t){var e=function(){if(h)v.map=h,v.$mapContainer=v.map.getContainer(),setTimeout((function(){v.map.on("camerachange",v.handleCameraChanged),t()}),30);else{v.$mapContainer=v.creatMapContainer(n);var e=(0,k.Z)({mapStyle:v.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},d);e.zoom&&(e.zoom+=1);var r=new AMap.Map(v.$mapContainer,e);r.on("camerachange",v.handleCameraChanged),r.on("camerachange",(function(){setTimeout((function(){return v.handleAfterMapChange()}))})),v.map=r,setTimeout((function(){t()}),10)}};KN||h?KN&&window.AMap||h?e():QN.push(e):(KN=!0,p.push("Map3D"),ZN.load({key:l,version:YN,plugins:p}).then((function(t){e(),QN.length&&(QN.forEach((function(t){return t()})),QN=[])})).catch((function(t){throw new Error(t)})))}));case 3:this.viewport=new GN;case 4:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"meterToCoord",value:function(t,e){var n=AMap.GeometryUtil.distance(ee(AMap.LngLat,(0,C.Z)(t)),ee(AMap.LngLat,(0,C.Z)(e))),r=this.lngLatToCoord(t),i=(0,Li.Z)(r,2),o=i[0],a=i[1],s=this.lngLatToCoord(e),u=(0,Li.Z)(s,2),c=u[0],l=u[1],h=Math.sqrt(Math.pow(o-c,2)+Math.pow(a-l,2));return h/n}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"exportMap",value:function(t){var e,n=null===(e=this.getContainer())||void 0===e?void 0:e.getElementsByClassName("amap-layer")[0],r="jpg"===t?null===n||void 0===n?void 0:n.toDataURL("image/jpeg"):null===n||void 0===n?void 0:n.toDataURL("image/png");return r}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}}]),n}(RN))||jN);function tz(t){var e=ez();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function ez(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var nz,rz,iz=function(t){Yt(n,t);var e=tz(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getServiceConstructor",value:function(){return $N}}]),n}(LD),oz=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"projectionMatrix",cl()),(0,Ft.Z)(this,"viewMatrix",cl()),(0,Ft.Z)(this,"viewProjectionMatrix",cl()),(0,Ft.Z)(this,"ViewProjectionMatrixUncentered",cl()),(0,Ft.Z)(this,"viewUncenteredMatrix",cl())}return zt(t,[{key:"syncWithMapCamera",value:function(t){var e=t.zoom,n=void 0===e?1:e,r=t.center,i=void 0===r?[0,0]:r,o=t.offsetOrigin,s=void 0===o?[0,0]:o,u=t.cameraPosition,c=void 0===u?[0,0,0]:u,l=t.up,h=void 0===l?[0,1,0]:l,f=t.lookAt,p=void 0===f?[0,0,0]:f,d=t.aspect,v=void 0===d?1:d,m=t.near,g=void 0===m?.1:m,y=t.far,_=void 0===y?1e3:y,x=t.fov,b=void 0===x?45:x;this.zoom=n,this.center=i,Zl(this.projectionMatrix,b/180*Math.PI,v,g,_);var w=nb.apply(a,(0,C.Z)(c)),E=nb.apply(a,(0,C.Z)(p)),S=nb.apply(a,(0,C.Z)(h));Xl(this.viewMatrix,w,E,S),this.viewUncenteredMatrix=ll(this.viewMatrix),xl(this.viewMatrix,this.viewMatrix,nb(-s[0],s[1],0)),_l(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),_l(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"getZoom",value:function(){return this.zoom}},{key:"getZoomScale",value:function(){return 1048576}},{key:"getCenter",value:function(){var t=(0,Li.Z)(this.center,2),e=t[0],n=t[1];return[e,n]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewUncenteredMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.ViewProjectionMatrixUncentered}},{key:"getFocalDistance",value:function(){return 1.2}},{key:"projectFlat",value:function(t){var e=85.0511287798,n=Math.max(Math.min(e,t[1]),-e),r=256<<20,i=Math.PI/180,o=t[0]*i,a=n*i;a=Math.log(Math.tan(Math.PI/4+a/2));var s=.5/Math.PI,u=.5,c=-.5/Math.PI;return i=.5,o=r*(s*o+u)-215440491,a=-(r*(c*a+i)-106744817),[o,a]}}]),t}(),az=["id","style","minZoom","maxZoom","token","mapInstance","plugin","version"];function sz(t){var e=uz();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function uz(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function cz(t,e){var n="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,r="undefined"!==typeof wx&&null!==wx&&("undefined"!==typeof wx.request||"undefined"!==typeof wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a),a}}cz(".amap-logo{\n display: none !important;\n}\n");var lz=[108.92361,34.54083];window.forceWebGL=!0;var hz="ff533602d57df6f8ab3b0fea226ae52f",fz="2.0",pz=(nz=(0,xc.b2)(),nz(rz=function(t){Yt(n,t);var e=sz(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"version",ux["GAODE2.x"]),(0,Ft.Z)(Kt(t),"handleViewChanged",(function(e){var n=t.map.customCoords.getCameraParams(),r=n.fov,i=n.near,o=n.far,a=n.aspect,s=n.position,u=n.lookAt,c=n.up;t.emit("mapchange");var l=t.map.customCoords.getCenter();t.cameraChangedCallback&&(t.viewport.syncWithMapCamera({aspect:a,far:o,fov:r,cameraPosition:s,lookAt:u,up:c,near:i,zoom:t.map.getZoom()-1,center:l,offsetOrigin:[s[0],s[1]]}),t.coordinateSystemService.setCoordinateSystem(Uh.P20_2),t.cameraChangedCallback(t.viewport))})),t}return zt(n,[{key:"setCustomCoordCenter",value:function(t){this.sceneCenter=t,this.sceneCenterMercator=Do.apply(void 0,(0,C.Z)(t))}},{key:"getCustomCoordCenter",value:function(){return this.sceneCenterMercator}},{key:"lngLatToCoordByLayer",value:function(t,e){var n=e||this.sceneCenterMercator,r=this._sub(Do(t[0],t[1]),n);return t[2]&&r.push(t[2]),r}},{key:"coordToAMap2RelativeCoordinates",value:function(t,e){var n=this,r=Do(e[0],e[1]);return"number"===typeof t[0]?this.lngLatToCoordByLayer(t,r):t.map((function(t){return Array.isArray(t)&&"number"===typeof t[0]?n.lngLatToCoordByLayer(t,r):t.map((function(t){return n.lngLatToCoordByLayer(t,r)}))}))}},{key:"setCoordCenter",value:function(t){this.map.customCoords.setCenter(t||lz),this.setCustomCoordCenter(t||lz)}},{key:"lngLatToCoord",value:function(t){return this.sceneCenter||(this.map.customCoords.setCenter(t),this.setCustomCoordCenter(t)),this._sub(Do(t[0],t[1]),this.sceneCenterMercator)}},{key:"lngLatToCoords",value:function(t){var e=this;return t.map((function(t){return"number"===typeof t[0]?e.lngLatToCoord(t):t.map((function(t){return e.lngLatToCoord(t)}))}))}},{key:"addMarkerContainer",value:function(){if(this.map){var t=this.map.getContainer();if(null!==t){var e=t.getElementsByClassName("amap-maps")[0];e.style.zIndex="auto",this.markerContainer=Bi("div","l7-marker-container2",e)}}}},{key:"updateView",value:function(t){}},{key:"getOverlayContainer",value:function(){}},{key:"getType",value:function(){return"amap2"}},{key:"getBounds",value:function(){var t=this.map.getBounds(),e=t.getNorthEast(),n=t.getSouthWest(),r=this.getCenter(),i=r.lng>e.getLng()||r.lng<n.getLng()?180-e.getLng():e.getLng(),o=r.lng<n.getLng()?n.getLng()-180:n.getLng();return[[o,n.getLat()],[i,e.getLat()]]}},{key:"getMinZoom",value:function(){var t=this.map.getZooms();return t[0]-1}},{key:"getMaxZoom",value:function(){var t=this.map.getZooms();return t[1]-1}},{key:"lngLatToContainer",value:function(t){var e=this.map.lngLatToContainer(t);return{x:e.getX(),y:e.getY()}}},{key:"lngLatToPixel",value:function(t){var e=this.map.lngLatToPixel(new AMap.LngLat(t[0],t[1]));return{x:e.getX(),y:e.getY()}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=this.map.customCoords.lngLatToCoord(t),o=cl();return xl(o,o,nb(i[0],i[1],e)),bl(o,o,nb(r[0],r[1],r[2])),El(o,o,n[0]),Sl(o,o,n[1]),Al(o,o,n[2]),o}},{key:"init",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m,g,y,_,x,b;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(e=this.config,n=e.id,r=e.style,i=void 0===r?"light":r,o=e.minZoom,a=void 0===o?0:o,s=e.maxZoom,u=void 0===s?18:s,c=e.token,l=void 0===c?hz:c,h=e.mapInstance,f=e.plugin,p=void 0===f?[]:f,d=e.version,void 0===d?fz:d,v=Jf(e,az),this.viewport=new oz,window.AMap||h){t.next=6;break}return p.push("Map3D"),t.next=6,DD().load({key:l,version:fz,plugins:p});case 6:h?(this.map=h,this.$mapContainer=this.map.getContainer(),g=this.map.getCenter(),null===(m=this.map.customCoords)||void 0===m||m.setCenter([g.lng,g.lat]),this.setCustomCoordCenter([g.lng,g.lat]),this.map.on("viewchange",this.handleViewChanged)):(this.$mapContainer=this.creatMapContainer(n),_=(0,k.Z)({mapStyle:this.getMapStyleValue(i),zooms:[a,u],viewMode:"3D"},v),_.zoom&&(_.zoom+=1),x=new AMap.Map(this.$mapContainer,_),this.map=x,b=x.getCenter(),null===(y=this.map.customCoords)||void 0===y||y.setCenter([b.lng,b.lat]),this.setCustomCoordCenter([b.lng,b.lat]),x.on("viewchange",this.handleViewChanged)),this.initViewPort();case 8:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"initViewPort",value:function(){var t,e=null===(t=this.map.customCoords)||void 0===t?void 0:t.getCameraParams(),n=e.fov,r=e.near,i=e.far,o=e.aspect,a=e.position,s=e.lookAt,u=e.up;this.emit("mapchange");var c=this.map.customCoords.getCenter(),l=this.map.getZoom();this.cameraChangedCallback&&(this.viewport.syncWithMapCamera({aspect:o,far:i,fov:n,cameraPosition:a,lookAt:s,near:r,up:u,zoom:l-1,center:c,offsetOrigin:[a[0],a[1]]}),this.coordinateSystemService.setCoordinateSystem(Uh.P20_2),this.cameraChangedCallback(this.viewport))}},{key:"_sub",value:function(t,e){var n=[0,0];return n[0]=t[0]-e[0],n[1]=t[1]-e[1],n}}]),n}(RN))||rz);function dz(t){var e=vz();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function vz(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var mz,gz=function(t){Yt(n,t);var e=dz(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getServiceConstructor",value:function(){return pz}}]),n}(LD),yz=n(21722),_z=n.n(yz);function xz(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=bz(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function bz(t,e){if(t){if("string"===typeof t)return wz(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wz(t,e):void 0}}function wz(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function Ez(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function Sz(t,e,n){return Math.min(n,Math.max(e,t))}function Az(t,e,n){return t*(1-n)+e*n}function Tz(t,e,n,r){var i=new(_z())(t,e,n,r);return function(t){return i.solve(t)}}var Cz=Tz(.25,.1,.25,1);function kz(){return!(yr||!xr.matchMedia)&&(null==mz&&(mz=xr.matchMedia("(prefers-reduced-motion: reduce)")),mz.matches)}function Mz(t,e){var n,r={},i=xz(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;o in t&&(r[o]=t[o])}}catch(a){i.e(a)}finally{i.f()}return r}var Pz=yr?Date.now.bind(Date):xr.performance&&xr.performance.now?xr.performance.now.bind(xr.performance):Date.now.bind(Date),Iz=xr.requestAnimationFrame||xr.mozRequestAnimationFrame||xr.webkitRequestAnimationFrame||xr.msRequestAnimationFrame,Rz=xr.cancelAnimationFrame||xr.mozCancelAnimationFrame||xr.webkitCancelAnimationFrame||xr.msCancelAnimationFrame;function Lz(t){var e=Iz(t);return{cancel:function(){return Rz(e)}}}function Oz(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];for(var i=0,o=n;i<o.length;i++){var a=o[i];for(var s in a)void 0!==a[s]&&(t[s]=a[s])}return t}var Dz=6371008.8,Nz=function(){function t(e,n){if(Ot(this,t),isNaN(e)||isNaN(n))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(n,")"));if(this.lng=+e,this.lat=+n,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}return zt(t,[{key:"wrap",value:function(){return new t(Ez(this.lng,-180,180),this.lat)}},{key:"toArray",value:function(){return[this.lng,this.lat]}},{key:"toString",value:function(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}},{key:"distanceTo",value:function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e),o=Dz*Math.acos(Math.min(i,1));return o}}],[{key:"convert",value:function(e){if(e instanceof t)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new t(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"===(0,I.Z)(e)&&null!==e){var n="lng"in e?e.lng:e.lon;return new t(Number(n),Number(e.lat))}throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}]),t}(),zz=function(){function t(e,n){Ot(this,t),e&&(n?this.setSouthWest(e).setNorthEast(n):4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}return zt(t,[{key:"setNorthEast",value:function(t){return this.ne=t instanceof Nz?new Nz(t.lng,t.lat):Nz.convert(t),this}},{key:"setSouthWest",value:function(t){return this.sw=t instanceof Nz?new Nz(t.lng,t.lat):Nz.convert(t),this}},{key:"extend",value:function(e){var n,r,i=this.sw,o=this.ne;if(e instanceof Nz)n=e,r=e;else{if(!(e instanceof t)){if(Array.isArray(e)){if(4===e.length||e.every(Array.isArray)){var a=e;return this.extend(t.convert(a))}var s=e;return this.extend(Nz.convert(s))}return this}if(n=e.sw,r=e.ne,!n||!r)return this}return i||o?(i.lng=Math.min(n.lng,i.lng),i.lat=Math.min(n.lat,i.lat),o.lng=Math.max(r.lng,o.lng),o.lat=Math.max(r.lat,o.lat)):(this.sw=new Nz(n.lng,n.lat),this.ne=new Nz(r.lng,r.lat)),this}},{key:"getCenter",value:function(){return new Nz((this.sw.lng+this.ne.lng)/2,(this.sw.lat+this.ne.lat)/2)}},{key:"getSouthWest",value:function(){return this.sw}},{key:"getNorthEast",value:function(){return this.ne}},{key:"getNorthWest",value:function(){return new Nz(this.getWest(),this.getNorth())}},{key:"getSouthEast",value:function(){return new Nz(this.getEast(),this.getSouth())}},{key:"getWest",value:function(){return this.sw.lng}},{key:"getSouth",value:function(){return this.sw.lat}},{key:"getEast",value:function(){return this.ne.lng}},{key:"getNorth",value:function(){return this.ne.lat}},{key:"toArray",value:function(){return[this.sw.toArray(),this.ne.toArray()]}},{key:"toString",value:function(){return"LngLatBounds(".concat(this.sw.toString(),", ").concat(this.ne.toString(),")")}},{key:"isEmpty",value:function(){return!(this.sw&&this.ne)}},{key:"contains",value:function(t){var e=Nz.convert(t),n=e.lng,r=e.lat,i=this.sw.lat<=r&&r<=this.ne.lat,o=this.sw.lng<=n&&n<=this.ne.lng;return this.sw.lng>this.ne.lng&&(o=this.sw.lng>=n&&n>=this.ne.lng),i&&o}}],[{key:"convert",value:function(e){return e instanceof t?e:new t(e)}}]),t}(),Fz=function(){function t(e,n){Ot(this,t),this.x=e,this.y=n}return zt(t,[{key:"clone",value:function(){return new t(this.x,this.y)}},{key:"_add",value:function(t){return this.x+=t.x,this.y+=t.y,this}},{key:"add",value:function(t){return this.clone()._add(t)}},{key:"_sub",value:function(t){return this.x-=t.x,this.y-=t.y,this}},{key:"sub",value:function(t){return this.clone()._sub(t)}},{key:"_multByPoint",value:function(t){return this.x*=t.x,this.y*=t.y,this}},{key:"multByPoint",value:function(t){return this.clone()._multByPoint(t)}},{key:"_divByPoint",value:function(t){return this.x/=t.x,this.y/=t.y,this}},{key:"divByPoint",value:function(t){return this.clone()._divByPoint(t)}},{key:"_mult",value:function(t){return this.x*=t,this.y*=t,this}},{key:"mult",value:function(t){return this.clone()._mult(t)}},{key:"_div",value:function(t){return this.x/=t,this.y/=t,this}},{key:"div",value:function(t){return this.clone()._div(t)}},{key:"_rotate",value:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this}},{key:"rotate",value:function(t){return this.clone()._rotate(t)}},{key:"_rotateAround",value:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this}},{key:"roateAround",value:function(t,e){return this.clone()._rotateAround(t,e)}},{key:"_matMult",value:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this}},{key:"matMult",value:function(t){return this.clone()._matMult(t)}},{key:"_unit",value:function(){return this.div(this.mag()),this}},{key:"unit",value:function(){return this.clone()._unit()}},{key:"_perp",value:function(){var t=this.y;return this.y=this.x,this.x=-t,this}},{key:"perp",value:function(){return this.clone()._perp()}},{key:"_round",value:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},{key:"round",value:function(){return this.clone()._round()}},{key:"mag",value:function(){return Math.sqrt(this.x*this.x+this.y*this.y)}},{key:"equals",value:function(t){return this.x===t.x&&this.y===t.y}},{key:"dist",value:function(t){return Math.sqrt(this.distSqr(t))}},{key:"distSqr",value:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n}},{key:"angle",value:function(){return Math.atan2(this.y,this.x)}},{key:"angleTo",value:function(t){return Math.atan2(this.y-t.y,this.x-t.x)}},{key:"angleWith",value:function(t){return this.angleWithSep(t.x,t.y)}},{key:"angleWithSep",value:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)}}],[{key:"convert",value:function(e){return e instanceof t?e:Array.isArray(e)?new t(e[0],e[1]):e}}]),t}();n(83753),n(76495);function Bz(){var t=new ou(4);return ou!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t}function Uz(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t}var jz=function(){function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(Ot(this,t),isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0||isNaN(i)||i<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=n,this.left=r,this.right=i}return zt(t,[{key:"interpolate",value:function(t,e,n){return null!=e.top&&null!=t.top&&(this.top=Az(t.top,e.top,n)),null!=e.bottom&&null!=t.bottom&&(this.bottom=Az(t.bottom,e.bottom,n)),null!=e.left&&null!=t.left&&(this.left=Az(t.left,e.left,n)),null!=e.right&&null!=t.right&&(this.right=Az(t.right,e.right,n)),this}},{key:"getCenter",value:function(t,e){var n=Sz((this.left+t-this.right)/2,0,t),r=Sz((this.top+e-this.bottom)/2,0,e);return new Fz(n,r)}},{key:"equals",value:function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}},{key:"clone",value:function(){return new t(this.top,this.bottom,this.left,this.right)}},{key:"toJSON",value:function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}]),t}(),Zz=2*Math.PI*Dz;function Vz(t){return Zz*Math.cos(t*Math.PI/180)}function Gz(t){return(180+t)/360}function Hz(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Wz(t,e){return t/Vz(e)}function qz(t){return 360*t-180}function Xz(t){var e=180-360*t;return 360/Math.PI*Math.atan(Math.exp(e*Math.PI/180))-90}function Yz(t,e){return t*Vz(Xz(e))}function Kz(t){return 1/Math.cos(t*Math.PI/180)}var Qz=function(){function t(e,n){var r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Ot(this,t),this.x=+e,this.y=+n,this.z=+r}return zt(t,[{key:"toLngLat",value:function(){return new Nz(qz(this.x),Xz(this.y))}},{key:"toAltitude",value:function(){return Yz(this.z,this.y)}},{key:"meterInMercatorCoordinateUnits",value:function(){return 1/Zz*Kz(Xz(this.y))}}],[{key:"fromLngLat",value:function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=Nz.convert(e);return new t(Gz(r.lng),Hz(r.lat),Wz(n,r.lat))}}]),t}();function Jz(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=$z(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function $z(t,e){if(t){if("string"===typeof t)return tF(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?tF(t,e):void 0}}function tF(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var eF=function(){function t(e,n,r,i,o){Ot(this,t),this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=void 0===r||null===r?0:r,this._maxPitch=void 0===i||null===i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new Nz(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this.unmodified=!0,this.edgeInsets=new jz,this.posMatrixCache={},this.alignedPosMatrixCache={}}return zt(t,[{key:"minZoom",get:function(){return this._minZoom},set:function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}},{key:"maxZoom",get:function(){return this._maxZoom},set:function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}},{key:"minPitch",get:function(){return this._minPitch},set:function(t){this._minPitch!==t&&(this._minPitch=t,this._pitch=Math.max(this._pitch,t))}},{key:"maxPitch",get:function(){return this._maxPitch},set:function(t){this._maxPitch!==t&&(this._maxPitch=t,this._pitch=Math.min(this._pitch,t))}},{key:"renderWorldCopies",get:function(){return this._renderWorldCopies},set:function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}},{key:"worldSize",get:function(){return this.tileSize*this.scale}},{key:"centerOffset",get:function(){return this.centerPoint._sub(this.size._div(2))}},{key:"size",get:function(){return new Fz(this.width,this.height)}},{key:"bearing",get:function(){return-this.angle/Math.PI*180},set:function(t){var e=-Ez(t,-180,180)*Math.PI/180;this.angle!==e&&(this.unmodified=!1,this.angle=e,this.calcMatrices(),this.rotationMatrix=Bz(),Uz(this.rotationMatrix,this.rotationMatrix,this.angle))}},{key:"pitch",get:function(){return this._pitch/Math.PI*180},set:function(t){var e=Sz(t,this._minPitch,this._maxPitch)/180*Math.PI;this._pitch!==e&&(this.unmodified=!1,this._pitch=e,this.calcMatrices())}},{key:"fov",get:function(){return this._fov/Math.PI*180},set:function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this.unmodified=!1,this._fov=t/180*Math.PI,this.calcMatrices())}},{key:"zoom",get:function(){return this._zoom},set:function(t){var e=Math.min(Math.max(t,this._minZoom),this._maxZoom);this._zoom!==e&&(this.unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this.constrain(),this.calcMatrices())}},{key:"center",get:function(){return this._center},set:function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this.unmodified=!1,this._center=t,this.constrain(),this.calcMatrices())}},{key:"padding",get:function(){return this.edgeInsets.toJSON()},set:function(t){this.edgeInsets.equals(t)||(this.unmodified=!1,this.edgeInsets.interpolate(this.edgeInsets,t,1),this.calcMatrices())}},{key:"centerPoint",get:function(){return this.edgeInsets.getCenter(this.width,this.height)}},{key:"point",get:function(){return this.project(this.center)}},{key:"clone",value:function(){var e=new t(this._minZoom,this._maxZoom,this._minPitch,this._maxPitch,this._renderWorldCopies);return e.tileSize=this.tileSize,e.latRange=this.latRange,e.width=this.width,e.height=this.height,e.center=this._center,e.zoom=this.zoom,e.angle=this.angle,e.fov=this._fov,e.pitch=this._pitch,e.unmodified=this.unmodified,e.edgeInsets=this.edgeInsets.clone(),e.calcMatrices(),e}},{key:"isPaddingEqual",value:function(t){return this.edgeInsets.equals(t)}},{key:"interpolatePadding",value:function(t,e,n){this.unmodified=!1,this.edgeInsets.interpolate(t,e,n),this.constrain(),this.calcMatrices()}},{key:"coveringZoomLevel",value:function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}},{key:"resize",value:function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this.constrain(),this.calcMatrices()}},{key:"zoomScale",value:function(t){return Math.pow(2,t)}},{key:"scaleZoom",value:function(t){return Math.log(t)/Math.LN2}},{key:"project",value:function(t){var e=Sz(t.lat,-this.maxValidLatitude,this.maxValidLatitude);return new Fz(Gz(t.lng)*this.worldSize,Hz(e)*this.worldSize)}},{key:"unproject",value:function(t){return new Qz(t.x/this.worldSize,t.y/this.worldSize).toLngLat()}},{key:"setLocationAtPoint",value:function(t,e){var n=this.pointCoordinate(e),r=this.pointCoordinate(this.centerPoint),i=this.locationCoordinate(t),o=new Qz(i.x-(n.x-r.x),i.y-(n.y-r.y));this.center=this.coordinateLocation(o),this._renderWorldCopies&&(this.center=this.center.wrap())}},{key:"pointCoordinate",value:function(t){var e=0,n=new Float64Array([t.x,t.y,0,1]),r=new Float64Array([t.x,t.y,1,1]);Bh(n,n,this.pixelMatrixInverse),Bh(r,r,this.pixelMatrixInverse);var i=n[3],o=r[3],a=n[0]/i,s=r[0]/o,u=n[1]/i,c=r[1]/o,l=n[2]/i,h=r[2]/o,f=l===h?0:(e-l)/(h-l);return new Qz(Az(a,s,f)/this.worldSize,Az(u,c,f)/this.worldSize)}},{key:"getBounds",value:function(){return(new zz).extend(this.pointLocation(new Fz(0,0))).extend(this.pointLocation(new Fz(this.width,0))).extend(this.pointLocation(new Fz(this.width,this.height))).extend(this.pointLocation(new Fz(0,this.height)))}},{key:"getMaxBounds",value:function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new zz([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null}},{key:"setMaxBounds",value:function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this.constrain()):(this.lngRange=void 0,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])}},{key:"customLayerMatrix",value:function(){return this.mercatorMatrix.slice()}},{key:"maxPitchScaleFactor",value:function(){if(!this.pixelMatrixInverse)return 1;var t=this.pointCoordinate(new Fz(0,0)),e=new Float32Array([t.x*this.worldSize,t.y*this.worldSize,0,1]),n=Bh(e,e,this.pixelMatrix);return n[3]/this.cameraToCenterDistance}},{key:"getCameraPoint",value:function(){var t=this._pitch,e=Math.tan(t)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new Fz(0,e))}},{key:"getCameraQueryGeometry",value:function(t){var e=this.getCameraPoint();if(1===t.length)return[t[0],e];var n,r=e.x,i=e.y,o=e.x,a=e.y,s=Jz(t);try{for(s.s();!(n=s.n()).done;){var u=n.value;r=Math.min(r,u.x),i=Math.min(i,u.y),o=Math.max(o,u.x),a=Math.max(a,u.y)}}catch(c){s.e(c)}finally{s.f()}return[new Fz(r,i),new Fz(o,i),new Fz(o,a),new Fz(r,a),new Fz(r,i)]}},{key:"coordinatePoint",value:function(t){var e=zh(t.x*this.worldSize,t.y*this.worldSize,0,1);return Bh(e,e,this.pixelMatrix),new Fz(e[0]/e[3],e[1]/e[3])}},{key:"locationPoint",value:function(t){return this.coordinatePoint(this.locationCoordinate(t))}},{key:"pointLocation",value:function(t){return this.coordinateLocation(this.pointCoordinate(t))}},{key:"locationCoordinate",value:function(t){return Qz.fromLngLat(t)}},{key:"coordinateLocation",value:function(t){return t.toLngLat()}},{key:"getProjectionMatrix",value:function(){return this.projMatrix}},{key:"constrain",value:function(){if(this.center&&this.width&&this.height&&!this.constraining){this.constraining=!0;var t,e,n,r,i=-90,o=90,a=-180,s=180,u=this.size,c=this.unmodified;if(this.latRange){var l=this.latRange;i=Hz(l[1])*this.worldSize,o=Hz(l[0])*this.worldSize,t=o-i<u.y?u.y/(o-i):0}if(this.lngRange){var h=this.lngRange;a=Gz(h[0])*this.worldSize,s=Gz(h[1])*this.worldSize,e=s-a<u.x?u.x/(s-a):0}var f=this.point,p=Math.max(e||0,t||0);if(p)return this.center=this.unproject(new Fz(e?(s+a)/2:f.x,t?(o+i)/2:f.y)),yr?this.zoom=Math.max(this.zoom,Math.max(-1,this.minZoom)):this.zoom+=this.scaleZoom(p),this.unmodified=c,void(this.constraining=!1);if(this.latRange){var d=f.y,v=u.y/2;d-v<i&&(r=i+v),d+v>o&&(r=o-v)}if(this.lngRange){var m=f.x,g=u.x/2;m-g<a&&(n=a+g),m+g>s&&(n=s-g)}void 0===n&&void 0===r||(this.center=this.unproject(new Fz(void 0!==n?n:f.x,void 0!==r?r:f.y))),this.unmodified=c,this.constraining=!1}}},{key:"calcMatrices",value:function(){if(this.height){var t=this._fov/2,e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(t)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(Sz(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance,c=1.01*u,l=this.height/50,h=new Float64Array(16);Zl(h,this._fov,this.width/this.height,l,c),h[8]=2*-e.x/this.width,h[9]=2*e.y/this.height,bl(h,h,[1,-1,1]),xl(h,h,[0,0,-this.cameraToCenterDistance]),El(h,h,this._pitch),Al(h,h,this.angle),xl(h,h,[-a,-s,0]),this.mercatorMatrix=bl([],h,[this.worldSize,this.worldSize,this.worldSize]),bl(h,h,[1,1,Wz(1,this.center.lat)*this.worldSize,1]),this.projMatrix=h,this.invProjMatrix=ml([],this.projMatrix);var f=this.width%2/2,p=this.height%2/2,d=Math.cos(this.angle),v=Math.sin(this.angle),m=a-Math.round(a)+d*f+v*p,g=s-Math.round(s)+d*p+v*f,y=new Float64Array(h);if(xl(y,y,[m>.5?m-1:m,g>.5?g-1:g,0]),this.alignedProjMatrix=y,h=cl(),bl(h,h,[this.width/2,-this.height/2,1]),xl(h,h,[1,-1,0]),this.labelPlaneMatrix=h,h=cl(),bl(h,h,[1,-1,1]),xl(h,h,[-1,-1,0]),bl(h,h,[2/this.width,2/this.height,1]),this.glCoordMatrix=h,this.pixelMatrix=_l(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),h=ml(new Float64Array(16),this.pixelMatrix),!h)throw new Error("failed to invert matrix");this.pixelMatrixInverse=h,this.posMatrixCache={},this.alignedPosMatrixCache={}}}}]),t}(),nF=n(98878),rF=n.n(nF),iF=zt((function t(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Ot(this,t),rF()(this,n),this.type=e}));function oF(t){var e=aF();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function aF(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var sF=function(t){Yt(n,t);var e=oF(n);function n(t){var r;Ot(this,n),r=e.call(this),(0,Ft.Z)(Kt(r),"renderFrameCallback",(function(){var t=Math.min((Pz()-r.easeStart)/r.easeOptions.duration,1);r.onEaseFrame(r.easeOptions.easing(t)),t<1?r.easeFrameId=r.requestRenderFrame(r.renderFrameCallback):r.stop()})),r.options=t;var i=t.minZoom,o=t.maxZoom,a=t.minPitch,s=t.maxPitch,u=t.renderWorldCopies;return r.moving=!1,r.zooming=!1,r.bearingSnap=t.bearingSnap,r.pitchEnabled=t.pitchEnabled,r.rotateEnabled=t.rotateEnabled,r.transform=new eF(i,o,a,s,u),r}return zt(n,[{key:"requestRenderFrame",value:function(t){return 0}},{key:"cancelRenderFrame",value:function(t){}},{key:"getCenter",value:function(){var t=this.transform.center,e=t.lng,n=t.lat;return new Nz(e,n)}},{key:"getZoom",value:function(){return this.transform.zoom}},{key:"getPitch",value:function(){return this.transform.pitch}},{key:"setCenter",value:function(t,e){return this.jumpTo({center:t},e)}},{key:"setPitch",value:function(t,e){return this.jumpTo({pitch:t},e),this}},{key:"getBearing",value:function(){return this.transform.bearing}},{key:"panTo",value:function(t,e,n){return this.easeTo((0,Oi.merge)({center:t},e),n)}},{key:"panBy",value:function(t,e,n){return t=Fz.convert(t).mult(-1),this.panTo(this.transform.center,Oz({offset:t},e||{}),n)}},{key:"zoomOut",value:function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}},{key:"setBearing",value:function(t,e){return this.jumpTo({bearing:t},e),this}},{key:"setZoom",value:function(t,e){return this.jumpTo({zoom:t},e),this}},{key:"zoomIn",value:function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}},{key:"zoomTo",value:function(t,e,n){return this.easeTo((0,Oi.merge)({zoom:t},e),n)}},{key:"getPadding",value:function(){return this.transform.padding}},{key:"setPadding",value:function(t,e){return this.jumpTo({padding:t},e),this}},{key:"rotateTo",value:function(t,e,n){return this.easeTo((0,Oi.merge)({bearing:t},e),n)}},{key:"resetNorth",value:function(t,e){return this.rotateTo(0,(0,Oi.merge)({duration:1e3},t),e),this}},{key:"resetNorthPitch",value:function(t,e){return this.easeTo((0,Oi.merge)({bearing:0,pitch:0,duration:1e3},t),e),this}},{key:"fitBounds",value:function(t,e,n){return this.fitInternal(this.cameraForBounds(t,e),e,n)}},{key:"cameraForBounds",value:function(t,e){return t=zz.convert(t),this.cameraForBoxAndBearing(t.getNorthWest(),t.getSouthEast(),0,e)}},{key:"snapToNorth",value:function(t,e){return Math.abs(this.getBearing())<this.bearingSnap?this.resetNorth(t,e):this}},{key:"jumpTo",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=arguments.length>1?arguments[1]:void 0;this.stop();var n=this.transform,r=!1,i=!1,o=!1;return void 0!==t.zoom&&n.zoom!==+t.zoom&&(r=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=Nz.convert(t.center)),void 0!==t.bearing&&n.bearing!==+t.bearing&&(i=!0,n.bearing=+t.bearing),void 0!==t.pitch&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch),void 0===t.padding||n.isPaddingEqual(t.padding)||(n.padding=t.padding),this.emit("movestart",new iF("movestart",e)),this.emit("move",new iF("move",e)),r&&(this.emit("zoomstart",new iF("zoomstart",e)),this.emit("zoom",new iF("zoom",e)),this.emit("zoomend",new iF("zoomend",e))),i&&(this.emit("rotatestart",new iF("rotatestart",e)),this.emit("rotate",new iF("rotate",e)),this.emit("rotateend",new iF("rotateend",e))),o&&(this.emit("pitchstart",new iF("pitchstart",e)),this.emit("pitch",new iF("pitch",e)),this.emit("pitchend",new iF("pitchend",e))),this.emit("moveend",new iF("moveend",e))}},{key:"easeTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;e=(0,Oi.merge)({offset:[0,0],duration:500,easing:Cz},e),(!1===e.animate||!e.essential&&kz())&&(e.duration=0);var r=this.transform,i=this.getZoom(),o=this.getBearing(),a=this.getPitch(),s=this.getPadding(),u=e.zoom?+e.zoom:i,c=e.bearing?this.normalizeBearing(e.bearing,o):o,l=e.pitch?+e.pitch:a,h=e.padding?e.padding:r.padding,f=Fz.convert(e.offset),p=r.centerPoint.add(f),d=r.pointLocation(p),v=Nz.convert(e.center||d);this.normalizeCenter(v);var m,g,y=r.project(d),_=r.project(v).sub(y),x=r.zoomScale(u-i);e.around&&(m=Nz.convert(e.around),g=r.locationPoint(m));var b={moving:this.moving,zooming:this.zooming,rotating:this.rotating,pitching:this.pitching};return this.zooming=this.zooming||u!==i,this.rotating=this.rotating||o!==c,this.pitching=this.pitching||l!==a,this.padding=!r.isPaddingEqual(h),this.easeId=e.easeId,this.prepareEase(n,e.noMoveStart,b),clearTimeout(this.easeEndTimeoutID),this.ease((function(e){if(t.zooming&&(r.zoom=Az(i,u,e)),t.rotating&&t.rotateEnabled&&(r.bearing=Az(o,c,e)),t.pitching&&t.pitchEnabled&&(r.pitch=Az(a,l,e)),t.padding&&(r.interpolatePadding(s,h,e),p=r.centerPoint.add(f)),m)r.setLocationAtPoint(m,g);else{var d=r.zoomScale(r.zoom-i),v=u>i?Math.min(2,x):Math.max(.5,x),b=Math.pow(v,1-e),w=r.unproject(y.add(_.mult(e*b)).mult(d));r.setLocationAtPoint(r.renderWorldCopies?w.wrap():w,p)}t.fireMoveEvents(n)}),(function(e){t.afterEase(n,e)}),e),this}},{key:"flyTo",value:function(){var t=this,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;if(!e.essential&&kz()){var r=Mz(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),e=(0,Oi.merge)({offset:[0,0],speed:1.2,curve:1.42,easing:Cz},e);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),c=e.zoom?Sz(+e.zoom,i.minZoom,i.maxZoom):o,l=e.bearing?this.normalizeBearing(e.bearing,a):a,h=e.pitch?+e.pitch:s,f="padding"in e?e.padding:i.padding,p=i.zoomScale(c-o),d=Fz.convert(e.offset),v=i.centerPoint.add(d),m=i.pointLocation(v),g=Nz.convert(e.center||m);this.normalizeCenter(g);var y=i.project(m),_=i.project(g).sub(y),x=e.curve,b=Math.max(i.width,i.height),w=b/p,E=_.mag();if("minZoom"in e){var S=Sz(Math.min(e.minZoom,o,c),i.minZoom,i.maxZoom),A=b/i.zoomScale(S-o);x=Math.sqrt(A/E*2)}var T=x*x;function C(t){var e=(w*w-b*b+(t?-1:1)*T*T*E*E)/(2*(t?w:b)*T*E);return Math.log(Math.sqrt(e*e+1)-e)}function k(t){return(Math.exp(t)-Math.exp(-t))/2}function M(t){return(Math.exp(t)+Math.exp(-t))/2}function P(t){return k(t)/M(t)}var I=C(0),R=function(t){return M(I)/M(I+x*t)},L=function(t){return b*((M(I)*P(I+x*t)-k(I))/T)/E},O=(C(1)-I)/x;if(Math.abs(E)<1e-6||!isFinite(O)){if(Math.abs(b-w)<1e-6)return this.easeTo(e,n);var D=w<b?-1:1;O=Math.abs(Math.log(w/b))/x,L=function(){return 0},R=function(t){return Math.exp(D*x*t)}}if("duration"in e)e.duration=+e.duration;else{var N="screenSpeed"in e?+e.screenSpeed/x:+e.speed;e.duration=1e3*O/N}return e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this.zooming=!0,this.rotating=a!==l,this.pitching=h!==s,this.padding=!i.isPaddingEqual(f),this.prepareEase(n,!1),this.ease((function(e){var r=e*O,p=1/R(r);i.zoom=1===e?c:o+i.scaleZoom(p),t.rotating&&(i.bearing=Az(a,l,e)),t.pitching&&(i.pitch=Az(s,h,e)),t.padding&&(i.interpolatePadding(u,f,e),v=i.centerPoint.add(d));var m=1===e?g:i.unproject(y.add(_.mult(L(r))).mult(p));i.setLocationAtPoint(i.renderWorldCopies?m.wrap():m,v),t.fireMoveEvents(n)}),(function(){return t.afterEase(n)}),e),this}},{key:"fitScreenCoordinates",value:function(t,e,n,r,i){return this.fitInternal(this.cameraForBoxAndBearing(this.transform.pointLocation(Fz.convert(t)),this.transform.pointLocation(Fz.convert(e)),n,r),r,i)}},{key:"stop",value:function(t,e){if(this.easeFrameId&&(this.cancelRenderFrame(this.easeFrameId),delete this.easeFrameId,delete this.onEaseFrame),this.onEaseEnd){var n=this.onEaseEnd;delete this.onEaseEnd,n.call(this,e)}return this}},{key:"normalizeBearing",value:function(t,e){t=Ez(t,-180,180);var n=Math.abs(t-e);return Math.abs(t-360-e)<n&&(t-=360),Math.abs(t+360-e)<n&&(t+=360),t}},{key:"normalizeCenter",value:function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}}},{key:"fireMoveEvents",value:function(t){this.emit("move",new iF("move",t)),this.zooming&&this.emit("zoom",new iF("zoom",t)),this.rotating&&this.emit("rotate",new iF("rotate",t)),this.pitching&&this.emit("rotate",new iF("pitch",t))}},{key:"prepareEase",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this.moving=!0,e||n.moving||this.emit("movestart",new iF("movestart",t)),this.zooming&&!n.zooming&&this.emit("zoomstart",new iF("zoomstart",t)),this.rotating&&!n.rotating&&this.emit("rotatestart",new iF("rotatestart",t)),this.pitching&&!n.pitching&&this.emit("pitchstart",new iF("pitchstart",t))}},{key:"afterEase",value:function(t,e){if(!this.easeId||!e||this.easeId!==e){delete this.easeId;var n=this.zooming,r=this.rotating,i=this.pitching;this.moving=!1,this.zooming=!1,this.rotating=!1,this.pitching=!1,this.padding=!1,n&&this.emit("zoomend",new iF("zoomend",t)),r&&this.emit("rotateend",new iF("rotateend",t)),i&&this.emit("pitchend",new iF("pitchend",t)),this.emit("moveend",new iF("moveend",t))}}},{key:"ease",value:function(t,e,n){!1===n.animate||0===n.duration?(t(1),e()):(this.easeStart=Pz(),this.easeOptions=n,this.onEaseFrame=t,this.onEaseEnd=e,this.easeFrameId=this.requestRenderFrame(this.renderFrameCallback))}},{key:"cameraForBoxAndBearing",value:function(t,e,n,r){var i={top:0,bottom:0,right:0,left:0};if(r=(0,Oi.merge)({padding:i,offset:[0,0],maxZoom:this.transform.maxZoom},r),"number"===typeof r.padding){var o=r.padding;r.padding={top:o,bottom:o,right:o,left:o}}r.padding=(0,Oi.merge)(i,r.padding);var a=this.transform,s=a.padding,u=a.project(Nz.convert(t)),c=a.project(Nz.convert(e)),l=u.rotate(-n*Math.PI/180),h=c.rotate(-n*Math.PI/180),f=new Fz(Math.max(l.x,h.x),Math.max(l.y,h.y)),p=new Fz(Math.min(l.x,h.x),Math.min(l.y,h.y)),d=f.sub(p),v=(a.width-(s.left+s.right+r.padding.left+r.padding.right))/d.x,m=(a.height-(s.top+s.bottom+r.padding.top+r.padding.bottom))/d.y;if(!(m<0||v<0)){var g=Math.min(a.scaleZoom(a.scale*Math.min(v,m)),r.maxZoom),y=Fz.convert(r.offset),_=(r.padding.left-r.padding.right)/2,x=(r.padding.top-r.padding.bottom)/2,b=new Fz(y.x+_,y.y+x),w=b.mult(a.scale/a.zoomScale(g)),E=a.unproject(u.add(c).div(2).sub(w));return{center:E,zoom:g,bearing:n}}}},{key:"fitInternal",value:function(t,e,n){return t?(e=(0,Oi.merge)(t,e),delete e.padding,e.linear?this.easeTo(e,n):this.flyTo(e,n)):this}}]),n}(Ma.EventEmitter);function uF(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=cF(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function cF(t,e){if(t){if("string"===typeof t)return lF(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?lF(t,e):void 0}}function lF(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var hF={},fF=hF;hF.create=function(t,e,n){var r=xr.document.createElement(t);return void 0!==e&&(r.className=e),n&&n.appendChild(r),r},hF.createNS=function(t,e){var n=xr.document.createElementNS(t,e);return n};var pF=xr.document&&xr.document.documentElement.style;function dF(t){if(!pF)return t[0];var e,n=uF(t);try{for(n.s();!(e=n.n()).done;){var r=e.value;if(r in pF)return r}}catch(i){n.e(i)}finally{n.f()}return t[0]}var vF,mF=dF(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);hF.disableDrag=function(){pF&&mF&&(vF=pF[mF],pF[mF]="none")},hF.enableDrag=function(){pF&&mF&&(pF[mF]=vF)};var gF=dF(["transform","WebkitTransform"]);hF.setTransform=function(t,e){t.style[gF]=e};var yF=!1;try{var _F=Object.defineProperty({},"passive",{get:function(){yF=!0}});xr.addEventListener("test",_F,_F),xr.removeEventListener("test",_F,_F)}catch(PZ){yF=!1}hF.addEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&yF?t.addEventListener(e,n,r):t.addEventListener(e,n,r.capture)},hF.removeEventListener=function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};"passive"in r&&yF?t.removeEventListener(e,n,r):t.removeEventListener(e,n,r.capture)};var xF=function t(e){e.preventDefault(),e.stopPropagation(),xr.removeEventListener("click",t,!0)};function bF(t){var e=wF();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function wF(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}hF.suppressClick=function(){yr||(xr.addEventListener("click",xF,!0),setTimeout((function(){xr.removeEventListener("click",xF,!0)}),0))},hF.mousePos=function(t,e){if(yr)return new Fz(e.clientX-t.left-0,e.clientY-t.top-0);var n=t.getBoundingClientRect();return new Fz(e.clientX-n.left-t.clientLeft,e.clientY-n.top-t.clientTop)},hF.touchPos=function(t,e){if(yr){var n,r=[],i=uF(e);try{for(i.s();!(n=i.n()).done;){var o=n.value;r.push(new Fz(o.clientX-t.left,o.clientY-t.top))}}catch(PZ){i.e(PZ)}finally{i.f()}return r}var a,s=t.getBoundingClientRect(),u=[],c=uF(e);try{for(c.s();!(a=c.n()).done;){var l=a.value;u.push(new Fz(l.clientX-s.left-t.clientLeft,l.clientY-s.top-t.clientTop))}}catch(PZ){c.e(PZ)}finally{c.f()}return u},hF.mouseButton=function(t){return yr&&"undefined"!==typeof xr.InstallTrigger&&2===t.button&&t.ctrlKey&&xr.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:t.button},hF.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var EF=function(t){Yt(n,t);var e=bF(n);function n(t,r,i){var o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};Ot(this,n);var s=fF.mousePos(r.getCanvasContainer(),i),u=r.unproject(s);return o=e.call(this,t,rF()({point:s,lngLat:u,originalEvent:i},a)),o.defaultPrevented=!1,o.target=r,o}return zt(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(iF);function SF(t){var e=AF();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function AF(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var TF=function(t){Yt(n,t);var e=SF(n);function n(t,r,i){var o;Ot(this,n);var a="touchend"===t?i.changedTouches:i.touches,s=fF.touchPos(r.getCanvasContainer(),a),u=s.map((function(t){return r.unproject(t)})),c=s.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new Fz(0,0)),l=r.unproject(c);return o=e.call(this,t,{points:s,point:c,lngLats:u,lngLat:l,originalEvent:i}),o.defaultPrevented=!1,o}return zt(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(iF);function CF(t){var e=kF();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function kF(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var MF=function(t){Yt(n,t);var e=CF(n);function n(t,r,i){var o;return Ot(this,n),o=e.call(this,t,{originalEvent:i}),o.defaultPrevented=!1,o}return zt(n,[{key:"preventDefault",value:function(){this.defaultPrevented=!0}}]),n}(iF),PF=function(){function t(e){Ot(this,t),this.map=e}return zt(t,[{key:"reset",value:function(){this.delayContextMenu=!1,delete this.contextMenuEvent}},{key:"mousemove",value:function(t){this.map.emit(t.type,new EF(t.type,this.map,t))}},{key:"mousedown",value:function(){this.delayContextMenu=!0}},{key:"mouseup",value:function(){this.delayContextMenu=!1,this.contextMenuEvent&&(this.map.emit("contextmenu",new EF("contextmenu",this.map,this.contextMenuEvent)),delete this.contextMenuEvent)}},{key:"contextmenu",value:function(t){this.delayContextMenu?this.contextMenuEvent=t:this.map.emit(t.type,new EF(t.type,this.map,t)),this.map.listeners("contextmenu")&&t.preventDefault()}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!0}},{key:"disable",value:function(){return!1}}]),t}(),IF=function(){function t(e,n){Ot(this,t),this.map=e,this.el=e.getCanvasContainer(),this.container=e.getContainer(),this.clickTolerance=n.clickTolerance||1}return zt(t,[{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active}},{key:"enable",value:function(){this.isEnabled()||(this.enabled=!0)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"mousedown",value:function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(fF.disableDrag(),this.startPos=this.lastPos=e,this.active=!0)}},{key:"mousemoveWindow",value:function(t,e){if(this.active){var n=e;if(!(this.lastPos.equals(n)||!this.box&&n.dist(this.startPos)<this.clickTolerance)){var r=this.startPos;this.lastPos=n,this.box||(this.box=fF.create("div","l7-boxzoom",this.container),this.container.classList.add("l7-crosshair"),this.fireEvent("boxzoomstart",t));var i=Math.min(r.x,n.x),o=Math.max(r.x,n.x),a=Math.min(r.y,n.y),s=Math.max(r.y,n.y);fF.setTransform(this.box,"translate(".concat(i,"px,").concat(a,"px)")),this.box&&(this.box.style.width="".concat(o-i,"px"),this.box.style.height="".concat(s-a,"px"))}}}},{key:"mouseupWindow",value:function(t,e){var n=this;if(this.active&&0===t.button){var r=this.startPos,i=e;if(this.reset(),fF.suppressClick(),r.x!==i.x||r.y!==i.y)return this.map.emit("boxzoomend",new iF("boxzoomend",{originalEvent:t})),{cameraAnimation:function(t){return t.fitScreenCoordinates(r,i,n.map.getBearing(),{linear:!0})}};this.fireEvent("boxzoomcancel",t)}}},{key:"keydown",value:function(t){this.active&&27===t.keyCode&&(this.reset(),this.fireEvent("boxzoomcancel",t))}},{key:"reset",value:function(){this.active=!1,this.container.classList.remove("l7-crosshair"),this.box&&(fF.remove(this.box),this.box=null),fF.enableDrag(),delete this.startPos,delete this.lastPos}},{key:"fireEvent",value:function(t,e){return this.map.emit(t,new iF(t,{originalEvent:e}))}}]),t}(),RF=IF,LF=function(){function t(){Ot(this,t),this.reset()}return zt(t,[{key:"reset",value:function(){this.active=!1}},{key:"dblclick",value:function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function OF(t){var e=DF();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function DF(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var NF=function(t){Yt(n,t);var e=OF(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"type","renderFrame"),t}return zt(n)}(iF);function zF(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=FF(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function FF(t,e){if(t){if("string"===typeof t)return BF(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?BF(t,e):void 0}}function BF(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var UF={linearity:.3,easing:Tz(0,0,.3,1)},jF=rF()({deceleration:2500,maxSpeed:1400},UF),ZF=rF()({deceleration:20,maxSpeed:1400},UF),VF=rF()({deceleration:1e3,maxSpeed:360},UF),GF=rF()({deceleration:1e3,maxSpeed:90},UF),HF=function(){function t(e){Ot(this,t),this.map=e,this.clear()}return zt(t,[{key:"clear",value:function(){this.inertiaBuffer=[]}},{key:"record",value:function(t){this.drainInertiaBuffer(),this.inertiaBuffer.push({time:Pz(),settings:t})}},{key:"drainInertiaBuffer",value:function(){var t=this.inertiaBuffer,e=Pz(),n=160;while(t.length>0&&e-t[0].time>n)t.shift()}},{key:"onMoveEnd",value:function(t){if(this.drainInertiaBuffer(),!(this.inertiaBuffer.length<2)){var e,n={zoom:0,bearing:0,pitch:0,pan:new Fz(0,0),pinchAround:void 0,around:void 0},r=zF(this.inertiaBuffer);try{for(r.s();!(e=r.n()).done;){var i=e.value.settings;n.zoom+=i.zoomDelta||0,n.bearing+=i.bearingDelta||0,n.pitch+=i.pitchDelta||0,i.panDelta&&n.pan._add(i.panDelta),i.around&&(n.around=i.around),i.pinchAround&&(n.pinchAround=i.pinchAround)}}catch(PZ){r.e(PZ)}finally{r.f()}var o=this.inertiaBuffer[this.inertiaBuffer.length-1],a=o.time-this.inertiaBuffer[0].time,s={};if(n.pan.mag()){var u=qF(n.pan.mag(),a,rF()({},jF,t||{}));s.offset=n.pan.mult(u.amount/n.pan.mag()),s.center=this.map.transform.center,WF(s,u)}if(n.zoom){var c=qF(n.zoom,a,ZF);s.zoom=this.map.transform.zoom+c.amount,WF(s,c)}if(n.bearing){var l=qF(n.bearing,a,VF);s.bearing=this.map.transform.bearing+Sz(l.amount,-179,179),WF(s,l)}if(n.pitch){var h=qF(n.pitch,a,GF);s.pitch=this.map.transform.pitch+h.amount,WF(s,h)}if(s.zoom||s.bearing){var f=void 0===n.pinchAround?n.around:n.pinchAround;s.around=f?this.map.unproject(f):this.map.getCenter()}return this.clear(),rF()(s,{noMoveStart:!0})}}}]),t}();function WF(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function qF(t,e,n){var r=n.maxSpeed,i=n.linearity,o=n.deceleration,a=Sz(t*i/(e/1e3),-r,r),s=Math.abs(a)/(o*i);return{easing:n.easing,duration:1e3*s,amount:a*(s/2)}}var XF={panStep:100,bearingStep:15,pitchStep:10},YF=function(){function t(){Ot(this,t);var e=XF;this.panStep=e.panStep,this.bearingStep=e.bearingStep,this.pitchStep=e.pitchStep}return zt(t,[{key:"reset",value:function(){this.active=!1}},{key:"keydown",value:function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:KF,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e.bearingStep,pitch:s.getPitch()+i*e.pitchStep,offset:[-o*e.panStep,-a*e.panStep],center:s.getCenter()},{originalEvent:t})}}}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function KF(t){return t*(2-t)}var QF,JF=YF,$F=function(){function t(e,n){Ot(this,t),this.map=e,this.clickTolerance=n.clickTolerance}return zt(t,[{key:"reset",value:function(){delete this.mousedownPos}},{key:"wheel",value:function(t){return this.firePreventable(new MF(t.type,this.map,t))}},{key:"mousedown",value:function(t,e){return this.mousedownPos=e,this.firePreventable(new EF(t.type,this.map,t))}},{key:"mouseup",value:function(t){this.map.emit(t.type,new EF(t.type,this.map,t))}},{key:"click",value:function(t,e){this.mousedownPos&&this.mousedownPos.dist(e)>=this.clickTolerance||this.map.emit(t.type,new EF(t.type,this.map,t))}},{key:"dblclick",value:function(t){return this.firePreventable(new EF(t.type,this.map,t))}},{key:"mouseover",value:function(t){this.map.emit(t.type,new EF(t.type,this.map,t))}},{key:"mouseout",value:function(t){this.map.emit(t.type,new EF(t.type,this.map,t))}},{key:"touchstart",value:function(t){return this.firePreventable(new TF(t.type,this.map,t))}},{key:"touchmove",value:function(t){this.map.emit(t.type,new TF(t.type,this.map,t))}},{key:"touchend",value:function(t){this.map.emit(t.type,new TF(t.type,this.map,t))}},{key:"touchcancel",value:function(t){this.map.emit(t.type,new TF(t.type,this.map,t))}},{key:"firePreventable",value:function(t){if(this.map.emit(t.type,t),t.defaultPrevented)return{}}},{key:"isEnabled",value:function(){return!0}},{key:"isActive",value:function(){return!1}},{key:"enable",value:function(){return!1}},{key:"disable",value:function(){return!1}}]),t}(),tB=0,eB=2,nB=(QF={},(0,Ft.Z)(QF,tB,1),(0,Ft.Z)(QF,eB,2),QF);function rB(t,e){var n=nB[e];return void 0===t.buttons||(t.buttons&n)!==n}var iB=function(){function t(e){Ot(this,t),this.reset(),this.clickTolerance=e.clickTolerance||1}return zt(t,[{key:"reset",value:function(){this.active=!1,this.moved=!1,delete this.lastPoint,delete this.eventButton}},{key:"mousedown",value:function(t,e){if(!this.lastPoint){var n=fF.mouseButton(t);this.correctButton(t,n)&&(this.lastPoint=e,this.eventButton=n)}}},{key:"mousemoveWindow",value:function(t,e){var n=this.lastPoint;if(n)if(t.preventDefault(),rB(t,this.eventButton))this.reset();else if(this.moved||!(e.dist(n)<this.clickTolerance))return this.moved=!0,this.lastPoint=e,this.move(n,e)}},{key:"mouseupWindow",value:function(t){if(this.lastPoint){var e=fF.mouseButton(t);e===this.eventButton&&(this.moved&&fF.suppressClick(),this.reset())}}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"correctButton",value:function(t,e){return!1}},{key:"move",value:function(t,e){}}]),t}();function oB(t){var e=aB();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function aB(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var sB=function(t){Yt(n,t);var e=oB(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"mousedown",value:function(t,e){pv(Jt(n.prototype),"mousedown",this).call(this,t,e),this.lastPoint&&(this.active=!0)}},{key:"move",value:function(t,e){return{around:e,panDelta:e.sub(t)}}},{key:"correctButton",value:function(t,e){return e===tB&&!t.ctrlKey}}]),n}(iB);function uB(t){var e=cB();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function cB(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var lB=function(t){Yt(n,t);var e=uB(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"correctButton",value:function(t,e){return e===tB&&t.ctrlKey||e===eB}},{key:"move",value:function(t,e){var n=-.5,r=(e.y-t.y)*n;if(r)return this.active=!0,{pitchDelta:r}}},{key:"contextmenu",value:function(t){t.preventDefault()}}]),n}(iB);function hB(t){var e=fB();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function fB(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var pB=function(t){Yt(n,t);var e=hB(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"contextmenu",value:function(t){t.preventDefault()}},{key:"correctButton",value:function(t,e){return e===tB&&t.ctrlKey||e===eB}},{key:"move",value:function(t,e){var n=.8,r=(e.x-t.x)*n;if(r)return this.active=!0,{bearingDelta:r}}}]),n}(iB),dB=4.000244140625,vB=.01,mB=1/450,gB=2,yB=function(){function t(e,n){var r=this;Ot(this,t),(0,Ft.Z)(this,"onScrollFrame",(function(){if(r.frameId&&(r.frameId=null,r.isActive())){var t=r.map.transform;if(0!==r.delta){var e="wheel"===r.type&&Math.abs(r.delta)>dB?r.wheelZoomRate:r.defaultZoomRate,n=gB/(1+Math.exp(-Math.abs(r.delta*e)));r.delta<0&&0!==n&&(n=1/n);var i="number"===typeof r.targetZoom?t.zoomScale(r.targetZoom):t.scale;r.targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(i*n))),"wheel"===r.type&&(r.startZoom=t.zoom,r.easing=r.smoothOutEasing(200)),r.delta=0}var o,a="number"===typeof r.targetZoom?r.targetZoom:t.zoom,s=r.startZoom,u=r.easing,c=!1;if("wheel"===r.type&&s&&u){var l=Math.min((Pz()-r.lastWheelEventTime)/200,1),h=u(l);o=Az(s,a,h),l<1?r.frameId||(r.frameId=!0):c=!0}else o=a,c=!0;return r.active=!0,c&&(r.active=!1,r.finishTimeout=setTimeout((function(){r.zooming=!1,r.handler.triggerRenderFrame(),delete r.targetZoom,delete r.finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!c,zoomDelta:o-t.zoom,around:r.aroundPoint,originalEvent:r.lastWheelEvent}}})),this.map=e,this.el=e.getCanvasContainer(),this.handler=n,this.delta=0,this.defaultZoomRate=vB,this.wheelZoomRate=mB}return zt(t,[{key:"setZoomRate",value:function(t){this.defaultZoomRate=t}},{key:"setWheelZoomRate",value:function(t){this.wheelZoomRate=t}},{key:"isEnabled",value:function(){return!!this.enabled}},{key:"isActive",value:function(){return!!this.active||void 0!==this.finishTimeout}},{key:"isZooming",value:function(){return!!this.zooming}},{key:"enable",value:function(t){this.isEnabled()||(this.enabled=!0,this.aroundCenter=t&&"center"===t.around)}},{key:"disable",value:function(){this.isEnabled()&&(this.enabled=!1)}},{key:"wheel",value:function(t){if(this.isEnabled()){var e=t.deltaMode===window.WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY,n=Pz(),r=n-(this.lastWheelEventTime||0);this.lastWheelEventTime=n,0!==e&&e%dB===0?this.type="wheel":0!==e&&Math.abs(e)<4?this.type="trackpad":r>400?(this.type=null,this.lastValue=e,this.timeout=setTimeout(this.onTimeout,40,t)):this.type||(this.type=Math.abs(r*e)<200?"trackpad":"wheel",this.timeout&&(clearTimeout(this.timeout),this.timeout=null,e+=this.lastValue)),t.shiftKey&&e&&(e/=4),this.type&&(this.lastWheelEvent=t,this.delta-=e,this.active||this.start(t)),t.preventDefault()}}},{key:"renderFrame",value:function(){return this.onScrollFrame()}},{key:"reset",value:function(){this.active=!1}},{key:"onTimeout",value:function(t){this.type="wheel",this.delta-=this.lastValue,!this.active&&this.start&&this.start(t)}},{key:"start",value:function(t){if(this.delta){this.frameId&&(this.frameId=null),this.active=!0,this.isZooming()||(this.zooming=!0),this.finishTimeout&&(clearTimeout(this.finishTimeout),delete this.finishTimeout);var e=fF.mousePos(this.el,t);this.around=Nz.convert(this.aroundCenter?this.map.getCenter():this.map.unproject(e)),this.aroundPoint=this.map.transform.locationPoint(this.around),this.frameId||(this.frameId=!0,this.handler.triggerRenderFrame())}}},{key:"smoothOutEasing",value:function(t){var e=Cz;if(this.prevEase){var n=this.prevEase,r=(Pz()-n.start)/n.duration,i=n.easing(r+.01)-n.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01,a=Math.sqrt(.0729-o*o);e=Tz(o,a,.25,1)}return this.prevEase={start:Pz(),duration:t,easing:e},e}}]),t}(),_B=yB,xB=function(){function t(e,n){Ot(this,t),this.clickZoom=e,this.tapZoom=n}return zt(t,[{key:"enable",value:function(){this.clickZoom.enable(),this.tapZoom.enable()}},{key:"disable",value:function(){this.clickZoom.disable(),this.tapZoom.disable()}},{key:"isEnabled",value:function(){return this.clickZoom.isEnabled()&&this.tapZoom.isEnabled()}},{key:"isActive",value:function(){return this.clickZoom.isActive()||this.tapZoom.isActive()}}]),t}(),bB=function(){function t(e,n,r){Ot(this,t),this.el=e,this.mousePan=n,this.touchPan=r}return zt(t,[{key:"enable",value:function(t){this.inertiaOptions=t||{},this.mousePan.enable(),this.touchPan.enable(),yr||this.el.classList.add("l7-touch-drag-pan")}},{key:"disable",value:function(){this.mousePan.disable(),this.touchPan.disable(),yr||this.el.classList.remove("l7-touch-drag-pan")}},{key:"isEnabled",value:function(){return this.mousePan.isEnabled()&&this.touchPan.isEnabled()}},{key:"isActive",value:function(){return this.mousePan.isActive()||this.touchPan.isActive()}}]),t}(),wB=function(){function t(e,n,r){Ot(this,t),this.pitchWithRotate=e.pitchWithRotate,this.mouseRotate=n,this.mousePitch=r}return zt(t,[{key:"enable",value:function(){this.mouseRotate.enable(),this.pitchWithRotate&&this.mousePitch.enable()}},{key:"disable",value:function(){this.mouseRotate.disable(),this.mousePitch.disable()}},{key:"isEnabled",value:function(){return this.mouseRotate.isEnabled()&&(!this.pitchWithRotate||this.mousePitch.isEnabled())}},{key:"isActive",value:function(){return this.mouseRotate.isActive()||this.mousePitch.isActive()}}]),t}(),EB=function(){function t(e,n,r,i){Ot(this,t),this.el=e,this.touchZoom=n,this.touchRotate=r,this.tapDragZoom=i,this.rotationDisabled=!1,this.enabled=!0}return zt(t,[{key:"enable",value:function(t){this.touchZoom.enable(t),this.rotationDisabled||this.touchRotate.enable(t),this.tapDragZoom.enable(),yr||this.el.classList.add("l7-touch-zoom-rotate")}},{key:"disable",value:function(){this.touchZoom.disable(),this.touchRotate.disable(),this.tapDragZoom.disable(),yr||this.el.classList.remove("l7-touch-zoom-rotate")}},{key:"isEnabled",value:function(){return this.touchZoom.isEnabled()&&(this.rotationDisabled||this.touchRotate.isEnabled())&&this.tapDragZoom.isEnabled()}},{key:"isActive",value:function(){return this.touchZoom.isActive()||this.touchRotate.isActive()||this.tapDragZoom.isActive()}},{key:"disableRotation",value:function(){this.rotationDisabled=!0,this.touchRotate.disable()}},{key:"enableRotation",value:function(){this.rotationDisabled=!1,this.touchZoom.isEnabled()&&this.touchRotate.enable()}}]),t}();function SB(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}function AB(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=TB(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function TB(t,e){if(t){if("string"===typeof t)return CB(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?CB(t,e):void 0}}function CB(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}function kB(t){var e,n=new Fz(0,0),r=AB(t);try{for(r.s();!(e=r.n()).done;){var i=e.value;n._add(i)}}catch(PZ){r.e(PZ)}finally{r.f()}return n.div(t.length)}var MB=500,PB=500,IB=30,RB=function(){function t(e){Ot(this,t),this.reset(),this.numTouches=e.numTouches}return zt(t,[{key:"reset",value:function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1}},{key:"touchstart",value:function(t,e,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=kB(e),this.touches=SB(n,e)))}},{key:"touchmove",value:function(t,e,n){if(!this.aborted&&this.centroid){var r=SB(n,e);for(var i in this.touches)if(this.touches[i]){var o=this.touches[i],a=r[i];(!a||a.dist(o)>IB)&&(this.aborted=!0)}}}},{key:"touchend",value:function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>PB)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}}}]),t}(),LB=function(){function t(e){Ot(this,t),this.singleTap=new RB(e),this.numTaps=e.numTaps,this.reset()}return zt(t,[{key:"reset",value:function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()}},{key:"touchstart",value:function(t,e,n){this.singleTap.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.singleTap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<MB,o=!this.lastTap||this.lastTap.dist(r)<IB;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}]),t}(),OB=function(){function t(){Ot(this,t),this.tap=new LB({numTouches:1,numTaps:1}),this.reset()}return zt(t,[{key:"reset",value:function(){this.active=!1,delete this.swipePoint,delete this.swipeTouch,delete this.tapTime,this.tap.reset()}},{key:"touchstart",value:function(t,e,n){this.swipePoint||(this.tapTime&&t.timeStamp-this.tapTime>MB&&this.reset(),this.tapTime?n.length>0&&(this.swipePoint=e[0],this.swipeTouch=n[0].identifier):this.tap.touchstart(t,e,n))}},{key:"touchmove",value:function(t,e,n){if(this.tapTime){if(this.swipePoint){if(n[0].identifier!==this.swipeTouch)return;var r=e[0],i=r.y-this.swipePoint.y;return this.swipePoint=r,t.preventDefault(),this.active=!0,{zoomDelta:i/128}}}else this.tap.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){if(this.tapTime)this.swipePoint&&0===n.length&&this.reset();else{var r=this.tap.touchend(t,e,n);r&&(this.tapTime=t.timeStamp)}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),DB=function(){function t(){Ot(this,t),this.zoomIn=new LB({numTouches:1,numTaps:2}),this.zoomOut=new LB({numTouches:2,numTaps:1}),this.reset()}return zt(t,[{key:"reset",value:function(){this.active=!1,this.zoomIn.reset(),this.zoomOut.reset()}},{key:"touchstart",value:function(t,e,n){this.zoomIn.touchstart(t,e,n),this.zoomOut.touchstart(t,e,n)}},{key:"touchmove",value:function(t,e,n){this.zoomIn.touchmove(t,e,n),this.zoomOut.touchmove(t,e,n)}},{key:"touchend",value:function(t,e,n){var r=this,i=this.zoomIn.touchend(t,e,n),o=this.zoomOut.touchend(t,e,n);return i?(this.active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this.active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}(),NB=function(){function t(e){Ot(this,t),this.minTouches=1,this.clickTolerance=e.clickTolerance||1,this.reset()}return zt(t,[{key:"reset",value:function(){this.active=!1,this.touches={},this.sum=new Fz(0,0)}},{key:"touchstart",value:function(t,e,n){return this.calculateTransform(t,e,n)}},{key:"touchmove",value:function(t,e,n){if(this.active)return t.preventDefault(),this.calculateTransform(t,e,n)}},{key:"touchend",value:function(t,e,n){this.calculateTransform(t,e,n),this.active&&n.length<this.minTouches&&this.reset()}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(){this.enabled=!0}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}},{key:"calculateTransform",value:function(t,e,n){n.length>0&&(this.active=!0);var r=SB(n,e),i=new Fz(0,0),o=new Fz(0,0),a=0;for(var s in r)if(r[s]){var u=r[s],c=this.touches[s];c&&(i._add(u),o._add(u.sub(c)),a++,r[s]=u)}if(this.touches=r,!(a<this.minTouches)&&o.mag()){var l=o.div(a);if(this.sum._add(l),!(this.sum.mag()<this.clickTolerance)){var h=i.div(a);return{around:h,panDelta:l}}}}}]),t}(),zB=function(){function t(){Ot(this,t),this.reset()}return zt(t,[{key:"reset",value:function(){this.active=!1,delete this.firstTwoTouches}},{key:"start",value:function(t){}},{key:"move",value:function(t,e,n){}},{key:"touchstart",value:function(t,e,n){this.firstTwoTouches||n.length<2||(this.firstTwoTouches=[n[0].identifier,n[1].identifier],this.start([e[0],e[1]]))}},{key:"touchmove",value:function(t,e,n){if(this.firstTwoTouches){t.preventDefault();var r=(0,Li.Z)(this.firstTwoTouches,2),i=r[0],o=r[1],a=FB(n,e,i),s=FB(n,e,o);if(a&&s){var u=this.aroundCenter?null:a.add(s).div(2);return this.move([a,s],u,t)}}}},{key:"touchend",value:function(t,e,n){if(this.firstTwoTouches){var r=(0,Li.Z)(this.firstTwoTouches,2),i=r[0],o=r[1],a=FB(n,e,i),s=FB(n,e,o);a&&s||(this.active&&fF.suppressClick(),this.reset())}}},{key:"touchcancel",value:function(){this.reset()}},{key:"enable",value:function(t){this.enabled=!0,this.aroundCenter=!!t&&"center"===t.around}},{key:"disable",value:function(){this.enabled=!1,this.reset()}},{key:"isEnabled",value:function(){return this.enabled}},{key:"isActive",value:function(){return this.active}}]),t}();function FB(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function BB(t){var e=UB();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function UB(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function jB(t){return Math.abs(t.y)>Math.abs(t.x)}var ZB=100,VB=function(t){Yt(n,t);var e=BB(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"reset",value:function(){pv(Jt(n.prototype),"reset",this).call(this),this.valid=void 0,delete this.firstMove,delete this.lastPoints}},{key:"start",value:function(t){this.lastPoints=t,jB(t[0].sub(t[1]))&&(this.valid=!1)}},{key:"move",value:function(t,e,n){var r=t[0].sub(this.lastPoints[0]),i=t[1].sub(this.lastPoints[1]);if(this.valid=this.gestureBeginsVertically(r,i,n.timeStamp),this.valid){this.lastPoints=t,this.active=!0;var o=(r.y+i.y)/2,a=-.5;return{pitchDelta:o*a}}}},{key:"gestureBeginsVertically",value:function(t,e,n){if(void 0!==this.valid)return this.valid;var r=2,i=t.mag()>=r,o=e.mag()>=r;if(i||o){if(!i||!o)return void 0===this.firstMove&&(this.firstMove=n),n-this.firstMove<ZB&&void 0;var a=t.y>0===e.y>0;return jB(t)&&jB(e)&&a}}}]),n}(zB);function GB(t){var e=HB();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function HB(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var WB=25;function qB(t,e){return 180*t.angleWith(e)/Math.PI}var XB=function(t){Yt(n,t);var e=GB(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"reset",value:function(){pv(Jt(n.prototype),"reset",this).call(this),delete this.minDiameter,delete this.startVector,delete this.vector}},{key:"start",value:function(t){this.startVector=this.vector=t[0].sub(t[1]),this.minDiameter=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.vector;if(this.vector=t[0].sub(t[1]),this.active||!this.isBelowThreshold(this.vector))return this.active=!0,{bearingDelta:qB(this.vector,n),pinchAround:e}}},{key:"isBelowThreshold",value:function(t){this.minDiameter=Math.min(this.minDiameter,t.mag());var e=Math.PI*this.minDiameter,n=WB/e*360,r=qB(t,this.startVector);return Math.abs(r)<n}}]),n}(zB);function YB(t){var e=KB();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function KB(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var QB=.1;function JB(t,e){return Math.log(t/e)/Math.LN2}var $B=function(t){Yt(n,t);var e=YB(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"reset",value:function(){pv(Jt(n.prototype),"reset",this).call(this),delete this.distance,delete this.startDistance}},{key:"start",value:function(t){this.startDistance=this.distance=t[0].dist(t[1])}},{key:"move",value:function(t,e){var n=this.distance;if(this.distance=t[0].dist(t[1]),this.active||!(Math.abs(JB(this.distance,this.startDistance))<QB))return this.active=!0,{zoomDelta:JB(this.distance,n),pinchAround:e}}}]),n}(zB);function tU(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=eU(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function eU(t,e){if(t){if("string"===typeof t)return nU(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nU(t,e):void 0}}function nU(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var rU=function(t){return t.zoom||t.drag||t.pitch||t.rotate};function iU(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var oU=function(){function t(e,n){var r=this;Ot(this,t),(0,Ft.Z)(this,"handleWindowEvent",(function(t){r.handleEvent(t,"".concat(t.type,"Window"))})),(0,Ft.Z)(this,"handleEvent",(function(t,e){if("blur"!==t.type){r.updatingCamera=!0;var n,i="renderFrame"===t.type?void 0:t,o={needsRenderFrame:!1},a={},s={},u=t.touches?r.getMapTouches(t.touches):void 0,c=u?fF.touchPos(r.el,u):fF.mousePos(r.el,t),l=tU(r.handlers);try{for(l.s();!(n=l.n()).done;){var h=n.value,f=h.handlerName,p=h.handler,d=h.allowed;if(p.isEnabled()){var v=void 0;if(r.blockedByActive(s,d,f))p.reset();else{var m=e||t.type;p&&p[m]&&(v=p[m](t,c,u),r.mergeIHandlerResult(o,a,v,f,i),v&&v.needsRenderFrame&&r.triggerRenderFrame())}(v||p.isActive())&&(s[f]=p)}}}catch(PZ){l.e(PZ)}finally{l.f()}var g={};for(var y in r.previousActiveHandlers)s[y]||(g[y]=i);r.previousActiveHandlers=s,(Object.keys(g).length||iU(o))&&(r.changes.push([o,a,g]),r.triggerRenderFrame()),(Object.keys(s).length||iU(o))&&r.map.stop(!0),r.updatingCamera=!1;var _=o.cameraAnimation;_&&(r.inertia.clear(),r.fireEvents({},{}),r.changes=[],_(r.map))}else r.stop()})),this.map=e,this.el=this.map.getCanvasContainer(),this.handlers=[],this.handlersById={},this.changes=[],this.inertia=new HF(e),this.bearingSnap=n.bearingSnap,this.rotateEnabled=n.rotateEnabled,this.pitchEnabled=n.pitchEnabled,this.previousActiveHandlers={},this.eventsInProgress={},this.addDefaultHandlers(n);var i=this.el;if(this.listeners=[],yr)xr.document.addEventListener("touchstart",(function(t){r.handleEvent(t)}),{}),xr.document.addEventListener("touchmove",(function(t){r.handleEvent(t)}),{}),xr.document.addEventListener("touchend",(function(t){r.handleEvent(t)}),{}),xr.document.addEventListener("touchcancel",(function(t){r.handleEvent(t)}),{});else{this.listeners=[[i,"touchstart",{passive:!1}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[window.document,"mousemove",{capture:!0}],[window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[window,"blur",void 0]];var o,a=tU(this.listeners);try{for(a.s();!(o=a.n()).done;){var s=(0,Li.Z)(o.value,3),u=s[0],c=s[1],l=s[2];fF.addEventListener(u,c,u===window.document?this.handleWindowEvent:this.handleEvent,l)}}catch(PZ){a.e(PZ)}finally{a.f()}}}return zt(t,[{key:"destroy",value:function(){var t,e=tU(this.listeners);try{for(e.s();!(t=e.n()).done;){var n=(0,Li.Z)(t.value,3),r=n[0],i=n[1],o=n[2];fF.removeEventListener(r,i,r===window.document?this.handleWindowEvent:this.handleEvent,o)}}catch(PZ){e.e(PZ)}finally{e.f()}}},{key:"stop",value:function(){if(!this.updatingCamera){var t,e=tU(this.handlers);try{for(e.s();!(t=e.n()).done;){var n=t.value.handler;n.reset()}}catch(PZ){e.e(PZ)}finally{e.f()}this.inertia.clear(),this.fireEvents({},{}),this.changes=[]}}},{key:"isActive",value:function(){var t,e=tU(this.handlers);try{for(e.s();!(t=e.n()).done;){var n=t.value.handler;if(n.isActive())return!0}}catch(PZ){e.e(PZ)}finally{e.f()}return!1}},{key:"isZooming",value:function(){return!!this.eventsInProgress.zoom||this.map.scrollZoom.isZooming()}},{key:"isRotating",value:function(){return!!this.eventsInProgress.rotate}},{key:"isMoving",value:function(){return Boolean(rU(this.eventsInProgress))||this.isZooming()}},{key:"mergeIHandlerResult",value:function(t,e,n,r,i){if(n){(0,Oi.merge)(t,n);var o={handlerName:r,originalEvent:n.originalEvent||i};void 0!==n.zoomDelta&&(e.zoom=o),void 0!==n.panDelta&&(e.drag=o),void 0!==n.pitchDelta&&(e.pitch=o),void 0!==n.bearingDelta&&(e.rotate=o)}}},{key:"triggerRenderFrame",value:function(){var t=this;void 0===this.frameId&&(this.frameId=this.map.requestRenderFrame((function(e){delete t.frameId,t.handleEvent(new NF("renderFrame",{timeStamp:e})),t.applyChanges()})))}},{key:"addDefaultHandlers",value:function(t){var e=this.map,n=e.getCanvasContainer();this.add("mapEvent",new $F(e,t));var r=e.boxZoom=new RF(e,t);this.add("boxZoom",r);var i=new DB,o=new LF;e.doubleClickZoom=new xB(o,i),this.add("tapZoom",i),this.add("clickZoom",o);var a=new OB;this.add("tapDragZoom",a);var s=e.touchPitch=new VB;this.add("touchPitch",s);var u=new lB(t),c=new pB(t);e.dragRotate=new wB(t,u,c),this.add("mouseRotate",u,["mousePitch"]),this.add("mousePitch",c,["mouseRotate"]);var l=new sB(t),h=new NB(t);e.dragPan=new bB(n,l,h),this.add("mousePan",l),this.add("touchPan",h,["touchZoom","touchRotate"]);var f=new XB,p=new $B;e.touchZoomRotate=new EB(n,p,f,a),this.add("touchRotate",f,["touchPan","touchZoom"]),this.add("touchZoom",p,["touchPan","touchRotate"]);var d=e.scrollZoom=new _B(e,this);this.add("scrollZoom",d,["mousePan"]);var v=e.keyboard=new JF;this.add("keyboard",v),this.add("blockableMapEvent",new PF(e));for(var m=0,g=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<g.length;m++){var y=g[m];t.interactive&&t[y]&&e[y].enable(t[y])}}},{key:"add",value:function(t,e,n){this.handlers.push({handlerName:t,handler:e,allowed:n}),this.handlersById[t]=e}},{key:"blockedByActive",value:function(t,e,n){for(var r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1}},{key:"getMapTouches",value:function(t){var e,n=[],r=tU(t);try{for(r.s();!(e=r.n()).done;){var i=e.value,o=i.target;(yr||this.el.contains(o))&&n.push(i)}}catch(PZ){r.e(PZ)}finally{r.f()}return n}},{key:"applyChanges",value:function(){var t,e={},n={},r={},i=tU(this.changes);try{for(i.s();!(t=i.n()).done;){var o=(0,Li.Z)(t.value,3),a=o[0],s=o[1],u=o[2];a.panDelta&&(e.panDelta=(e.panDelta||new Fz(0,0))._add(a.panDelta)),a.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+a.zoomDelta),a.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+a.bearingDelta),a.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+a.pitchDelta),void 0!==a.around&&(e.around=a.around),void 0!==a.pinchAround&&(e.pinchAround=a.pinchAround),a.noInertia&&(e.noInertia=a.noInertia),(0,Oi.merge)(n,s),(0,Oi.merge)(r,u)}}catch(PZ){i.e(PZ)}finally{i.f()}this.updateMapTransform(e,n,r),this.changes=[]}},{key:"updateMapTransform",value:function(t,e,n){var r=this.map,i=r.transform;if(!iU(t))return this.fireEvents(e,n);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,c=t.pinchAround,l=t.around;void 0!==c&&(l=c),r.stop(!0),l=l||r.transform.centerPoint;var h=i.pointLocation(o?l.sub(o):l);s&&this.rotateEnabled&&(i.bearing+=s),u&&this.pitchEnabled&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,l),this.map.update(),t.noInertia||this.inertia.record(t),this.fireEvents(e,n)}},{key:"fireEvents",value:function(t,e){var n=this,r=rU(this.eventsInProgress),i=rU(t),o={};for(var a in t)if(t[a]){var s=t[a].originalEvent;this.eventsInProgress[a]||(o["".concat(a,"start")]=s),this.eventsInProgress[a]=t[a]}for(var u in!r&&i&&this.fireEvent("movestart",i.originalEvent),o)o[u]&&this.fireEvent(u,o[u]);for(var c in t.rotate&&(this.bearingChanged=!0),i&&this.fireEvent("move",i.originalEvent),t)if(t[c]){var l=t[c].originalEvent;this.fireEvent(c,l)}var h,f={};for(var p in this.eventsInProgress)if(this.eventsInProgress[p]){var d=this.eventsInProgress[p],v=d.handlerName,m=d.originalEvent;this.handlersById[v].isActive()||(delete this.eventsInProgress[p],h=e[v]||m,f["".concat(p,"end")]=h)}for(var g in f)f[g]&&this.fireEvent(g,f[g]);var y=rU(this.eventsInProgress);if((r||i)&&!y){this.updatingCamera=!0;var _=this.inertia.onMoveEnd(this.map.dragPan.inertiaOptions),x=function(t){return 0!==t&&-n.bearingSnap<t&&t<n.bearingSnap};_?(x(_.bearing||this.map.getBearing())&&(_.bearing=0),this.map.easeTo(_,{originalEvent:h})):(this.map.emit("moveend",new iF("moveend",{originalEvent:h})),x(this.map.getBearing())&&this.map.resetNorth()),this.bearingChanged=!1,this.updatingCamera=!1}}},{key:"fireEvent",value:function(t,e){this.map.emit(t,new iF(t,e?{originalEvent:e}:{}))}}]),t}(),aU=oU,sU=null,uU=[],cU=30,lU=1e3/cU,hU=xr.performance,fU={create:"create",load:"load",fullLoad:"fullLoad"},pU={mark:function(t){hU.mark(t)},frame:function(t){var e=t;if(null!=sU){var n=e-sU;uU.push(n)}sU=e},clearMetrics:function(){for(var t in sU=null,uU=[],hU.clearMeasures("loadTime"),hU.clearMeasures("fullLoadTime"),fU)hU.clearMarks(fU[t])},getPerformanceMetrics:function(){var t=hU.measure("loadTime",fU.create,fU.load).duration,e=hU.measure("fullLoadTime",fU.create,fU.fullLoad).duration,n=uU.length,r=uU.reduce((function(t,e){return t+e}),0)/n/1e3,i=1/r,o=uU.filter((function(t){return t>lU})).reduce((function(t,e){return t+(e-lU)/lU}),0),a=o/(n+o)*100;return{loadTime:t,fullLoadTime:e,fps:i,percentDroppedFrames:a}}};function dU(t,e){var n="undefined"!==typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!n){if(Array.isArray(t)||(n=vU(t))||e&&t&&"number"===typeof t.length){n&&(t=n);var r=0,i=function(){};return{s:i,n:function(){return r>=t.length?{done:!0}:{done:!1,value:t[r++]}},e:function(t){throw t},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var o,a=!0,s=!1;return{s:function(){n=n.call(t)},n:function(){var t=n.next();return a=t.done,t},e:function(t){s=!0,o=t},f:function(){try{a||null==n.return||n.return()}finally{if(s)throw o}}}}function vU(t,e){if(t){if("string"===typeof t)return mU(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?mU(t,e):void 0}}function mU(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var gU=function(){function t(){Ot(this,t),this.queue=[],this.id=0,this.cleared=!1,this.currentlyRunning=!1}return zt(t,[{key:"add",value:function(t){var e=++this.id,n=this.queue;return n.push({callback:t,id:e,cancelled:!1}),e}},{key:"remove",value:function(t){var e,n=this.currentlyRunning,r=n?this.queue.concat(n):this.queue,i=dU(r);try{for(i.s();!(e=i.n()).done;){var o=e.value;if(o.id===t)return void(o.cancelled=!0)}}catch(PZ){i.e(PZ)}finally{i.f()}}},{key:"run",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=this.currentlyRunning=this.queue;this.queue=[];var n,r=dU(e);try{for(r.s();!(n=r.n()).done;){var i=n.value;if(!i.cancelled&&(i.callback(t),this.cleared))break}}catch(PZ){r.e(PZ)}finally{r.f()}this.cleared=!1,this.currentlyRunning=!1}},{key:"clear",value:function(){this.currentlyRunning&&(this.cleared=!0),this.queue=[]}}]),t}(),yU=gU;function _U(t){var e=xU();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function xU(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function bU(t,e){var n="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,r="undefined"!==typeof wx&&null!==wx&&("undefined"!==typeof wx.request||"undefined"!==typeof wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a),a}}bU(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var wU=-2,EU=22,SU=0,AU=60,TU={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:wU,maxZoom:EU,minPitch:SU,maxPitch:AU,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},CU=function(t){Yt(n,t);var e=_U(n);function n(t){var r;return Ot(this,n),r=e.call(this,(0,Oi.merge)({},TU,t)),(0,Ft.Z)(Kt(r),"renderTaskQueue",new yU),(0,Ft.Z)(Kt(r),"trackResize",!0),(0,Ft.Z)(Kt(r),"onWindowOnline",(function(){r.update()})),(0,Ft.Z)(Kt(r),"onWindowResize",(function(t){r.trackResize&&r.resize({originalEvent:t}).update()})),r.initContainer(),r.resize(),r.handlers=new aU(Kt(r),r.options),"undefined"!==typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),r}return zt(n,[{key:"resize",value:function(t){var e=this.containerDimensions(),n=e[0],r=e[1];this.transform.resize(n,r);var i=!this.moving;return i&&(this.stop(),this.emit("movestart",new Event("movestart",t)),this.emit("move",new Event("move",t))),this.emit("resize",new Event("resize",t)),i&&this.emit("moveend",new Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(Nz.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(Fz.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(zz.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if(t=null===t||void 0===t?wU:t,t>=wU&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(wU," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if(t=null===t||void 0===t?EU:t,t>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if(t=null===t||void 0===t?SU:t,t<SU)throw new Error("minPitch must be greater than or equal to ".concat(SU));if(t>=SU&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(SU," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if(t=null===t||void 0===t?AU:t,t>AU)throw new Error("maxPitch must be less than or equal to ".concat(AU));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=Lz((function(e){pU.frame(e),t.frame=null,t.update(e)})))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=Lz((function(n){pU.frame(n),e.frame=null,e.renderTaskQueue.run(t)})))}},{key:"initContainer",value:function(){if("string"===typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=Bi("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(t=this.container.clientWidth||400,e=this.container.clientHeight||300),[t,e]}},{key:"resizeCanvas",value:function(t,e){var n=$i||1;this.canvas.width=n*t,this.canvas.height=n*e,this.canvas.style.width="".concat(t,"px"),this.canvas.style.height="".concat(e,"px")}}]),n}(sF),kU=function(){function t(e){var n=this;Ot(this,t),(0,Ft.Z)(this,"onHashChange",(function(){var t=n.getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(+t)}))){var e=n.map.dragRotate.isEnabled()&&n.map.touchZoomRotate.isEnabled()?+(t[3]||0):n.map.getBearing();return n.map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1})),(0,Ft.Z)(this,"getCurrentHash",(function(){var t,e=window.location.hash.replace("#","");return n.hashName?(e.split("&").map((function(t){return t.split("=")})).forEach((function(e){e[0]===n.hashName&&(t=e)})),(t&&t[1]||"").split("/")):e.split("/")})),(0,Ft.Z)(this,"updateHashUnthrottled",(function(){var t=n.getHashString();try{window.history.replaceState(window.history.state,"",t)}catch(e){}})),this.hashName=e&&encodeURIComponent(e),this.updateHash=(0,Oi.throttle)(this.updateHashUnthrottled,300)}return zt(t,[{key:"addTo",value:function(t){return this.map=t,xr.addEventListener("hashchange",this.onHashChange,!1),this.map.on("moveend",this.updateHash),this}},{key:"remove",value:function(){return xr.removeEventListener("hashchange",this.onHashChange,!1),this.map.off("moveend",this.updateHash),delete this.map,this}},{key:"getHashString",value:function(t){var e=this.map.getCenter(),n=Math.round(100*this.map.getZoom())/100,r=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),i=Math.pow(10,r),o=Math.round(e.lng*i)/i,a=Math.round(e.lat*i)/i,s=this.map.getBearing(),u=this.map.getPitch(),c="";if(c+=t?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o),(s||u)&&(c+="/".concat(Math.round(10*s)/10)),u&&(c+="/".concat(Math.round(u))),this.hashName){var l=this.hashName,h=!1,f=window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===l?(h=!0,"".concat(e,"=").concat(c)):t})).filter((function(t){return t}));return h||f.push("".concat(l,"=").concat(c)),"#".concat(f.join("&"))}return"#".concat(c)}}]),t}(),MU=kU;function PU(t){var e=IU();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function IU(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function RU(t,e){var n="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,r="undefined"!==typeof wx&&null!==wx&&("undefined"!==typeof wx.request||"undefined"!==typeof wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a),a}}RU(".l7-map {\n  font: 12px/20px 'Helvetica Neue', Arial, Helvetica, sans-serif;\n  overflow: hidden;\n  position: relative;\n  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);\n}\n\n.l7-canvas {\n  position: absolute;\n  left: 0;\n  top: 0;\n}\n\n.l7-map:-webkit-full-screen {\n  width: 100%;\n  height: 100%;\n}\n\n.l7-canary {\n  background-color: salmon;\n}\n\n.l7-canvas-container.l7-interactive,\n.l7-ctrl-group button.l7-ctrl-compass {\n  cursor: -webkit-grab;\n  cursor: grab;\n  -moz-user-select: none;\n  -webkit-user-select: none;\n  -ms-user-select: none;\n  user-select: none;\n}\n\n.l7-canvas-container.l7-interactive.l7-track-pointer {\n  cursor: pointer;\n}\n\n.l7-canvas-container.l7-interactive:active,\n.l7-ctrl-group button.l7-ctrl-compass:active {\n  cursor: -webkit-grabbing;\n  cursor: grabbing;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate,\n.l7-canvas-container.l7-touch-zoom-rotate .l7-canvas {\n  -ms-touch-action: pan-x pan-y;\n      touch-action: pan-x pan-y;\n}\n\n.l7-canvas-container.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: pinch-zoom;\n      touch-action: pinch-zoom;\n}\n\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan,\n.l7-canvas-container.l7-touch-zoom-rotate.l7-touch-drag-pan .l7-canvas {\n  -ms-touch-action: none;\n      touch-action: none;\n}\n\n.l7-ctrl-top-left,\n.l7-ctrl-top-right,\n.l7-ctrl-bottom-left,\n.l7-ctrl-bottom-right { position: absolute; pointer-events: none; z-index: 2; }\n.l7-ctrl-top-left     { top: 0; left: 0; }\n.l7-ctrl-top-right    { top: 0; right: 0; }\n.l7-ctrl-bottom-left  { bottom: 0; left: 0; }\n.l7-ctrl-bottom-right { right: 0; bottom: 0; }\n\n.l7-ctrl {\n  clear: both;\n  pointer-events: auto;\n\n  /* workaround for a Safari bug https://github.com/mapbox/mapbox-gl-js/issues/8185 */\n  -webkit-transform: translate(0, 0);\n          transform: translate(0, 0);\n}\n.l7-ctrl-top-left .l7-ctrl     { margin: 10px 0 0 10px; float: left; }\n.l7-ctrl-top-right .l7-ctrl    { margin: 10px 10px 0 0; float: right; }\n.l7-ctrl-bottom-left .l7-ctrl  { margin: 0 0 10px 10px; float: left; }\n.l7-ctrl-bottom-right .l7-ctrl { margin: 0 10px 10px 0; float: right; }\n\n\n.l7-crosshair,\n.l7-crosshair .l7-interactive,\n.l7-crosshair .l7-interactive:active {\n    cursor: crosshair;\n}\n\n.l7-boxzoom {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 0;\n    height: 0;\n    background: #fff;\n    border: 2px dotted #202020;\n    opacity: 0.5;\n    z-index: 10;\n}\n");var LU,OU,DU,NU,zU,FU,BU,UU,jU,ZU,VU,GU,HU,WU=-2,qU=22,XU=0,YU=60,KU={hash:!1,zoom:-1,center:[112,32],pitch:0,bearing:0,interactive:!0,minZoom:WU,maxZoom:qU,minPitch:XU,maxPitch:YU,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,trackResize:!0,renderWorldCopies:!0,pitchEnabled:!0,rotateEnabled:!0},QU=function(t){Yt(n,t);var e=PU(n);function n(t){var r;if(Ot(this,n),r=e.call(this,(0,Oi.merge)({},KU,t)),(0,Ft.Z)(Kt(r),"renderTaskQueue",new yU),(0,Ft.Z)(Kt(r),"trackResize",!0),(0,Ft.Z)(Kt(r),"onWindowOnline",(function(){r.update()})),(0,Ft.Z)(Kt(r),"onWindowResize",(function(t){r.trackResize&&r.resize({originalEvent:t}).update()})),yr?r.initMiniContainer():r.initContainer(),r.resize(),r.handlers=new aU(Kt(r),r.options),"undefined"!==typeof window&&(window.addEventListener("online",r.onWindowOnline,!1),window.addEventListener("resize",r.onWindowResize,!1),window.addEventListener("orientationchange",r.onWindowResize,!1)),!yr){var i="string"===typeof t.hash&&t.hash||void 0;t.hash&&(r.hash=new MU(i).addTo(Kt(r)))}return r.hash&&r.hash.onHashChange()||(r.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch}),t.bounds&&(r.resize(),r.fitBounds(t.bounds,(0,Oi.merge)({},t.fitBoundsOptions,{duration:0})))),r}return zt(n,[{key:"resize",value:function(t){var e=this.containerDimensions(),n=(0,Li.Z)(e,2),r=n[0],i=n[1];if(this.transform.resize(r,i),yr)return this;var o=!this.moving;return o&&(this.stop(),this.emit("movestart",new xr.Event("movestart",t)),this.emit("move",new xr.Event("move",t))),this.emit("resize",new xr.Event("resize",t)),o&&this.emit("moveend",new xr.Event("moveend",t)),this}},{key:"getContainer",value:function(){return this.container}},{key:"getCanvas",value:function(){return this.canvas}},{key:"getCanvasContainer",value:function(){return this.canvasContainer}},{key:"project",value:function(t){return this.transform.locationPoint(Nz.convert(t))}},{key:"unproject",value:function(t){return this.transform.pointLocation(Fz.convert(t))}},{key:"getBounds",value:function(){return this.transform.getBounds()}},{key:"getMaxBounds",value:function(){return this.transform.getMaxBounds()}},{key:"setMaxBounds",value:function(t){this.transform.setMaxBounds(zz.convert(t))}},{key:"setStyle",value:function(t){}},{key:"setMinZoom",value:function(t){if(t=null===t||void 0===t?WU:t,t>=WU&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between ".concat(WU," and the current maxZoom, inclusive"))}},{key:"getMinZoom",value:function(){return this.transform.minZoom}},{key:"setMaxZoom",value:function(t){if(t=null===t||void 0===t?qU:t,t>=this.transform.minZoom)return this.transform.maxZoom=t,this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")}},{key:"getMaxZoom",value:function(){return this.transform.maxZoom}},{key:"setMinPitch",value:function(t){if(t=null===t||void 0===t?XU:t,t<XU)throw new Error("minPitch must be greater than or equal to ".concat(XU));if(t>=XU&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between ".concat(XU," and the current maxPitch, inclusive"))}},{key:"getMinPitch",value:function(){return this.transform.minPitch}},{key:"setMaxPitch",value:function(t){if(t=null===t||void 0===t?YU:t,t>YU)throw new Error("maxPitch must be less than or equal to ".concat(YU));if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")}},{key:"getMaxPitch",value:function(){return this.transform.maxPitch}},{key:"getRenderWorldCopies",value:function(){return this.transform.renderWorldCopies}},{key:"setRenderWorldCopies",value:function(t){this.transform.renderWorldCopies=!!t}},{key:"remove",value:function(){this.container.removeChild(this.canvasContainer),this.canvasContainer=null,this.frame&&(this.frame.cancel(),this.frame=null),this.renderTaskQueue.clear()}},{key:"requestRenderFrame",value:function(t){return this.update(),this.renderTaskQueue.add(t)}},{key:"cancelRenderFrame",value:function(t){return this.renderTaskQueue.remove(t)}},{key:"triggerRepaint",value:function(){var t=this;this.frame||(this.frame=Lz((function(e){pU.frame(e),t.frame=null,t.update(e)})))}},{key:"update",value:function(t){var e=this;this.frame||(this.frame=Lz((function(n){pU.frame(n),e.frame=null,e.renderTaskQueue.run(t)})))}},{key:"initContainer",value:function(){if("string"===typeof this.options.container){if(this.container=window.document.getElementById(this.options.container),!this.container)throw new Error("Container '".concat(this.options.container,"' not found."))}else{if(!(this.options.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this.container=this.options.container}var t=this.container;t.classList.add("l7-map");var e=this.canvasContainer=Bi("div","l7-canvas-container",t);this.options.interactive&&e.classList.add("l7-interactive")}},{key:"initMiniContainer",value:function(){this.container=this.options.canvas,this.canvasContainer=this.container}},{key:"containerDimensions",value:function(){var t=0,e=0;return this.container&&(yr?(t=this.container.width/xr.devicePixelRatio,e=this.container.height/xr.devicePixelRatio):(t=this.container.clientWidth,e=this.container.clientHeight,t=0===t?400:t,e=0===e?300:e)),[t,e]}}]),n}(sF),JU={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},$U={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},tj=12,ej=(LU=(0,xc.b2)(),OU=(0,xc.f3)(wc.MapConfig),DU=(0,xc.f3)(wc.IGlobalConfigService),NU=(0,xc.f3)(wc.ICoordinateSystemService),zU=(0,xc.f3)(wc.IEventEmitter),LU((BU=function(){function t(){var e=this;Ot(this,t),(0,Ft.Z)(this,"version",ux.DEFUALT),(0,Ft.Z)(this,"simpleMapCoord",new ND),(0,Ft.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),Oh(this,"config",UU,this),Oh(this,"configService",jU,this),Oh(this,"coordinateSystemService",ZU,this),Oh(this,"eventEmitter",VU,this),(0,Ft.Z)(this,"handleCameraChanged",(function(t){var n=e.map.getCenter(),r=n.lat,i=n.lng;e.emit("mapchange"),e.viewport.syncWithMapCamera({bearing:e.map.getBearing(),center:[i,r],viewportHeight:e.map.transform.height,pitch:e.map.getPitch(),viewportWidth:e.map.transform.width,zoom:e.map.getZoom(),cameraHeight:0}),e.updateCoordinateSystemService(),e.cameraChangedCallback(e.viewport)}))}return zt(t,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=Bi("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,e){-1!==Gg.indexOf(t)?this.eventEmitter.on(t,e):this.map.on($U[t]||t,e)}},{key:"off",value:function(t,e){this.map.off($U[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version===ux.SIMPLE)return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,e){this.map.zoomIn(t,e)}},{key:"zoomOut",value:function(t,e){this.map.zoomOut(t,e)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;this.map.panBy([t,e])}},{key:"fitBounds",value:function(t,e){this.map.fitBounds(t,e)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){!0===t.doubleClickZoom&&this.map.doubleClickZoom.enable(),!1===t.doubleClickZoom&&this.map.doubleClickZoom.disable(),!1===t.dragEnable&&this.map.dragPan.disable(),!0===t.dragEnable&&this.map.dragPan.enable(),!1===t.rotateEnable&&this.map.dragRotate.disable(),!0===t.dragEnable&&this.map.dragRotate.enable(),!1===t.keyboardEnable&&this.map.keyboard.disable(),!0===t.keyboardEnable&&this.map.keyboard.enable(),!1===t.zoomEnable&&this.map.scrollZoom.disable(),!0===t.zoomEnable&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,e){this.map.flyTo({zoom:t,center:e})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,e){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,e=null!==(t=this.map.getStyle().sprite)&&void 0!==t?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(e)?null===e||void 0===e?void 0:e.replace(/\/\w+$/,"").replace(/sprites/,"styles"):e}catch(n){return""}}},{key:"getMapStyleConfig",value:function(){return JU}},{key:"getMapStyleValue",value:function(t){var e;return null!==(e=this.getMapStyleConfig()[t])&&void 0!==e?e:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var e=this.map.getCanvas(),n="jpg"===t?null===e||void 0===e?void 0:e.toDataURL("image/jpeg"):null===e||void 0===e?void 0:e.toDataURL("image/png");return n}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var e=t;return"string"===typeof t&&(e=document.getElementById(t)),e}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,e=void 0===t||t;this.viewport.getZoom()>tj&&e?this.coordinateSystemService.setCoordinateSystem(Uh.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(Uh.LNGLAT)}}]),t}(),UU=Dh(BU.prototype,"config",[OU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jU=Dh(BU.prototype,"configService",[DU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ZU=Dh(BU.prototype,"coordinateSystemService",[NU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),VU=Dh(BU.prototype,"eventEmitter",[zU],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),FU=BU))||FU),nj=function(){function t(){Ot(this,t),(0,Ft.Z)(this,"xzReg",.6*-Math.PI),(0,Ft.Z)(this,"yReg",.2*Math.PI),(0,Ft.Z)(this,"earthCameraRadius",200),(0,Ft.Z)(this,"earthCameraZoom",1),(0,Ft.Z)(this,"cameraPosition",$x()),(0,Ft.Z)(this,"projectionMatrix",cl()),(0,Ft.Z)(this,"modelMatrix",cl()),(0,Ft.Z)(this,"viewMatrix",cl()),(0,Ft.Z)(this,"viewProjectionMatrix",cl()),(0,Ft.Z)(this,"ViewProjectionMatrixUncentered",cl()),(0,Ft.Z)(this,"viewUncenteredMatrix",cl())}return zt(t,[{key:"syncWithMapCamera",value:function(t){var e=t.viewportHeight,n=void 0===e?1:e,r=t.viewportWidth,i=void 0===r?1:r,o=i/n,a=.1,s=1e4,u=20;Zl(this.projectionMatrix,u,o,a,s);var c=this.earthCameraRadius*Math.cos(this.xzReg),l=this.earthCameraRadius*Math.sin(this.xzReg),h=this.earthCameraRadius*Math.sin(this.yReg);this.cameraPosition=nb(c,h,l),bb(this.cameraPosition,this.cameraPosition),sb(this.cameraPosition,this.cameraPosition,nb(this.earthCameraRadius,this.earthCameraRadius,this.earthCameraRadius)),db(this.cameraPosition,this.cameraPosition,this.earthCameraZoom);var f=$x();Eb(f,this.cameraPosition,nb(0,1,0));var p=nb(0,1,0);Eb(p,f,this.cameraPosition);var d=nb(0,0,0);Xl(this.viewMatrix,this.cameraPosition,d,p),this.viewUncenteredMatrix=ll(this.viewMatrix),_l(this.viewProjectionMatrix,this.projectionMatrix,this.viewMatrix),_l(this.ViewProjectionMatrixUncentered,this.projectionMatrix,this.viewMatrix)}},{key:"rotateY",value:function(t){this.xzReg+=t*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"rotateX",value:function(t){this.yReg+=t*Math.min(this.earthCameraZoom*this.earthCameraZoom,1)}},{key:"scaleZoom",value:function(t){this.earthCameraZoom+=t,this.earthCameraZoom=Math.max(this.earthCameraZoom,.6)}},{key:"getZoom",value:function(){return 4}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[0,0]}},{key:"getProjectionMatrix",value:function(){return this.projectionMatrix}},{key:"getModelMatrix",value:function(){return this.modelMatrix}},{key:"getViewMatrix",value:function(){return this.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewMatrix}},{key:"getViewProjectionMatrix",value:function(){return this.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),rj=["id","style","rotation"];function ij(t){var e=oj();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function oj(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var aj={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},sj=12,uj=(GU=(0,xc.b2)(),GU(HU=function(t){Yt(n,t);var e=ij(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"version",ux.GLOBEL),(0,Ft.Z)(Kt(t),"dragging",!1),(0,Ft.Z)(Kt(t),"handleCameraChanged",(function(e){t.emit("mapchange");var n=2e3;t.handleCameraChanging=!0,t.handleCameraTimer&&clearTimeout(t.handleCameraTimer),t.handleCameraTimer=setTimeout((function(){t.handleCameraChanging=!1}),n);var r=.02;e.type&&e.originalEvent&&("wheel"===e.originalEvent.type&&t.viewport.scaleZoom(.01*Math.sign(e.originalEvent.wheelDelta)*-1),Math.abs(e.originalEvent.movementX)>Math.abs(e.originalEvent.movementY)?e.originalEvent.movementX>0?t.viewport.rotateY(r):e.originalEvent.movementX<0&&t.viewport.rotateY(-r):e.originalEvent.movementY>0?t.viewport.rotateX(r):e.originalEvent.movementY<0&&t.viewport.rotateX(-r));var i=t.config.offsetCoordinate,o=void 0===i||i;t.viewport.syncWithMapCamera({viewportHeight:t.map.transform.height,viewportWidth:t.map.transform.width}),t.viewport.getZoom()>sj&&o?t.coordinateSystemService.setCoordinateSystem(Uh.LNGLAT_OFFSET):t.coordinateSystemService.setCoordinateSystem(Uh.LNGLAT),t.cameraChangedCallback(t.viewport)})),t}return zt(n,[{key:"lngLatToMercator",value:function(t,e){throw new Error("Method not implemented.")}},{key:"getModelMatrix",value:function(t,e,n,r,i){throw new Error("Method not implemented.")}},{key:"on",value:function(t,e){-1!==Gg.indexOf(t)?this.eventEmitter.on(t,e):this.map.on(aj[t]||t,e)}},{key:"off",value:function(t,e){this.map.off(aj[t]||t,e),this.eventEmitter.off(t,e)}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"earth"}},{key:"init",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,i=e.style,o=void 0===i?"light":i,a=e.rotation,s=void 0===a?0:a,u=Jf(e,rj),this.viewport=new nj,this.$mapContainer=this.creatMapContainer(r),this.map=new CU((0,k.Z)({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},u)),this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged({});case 7:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"rotateY",value:function(t){var e=t||{},n=e.force,r=void 0!==n&&n,i=e.reg,o=void 0===i?.01:i;this.handleCameraChanging&&!r||this.viewport&&(this.viewport.rotateY(o),this.viewport.syncWithMapCamera({viewportHeight:this.map.transform.height,viewportWidth:this.map.transform.width}),this.cameraChangedCallback(this.viewport))}}]),n}(ej))||HU);function cj(t){var e=lj();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function lj(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var hj,fj,pj=function(t){Yt(n,t);var e=cj(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getServiceConstructor",value:function(){return uj}}]),n}(LD),dj=["id","style","rotation","mapInstance","version","mapSize","interactive"],vj=["id","style","rotation","mapInstance","canvas","hasBaseMap"];function mj(t){var e=gj();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function gj(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var yj=12,_j=(hj=(0,xc.b2)(),hj(fj=function(t){Yt(n,t);var e=mj(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"version",ux.DEFUALT),(0,Ft.Z)(Kt(t),"handleMiniCameraChanged",(function(e,n,r,i,o){var a=t.config.offsetCoordinate,s=void 0===a||a;t.viewport.syncWithMapCamera({bearing:i,center:[e,n],viewportHeight:t.map.transform.height,pitch:o,viewportWidth:t.map.transform.width,zoom:r,cameraHeight:0}),t.viewport.getZoom()>yj&&s?t.coordinateSystemService.setCoordinateSystem(Uh.LNGLAT_OFFSET):t.coordinateSystemService.setCoordinateSystem(Uh.LNGLAT),t.cameraChangedCallback(t.viewport)})),t}return zt(n,[{key:"lngLatToCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(t,0),r=n.x,i=n.y;return[r-e.x,i-e.y]}},{key:"lngLatToMercator",value:function(t,e){var n=Qz.fromLngLat(t,e),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z,u=void 0===s?0:s;return{x:i,y:a,z:u}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=Qz.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=cl();return xl(s,s,nb(o.x-i.x,o.y-i.y,o.z||0-i.z)),bl(s,s,nb(a*r[0],-a*r[1],a*r[2])),El(s,s,n[0]),Sl(s,s,n[1]),Al(s,s,n[2]),s}},{key:"init",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,i=e.style,o=void 0===i?"light":i,a=e.rotation,s=void 0===a?0:a,u=e.mapInstance,c=e.version,l=void 0===c?"DEFAULTMAP":c,h=e.mapSize,f=void 0===h?1e4:h,p=e.interactive,d=void 0===p||p,v=Jf(e,dj),this.viewport=new yN,this.version=l,this.simpleMapCoord.setSize(f),l===ux.SIMPLE&&v.center&&(v.center=this.simpleMapCoord.unproject(v.center)),u?(this.map=u,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new QU((0,k.Z)({container:this.$mapContainer,style:this.getMapStyleValue(o),bearing:s},v))),this.map.on("load",(function(){m.handleCameraChanged()})),d&&this.map.on("move",this.handleCameraChanged),setTimeout((function(){m.handleCameraChanged()}),100),this.handleCameraChanged();case 10:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"initMiniMap",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l,h,f,p=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=this.config,n=e.id,void 0===n?"map":n,r=e.style,i=void 0===r?"light":r,o=e.rotation,a=void 0===o?0:o,e.mapInstance,s=e.canvas,u=void 0===s?null:s,c=e.hasBaseMap,l=void 0!==c&&c,h=Jf(e,vj),this.viewport=new yN,this.$mapContainer=u,this.map=new QU((0,k.Z)({container:this.$mapContainer,style:this.getMapStyleValue(i),bearing:a,canvas:u},h)),l?(f=this.map.getCenter(),this.handleMiniCameraChanged(f.lng,f.lat,this.map.getZoom(),this.map.getBearing(),this.map.getPitch()),xr.document.addEventListener("mapCameaParams",(function(t){var e=t.e,n=e.longitude,r=e.latitude,i=e.scale,o=e.bearing,a=e.pitch;p.handleMiniCameraChanged(n,r,i-1.25,o,a)}))):(this.map.on("load",this.handleCameraChanged),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged());case 5:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"exportMap",value:function(t){var e=this.map.getCanvas(),n="jpg"===t?null===e||void 0===e?void 0:e.toDataURL("image/jpeg"):null===e||void 0===e?void 0:e.toDataURL("image/png");return n}}]),n}(ej))||fj);function xj(t){var e=bj();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function bj(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var wj,Ej,Sj=function(t){Yt(n,t);var e=xj(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getServiceConstructor",value:function(){return _j}}]),n}(LD),Aj=n(69096),Tj=n.n(Aj),Cj=function(){function t(){Ot(this,t)}return zt(t,[{key:"syncWithMapCamera",value:function(t){var e=t.center,n=t.zoom,r=t.pitch,i=t.bearing,o=t.viewportHeight,a=t.viewportWidth;this.viewport=new gN({width:a,height:o,longitude:e&&e[0],latitude:e&&e[1],zoom:n,pitch:r,bearing:i})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,e){return this.viewport.projectFlat(t,e)}}]),t}(),kj=["id","attributionControl","style","token","rotation","mapInstance"];function Mj(t){var e=Pj();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Pj(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function Ij(t,e){var n="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,r="undefined"!==typeof wx&&null!==wx&&("undefined"!==typeof wx.request||"undefined"!==typeof wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a),a}}Ij(".mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E\")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E\")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E\")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url(\"data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E\")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:\"\";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:\"\";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}"),window.mapboxgl=Tj();var Rj=0,Lj="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",Oj=(wj=(0,xc.b2)(),wj(Ej=function(t){Yt(n,t);var e=Mj(n);function n(){var t;Ot(this,n);for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];return t=e.call.apply(e,[this].concat(i)),(0,Ft.Z)(Kt(t),"version",ux.MAPBOX),t}return zt(n,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{x:0,y:0,z:0},n=this.lngLatToMercator(t,0),r=n.x,i=n.y;return[r-e.x,i-e.y]}},{key:"lngLatToMercator",value:function(t,e){var n=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),r=n.x,i=void 0===r?0:r,o=n.y,a=void 0===o?0:o,s=n.z,u=void 0===s?0:s;return{x:i,y:a,z:u}}},{key:"getModelMatrix",value:function(t,e,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[1,1,1],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{x:0,y:0,z:0},o=window.mapboxgl.MercatorCoordinate.fromLngLat(t,e),a=o.meterInMercatorCoordinateUnits(),s=cl();return xl(s,s,nb(o.x-i.x,o.y-i.y,o.z||0-i.z)),bl(s,s,nb(a*r[0],-a*r[1],a*r[2])),El(s,s,n[0]),Sl(s,s,n[1]),Al(s,s,n[2]),s}},{key:"init",value:function(){var t=(0,J.Z)(tt().mark((function t(){var e,n,r,i,o,a,s,u,c,l,h,f,p,d=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:e=this.config,n=e.id,r=void 0===n?"map":n,i=e.attributionControl,o=void 0!==i&&i,a=e.style,s=void 0===a?"light":a,u=e.token,c=void 0===u?Lj:u,l=e.rotation,h=void 0===l?0:l,f=e.mapInstance,p=Jf(e,kj),this.viewport=new Cj,!f&&window.mapboxgl,c===Lj&&"blank"!==s&&window.mapboxgl.accessToken,f||window.mapboxgl.accessToken||(window.mapboxgl.accessToken=c),f?(this.map=f,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(r),this.map=new window.mapboxgl.Map((0,k.Z)({container:this.$mapContainer,style:this.getMapStyleValue(s),attributionControl:o,bearing:h},p))),this.map.on("load",(function(){d.handleCameraChanged()})),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"destroy",value:function(){var t,e;null===(t=this.$mapContainer)||void 0===t||null===(e=t.parentNode)||void 0===e||e.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).emit.apply(e,[t].concat(r))}},{key:"once",value:function(t){for(var e,n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];(e=this.eventEmitter).once.apply(e,[t].concat(r))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(t,e){var n=new(Tj().LngLat)(t[0],t[1]),r=new(Tj().LngLat)(e[0],e[1]),i=n.distanceTo(r),o=Tj().MercatorCoordinate.fromLngLat({lng:t[0],lat:t[1]}),a=Tj().MercatorCoordinate.fromLngLat({lng:e[0],lat:e[1]}),s=o.x,u=o.y,c=a.x,l=a.y,h=4194304*Math.sqrt(Math.pow(s-c,2)+Math.pow(u-l,2))*2;return h/i}},{key:"exportMap",value:function(t){var e=this.map.getCanvas(),n="jpg"===t?null===e||void 0===e?void 0:e.toDataURL("image/jpeg"):null===e||void 0===e?void 0:e.toDataURL("image/png");return n}},{key:"creatMapContainer",value:function(t){var e=t;"string"===typeof t&&(e=document.getElementById(t));var n=document.createElement("div");return n.style.cssText+="\n      position: absolute;\n      top: 0;\n      height: 100%;\n      width: 100%;\n    ",n.id="l7_mapbox_div"+Rj++,e.appendChild(n),n}}]),n}(ej))||Ej);function Dj(t){var e=Nj();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function Nj(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}function zj(t,e){var n="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,r="undefined"!==typeof wx&&null!==wx&&("undefined"!==typeof wx.request||"undefined"!==typeof wx.miniProgram);if(!n&&!r&&(e||(e=document),e)){var i=e.head||e.getElementsByTagName("head")[0];if(!i){i=e.createElement("head");var o=e.body||e.getElementsByTagName("body")[0];o?o.parentNode.insertBefore(i,o):e.documentElement.appendChild(i)}var a=e.createElement("style");return a.type="text/css",a.styleSheet?a.styleSheet.cssText=t:a.appendChild(e.createTextNode(t)),i.appendChild(a),a}}zj(".mapboxgl-ctrl-logo {\n display: none !important;\n}\n");var Fj,Bj,Uj,jj,Zj,Vj,Gj,Hj,Wj,qj,Xj,Yj,Kj,Qj,Jj,$j,tZ=function(t){Yt(n,t);var e=Dj(n);function n(){return Ot(this,n),e.apply(this,arguments)}return zt(n,[{key:"getServiceConstructor",value:function(){return Oj}}]),n}(LD),eZ=n(98999),nZ=n.n(eZ),rZ=function(){function t(e,n){Ot(this,t);var r=n.buffer,i=n.offset,o=n.stride,a=n.normalized,s=n.size,u=n.divisor;this.buffer=r,this.attribute={buffer:r.get(),offset:i||0,stride:o||0,normalized:a||!1,divisor:u||0},s&&(this.attribute.size=s)}return zt(t,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),t}(),iZ=(Fj={},(0,Ft.Z)(Fj,vf.POINTS,"points"),(0,Ft.Z)(Fj,vf.LINES,"lines"),(0,Ft.Z)(Fj,vf.LINE_LOOP,"line loop"),(0,Ft.Z)(Fj,vf.LINE_STRIP,"line strip"),(0,Ft.Z)(Fj,vf.TRIANGLES,"triangles"),(0,Ft.Z)(Fj,vf.TRIANGLE_FAN,"triangle fan"),(0,Ft.Z)(Fj,vf.TRIANGLE_STRIP,"triangle strip"),Fj),oZ=(Bj={},(0,Ft.Z)(Bj,vf.STATIC_DRAW,"static"),(0,Ft.Z)(Bj,vf.DYNAMIC_DRAW,"dynamic"),(0,Ft.Z)(Bj,vf.STREAM_DRAW,"stream"),Bj),aZ=(Uj={},(0,Ft.Z)(Uj,vf.BYTE,"int8"),(0,Ft.Z)(Uj,vf.UNSIGNED_INT,"int16"),(0,Ft.Z)(Uj,vf.INT,"int32"),(0,Ft.Z)(Uj,vf.UNSIGNED_BYTE,"uint8"),(0,Ft.Z)(Uj,vf.UNSIGNED_SHORT,"uint16"),(0,Ft.Z)(Uj,vf.UNSIGNED_INT,"uint32"),(0,Ft.Z)(Uj,vf.FLOAT,"float"),Uj),sZ=(jj={},(0,Ft.Z)(jj,vf.ALPHA,"alpha"),(0,Ft.Z)(jj,vf.LUMINANCE,"luminance"),(0,Ft.Z)(jj,vf.LUMINANCE_ALPHA,"luminance alpha"),(0,Ft.Z)(jj,vf.RGB,"rgb"),(0,Ft.Z)(jj,vf.RGBA,"rgba"),(0,Ft.Z)(jj,vf.RGBA4,"rgba4"),(0,Ft.Z)(jj,vf.RGB5_A1,"rgb5 a1"),(0,Ft.Z)(jj,vf.RGB565,"rgb565"),(0,Ft.Z)(jj,vf.DEPTH_COMPONENT,"depth"),(0,Ft.Z)(jj,vf.DEPTH_STENCIL,"depth stencil"),jj),uZ=(Zj={},(0,Ft.Z)(Zj,vf.DONT_CARE,"dont care"),(0,Ft.Z)(Zj,vf.NICEST,"nice"),(0,Ft.Z)(Zj,vf.FASTEST,"fast"),Zj),cZ=(Vj={},(0,Ft.Z)(Vj,vf.NEAREST,"nearest"),(0,Ft.Z)(Vj,vf.LINEAR,"linear"),(0,Ft.Z)(Vj,vf.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,Ft.Z)(Vj,vf.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,Ft.Z)(Vj,vf.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,Ft.Z)(Vj,vf.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),Vj),lZ=(Gj={},(0,Ft.Z)(Gj,vf.REPEAT,"repeat"),(0,Ft.Z)(Gj,vf.CLAMP_TO_EDGE,"clamp"),(0,Ft.Z)(Gj,vf.MIRRORED_REPEAT,"mirror"),Gj),hZ=(Hj={},(0,Ft.Z)(Hj,vf.NONE,"none"),(0,Ft.Z)(Hj,vf.BROWSER_DEFAULT_WEBGL,"browser"),Hj),fZ=(Wj={},(0,Ft.Z)(Wj,vf.NEVER,"never"),(0,Ft.Z)(Wj,vf.ALWAYS,"always"),(0,Ft.Z)(Wj,vf.LESS,"less"),(0,Ft.Z)(Wj,vf.LEQUAL,"lequal"),(0,Ft.Z)(Wj,vf.GREATER,"greater"),(0,Ft.Z)(Wj,vf.GEQUAL,"gequal"),(0,Ft.Z)(Wj,vf.EQUAL,"equal"),(0,Ft.Z)(Wj,vf.NOTEQUAL,"notequal"),Wj),pZ=(qj={},(0,Ft.Z)(qj,vf.FUNC_ADD,"add"),(0,Ft.Z)(qj,vf.MIN_EXT,"min"),(0,Ft.Z)(qj,vf.MAX_EXT,"max"),(0,Ft.Z)(qj,vf.FUNC_SUBTRACT,"subtract"),(0,Ft.Z)(qj,vf.FUNC_REVERSE_SUBTRACT,"reverse subtract"),qj),dZ=(Xj={},(0,Ft.Z)(Xj,vf.ZERO,"zero"),(0,Ft.Z)(Xj,vf.ONE,"one"),(0,Ft.Z)(Xj,vf.SRC_COLOR,"src color"),(0,Ft.Z)(Xj,vf.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,Ft.Z)(Xj,vf.SRC_ALPHA,"src alpha"),(0,Ft.Z)(Xj,vf.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,Ft.Z)(Xj,vf.DST_COLOR,"dst color"),(0,Ft.Z)(Xj,vf.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,Ft.Z)(Xj,vf.DST_ALPHA,"dst alpha"),(0,Ft.Z)(Xj,vf.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,Ft.Z)(Xj,vf.CONSTANT_COLOR,"constant color"),(0,Ft.Z)(Xj,vf.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,Ft.Z)(Xj,vf.CONSTANT_ALPHA,"constant alpha"),(0,Ft.Z)(Xj,vf.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,Ft.Z)(Xj,vf.SRC_ALPHA_SATURATE,"src alpha saturate"),Xj),vZ=(Yj={},(0,Ft.Z)(Yj,vf.NEVER,"never"),(0,Ft.Z)(Yj,vf.ALWAYS,"always"),(0,Ft.Z)(Yj,vf.LESS,"less"),(0,Ft.Z)(Yj,vf.LEQUAL,"lequal"),(0,Ft.Z)(Yj,vf.GREATER,"greater"),(0,Ft.Z)(Yj,vf.GEQUAL,"gequal"),(0,Ft.Z)(Yj,vf.EQUAL,"equal"),(0,Ft.Z)(Yj,vf.NOTEQUAL,"notequal"),Yj),mZ=(Kj={},(0,Ft.Z)(Kj,vf.ZERO,"zero"),(0,Ft.Z)(Kj,vf.KEEP,"keep"),(0,Ft.Z)(Kj,vf.REPLACE,"replace"),(0,Ft.Z)(Kj,vf.INVERT,"invert"),(0,Ft.Z)(Kj,vf.INCR,"increment"),(0,Ft.Z)(Kj,vf.DECR,"decrement"),(0,Ft.Z)(Kj,vf.INCR_WRAP,"increment wrap"),(0,Ft.Z)(Kj,vf.DECR_WRAP,"decrement wrap"),Kj),gZ=(Qj={},(0,Ft.Z)(Qj,vf.FRONT,"front"),(0,Ft.Z)(Qj,vf.BACK,"back"),Qj),yZ=function(){function t(e,n){Ot(this,t);var r=n.data,i=n.usage,o=n.type;this.buffer=e.buffer({data:r,usage:oZ[i||vf.STATIC_DRAW],type:aZ[o||vf.UNSIGNED_BYTE]})}return zt(t,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.buffer.destroy()}},{key:"subData",value:function(t){var e=t.data,n=t.offset;this.buffer.subdata(e,n)}}]),t}(),_Z=function(){function t(e,n){Ot(this,t);var r=n.data,i=n.usage,o=n.type,a=n.count;this.elements=e.elements({data:r,usage:oZ[i||vf.STATIC_DRAW],type:aZ[o||vf.UNSIGNED_BYTE],count:a})}return zt(t,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var e=t.data;this.elements.subdata(e)}},{key:"destroy",value:function(){}}]),t}(),xZ=function(){function t(e,n){Ot(this,t);var r=n.width,i=n.height,o=n.color,a=n.colors,s={width:r,height:i};Array.isArray(a)&&(s.colors=a.map((function(t){return t.get()}))),o&&"boolean"!==typeof o&&(s.color=o.get()),this.framebuffer=e.framebuffer(s)}return zt(t,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.framebuffer.resize(e,n)}}]),t}(),bZ=function(){function t(e,n){Ot(this,t),(0,Ft.Z)(this,"destroyed",!1),(0,Ft.Z)(this,"uniforms",{}),this.reGl=e;var r=n.vs,i=n.fs,o=n.attributes,a=n.uniforms,s=n.primitive,u=n.count,c=n.elements,l=n.depth,h=n.cull,f=n.instances,p={};this.options=n,a&&(this.uniforms=this.extractUniforms(a),Object.keys(a).forEach((function(t){p[t]=e.prop(t)})));var d={};Object.keys(o).forEach((function(t){d[t]=o[t].get()}));var v={attributes:d,frag:i,uniforms:p,vert:r,colorMask:e.prop("colorMask"),lineWidth:1,blend:{enable:e.prop("blend.enable"),func:e.prop("blend.func"),equation:e.prop("blend.equation"),color:e.prop("blend.color")},stencil:{enable:e.prop("stencil.enable"),mask:e.prop("stencil.mask"),func:e.prop("stencil.func"),opFront:e.prop("stencil.opFront"),opBack:e.prop("stencil.opBack")},primitive:iZ[void 0===s?vf.TRIANGLES:s]};f&&(v.instances=f),u?v.count=u:c&&(v.elements=c.get()),this.initDepthDrawParams({depth:l},v),this.initCullDrawParams({cull:h},v),this.drawCommand=e(v),this.drawParams=v}return zt(t,[{key:"updateAttributesAndElements",value:function(t,e){var n={};Object.keys(t).forEach((function(e){n[e]=t[e].get()})),this.drawParams.attributes=n,this.drawParams.elements=e.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var e={};Object.keys(t).forEach((function(n){e[n]=t[n].get()})),this.drawParams.attributes=e,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=(0,k.Z)((0,k.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,e){if(!this.drawParams.attributes||0!==Object.keys(this.drawParams.attributes).length){var n=(0,k.Z)((0,k.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),r={};Object.keys(n).forEach((function(t){var e=(0,I.Z)(n[t]);"boolean"===e||"number"===e||Array.isArray(n[t])||n[t].BYTES_PER_ELEMENT?r[t]=n[t]:r[t]=n[t].get()})),r.blend=e?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),r.stencil=this.getStencilDrawParams(t),r.colorMask=this.getColorMaskDrawParams(t,e),this.drawCommand(r)}}},{key:"destroy",value:function(){var t,e;null===(t=this.drawParams)||void 0===t||null===(e=t.elements)||void 0===e||e.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach((function(t){null===t||void 0===t||t.destroy()})),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,e){var n=t.depth;n&&(e.depth={enable:void 0===n.enable||!!n.enable,mask:void 0===n.mask||!!n.mask,func:fZ[n.func||vf.LESS],range:n.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var e=t.blend,n=e||{},r=n.enable,i=n.func,o=n.equation,a=n.color,s=void 0===a?[0,0,0,0]:a;return{enable:!!r,func:{srcRGB:dZ[i&&i.srcRGB||vf.SRC_ALPHA],srcAlpha:dZ[i&&i.srcAlpha||vf.SRC_ALPHA],dstRGB:dZ[i&&i.dstRGB||vf.ONE_MINUS_SRC_ALPHA],dstAlpha:dZ[i&&i.dstAlpha||vf.ONE_MINUS_SRC_ALPHA]},equation:{rgb:pZ[o&&o.rgb||vf.FUNC_ADD],alpha:pZ[o&&o.alpha||vf.FUNC_ADD]},color:s}}},{key:"getStencilDrawParams",value:function(t){var e=t.stencil,n=e||{},r=n.enable,i=n.mask,o=void 0===i?-1:i,a=n.func,s=void 0===a?{cmp:vf.ALWAYS,ref:0,mask:-1}:a,u=n.opFront,c=void 0===u?{fail:vf.KEEP,zfail:vf.KEEP,zpass:vf.KEEP}:u,l=n.opBack,h=void 0===l?{fail:vf.KEEP,zfail:vf.KEEP,zpass:vf.KEEP}:l;return{enable:!!r,mask:o,func:(0,k.Z)((0,k.Z)({},s),{},{cmp:vZ[s.cmp]}),opFront:{fail:mZ[c.fail],zfail:mZ[c.zfail],zpass:mZ[c.zpass]},opBack:{fail:mZ[h.fail],zfail:mZ[h.zfail],zpass:mZ[h.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,e){var n=t.stencil,r=null!==n&&void 0!==n&&n.enable&&n.opFront&&!e?[!1,!1,!1,!1]:[!0,!0,!0,!0];return r}},{key:"initCullDrawParams",value:function(t,e){var n=t.cull;if(n){var r=n.enable,i=n.face,o=void 0===i?vf.BACK:i;e.cull={enable:!!r,face:gZ[o]}}}},{key:"extractUniforms",value:function(t){var e=this,n={};return Object.keys(t).forEach((function(r){e.extractUniformsRecursively(r,t[r],n,"")})),n}},{key:"extractUniformsRecursively",value:function(t,e,n,r){var i=this;null===e||"number"===typeof e||"boolean"===typeof e||Array.isArray(e)&&"number"===typeof e[0]||(0,Oi.isTypedArray)(e)||""===e||"resize"in e?n["".concat(r&&r+".").concat(t)]=e:((0,Oi.isPlainObject)(e)&&Object.keys(e).forEach((function(o){i.extractUniformsRecursively(o,e[o],n,"".concat(r&&r+".").concat(t))})),Array.isArray(e)&&e.forEach((function(e,o){Object.keys(e).forEach((function(a){i.extractUniformsRecursively(a,e[a],n,"".concat(r&&r+".").concat(t,"[").concat(o,"]"))}))})))}}]),t}(),wZ=function(){function t(e,n){Ot(this,t),(0,Ft.Z)(this,"isDestroy",!1);var r=n.data,i=n.type,o=void 0===i?vf.UNSIGNED_BYTE:i,a=n.width,s=n.height,u=n.flipY,c=void 0!==u&&u,l=n.format,h=void 0===l?vf.RGBA:l,f=n.mipmap,p=void 0!==f&&f,d=n.wrapS,v=void 0===d?vf.CLAMP_TO_EDGE:d,m=n.wrapT,g=void 0===m?vf.CLAMP_TO_EDGE:m,y=n.aniso,_=void 0===y?0:y,x=n.alignment,b=void 0===x?1:x,w=n.premultiplyAlpha,E=void 0!==w&&w,S=n.mag,A=void 0===S?vf.NEAREST:S,T=n.min,C=void 0===T?vf.NEAREST:T,k=n.colorSpace,M=void 0===k?vf.BROWSER_DEFAULT_WEBGL:k,P=n.x,I=void 0===P?0:P,R=n.y,L=void 0===R?0:R,O=n.copy,D=void 0!==O&&O;this.width=a,this.height=s;var N={width:a,height:s,type:aZ[o],format:sZ[h],wrapS:lZ[v],wrapT:lZ[g],mag:cZ[A],min:cZ[C],alignment:b,flipY:c,colorSpace:hZ[M],premultiplyAlpha:E,aniso:_,x:I,y:L,copy:D};r&&(N.data=r),"number"===typeof p?N.mipmap=uZ[p]:"boolean"===typeof p&&(N.mipmap=p),this.texture=e.texture(N)}return zt(t,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var e=t.width,n=t.height;this.texture.resize(e,n),this.width=e,this.height=n}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){var t;this.isDestroy||(null===(t=this.texture)||void 0===t||t.destroy());this.isDestroy=!0}}]),t}(),EZ=(Jj=(0,xc.b2)(),Jj($j=function(){function t(){var e=this;Ot(this,t),(0,Ft.Z)(this,"createModel",(function(t){return new bZ(e.gl,t)})),(0,Ft.Z)(this,"createAttribute",(function(t){return new rZ(e.gl,t)})),(0,Ft.Z)(this,"createBuffer",(function(t){return new yZ(e.gl,t)})),(0,Ft.Z)(this,"createElements",(function(t){return new _Z(e.gl,t)})),(0,Ft.Z)(this,"createTexture2D",(function(t){return new wZ(e.gl,t)})),(0,Ft.Z)(this,"createFramebuffer",(function(t){return new xZ(e.gl,t)})),(0,Ft.Z)(this,"useFramebuffer",(function(t,n){e.gl({framebuffer:t?t.get():null})(n)})),(0,Ft.Z)(this,"clear",(function(t){var n,r=t.color,i=t.depth,o=t.stencil,a=t.framebuffer,s=void 0===a?null:a,u={color:r,depth:i,stencil:o};u.framebuffer=null===s?s:s.get(),null===(n=e.gl)||void 0===n||n.clear(u)})),(0,Ft.Z)(this,"viewport",(function(t){var n=t.x,r=t.y,i=t.width,o=t.height;e.gl._gl.viewport(n,r,i,o),e.width=i,e.height=o,e.gl._refresh()})),(0,Ft.Z)(this,"readPixels",(function(t){var n=t.framebuffer,r=t.x,i=t.y,o=t.width,a=t.height,s={x:r,y:i,width:o,height:a};return n&&(s.framebuffer=n.get()),e.gl.read(s)})),(0,Ft.Z)(this,"getViewportSize",(function(){return{width:e.gl._gl.drawingBufferWidth,height:e.gl._gl.drawingBufferHeight}})),(0,Ft.Z)(this,"getContainer",(function(){return yr?e.canvas:null===(t=e.canvas)||void 0===t?void 0:t.parentElement;var t})),(0,Ft.Z)(this,"getCanvas",(function(){return e.canvas})),(0,Ft.Z)(this,"getGLContext",(function(){return e.gl._gl})),(0,Ft.Z)(this,"destroy",(function(){var t,n,r;e.canvas=null,null===(t=e.gl)||void 0===t||null===(n=t._gl)||void 0===n||null===(r=n.getExtension("WEBGL_lose_context"))||void 0===r||r.loseContext(),e.gl.destroy(),e.gl=null}))}return zt(t,[{key:"init",value:function(){var t=(0,J.Z)(tt().mark((function t(e,n,r){var i=this;return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(this.canvas=e,!r){t.next=5;break}this.gl=r,t.next=8;break;case 5:return t.next=7,new Promise((function(t,e){nZ()({canvas:i.canvas,attributes:{alpha:!0,antialias:n.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:n.preserveDrawingBuffer,stencil:n.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(n,r){!n&&r||e(n),t(r)}})}));case 7:this.gl=t.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return t.stop()}}),t,this)})));function e(e,n,r){return t.apply(this,arguments)}return e}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),t}())||$j);function SZ(t){var e=AZ();return function(){var n,r=Jt(t);if(e){var i=Jt(this).constructor;n=Reflect.construct(r,arguments,i)}else n=r.apply(this,arguments);return Qt(this,n)}}function AZ(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}var TZ=["selectstart","selecting","selectend"],CZ=function(t){Yt(n,t);var e=SZ(n);function n(t){var r,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Ot(this,n),r=e.call(this),(0,Ft.Z)(Kt(r),"isEnable",!1),(0,Ft.Z)(Kt(r),"onDragStart",(function(t){r.box.style.display="block",r.startEvent=r.endEvent=t,r.syncBoxBound(),r.emit("selectstart",r.getLngLatBox(),r.startEvent,r.endEvent)})),(0,Ft.Z)(Kt(r),"onDragging",(function(t){r.endEvent=t,r.syncBoxBound(),r.emit("selecting",r.getLngLatBox(),r.startEvent,r.endEvent)})),(0,Ft.Z)(Kt(r),"onDragEnd",(function(t){r.endEvent=t,r.box.style.display="none",r.emit("selectend",r.getLngLatBox(),r.startEvent,r.endEvent)})),r.scene=t,r.options=i,r}return zt(n,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var t=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var e=Bi("div",void 0,this.container);e.classList.add("l7-select-box"),t&&e.classList.add(t),e.style.display="none",this.box=e}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var t=this.startEvent,e=t.x,n=t.y,r=this.endEvent,i=r.x,o=r.y,a=Math.min(e,i),s=Math.min(n,o),u=Math.abs(e-i),c=Math.abs(n-o);this.box.style.top="".concat(s,"px"),this.box.style.left="".concat(a,"px"),this.box.style.width="".concat(u,"px"),this.box.style.height="".concat(c,"px")}},{key:"getLngLatBox",value:function(){var t=this.startEvent.lngLat,e=t.lng,n=t.lat,r=this.endEvent.lngLat,i=r.lng,o=r.lat;return Qo([[e,n],[i,o]])}}]),n}(Ma.EventEmitter),kZ=function(){function t(e){Ot(this,t);var n=e.id,r=e.map,i=e.canvas,o=e.hasBaseMap,a=Cg();this.container=a,r.setContainer(a,n,i,o),a.bind(wc.IRendererService).to(EZ).inSingletonScope(),this.sceneService=a.get(wc.ISceneService),this.mapService=a.get(wc.IMapService),this.iconService=a.get(wc.IIconService),this.fontService=a.get(wc.IFontService),this.controlService=a.get(wc.IControlService),this.layerService=a.get(wc.ILayerService),this.debugService=a.get(wc.IDebugService),this.debugService.setEnable(e.debug),this.markerService=a.get(wc.IMarkerService),this.interactionService=a.get(wc.IInteractionService),this.popupService=a.get(wc.IPopupService),this.boxSelect=new CZ(this,{}),vr((null===e||void 0===e?void 0:e.isMini)||!1),yr?this.sceneService.initMiniScene(e):(this.initComponent(n),this.sceneService.init(e),this.initControl())}return zt(t,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.sceneService.exportPng(e));case 1:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"exportMap",value:function(){var t=(0,J.Z)(tt().mark((function t(e){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.abrupt("return",this.sceneService.exportPng(e));case 1:case"end":return t.stop()}}),t,this)})));function e(e){return t.apply(this,arguments)}return e}()},{key:"registerRenderService",value:function(t){var e=this;if(this.sceneService.loaded){var n=new t(this);n.init()}else this.on("loaded",(function(){var n=new t(e);n.init()}))}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var e=this,n=kg(this.container);if(t.setContainer(n,this.container),this.sceneService.addLayer(t),t.inited){var r=this.initMask(t);this.addMask(r,t.id)}else t.on("inited",(function(){var n=e.initMask(t);e.addMask(n,t.id)}))}},{key:"initMask",value:function(t){var e=t.getLayerConfig(),n=e.mask,r=e.maskfence,i=e.maskColor,o=void 0===i?"#000":i,a=e.maskOpacity,s=void 0===a?0:a;if(n&&r){var u=(new Tk).source(r).shape("fill").style({color:o,opacity:s});return u}}},{key:"addMask",value:function(t,e){if(t){var n=this.getLayer(e);if(n){var r=kg(this.container);t.setContainer(r,this.container),n.addMaskLayer(t),this.sceneService.addMask(t)}}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(e,n){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layerService.remove(e,n);case 2:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"removeAllLayer",value:function(){var t=(0,J.Z)(tt().mark((function t(){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,this.layerService.removeAllLayers();case 2:case"end":return t.stop()}}),t,this)})));function e(){return t.apply(this,arguments)}return e}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,e){this.fontService.addIconFont(t,e)}},{key:"addIconFonts",value:function(t){var e=this;t.forEach((function(t){var n=(0,Li.Z)(t,2),r=n[0],i=n[1];e.fontService.addIconFont(r,i)}))}},{key:"addFontFace",value:function(t,e){var n=this;this.fontService.once("fontloaded",(function(t){n.emit("fontloaded",t)})),this.fontService.addFontFace(t,e)}},{key:"addImage",value:function(){var t=(0,J.Z)(tt().mark((function t(e,n){return tt().wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(yr){t.next=5;break}return t.next=3,this.iconService.addImage(e,n);case 3:t.next=6;break;case 5:this.iconService.addImageMini(e,n,this.sceneService);case 6:case"end":return t.stop()}}),t,this)})));function e(e,n){return t.apply(this,arguments)}return e}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,e){this.fontService.addIconGlyphs(e)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,e){var n;TZ.includes(t)?null===(n=this.boxSelect)||void 0===n||n.on(t,e):Hg.includes(t)?this.sceneService.on(t,e):this.mapService.on(t,e)}},{key:"once",value:function(t,e){var n;TZ.includes(t)?null===(n=this.boxSelect)||void 0===n||n.once(t,e):Hg.includes(t)?this.sceneService.once(t,e):this.mapService.once(t,e)}},{key:"emit",value:function(t,e){-1===Hg.indexOf(t)?this.mapService.on(t,e):this.sceneService.emit(t,e)}},{key:"off",value:function(t,e){var n;TZ.includes(t)?null===(n=this.boxSelect)||void 0===n||n.off(t,e):Hg.includes(t)?this.sceneService.off(t,e):this.mapService.off(t,e)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,e){return this.mapService.setCenter(t,e)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,e){this.mapService.panBy(t,e)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,e){var n=this.sceneService.getSceneConfig(),r=n.fitBoundsOptions,i=n.animate;this.mapService.fitBounds(t,e||(0,k.Z)((0,k.Z)({},r),{},{animate:i}))}},{key:"setZoomAndCenter",value:function(t,e){this.mapService.setZoomAndCenter(t,e)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,e){this.container.bind(wc.IPostProcessingPass).to(t).whenTargetNamed(e)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.boxSelect.enable(),e&&this.boxSelect.once("selectend",(function(){t.disableBoxSelect()}))}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:Di(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),e=t.logoVisible,n=t.logoPosition;e&&this.addControl(new F_({position:n}))}}]),t}(),MZ="2.17.3"},20535:function(t,e,n){function r(t,e){var n,o=t&&t.type;if("FeatureCollection"===o)for(n=0;n<t.features.length;n++)r(t.features[n],e);else if("GeometryCollection"===o)for(n=0;n<t.geometries.length;n++)r(t.geometries[n],e);else if("Feature"===o)r(t.geometry,e);else if("Polygon"===o)i(t.coordinates,e);else if("MultiPolygon"===o)for(n=0;n<t.coordinates.length;n++)i(t.coordinates[n],e);return t}function i(t,e){if(0!==t.length){o(t[0],e);for(var n=1;n<t.length;n++)o(t[n],!e)}}function o(t,e){for(var n=0,r=0,i=0,o=t.length,a=o-1;i<o;a=i++){var s=(t[i][0]-t[a][0])*(t[a][1]+t[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!==!!e&&t.reverse()}n(65069),t.exports=r},24893:function(t){"use strict";function e(t,e){this.x=t,this.y=e}t.exports=e,e.prototype={clone:function(){return new e(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[0]*this.x+t[1]*this.y,n=t[2]*this.x+t[3]*this.y;return this.x=e,this.y=n,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=e*this.x-n*this.y,i=n*this.x+e*this.y;return this.x=r,this.y=i,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.x+n*(this.x-e.x)-r*(this.y-e.y),o=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=i,this.y=o,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},e.convert=function(t){return t instanceof e?t:Array.isArray(t)?new e(t[0],t[1]):t}},21722:function(t){function e(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}t.exports=e,e.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},e.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},e.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},e.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for("undefined"===typeof e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if(n=0,r=1,i=t,i<n)return n;if(i>r)return r;while(n<r){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},e.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))}},32704:function(t,e,n){t.exports.VectorTile=n(46086),n(66937),n(38421)},46086:function(t,e,n){"use strict";var r=n(38421);function i(t,e){this.layers=t.readFields(o,{},e)}function o(t,e,n){if(3===t){var i=new r(n,n.readVarint()+n.pos);i.length&&(e[i.name]=i)}}t.exports=i},66937:function(t,e,n){"use strict";n(57658),n(21703);var r=n(24893);function i(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(o,this,e)}function o(t,e,n){1==t?e.id=n.readVarint():2==t?a(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function a(t,e){var n=t.readVarint()+t.pos;while(t.pos<n){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}function s(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=u(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}function u(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)e=t[i],n=t[a],r+=(n.x-e.x)*(e.y+n.y);return r}t.exports=i,i.types=["Unknown","Point","LineString","Polygon"],i.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;var e,n=t.readVarint()+t.pos,i=1,o=0,a=0,s=0,u=[];while(t.pos<n){if(o<=0){var c=t.readVarint();i=7&c,o=c>>3}if(o--,1===i||2===i)a+=t.readSVarint(),s+=t.readSVarint(),1===i&&(e&&u.push(e),e=[]),e.push(new r(a,s));else{if(7!==i)throw new Error("unknown command "+i);e&&e.push(e[0].clone())}}return e&&u.push(e),u},i.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,c=-1/0;while(t.pos<e){if(r<=0){var l=t.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)i+=t.readSVarint(),o+=t.readSVarint(),i<a&&(a=i),i>s&&(s=i),o<u&&(u=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,c]},i.prototype.toGeoJSON=function(t,e,n){var r,o,a=this.extent*Math.pow(2,n),u=this.extent*t,c=this.extent*e,l=this.loadGeometry(),h=i.types[this.type];function f(t){for(var e=0;e<t.length;e++){var n=t[e],r=180-360*(n.y+c)/a;t[e]=[360*(n.x+u)/a-180,360/Math.PI*Math.atan(Math.exp(r*Math.PI/180))-90]}}switch(this.type){case 1:var p=[];for(r=0;r<l.length;r++)p[r]=l[r][0];l=p,f(l);break;case 2:for(r=0;r<l.length;r++)f(l[r]);break;case 3:for(l=s(l),r=0;r<l.length;r++)for(o=0;o<l[r].length;o++)f(l[r][o]);break}1===l.length?l=l[0]:h="Multi"+h;var d={type:"Feature",geometry:{type:h,coordinates:l},properties:this.properties};return"id"in this&&(d.id=this.id),d}},38421:function(t,e,n){"use strict";n(57658),n(21703);var r=n(66937);function i(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(o,this,e),this.length=this._features.length}function o(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(a(n))}function a(t){var e=null,n=t.readVarint()+t.pos;while(t.pos<n){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}t.exports=i,i.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new r(this._pbf,e,this.extent,this._keys,this._values)}},19652:function(t,e,n){"use strict";function r(t,e,n){n=n||2;var r,o,s,u,c,l,f,p=e&&e.length,d=p?e[0]*n:t.length,v=i(t,0,d,n,!0),m=[];if(!v||v.next===v.prev)return m;if(p&&(v=h(t,e,v,n)),t.length>80*n){r=s=t[0],o=u=t[1];for(var g=n;g<d;g+=n)c=t[g],l=t[g+1],c<r&&(r=c),l<o&&(o=l),c>s&&(s=c),l>u&&(u=l);f=Math.max(s-r,u-o),f=0!==f?32767/f:0}return a(v,m,n,r,o,f,0),m}function i(t,e,n,r,i){var o,a;if(i===O(t,e,n,r)>0)for(o=e;o<n;o+=r)a=I(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=I(o,t[o],t[o+1],a);return a&&E(a,a.next)&&(R(a),a=a.next),a}function o(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!E(r,r.next)&&0!==w(r.prev,r,r.next))r=r.next;else{if(R(r),r=e=r.prev,r===r.next)break;n=!0}}while(n||r!==e);return e}function a(t,e,n,r,i,h,f){if(t){!f&&h&&m(t,r,i,h);var p,d,v=t;while(t.prev!==t.next)if(p=t.prev,d=t.next,h?u(t,r,i,h):s(t))e.push(p.i/n|0),e.push(t.i/n|0),e.push(d.i/n|0),R(t),t=d.next,v=d.next;else if(t=d,t===v){f?1===f?(t=c(o(t),e,n),a(t,e,n,r,i,h,2)):2===f&&l(t,e,n,r,i,h):a(o(t),e,n,r,i,h,1);break}}}function s(t){var e=t.prev,n=t,r=t.next;if(w(e,n,r)>=0)return!1;var i=e.x,o=n.x,a=r.x,s=e.y,u=n.y,c=r.y,l=i<o?i<a?i:a:o<a?o:a,h=s<u?s<c?s:c:u<c?u:c,f=i>o?i>a?i:a:o>a?o:a,p=s>u?s>c?s:c:u>c?u:c,d=r.next;while(d!==e){if(d.x>=l&&d.x<=f&&d.y>=h&&d.y<=p&&x(i,s,o,u,a,c,d.x,d.y)&&w(d.prev,d,d.next)>=0)return!1;d=d.next}return!0}function u(t,e,n,r){var i=t.prev,o=t,a=t.next;if(w(i,o,a)>=0)return!1;var s=i.x,u=o.x,c=a.x,l=i.y,h=o.y,f=a.y,p=s<u?s<c?s:c:u<c?u:c,d=l<h?l<f?l:f:h<f?h:f,v=s>u?s>c?s:c:u>c?u:c,m=l>h?l>f?l:f:h>f?h:f,g=y(p,d,e,n,r),_=y(v,m,e,n,r),b=t.prevZ,E=t.nextZ;while(b&&b.z>=g&&E&&E.z<=_){if(b.x>=p&&b.x<=v&&b.y>=d&&b.y<=m&&b!==i&&b!==a&&x(s,l,u,h,c,f,b.x,b.y)&&w(b.prev,b,b.next)>=0)return!1;if(b=b.prevZ,E.x>=p&&E.x<=v&&E.y>=d&&E.y<=m&&E!==i&&E!==a&&x(s,l,u,h,c,f,E.x,E.y)&&w(E.prev,E,E.next)>=0)return!1;E=E.nextZ}while(b&&b.z>=g){if(b.x>=p&&b.x<=v&&b.y>=d&&b.y<=m&&b!==i&&b!==a&&x(s,l,u,h,c,f,b.x,b.y)&&w(b.prev,b,b.next)>=0)return!1;b=b.prevZ}while(E&&E.z<=_){if(E.x>=p&&E.x<=v&&E.y>=d&&E.y<=m&&E!==i&&E!==a&&x(s,l,u,h,c,f,E.x,E.y)&&w(E.prev,E,E.next)>=0)return!1;E=E.nextZ}return!0}function c(t,e,n){var r=t;do{var i=r.prev,a=r.next.next;!E(i,a)&&S(i,r,r.next,a)&&k(i,a)&&k(a,i)&&(e.push(i.i/n|0),e.push(r.i/n|0),e.push(a.i/n|0),R(r),R(r.next),r=t=a),r=r.next}while(r!==t);return o(r)}function l(t,e,n,r,i,s){var u=t;do{var c=u.next.next;while(c!==u.prev){if(u.i!==c.i&&b(u,c)){var l=P(u,c);return u=o(u,u.next),l=o(l,l.next),a(u,e,n,r,i,s,0),void a(l,e,n,r,i,s,0)}c=c.next}u=u.next}while(u!==t)}function h(t,e,n,r){var o,a,s,u,c,l=[];for(o=0,a=e.length;o<a;o++)s=e[o]*r,u=o<a-1?e[o+1]*r:t.length,c=i(t,s,u,r,!1),c===c.next&&(c.steiner=!0),l.push(_(c));for(l.sort(f),o=0;o<l.length;o++)n=p(l[o],n);return n}function f(t,e){return t.x-e.x}function p(t,e){var n=d(t,e);if(!n)return e;var r=P(n,t);return o(r,r.next),o(n,n.next)}function d(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a&&(a=s,n=r.x<r.next.x?r:r.next,s===i))return n}r=r.next}while(r!==e);if(!n)return null;var u,c=n,l=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&x(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),k(r,t)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&v(n,r)))&&(n=r,f=u)),r=r.next}while(r!==c);return n}function v(t,e){return w(t.prev,t,e.prev)<0&&w(e.next,t,t.next)<0}function m(t,e,n,r){var i=t;do{0===i.z&&(i.z=y(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,g(i)}function g(t){var e,n,r,i,o,a,s,u,c=1;do{n=t,t=null,o=null,a=0;while(n){for(a++,r=n,s=0,e=0;e<c;e++)if(s++,r=r.nextZ,!r)break;u=c;while(s>0||u>0&&r)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1);return t}function y(t,e,n,r,i){return t=(t-n)*i|0,e=(e-r)*i|0,t=16711935&(t|t<<8),t=252645135&(t|t<<4),t=858993459&(t|t<<2),t=1431655765&(t|t<<1),e=16711935&(e|e<<8),e=252645135&(e|e<<4),e=858993459&(e|e<<2),e=1431655765&(e|e<<1),t|e<<1}function _(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function x(t,e,n,r,i,o,a,s){return(i-a)*(e-s)>=(t-a)*(o-s)&&(t-a)*(r-s)>=(n-a)*(e-s)&&(n-a)*(o-s)>=(i-a)*(r-s)}function b(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!C(t,e)&&(k(t,e)&&k(e,t)&&M(t,e)&&(w(t.prev,t,e.prev)||w(t,e.prev,e))||E(t,e)&&w(t.prev,t,t.next)>0&&w(e.prev,e,e.next)>0)}function w(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function E(t,e){return t.x===e.x&&t.y===e.y}function S(t,e,n,r){var i=T(w(t,e,n)),o=T(w(t,e,r)),a=T(w(n,r,t)),s=T(w(n,r,e));return i!==o&&a!==s||(!(0!==i||!A(t,n,e))||(!(0!==o||!A(t,r,e))||(!(0!==a||!A(n,t,r))||!(0!==s||!A(n,e,r)))))}function A(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function T(t){return t>0?1:t<0?-1:0}function C(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&S(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}function k(t,e){return w(t.prev,t,t.next)<0?w(t,e,t.next)>=0&&w(t,t.prev,e)>=0:w(t,e,t.prev)<0||w(t,t.next,e)<0}function M(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!==n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}function P(t,e){var n=new L(t.i,t.x,t.y),r=new L(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function I(t,e,n,r){var i=new L(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function R(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function L(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}function O(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}n(57658),n(2707),t.exports=r,t.exports["default"]=r,r.deviation=function(t,e,n,r){var i=e&&e.length,o=i?e[0]*n:t.length,a=Math.abs(O(t,0,o,n));if(i)for(var s=0,u=e.length;s<u;s++){var c=e[s]*n,l=s<u-1?e[s+1]*n:t.length;a-=Math.abs(O(t,c,l,n))}var h=0;for(s=0;s<r.length;s+=3){var f=r[s]*n,p=r[s+1]*n,d=r[s+2]*n;h+=Math.abs((t[f]-t[d])*(t[p+1]-t[f+1])-(t[f]-t[p])*(t[d+1]-t[f+1]))}return 0===a&&0===h?0:Math.abs((h-a)/a)},r.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&(r+=t[i-1].length,n.holes.push(r))}return n}},96425:function(t,e,n){function r(t){var e=t.target||t.srcElement;e.__resizeRAF__&&cancelAnimationFrame(e.__resizeRAF__),e.__resizeRAF__=requestAnimationFrame((function(){var n=e.__resizeTrigger__,r=n&&n.__resizeListeners__;r&&r.forEach((function(e){e.call(n,t)}))}))}n(74916),n(57658);var i=function(t,e){var n,i=this,o=i.document,a=o.attachEvent;function s(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",r)}if("undefined"!==typeof navigator&&(n=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/)),!t.__resizeListeners__)if(t.__resizeListeners__=[],a)t.__resizeTrigger__=t,t.attachEvent("onresize",r);else{"static"===getComputedStyle(t).position&&(t.style.position="relative");var u=t.__resizeTrigger__=o.createElement("object");u.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),u.setAttribute("class","resize-sensor"),u.setAttribute("tabindex","-1"),u.setAttribute("title",""),u.__resizeElement__=t,u.onload=s,u.type="text/html",n&&t.appendChild(u),u.data="about:blank",n||t.appendChild(u)}t.__resizeListeners__.push(e)};t.exports="undefined"===typeof window?i:i.bind(window),t.exports.unbind=function(t,e){var n=document.attachEvent,i=t.__resizeListeners__||[];if(e){var o=i.indexOf(e);-1!==o&&i.splice(o,1)}else i=t.__resizeListeners__=[];if(!i.length){if(n)t.detachEvent("onresize",r);else if(t.__resizeTrigger__){var a=t.__resizeTrigger__.contentDocument,s=a&&a.defaultView;s&&(s.removeEventListener("resize",r),delete s.__resizeTrigger__),t.__resizeTrigger__=!t.removeChild(t.__resizeTrigger__)}delete t.__resizeListeners__}}},92062:function(t,e,n){"use strict";n(21703),n(57658);var r=Object.prototype.hasOwnProperty,i="~";function o(){}function a(t,e,n){this.fn=t,this.context=e,this.once=n||!1}function s(t,e,n,r,o){if("function"!==typeof n)throw new TypeError("The listener must be a function");var s=new a(n,r||t,o),u=i?i+e:e;return t._events[u]?t._events[u].fn?t._events[u]=[t._events[u],s]:t._events[u].push(s):(t._events[u]=s,t._eventsCount++),t}function u(t,e){0===--t._eventsCount?t._events=new o:delete t._events[e]}function c(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(i=!1)),c.prototype.eventNames=function(){var t,e,n=[];if(0===this._eventsCount)return n;for(e in t=this._events)r.call(t,e)&&n.push(i?e.slice(1):e);return Object.getOwnPropertySymbols?n.concat(Object.getOwnPropertySymbols(t)):n},c.prototype.listeners=function(t){var e=i?i+t:t,n=this._events[e];if(!n)return[];if(n.fn)return[n.fn];for(var r=0,o=n.length,a=new Array(o);r<o;r++)a[r]=n[r].fn;return a},c.prototype.listenerCount=function(t){var e=i?i+t:t,n=this._events[e];return n?n.fn?1:n.length:0},c.prototype.emit=function(t,e,n,r,o,a){var s=i?i+t:t;if(!this._events[s])return!1;var u,c,l=this._events[s],h=arguments.length;if(l.fn){switch(l.once&&this.removeListener(t,l.fn,void 0,!0),h){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,e),!0;case 3:return l.fn.call(l.context,e,n),!0;case 4:return l.fn.call(l.context,e,n,r),!0;case 5:return l.fn.call(l.context,e,n,r,o),!0;case 6:return l.fn.call(l.context,e,n,r,o,a),!0}for(c=1,u=new Array(h-1);c<h;c++)u[c-1]=arguments[c];l.fn.apply(l.context,u)}else{var f,p=l.length;for(c=0;c<p;c++)switch(l[c].once&&this.removeListener(t,l[c].fn,void 0,!0),h){case 1:l[c].fn.call(l[c].context);break;case 2:l[c].fn.call(l[c].context,e);break;case 3:l[c].fn.call(l[c].context,e,n);break;case 4:l[c].fn.call(l[c].context,e,n,r);break;default:if(!u)for(f=1,u=new Array(h-1);f<h;f++)u[f-1]=arguments[f];l[c].fn.apply(l[c].context,u)}}return!0},c.prototype.on=function(t,e,n){return s(this,t,e,n,!1)},c.prototype.once=function(t,e,n){return s(this,t,e,n,!0)},c.prototype.removeListener=function(t,e,n,r){var o=i?i+t:t;if(!this._events[o])return this;if(!e)return u(this,o),this;var a=this._events[o];if(a.fn)a.fn!==e||r&&!a.once||n&&a.context!==n||u(this,o);else{for(var s=0,c=[],l=a.length;s<l;s++)(a[s].fn!==e||r&&!a[s].once||n&&a[s].context!==n)&&c.push(a[s]);c.length?this._events[o]=1===c.length?c[0]:c:u(this,o)}return this},c.prototype.removeAllListeners=function(t){var e;return t?(e=i?i+t:t,this._events[e]&&u(this,e)):(this._events=new o,this._eventsCount=0),this},c.prototype.off=c.prototype.removeListener,c.prototype.addListener=c.prototype.on,c.prefixed=i,c.EventEmitter=c,t.exports=c},61615:function(t,e){e.read=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?i-1:0,f=n?-1:1,p=t[e+h];for(h+=f,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+t[e+h],h+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+t[e+h],h+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=c}return(p?-1:1)*a*Math.pow(2,o-r)},e.write=function(t,e,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),e+=a+h>=1?f/u:f*Math.pow(2,1-h),e*u>=2&&(a++,u/=2),a+h>=l?(s=0,a=l):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;t[n+p]=255&a,p+=d,a/=256,c-=8);t[n+p-d]|=128*v}},39581:function(t,e,n){"use strict";n(41817),n(81299),Object.defineProperty(e,"__esModule",{value:!0});var r=Symbol.for("INJECTION");function i(t,e,n,i){function o(){return i&&!Reflect.hasMetadata(r,this,e)&&Reflect.defineMetadata(r,n(),this,e),Reflect.hasMetadata(r,this,e)?Reflect.getMetadata(r,this,e):n()}function a(t){Reflect.defineMetadata(r,t,this,e)}Object.defineProperty(t,e,{configurable:!0,enumerable:!0,get:o,set:a})}function o(t,e){return function(n){return function(r,o){var a=function(){return t.get(n)};i(r,o,a,e)}}}function a(t,e){return function(n,r){return function(o,a){var s=function(){return t.getNamed(n,r)};i(o,a,s,e)}}}function s(t,e){return function(n,r,o){return function(a,s){var u=function(){return t.getTagged(n,r,o)};i(a,s,u,e)}}}function u(t,e){return function(n){return function(r,o){var a=function(){return t.getAll(n)};i(r,o,a,e)}}}e.makePropertyInjectDecorator=o,e.makePropertyInjectNamedDecorator=a,e.makePropertyInjectTaggedDecorator=s,e.makePropertyMultiInjectDecorator=u},44810:function(t,e,n){"use strict";var r=n(39581);function i(t,e){void 0===e&&(e=!0);var n=r.makePropertyInjectDecorator(t,e),i=r.makePropertyInjectNamedDecorator(t,e),o=r.makePropertyInjectTaggedDecorator(t,e),a=r.makePropertyMultiInjectDecorator(t,e);return{lazyInject:n,lazyInjectNamed:i,lazyInjectTagged:o,lazyMultiInject:a}}e.Z=i},48283:function(t,e,n){"use strict";n(21703),n(81299),n(57658),Object.defineProperty(e,"__esModule",{value:!0}),e.tagProperty=e.tagParameter=e.decorate=void 0;var r=n(25904),i=n(6209);function o(t,e,n,r){var o=i.TAGGED;s(o,t,e,r,n)}function a(t,e,n){var r=i.TAGGED_PROP;s(r,t.constructor,e,n)}function s(t,e,n,i,o){var a={},s="number"===typeof o,u=void 0!==o&&s?o.toString():n;if(s&&void 0!==n)throw new Error(r.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(t,e)&&(a=Reflect.getMetadata(t,e));var c=a[u];if(Array.isArray(c))for(var l=0,h=c;l<h.length;l++){var f=h[l];if(f.key===i.key)throw new Error(r.DUPLICATED_METADATA+" "+f.key.toString())}else c=[];c.push(i),a[u]=c,Reflect.defineMetadata(t,a,e)}function u(t,e){Reflect.decorate(t,e)}function c(t,e){return function(n,r){e(n,r,t)}}function l(t,e,n){"number"===typeof n?u([c(n,t)],e):"string"===typeof n?Reflect.decorate([t],e,n):u([t],e)}e.tagParameter=o,e.tagProperty=a,e.decorate=l},35204:function(t,e,n){"use strict";n(21703),Object.defineProperty(e,"__esModule",{value:!0}),e.inject=e.LazyServiceIdentifer=void 0;var r=n(25904),i=n(6209),o=n(83521),a=n(48283),s=function(){function t(t){this._cb=t}return t.prototype.unwrap=function(){return this._cb()},t}();function u(t){return function(e,n,s){if(void 0===t)throw new Error(r.UNDEFINED_INJECT_ANNOTATION(e.name));var u=new o.Metadata(i.INJECT_TAG,t);"number"===typeof s?a.tagParameter(e,n,s,u):a.tagProperty(e,n,u)}}e.LazyServiceIdentifer=s,e.inject=u},75279:function(t,e,n){"use strict";n(81299),n(21703),Object.defineProperty(e,"__esModule",{value:!0}),e.injectable=void 0;var r=n(25904),i=n(6209);function o(){return function(t){if(Reflect.hasOwnMetadata(i.PARAM_TYPES,t))throw new Error(r.DUPLICATED_INJECTABLE_DECORATOR);var e=Reflect.getMetadata(i.DESIGN_PARAM_TYPES,t)||[];return Reflect.defineMetadata(i.PARAM_TYPES,e,t),t}}e.injectable=o},31318:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiInject=void 0;var r=n(6209),i=n(83521),o=n(48283);function a(t){return function(e,n,a){var s=new i.Metadata(r.MULTI_INJECT_TAG,t);"number"===typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}e.multiInject=a},98611:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.named=void 0;var r=n(6209),i=n(83521),o=n(48283);function a(t){return function(e,n,a){var s=new i.Metadata(r.NAMED_TAG,t);"number"===typeof a?o.tagParameter(e,n,a,s):o.tagProperty(e,n,s)}}e.named=a},22946:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.optional=void 0;var r=n(6209),i=n(83521),o=n(48283);function a(){return function(t,e,n){var a=new i.Metadata(r.OPTIONAL_TAG,!0);"number"===typeof n?o.tagParameter(t,e,n,a):o.tagProperty(t,e,a)}}e.optional=a},96550:function(t,e,n){"use strict";n(81299),n(21703),Object.defineProperty(e,"__esModule",{value:!0}),e.postConstruct=void 0;var r=n(25904),i=n(6209),o=n(83521);function a(){return function(t,e,n){var a=new o.Metadata(i.POST_CONSTRUCT,e);if(Reflect.hasOwnMetadata(i.POST_CONSTRUCT,t.constructor))throw new Error(r.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(i.POST_CONSTRUCT,a,t.constructor)}}e.postConstruct=a},64593:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.tagged=void 0;var r=n(83521),i=n(48283);function o(t,e){return function(n,o,a){var s=new r.Metadata(t,e);"number"===typeof a?i.tagParameter(n,o,a,s):i.tagProperty(n,o,s)}}e.tagged=o},48110:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.targetName=void 0;var r=n(6209),i=n(83521),o=n(48283);function a(t){return function(e,n,a){var s=new i.Metadata(r.NAME_TAG,t);o.tagParameter(e,n,a,s)}}e.targetName=a},82601:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.unmanaged=void 0;var r=n(6209),i=n(83521),o=n(48283);function a(){return function(t,e,n){var a=new i.Metadata(r.UNMANAGED_TAG,!0);o.tagParameter(t,e,n,a)}}e.unmanaged=a},35529:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Binding=void 0;var r=n(71369),i=n(85038),o=function(){function t(t,e){this.id=i.id(),this.activated=!1,this.serviceIdentifier=t,this.scope=e,this.type=r.BindingTypeEnum.Invalid,this.constraint=function(t){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return t.prototype.clone=function(){var e=new t(this.serviceIdentifier,this.scope);return e.activated=e.scope===r.BindingScopeEnum.Singleton&&this.activated,e.implementationType=this.implementationType,e.dynamicValue=this.dynamicValue,e.scope=this.scope,e.type=this.type,e.factory=this.factory,e.provider=this.provider,e.constraint=this.constraint,e.onActivation=this.onActivation,e.cache=this.cache,e},t}();e.Binding=o},73073:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingCount=void 0;var n={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};e.BindingCount=n},25904:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.STACK_OVERFLOW=e.CIRCULAR_DEPENDENCY_IN_FACTORY=e.POST_CONSTRUCT_ERROR=e.MULTIPLE_POST_CONSTRUCT_METHODS=e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=e.ARGUMENTS_LENGTH_MISMATCH=e.INVALID_DECORATOR_OPERATION=e.INVALID_TO_SELF_VALUE=e.INVALID_FUNCTION_BINDING=e.INVALID_MIDDLEWARE_RETURN=e.NO_MORE_SNAPSHOTS_AVAILABLE=e.INVALID_BINDING_TYPE=e.NOT_IMPLEMENTED=e.CIRCULAR_DEPENDENCY=e.UNDEFINED_INJECT_ANNOTATION=e.MISSING_INJECT_ANNOTATION=e.MISSING_INJECTABLE_ANNOTATION=e.NOT_REGISTERED=e.CANNOT_UNBIND=e.AMBIGUOUS_MATCH=e.KEY_NOT_FOUND=e.NULL_ARGUMENT=e.DUPLICATED_METADATA=e.DUPLICATED_INJECTABLE_DECORATOR=void 0,e.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",e.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",e.NULL_ARGUMENT="NULL argument",e.KEY_NOT_FOUND="Key Not Found",e.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",e.CANNOT_UNBIND="Could not unbind serviceIdentifier:",e.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",e.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",e.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var n=function(t){return"@inject called with undefined this could mean that the class "+t+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};e.UNDEFINED_INJECT_ANNOTATION=n,e.CIRCULAR_DEPENDENCY="Circular dependency found:",e.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",e.INVALID_BINDING_TYPE="Invalid binding type:",e.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",e.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",e.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",e.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",e.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var r=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"The number of constructor arguments in the derived class "+t[0]+" must be >= than the number of constructor arguments of its base class."};e.ARGUMENTS_LENGTH_MISMATCH=r,e.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",e.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",e.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",e.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",e.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var i=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"@postConstruct error in class "+t[0]+": "+t[1]};e.POST_CONSTRUCT_ERROR=i;var o=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return"It looks like there is a circular dependency in one of the '"+t[0]+"' bindings. Please investigate bindings withservice identifier '"+t[1]+"'."};e.CIRCULAR_DEPENDENCY_IN_FACTORY=o,e.STACK_OVERFLOW="Maximum call stack size exceeded"},71369:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TargetTypeEnum=e.BindingTypeEnum=e.BindingScopeEnum=void 0;var n={Request:"Request",Singleton:"Singleton",Transient:"Transient"};e.BindingScopeEnum=n;var r={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};e.BindingTypeEnum=r;var i={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};e.TargetTypeEnum=i},6209:function(t,e){"use strict";function n(){return[e.INJECT_TAG,e.MULTI_INJECT_TAG,e.NAME_TAG,e.UNMANAGED_TAG,e.NAMED_TAG,e.OPTIONAL_TAG]}Object.defineProperty(e,"__esModule",{value:!0}),e.NON_CUSTOM_TAG_KEYS=e.POST_CONSTRUCT=e.DESIGN_PARAM_TYPES=e.PARAM_TYPES=e.TAGGED_PROP=e.TAGGED=e.MULTI_INJECT_TAG=e.INJECT_TAG=e.OPTIONAL_TAG=e.UNMANAGED_TAG=e.NAME_TAG=e.NAMED_TAG=void 0,e.NAMED_TAG="named",e.NAME_TAG="name",e.UNMANAGED_TAG="unmanaged",e.OPTIONAL_TAG="optional",e.INJECT_TAG="inject",e.MULTI_INJECT_TAG="multi_inject",e.TAGGED="inversify:tagged",e.TAGGED_PROP="inversify:tagged_props",e.PARAM_TYPES="inversify:paramtypes",e.DESIGN_PARAM_TYPES="design:paramtypes",e.POST_CONSTRUCT="post_construct",e.NON_CUSTOM_TAG_KEYS=n()},91820:function(t,e,n){"use strict";var r=n(1692)["default"];n(41817),n(33948),n(21703),n(57658);var i=this&&this.__awaiter||function(t,e,n,r){function i(t){return t instanceof n?t:new n((function(e){e(t)}))}return new(n||(n=Promise))((function(n,o){function a(t){try{u(r.next(t))}catch(e){o(e)}}function s(t){try{u(r["throw"](t))}catch(e){o(e)}}function u(t){t.done?n(t.value):i(t.value).then(a,s)}u((r=r.apply(t,e||[])).next())}))},o=this&&this.__generator||function(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"===typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(t){return function(e){return u([t,e])}}function u(o){if(n)throw new TypeError("Generator is already executing.");while(a)try{if(n=1,r&&(i=2&o[0]?r["return"]:o[0]?r["throw"]||((i=r["return"])&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(s){o=[6,s],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}},a=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.Container=void 0;var s=n(35529),u=n(25904),c=n(71369),l=n(6209),h=n(65152),f=n(11471),p=n(8359),d=n(47722),v=n(85038),m=n(53799),g=n(16219),y=n(26824),_=function(){function t(t){this._appliedMiddleware=[];var e=t||{};if("object"!==r(e))throw new Error(""+u.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(void 0===e.defaultScope)e.defaultScope=c.BindingScopeEnum.Transient;else if(e.defaultScope!==c.BindingScopeEnum.Singleton&&e.defaultScope!==c.BindingScopeEnum.Transient&&e.defaultScope!==c.BindingScopeEnum.Request)throw new Error(""+u.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(void 0===e.autoBindInjectable)e.autoBindInjectable=!1;else if("boolean"!==typeof e.autoBindInjectable)throw new Error(""+u.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(void 0===e.skipBaseClassChecks)e.skipBaseClassChecks=!1;else if("boolean"!==typeof e.skipBaseClassChecks)throw new Error(""+u.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:e.autoBindInjectable,defaultScope:e.defaultScope,skipBaseClassChecks:e.skipBaseClassChecks},this.id=v.id(),this._bindingDictionary=new y.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new h.MetadataReader}return t.merge=function(e,n){for(var r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];var o=new t,s=a([e,n],r).map((function(t){return f.getBindingDictionary(t)})),u=f.getBindingDictionary(o);function c(t,e){t.traverse((function(t,n){n.forEach((function(t){e.add(t.serviceIdentifier,t.clone())}))}))}return s.forEach((function(t){c(t,u)})),o},t.prototype.load=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=this._getContainerModuleHelpersFactory(),r=0,i=t;r<i.length;r++){var o=i[r],a=n(o.id);o.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)}},t.prototype.loadAsync=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return i(this,void 0,void 0,(function(){var e,n,r,i,a;return o(this,(function(o){switch(o.label){case 0:e=this._getContainerModuleHelpersFactory(),n=0,r=t,o.label=1;case 1:return n<r.length?(i=r[n],a=e(i.id),[4,i.registry(a.bindFunction,a.unbindFunction,a.isboundFunction,a.rebindFunction)]):[3,4];case 2:o.sent(),o.label=3;case 3:return n++,[3,1];case 4:return[2]}}))}))},t.prototype.unload=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=function(t){return function(e){return e.moduleId===t}};e.forEach((function(e){var n=r(e.id);t._bindingDictionary.removeByCondition(n)}))},t.prototype.bind=function(t){var e=this.options.defaultScope||c.BindingScopeEnum.Transient,n=new s.Binding(t,e);return this._bindingDictionary.add(t,n),new d.BindingToSyntax(n)},t.prototype.rebind=function(t){return this.unbind(t),this.bind(t)},t.prototype.unbind=function(t){try{this._bindingDictionary.remove(t)}catch(e){throw new Error(u.CANNOT_UNBIND+" "+m.getServiceIdentifierAsString(t))}},t.prototype.unbindAll=function(){this._bindingDictionary=new y.Lookup},t.prototype.isBound=function(t){var e=this._bindingDictionary.hasKey(t);return!e&&this.parent&&(e=this.parent.isBound(t)),e},t.prototype.isBoundNamed=function(t,e){return this.isBoundTagged(t,l.NAMED_TAG,e)},t.prototype.isBoundTagged=function(t,e,n){var r=!1;if(this._bindingDictionary.hasKey(t)){var i=this._bindingDictionary.get(t),o=f.createMockRequest(this,t,e,n);r=i.some((function(t){return t.constraint(o)}))}return!r&&this.parent&&(r=this.parent.isBoundTagged(t,e,n)),r},t.prototype.snapshot=function(){this._snapshots.push(g.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},t.prototype.restore=function(){var t=this._snapshots.pop();if(void 0===t)throw new Error(u.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=t.bindings,this._middleware=t.middleware},t.prototype.createChild=function(e){var n=new t(e||this.options);return n.parent=this,n},t.prototype.applyMiddleware=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._appliedMiddleware=this._appliedMiddleware.concat(t);var n=this._middleware?this._middleware:this._planAndResolve();this._middleware=t.reduce((function(t,e){return e(t)}),n)},t.prototype.applyCustomMetadataReader=function(t){this._metadataReader=t},t.prototype.get=function(t){return this._get(!1,!1,c.TargetTypeEnum.Variable,t)},t.prototype.getTagged=function(t,e,n){return this._get(!1,!1,c.TargetTypeEnum.Variable,t,e,n)},t.prototype.getNamed=function(t,e){return this.getTagged(t,l.NAMED_TAG,e)},t.prototype.getAll=function(t){return this._get(!0,!0,c.TargetTypeEnum.Variable,t)},t.prototype.getAllTagged=function(t,e,n){return this._get(!1,!0,c.TargetTypeEnum.Variable,t,e,n)},t.prototype.getAllNamed=function(t,e){return this.getAllTagged(t,l.NAMED_TAG,e)},t.prototype.resolve=function(t){var e=this.createChild();return e.bind(t).toSelf(),this._appliedMiddleware.forEach((function(t){e.applyMiddleware(t)})),e.get(t)},t.prototype._getContainerModuleHelpersFactory=function(){var t=this,e=function(t,e){t._binding.moduleId=e},n=function(n){return function(r){var i=t.bind.bind(t),o=i(r);return e(o,n),o}},r=function(e){return function(e){var n=t.unbind.bind(t);n(e)}},i=function(e){return function(e){var n=t.isBound.bind(t);return n(e)}},o=function(n){return function(r){var i=t.rebind.bind(t),o=i(r);return e(o,n),o}};return function(t){return{bindFunction:n(t),isboundFunction:i(t),rebindFunction:o(t),unbindFunction:r(t)}}},t.prototype._get=function(t,e,n,r,i,o){var a=null,s={avoidConstraints:t,contextInterceptor:function(t){return t},isMultiInject:e,key:i,serviceIdentifier:r,targetType:n,value:o};if(this._middleware){if(a=this._middleware(s),void 0===a||null===a)throw new Error(u.INVALID_MIDDLEWARE_RETURN)}else a=this._planAndResolve()(s);return a},t.prototype._planAndResolve=function(){var t=this;return function(e){var n=f.plan(t._metadataReader,t,e.isMultiInject,e.targetType,e.serviceIdentifier,e.key,e.value,e.avoidConstraints);n=e.contextInterceptor(n);var r=p.resolve(n);return r}},t}();e.Container=_},65920:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.AsyncContainerModule=e.ContainerModule=void 0;var r=n(85038),i=function(){function t(t){this.id=r.id(),this.registry=t}return t}();e.ContainerModule=i;var o=function(){function t(t){this.id=r.id(),this.registry=t}return t}();e.AsyncContainerModule=o},16219:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.ContainerSnapshot=void 0;var n=function(){function t(){}return t.of=function(e,n){var r=new t;return r.bindings=e,r.middleware=n,r},t}();e.ContainerSnapshot=n},26824:function(t,e,n){"use strict";n(33948),n(21703),n(57658),Object.defineProperty(e,"__esModule",{value:!0}),e.Lookup=void 0;var r=n(25904),i=function(){function t(){this._map=new Map}return t.prototype.getMap=function(){return this._map},t.prototype.add=function(t,e){if(null===t||void 0===t)throw new Error(r.NULL_ARGUMENT);if(null===e||void 0===e)throw new Error(r.NULL_ARGUMENT);var n=this._map.get(t);void 0!==n?(n.push(e),this._map.set(t,n)):this._map.set(t,[e])},t.prototype.get=function(t){if(null===t||void 0===t)throw new Error(r.NULL_ARGUMENT);var e=this._map.get(t);if(void 0!==e)return e;throw new Error(r.KEY_NOT_FOUND)},t.prototype.remove=function(t){if(null===t||void 0===t)throw new Error(r.NULL_ARGUMENT);if(!this._map.delete(t))throw new Error(r.KEY_NOT_FOUND)},t.prototype.removeByCondition=function(t){var e=this;this._map.forEach((function(n,r){var i=n.filter((function(e){return!t(e)}));i.length>0?e._map.set(r,i):e._map.delete(r)}))},t.prototype.hasKey=function(t){if(null===t||void 0===t)throw new Error(r.NULL_ARGUMENT);return this._map.has(t)},t.prototype.clone=function(){var e=new t;return this._map.forEach((function(t,n){t.forEach((function(t){return e.add(n,t.clone())}))})),e},t.prototype.traverse=function(t){this._map.forEach((function(e,n){t(n,e)}))},t}();e.Lookup=i},35993:function(t,e,n){"use strict";e.GW=e.zY=e.f3=e.b2=e.W2=void 0;var r=n(6209);var i=n(91820);Object.defineProperty(e,"W2",{enumerable:!0,get:function(){return i.Container}});var o=n(71369);var a=n(65920);var s=n(75279);Object.defineProperty(e,"b2",{enumerable:!0,get:function(){return s.injectable}});var u=n(64593);var c=n(98611);var l=n(35204);Object.defineProperty(e,"f3",{enumerable:!0,get:function(){return l.inject}});var h=n(22946);var f=n(82601);var p=n(31318);var d=n(48110);var v=n(96550);Object.defineProperty(e,"zY",{enumerable:!0,get:function(){return v.postConstruct}});var m=n(65152);var g=n(85038);var y=n(48283);Object.defineProperty(e,"GW",{enumerable:!0,get:function(){return y.decorate}});var _=n(41418);var x=n(53799);var b=n(38081)},12077:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Context=void 0;var r=n(85038),i=function(){function t(t){this.id=r.id(),this.container=t}return t.prototype.addPlan=function(t){this.plan=t},t.prototype.setCurrentRequest=function(t){this.currentRequest=t},t}();e.Context=i},83521:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Metadata=void 0;var r=n(6209),i=function(){function t(t,e){this.key=t,this.value=e}return t.prototype.toString=function(){return this.key===r.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},t}();e.Metadata=i},65152:function(t,e,n){"use strict";n(81299),Object.defineProperty(e,"__esModule",{value:!0}),e.MetadataReader=void 0;var r=n(6209),i=function(){function t(){}return t.prototype.getConstructorMetadata=function(t){var e=Reflect.getMetadata(r.PARAM_TYPES,t),n=Reflect.getMetadata(r.TAGGED,t);return{compilerGeneratedMetadata:e,userGeneratedMetadata:n||{}}},t.prototype.getPropertiesMetadata=function(t){var e=Reflect.getMetadata(r.TAGGED_PROP,t)||[];return e},t}();e.MetadataReader=i},9428:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Plan=void 0;var n=function(){function t(t,e){this.parentContext=t,this.rootRequest=e}return t}();e.Plan=n},11471:function(t,e,n){"use strict";n(57658),n(21703),Object.defineProperty(e,"__esModule",{value:!0}),e.getBindingDictionary=e.createMockRequest=e.plan=void 0;var r=n(73073),i=n(25904),o=n(71369),a=n(6209),s=n(52527),u=n(53799),c=n(12077),l=n(83521),h=n(9428),f=n(41353),p=n(46473),d=n(76501);function v(t){return t._bindingDictionary}function m(t,e,n,r,i,o){var s=t?a.MULTI_INJECT_TAG:a.INJECT_TAG,u=new l.Metadata(s,n),c=new d.Target(e,r,n,u);if(void 0!==i){var h=new l.Metadata(i,o);c.metadata.push(h)}return c}function g(t,e,n,i,o){var a=x(n.container,o.serviceIdentifier),s=[];return a.length===r.BindingCount.NoBindingsAvailable&&n.container.options.autoBindInjectable&&"function"===typeof o.serviceIdentifier&&t.getConstructorMetadata(o.serviceIdentifier).compilerGeneratedMetadata&&(n.container.bind(o.serviceIdentifier).toSelf(),a=x(n.container,o.serviceIdentifier)),s=e?a:a.filter((function(t){var e=new p.Request(t.serviceIdentifier,n,i,t,o);return t.constraint(e)})),y(o.serviceIdentifier,s,o,n.container),s}function y(t,e,n,o){switch(e.length){case r.BindingCount.NoBindingsAvailable:if(n.isOptional())return e;var a=u.getServiceIdentifierAsString(t),s=i.NOT_REGISTERED;throw s+=u.listMetadataForTarget(a,n),s+=u.listRegisteredBindingsForServiceIdentifier(o,a,x),new Error(s);case r.BindingCount.OnlyOneBindingAvailable:if(!n.isArray())return e;case r.BindingCount.MultipleBindingsAvailable:default:if(n.isArray())return e;a=u.getServiceIdentifierAsString(t),s=i.AMBIGUOUS_MATCH+" "+a;throw s+=u.listRegisteredBindingsForServiceIdentifier(o,a,x),new Error(s)}}function _(t,e,n,r,a,s){var u,c;if(null===a){u=g(t,e,r,null,s),c=new p.Request(n,r,null,u,s);var l=new h.Plan(r,c);r.addPlan(l)}else u=g(t,e,r,a,s),c=a.addChildRequest(s.serviceIdentifier,u,s);u.forEach((function(e){var n=null;if(s.isArray())n=c.addChildRequest(e.serviceIdentifier,e,s);else{if(e.cache)return;n=c}if(e.type===o.BindingTypeEnum.Instance&&null!==e.implementationType){var a=f.getDependencies(t,e.implementationType);if(!r.container.options.skipBaseClassChecks){var u=f.getBaseClassDependencyCount(t,e.implementationType);if(a.length<u){var l=i.ARGUMENTS_LENGTH_MISMATCH(f.getFunctionName(e.implementationType));throw new Error(l)}}a.forEach((function(e){_(t,!1,e.serviceIdentifier,r,n,e)}))}}))}function x(t,e){var n=[],r=v(t);return r.hasKey(e)?n=r.get(e):null!==t.parent&&(n=x(t.parent,e)),n}function b(t,e,n,r,i,o,a,l){void 0===l&&(l=!1);var h=new c.Context(e),f=m(n,r,i,"",o,a);try{return _(t,l,i,h,null,f),h}catch(p){throw s.isStackOverflowExeption(p)&&h.plan&&u.circularDependencyToException(h.plan.rootRequest),p}}function w(t,e,n,r){var i=new d.Target(o.TargetTypeEnum.Variable,"",e,new l.Metadata(n,r)),a=new c.Context(t),s=new p.Request(e,a,null,[],i);return s}e.getBindingDictionary=v,e.plan=b,e.createMockRequest=w},56109:function(t,e,n){"use strict";n(65069),Object.defineProperty(e,"__esModule",{value:!0}),e.QueryableString=void 0;var r=function(){function t(t){this.str=t}return t.prototype.startsWith=function(t){return 0===this.str.indexOf(t)},t.prototype.endsWith=function(t){var e="",n=t.split("").reverse().join("");return e=this.str.split("").reverse().join(""),this.startsWith.call({str:e},n)},t.prototype.contains=function(t){return-1!==this.str.indexOf(t)},t.prototype.equals=function(t){return this.str===t},t.prototype.value=function(){return this.str},t}();e.QueryableString=r},41353:function(t,e,n){"use strict";n(21703),n(57658);var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.getFunctionName=e.getBaseClassDependencyCount=e.getDependencies=void 0;var i=n(35204),o=n(25904),a=n(71369),s=n(6209),u=n(53799);Object.defineProperty(e,"getFunctionName",{enumerable:!0,get:function(){return u.getFunctionName}});var c=n(76501);function l(t,e){var n=u.getFunctionName(e),r=h(t,n,e,!1);return r}function h(t,e,n,i){var a=t.getConstructorMetadata(n),s=a.compilerGeneratedMetadata;if(void 0===s){var u=o.MISSING_INJECTABLE_ANNOTATION+" "+e+".";throw new Error(u)}var c=a.userGeneratedMetadata,l=Object.keys(c),h=0===n.length&&l.length>0,f=l.length>n.length,v=h||f?l.length:n.length,m=p(i,e,s,c,v),g=d(t,n),y=r(r([],m),g);return y}function f(t,e,n,r,s){var u=s[t.toString()]||[],l=m(u),h=!0!==l.unmanaged,f=r[t],p=l.inject||l.multiInject;if(f=p||f,f instanceof i.LazyServiceIdentifer&&(f=f.unwrap()),h){var d=f===Object,v=f===Function,g=void 0===f,y=d||v||g;if(!e&&y){var _=o.MISSING_INJECT_ANNOTATION+" argument "+t+" in class "+n+".";throw new Error(_)}var x=new c.Target(a.TargetTypeEnum.ConstructorArgument,l.targetName,f);return x.metadata=u,x}return null}function p(t,e,n,r,i){for(var o=[],a=0;a<i;a++){var s=a,u=f(s,t,e,n,r);null!==u&&o.push(u)}return o}function d(t,e){for(var n=t.getPropertiesMetadata(e),i=[],o=Object.keys(n),s=0,u=o;s<u.length;s++){var l=u[s],h=n[l],f=m(n[l]),p=f.targetName||l,v=f.inject||f.multiInject,g=new c.Target(a.TargetTypeEnum.ClassProperty,p,v);g.metadata=h,i.push(g)}var y=Object.getPrototypeOf(e.prototype).constructor;if(y!==Object){var _=d(t,y);i=r(r([],i),_)}return i}function v(t,e){var n=Object.getPrototypeOf(e.prototype).constructor;if(n!==Object){var r=u.getFunctionName(n),i=h(t,r,n,!0),o=i.map((function(t){return t.metadata.filter((function(t){return t.key===s.UNMANAGED_TAG}))})),a=[].concat.apply([],o).length,c=i.length-a;return c>0?c:v(t,n)}return 0}function m(t){var e={};return t.forEach((function(t){e[t.key.toString()]=t.value})),{inject:e[s.INJECT_TAG],multiInject:e[s.MULTI_INJECT_TAG],targetName:e[s.NAME_TAG],unmanaged:e[s.UNMANAGED_TAG]}}e.getDependencies=l,e.getBaseClassDependencyCount=v},46473:function(t,e,n){"use strict";n(33948),n(57658),Object.defineProperty(e,"__esModule",{value:!0}),e.Request=void 0;var r=n(85038),i=function(){function t(t,e,n,i,o){this.id=r.id(),this.serviceIdentifier=t,this.parentContext=e,this.parentRequest=n,this.target=o,this.childRequests=[],this.bindings=Array.isArray(i)?i:[i],this.requestScope=null===n?new Map:null}return t.prototype.addChildRequest=function(e,n,r){var i=new t(e,this.parentContext,this,n,r);return this.childRequests.push(i),i},t}();e.Request=i},76501:function(t,e,n){"use strict";n(57658),Object.defineProperty(e,"__esModule",{value:!0}),e.Target=void 0;var r=n(6209),i=n(85038),o=n(83521),a=n(56109),s=function(){function t(t,e,n,s){this.id=i.id(),this.type=t,this.serviceIdentifier=n,this.name=new a.QueryableString(e||""),this.metadata=new Array;var u=null;"string"===typeof s?u=new o.Metadata(r.NAMED_TAG,s):s instanceof o.Metadata&&(u=s),null!==u&&this.metadata.push(u)}return t.prototype.hasTag=function(t){for(var e=0,n=this.metadata;e<n.length;e++){var r=n[e];if(r.key===t)return!0}return!1},t.prototype.isArray=function(){return this.hasTag(r.MULTI_INJECT_TAG)},t.prototype.matchesArray=function(t){return this.matchesTag(r.MULTI_INJECT_TAG)(t)},t.prototype.isNamed=function(){return this.hasTag(r.NAMED_TAG)},t.prototype.isTagged=function(){return this.metadata.some((function(t){return r.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))}))},t.prototype.isOptional=function(){return this.matchesTag(r.OPTIONAL_TAG)(!0)},t.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter((function(t){return t.key===r.NAMED_TAG}))[0]:null},t.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter((function(t){return r.NON_CUSTOM_TAG_KEYS.every((function(e){return t.key!==e}))})):null},t.prototype.matchesNamedTag=function(t){return this.matchesTag(r.NAMED_TAG)(t)},t.prototype.matchesTag=function(t){var e=this;return function(n){for(var r=0,i=e.metadata;r<i.length;r++){var o=i[r];if(o.key===t&&o.value===n)return!0}return!1}},t}();e.Target=s},37013:function(t,e,n){"use strict";n(81299),n(21703);var r=this&&this.__spreadArray||function(t,e){for(var n=0,r=e.length,i=t.length;n<r;n++,i++)t[i]=e[n];return t};Object.defineProperty(e,"__esModule",{value:!0}),e.resolveInstance=void 0;var i=n(25904),o=n(71369),a=n(6209);function s(t,e,n){var r=e.filter((function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ClassProperty})),i=r.map(n);return r.forEach((function(e,n){var r="";r=e.target.name.value();var o=i[n];t[r]=o})),t}function u(t,e){return new(t.bind.apply(t,r([void 0],e)))}function c(t,e){if(Reflect.hasMetadata(a.POST_CONSTRUCT,t)){var n=Reflect.getMetadata(a.POST_CONSTRUCT,t);try{e[n.value]()}catch(r){throw new Error(i.POST_CONSTRUCT_ERROR(t.name,r.message))}}}function l(t,e,n){var r=null;if(e.length>0){var i=e.filter((function(t){return null!==t.target&&t.target.type===o.TargetTypeEnum.ConstructorArgument})),a=i.map(n);r=u(t,a),r=s(r,e,n)}else r=new t;return c(t,r),r}e.resolveInstance=l},8359:function(t,e,n){"use strict";n(21703),Object.defineProperty(e,"__esModule",{value:!0}),e.resolve=void 0;var r=n(25904),i=n(71369),o=n(52527),a=n(53799),s=n(37013),u=function(t,e,n){try{return n()}catch(i){throw o.isStackOverflowExeption(i)?new Error(r.CIRCULAR_DEPENDENCY_IN_FACTORY(t,e.toString())):i}},c=function t(e){return function(n){n.parentContext.setCurrentRequest(n);var o=n.bindings,c=n.childRequests,l=n.target&&n.target.isArray(),h=!n.parentRequest||!n.parentRequest.target||!n.target||!n.parentRequest.target.matchesArray(n.target.serviceIdentifier);if(l&&h)return c.map((function(n){var r=t(e);return r(n)}));var f=null;if(!n.target.isOptional()||0!==o.length){var p=o[0],d=p.scope===i.BindingScopeEnum.Singleton,v=p.scope===i.BindingScopeEnum.Request;if(d&&p.activated)return p.cache;if(v&&null!==e&&e.has(p.id))return e.get(p.id);if(p.type===i.BindingTypeEnum.ConstantValue)f=p.cache,p.activated=!0;else if(p.type===i.BindingTypeEnum.Function)f=p.cache,p.activated=!0;else if(p.type===i.BindingTypeEnum.Constructor)f=p.implementationType;else if(p.type===i.BindingTypeEnum.DynamicValue&&null!==p.dynamicValue)f=u("toDynamicValue",p.serviceIdentifier,(function(){return p.dynamicValue(n.parentContext)}));else if(p.type===i.BindingTypeEnum.Factory&&null!==p.factory)f=u("toFactory",p.serviceIdentifier,(function(){return p.factory(n.parentContext)}));else if(p.type===i.BindingTypeEnum.Provider&&null!==p.provider)f=u("toProvider",p.serviceIdentifier,(function(){return p.provider(n.parentContext)}));else{if(p.type!==i.BindingTypeEnum.Instance||null===p.implementationType){var m=a.getServiceIdentifierAsString(n.serviceIdentifier);throw new Error(r.INVALID_BINDING_TYPE+" "+m)}f=s.resolveInstance(p.implementationType,c,t(e))}return"function"===typeof p.onActivation&&(f=p.onActivation(n.parentContext,f)),d&&(p.cache=f,p.activated=!0),v&&null!==e&&!e.has(p.id)&&e.set(p.id,f),f}}};function l(t){var e=c(t.plan.rootRequest.requestScope);return e(t.plan.rootRequest)}e.resolve=l},9693:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInSyntax=void 0;var r=n(71369),i=n(58084),o=function(){function t(t){this._binding=t}return t.prototype.inRequestScope=function(){return this._binding.scope=r.BindingScopeEnum.Request,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inSingletonScope=function(){return this._binding.scope=r.BindingScopeEnum.Singleton,new i.BindingWhenOnSyntax(this._binding)},t.prototype.inTransientScope=function(){return this._binding.scope=r.BindingScopeEnum.Transient,new i.BindingWhenOnSyntax(this._binding)},t}();e.BindingInSyntax=o},68983:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingInWhenOnSyntax=void 0;var r=n(9693),i=n(18549),o=n(51554),a=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new o.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new i.BindingOnSyntax(this._binding),this._bindingInSyntax=new r.BindingInSyntax(t)}return t.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},t.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},t.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingInWhenOnSyntax=a},18549:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingOnSyntax=void 0;var r=n(51554),i=function(){function t(t){this._binding=t}return t.prototype.onActivation=function(t){return this._binding.onActivation=t,new r.BindingWhenSyntax(this._binding)},t}();e.BindingOnSyntax=i},47722:function(t,e,n){"use strict";n(21703),Object.defineProperty(e,"__esModule",{value:!0}),e.BindingToSyntax=void 0;var r=n(25904),i=n(71369),o=n(68983),a=n(58084),s=function(){function t(t){this._binding=t}return t.prototype.to=function(t){return this._binding.type=i.BindingTypeEnum.Instance,this._binding.implementationType=t,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toSelf=function(){if("function"!==typeof this._binding.serviceIdentifier)throw new Error(""+r.INVALID_TO_SELF_VALUE);var t=this._binding.serviceIdentifier;return this.to(t)},t.prototype.toConstantValue=function(t){return this._binding.type=i.BindingTypeEnum.ConstantValue,this._binding.cache=t,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toDynamicValue=function(t){return this._binding.type=i.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=t,this._binding.implementationType=null,new o.BindingInWhenOnSyntax(this._binding)},t.prototype.toConstructor=function(t){return this._binding.type=i.BindingTypeEnum.Constructor,this._binding.implementationType=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toFunction=function(t){if("function"!==typeof t)throw new Error(r.INVALID_FUNCTION_BINDING);var e=this.toConstantValue(t);return this._binding.type=i.BindingTypeEnum.Function,this._binding.scope=i.BindingScopeEnum.Singleton,e},t.prototype.toAutoFactory=function(t){return this._binding.type=i.BindingTypeEnum.Factory,this._binding.factory=function(e){var n=function(){return e.container.get(t)};return n},this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toProvider=function(t){return this._binding.type=i.BindingTypeEnum.Provider,this._binding.provider=t,this._binding.scope=i.BindingScopeEnum.Singleton,new a.BindingWhenOnSyntax(this._binding)},t.prototype.toService=function(t){this.toDynamicValue((function(e){return e.container.get(t)}))},t}();e.BindingToSyntax=s},58084:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenOnSyntax=void 0;var r=n(18549),i=n(51554),o=function(){function t(t){this._binding=t,this._bindingWhenSyntax=new i.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new r.BindingOnSyntax(this._binding)}return t.prototype.when=function(t){return this._bindingWhenSyntax.when(t)},t.prototype.whenTargetNamed=function(t){return this._bindingWhenSyntax.whenTargetNamed(t)},t.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},t.prototype.whenTargetTagged=function(t,e){return this._bindingWhenSyntax.whenTargetTagged(t,e)},t.prototype.whenInjectedInto=function(t){return this._bindingWhenSyntax.whenInjectedInto(t)},t.prototype.whenParentNamed=function(t){return this._bindingWhenSyntax.whenParentNamed(t)},t.prototype.whenParentTagged=function(t,e){return this._bindingWhenSyntax.whenParentTagged(t,e)},t.prototype.whenAnyAncestorIs=function(t){return this._bindingWhenSyntax.whenAnyAncestorIs(t)},t.prototype.whenNoAncestorIs=function(t){return this._bindingWhenSyntax.whenNoAncestorIs(t)},t.prototype.whenAnyAncestorNamed=function(t){return this._bindingWhenSyntax.whenAnyAncestorNamed(t)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenAnyAncestorTagged(t,e)},t.prototype.whenNoAncestorNamed=function(t){return this._bindingWhenSyntax.whenNoAncestorNamed(t)},t.prototype.whenNoAncestorTagged=function(t,e){return this._bindingWhenSyntax.whenNoAncestorTagged(t,e)},t.prototype.whenAnyAncestorMatches=function(t){return this._bindingWhenSyntax.whenAnyAncestorMatches(t)},t.prototype.whenNoAncestorMatches=function(t){return this._bindingWhenSyntax.whenNoAncestorMatches(t)},t.prototype.onActivation=function(t){return this._bindingOnSyntax.onActivation(t)},t}();e.BindingWhenOnSyntax=o},51554:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.BindingWhenSyntax=void 0;var r=n(18549),i=n(41418),o=function(){function t(t){this._binding=t}return t.prototype.when=function(t){return this._binding.constraint=t,new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetNamed=function(t){return this._binding.constraint=i.namedConstraint(t),new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(t){var e=null!==t.target&&!t.target.isNamed()&&!t.target.isTagged();return e},new r.BindingOnSyntax(this._binding)},t.prototype.whenTargetTagged=function(t,e){return this._binding.constraint=i.taggedConstraint(t)(e),new r.BindingOnSyntax(this._binding)},t.prototype.whenInjectedInto=function(t){return this._binding.constraint=function(e){return i.typeConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentNamed=function(t){return this._binding.constraint=function(e){return i.namedConstraint(t)(e.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenParentTagged=function(t,e){return this._binding.constraint=function(n){return i.taggedConstraint(t)(e)(n.parentRequest)},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorIs=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorIs=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.typeConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorNamed=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorNamed=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,i.namedConstraint(t))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorTagged=function(t,e){return this._binding.constraint=function(n){return i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorTagged=function(t,e){return this._binding.constraint=function(n){return!i.traverseAncerstors(n,i.taggedConstraint(t)(e))},new r.BindingOnSyntax(this._binding)},t.prototype.whenAnyAncestorMatches=function(t){return this._binding.constraint=function(e){return i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t.prototype.whenNoAncestorMatches=function(t){return this._binding.constraint=function(e){return!i.traverseAncerstors(e,t)},new r.BindingOnSyntax(this._binding)},t}();e.BindingWhenSyntax=o},41418:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.typeConstraint=e.namedConstraint=e.taggedConstraint=e.traverseAncerstors=void 0;var r=n(6209),i=n(83521),o=function t(e,n){var r=e.parentRequest;return null!==r&&(!!n(r)||t(r,n))};e.traverseAncerstors=o;var a=function(t){return function(e){var n=function(n){return null!==n&&null!==n.target&&n.target.matchesTag(t)(e)};return n.metaData=new i.Metadata(t,e),n}};e.taggedConstraint=a;var s=a(r.NAMED_TAG);e.namedConstraint=s;var u=function(t){return function(e){var n=null;if(null!==e){if(n=e.bindings[0],"string"===typeof t){var r=n.serviceIdentifier;return r===t}var i=e.bindings[0].implementationType;return t===i}return!1}};e.typeConstraint=u},38081:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.multiBindToService=void 0;var n=function(t){return function(e){return function(){for(var n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];return n.forEach((function(n){return t.bind(n).toService(e)}))}}};e.multiBindToService=n},52527:function(t,e,n){"use strict";n(21703),Object.defineProperty(e,"__esModule",{value:!0}),e.isStackOverflowExeption=void 0;var r=n(25904);function i(t){return t instanceof RangeError||t.message===r.STACK_OVERFLOW}e.isStackOverflowExeption=i},85038:function(t,e){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.id=void 0;var n=0;function r(){return n++}e.id=r},53799:function(t,e,n){"use strict";var r=n(1692)["default"];n(57658),n(65069),n(21703),n(74916),Object.defineProperty(e,"__esModule",{value:!0}),e.circularDependencyToException=e.listMetadataForTarget=e.listRegisteredBindingsForServiceIdentifier=e.getServiceIdentifierAsString=e.getFunctionName=void 0;var i=n(25904);function o(t){if("function"===typeof t){var e=t;return e.name}if("symbol"===r(t))return t.toString();e=t;return e}function a(t,e,n){var r="",i=n(t,e);return 0!==i.length&&(r="\nRegistered bindings:",i.forEach((function(t){var e="Object";null!==t.implementationType&&(e=h(t.implementationType)),r=r+"\n "+e,t.constraint.metaData&&(r=r+" - "+t.constraint.metaData)}))),r}function s(t,e){return null!==t.parentRequest&&(t.parentRequest.serviceIdentifier===e||s(t.parentRequest,e))}function u(t){function e(t,n){void 0===n&&(n=[]);var r=o(t.serviceIdentifier);return n.push(r),null!==t.parentRequest?e(t.parentRequest,n):n}var n=e(t);return n.reverse().join(" --\x3e ")}function c(t){t.childRequests.forEach((function(t){if(s(t,t.serviceIdentifier)){var e=u(t);throw new Error(i.CIRCULAR_DEPENDENCY+" "+e)}c(t)}))}function l(t,e){if(e.isTagged()||e.isNamed()){var n="",r=e.getNamedTag(),i=e.getCustomTags();return null!==r&&(n+=r.toString()+"\n"),null!==i&&i.forEach((function(t){n+=t.toString()+"\n"}))," "+t+"\n "+t+" - "+n}return" "+t}function h(t){if(t.name)return t.name;var e=t.toString(),n=e.match(/^function\s*([^\s(]+)/);return n?n[1]:"Anonymous function: "+e}e.getServiceIdentifierAsString=o,e.listRegisteredBindingsForServiceIdentifier=a,e.circularDependencyToException=c,e.listMetadataForTarget=l,e.getFunctionName=h},89225:function(t,e,n){"use strict";n(39575),n(76495),n(48675),n(33105),n(63408),n(14590),n(3462),n(33824),n(23767),n(8585),n(68696),n(8255),n(49743),t.exports=i,t.exports["default"]=i;var r=1e20;function i(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer,s=a+2*this.buffer,u="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;u?this.canvas=my.createOffscreenCanvas(a,a,"2d"):(this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a),this.ctx=this.canvas.getContext("2d",{willReadFrequently:!0}),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(s*s),this.gridInner=new Float64Array(s*s),this.f=new Float64Array(s),this.z=new Float64Array(s+1),this.v=new Uint16Array(s),this.useMetrics=void 0!==this.ctx.measureText("A").actualBoundingBoxLeft,this.middle=u?Math.round(a/2*1):Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function o(t,e,n,i,o,a,s){a.fill(r,0,e*n),s.fill(0,0,e*n);for(var u=(e-i)/2,c=0;c<o;c++)for(var l=0;l<i;l++){var h=(c+u)*e+l+u,f=t.data[4*(c*i+l)+3]/255;if(1===f)a[h]=0,s[h]=r;else if(0===f)a[h]=r,s[h]=0;else{var p=Math.max(0,.5-f),d=Math.max(0,f-.5);a[h]=p*p,s[h]=d*d}}}function a(t,e,n,r,i,o,a){for(var s=0;s<e*n;s++){var u=Math.sqrt(r[s])-Math.sqrt(i[s]);t[s]=Math.round(255-255*(u/o+a))}}function s(t,e,n,r,i,o){for(var a=0;a<e;a++)u(t,a,e,n,r,i,o);for(var s=0;s<n;s++)u(t,s*e,1,e,r,i,o)}function u(t,e,n,i,o,a,s){var u,c,l,h;for(a[0]=0,s[0]=-r,s[1]=r,u=0;u<i;u++)o[u]=t[e+u*n];for(u=1,c=0,l=0;u<i;u++){do{h=a[c],l=(o[u]-o[h]+u*u-h*h)/(u-h)/2}while(l<=s[c]&&--c>-1);c++,a[c]=u,s[c]=l,s[c+1]=r}for(u=0,c=0;u<i;u++){while(s[c+1]<u)c++;h=a[c],t[e+u*n]=o[h]+(u-h)*(u-h)}}i.prototype._draw=function(t,e){var n,r,i,u,c,l,h,f,p,d=this.ctx.measureText(t),v=d.width,m=2*this.buffer;e&&this.useMetrics?(c=Math.floor(d.actualBoundingBoxAscent),f=this.buffer+Math.ceil(d.actualBoundingBoxAscent),l=this.buffer,h=this.buffer,r=Math.min(this.size,Math.ceil(d.actualBoundingBoxRight-d.actualBoundingBoxLeft)),u=Math.min(this.size-l,Math.ceil(d.actualBoundingBoxAscent+d.actualBoundingBoxDescent)),n=r+m,i=u+m,this.ctx.textBaseline="alphabetic"):(n=r=this.size,i=u=this.size,c=19*this.fontSize/24,l=h=0,f=this.middle,this.ctx.textBaseline="middle"),r&&u&&(this.ctx.clearRect(h,l,r,u),this.ctx.fillText(t,this.buffer,f),p=this.ctx.getImageData(h,l,r,u));var g=new Uint8ClampedArray(n*i);return o(p,n,i,r,u,this.gridOuter,this.gridInner),s(this.gridOuter,n,i,this.f,this.v,this.z),s(this.gridInner,n,i,this.f,this.v,this.z),a(g,n,i,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:g,metrics:{width:r,height:u,sdfWidth:n,sdfHeight:i,top:c,left:0,advance:v}}},i.prototype.draw=function(t){return this._draw(t,!1).data},i.prototype.drawWithMetrics=function(t){return this._draw(t,!0)}},33671:function(t,e,n){"use strict";n.r(e),n.d(e,{Function:function(){return nn},Interpreter:function(){return Ye},default:function(){return rn},evaluate:function(){return en},vm:function(){return r}});var r={};n.r(r),n.d(r,{Script:function(){return tn},compileFunction:function(){return Qe},createContext:function(){return Ke},runInContext:function(){return Je},runInNewContext:function(){return $e}});var i=n(2434),o=(n(41817),n(24603),n(74916),n(39575),n(44197),n(33105),n(3462),n(33824),n(76495),n(29135),n(33948),n(15306),n(92087),{3:"abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile",5:"class enum extends super const export import",6:"enum",strict:"implements interface let package private protected public static yield",strictBind:"eval arguments"}),a="break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this",s={5:a,"5module":a+" export import",6:a+" const class extends export import super"},u=/^in(stanceof)?$/,c="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽͿΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԯԱ-Ֆՙՠ-ֈא-תׯ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࡠ-ࡪࢠ-ࢴࢶ-ࣇऄ-हऽॐक़-ॡॱ-ঀঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱৼਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡૹଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-హఽౘ-ౚౠౡಀಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഄ-ഌഎ-ഐഒ-ഺഽൎൔ-ൖൟ-ൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄຆ-ຊຌ-ຣລວ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏽᏸ-ᏽᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛸᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡸᢀ-ᢨᢪᢰ-ᣵᤀ-ᤞᥐ-ᥭᥰ-ᥴᦀ-ᦫᦰ-ᧉᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᲀ-ᲈᲐ-ᲺᲽ-Ჿᳩ-ᳬᳮ-ᳳᳵᳶᳺᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕ℘-ℝℤΩℨK-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞ々-〇〡-〩〱-〵〸-〼ぁ-ゖ゛-ゟァ-ヺー-ヿㄅ-ㄯㄱ-ㆎㆠ-ㆿㇰ-ㇿ㐀-䶿一-鿼ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚝꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞿꟂ-ꟊꟵ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꣽꣾꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꧠ-ꧤꧦ-ꧯꧺ-ꧾꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꩾ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꬰ-ꭚꭜ-ꭩꭰ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",l="‌‍·̀-ͯ·҃-֑҇-ׇֽֿׁׂׅׄؐ-ًؚ-٩ٰۖ-ۜ۟-۪ۤۧۨ-ۭ۰-۹ܑܰ-݊ަ-ް߀-߉߫-߽߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࡙࠭-࡛࣓-ࣣ࣡-ःऺ-़ा-ॏ॑-ॗॢॣ०-९ঁ-ঃ়া-ৄেৈো-্ৗৢৣ০-৯৾ਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣ૦-૯ૺ-૿ଁ-ଃ଼ା-ୄେୈୋ-୍୕-ୗୢୣ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఀ-ఄా-ౄె-ైొ-్ౕౖౢౣ౦-౯ಁ-ಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣ೦-೯ഀ-ഃ഻഼ാ-ൄെ-ൈൊ-്ൗൢൣ൦-൯ඁ-ඃ්ා-ුූෘ-ෟ෦-෯ෲෳัิ-ฺ็-๎๐-๙ັິ-ຼ່-ໍ໐-໙༘༙༠-༩༹༵༷༾༿ཱ-྄྆྇ྍ-ྗྙ-ྼ࿆ါ-ှ၀-၉ၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟፩-፱ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳ឴-៓៝០-៩᠋-᠍᠐-᠙ᢩᤠ-ᤫᤰ-᤻᥆-᥏᧐-᧚ᨗ-ᨛᩕ-ᩞ᩠-᩿᩼-᪉᪐-᪙᪰-᪽ᪿᫀᬀ-ᬄ᬴-᭄᭐-᭙᭫-᭳ᮀ-ᮂᮡ-ᮭ᮰-᮹᯦-᯳ᰤ-᰷᱀-᱉᱐-᱙᳐-᳔᳒-᳨᳭᳴᳷-᳹᷀-᷹᷻-᷿‿⁀⁔⃐-⃥⃜⃡-⃰⳯-⵿⳱ⷠ-〪ⷿ-゙゚〯꘠-꘩꙯ꙴ-꙽ꚞꚟ꛰꛱ꠂ꠆ꠋꠣ-ꠧ꠬ꢀꢁꢴ-ꣅ꣐-꣙꣠-꣱ꣿ-꤉ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀꧐-꧙ꧥ꧰-꧹ꨩ-ꨶꩃꩌꩍ꩐-꩙ꩻ-ꩽꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꫫ-ꫯꫵ꫶ꯣ-ꯪ꯬꯭꯰-꯹ﬞ︀-️︠-︯︳︴﹍-﹏０-９＿",h=new RegExp("["+c+"]"),f=new RegExp("["+c+l+"]");c=l=null;var p=[0,11,2,25,2,18,2,1,2,14,3,13,35,122,70,52,268,28,4,48,48,31,14,29,6,37,11,29,3,35,5,7,2,4,43,157,19,35,5,35,5,39,9,51,157,310,10,21,11,7,153,5,3,0,2,43,2,1,4,0,3,22,11,22,10,30,66,18,2,1,11,21,11,25,71,55,7,1,65,0,16,3,2,2,2,28,43,28,4,28,36,7,2,27,28,53,11,21,11,18,14,17,111,72,56,50,14,50,14,35,349,41,7,1,79,28,11,0,9,21,107,20,28,22,13,52,76,44,33,24,27,35,30,0,3,0,9,34,4,0,13,47,15,3,22,0,2,0,36,17,2,24,85,6,2,0,2,3,2,14,2,9,8,46,39,7,3,1,3,21,2,6,2,1,2,4,4,0,19,0,13,4,159,52,19,3,21,2,31,47,21,1,2,0,185,46,42,3,37,47,21,0,60,42,14,0,72,26,230,43,117,63,32,7,3,0,3,7,2,1,2,23,16,0,2,0,95,7,3,38,17,0,2,0,29,0,11,39,8,0,22,0,12,45,20,0,35,56,264,8,2,36,18,0,50,29,113,6,2,1,2,37,22,0,26,5,2,1,2,31,15,0,328,18,190,0,80,921,103,110,18,195,2749,1070,4050,582,8634,568,8,30,114,29,19,47,17,3,32,20,6,18,689,63,129,74,6,0,67,12,65,1,2,0,29,6135,9,1237,43,8,8952,286,50,2,18,3,9,395,2309,106,6,12,4,8,8,9,5991,84,2,70,2,1,3,0,3,1,3,3,2,11,2,0,2,6,2,64,2,3,3,7,2,6,2,27,2,3,2,4,2,0,4,6,2,339,3,24,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,30,2,24,2,7,2357,44,11,6,17,0,370,43,1301,196,60,67,8,0,1205,3,2,26,2,1,2,0,3,0,2,9,2,3,2,0,2,0,7,0,5,0,2,0,2,0,2,2,2,1,2,0,3,0,2,0,2,0,2,0,2,0,2,1,2,0,3,3,2,6,2,3,2,3,2,0,2,9,2,16,6,2,2,4,2,16,4421,42717,35,4148,12,221,3,5761,15,7472,3104,541,1507,4938],d=[509,0,227,0,150,4,294,9,1368,2,2,1,6,3,41,2,5,0,166,1,574,3,9,9,370,1,154,10,176,2,54,14,32,9,16,3,46,10,54,9,7,2,37,13,2,9,6,1,45,0,13,2,49,13,9,3,2,11,83,11,7,0,161,11,6,9,7,3,56,1,2,6,3,1,3,2,10,0,11,1,3,6,4,4,193,17,10,9,5,0,82,19,13,9,214,6,3,8,28,1,83,16,16,9,82,12,9,9,84,14,5,9,243,14,166,9,71,5,2,1,3,3,2,0,2,1,13,9,120,6,3,6,4,0,29,9,41,6,2,3,9,0,10,10,47,15,406,7,2,7,17,9,57,21,2,13,123,5,4,0,2,1,2,6,2,0,9,9,49,4,2,1,2,4,9,9,330,3,19306,9,135,4,60,6,26,9,1014,0,2,54,8,3,82,0,12,1,19628,1,5319,4,4,5,9,7,3,6,31,3,149,2,1418,49,513,54,5,49,9,0,15,0,23,4,2,14,1361,6,2,16,3,6,2,1,2,4,262,6,10,9,419,13,1495,6,110,6,6,9,4759,9,787719,239];function v(t,e){for(var n=65536,r=0;r<e.length;r+=2){if(n+=e[r],n>t)return!1;if(n+=e[r+1],n>=t)return!0}}function m(t,e){return t<65?36===t:t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&h.test(String.fromCharCode(t)):!1!==e&&v(t,p)))}function g(t,e){return t<48?36===t:t<58||!(t<65)&&(t<91||(t<97?95===t:t<123||(t<=65535?t>=170&&f.test(String.fromCharCode(t)):!1!==e&&(v(t,p)||v(t,d)))))}var y=function(t,e){void 0===e&&(e={}),this.label=t,this.keyword=e.keyword,this.beforeExpr=!!e.beforeExpr,this.startsExpr=!!e.startsExpr,this.isLoop=!!e.isLoop,this.isAssign=!!e.isAssign,this.prefix=!!e.prefix,this.postfix=!!e.postfix,this.binop=e.binop||null,this.updateContext=null};function _(t,e){return new y(t,{beforeExpr:!0,binop:e})}var x={beforeExpr:!0},b={startsExpr:!0},w={};function E(t,e){return void 0===e&&(e={}),e.keyword=t,w[t]=new y(t,e)}var S={num:new y("num",b),regexp:new y("regexp",b),string:new y("string",b),name:new y("name",b),eof:new y("eof"),bracketL:new y("[",{beforeExpr:!0,startsExpr:!0}),bracketR:new y("]"),braceL:new y("{",{beforeExpr:!0,startsExpr:!0}),braceR:new y("}"),parenL:new y("(",{beforeExpr:!0,startsExpr:!0}),parenR:new y(")"),comma:new y(",",x),semi:new y(";",x),colon:new y(":",x),dot:new y("."),question:new y("?",x),questionDot:new y("?."),arrow:new y("=>",x),template:new y("template"),invalidTemplate:new y("invalidTemplate"),ellipsis:new y("...",x),backQuote:new y("`",b),dollarBraceL:new y("${",{beforeExpr:!0,startsExpr:!0}),eq:new y("=",{beforeExpr:!0,isAssign:!0}),assign:new y("_=",{beforeExpr:!0,isAssign:!0}),incDec:new y("++/--",{prefix:!0,postfix:!0,startsExpr:!0}),prefix:new y("!/~",{beforeExpr:!0,prefix:!0,startsExpr:!0}),logicalOR:_("||",1),logicalAND:_("&&",2),bitwiseOR:_("|",3),bitwiseXOR:_("^",4),bitwiseAND:_("&",5),equality:_("==/!=/===/!==",6),relational:_("</>/<=/>=",7),bitShift:_("<</>>/>>>",8),plusMin:new y("+/-",{beforeExpr:!0,binop:9,prefix:!0,startsExpr:!0}),modulo:_("%",10),star:_("*",10),slash:_("/",10),starstar:new y("**",{beforeExpr:!0}),coalesce:_("??",1),_break:E("break"),_case:E("case",x),_catch:E("catch"),_continue:E("continue"),_debugger:E("debugger"),_default:E("default",x),_do:E("do",{isLoop:!0,beforeExpr:!0}),_else:E("else",x),_finally:E("finally"),_for:E("for",{isLoop:!0}),_function:E("function",b),_if:E("if"),_return:E("return",x),_switch:E("switch"),_throw:E("throw",x),_try:E("try"),_var:E("var"),_const:E("const"),_while:E("while",{isLoop:!0}),_with:E("with"),_new:E("new",{beforeExpr:!0,startsExpr:!0}),_this:E("this",b),_super:E("super",b),_class:E("class",b),_extends:E("extends",x),_export:E("export"),_import:E("import",b),_null:E("null",b),_true:E("true",b),_false:E("false",b),_in:E("in",{beforeExpr:!0,binop:7}),_instanceof:E("instanceof",{beforeExpr:!0,binop:7}),_typeof:E("typeof",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_void:E("void",{beforeExpr:!0,prefix:!0,startsExpr:!0}),_delete:E("delete",{beforeExpr:!0,prefix:!0,startsExpr:!0})},A=/\r\n?|\n|\u2028|\u2029/,T=new RegExp(A.source,"g");function C(t,e){return 10===t||13===t||!e&&(8232===t||8233===t)}var k=/[\u1680\u2000-\u200a\u202f\u205f\u3000\ufeff]/,M=/(?:\s|\/\/.*|\/\*[^]*?\*\/)*/g,P=Object.prototype,I=P.hasOwnProperty,R=P.toString;function L(t,e){return I.call(t,e)}var O=Array.isArray||function(t){return"[object Array]"===R.call(t)};function D(t){return new RegExp("^(?:"+t.replace(/ /g,"|")+")$")}var N=function(t,e){this.line=t,this.column=e};N.prototype.offset=function(t){return new N(this.line,this.column+t)};var z=function(t,e,n){this.start=e,this.end=n,null!==t.sourceFile&&(this.source=t.sourceFile)};function F(t,e){for(var n=1,r=0;;){T.lastIndex=r;var i=T.exec(t);if(!(i&&i.index<e))return new N(n,e-r);++n,r=i.index+i[0].length}}var B={ecmaVersion:10,sourceType:"script",onInsertedSemicolon:null,onTrailingComma:null,allowReserved:null,allowReturnOutsideFunction:!1,allowImportExportEverywhere:!1,allowAwaitOutsideFunction:!1,allowHashBang:!1,locations:!1,onToken:null,onComment:null,ranges:!1,program:null,sourceFile:null,directSourceFile:null,preserveParens:!1};function U(t){var e={};for(var n in B)e[n]=t&&L(t,n)?t[n]:B[n];if(e.ecmaVersion>=2015&&(e.ecmaVersion-=2009),null==e.allowReserved&&(e.allowReserved=e.ecmaVersion<5),O(e.onToken)){var r=e.onToken;e.onToken=function(t){return r.push(t)}}return O(e.onComment)&&(e.onComment=j(e,e.onComment)),e}function j(t,e){return function(n,r,i,o,a,s){var u={type:n?"Block":"Line",value:r,start:i,end:o};t.locations&&(u.loc=new z(this,a,s)),t.ranges&&(u.range=[i,o]),e.push(u)}}var Z=1,V=2,G=Z|V,H=4,W=8,q=16,X=32,Y=64,K=128;function Q(t,e){return V|(t?H:0)|(e?W:0)}var J=0,$=1,tt=2,et=3,nt=4,rt=5,it=function(t,e,n){this.options=t=U(t),this.sourceFile=t.sourceFile,this.keywords=D(s[t.ecmaVersion>=6?6:"module"===t.sourceType?"5module":5]);var r="";if(!0!==t.allowReserved){for(var i=t.ecmaVersion;;i--)if(r=o[i])break;"module"===t.sourceType&&(r+=" await")}this.reservedWords=D(r);var a=(r?r+" ":"")+o.strict;this.reservedWordsStrict=D(a),this.reservedWordsStrictBind=D(a+" "+o.strictBind),this.input=String(e),this.containsEsc=!1,n?(this.pos=n,this.lineStart=this.input.lastIndexOf("\n",n-1)+1,this.curLine=this.input.slice(0,this.lineStart).split(A).length):(this.pos=this.lineStart=0,this.curLine=1),this.type=S.eof,this.value=null,this.start=this.end=this.pos,this.startLoc=this.endLoc=this.curPosition(),this.lastTokEndLoc=this.lastTokStartLoc=null,this.lastTokStart=this.lastTokEnd=this.pos,this.context=this.initialContext(),this.exprAllowed=!0,this.inModule="module"===t.sourceType,this.strict=this.inModule||this.strictDirective(this.pos),this.potentialArrowAt=-1,this.yieldPos=this.awaitPos=this.awaitIdentPos=0,this.labels=[],this.undefinedExports={},0===this.pos&&t.allowHashBang&&"#!"===this.input.slice(0,2)&&this.skipLineComment(2),this.scopeStack=[],this.enterScope(Z),this.regexpState=null},ot={inFunction:{configurable:!0},inGenerator:{configurable:!0},inAsync:{configurable:!0},allowSuper:{configurable:!0},allowDirectSuper:{configurable:!0},treatFunctionsAsVar:{configurable:!0}};it.prototype.parse=function(){var t=this.options.program||this.startNode();return this.nextToken(),this.parseTopLevel(t)},ot.inFunction.get=function(){return(this.currentVarScope().flags&V)>0},ot.inGenerator.get=function(){return(this.currentVarScope().flags&W)>0},ot.inAsync.get=function(){return(this.currentVarScope().flags&H)>0},ot.allowSuper.get=function(){return(this.currentThisScope().flags&Y)>0},ot.allowDirectSuper.get=function(){return(this.currentThisScope().flags&K)>0},ot.treatFunctionsAsVar.get=function(){return this.treatFunctionsAsVarInScope(this.currentScope())},it.prototype.inNonArrowFunction=function(){return(this.currentThisScope().flags&V)>0},it.extend=function(){var t=[],e=arguments.length;while(e--)t[e]=arguments[e];for(var n=this,r=0;r<t.length;r++)n=t[r](n);return n},it.parse=function(t,e){return new this(e,t).parse()},it.parseExpressionAt=function(t,e,n){var r=new this(n,t,e);return r.nextToken(),r.parseExpression()},it.tokenizer=function(t,e){return new this(e,t)},Object.defineProperties(it.prototype,ot);var at=it.prototype,st=/^(?:'((?:\\.|[^'\\])*?)'|"((?:\\.|[^"\\])*?)")/;function ut(){this.shorthandAssign=this.trailingComma=this.parenthesizedAssign=this.parenthesizedBind=this.doubleProto=-1}at.strictDirective=function(t){for(;;){M.lastIndex=t,t+=M.exec(this.input)[0].length;var e=st.exec(this.input.slice(t));if(!e)return!1;if("use strict"===(e[1]||e[2])){M.lastIndex=t+e[0].length;var n=M.exec(this.input),r=n.index+n[0].length,i=this.input.charAt(r);return";"===i||"}"===i||A.test(n[0])&&!(/[(`.[+\-/*%<>=,?^&]/.test(i)||"!"===i&&"="===this.input.charAt(r+1))}t+=e[0].length,M.lastIndex=t,t+=M.exec(this.input)[0].length,";"===this.input[t]&&t++}},at.eat=function(t){return this.type===t&&(this.next(),!0)},at.isContextual=function(t){return this.type===S.name&&this.value===t&&!this.containsEsc},at.eatContextual=function(t){return!!this.isContextual(t)&&(this.next(),!0)},at.expectContextual=function(t){this.eatContextual(t)||this.unexpected()},at.canInsertSemicolon=function(){return this.type===S.eof||this.type===S.braceR||A.test(this.input.slice(this.lastTokEnd,this.start))},at.insertSemicolon=function(){if(this.canInsertSemicolon())return this.options.onInsertedSemicolon&&this.options.onInsertedSemicolon(this.lastTokEnd,this.lastTokEndLoc),!0},at.semicolon=function(){this.eat(S.semi)||this.insertSemicolon()||this.unexpected()},at.afterTrailingComma=function(t,e){if(this.type===t)return this.options.onTrailingComma&&this.options.onTrailingComma(this.lastTokStart,this.lastTokStartLoc),e||this.next(),!0},at.expect=function(t){this.eat(t)||this.unexpected()},at.unexpected=function(t){this.raise(null!=t?t:this.start,"Unexpected token")},at.checkPatternErrors=function(t,e){if(t){t.trailingComma>-1&&this.raiseRecoverable(t.trailingComma,"Comma is not permitted after the rest element");var n=e?t.parenthesizedAssign:t.parenthesizedBind;n>-1&&this.raiseRecoverable(n,"Parenthesized pattern")}},at.checkExpressionErrors=function(t,e){if(!t)return!1;var n=t.shorthandAssign,r=t.doubleProto;if(!e)return n>=0||r>=0;n>=0&&this.raise(n,"Shorthand property assignments are valid only in destructuring patterns"),r>=0&&this.raiseRecoverable(r,"Redefinition of __proto__ property")},at.checkYieldAwaitInDefaultParams=function(){this.yieldPos&&(!this.awaitPos||this.yieldPos<this.awaitPos)&&this.raise(this.yieldPos,"Yield expression cannot be a default value"),this.awaitPos&&this.raise(this.awaitPos,"Await expression cannot be a default value")},at.isSimpleAssignTarget=function(t){return"ParenthesizedExpression"===t.type?this.isSimpleAssignTarget(t.expression):"Identifier"===t.type||"MemberExpression"===t.type};var ct=it.prototype;ct.parseTopLevel=function(t){var e={};t.body||(t.body=[]);while(this.type!==S.eof){var n=this.parseStatement(null,!0,e);t.body.push(n)}if(this.inModule)for(var r=0,i=Object.keys(this.undefinedExports);r<i.length;r+=1){var o=i[r];this.raiseRecoverable(this.undefinedExports[o].start,"Export '"+o+"' is not defined")}return this.adaptDirectivePrologue(t.body),this.next(),t.sourceType=this.options.sourceType,this.finishNode(t,"Program")};var lt={kind:"loop"},ht={kind:"switch"};ct.isLet=function(t){if(this.options.ecmaVersion<6||!this.isContextual("let"))return!1;M.lastIndex=this.pos;var e=M.exec(this.input),n=this.pos+e[0].length,r=this.input.charCodeAt(n);if(91===r)return!0;if(t)return!1;if(123===r)return!0;if(m(r,!0)){var i=n+1;while(g(this.input.charCodeAt(i),!0))++i;var o=this.input.slice(n,i);if(!u.test(o))return!0}return!1},ct.isAsyncFunction=function(){if(this.options.ecmaVersion<8||!this.isContextual("async"))return!1;M.lastIndex=this.pos;var t=M.exec(this.input),e=this.pos+t[0].length;return!A.test(this.input.slice(this.pos,e))&&"function"===this.input.slice(e,e+8)&&(e+8===this.input.length||!g(this.input.charAt(e+8)))},ct.parseStatement=function(t,e,n){var r,i=this.type,o=this.startNode();switch(this.isLet(t)&&(i=S._var,r="let"),i){case S._break:case S._continue:return this.parseBreakContinueStatement(o,i.keyword);case S._debugger:return this.parseDebuggerStatement(o);case S._do:return this.parseDoStatement(o);case S._for:return this.parseForStatement(o);case S._function:return t&&(this.strict||"if"!==t&&"label"!==t)&&this.options.ecmaVersion>=6&&this.unexpected(),this.parseFunctionStatement(o,!1,!t);case S._class:return t&&this.unexpected(),this.parseClass(o,!0);case S._if:return this.parseIfStatement(o);case S._return:return this.parseReturnStatement(o);case S._switch:return this.parseSwitchStatement(o);case S._throw:return this.parseThrowStatement(o);case S._try:return this.parseTryStatement(o);case S._const:case S._var:return r=r||this.value,t&&"var"!==r&&this.unexpected(),this.parseVarStatement(o,r);case S._while:return this.parseWhileStatement(o);case S._with:return this.parseWithStatement(o);case S.braceL:return this.parseBlock(!0,o);case S.semi:return this.parseEmptyStatement(o);case S._export:case S._import:if(this.options.ecmaVersion>10&&i===S._import){M.lastIndex=this.pos;var a=M.exec(this.input),s=this.pos+a[0].length,u=this.input.charCodeAt(s);if(40===u||46===u)return this.parseExpressionStatement(o,this.parseExpression())}return this.options.allowImportExportEverywhere||(e||this.raise(this.start,"'import' and 'export' may only appear at the top level"),this.inModule||this.raise(this.start,"'import' and 'export' may appear only with 'sourceType: module'")),i===S._import?this.parseImport(o):this.parseExport(o,n);default:if(this.isAsyncFunction())return t&&this.unexpected(),this.next(),this.parseFunctionStatement(o,!0,!t);var c=this.value,l=this.parseExpression();return i===S.name&&"Identifier"===l.type&&this.eat(S.colon)?this.parseLabeledStatement(o,c,l,t):this.parseExpressionStatement(o,l)}},ct.parseBreakContinueStatement=function(t,e){var n="break"===e;this.next(),this.eat(S.semi)||this.insertSemicolon()?t.label=null:this.type!==S.name?this.unexpected():(t.label=this.parseIdent(),this.semicolon());for(var r=0;r<this.labels.length;++r){var i=this.labels[r];if(null==t.label||i.name===t.label.name){if(null!=i.kind&&(n||"loop"===i.kind))break;if(t.label&&n)break}}return r===this.labels.length&&this.raise(t.start,"Unsyntactic "+e),this.finishNode(t,n?"BreakStatement":"ContinueStatement")},ct.parseDebuggerStatement=function(t){return this.next(),this.semicolon(),this.finishNode(t,"DebuggerStatement")},ct.parseDoStatement=function(t){return this.next(),this.labels.push(lt),t.body=this.parseStatement("do"),this.labels.pop(),this.expect(S._while),t.test=this.parseParenExpression(),this.options.ecmaVersion>=6?this.eat(S.semi):this.semicolon(),this.finishNode(t,"DoWhileStatement")},ct.parseForStatement=function(t){this.next();var e=this.options.ecmaVersion>=9&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction)&&this.eatContextual("await")?this.lastTokStart:-1;if(this.labels.push(lt),this.enterScope(0),this.expect(S.parenL),this.type===S.semi)return e>-1&&this.unexpected(e),this.parseFor(t,null);var n=this.isLet();if(this.type===S._var||this.type===S._const||n){var r=this.startNode(),i=n?"let":this.value;return this.next(),this.parseVar(r,!0,i),this.finishNode(r,"VariableDeclaration"),(this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of"))&&1===r.declarations.length?(this.options.ecmaVersion>=9&&(this.type===S._in?e>-1&&this.unexpected(e):t.await=e>-1),this.parseForIn(t,r)):(e>-1&&this.unexpected(e),this.parseFor(t,r))}var o=new ut,a=this.parseExpression(!0,o);return this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of")?(this.options.ecmaVersion>=9&&(this.type===S._in?e>-1&&this.unexpected(e):t.await=e>-1),this.toAssignable(a,!1,o),this.checkLVal(a),this.parseForIn(t,a)):(this.checkExpressionErrors(o,!0),e>-1&&this.unexpected(e),this.parseFor(t,a))},ct.parseFunctionStatement=function(t,e,n){return this.next(),this.parseFunction(t,pt|(n?0:dt),!1,e)},ct.parseIfStatement=function(t){return this.next(),t.test=this.parseParenExpression(),t.consequent=this.parseStatement("if"),t.alternate=this.eat(S._else)?this.parseStatement("if"):null,this.finishNode(t,"IfStatement")},ct.parseReturnStatement=function(t){return this.inFunction||this.options.allowReturnOutsideFunction||this.raise(this.start,"'return' outside of function"),this.next(),this.eat(S.semi)||this.insertSemicolon()?t.argument=null:(t.argument=this.parseExpression(),this.semicolon()),this.finishNode(t,"ReturnStatement")},ct.parseSwitchStatement=function(t){var e;this.next(),t.discriminant=this.parseParenExpression(),t.cases=[],this.expect(S.braceL),this.labels.push(ht),this.enterScope(0);for(var n=!1;this.type!==S.braceR;)if(this.type===S._case||this.type===S._default){var r=this.type===S._case;e&&this.finishNode(e,"SwitchCase"),t.cases.push(e=this.startNode()),e.consequent=[],this.next(),r?e.test=this.parseExpression():(n&&this.raiseRecoverable(this.lastTokStart,"Multiple default clauses"),n=!0,e.test=null),this.expect(S.colon)}else e||this.unexpected(),e.consequent.push(this.parseStatement(null));return this.exitScope(),e&&this.finishNode(e,"SwitchCase"),this.next(),this.labels.pop(),this.finishNode(t,"SwitchStatement")},ct.parseThrowStatement=function(t){return this.next(),A.test(this.input.slice(this.lastTokEnd,this.start))&&this.raise(this.lastTokEnd,"Illegal newline after throw"),t.argument=this.parseExpression(),this.semicolon(),this.finishNode(t,"ThrowStatement")};var ft=[];ct.parseTryStatement=function(t){if(this.next(),t.block=this.parseBlock(),t.handler=null,this.type===S._catch){var e=this.startNode();if(this.next(),this.eat(S.parenL)){e.param=this.parseBindingAtom();var n="Identifier"===e.param.type;this.enterScope(n?X:0),this.checkLVal(e.param,n?nt:tt),this.expect(S.parenR)}else this.options.ecmaVersion<10&&this.unexpected(),e.param=null,this.enterScope(0);e.body=this.parseBlock(!1),this.exitScope(),t.handler=this.finishNode(e,"CatchClause")}return t.finalizer=this.eat(S._finally)?this.parseBlock():null,t.handler||t.finalizer||this.raise(t.start,"Missing catch or finally clause"),this.finishNode(t,"TryStatement")},ct.parseVarStatement=function(t,e){return this.next(),this.parseVar(t,!1,e),this.semicolon(),this.finishNode(t,"VariableDeclaration")},ct.parseWhileStatement=function(t){return this.next(),t.test=this.parseParenExpression(),this.labels.push(lt),t.body=this.parseStatement("while"),this.labels.pop(),this.finishNode(t,"WhileStatement")},ct.parseWithStatement=function(t){return this.strict&&this.raise(this.start,"'with' in strict mode"),this.next(),t.object=this.parseParenExpression(),t.body=this.parseStatement("with"),this.finishNode(t,"WithStatement")},ct.parseEmptyStatement=function(t){return this.next(),this.finishNode(t,"EmptyStatement")},ct.parseLabeledStatement=function(t,e,n,r){for(var i=0,o=this.labels;i<o.length;i+=1){var a=o[i];a.name===e&&this.raise(n.start,"Label '"+e+"' is already declared")}for(var s=this.type.isLoop?"loop":this.type===S._switch?"switch":null,u=this.labels.length-1;u>=0;u--){var c=this.labels[u];if(c.statementStart!==t.start)break;c.statementStart=this.start,c.kind=s}return this.labels.push({name:e,kind:s,statementStart:this.start}),t.body=this.parseStatement(r?-1===r.indexOf("label")?r+"label":r:"label"),this.labels.pop(),t.label=n,this.finishNode(t,"LabeledStatement")},ct.parseExpressionStatement=function(t,e){return t.expression=e,this.semicolon(),this.finishNode(t,"ExpressionStatement")},ct.parseBlock=function(t,e,n){void 0===t&&(t=!0),void 0===e&&(e=this.startNode()),e.body=[],this.expect(S.braceL),t&&this.enterScope(0);while(this.type!==S.braceR){var r=this.parseStatement(null);e.body.push(r)}return n&&(this.strict=!1),this.next(),t&&this.exitScope(),this.finishNode(e,"BlockStatement")},ct.parseFor=function(t,e){return t.init=e,this.expect(S.semi),t.test=this.type===S.semi?null:this.parseExpression(),this.expect(S.semi),t.update=this.type===S.parenR?null:this.parseExpression(),this.expect(S.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,"ForStatement")},ct.parseForIn=function(t,e){var n=this.type===S._in;return this.next(),"VariableDeclaration"===e.type&&null!=e.declarations[0].init&&(!n||this.options.ecmaVersion<8||this.strict||"var"!==e.kind||"Identifier"!==e.declarations[0].id.type)?this.raise(e.start,(n?"for-in":"for-of")+" loop variable declaration may not have an initializer"):"AssignmentPattern"===e.type&&this.raise(e.start,"Invalid left-hand side in for-loop"),t.left=e,t.right=n?this.parseExpression():this.parseMaybeAssign(),this.expect(S.parenR),t.body=this.parseStatement("for"),this.exitScope(),this.labels.pop(),this.finishNode(t,n?"ForInStatement":"ForOfStatement")},ct.parseVar=function(t,e,n){for(t.declarations=[],t.kind=n;;){var r=this.startNode();if(this.parseVarId(r,n),this.eat(S.eq)?r.init=this.parseMaybeAssign(e):"const"!==n||this.type===S._in||this.options.ecmaVersion>=6&&this.isContextual("of")?"Identifier"===r.id.type||e&&(this.type===S._in||this.isContextual("of"))?r.init=null:this.raise(this.lastTokEnd,"Complex binding patterns require an initialization value"):this.unexpected(),t.declarations.push(this.finishNode(r,"VariableDeclarator")),!this.eat(S.comma))break}return t},ct.parseVarId=function(t,e){t.id=this.parseBindingAtom(),this.checkLVal(t.id,"var"===e?$:tt,!1)};var pt=1,dt=2,vt=4;ct.parseFunction=function(t,e,n,r){this.initFunction(t),(this.options.ecmaVersion>=9||this.options.ecmaVersion>=6&&!r)&&(this.type===S.star&&e&dt&&this.unexpected(),t.generator=this.eat(S.star)),this.options.ecmaVersion>=8&&(t.async=!!r),e&pt&&(t.id=e&vt&&this.type!==S.name?null:this.parseIdent(),!t.id||e&dt||this.checkLVal(t.id,this.strict||t.generator||t.async?this.treatFunctionsAsVar?$:tt:et));var i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Q(t.async,t.generator)),e&pt||(t.id=this.type===S.name?this.parseIdent():null),this.parseFunctionParams(t),this.parseFunctionBody(t,n,!1),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(t,e&pt?"FunctionDeclaration":"FunctionExpression")},ct.parseFunctionParams=function(t){this.expect(S.parenL),t.params=this.parseBindingList(S.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams()},ct.parseClass=function(t,e){this.next();var n=this.strict;this.strict=!0,this.parseClassId(t,e),this.parseClassSuper(t);var r=this.startNode(),i=!1;r.body=[],this.expect(S.braceL);while(this.type!==S.braceR){var o=this.parseClassElement(null!==t.superClass);o&&(r.body.push(o),"MethodDefinition"===o.type&&"constructor"===o.kind&&(i&&this.raise(o.start,"Duplicate constructor in the same class"),i=!0))}return this.strict=n,this.next(),t.body=this.finishNode(r,"ClassBody"),this.finishNode(t,e?"ClassDeclaration":"ClassExpression")},ct.parseClassElement=function(t){var e=this;if(this.eat(S.semi))return null;var n=this.startNode(),r=function(t,r){void 0===r&&(r=!1);var i=e.start,o=e.startLoc;return!!e.eatContextual(t)&&(!(e.type===S.parenL||r&&e.canInsertSemicolon())||(n.key&&e.unexpected(),n.computed=!1,n.key=e.startNodeAt(i,o),n.key.name=t,e.finishNode(n.key,"Identifier"),!1))};n.kind="method",n.static=r("static");var i=this.eat(S.star),o=!1;i||(this.options.ecmaVersion>=8&&r("async",!0)?(o=!0,i=this.options.ecmaVersion>=9&&this.eat(S.star)):r("get")?n.kind="get":r("set")&&(n.kind="set")),n.key||this.parsePropertyName(n);var a=n.key,s=!1;return n.computed||n.static||!("Identifier"===a.type&&"constructor"===a.name||"Literal"===a.type&&"constructor"===a.value)?n.static&&"Identifier"===a.type&&"prototype"===a.name&&this.raise(a.start,"Classes may not have a static property named prototype"):("method"!==n.kind&&this.raise(a.start,"Constructor can't have get/set modifier"),i&&this.raise(a.start,"Constructor can't be a generator"),o&&this.raise(a.start,"Constructor can't be an async method"),n.kind="constructor",s=t),this.parseClassMethod(n,i,o,s),"get"===n.kind&&0!==n.value.params.length&&this.raiseRecoverable(n.value.start,"getter should have no params"),"set"===n.kind&&1!==n.value.params.length&&this.raiseRecoverable(n.value.start,"setter should have exactly one param"),"set"===n.kind&&"RestElement"===n.value.params[0].type&&this.raiseRecoverable(n.value.params[0].start,"Setter cannot use rest params"),n},ct.parseClassMethod=function(t,e,n,r){return t.value=this.parseMethod(e,n,r),this.finishNode(t,"MethodDefinition")},ct.parseClassId=function(t,e){this.type===S.name?(t.id=this.parseIdent(),e&&this.checkLVal(t.id,tt,!1)):(!0===e&&this.unexpected(),t.id=null)},ct.parseClassSuper=function(t){t.superClass=this.eat(S._extends)?this.parseExprSubscripts():null},ct.parseExport=function(t,e){if(this.next(),this.eat(S.star))return this.options.ecmaVersion>=11&&(this.eatContextual("as")?(t.exported=this.parseIdent(!0),this.checkExport(e,t.exported.name,this.lastTokStart)):t.exported=null),this.expectContextual("from"),this.type!==S.string&&this.unexpected(),t.source=this.parseExprAtom(),this.semicolon(),this.finishNode(t,"ExportAllDeclaration");if(this.eat(S._default)){var n;if(this.checkExport(e,"default",this.lastTokStart),this.type===S._function||(n=this.isAsyncFunction())){var r=this.startNode();this.next(),n&&this.next(),t.declaration=this.parseFunction(r,pt|vt,!1,n)}else if(this.type===S._class){var i=this.startNode();t.declaration=this.parseClass(i,"nullableID")}else t.declaration=this.parseMaybeAssign(),this.semicolon();return this.finishNode(t,"ExportDefaultDeclaration")}if(this.shouldParseExportStatement())t.declaration=this.parseStatement(null),"VariableDeclaration"===t.declaration.type?this.checkVariableExport(e,t.declaration.declarations):this.checkExport(e,t.declaration.id.name,t.declaration.id.start),t.specifiers=[],t.source=null;else{if(t.declaration=null,t.specifiers=this.parseExportSpecifiers(e),this.eatContextual("from"))this.type!==S.string&&this.unexpected(),t.source=this.parseExprAtom();else{for(var o=0,a=t.specifiers;o<a.length;o+=1){var s=a[o];this.checkUnreserved(s.local),this.checkLocalExport(s.local)}t.source=null}this.semicolon()}return this.finishNode(t,"ExportNamedDeclaration")},ct.checkExport=function(t,e,n){t&&(L(t,e)&&this.raiseRecoverable(n,"Duplicate export '"+e+"'"),t[e]=!0)},ct.checkPatternExport=function(t,e){var n=e.type;if("Identifier"===n)this.checkExport(t,e.name,e.start);else if("ObjectPattern"===n)for(var r=0,i=e.properties;r<i.length;r+=1){var o=i[r];this.checkPatternExport(t,o)}else if("ArrayPattern"===n)for(var a=0,s=e.elements;a<s.length;a+=1){var u=s[a];u&&this.checkPatternExport(t,u)}else"Property"===n?this.checkPatternExport(t,e.value):"AssignmentPattern"===n?this.checkPatternExport(t,e.left):"RestElement"===n?this.checkPatternExport(t,e.argument):"ParenthesizedExpression"===n&&this.checkPatternExport(t,e.expression)},ct.checkVariableExport=function(t,e){if(t)for(var n=0,r=e;n<r.length;n+=1){var i=r[n];this.checkPatternExport(t,i.id)}},ct.shouldParseExportStatement=function(){return"var"===this.type.keyword||"const"===this.type.keyword||"class"===this.type.keyword||"function"===this.type.keyword||this.isLet()||this.isAsyncFunction()},ct.parseExportSpecifiers=function(t){var e=[],n=!0;this.expect(S.braceL);while(!this.eat(S.braceR)){if(n)n=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;var r=this.startNode();r.local=this.parseIdent(!0),r.exported=this.eatContextual("as")?this.parseIdent(!0):r.local,this.checkExport(t,r.exported.name,r.exported.start),e.push(this.finishNode(r,"ExportSpecifier"))}return e},ct.parseImport=function(t){return this.next(),this.type===S.string?(t.specifiers=ft,t.source=this.parseExprAtom()):(t.specifiers=this.parseImportSpecifiers(),this.expectContextual("from"),t.source=this.type===S.string?this.parseExprAtom():this.unexpected()),this.semicolon(),this.finishNode(t,"ImportDeclaration")},ct.parseImportSpecifiers=function(){var t=[],e=!0;if(this.type===S.name){var n=this.startNode();if(n.local=this.parseIdent(),this.checkLVal(n.local,tt),t.push(this.finishNode(n,"ImportDefaultSpecifier")),!this.eat(S.comma))return t}if(this.type===S.star){var r=this.startNode();return this.next(),this.expectContextual("as"),r.local=this.parseIdent(),this.checkLVal(r.local,tt),t.push(this.finishNode(r,"ImportNamespaceSpecifier")),t}this.expect(S.braceL);while(!this.eat(S.braceR)){if(e)e=!1;else if(this.expect(S.comma),this.afterTrailingComma(S.braceR))break;var i=this.startNode();i.imported=this.parseIdent(!0),this.eatContextual("as")?i.local=this.parseIdent():(this.checkUnreserved(i.imported),i.local=i.imported),this.checkLVal(i.local,tt),t.push(this.finishNode(i,"ImportSpecifier"))}return t},ct.adaptDirectivePrologue=function(t){for(var e=0;e<t.length&&this.isDirectiveCandidate(t[e]);++e)t[e].directive=t[e].expression.raw.slice(1,-1)},ct.isDirectiveCandidate=function(t){return"ExpressionStatement"===t.type&&"Literal"===t.expression.type&&"string"===typeof t.expression.value&&('"'===this.input[t.start]||"'"===this.input[t.start])};var mt=it.prototype;mt.toAssignable=function(t,e,n){if(this.options.ecmaVersion>=6&&t)switch(t.type){case"Identifier":this.inAsync&&"await"===t.name&&this.raise(t.start,"Cannot use 'await' as identifier inside an async function");break;case"ObjectPattern":case"ArrayPattern":case"RestElement":break;case"ObjectExpression":t.type="ObjectPattern",n&&this.checkPatternErrors(n,!0);for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.toAssignable(o,e),"RestElement"!==o.type||"ArrayPattern"!==o.argument.type&&"ObjectPattern"!==o.argument.type||this.raise(o.argument.start,"Unexpected token")}break;case"Property":"init"!==t.kind&&this.raise(t.key.start,"Object pattern can't contain getter or setter"),this.toAssignable(t.value,e);break;case"ArrayExpression":t.type="ArrayPattern",n&&this.checkPatternErrors(n,!0),this.toAssignableList(t.elements,e);break;case"SpreadElement":t.type="RestElement",this.toAssignable(t.argument,e),"AssignmentPattern"===t.argument.type&&this.raise(t.argument.start,"Rest elements cannot have a default value");break;case"AssignmentExpression":"="!==t.operator&&this.raise(t.left.end,"Only '=' operator can be used for specifying default value."),t.type="AssignmentPattern",delete t.operator,this.toAssignable(t.left,e);case"AssignmentPattern":break;case"ParenthesizedExpression":this.toAssignable(t.expression,e,n);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":if(!e)break;default:this.raise(t.start,"Assigning to rvalue")}else n&&this.checkPatternErrors(n,!0);return t},mt.toAssignableList=function(t,e){for(var n=t.length,r=0;r<n;r++){var i=t[r];i&&this.toAssignable(i,e)}if(n){var o=t[n-1];6===this.options.ecmaVersion&&e&&o&&"RestElement"===o.type&&"Identifier"!==o.argument.type&&this.unexpected(o.argument.start)}return t},mt.parseSpread=function(t){var e=this.startNode();return this.next(),e.argument=this.parseMaybeAssign(!1,t),this.finishNode(e,"SpreadElement")},mt.parseRestBinding=function(){var t=this.startNode();return this.next(),6===this.options.ecmaVersion&&this.type!==S.name&&this.unexpected(),t.argument=this.parseBindingAtom(),this.finishNode(t,"RestElement")},mt.parseBindingAtom=function(){if(this.options.ecmaVersion>=6)switch(this.type){case S.bracketL:var t=this.startNode();return this.next(),t.elements=this.parseBindingList(S.bracketR,!0,!0),this.finishNode(t,"ArrayPattern");case S.braceL:return this.parseObj(!0)}return this.parseIdent()},mt.parseBindingList=function(t,e,n){var r=[],i=!0;while(!this.eat(t))if(i?i=!1:this.expect(S.comma),e&&this.type===S.comma)r.push(null);else{if(n&&this.afterTrailingComma(t))break;if(this.type===S.ellipsis){var o=this.parseRestBinding();this.parseBindingListItem(o),r.push(o),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.expect(t);break}var a=this.parseMaybeDefault(this.start,this.startLoc);this.parseBindingListItem(a),r.push(a)}return r},mt.parseBindingListItem=function(t){return t},mt.parseMaybeDefault=function(t,e,n){if(n=n||this.parseBindingAtom(),this.options.ecmaVersion<6||!this.eat(S.eq))return n;var r=this.startNodeAt(t,e);return r.left=n,r.right=this.parseMaybeAssign(),this.finishNode(r,"AssignmentPattern")},mt.checkLVal=function(t,e,n){switch(void 0===e&&(e=J),t.type){case"Identifier":e===tt&&"let"===t.name&&this.raiseRecoverable(t.start,"let is disallowed as a lexically bound name"),this.strict&&this.reservedWordsStrictBind.test(t.name)&&this.raiseRecoverable(t.start,(e?"Binding ":"Assigning to ")+t.name+" in strict mode"),n&&(L(n,t.name)&&this.raiseRecoverable(t.start,"Argument name clash"),n[t.name]=!0),e!==J&&e!==rt&&this.declareName(t.name,e,t.start);break;case"ChainExpression":this.raiseRecoverable(t.start,"Optional chaining cannot appear in left-hand side");break;case"MemberExpression":e&&this.raiseRecoverable(t.start,"Binding member expression");break;case"ObjectPattern":for(var r=0,i=t.properties;r<i.length;r+=1){var o=i[r];this.checkLVal(o,e,n)}break;case"Property":this.checkLVal(t.value,e,n);break;case"ArrayPattern":for(var a=0,s=t.elements;a<s.length;a+=1){var u=s[a];u&&this.checkLVal(u,e,n)}break;case"AssignmentPattern":this.checkLVal(t.left,e,n);break;case"RestElement":this.checkLVal(t.argument,e,n);break;case"ParenthesizedExpression":this.checkLVal(t.expression,e,n);break;default:this.raise(t.start,(e?"Binding":"Assigning to")+" rvalue")}};var gt=it.prototype;gt.checkPropClash=function(t,e,n){if(!(this.options.ecmaVersion>=9&&"SpreadElement"===t.type)&&!(this.options.ecmaVersion>=6&&(t.computed||t.method||t.shorthand))){var r,i=t.key;switch(i.type){case"Identifier":r=i.name;break;case"Literal":r=String(i.value);break;default:return}var o=t.kind;if(this.options.ecmaVersion>=6)"__proto__"===r&&"init"===o&&(e.proto&&(n?n.doubleProto<0&&(n.doubleProto=i.start):this.raiseRecoverable(i.start,"Redefinition of __proto__ property")),e.proto=!0);else{r="$"+r;var a,s=e[r];if(s)a="init"===o?this.strict&&s.init||s.get||s.set:s.init||s[o],a&&this.raiseRecoverable(i.start,"Redefinition of property");else s=e[r]={init:!1,get:!1,set:!1};s[o]=!0}}},gt.parseExpression=function(t,e){var n=this.start,r=this.startLoc,i=this.parseMaybeAssign(t,e);if(this.type===S.comma){var o=this.startNodeAt(n,r);o.expressions=[i];while(this.eat(S.comma))o.expressions.push(this.parseMaybeAssign(t,e));return this.finishNode(o,"SequenceExpression")}return i},gt.parseMaybeAssign=function(t,e,n){if(this.isContextual("yield")){if(this.inGenerator)return this.parseYield(t);this.exprAllowed=!1}var r=!1,i=-1,o=-1;e?(i=e.parenthesizedAssign,o=e.trailingComma,e.parenthesizedAssign=e.trailingComma=-1):(e=new ut,r=!0);var a=this.start,s=this.startLoc;this.type!==S.parenL&&this.type!==S.name||(this.potentialArrowAt=this.start);var u=this.parseMaybeConditional(t,e);if(n&&(u=n.call(this,u,a,s)),this.type.isAssign){var c=this.startNodeAt(a,s);return c.operator=this.value,c.left=this.type===S.eq?this.toAssignable(u,!1,e):u,r||(e.parenthesizedAssign=e.trailingComma=e.doubleProto=-1),e.shorthandAssign>=c.left.start&&(e.shorthandAssign=-1),this.checkLVal(u),this.next(),c.right=this.parseMaybeAssign(t),this.finishNode(c,"AssignmentExpression")}return r&&this.checkExpressionErrors(e,!0),i>-1&&(e.parenthesizedAssign=i),o>-1&&(e.trailingComma=o),u},gt.parseMaybeConditional=function(t,e){var n=this.start,r=this.startLoc,i=this.parseExprOps(t,e);if(this.checkExpressionErrors(e))return i;if(this.eat(S.question)){var o=this.startNodeAt(n,r);return o.test=i,o.consequent=this.parseMaybeAssign(),this.expect(S.colon),o.alternate=this.parseMaybeAssign(t),this.finishNode(o,"ConditionalExpression")}return i},gt.parseExprOps=function(t,e){var n=this.start,r=this.startLoc,i=this.parseMaybeUnary(e,!1);return this.checkExpressionErrors(e)||i.start===n&&"ArrowFunctionExpression"===i.type?i:this.parseExprOp(i,n,r,-1,t)},gt.parseExprOp=function(t,e,n,r,i){var o=this.type.binop;if(null!=o&&(!i||this.type!==S._in)&&o>r){var a=this.type===S.logicalOR||this.type===S.logicalAND,s=this.type===S.coalesce;s&&(o=S.logicalAND.binop);var u=this.value;this.next();var c=this.start,l=this.startLoc,h=this.parseExprOp(this.parseMaybeUnary(null,!1),c,l,o,i),f=this.buildBinary(e,n,t,h,u,a||s);return(a&&this.type===S.coalesce||s&&(this.type===S.logicalOR||this.type===S.logicalAND))&&this.raiseRecoverable(this.start,"Logical expressions and coalesce expressions cannot be mixed. Wrap either by parentheses"),this.parseExprOp(f,e,n,r,i)}return t},gt.buildBinary=function(t,e,n,r,i,o){var a=this.startNodeAt(t,e);return a.left=n,a.operator=i,a.right=r,this.finishNode(a,o?"LogicalExpression":"BinaryExpression")},gt.parseMaybeUnary=function(t,e){var n,r=this.start,i=this.startLoc;if(this.isContextual("await")&&(this.inAsync||!this.inFunction&&this.options.allowAwaitOutsideFunction))n=this.parseAwait(),e=!0;else if(this.type.prefix){var o=this.startNode(),a=this.type===S.incDec;o.operator=this.value,o.prefix=!0,this.next(),o.argument=this.parseMaybeUnary(null,!0),this.checkExpressionErrors(t,!0),a?this.checkLVal(o.argument):this.strict&&"delete"===o.operator&&"Identifier"===o.argument.type?this.raiseRecoverable(o.start,"Deleting local variable in strict mode"):e=!0,n=this.finishNode(o,a?"UpdateExpression":"UnaryExpression")}else{if(n=this.parseExprSubscripts(t),this.checkExpressionErrors(t))return n;while(this.type.postfix&&!this.canInsertSemicolon()){var s=this.startNodeAt(r,i);s.operator=this.value,s.prefix=!1,s.argument=n,this.checkLVal(n),this.next(),n=this.finishNode(s,"UpdateExpression")}}return!e&&this.eat(S.starstar)?this.buildBinary(r,i,n,this.parseMaybeUnary(null,!1),"**",!1):n},gt.parseExprSubscripts=function(t){var e=this.start,n=this.startLoc,r=this.parseExprAtom(t);if("ArrowFunctionExpression"===r.type&&")"!==this.input.slice(this.lastTokStart,this.lastTokEnd))return r;var i=this.parseSubscripts(r,e,n);return t&&"MemberExpression"===i.type&&(t.parenthesizedAssign>=i.start&&(t.parenthesizedAssign=-1),t.parenthesizedBind>=i.start&&(t.parenthesizedBind=-1)),i},gt.parseSubscripts=function(t,e,n,r){var i=this.options.ecmaVersion>=8&&"Identifier"===t.type&&"async"===t.name&&this.lastTokEnd===t.end&&!this.canInsertSemicolon()&&t.end-t.start===5&&this.potentialArrowAt===t.start,o=!1;while(1){var a=this.parseSubscript(t,e,n,r,i,o);if(a.optional&&(o=!0),a===t||"ArrowFunctionExpression"===a.type){if(o){var s=this.startNodeAt(e,n);s.expression=a,a=this.finishNode(s,"ChainExpression")}return a}t=a}},gt.parseSubscript=function(t,e,n,r,i,o){var a=this.options.ecmaVersion>=11,s=a&&this.eat(S.questionDot);r&&s&&this.raise(this.lastTokStart,"Optional chaining cannot appear in the callee of new expressions");var u=this.eat(S.bracketL);if(u||s&&this.type!==S.parenL&&this.type!==S.backQuote||this.eat(S.dot)){var c=this.startNodeAt(e,n);c.object=t,c.property=u?this.parseExpression():this.parseIdent("never"!==this.options.allowReserved),c.computed=!!u,u&&this.expect(S.bracketR),a&&(c.optional=s),t=this.finishNode(c,"MemberExpression")}else if(!r&&this.eat(S.parenL)){var l=new ut,h=this.yieldPos,f=this.awaitPos,p=this.awaitIdentPos;this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0;var d=this.parseExprList(S.parenR,this.options.ecmaVersion>=8,!1,l);if(i&&!s&&!this.canInsertSemicolon()&&this.eat(S.arrow))return this.checkPatternErrors(l,!1),this.checkYieldAwaitInDefaultParams(),this.awaitIdentPos>0&&this.raise(this.awaitIdentPos,"Cannot use 'await' as identifier inside an async function"),this.yieldPos=h,this.awaitPos=f,this.awaitIdentPos=p,this.parseArrowExpression(this.startNodeAt(e,n),d,!0);this.checkExpressionErrors(l,!0),this.yieldPos=h||this.yieldPos,this.awaitPos=f||this.awaitPos,this.awaitIdentPos=p||this.awaitIdentPos;var v=this.startNodeAt(e,n);v.callee=t,v.arguments=d,a&&(v.optional=s),t=this.finishNode(v,"CallExpression")}else if(this.type===S.backQuote){(s||o)&&this.raise(this.start,"Optional chaining cannot appear in the tag of tagged template expressions");var m=this.startNodeAt(e,n);m.tag=t,m.quasi=this.parseTemplate({isTagged:!0}),t=this.finishNode(m,"TaggedTemplateExpression")}return t},gt.parseExprAtom=function(t){this.type===S.slash&&this.readRegexp();var e,n=this.potentialArrowAt===this.start;switch(this.type){case S._super:return this.allowSuper||this.raise(this.start,"'super' keyword outside a method"),e=this.startNode(),this.next(),this.type!==S.parenL||this.allowDirectSuper||this.raise(e.start,"super() call outside constructor of a subclass"),this.type!==S.dot&&this.type!==S.bracketL&&this.type!==S.parenL&&this.unexpected(),this.finishNode(e,"Super");case S._this:return e=this.startNode(),this.next(),this.finishNode(e,"ThisExpression");case S.name:var r=this.start,i=this.startLoc,o=this.containsEsc,a=this.parseIdent(!1);if(this.options.ecmaVersion>=8&&!o&&"async"===a.name&&!this.canInsertSemicolon()&&this.eat(S._function))return this.parseFunction(this.startNodeAt(r,i),0,!1,!0);if(n&&!this.canInsertSemicolon()){if(this.eat(S.arrow))return this.parseArrowExpression(this.startNodeAt(r,i),[a],!1);if(this.options.ecmaVersion>=8&&"async"===a.name&&this.type===S.name&&!o)return a=this.parseIdent(!1),!this.canInsertSemicolon()&&this.eat(S.arrow)||this.unexpected(),this.parseArrowExpression(this.startNodeAt(r,i),[a],!0)}return a;case S.regexp:var s=this.value;return e=this.parseLiteral(s.value),e.regex={pattern:s.pattern,flags:s.flags},e;case S.num:case S.string:return this.parseLiteral(this.value);case S._null:case S._true:case S._false:return e=this.startNode(),e.value=this.type===S._null?null:this.type===S._true,e.raw=this.type.keyword,this.next(),this.finishNode(e,"Literal");case S.parenL:var u=this.start,c=this.parseParenAndDistinguishExpression(n);return t&&(t.parenthesizedAssign<0&&!this.isSimpleAssignTarget(c)&&(t.parenthesizedAssign=u),t.parenthesizedBind<0&&(t.parenthesizedBind=u)),c;case S.bracketL:return e=this.startNode(),this.next(),e.elements=this.parseExprList(S.bracketR,!0,!0,t),this.finishNode(e,"ArrayExpression");case S.braceL:return this.parseObj(!1,t);case S._function:return e=this.startNode(),this.next(),this.parseFunction(e,0);case S._class:return this.parseClass(this.startNode(),!1);case S._new:return this.parseNew();case S.backQuote:return this.parseTemplate();case S._import:return this.options.ecmaVersion>=11?this.parseExprImport():this.unexpected();default:this.unexpected()}},gt.parseExprImport=function(){var t=this.startNode();this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword import");var e=this.parseIdent(!0);switch(this.type){case S.parenL:return this.parseDynamicImport(t);case S.dot:return t.meta=e,this.parseImportMeta(t);default:this.unexpected()}},gt.parseDynamicImport=function(t){if(this.next(),t.source=this.parseMaybeAssign(),!this.eat(S.parenR)){var e=this.start;this.eat(S.comma)&&this.eat(S.parenR)?this.raiseRecoverable(e,"Trailing comma is not allowed in import()"):this.unexpected(e)}return this.finishNode(t,"ImportExpression")},gt.parseImportMeta=function(t){this.next();var e=this.containsEsc;return t.property=this.parseIdent(!0),"meta"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for import is 'import.meta'"),e&&this.raiseRecoverable(t.start,"'import.meta' must not contain escaped characters"),"module"!==this.options.sourceType&&this.raiseRecoverable(t.start,"Cannot use 'import.meta' outside a module"),this.finishNode(t,"MetaProperty")},gt.parseLiteral=function(t){var e=this.startNode();return e.value=t,e.raw=this.input.slice(this.start,this.end),110===e.raw.charCodeAt(e.raw.length-1)&&(e.bigint=e.raw.slice(0,-1).replace(/_/g,"")),this.next(),this.finishNode(e,"Literal")},gt.parseParenExpression=function(){this.expect(S.parenL);var t=this.parseExpression();return this.expect(S.parenR),t},gt.parseParenAndDistinguishExpression=function(t){var e,n=this.start,r=this.startLoc,i=this.options.ecmaVersion>=8;if(this.options.ecmaVersion>=6){this.next();var o,a=this.start,s=this.startLoc,u=[],c=!0,l=!1,h=new ut,f=this.yieldPos,p=this.awaitPos;this.yieldPos=0,this.awaitPos=0;while(this.type!==S.parenR){if(c?c=!1:this.expect(S.comma),i&&this.afterTrailingComma(S.parenR,!0)){l=!0;break}if(this.type===S.ellipsis){o=this.start,u.push(this.parseParenItem(this.parseRestBinding())),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element");break}u.push(this.parseMaybeAssign(!1,h,this.parseParenItem))}var d=this.start,v=this.startLoc;if(this.expect(S.parenR),t&&!this.canInsertSemicolon()&&this.eat(S.arrow))return this.checkPatternErrors(h,!1),this.checkYieldAwaitInDefaultParams(),this.yieldPos=f,this.awaitPos=p,this.parseParenArrowList(n,r,u);u.length&&!l||this.unexpected(this.lastTokStart),o&&this.unexpected(o),this.checkExpressionErrors(h,!0),this.yieldPos=f||this.yieldPos,this.awaitPos=p||this.awaitPos,u.length>1?(e=this.startNodeAt(a,s),e.expressions=u,this.finishNodeAt(e,"SequenceExpression",d,v)):e=u[0]}else e=this.parseParenExpression();if(this.options.preserveParens){var m=this.startNodeAt(n,r);return m.expression=e,this.finishNode(m,"ParenthesizedExpression")}return e},gt.parseParenItem=function(t){return t},gt.parseParenArrowList=function(t,e,n){return this.parseArrowExpression(this.startNodeAt(t,e),n)};var yt=[];gt.parseNew=function(){this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword new");var t=this.startNode(),e=this.parseIdent(!0);if(this.options.ecmaVersion>=6&&this.eat(S.dot)){t.meta=e;var n=this.containsEsc;return t.property=this.parseIdent(!0),"target"!==t.property.name&&this.raiseRecoverable(t.property.start,"The only valid meta property for new is 'new.target'"),n&&this.raiseRecoverable(t.start,"'new.target' must not contain escaped characters"),this.inNonArrowFunction()||this.raiseRecoverable(t.start,"'new.target' can only be used in functions"),this.finishNode(t,"MetaProperty")}var r=this.start,i=this.startLoc,o=this.type===S._import;return t.callee=this.parseSubscripts(this.parseExprAtom(),r,i,!0),o&&"ImportExpression"===t.callee.type&&this.raise(r,"Cannot use new with import()"),this.eat(S.parenL)?t.arguments=this.parseExprList(S.parenR,this.options.ecmaVersion>=8,!1):t.arguments=yt,this.finishNode(t,"NewExpression")},gt.parseTemplateElement=function(t){var e=t.isTagged,n=this.startNode();return this.type===S.invalidTemplate?(e||this.raiseRecoverable(this.start,"Bad escape sequence in untagged template literal"),n.value={raw:this.value,cooked:null}):n.value={raw:this.input.slice(this.start,this.end).replace(/\r\n?/g,"\n"),cooked:this.value},this.next(),n.tail=this.type===S.backQuote,this.finishNode(n,"TemplateElement")},gt.parseTemplate=function(t){void 0===t&&(t={});var e=t.isTagged;void 0===e&&(e=!1);var n=this.startNode();this.next(),n.expressions=[];var r=this.parseTemplateElement({isTagged:e});n.quasis=[r];while(!r.tail)this.type===S.eof&&this.raise(this.pos,"Unterminated template literal"),this.expect(S.dollarBraceL),n.expressions.push(this.parseExpression()),this.expect(S.braceR),n.quasis.push(r=this.parseTemplateElement({isTagged:e}));return this.next(),this.finishNode(n,"TemplateLiteral")},gt.isAsyncProp=function(t){return!t.computed&&"Identifier"===t.key.type&&"async"===t.key.name&&(this.type===S.name||this.type===S.num||this.type===S.string||this.type===S.bracketL||this.type.keyword||this.options.ecmaVersion>=9&&this.type===S.star)&&!A.test(this.input.slice(this.lastTokEnd,this.start))},gt.parseObj=function(t,e){var n=this.startNode(),r=!0,i={};n.properties=[],this.next();while(!this.eat(S.braceR)){if(r)r=!1;else if(this.expect(S.comma),this.options.ecmaVersion>=5&&this.afterTrailingComma(S.braceR))break;var o=this.parseProperty(t,e);t||this.checkPropClash(o,i,e),n.properties.push(o)}return this.finishNode(n,t?"ObjectPattern":"ObjectExpression")},gt.parseProperty=function(t,e){var n,r,i,o,a=this.startNode();if(this.options.ecmaVersion>=9&&this.eat(S.ellipsis))return t?(a.argument=this.parseIdent(!1),this.type===S.comma&&this.raise(this.start,"Comma is not permitted after the rest element"),this.finishNode(a,"RestElement")):(this.type===S.parenL&&e&&(e.parenthesizedAssign<0&&(e.parenthesizedAssign=this.start),e.parenthesizedBind<0&&(e.parenthesizedBind=this.start)),a.argument=this.parseMaybeAssign(!1,e),this.type===S.comma&&e&&e.trailingComma<0&&(e.trailingComma=this.start),this.finishNode(a,"SpreadElement"));this.options.ecmaVersion>=6&&(a.method=!1,a.shorthand=!1,(t||e)&&(i=this.start,o=this.startLoc),t||(n=this.eat(S.star)));var s=this.containsEsc;return this.parsePropertyName(a),!t&&!s&&this.options.ecmaVersion>=8&&!n&&this.isAsyncProp(a)?(r=!0,n=this.options.ecmaVersion>=9&&this.eat(S.star),this.parsePropertyName(a,e)):r=!1,this.parsePropertyValue(a,t,n,r,i,o,e,s),this.finishNode(a,"Property")},gt.parsePropertyValue=function(t,e,n,r,i,o,a,s){if((n||r)&&this.type===S.colon&&this.unexpected(),this.eat(S.colon))t.value=e?this.parseMaybeDefault(this.start,this.startLoc):this.parseMaybeAssign(!1,a),t.kind="init";else if(this.options.ecmaVersion>=6&&this.type===S.parenL)e&&this.unexpected(),t.kind="init",t.method=!0,t.value=this.parseMethod(n,r);else if(e||s||!(this.options.ecmaVersion>=5)||t.computed||"Identifier"!==t.key.type||"get"!==t.key.name&&"set"!==t.key.name||this.type===S.comma||this.type===S.braceR||this.type===S.eq)this.options.ecmaVersion>=6&&!t.computed&&"Identifier"===t.key.type?((n||r)&&this.unexpected(),this.checkUnreserved(t.key),"await"!==t.key.name||this.awaitIdentPos||(this.awaitIdentPos=i),t.kind="init",e?t.value=this.parseMaybeDefault(i,o,t.key):this.type===S.eq&&a?(a.shorthandAssign<0&&(a.shorthandAssign=this.start),t.value=this.parseMaybeDefault(i,o,t.key)):t.value=t.key,t.shorthand=!0):this.unexpected();else{(n||r)&&this.unexpected(),t.kind=t.key.name,this.parsePropertyName(t),t.value=this.parseMethod(!1);var u="get"===t.kind?0:1;if(t.value.params.length!==u){var c=t.value.start;"get"===t.kind?this.raiseRecoverable(c,"getter should have no params"):this.raiseRecoverable(c,"setter should have exactly one param")}else"set"===t.kind&&"RestElement"===t.value.params[0].type&&this.raiseRecoverable(t.value.params[0].start,"Setter cannot use rest params")}},gt.parsePropertyName=function(t){if(this.options.ecmaVersion>=6){if(this.eat(S.bracketL))return t.computed=!0,t.key=this.parseMaybeAssign(),this.expect(S.bracketR),t.key;t.computed=!1}return t.key=this.type===S.num||this.type===S.string?this.parseExprAtom():this.parseIdent("never"!==this.options.allowReserved)},gt.initFunction=function(t){t.id=null,this.options.ecmaVersion>=6&&(t.generator=t.expression=!1),this.options.ecmaVersion>=8&&(t.async=!1)},gt.parseMethod=function(t,e,n){var r=this.startNode(),i=this.yieldPos,o=this.awaitPos,a=this.awaitIdentPos;return this.initFunction(r),this.options.ecmaVersion>=6&&(r.generator=t),this.options.ecmaVersion>=8&&(r.async=!!e),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,this.enterScope(Q(e,r.generator)|Y|(n?K:0)),this.expect(S.parenL),r.params=this.parseBindingList(S.parenR,!1,this.options.ecmaVersion>=8),this.checkYieldAwaitInDefaultParams(),this.parseFunctionBody(r,!1,!0),this.yieldPos=i,this.awaitPos=o,this.awaitIdentPos=a,this.finishNode(r,"FunctionExpression")},gt.parseArrowExpression=function(t,e,n){var r=this.yieldPos,i=this.awaitPos,o=this.awaitIdentPos;return this.enterScope(Q(n,!1)|q),this.initFunction(t),this.options.ecmaVersion>=8&&(t.async=!!n),this.yieldPos=0,this.awaitPos=0,this.awaitIdentPos=0,t.params=this.toAssignableList(e,!0),this.parseFunctionBody(t,!0,!1),this.yieldPos=r,this.awaitPos=i,this.awaitIdentPos=o,this.finishNode(t,"ArrowFunctionExpression")},gt.parseFunctionBody=function(t,e,n){var r=e&&this.type!==S.braceL,i=this.strict,o=!1;if(r)t.body=this.parseMaybeAssign(),t.expression=!0,this.checkParams(t,!1);else{var a=this.options.ecmaVersion>=7&&!this.isSimpleParamList(t.params);i&&!a||(o=this.strictDirective(this.end),o&&a&&this.raiseRecoverable(t.start,"Illegal 'use strict' directive in function with non-simple parameter list"));var s=this.labels;this.labels=[],o&&(this.strict=!0),this.checkParams(t,!i&&!o&&!e&&!n&&this.isSimpleParamList(t.params)),this.strict&&t.id&&this.checkLVal(t.id,rt),t.body=this.parseBlock(!1,void 0,o&&!i),t.expression=!1,this.adaptDirectivePrologue(t.body.body),this.labels=s}this.exitScope()},gt.isSimpleParamList=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if("Identifier"!==r.type)return!1}return!0},gt.checkParams=function(t,e){for(var n={},r=0,i=t.params;r<i.length;r+=1){var o=i[r];this.checkLVal(o,$,e?null:n)}},gt.parseExprList=function(t,e,n,r){var i=[],o=!0;while(!this.eat(t)){if(o)o=!1;else if(this.expect(S.comma),e&&this.afterTrailingComma(t))break;var a=void 0;n&&this.type===S.comma?a=null:this.type===S.ellipsis?(a=this.parseSpread(r),r&&this.type===S.comma&&r.trailingComma<0&&(r.trailingComma=this.start)):a=this.parseMaybeAssign(!1,r),i.push(a)}return i},gt.checkUnreserved=function(t){var e=t.start,n=t.end,r=t.name;if(this.inGenerator&&"yield"===r&&this.raiseRecoverable(e,"Cannot use 'yield' as identifier inside a generator"),this.inAsync&&"await"===r&&this.raiseRecoverable(e,"Cannot use 'await' as identifier inside an async function"),this.keywords.test(r)&&this.raise(e,"Unexpected keyword '"+r+"'"),!(this.options.ecmaVersion<6&&-1!==this.input.slice(e,n).indexOf("\\"))){var i=this.strict?this.reservedWordsStrict:this.reservedWords;i.test(r)&&(this.inAsync||"await"!==r||this.raiseRecoverable(e,"Cannot use keyword 'await' outside an async function"),this.raiseRecoverable(e,"The keyword '"+r+"' is reserved"))}},gt.parseIdent=function(t,e){var n=this.startNode();return this.type===S.name?n.name=this.value:this.type.keyword?(n.name=this.type.keyword,"class"!==n.name&&"function"!==n.name||this.lastTokEnd===this.lastTokStart+1&&46===this.input.charCodeAt(this.lastTokStart)||this.context.pop()):this.unexpected(),this.next(!!t),this.finishNode(n,"Identifier"),t||(this.checkUnreserved(n),"await"!==n.name||this.awaitIdentPos||(this.awaitIdentPos=n.start)),n},gt.parseYield=function(t){this.yieldPos||(this.yieldPos=this.start);var e=this.startNode();return this.next(),this.type===S.semi||this.canInsertSemicolon()||this.type!==S.star&&!this.type.startsExpr?(e.delegate=!1,e.argument=null):(e.delegate=this.eat(S.star),e.argument=this.parseMaybeAssign(t)),this.finishNode(e,"YieldExpression")},gt.parseAwait=function(){this.awaitPos||(this.awaitPos=this.start);var t=this.startNode();return this.next(),t.argument=this.parseMaybeUnary(null,!1),this.finishNode(t,"AwaitExpression")};var _t=it.prototype;_t.raise=function(t,e){var n=F(this.input,t);e+=" ("+n.line+":"+n.column+")";var r=new SyntaxError(e);throw r.pos=t,r.loc=n,r.raisedAt=this.pos,r},_t.raiseRecoverable=_t.raise,_t.curPosition=function(){if(this.options.locations)return new N(this.curLine,this.pos-this.lineStart)};var xt=it.prototype,bt=function(t){this.flags=t,this.var=[],this.lexical=[],this.functions=[]};xt.enterScope=function(t){this.scopeStack.push(new bt(t))},xt.exitScope=function(){this.scopeStack.pop()},xt.treatFunctionsAsVarInScope=function(t){return t.flags&V||!this.inModule&&t.flags&Z},xt.declareName=function(t,e,n){var r=!1;if(e===tt){var i=this.currentScope();r=i.lexical.indexOf(t)>-1||i.functions.indexOf(t)>-1||i.var.indexOf(t)>-1,i.lexical.push(t),this.inModule&&i.flags&Z&&delete this.undefinedExports[t]}else if(e===nt){var o=this.currentScope();o.lexical.push(t)}else if(e===et){var a=this.currentScope();r=this.treatFunctionsAsVar?a.lexical.indexOf(t)>-1:a.lexical.indexOf(t)>-1||a.var.indexOf(t)>-1,a.functions.push(t)}else for(var s=this.scopeStack.length-1;s>=0;--s){var u=this.scopeStack[s];if(u.lexical.indexOf(t)>-1&&!(u.flags&X&&u.lexical[0]===t)||!this.treatFunctionsAsVarInScope(u)&&u.functions.indexOf(t)>-1){r=!0;break}if(u.var.push(t),this.inModule&&u.flags&Z&&delete this.undefinedExports[t],u.flags&G)break}r&&this.raiseRecoverable(n,"Identifier '"+t+"' has already been declared")},xt.checkLocalExport=function(t){-1===this.scopeStack[0].lexical.indexOf(t.name)&&-1===this.scopeStack[0].var.indexOf(t.name)&&(this.undefinedExports[t.name]=t)},xt.currentScope=function(){return this.scopeStack[this.scopeStack.length-1]},xt.currentVarScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(e.flags&G)return e}},xt.currentThisScope=function(){for(var t=this.scopeStack.length-1;;t--){var e=this.scopeStack[t];if(e.flags&G&&!(e.flags&q))return e}};var wt=function(t,e,n){this.type="",this.start=e,this.end=0,t.options.locations&&(this.loc=new z(t,n)),t.options.directSourceFile&&(this.sourceFile=t.options.directSourceFile),t.options.ranges&&(this.range=[e,0])},Et=it.prototype;function St(t,e,n,r){return t.type=e,t.end=n,this.options.locations&&(t.loc.end=r),this.options.ranges&&(t.range[1]=n),t}Et.startNode=function(){return new wt(this,this.start,this.startLoc)},Et.startNodeAt=function(t,e){return new wt(this,t,e)},Et.finishNode=function(t,e){return St.call(this,t,e,this.lastTokEnd,this.lastTokEndLoc)},Et.finishNodeAt=function(t,e,n,r){return St.call(this,t,e,n,r)};var At=function(t,e,n,r,i){this.token=t,this.isExpr=!!e,this.preserveSpace=!!n,this.override=r,this.generator=!!i},Tt={b_stat:new At("{",!1),b_expr:new At("{",!0),b_tmpl:new At("${",!1),p_stat:new At("(",!1),p_expr:new At("(",!0),q_tmpl:new At("`",!0,!0,(function(t){return t.tryReadTemplateToken()})),f_stat:new At("function",!1),f_expr:new At("function",!0),f_expr_gen:new At("function",!0,!1,null,!0),f_gen:new At("function",!1,!1,null,!0)},Ct=it.prototype;Ct.initialContext=function(){return[Tt.b_stat]},Ct.braceIsBlock=function(t){var e=this.curContext();return e===Tt.f_expr||e===Tt.f_stat||(t!==S.colon||e!==Tt.b_stat&&e!==Tt.b_expr?t===S._return||t===S.name&&this.exprAllowed?A.test(this.input.slice(this.lastTokEnd,this.start)):t===S._else||t===S.semi||t===S.eof||t===S.parenR||t===S.arrow||(t===S.braceL?e===Tt.b_stat:t!==S._var&&t!==S._const&&t!==S.name&&!this.exprAllowed):!e.isExpr)},Ct.inGeneratorContext=function(){for(var t=this.context.length-1;t>=1;t--){var e=this.context[t];if("function"===e.token)return e.generator}return!1},Ct.updateContext=function(t){var e,n=this.type;n.keyword&&t===S.dot?this.exprAllowed=!1:(e=n.updateContext)?e.call(this,t):this.exprAllowed=n.beforeExpr},S.parenR.updateContext=S.braceR.updateContext=function(){if(1!==this.context.length){var t=this.context.pop();t===Tt.b_stat&&"function"===this.curContext().token&&(t=this.context.pop()),this.exprAllowed=!t.isExpr}else this.exprAllowed=!0},S.braceL.updateContext=function(t){this.context.push(this.braceIsBlock(t)?Tt.b_stat:Tt.b_expr),this.exprAllowed=!0},S.dollarBraceL.updateContext=function(){this.context.push(Tt.b_tmpl),this.exprAllowed=!0},S.parenL.updateContext=function(t){var e=t===S._if||t===S._for||t===S._with||t===S._while;this.context.push(e?Tt.p_stat:Tt.p_expr),this.exprAllowed=!0},S.incDec.updateContext=function(){},S._function.updateContext=S._class.updateContext=function(t){!t.beforeExpr||t===S.semi||t===S._else||t===S._return&&A.test(this.input.slice(this.lastTokEnd,this.start))||(t===S.colon||t===S.braceL)&&this.curContext()===Tt.b_stat?this.context.push(Tt.f_stat):this.context.push(Tt.f_expr),this.exprAllowed=!1},S.backQuote.updateContext=function(){this.curContext()===Tt.q_tmpl?this.context.pop():this.context.push(Tt.q_tmpl),this.exprAllowed=!1},S.star.updateContext=function(t){if(t===S._function){var e=this.context.length-1;this.context[e]===Tt.f_expr?this.context[e]=Tt.f_expr_gen:this.context[e]=Tt.f_gen}this.exprAllowed=!0},S.name.updateContext=function(t){var e=!1;this.options.ecmaVersion>=6&&t!==S.dot&&("of"===this.value&&!this.exprAllowed||"yield"===this.value&&this.inGeneratorContext())&&(e=!0),this.exprAllowed=e};var kt="ASCII ASCII_Hex_Digit AHex Alphabetic Alpha Any Assigned Bidi_Control Bidi_C Bidi_Mirrored Bidi_M Case_Ignorable CI Cased Changes_When_Casefolded CWCF Changes_When_Casemapped CWCM Changes_When_Lowercased CWL Changes_When_NFKC_Casefolded CWKCF Changes_When_Titlecased CWT Changes_When_Uppercased CWU Dash Default_Ignorable_Code_Point DI Deprecated Dep Diacritic Dia Emoji Emoji_Component Emoji_Modifier Emoji_Modifier_Base Emoji_Presentation Extender Ext Grapheme_Base Gr_Base Grapheme_Extend Gr_Ext Hex_Digit Hex IDS_Binary_Operator IDSB IDS_Trinary_Operator IDST ID_Continue IDC ID_Start IDS Ideographic Ideo Join_Control Join_C Logical_Order_Exception LOE Lowercase Lower Math Noncharacter_Code_Point NChar Pattern_Syntax Pat_Syn Pattern_White_Space Pat_WS Quotation_Mark QMark Radical Regional_Indicator RI Sentence_Terminal STerm Soft_Dotted SD Terminal_Punctuation Term Unified_Ideograph UIdeo Uppercase Upper Variation_Selector VS White_Space space XID_Continue XIDC XID_Start XIDS",Mt=kt+" Extended_Pictographic",Pt=Mt,It={9:kt,10:Mt,11:Pt},Rt="Cased_Letter LC Close_Punctuation Pe Connector_Punctuation Pc Control Cc cntrl Currency_Symbol Sc Dash_Punctuation Pd Decimal_Number Nd digit Enclosing_Mark Me Final_Punctuation Pf Format Cf Initial_Punctuation Pi Letter L Letter_Number Nl Line_Separator Zl Lowercase_Letter Ll Mark M Combining_Mark Math_Symbol Sm Modifier_Letter Lm Modifier_Symbol Sk Nonspacing_Mark Mn Number N Open_Punctuation Ps Other C Other_Letter Lo Other_Number No Other_Punctuation Po Other_Symbol So Paragraph_Separator Zp Private_Use Co Punctuation P punct Separator Z Space_Separator Zs Spacing_Mark Mc Surrogate Cs Symbol S Titlecase_Letter Lt Unassigned Cn Uppercase_Letter Lu",Lt="Adlam Adlm Ahom Ahom Anatolian_Hieroglyphs Hluw Arabic Arab Armenian Armn Avestan Avst Balinese Bali Bamum Bamu Bassa_Vah Bass Batak Batk Bengali Beng Bhaiksuki Bhks Bopomofo Bopo Brahmi Brah Braille Brai Buginese Bugi Buhid Buhd Canadian_Aboriginal Cans Carian Cari Caucasian_Albanian Aghb Chakma Cakm Cham Cham Cherokee Cher Common Zyyy Coptic Copt Qaac Cuneiform Xsux Cypriot Cprt Cyrillic Cyrl Deseret Dsrt Devanagari Deva Duployan Dupl Egyptian_Hieroglyphs Egyp Elbasan Elba Ethiopic Ethi Georgian Geor Glagolitic Glag Gothic Goth Grantha Gran Greek Grek Gujarati Gujr Gurmukhi Guru Han Hani Hangul Hang Hanunoo Hano Hatran Hatr Hebrew Hebr Hiragana Hira Imperial_Aramaic Armi Inherited Zinh Qaai Inscriptional_Pahlavi Phli Inscriptional_Parthian Prti Javanese Java Kaithi Kthi Kannada Knda Katakana Kana Kayah_Li Kali Kharoshthi Khar Khmer Khmr Khojki Khoj Khudawadi Sind Lao Laoo Latin Latn Lepcha Lepc Limbu Limb Linear_A Lina Linear_B Linb Lisu Lisu Lycian Lyci Lydian Lydi Mahajani Mahj Malayalam Mlym Mandaic Mand Manichaean Mani Marchen Marc Masaram_Gondi Gonm Meetei_Mayek Mtei Mende_Kikakui Mend Meroitic_Cursive Merc Meroitic_Hieroglyphs Mero Miao Plrd Modi Modi Mongolian Mong Mro Mroo Multani Mult Myanmar Mymr Nabataean Nbat New_Tai_Lue Talu Newa Newa Nko Nkoo Nushu Nshu Ogham Ogam Ol_Chiki Olck Old_Hungarian Hung Old_Italic Ital Old_North_Arabian Narb Old_Permic Perm Old_Persian Xpeo Old_South_Arabian Sarb Old_Turkic Orkh Oriya Orya Osage Osge Osmanya Osma Pahawh_Hmong Hmng Palmyrene Palm Pau_Cin_Hau Pauc Phags_Pa Phag Phoenician Phnx Psalter_Pahlavi Phlp Rejang Rjng Runic Runr Samaritan Samr Saurashtra Saur Sharada Shrd Shavian Shaw Siddham Sidd SignWriting Sgnw Sinhala Sinh Sora_Sompeng Sora Soyombo Soyo Sundanese Sund Syloti_Nagri Sylo Syriac Syrc Tagalog Tglg Tagbanwa Tagb Tai_Le Tale Tai_Tham Lana Tai_Viet Tavt Takri Takr Tamil Taml Tangut Tang Telugu Telu Thaana Thaa Thai Thai Tibetan Tibt Tifinagh Tfng Tirhuta Tirh Ugaritic Ugar Vai Vaii Warang_Citi Wara Yi Yiii Zanabazar_Square Zanb",Ot=Lt+" Dogra Dogr Gunjala_Gondi Gong Hanifi_Rohingya Rohg Makasar Maka Medefaidrin Medf Old_Sogdian Sogo Sogdian Sogd",Dt=Ot+" Elymaic Elym Nandinagari Nand Nyiakeng_Puachue_Hmong Hmnp Wancho Wcho",Nt={9:Lt,10:Ot,11:Dt},zt={};function Ft(t){var e=zt[t]={binary:D(It[t]+" "+Rt),nonBinary:{General_Category:D(Rt),Script:D(Nt[t])}};e.nonBinary.Script_Extensions=e.nonBinary.Script,e.nonBinary.gc=e.nonBinary.General_Category,e.nonBinary.sc=e.nonBinary.Script,e.nonBinary.scx=e.nonBinary.Script_Extensions}Ft(9),Ft(10),Ft(11);var Bt=it.prototype,Ut=function(t){this.parser=t,this.validFlags="gim"+(t.options.ecmaVersion>=6?"uy":"")+(t.options.ecmaVersion>=9?"s":""),this.unicodeProperties=zt[t.options.ecmaVersion>=11?11:t.options.ecmaVersion],this.source="",this.flags="",this.start=0,this.switchU=!1,this.switchN=!1,this.pos=0,this.lastIntValue=0,this.lastStringValue="",this.lastAssertionIsQuantifiable=!1,this.numCapturingParens=0,this.maxBackReference=0,this.groupNames=[],this.backReferenceNames=[]};function jt(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}function Zt(t){return 36===t||t>=40&&t<=43||46===t||63===t||t>=91&&t<=94||t>=123&&t<=125}function Vt(t){return m(t,!0)||36===t||95===t}function Gt(t){return g(t,!0)||36===t||95===t||8204===t||8205===t}function Ht(t){return t>=65&&t<=90||t>=97&&t<=122}function Wt(t){return t>=0&&t<=1114111}function qt(t){return 100===t||68===t||115===t||83===t||119===t||87===t}function Xt(t){return Ht(t)||95===t}function Yt(t){return Xt(t)||Kt(t)}function Kt(t){return t>=48&&t<=57}function Qt(t){return t>=48&&t<=57||t>=65&&t<=70||t>=97&&t<=102}function Jt(t){return t>=65&&t<=70?t-65+10:t>=97&&t<=102?t-97+10:t-48}function $t(t){return t>=48&&t<=55}Ut.prototype.reset=function(t,e,n){var r=-1!==n.indexOf("u");this.start=0|t,this.source=e+"",this.flags=n,this.switchU=r&&this.parser.options.ecmaVersion>=6,this.switchN=r&&this.parser.options.ecmaVersion>=9},Ut.prototype.raise=function(t){this.parser.raiseRecoverable(this.start,"Invalid regular expression: /"+this.source+"/: "+t)},Ut.prototype.at=function(t,e){void 0===e&&(e=!1);var n=this.source,r=n.length;if(t>=r)return-1;var i=n.charCodeAt(t);if(!e&&!this.switchU||i<=55295||i>=57344||t+1>=r)return i;var o=n.charCodeAt(t+1);return o>=56320&&o<=57343?(i<<10)+o-56613888:i},Ut.prototype.nextIndex=function(t,e){void 0===e&&(e=!1);var n=this.source,r=n.length;if(t>=r)return r;var i,o=n.charCodeAt(t);return!e&&!this.switchU||o<=55295||o>=57344||t+1>=r||(i=n.charCodeAt(t+1))<56320||i>57343?t+1:t+2},Ut.prototype.current=function(t){return void 0===t&&(t=!1),this.at(this.pos,t)},Ut.prototype.lookahead=function(t){return void 0===t&&(t=!1),this.at(this.nextIndex(this.pos,t),t)},Ut.prototype.advance=function(t){void 0===t&&(t=!1),this.pos=this.nextIndex(this.pos,t)},Ut.prototype.eat=function(t,e){return void 0===e&&(e=!1),this.current(e)===t&&(this.advance(e),!0)},Bt.validateRegExpFlags=function(t){for(var e=t.validFlags,n=t.flags,r=0;r<n.length;r++){var i=n.charAt(r);-1===e.indexOf(i)&&this.raise(t.start,"Invalid regular expression flag"),n.indexOf(i,r+1)>-1&&this.raise(t.start,"Duplicate regular expression flag")}},Bt.validateRegExpPattern=function(t){this.regexp_pattern(t),!t.switchN&&this.options.ecmaVersion>=9&&t.groupNames.length>0&&(t.switchN=!0,this.regexp_pattern(t))},Bt.regexp_pattern=function(t){t.pos=0,t.lastIntValue=0,t.lastStringValue="",t.lastAssertionIsQuantifiable=!1,t.numCapturingParens=0,t.maxBackReference=0,t.groupNames.length=0,t.backReferenceNames.length=0,this.regexp_disjunction(t),t.pos!==t.source.length&&(t.eat(41)&&t.raise("Unmatched ')'"),(t.eat(93)||t.eat(125))&&t.raise("Lone quantifier brackets")),t.maxBackReference>t.numCapturingParens&&t.raise("Invalid escape");for(var e=0,n=t.backReferenceNames;e<n.length;e+=1){var r=n[e];-1===t.groupNames.indexOf(r)&&t.raise("Invalid named capture referenced")}},Bt.regexp_disjunction=function(t){this.regexp_alternative(t);while(t.eat(124))this.regexp_alternative(t);this.regexp_eatQuantifier(t,!0)&&t.raise("Nothing to repeat"),t.eat(123)&&t.raise("Lone quantifier brackets")},Bt.regexp_alternative=function(t){while(t.pos<t.source.length&&this.regexp_eatTerm(t));},Bt.regexp_eatTerm=function(t){return this.regexp_eatAssertion(t)?(t.lastAssertionIsQuantifiable&&this.regexp_eatQuantifier(t)&&t.switchU&&t.raise("Invalid quantifier"),!0):!!(t.switchU?this.regexp_eatAtom(t):this.regexp_eatExtendedAtom(t))&&(this.regexp_eatQuantifier(t),!0)},Bt.regexp_eatAssertion=function(t){var e=t.pos;if(t.lastAssertionIsQuantifiable=!1,t.eat(94)||t.eat(36))return!0;if(t.eat(92)){if(t.eat(66)||t.eat(98))return!0;t.pos=e}if(t.eat(40)&&t.eat(63)){var n=!1;if(this.options.ecmaVersion>=9&&(n=t.eat(60)),t.eat(61)||t.eat(33))return this.regexp_disjunction(t),t.eat(41)||t.raise("Unterminated group"),t.lastAssertionIsQuantifiable=!n,!0}return t.pos=e,!1},Bt.regexp_eatQuantifier=function(t,e){return void 0===e&&(e=!1),!!this.regexp_eatQuantifierPrefix(t,e)&&(t.eat(63),!0)},Bt.regexp_eatQuantifierPrefix=function(t,e){return t.eat(42)||t.eat(43)||t.eat(63)||this.regexp_eatBracedQuantifier(t,e)},Bt.regexp_eatBracedQuantifier=function(t,e){var n=t.pos;if(t.eat(123)){var r=0,i=-1;if(this.regexp_eatDecimalDigits(t)&&(r=t.lastIntValue,t.eat(44)&&this.regexp_eatDecimalDigits(t)&&(i=t.lastIntValue),t.eat(125)))return-1!==i&&i<r&&!e&&t.raise("numbers out of order in {} quantifier"),!0;t.switchU&&!e&&t.raise("Incomplete quantifier"),t.pos=n}return!1},Bt.regexp_eatAtom=function(t){return this.regexp_eatPatternCharacters(t)||t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)},Bt.regexp_eatReverseSolidusAtomEscape=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatAtomEscape(t))return!0;t.pos=e}return!1},Bt.regexp_eatUncapturingGroup=function(t){var e=t.pos;if(t.eat(40)){if(t.eat(63)&&t.eat(58)){if(this.regexp_disjunction(t),t.eat(41))return!0;t.raise("Unterminated group")}t.pos=e}return!1},Bt.regexp_eatCapturingGroup=function(t){if(t.eat(40)){if(this.options.ecmaVersion>=9?this.regexp_groupSpecifier(t):63===t.current()&&t.raise("Invalid group"),this.regexp_disjunction(t),t.eat(41))return t.numCapturingParens+=1,!0;t.raise("Unterminated group")}return!1},Bt.regexp_eatExtendedAtom=function(t){return t.eat(46)||this.regexp_eatReverseSolidusAtomEscape(t)||this.regexp_eatCharacterClass(t)||this.regexp_eatUncapturingGroup(t)||this.regexp_eatCapturingGroup(t)||this.regexp_eatInvalidBracedQuantifier(t)||this.regexp_eatExtendedPatternCharacter(t)},Bt.regexp_eatInvalidBracedQuantifier=function(t){return this.regexp_eatBracedQuantifier(t,!0)&&t.raise("Nothing to repeat"),!1},Bt.regexp_eatSyntaxCharacter=function(t){var e=t.current();return!!Zt(e)&&(t.lastIntValue=e,t.advance(),!0)},Bt.regexp_eatPatternCharacters=function(t){var e=t.pos,n=0;while(-1!==(n=t.current())&&!Zt(n))t.advance();return t.pos!==e},Bt.regexp_eatExtendedPatternCharacter=function(t){var e=t.current();return!(-1===e||36===e||e>=40&&e<=43||46===e||63===e||91===e||94===e||124===e)&&(t.advance(),!0)},Bt.regexp_groupSpecifier=function(t){if(t.eat(63)){if(this.regexp_eatGroupName(t))return-1!==t.groupNames.indexOf(t.lastStringValue)&&t.raise("Duplicate capture group name"),void t.groupNames.push(t.lastStringValue);t.raise("Invalid group")}},Bt.regexp_eatGroupName=function(t){if(t.lastStringValue="",t.eat(60)){if(this.regexp_eatRegExpIdentifierName(t)&&t.eat(62))return!0;t.raise("Invalid capture group name")}return!1},Bt.regexp_eatRegExpIdentifierName=function(t){if(t.lastStringValue="",this.regexp_eatRegExpIdentifierStart(t)){t.lastStringValue+=jt(t.lastIntValue);while(this.regexp_eatRegExpIdentifierPart(t))t.lastStringValue+=jt(t.lastIntValue);return!0}return!1},Bt.regexp_eatRegExpIdentifierStart=function(t){var e=t.pos,n=this.options.ecmaVersion>=11,r=t.current(n);return t.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,n)&&(r=t.lastIntValue),Vt(r)?(t.lastIntValue=r,!0):(t.pos=e,!1)},Bt.regexp_eatRegExpIdentifierPart=function(t){var e=t.pos,n=this.options.ecmaVersion>=11,r=t.current(n);return t.advance(n),92===r&&this.regexp_eatRegExpUnicodeEscapeSequence(t,n)&&(r=t.lastIntValue),Gt(r)?(t.lastIntValue=r,!0):(t.pos=e,!1)},Bt.regexp_eatAtomEscape=function(t){return!!(this.regexp_eatBackReference(t)||this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)||t.switchN&&this.regexp_eatKGroupName(t))||(t.switchU&&(99===t.current()&&t.raise("Invalid unicode escape"),t.raise("Invalid escape")),!1)},Bt.regexp_eatBackReference=function(t){var e=t.pos;if(this.regexp_eatDecimalEscape(t)){var n=t.lastIntValue;if(t.switchU)return n>t.maxBackReference&&(t.maxBackReference=n),!0;if(n<=t.numCapturingParens)return!0;t.pos=e}return!1},Bt.regexp_eatKGroupName=function(t){if(t.eat(107)){if(this.regexp_eatGroupName(t))return t.backReferenceNames.push(t.lastStringValue),!0;t.raise("Invalid named reference")}return!1},Bt.regexp_eatCharacterEscape=function(t){return this.regexp_eatControlEscape(t)||this.regexp_eatCControlLetter(t)||this.regexp_eatZero(t)||this.regexp_eatHexEscapeSequence(t)||this.regexp_eatRegExpUnicodeEscapeSequence(t,!1)||!t.switchU&&this.regexp_eatLegacyOctalEscapeSequence(t)||this.regexp_eatIdentityEscape(t)},Bt.regexp_eatCControlLetter=function(t){var e=t.pos;if(t.eat(99)){if(this.regexp_eatControlLetter(t))return!0;t.pos=e}return!1},Bt.regexp_eatZero=function(t){return 48===t.current()&&!Kt(t.lookahead())&&(t.lastIntValue=0,t.advance(),!0)},Bt.regexp_eatControlEscape=function(t){var e=t.current();return 116===e?(t.lastIntValue=9,t.advance(),!0):110===e?(t.lastIntValue=10,t.advance(),!0):118===e?(t.lastIntValue=11,t.advance(),!0):102===e?(t.lastIntValue=12,t.advance(),!0):114===e&&(t.lastIntValue=13,t.advance(),!0)},Bt.regexp_eatControlLetter=function(t){var e=t.current();return!!Ht(e)&&(t.lastIntValue=e%32,t.advance(),!0)},Bt.regexp_eatRegExpUnicodeEscapeSequence=function(t,e){void 0===e&&(e=!1);var n=t.pos,r=e||t.switchU;if(t.eat(117)){if(this.regexp_eatFixedHexDigits(t,4)){var i=t.lastIntValue;if(r&&i>=55296&&i<=56319){var o=t.pos;if(t.eat(92)&&t.eat(117)&&this.regexp_eatFixedHexDigits(t,4)){var a=t.lastIntValue;if(a>=56320&&a<=57343)return t.lastIntValue=1024*(i-55296)+(a-56320)+65536,!0}t.pos=o,t.lastIntValue=i}return!0}if(r&&t.eat(123)&&this.regexp_eatHexDigits(t)&&t.eat(125)&&Wt(t.lastIntValue))return!0;r&&t.raise("Invalid unicode escape"),t.pos=n}return!1},Bt.regexp_eatIdentityEscape=function(t){if(t.switchU)return!!this.regexp_eatSyntaxCharacter(t)||!!t.eat(47)&&(t.lastIntValue=47,!0);var e=t.current();return!(99===e||t.switchN&&107===e)&&(t.lastIntValue=e,t.advance(),!0)},Bt.regexp_eatDecimalEscape=function(t){t.lastIntValue=0;var e=t.current();if(e>=49&&e<=57){do{t.lastIntValue=10*t.lastIntValue+(e-48),t.advance()}while((e=t.current())>=48&&e<=57);return!0}return!1},Bt.regexp_eatCharacterClassEscape=function(t){var e=t.current();if(qt(e))return t.lastIntValue=-1,t.advance(),!0;if(t.switchU&&this.options.ecmaVersion>=9&&(80===e||112===e)){if(t.lastIntValue=-1,t.advance(),t.eat(123)&&this.regexp_eatUnicodePropertyValueExpression(t)&&t.eat(125))return!0;t.raise("Invalid property name")}return!1},Bt.regexp_eatUnicodePropertyValueExpression=function(t){var e=t.pos;if(this.regexp_eatUnicodePropertyName(t)&&t.eat(61)){var n=t.lastStringValue;if(this.regexp_eatUnicodePropertyValue(t)){var r=t.lastStringValue;return this.regexp_validateUnicodePropertyNameAndValue(t,n,r),!0}}if(t.pos=e,this.regexp_eatLoneUnicodePropertyNameOrValue(t)){var i=t.lastStringValue;return this.regexp_validateUnicodePropertyNameOrValue(t,i),!0}return!1},Bt.regexp_validateUnicodePropertyNameAndValue=function(t,e,n){L(t.unicodeProperties.nonBinary,e)||t.raise("Invalid property name"),t.unicodeProperties.nonBinary[e].test(n)||t.raise("Invalid property value")},Bt.regexp_validateUnicodePropertyNameOrValue=function(t,e){t.unicodeProperties.binary.test(e)||t.raise("Invalid property name")},Bt.regexp_eatUnicodePropertyName=function(t){var e=0;t.lastStringValue="";while(Xt(e=t.current()))t.lastStringValue+=jt(e),t.advance();return""!==t.lastStringValue},Bt.regexp_eatUnicodePropertyValue=function(t){var e=0;t.lastStringValue="";while(Yt(e=t.current()))t.lastStringValue+=jt(e),t.advance();return""!==t.lastStringValue},Bt.regexp_eatLoneUnicodePropertyNameOrValue=function(t){return this.regexp_eatUnicodePropertyValue(t)},Bt.regexp_eatCharacterClass=function(t){if(t.eat(91)){if(t.eat(94),this.regexp_classRanges(t),t.eat(93))return!0;t.raise("Unterminated character class")}return!1},Bt.regexp_classRanges=function(t){while(this.regexp_eatClassAtom(t)){var e=t.lastIntValue;if(t.eat(45)&&this.regexp_eatClassAtom(t)){var n=t.lastIntValue;!t.switchU||-1!==e&&-1!==n||t.raise("Invalid character class"),-1!==e&&-1!==n&&e>n&&t.raise("Range out of order in character class")}}},Bt.regexp_eatClassAtom=function(t){var e=t.pos;if(t.eat(92)){if(this.regexp_eatClassEscape(t))return!0;if(t.switchU){var n=t.current();(99===n||$t(n))&&t.raise("Invalid class escape"),t.raise("Invalid escape")}t.pos=e}var r=t.current();return 93!==r&&(t.lastIntValue=r,t.advance(),!0)},Bt.regexp_eatClassEscape=function(t){var e=t.pos;if(t.eat(98))return t.lastIntValue=8,!0;if(t.switchU&&t.eat(45))return t.lastIntValue=45,!0;if(!t.switchU&&t.eat(99)){if(this.regexp_eatClassControlLetter(t))return!0;t.pos=e}return this.regexp_eatCharacterClassEscape(t)||this.regexp_eatCharacterEscape(t)},Bt.regexp_eatClassControlLetter=function(t){var e=t.current();return!(!Kt(e)&&95!==e)&&(t.lastIntValue=e%32,t.advance(),!0)},Bt.regexp_eatHexEscapeSequence=function(t){var e=t.pos;if(t.eat(120)){if(this.regexp_eatFixedHexDigits(t,2))return!0;t.switchU&&t.raise("Invalid escape"),t.pos=e}return!1},Bt.regexp_eatDecimalDigits=function(t){var e=t.pos,n=0;t.lastIntValue=0;while(Kt(n=t.current()))t.lastIntValue=10*t.lastIntValue+(n-48),t.advance();return t.pos!==e},Bt.regexp_eatHexDigits=function(t){var e=t.pos,n=0;t.lastIntValue=0;while(Qt(n=t.current()))t.lastIntValue=16*t.lastIntValue+Jt(n),t.advance();return t.pos!==e},Bt.regexp_eatLegacyOctalEscapeSequence=function(t){if(this.regexp_eatOctalDigit(t)){var e=t.lastIntValue;if(this.regexp_eatOctalDigit(t)){var n=t.lastIntValue;e<=3&&this.regexp_eatOctalDigit(t)?t.lastIntValue=64*e+8*n+t.lastIntValue:t.lastIntValue=8*e+n}else t.lastIntValue=e;return!0}return!1},Bt.regexp_eatOctalDigit=function(t){var e=t.current();return $t(e)?(t.lastIntValue=e-48,t.advance(),!0):(t.lastIntValue=0,!1)},Bt.regexp_eatFixedHexDigits=function(t,e){var n=t.pos;t.lastIntValue=0;for(var r=0;r<e;++r){var i=t.current();if(!Qt(i))return t.pos=n,!1;t.lastIntValue=16*t.lastIntValue+Jt(i),t.advance()}return!0};var te=function(t){this.type=t.type,this.value=t.value,this.start=t.start,this.end=t.end,t.options.locations&&(this.loc=new z(t,t.startLoc,t.endLoc)),t.options.ranges&&(this.range=[t.start,t.end])},ee=it.prototype;function ne(t,e){return e?parseInt(t,8):parseFloat(t.replace(/_/g,""))}function re(t){return"function"!==typeof BigInt?null:BigInt(t.replace(/_/g,""))}function ie(t){return t<=65535?String.fromCharCode(t):(t-=65536,String.fromCharCode(55296+(t>>10),56320+(1023&t)))}ee.next=function(t){!t&&this.type.keyword&&this.containsEsc&&this.raiseRecoverable(this.start,"Escape sequence in keyword "+this.type.keyword),this.options.onToken&&this.options.onToken(new te(this)),this.lastTokEnd=this.end,this.lastTokStart=this.start,this.lastTokEndLoc=this.endLoc,this.lastTokStartLoc=this.startLoc,this.nextToken()},ee.getToken=function(){return this.next(),new te(this)},"undefined"!==typeof Symbol&&(ee[Symbol.iterator]=function(){var t=this;return{next:function(){var e=t.getToken();return{done:e.type===S.eof,value:e}}}}),ee.curContext=function(){return this.context[this.context.length-1]},ee.nextToken=function(){var t=this.curContext();return t&&t.preserveSpace||this.skipSpace(),this.start=this.pos,this.options.locations&&(this.startLoc=this.curPosition()),this.pos>=this.input.length?this.finishToken(S.eof):t.override?t.override(this):void this.readToken(this.fullCharCodeAtPos())},ee.readToken=function(t){return m(t,this.options.ecmaVersion>=6)||92===t?this.readWord():this.getTokenFromCode(t)},ee.fullCharCodeAtPos=function(){var t=this.input.charCodeAt(this.pos);if(t<=55295||t>=57344)return t;var e=this.input.charCodeAt(this.pos+1);return(t<<10)+e-56613888},ee.skipBlockComment=function(){var t=this.options.onComment&&this.curPosition(),e=this.pos,n=this.input.indexOf("*/",this.pos+=2);if(-1===n&&this.raise(this.pos-2,"Unterminated comment"),this.pos=n+2,this.options.locations){var r;T.lastIndex=e;while((r=T.exec(this.input))&&r.index<this.pos)++this.curLine,this.lineStart=r.index+r[0].length}this.options.onComment&&this.options.onComment(!0,this.input.slice(e+2,n),e,this.pos,t,this.curPosition())},ee.skipLineComment=function(t){var e=this.pos,n=this.options.onComment&&this.curPosition(),r=this.input.charCodeAt(this.pos+=t);while(this.pos<this.input.length&&!C(r))r=this.input.charCodeAt(++this.pos);this.options.onComment&&this.options.onComment(!1,this.input.slice(e+t,this.pos),e,this.pos,n,this.curPosition())},ee.skipSpace=function(){t:while(this.pos<this.input.length){var t=this.input.charCodeAt(this.pos);switch(t){case 32:case 160:++this.pos;break;case 13:10===this.input.charCodeAt(this.pos+1)&&++this.pos;case 10:case 8232:case 8233:++this.pos,this.options.locations&&(++this.curLine,this.lineStart=this.pos);break;case 47:switch(this.input.charCodeAt(this.pos+1)){case 42:this.skipBlockComment();break;case 47:this.skipLineComment(2);break;default:break t}break;default:if(!(t>8&&t<14||t>=5760&&k.test(String.fromCharCode(t))))break t;++this.pos}}},ee.finishToken=function(t,e){this.end=this.pos,this.options.locations&&(this.endLoc=this.curPosition());var n=this.type;this.type=t,this.value=e,this.updateContext(n)},ee.readToken_dot=function(){var t=this.input.charCodeAt(this.pos+1);if(t>=48&&t<=57)return this.readNumber(!0);var e=this.input.charCodeAt(this.pos+2);return this.options.ecmaVersion>=6&&46===t&&46===e?(this.pos+=3,this.finishToken(S.ellipsis)):(++this.pos,this.finishToken(S.dot))},ee.readToken_slash=function(){var t=this.input.charCodeAt(this.pos+1);return this.exprAllowed?(++this.pos,this.readRegexp()):61===t?this.finishOp(S.assign,2):this.finishOp(S.slash,1)},ee.readToken_mult_modulo_exp=function(t){var e=this.input.charCodeAt(this.pos+1),n=1,r=42===t?S.star:S.modulo;return this.options.ecmaVersion>=7&&42===t&&42===e&&(++n,r=S.starstar,e=this.input.charCodeAt(this.pos+2)),61===e?this.finishOp(S.assign,n+1):this.finishOp(r,n)},ee.readToken_pipe_amp=function(t){var e=this.input.charCodeAt(this.pos+1);if(e===t){if(this.options.ecmaVersion>=12){var n=this.input.charCodeAt(this.pos+2);if(61===n)return this.finishOp(S.assign,3)}return this.finishOp(124===t?S.logicalOR:S.logicalAND,2)}return 61===e?this.finishOp(S.assign,2):this.finishOp(124===t?S.bitwiseOR:S.bitwiseAND,1)},ee.readToken_caret=function(){var t=this.input.charCodeAt(this.pos+1);return 61===t?this.finishOp(S.assign,2):this.finishOp(S.bitwiseXOR,1)},ee.readToken_plus_min=function(t){var e=this.input.charCodeAt(this.pos+1);return e===t?45!==e||this.inModule||62!==this.input.charCodeAt(this.pos+2)||0!==this.lastTokEnd&&!A.test(this.input.slice(this.lastTokEnd,this.pos))?this.finishOp(S.incDec,2):(this.skipLineComment(3),this.skipSpace(),this.nextToken()):61===e?this.finishOp(S.assign,2):this.finishOp(S.plusMin,1)},ee.readToken_lt_gt=function(t){var e=this.input.charCodeAt(this.pos+1),n=1;return e===t?(n=62===t&&62===this.input.charCodeAt(this.pos+2)?3:2,61===this.input.charCodeAt(this.pos+n)?this.finishOp(S.assign,n+1):this.finishOp(S.bitShift,n)):33!==e||60!==t||this.inModule||45!==this.input.charCodeAt(this.pos+2)||45!==this.input.charCodeAt(this.pos+3)?(61===e&&(n=2),this.finishOp(S.relational,n)):(this.skipLineComment(4),this.skipSpace(),this.nextToken())},ee.readToken_eq_excl=function(t){var e=this.input.charCodeAt(this.pos+1);return 61===e?this.finishOp(S.equality,61===this.input.charCodeAt(this.pos+2)?3:2):61===t&&62===e&&this.options.ecmaVersion>=6?(this.pos+=2,this.finishToken(S.arrow)):this.finishOp(61===t?S.eq:S.prefix,1)},ee.readToken_question=function(){var t=this.options.ecmaVersion;if(t>=11){var e=this.input.charCodeAt(this.pos+1);if(46===e){var n=this.input.charCodeAt(this.pos+2);if(n<48||n>57)return this.finishOp(S.questionDot,2)}if(63===e){if(t>=12){var r=this.input.charCodeAt(this.pos+2);if(61===r)return this.finishOp(S.assign,3)}return this.finishOp(S.coalesce,2)}}return this.finishOp(S.question,1)},ee.getTokenFromCode=function(t){switch(t){case 46:return this.readToken_dot();case 40:return++this.pos,this.finishToken(S.parenL);case 41:return++this.pos,this.finishToken(S.parenR);case 59:return++this.pos,this.finishToken(S.semi);case 44:return++this.pos,this.finishToken(S.comma);case 91:return++this.pos,this.finishToken(S.bracketL);case 93:return++this.pos,this.finishToken(S.bracketR);case 123:return++this.pos,this.finishToken(S.braceL);case 125:return++this.pos,this.finishToken(S.braceR);case 58:return++this.pos,this.finishToken(S.colon);case 96:if(this.options.ecmaVersion<6)break;return++this.pos,this.finishToken(S.backQuote);case 48:var e=this.input.charCodeAt(this.pos+1);if(120===e||88===e)return this.readRadixNumber(16);if(this.options.ecmaVersion>=6){if(111===e||79===e)return this.readRadixNumber(8);if(98===e||66===e)return this.readRadixNumber(2)}case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return this.readNumber(!1);case 34:case 39:return this.readString(t);case 47:return this.readToken_slash();case 37:case 42:return this.readToken_mult_modulo_exp(t);case 124:case 38:return this.readToken_pipe_amp(t);case 94:return this.readToken_caret();case 43:case 45:return this.readToken_plus_min(t);case 60:case 62:return this.readToken_lt_gt(t);case 61:case 33:return this.readToken_eq_excl(t);case 63:return this.readToken_question();case 126:return this.finishOp(S.prefix,1)}this.raise(this.pos,"Unexpected character '"+ie(t)+"'")},ee.finishOp=function(t,e){var n=this.input.slice(this.pos,this.pos+e);return this.pos+=e,this.finishToken(t,n)},ee.readRegexp=function(){for(var t,e,n=this.pos;;){this.pos>=this.input.length&&this.raise(n,"Unterminated regular expression");var r=this.input.charAt(this.pos);if(A.test(r)&&this.raise(n,"Unterminated regular expression"),t)t=!1;else{if("["===r)e=!0;else if("]"===r&&e)e=!1;else if("/"===r&&!e)break;t="\\"===r}++this.pos}var i=this.input.slice(n,this.pos);++this.pos;var o=this.pos,a=this.readWord1();this.containsEsc&&this.unexpected(o);var s=this.regexpState||(this.regexpState=new Ut(this));s.reset(n,i,a),this.validateRegExpFlags(s),this.validateRegExpPattern(s);var u=null;try{u=new RegExp(i,a)}catch(c){}return this.finishToken(S.regexp,{pattern:i,flags:a,value:u})},ee.readInt=function(t,e,n){for(var r=this.options.ecmaVersion>=12&&void 0===e,i=n&&48===this.input.charCodeAt(this.pos),o=this.pos,a=0,s=0,u=0,c=null==e?1/0:e;u<c;++u,++this.pos){var l=this.input.charCodeAt(this.pos),h=void 0;if(r&&95===l)i&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed in legacy octal numeric literals"),95===s&&this.raiseRecoverable(this.pos,"Numeric separator must be exactly one underscore"),0===u&&this.raiseRecoverable(this.pos,"Numeric separator is not allowed at the first of digits"),s=l;else{if(h=l>=97?l-97+10:l>=65?l-65+10:l>=48&&l<=57?l-48:1/0,h>=t)break;s=l,a=a*t+h}}return r&&95===s&&this.raiseRecoverable(this.pos-1,"Numeric separator is not allowed at the last of digits"),this.pos===o||null!=e&&this.pos-o!==e?null:a},ee.readRadixNumber=function(t){var e=this.pos;this.pos+=2;var n=this.readInt(t);return null==n&&this.raise(this.start+2,"Expected number in radix "+t),this.options.ecmaVersion>=11&&110===this.input.charCodeAt(this.pos)?(n=re(this.input.slice(e,this.pos)),++this.pos):m(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(S.num,n)},ee.readNumber=function(t){var e=this.pos;t||null!==this.readInt(10,void 0,!0)||this.raise(e,"Invalid number");var n=this.pos-e>=2&&48===this.input.charCodeAt(e);n&&this.strict&&this.raise(e,"Invalid number");var r=this.input.charCodeAt(this.pos);if(!n&&!t&&this.options.ecmaVersion>=11&&110===r){var i=re(this.input.slice(e,this.pos));return++this.pos,m(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number"),this.finishToken(S.num,i)}n&&/[89]/.test(this.input.slice(e,this.pos))&&(n=!1),46!==r||n||(++this.pos,this.readInt(10),r=this.input.charCodeAt(this.pos)),69!==r&&101!==r||n||(r=this.input.charCodeAt(++this.pos),43!==r&&45!==r||++this.pos,null===this.readInt(10)&&this.raise(e,"Invalid number")),m(this.fullCharCodeAtPos())&&this.raise(this.pos,"Identifier directly after number");var o=ne(this.input.slice(e,this.pos),n);return this.finishToken(S.num,o)},ee.readCodePoint=function(){var t,e=this.input.charCodeAt(this.pos);if(123===e){this.options.ecmaVersion<6&&this.unexpected();var n=++this.pos;t=this.readHexChar(this.input.indexOf("}",this.pos)-this.pos),++this.pos,t>1114111&&this.invalidStringToken(n,"Code point out of bounds")}else t=this.readHexChar(4);return t},ee.readString=function(t){for(var e="",n=++this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated string constant");var r=this.input.charCodeAt(this.pos);if(r===t)break;92===r?(e+=this.input.slice(n,this.pos),e+=this.readEscapedChar(!1),n=this.pos):(C(r,this.options.ecmaVersion>=10)&&this.raise(this.start,"Unterminated string constant"),++this.pos)}return e+=this.input.slice(n,this.pos++),this.finishToken(S.string,e)};var oe={};ee.tryReadTemplateToken=function(){this.inTemplateElement=!0;try{this.readTmplToken()}catch(t){if(t!==oe)throw t;this.readInvalidTemplateToken()}this.inTemplateElement=!1},ee.invalidStringToken=function(t,e){if(this.inTemplateElement&&this.options.ecmaVersion>=9)throw oe;this.raise(t,e)},ee.readTmplToken=function(){for(var t="",e=this.pos;;){this.pos>=this.input.length&&this.raise(this.start,"Unterminated template");var n=this.input.charCodeAt(this.pos);if(96===n||36===n&&123===this.input.charCodeAt(this.pos+1))return this.pos!==this.start||this.type!==S.template&&this.type!==S.invalidTemplate?(t+=this.input.slice(e,this.pos),this.finishToken(S.template,t)):36===n?(this.pos+=2,this.finishToken(S.dollarBraceL)):(++this.pos,this.finishToken(S.backQuote));if(92===n)t+=this.input.slice(e,this.pos),t+=this.readEscapedChar(!0),e=this.pos;else if(C(n)){switch(t+=this.input.slice(e,this.pos),++this.pos,n){case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:t+="\n";break;default:t+=String.fromCharCode(n);break}this.options.locations&&(++this.curLine,this.lineStart=this.pos),e=this.pos}else++this.pos}},ee.readInvalidTemplateToken=function(){for(;this.pos<this.input.length;this.pos++)switch(this.input[this.pos]){case"\\":++this.pos;break;case"$":if("{"!==this.input[this.pos+1])break;case"`":return this.finishToken(S.invalidTemplate,this.input.slice(this.start,this.pos))}this.raise(this.start,"Unterminated template")},ee.readEscapedChar=function(t){var e=this.input.charCodeAt(++this.pos);switch(++this.pos,e){case 110:return"\n";case 114:return"\r";case 120:return String.fromCharCode(this.readHexChar(2));case 117:return ie(this.readCodePoint());case 116:return"\t";case 98:return"\b";case 118:return"\v";case 102:return"\f";case 13:10===this.input.charCodeAt(this.pos)&&++this.pos;case 10:return this.options.locations&&(this.lineStart=this.pos,++this.curLine),"";case 56:case 57:if(t){var n=this.pos-1;return this.invalidStringToken(n,"Invalid escape sequence in template string"),null}default:if(e>=48&&e<=55){var r=this.input.substr(this.pos-1,3).match(/^[0-7]+/)[0],i=parseInt(r,8);return i>255&&(r=r.slice(0,-1),i=parseInt(r,8)),this.pos+=r.length-1,e=this.input.charCodeAt(this.pos),"0"===r&&56!==e&&57!==e||!this.strict&&!t||this.invalidStringToken(this.pos-1-r.length,t?"Octal literal in template string":"Octal literal in strict mode"),String.fromCharCode(i)}return C(e)?"":String.fromCharCode(e)}},ee.readHexChar=function(t){var e=this.pos,n=this.readInt(16,t);return null===n&&this.invalidStringToken(e,"Bad character escape sequence"),n},ee.readWord1=function(){this.containsEsc=!1;var t="",e=!0,n=this.pos,r=this.options.ecmaVersion>=6;while(this.pos<this.input.length){var i=this.fullCharCodeAtPos();if(g(i,r))this.pos+=i<=65535?1:2;else{if(92!==i)break;this.containsEsc=!0,t+=this.input.slice(n,this.pos);var o=this.pos;117!==this.input.charCodeAt(++this.pos)&&this.invalidStringToken(this.pos,"Expecting Unicode escape sequence \\uXXXX"),++this.pos;var a=this.readCodePoint();(e?m:g)(a,r)||this.invalidStringToken(o,"Invalid Unicode escape"),t+=ie(a),n=this.pos}e=!1}return t+this.input.slice(n,this.pos)},ee.readWord=function(){var t=this.readWord1(),e=S.name;return this.keywords.test(t)&&(e=w[t]),this.finishToken(e,t)};var ae="7.4.1";function se(t,e){return it.parse(t,e)}function ue(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}function ce(t){var e="function"===typeof Map?new Map:void 0;return ce=function(t){if(null===t||!fe(t))return t;if("function"!==typeof t)throw new TypeError("Super expression must either be null or a function");if("undefined"!==typeof e){if(e.has(t))return e.get(t);e.set(t,n)}function n(){return he(t,arguments,de(this).constructor)}return n.prototype=Object.create(t.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),pe(n,t)},ce(t)}function le(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function he(t,e,n){return he=le()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=Function.bind.apply(t,r),o=new i;return n&&pe(o,n.prototype),o},he.apply(null,arguments)}function fe(t){return-1!==Function.toString.call(t).indexOf("[native code]")}function pe(t,e){return pe=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},pe(t,e)}function de(t){return de=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},de(t)}it.acorn={Parser:it,version:ae,defaultOptions:B,Position:N,SourceLocation:z,getLineInfo:F,Node:wt,TokenType:y,tokTypes:S,keywordTypes:w,TokContext:At,tokContexts:Tt,isIdentifierChar:g,isIdentifierStart:m,Token:te,isNewLine:C,lineBreak:A,lineBreakG:T,nonASCIIwhitespace:k};var ve=function(t){function e(){return t.apply(this,arguments)||this}return ue(e,t),e}(ce(Error)),me=function(t){function e(){return t.apply(this,arguments)||this}return ue(e,t),e}(ce(SyntaxError)),ge=function(t){function e(){return t.apply(this,arguments)||this}return ue(e,t),e}(ce(ReferenceError)),ye=function(t){function e(){return t.apply(this,arguments)||this}return ue(e,t),e}(ce(TypeError)),_e=function(t){function e(){return t.apply(this,arguments)||this}return ue(e,t),e}(ve),xe=function(t){function e(){return t.apply(this,arguments)||this}return ue(e,t),e}(me),be=function(t){function e(){return t.apply(this,arguments)||this}return ue(e,t),e}(ge),we={UnknownError:[3001,"%0",_e],ExecutionTimeOutError:[3002,"Script execution timed out after %0ms",_e],NodeTypeSyntaxError:[1001,"Unknown node type: %0",be],BinaryOperatorSyntaxError:[1002,"Unknown binary operator: %0",be],LogicalOperatorSyntaxError:[1003,"Unknown logical operator: %0",be],UnaryOperatorSyntaxError:[1004,"Unknown unary operator: %0",be],UpdateOperatorSyntaxError:[1005,"Unknown update operator: %0",be],ObjectStructureSyntaxError:[1006,"Unknown object structure: %0",be],AssignmentExpressionSyntaxError:[1007,"Unknown assignment expression: %0",be],VariableTypeSyntaxError:[1008,"Unknown variable type: %0",be],ParamTypeSyntaxError:[1009,"Unknown param type: %0",be],AssignmentTypeSyntaxError:[1010,"Unknown assignment type: %0",be],FunctionUndefinedReferenceError:[2001,"%0 is not a function",ge],VariableUndefinedReferenceError:[2002,"%0 is not defined",ge],IsNotConstructor:[2003,"%0 is not a constructor",ye]};function Ee(){if("undefined"===typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"===typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}function Se(t,e,n){return Se=Ee()?Reflect.construct:function(t,e,n){var r=[null];r.push.apply(r,e);var i=Function.bind.apply(t,r),o=new i;return n&&Ae(o,n.prototype),o},Se.apply(null,arguments)}function Ae(t,e){return Ae=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},Ae(t,e)}var Te="0.0.3";function Ce(t,e){Object.defineProperty(t,"name",{value:e,writable:!1,enumerable:!1,configurable:!0})}var ke=Object.prototype.hasOwnProperty,Me=Symbol("Break"),Pe=Symbol("Continue"),Ie=Symbol("DefaultCase"),Re=Symbol("EmptyStatementReturn"),Le=Symbol("WithScopeName"),Oe=Symbol("SuperScopeName"),De=Symbol("RootScopeName"),Ne=Symbol("GlobalScopeName");function ze(t){return"function"===typeof t}var Fe=function(){function t(t){this.interpreter=t}var e=t.prototype;return e.generator=function(){var t=this.interpreter;function e(){return this.getCurrentScope()}function n(){return this.getGlobalScope()}function r(){return this.getCurrentContext()}return{getOptions:t.getOptions.bind(t),getCurrentScope:e.bind(t),getGlobalScope:n.bind(t),getCurrentContext:r.bind(t),getExecStartTime:t.getExecStartTime.bind(t)}},t}();function Be(t,e,n){if(void 0===n&&(n=!0),!(t instanceof Fe))throw new Error("Illegal call");if("string"!==typeof e)return e;if(e){var r=t.generator(),i=r.getOptions(),o={timeout:i.timeout,_initEnv:function(){n||this.setCurrentContext(r.getCurrentContext()),this.execStartTime=r.getExecStartTime(),this.execEndTime=this.execStartTime}},a=n?r.getGlobalScope():r.getCurrentScope(),s=new Ye(a,o);return s.evaluate(e)}}function Ue(t){if(!(t instanceof Fe))throw new Error("Illegal call");for(var e=t.generator(),n=arguments.length,r=new Array(n>1?n-1:0),i=1;i<n;i++)r[i-1]=arguments[i];var o=r.pop(),a=new Ye(e.getGlobalScope(),e.getOptions()),s="\n\t\t    (function anonymous("+r.join(",")+"){\n\t\t        "+o+"\n\t\t    });\n\t\t    ";return a.evaluate(s)}Object.defineProperty(Be,"__IS_EVAL_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(Ue,"__IS_FUNCTION_FUNC",{value:!0,writable:!1,enumerable:!1,configurable:!1});var je=function(t){this.value=t},Ze=function(t){this.value=t},Ve=function(t){this.value=t},Ge=function(t,e,n){void 0===e&&(e=null),this.name=n,this.parent=e,this.data=t,this.labelStack=[]};function He(){}function We(t,e){return void 0===t&&(t=null),new Ge(Object.create(null),t,e)}function qe(t){return Object.create(t)}var Xe={NaN:NaN,Infinity:1/0,undefined:void 0,Object:Object,Array:Array,String:String,Boolean:Boolean,Number:Number,Date:Date,RegExp:RegExp,Error:Error,URIError:URIError,TypeError:TypeError,RangeError:RangeError,SyntaxError:SyntaxError,ReferenceError:ReferenceError,Float32Array:Float32Array,Float64Array:Float64Array,Uint32Array:Uint32Array,Math:Math,parseInt:parseInt,parseFloat:parseFloat,isNaN:isNaN,isFinite:isFinite,decodeURI:decodeURI,decodeURIComponent:decodeURIComponent,encodeURI:encodeURI,encodeURIComponent:encodeURIComponent,escape:escape,unescape:unescape,eval:Be,Function:Ue};"undefined"!==typeof JSON&&(Xe.JSON=JSON),"undefined"!==typeof Promise&&(Xe.Promise=Promise),"undefined"!==typeof Set&&(Xe.Set=Set),"undefined"!==typeof Map&&(Xe.Map=Map),"undefined"!==typeof Symbol&&(Xe.Symbol=Symbol),"undefined"!==typeof Proxy&&(Xe.Proxy=Proxy),"undefined"!==typeof WeakMap&&(Xe.WeakMap=WeakMap),"undefined"!==typeof WeakSet&&(Xe.WeakSet=WeakSet),"undefined"!==typeof Reflect&&(Xe.Reflect=Reflect);var Ye=function(){function t(e,n){void 0===e&&(e=t.global),void 0===n&&(n={}),this.sourceList=[],this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.isVarDeclMode=!1,this.lastExecNode=null,this.isRunning=!1,this.options={ecmaVersion:n.ecmaVersion||t.ecmaVersion,timeout:n.timeout||0,rootContext:n.rootContext,globalContextInFunction:void 0===n.globalContextInFunction?t.globalContextInFunction:n.globalContextInFunction,_initEnv:n._initEnv},this.context=e||Object.create(null),this.callStack=[],this.initEnvironment(this.context)}var e=t.prototype;return e.initEnvironment=function(t){var e;if(t instanceof Ge)e=t;else{var n=null,r=this.createSuperScope(t);this.options.rootContext&&(n=new Ge(qe(this.options.rootContext),r,De)),e=new Ge(t,n||r,Ne)}this.globalScope=e,this.currentScope=this.globalScope,this.globalContext=e.data,this.currentContext=e.data,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null),this.execStartTime=Date.now(),this.execEndTime=this.execStartTime;var i=this.options._initEnv;i&&i.call(this)},e.getExecStartTime=function(){return this.execStartTime},e.getExecutionTime=function(){return this.execEndTime-this.execStartTime},e.setExecTimeout=function(t){void 0===t&&(t=0),this.options.timeout=t},e.getOptions=function(){return this.options},e.getGlobalScope=function(){return this.globalScope},e.getCurrentScope=function(){return this.currentScope},e.getCurrentContext=function(){return this.currentContext},e.isInterruptThrow=function(t){return t instanceof _e||t instanceof be||t instanceof xe},e.createSuperScope=function(t){var e=Object.assign({},Xe),n=Object.keys(e);return n.forEach((function(n){n in t&&delete e[n]})),new Ge(e,null,Oe)},e.setCurrentContext=function(t){this.currentContext=t},e.setCurrentScope=function(t){this.currentScope=t},e.evaluate=function(e){var n;if(void 0===e&&(e=""),e)return n=se(e,{ranges:!0,locations:!0,ecmaVersion:this.options.ecmaVersion||t.ecmaVersion}),this.evaluateNode(n,e)},e.appendCode=function(t){return this.evaluate(t)},e.evaluateNode=function(t,e){var n=this;void 0===e&&(e=""),this.value=void 0,this.source=e,this.sourceList.push(e),this.isRunning=!0,this.execStartTime=Date.now(),this.execEndTime=this.execStartTime,this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var r=this.getCurrentScope(),i=this.getCurrentContext(),o=r.labelStack.concat([]),a=this.callStack.concat([]),s=function(){n.setCurrentScope(r),n.setCurrentContext(i),r.labelStack=o,n.callStack=a};try{var u=this.createClosure(t);this.addDeclarationsToScope(this.collectDeclVars,this.collectDeclFuncs,this.getCurrentScope()),u()}catch(c){throw c}finally{s(),this.execEndTime=Date.now()}return this.isRunning=!1,this.getValue()},e.createErrorMessage=function(t,e,n){var r=t[1].replace("%0",String(e));return null!==n&&(r+=this.getNodePosition(n||this.lastExecNode)),r},e.createError=function(t,e){return new e(t)},e.createThrowError=function(t,e){return this.createError(t,e)},e.createInternalThrowError=function(t,e,n){return this.createError(this.createErrorMessage(t,e,n),t[2])},e.checkTimeout=function(){if(!this.isRunning)return!1;var t=this.options.timeout||0,e=Date.now();return e-this.execStartTime>t},e.getNodePosition=function(t){if(t){var e="";return t.loc?" ["+t.loc.start.line+":"+t.loc.start.column+"]"+e:""}return""},e.createClosure=function(t){var e,n=this;switch(t.type){case"BinaryExpression":e=this.binaryExpressionHandler(t);break;case"LogicalExpression":e=this.logicalExpressionHandler(t);break;case"UnaryExpression":e=this.unaryExpressionHandler(t);break;case"UpdateExpression":e=this.updateExpressionHandler(t);break;case"ObjectExpression":e=this.objectExpressionHandler(t);break;case"ArrayExpression":e=this.arrayExpressionHandler(t);break;case"CallExpression":e=this.callExpressionHandler(t);break;case"NewExpression":e=this.newExpressionHandler(t);break;case"MemberExpression":e=this.memberExpressionHandler(t);break;case"ThisExpression":e=this.thisExpressionHandler(t);break;case"SequenceExpression":e=this.sequenceExpressionHandler(t);break;case"Literal":e=this.literalHandler(t);break;case"Identifier":e=this.identifierHandler(t);break;case"AssignmentExpression":e=this.assignmentExpressionHandler(t);break;case"FunctionDeclaration":e=this.functionDeclarationHandler(t);break;case"VariableDeclaration":e=this.variableDeclarationHandler(t);break;case"BlockStatement":case"Program":e=this.programHandler(t);break;case"ExpressionStatement":e=this.expressionStatementHandler(t);break;case"EmptyStatement":e=this.emptyStatementHandler(t);break;case"ReturnStatement":e=this.returnStatementHandler(t);break;case"FunctionExpression":e=this.functionExpressionHandler(t);break;case"IfStatement":e=this.ifStatementHandler(t);break;case"ConditionalExpression":e=this.conditionalExpressionHandler(t);break;case"ForStatement":e=this.forStatementHandler(t);break;case"WhileStatement":e=this.whileStatementHandler(t);break;case"DoWhileStatement":e=this.doWhileStatementHandler(t);break;case"ForInStatement":e=this.forInStatementHandler(t);break;case"WithStatement":e=this.withStatementHandler(t);break;case"ThrowStatement":e=this.throwStatementHandler(t);break;case"TryStatement":e=this.tryStatementHandler(t);break;case"ContinueStatement":e=this.continueStatementHandler(t);break;case"BreakStatement":e=this.breakStatementHandler(t);break;case"SwitchStatement":e=this.switchStatementHandler(t);break;case"LabeledStatement":e=this.labeledStatementHandler(t);break;case"DebuggerStatement":e=this.debuggerStatementHandler(t);break;default:throw this.createInternalThrowError(we.NodeTypeSyntaxError,t.type,t)}return function(){var r=n.options.timeout;if(r&&r>0&&n.checkTimeout())throw n.createInternalThrowError(we.ExecutionTimeOutError,r,null);return n.lastExecNode=t,e.apply(void 0,arguments)}},e.binaryExpressionHandler=function(t){var e=this,n=this.createClosure(t.left),r=this.createClosure(t.right);return function(){var i=n(),o=r();switch(t.operator){case"==":return i==o;case"!=":return i!=o;case"===":return i===o;case"!==":return i!==o;case"<":return i<o;case"<=":return i<=o;case">":return i>o;case">=":return i>=o;case"<<":return i<<o;case">>":return i>>o;case">>>":return i>>>o;case"+":return i+o;case"-":return i-o;case"*":return i*o;case"**":return Math.pow(i,o);case"/":return i/o;case"%":return i%o;case"|":return i|o;case"^":return i^o;case"&":return i&o;case"in":return i in o;case"instanceof":return i instanceof o;default:throw e.createInternalThrowError(we.BinaryOperatorSyntaxError,t.operator,t)}}},e.logicalExpressionHandler=function(t){var e=this,n=this.createClosure(t.left),r=this.createClosure(t.right);return function(){switch(t.operator){case"||":return n()||r();case"&&":return n()&&r();default:throw e.createInternalThrowError(we.LogicalOperatorSyntaxError,t.operator,t)}}},e.unaryExpressionHandler=function(t){var e=this;switch(t.operator){case"delete":var n=this.createObjectGetter(t.argument),r=this.createNameGetter(t.argument);return function(){var t=n(),e=r();return delete t[e]};default:var o;if("typeof"===t.operator&&"Identifier"===t.argument.type){var a=this.createObjectGetter(t.argument),s=this.createNameGetter(t.argument);o=function(){return a()[s()]}}else o=this.createClosure(t.argument);return function(){var n=o();switch(t.operator){case"-":return-n;case"+":return+n;case"!":return!n;case"~":return~n;case"void":return;case"typeof":return(0,i.Z)(n);default:throw e.createInternalThrowError(we.UnaryOperatorSyntaxError,t.operator,t)}}}},e.updateExpressionHandler=function(t){var e=this,n=this.createObjectGetter(t.argument),r=this.createNameGetter(t.argument);return function(){var i=n(),o=r();switch(e.assertVariable(i,o,t),t.operator){case"++":return t.prefix?++i[o]:i[o]++;case"--":return t.prefix?--i[o]:i[o]--;default:throw e.createInternalThrowError(we.UpdateOperatorSyntaxError,t.operator,t)}}},e.objectExpressionHandler=function(t){var e=this,n=[];function r(t){return"Identifier"===t.type?t.name:"Literal"===t.type?t.value:this.throwError(we.ObjectStructureSyntaxError,t.type,t)}var i=Object.create(null);return t.properties.forEach((function(t){var o=t.kind,a=r(t.key);i[a]&&"init"!==o||(i[a]={}),i[a][o]=e.createClosure(t.value),n.push({key:a,property:t})})),function(){for(var t={},e=n.length,r=0;r<e;r++){var o=n[r],a=o.key,s=i[a],u=s.init?s.init():void 0,c=s.get?s.get():function(){},l=s.set?s.set():function(t){};if("set"in s||"get"in s){var h={configurable:!0,enumerable:!0,get:c,set:l};Object.defineProperty(t,a,h)}else{var f=o.property,p=f.kind;"Identifier"!==f.key.type||"FunctionExpression"!==f.value.type||"init"!==p||f.value.id||Ce(u,f.key.name),t[a]=u}}return t}},e.arrayExpressionHandler=function(t){var e=this,n=t.elements.map((function(t){return t?e.createClosure(t):t}));return function(){for(var t=n.length,e=Array(t),r=0;r<t;r++){var i=n[r];i&&(e[r]=i())}return e}},e.safeObjectGet=function(t,e,n){return t[e]},e.createCallFunctionGetter=function(t){var e=this;switch(t.type){case"MemberExpression":var n=this.createClosure(t.object),r=this.createMemberKeyGetter(t),i=this.source;return function(){var o=n(),a=r(),s=e.safeObjectGet(o,a,t);if(!s||!ze(s)){var u=i.slice(t.start,t.end);throw e.createInternalThrowError(we.FunctionUndefinedReferenceError,u,t)}return s.__IS_EVAL_FUNC?function(t){return s(new Fe(e),t,!0)}:s.__IS_FUNCTION_FUNC?function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return s.apply(void 0,[new Fe(e)].concat(n))}:s.bind(o)};default:var o=this.createClosure(t);return function(){var n="";"Identifier"===t.type&&(n=t.name);var r=o();if(!r||!ze(r))throw e.createInternalThrowError(we.FunctionUndefinedReferenceError,n,t);if("Identifier"===t.type&&r.__IS_EVAL_FUNC&&"eval"===n)return function(t){var i=e.getScopeFromName(n,e.getCurrentScope()),o=i.name===Oe||i.name===Ne||i.name===De;return r(new Fe(e),t,!o)};if(r.__IS_EVAL_FUNC)return function(t){return r(new Fe(e),t,!0)};if(r.__IS_FUNCTION_FUNC)return function(){for(var t=arguments.length,n=new Array(t),i=0;i<t;i++)n[i]=arguments[i];return r.apply(void 0,[new Fe(e)].concat(n))};var i=e.options.globalContextInFunction;if("Identifier"===t.type){var a=e.getIdentifierScope(t);a.name===Le&&(i=a.data)}return r.bind(i)}}},e.callExpressionHandler=function(t){var e=this,n=this.createCallFunctionGetter(t.callee),r=t.arguments.map((function(t){return e.createClosure(t)}));return function(){return n().apply(void 0,r.map((function(t){return t()})))}},e.functionExpressionHandler=function(t){var e=this,n=this,r=this.source,i=this.collectDeclVars,o=this.collectDeclFuncs;this.collectDeclVars=Object.create(null),this.collectDeclFuncs=Object.create(null);var a=t.id?t.id.name:"",s=t.params.length,u=t.params.map((function(t){return e.createParamNameGetter(t)})),c=this.createClosure(t.body),l=this.collectDeclVars,h=this.collectDeclFuncs;return this.collectDeclVars=i,this.collectDeclFuncs=o,function(){var e=n.getCurrentScope(),i=function t(){for(var r=arguments.length,i=new Array(r),o=0;o<r;o++)i[o]=arguments[o];n.callStack.push(""+a);var s=n.getCurrentScope(),f=We(e,"FunctionScope("+a+")");n.setCurrentScope(f),n.addDeclarationsToScope(l,h,f),a&&(f.data[a]=t),f.data["arguments"]=arguments,u.forEach((function(t,e){f.data[t()]=i[e]}));var p=n.getCurrentContext();n.setCurrentContext(this);var d=c();if(n.setCurrentContext(p),n.setCurrentScope(s),n.callStack.pop(),d instanceof je)return d.value};return Ce(i,a),Object.defineProperty(i,"length",{value:s,writable:!1,enumerable:!1,configurable:!0}),Object.defineProperty(i,"toString",{value:function(){return r.slice(t.start,t.end)},writable:!0,configurable:!0,enumerable:!1}),Object.defineProperty(i,"valueOf",{value:function(){return r.slice(t.start,t.end)},writable:!0,configurable:!0,enumerable:!1}),i}},e.newExpressionHandler=function(t){var e=this,n=this.source,r=this.createClosure(t.callee),i=t.arguments.map((function(t){return e.createClosure(t)}));return function(){var o=r();if(!ze(o)||o.__IS_EVAL_FUNC){var a=t.callee,s=n.slice(a.start,a.end);throw e.createInternalThrowError(we.IsNotConstructor,s,t)}return o.__IS_FUNCTION_FUNC?o.apply(void 0,[new Fe(e)].concat(i.map((function(t){return t()})))):Se(o,i.map((function(t){return t()})))}},e.memberExpressionHandler=function(t){var e=this.createClosure(t.object),n=this.createMemberKeyGetter(t);return function(){var t=e(),r=n();return t[r]}},e.thisExpressionHandler=function(t){var e=this;return function(){return e.getCurrentContext()}},e.sequenceExpressionHandler=function(t){var e=this,n=t.expressions.map((function(t){return e.createClosure(t)}));return function(){for(var t,e=n.length,r=0;r<e;r++){var i=n[r];t=i()}return t}},e.literalHandler=function(t){return function(){return t.regex?new RegExp(t.regex.pattern,t.regex.flags):t.value}},e.identifierHandler=function(t){var e=this;return function(){var n=e.getCurrentScope(),r=e.getScopeDataFromName(t.name,n);return e.assertVariable(r,t.name,t),r[t.name]}},e.getIdentifierScope=function(t){var e=this.getCurrentScope(),n=this.getScopeFromName(t.name,e);return n},e.assignmentExpressionHandler=function(t){var e=this;"Identifier"!==t.left.type||"FunctionExpression"!==t.right.type||t.right.id||(t.right.id={type:"Identifier",name:t.left.name});var n=this.createObjectGetter(t.left),r=this.createNameGetter(t.left),i=this.createClosure(t.right);return function(){var o=n(),a=r(),s=i();switch("="!==t.operator&&e.assertVariable(o,a,t),t.operator){case"=":return o[a]=s;case"+=":return o[a]+=s;case"-=":return o[a]-=s;case"*=":return o[a]*=s;case"**=":return o[a]=Math.pow(o[a],s);case"/=":return o[a]/=s;case"%=":return o[a]%=s;case"<<=":return o[a]<<=s;case">>=":return o[a]>>=s;case">>>=":return o[a]>>>=s;case"&=":return o[a]&=s;case"^=":return o[a]^=s;case"|=":return o[a]|=s;default:throw e.createInternalThrowError(we.AssignmentExpressionSyntaxError,t.type,t)}}},e.functionDeclarationHandler=function(t){if(t.id){var e=this.functionExpressionHandler(t);Object.defineProperty(e,"isFunctionDeclareClosure",{value:!0,writable:!1,configurable:!1,enumerable:!1}),this.funcDeclaration(t.id.name,e)}return function(){return Re}},e.getVariableName=function(t){if("Identifier"===t.type)return t.name;throw this.createInternalThrowError(we.VariableTypeSyntaxError,t.type,t)},e.variableDeclarationHandler=function(t){for(var e,n=this,r=[],i=0;i<t.declarations.length;i++){var o=t.declarations[i];this.varDeclaration(this.getVariableName(o.id)),o.init&&r.push({type:"AssignmentExpression",operator:"=",left:o.id,right:o.init})}return r.length&&(e=this.createClosure({type:"BlockStatement",body:r})),function(){if(e){var t=n.isVarDeclMode;n.isVarDeclMode=!0,e(),n.isVarDeclMode=t}return Re}},e.assertVariable=function(t,e,n){if(t===this.globalScope.data&&!(e in t))throw this.createInternalThrowError(we.VariableUndefinedReferenceError,e,n)},e.programHandler=function(t){var e=this,n=t.body.map((function(t){return e.createClosure(t)}));return function(){for(var t=Re,r=0;r<n.length;r++){var i=n[r],o=e.setValue(i());if(o!==Re&&(t=o,t instanceof je||t instanceof Ze||t instanceof Ve||t===Me||t===Pe))break}return t}},e.expressionStatementHandler=function(t){return this.createClosure(t.expression)},e.emptyStatementHandler=function(t){return function(){return Re}},e.returnStatementHandler=function(t){var e=t.argument?this.createClosure(t.argument):He;return function(){return new je(e())}},e.ifStatementHandler=function(t){var e=this.createClosure(t.test),n=this.createClosure(t.consequent),r=t.alternate?this.createClosure(t.alternate):function(){return Re};return function(){return e()?n():r()}},e.conditionalExpressionHandler=function(t){return this.ifStatementHandler(t)},e.forStatementHandler=function(t){var e=this,n=He,r=t.test?this.createClosure(t.test):function(){return!0},i=He,o=this.createClosure(t.body);return"ForStatement"===t.type&&(n=t.init?this.createClosure(t.init):n,i=t.update?this.createClosure(t.update):He),function(a){var s,u=Re,c="DoWhileStatement"===t.type;for(a&&"LabeledStatement"===a.type&&(s=a.label.name),n();c||r();i()){c=!1;var l=e.setValue(o());if(l!==Re&&l!==Pe){if(l===Me)break;if(u=l,u instanceof Ve&&u.value===s)u=Re;else if(u instanceof je||u instanceof Ze||u instanceof Ve)break}}return u}},e.whileStatementHandler=function(t){return this.forStatementHandler(t)},e.doWhileStatementHandler=function(t){return this.forStatementHandler(t)},e.forInStatementHandler=function(t){var e=this,n=t.left,r=this.createClosure(t.right),i=this.createClosure(t.body);return"VariableDeclaration"===t.left.type&&(this.createClosure(t.left)(),n=t.left.declarations[0].id),function(t){var o,a,s=Re;t&&"LabeledStatement"===t.type&&(o=t.label.name);var u=r();for(a in u){e.assignmentExpressionHandler({type:"AssignmentExpression",operator:"=",left:n,right:{type:"Literal",value:a}})();var c=e.setValue(i());if(c!==Re&&c!==Pe){if(c===Me)break;if(s=c,s instanceof Ve&&s.value===o)s=Re;else if(s instanceof je||s instanceof Ze||s instanceof Ve)break}}return s}},e.withStatementHandler=function(t){var e=this,n=this.createClosure(t.object),r=this.createClosure(t.body);return function(){var t=n(),i=e.getCurrentScope(),o=new Ge(t,i,Le);e.setCurrentScope(o);var a=e.setValue(r());return e.setCurrentScope(i),a}},e.throwStatementHandler=function(t){var e=this,n=this.createClosure(t.argument);return function(){throw e.setValue(void 0),n()}},e.tryStatementHandler=function(t){var e=this,n=this.createClosure(t.block),r=t.handler?this.catchClauseHandler(t.handler):null,i=t.finalizer?this.createClosure(t.finalizer):null;return function(){var t,o,a=e.getCurrentScope(),s=e.getCurrentContext(),u=a.labelStack.concat([]),c=e.callStack.concat([]),l=Re,h=function(){e.setCurrentScope(a),e.setCurrentContext(s),a.labelStack=u,e.callStack=c};try{l=e.setValue(n()),l instanceof je&&(t=l)}catch(f){if(h(),e.isInterruptThrow(f))throw f;if(r)try{l=e.setValue(r(f)),l instanceof je&&(t=l)}catch(f){if(h(),e.isInterruptThrow(f))throw f;o=f}}if(i)try{l=i(),l instanceof je&&(t=l)}catch(f){if(h(),e.isInterruptThrow(f))throw f;o=f}if(o)throw o;return t||l}},e.catchClauseHandler=function(t){var e=this,n=this.createParamNameGetter(t.param),r=this.createClosure(t.body);return function(t){var i,o=e.getCurrentScope(),a=o.data,s=n(),u=ke.call(a,s),c=a[s];return a[s]=t,i=r(),u?a[s]=c:delete a[s],i}},e.continueStatementHandler=function(t){return function(){return t.label?new Ve(t.label.name):Pe}},e.breakStatementHandler=function(t){return function(){return t.label?new Ze(t.label.name):Me}},e.switchStatementHandler=function(t){var e=this,n=this.createClosure(t.discriminant),r=t.cases.map((function(t){return e.switchCaseHandler(t)}));return function(){for(var t,i,o,a=n(),s=!1,u=0;u<r.length;u++){var c=r[u](),l=c.testClosure();if(l!==Ie){if(s||l===a){if(s=!0,i=e.setValue(c.bodyClosure()),i===Re)continue;if(i===Me)break;if(t=i,t instanceof je||t instanceof Ze||t instanceof Ve||t===Pe)break}}else o=c}if(!s&&o){i=e.setValue(o.bodyClosure());var h=i===Re||i===Me||i===Pe;h||(t=i)}return t}},e.switchCaseHandler=function(t){var e=t.test?this.createClosure(t.test):function(){return Ie},n=this.createClosure({type:"BlockStatement",body:t.consequent});return function(){return{testClosure:e,bodyClosure:n}}},e.labeledStatementHandler=function(t){var e=this,n=t.label.name,r=this.createClosure(t.body);return function(){var i,o=e.getCurrentScope();return o.labelStack.push(n),i=r(t),i instanceof Ze&&i.value===n&&(i=Re),o.labelStack.pop(),i}},e.debuggerStatementHandler=function(t){return function(){return Re}},e.createParamNameGetter=function(t){if("Identifier"===t.type)return function(){return t.name};throw this.createInternalThrowError(we.ParamTypeSyntaxError,t.type,t)},e.createObjectKeyGetter=function(t){var e;return e="Identifier"===t.type?function(){return t.name}:this.createClosure(t),function(){return e()}},e.createMemberKeyGetter=function(t){return t.computed?this.createClosure(t.property):this.createObjectKeyGetter(t.property)},e.createObjectGetter=function(t){var e=this;switch(t.type){case"Identifier":return function(){return e.getScopeDataFromName(t.name,e.getCurrentScope())};case"MemberExpression":return this.createClosure(t.object);default:throw this.createInternalThrowError(we.AssignmentTypeSyntaxError,t.type,t)}},e.createNameGetter=function(t){switch(t.type){case"Identifier":return function(){return t.name};case"MemberExpression":return this.createMemberKeyGetter(t);default:throw this.createInternalThrowError(we.AssignmentTypeSyntaxError,t.type,t)}},e.varDeclaration=function(t){var e=this.collectDeclVars;e[t]=void 0},e.funcDeclaration=function(t,e){var n=this.collectDeclFuncs;n[t]=e},e.addDeclarationsToScope=function(t,e,n){var r=n.data;for(var i in e){var o=e[i];r[i]=o?o():o}for(var a in t)a in r||(r[a]=void 0)},e.getScopeValue=function(t,e){var n=this.getScopeFromName(t,e);return n.data[t]},e.getScopeDataFromName=function(t,e){return this.getScopeFromName(t,e).data},e.getScopeFromName=function(t,e){var n=e;do{if(t in n.data)return n}while(n=n.parent);return this.globalScope},e.setValue=function(t){var e=this.callStack.length;return this.isVarDeclMode||e||t===Re||t===Me||t===Pe||t instanceof Ze||t instanceof Ve||(this.value=t instanceof je?t.value:t),t},e.getValue=function(){return this.value},t}();function Ke(t){return void 0===t&&(t=Object.create(null)),t}function Qe(t,e,n){void 0===e&&(e=[]),void 0===n&&(n={});var r=n.parsingContext,i=void 0===n.timeout?0:n.timeout,o="\n    (function anonymous("+e.join(",")+"){\n         "+t+"\n    });\n    ",a=new Ye(r,{ecmaVersion:n.ecmaVersion,timeout:i,rootContext:n.rootContext,globalContextInFunction:n.globalContextInFunction});return a.evaluate(o)}function Je(t,e,n){var r=new Ye(e,n);return r.evaluate(t)}Ye.version=Te,Ye.eval=Be,Ye.Function=Ue,Ye.ecmaVersion=5,Ye.globalContextInFunction=void 0,Ye.global=Object.create(null);var $e=Je,tn=function(){function t(t){this._code=t}var e=t.prototype;return e.runInContext=function(t){return Je(this._code,t)},e.runInNewContext=function(t){return Je(this._code,t)},t}(),en=function(t,e,n){return Je(t,e,n)};function nn(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];var r=e.pop();return Qe(r||"",e)}var rn=en},23941:function(t,e,n){var r,i=n(1692)["default"];n(21703),n(74916),n(15306),n(73210),n(57658),n(2707),function(o,a,s,u){"use strict";var c,l="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,h="undefined"!==typeof wx&&null!==wx&&("undefined"!==typeof wx.request||"undefined"!==typeof wx.miniProgram),f=l||h,p=["","webkit","Moz","MS","ms","o"],d=f?"":a.createElement("div"),v="function",m=Math.round,g=Math.abs,y=Date.now;function _(t,e,n){return setTimeout(T(t,n),e)}function x(t,e,n){return!!Array.isArray(t)&&(b(t,n[e],n),!0)}function b(t,e,n){var r;if(t)if(t.forEach)t.forEach(e,n);else if(t.length!==u){r=0;while(r<t.length)e.call(n,t[r],r,t),r++}else for(r in t)t.hasOwnProperty(r)&&e.call(n,t[r],r,t)}function w(t,e,n){var r="DEPRECATED METHOD: "+e+"\n"+n+" AT \n";return function(){var e=new Error("get-stack-trace"),n=e&&e.stack?e.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",i=o.console&&(o.console.warn||o.console.log);return i&&i.call(o.console,r,n),t.apply(this,arguments)}}c="function"!==typeof Object.assign?function(t){if(t===u||null===t)throw new TypeError("Cannot convert undefined or null to object");for(var e=Object(t),n=1;n<arguments.length;n++){var r=arguments[n];if(r!==u&&null!==r)for(var i in r)r.hasOwnProperty(i)&&(e[i]=r[i])}return e}:Object.assign;var E=w((function(t,e,n){var r=Object.keys(e),i=0;while(i<r.length)(!n||n&&t[r[i]]===u)&&(t[r[i]]=e[r[i]]),i++;return t}),"extend","Use `assign`."),S=w((function(t,e){return E(t,e,!0)}),"merge","Use `assign`.");function A(t,e,n){var r,i=e.prototype;r=t.prototype=Object.create(i),r.constructor=t,r._super=i,n&&c(r,n)}function T(t,e){return function(){return t.apply(e,arguments)}}function C(t,e){return i(t)==v?t.apply(e&&e[0]||u,e):t}function k(t,e){return t===u?e:t}function M(t,e,n){b(L(e),(function(e){t.addEventListener(e,n,!1)}))}function P(t,e,n){b(L(e),(function(e){t.removeEventListener(e,n,!1)}))}function I(t,e){while(t){if(t==e)return!0;t=t.parentNode}return!1}function R(t,e){return t.indexOf(e)>-1}function L(t){return t.trim().split(/\s+/g)}function O(t,e,n){if(t.indexOf&&!n)return t.indexOf(e);var r=0;while(r<t.length){if(n&&t[r][n]==e||!n&&t[r]===e)return r;r++}return-1}function D(t){return Array.prototype.slice.call(t,0)}function N(t,e,n){var r=[],i=[],o=0;while(o<t.length){var a=e?t[o][e]:t[o];O(i,a)<0&&r.push(t[o]),i[o]=a,o++}return n&&(r=e?r.sort((function(t,n){return t[e]>n[e]})):r.sort()),r}function z(t,e){var n,r,i=e[0].toUpperCase()+e.slice(1),o=0;while(o<p.length){if(n=p[o],r=n?n+i:e,r in t)return r;o++}return u}var F=1;function B(){return F++}function U(t){var e=t.ownerDocument||t;return e.defaultView||e.parentWindow||o}var j=/mobile|tablet|ip(ad|hone|od)|android/i,Z="ontouchstart"in o,V=z(o,"PointerEvent")!==u,G=Z&&j.test(navigator.userAgent),H="touch",W="pen",q="mouse",X="kinect",Y=25,K=1,Q=2,J=4,$=8,tt=1,et=2,nt=4,rt=8,it=16,ot=et|nt,at=rt|it,st=ot|at,ut=["x","y"],ct=["clientX","clientY"];function lt(t,e){var n=this;this.manager=t,this.callback=e,this.element=t.element,this.target=t.options.inputTarget,this.domHandler=function(e){C(t.options.enable,[t])&&n.handler(e)},this.init()}function ht(t){var e,n=t.options.inputClass;return e=n||(V?Rt:G?Ut:Z?Gt:Ct),new e(t,ft)}function ft(t,e,n){var r=n.pointers.length,i=n.changedPointers.length,o=e&K&&r-i===0,a=e&(J|$)&&r-i===0;n.isFirst=!!o,n.isFinal=!!a,o&&(t.session={}),n.eventType=e,pt(t,n),t.emit("hammer.input",n),t.recognize(n),t.session.prevInput=n}function pt(t,e){var n=t.session,r=e.pointers,i=r.length;n.firstInput||(n.firstInput=mt(e)),i>1&&!n.firstMultiple?n.firstMultiple=mt(e):1===i&&(n.firstMultiple=!1);var o=n.firstInput,a=n.firstMultiple,s=a?a.center:o.center,u=e.center=gt(r);e.timeStamp=y(),e.deltaTime=e.timeStamp-o.timeStamp,e.angle=bt(s,u),e.distance=xt(s,u),dt(n,e),e.offsetDirection=_t(e.deltaX,e.deltaY);var c=yt(e.deltaTime,e.deltaX,e.deltaY);e.overallVelocityX=c.x,e.overallVelocityY=c.y,e.overallVelocity=g(c.x)>g(c.y)?c.x:c.y,e.scale=a?Et(a.pointers,r):1,e.rotation=a?wt(a.pointers,r):0,e.maxPointers=n.prevInput?e.pointers.length>n.prevInput.maxPointers?e.pointers.length:n.prevInput.maxPointers:e.pointers.length,vt(n,e);var l=t.element;I(e.srcEvent.target,l)&&(l=e.srcEvent.target),e.target=l}function dt(t,e){var n=e.center,r=t.offsetDelta||{},i=t.prevDelta||{},o=t.prevInput||{};e.eventType!==K&&o.eventType!==J||(i=t.prevDelta={x:o.deltaX||0,y:o.deltaY||0},r=t.offsetDelta={x:n.x,y:n.y}),e.deltaX=i.x+(n.x-r.x),e.deltaY=i.y+(n.y-r.y)}function vt(t,e){var n,r,i,o,a=t.lastInterval||e,s=e.timeStamp-a.timeStamp;if(e.eventType!=$&&(s>Y||a.velocity===u)){var c=e.deltaX-a.deltaX,l=e.deltaY-a.deltaY,h=yt(s,c,l);r=h.x,i=h.y,n=g(h.x)>g(h.y)?h.x:h.y,o=_t(c,l),t.lastInterval=e}else n=a.velocity,r=a.velocityX,i=a.velocityY,o=a.direction;e.velocity=n,e.velocityX=r,e.velocityY=i,e.direction=o}function mt(t){var e=[],n=0;while(n<t.pointers.length)e[n]={clientX:m(t.pointers[n].clientX),clientY:m(t.pointers[n].clientY)},n++;return{timeStamp:y(),pointers:e,center:gt(e),deltaX:t.deltaX,deltaY:t.deltaY}}function gt(t){var e=t.length;if(1===e)return{x:m(t[0].clientX),y:m(t[0].clientY)};var n=0,r=0,i=0;while(i<e)n+=t[i].clientX,r+=t[i].clientY,i++;return{x:m(n/e),y:m(r/e)}}function yt(t,e,n){return{x:e/t||0,y:n/t||0}}function _t(t,e){return t===e?tt:g(t)>=g(e)?t<0?et:nt:e<0?rt:it}function xt(t,e,n){n||(n=ut);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return Math.sqrt(r*r+i*i)}function bt(t,e,n){n||(n=ut);var r=e[n[0]]-t[n[0]],i=e[n[1]]-t[n[1]];return 180*Math.atan2(i,r)/Math.PI}function wt(t,e){return bt(e[1],e[0],ct)+bt(t[1],t[0],ct)}function Et(t,e){return xt(e[0],e[1],ct)/xt(t[0],t[1],ct)}lt.prototype={handler:function(){},init:function(){this.evEl&&M(this.element,this.evEl,this.domHandler),this.evTarget&&M(this.target,this.evTarget,this.domHandler),this.evWin&&M(U(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&P(this.element,this.evEl,this.domHandler),this.evTarget&&P(this.target,this.evTarget,this.domHandler),this.evWin&&P(U(this.element),this.evWin,this.domHandler)}};var St={mousedown:K,mousemove:Q,mouseup:J},At="mousedown",Tt="mousemove mouseup";function Ct(){this.evEl=At,this.evWin=Tt,this.pressed=!1,lt.apply(this,arguments)}A(Ct,lt,{handler:function(t){var e=St[t.type];e&K&&0===t.button&&(this.pressed=!0),e&Q&&1!==t.which&&(e=J),this.pressed&&(e&J&&(this.pressed=!1),this.callback(this.manager,e,{pointers:[t],changedPointers:[t],pointerType:q,srcEvent:t}))}});var kt={pointerdown:K,pointermove:Q,pointerup:J,pointercancel:$,pointerout:$},Mt={2:H,3:W,4:q,5:X},Pt="pointerdown",It="pointermove pointerup pointercancel";function Rt(){this.evEl=Pt,this.evWin=It,lt.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}f||!o.MSPointerEvent||o.PointerEvent||(Pt="MSPointerDown",It="MSPointerMove MSPointerUp MSPointerCancel"),A(Rt,lt,{handler:function(t){var e=this.store,n=!1,r=t.type.toLowerCase().replace("ms",""),i=kt[r],o=Mt[t.pointerType]||t.pointerType,a=o==H,s=O(e,t.pointerId,"pointerId");i&K&&(0===t.button||a)?s<0&&(e.push(t),s=e.length-1):i&(J|$)&&(n=!0),s<0||(e[s]=t,this.callback(this.manager,i,{pointers:e,changedPointers:[t],pointerType:o,srcEvent:t}),n&&e.splice(s,1))}});var Lt={touchstart:K,touchmove:Q,touchend:J,touchcancel:$},Ot="touchstart",Dt="touchstart touchmove touchend touchcancel";function Nt(){this.evTarget=Ot,this.evWin=Dt,this.started=!1,lt.apply(this,arguments)}function zt(t,e){var n=D(t.touches),r=D(t.changedTouches);return e&(J|$)&&(n=N(n.concat(r),"identifier",!0)),[n,r]}A(Nt,lt,{handler:function(t){var e=Lt[t.type];if(e===K&&(this.started=!0),this.started){var n=zt.call(this,t,e);e&(J|$)&&n[0].length-n[1].length===0&&(this.started=!1),this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:H,srcEvent:t})}}});var Ft={touchstart:K,touchmove:Q,touchend:J,touchcancel:$},Bt="touchstart touchmove touchend touchcancel";function Ut(){this.evTarget=Bt,this.targetIds={},lt.apply(this,arguments)}function jt(t,e){var n=D(t.touches),r=this.targetIds;if(e&(K|Q)&&1===n.length)return r[n[0].identifier]=!0,[n,n];var i,o,a=D(t.changedTouches),s=[],u=this.target;if(o=n.filter((function(t){return I(t.target,u)})),e===K){i=0;while(i<o.length)r[o[i].identifier]=!0,i++}i=0;while(i<a.length)r[a[i].identifier]&&s.push(a[i]),e&(J|$)&&delete r[a[i].identifier],i++;return s.length?[N(o.concat(s),"identifier",!0),s]:void 0}A(Ut,lt,{handler:function(t){var e=Ft[t.type],n=jt.call(this,t,e);n&&this.callback(this.manager,e,{pointers:n[0],changedPointers:n[1],pointerType:H,srcEvent:t})}});var Zt=2500,Vt=25;function Gt(){lt.apply(this,arguments);var t=T(this.handler,this);this.touch=new Ut(this.manager,t),this.mouse=new Ct(this.manager,t),this.primaryTouch=null,this.lastTouches=[]}function Ht(t,e){t&K?(this.primaryTouch=e.changedPointers[0].identifier,Wt.call(this,e)):t&(J|$)&&Wt.call(this,e)}function Wt(t){var e=t.changedPointers[0];if(e.identifier===this.primaryTouch){var n={x:e.clientX,y:e.clientY};this.lastTouches.push(n);var r=this.lastTouches,i=function(){var t=r.indexOf(n);t>-1&&r.splice(t,1)};setTimeout(i,Zt)}}function qt(t){for(var e=t.srcEvent.clientX,n=t.srcEvent.clientY,r=0;r<this.lastTouches.length;r++){var i=this.lastTouches[r],o=Math.abs(e-i.x),a=Math.abs(n-i.y);if(o<=Vt&&a<=Vt)return!0}return!1}A(Gt,lt,{handler:function(t,e,n){var r=n.pointerType==H,i=n.pointerType==q;if(!(i&&n.sourceCapabilities&&n.sourceCapabilities.firesTouchEvents)){if(r)Ht.call(this,e,n);else if(i&&qt.call(this,n))return;this.callback(t,e,n)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});var Xt=f?u:z(d.style,"touchAction"),Yt=Xt!==u,Kt="compute",Qt="auto",Jt="manipulation",$t="none",te="pan-x",ee="pan-y",ne=oe();function re(t,e){this.manager=t,this.set(e)}function ie(t){if(R(t,$t))return $t;var e=R(t,te),n=R(t,ee);return e&&n?$t:e||n?e?te:ee:R(t,Jt)?Jt:Qt}function oe(){if(!Yt)return!1;var t={};if(f)return t;var e=o.CSS&&o.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach((function(n){t[n]=!e||o.CSS.supports("touch-action",n)})),t}re.prototype={set:function(t){t==Kt&&(t=this.compute()),Yt&&this.manager.element.style&&ne[t]&&(this.manager.element.style[Xt]=t),this.actions=t.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var t=[];return b(this.manager.recognizers,(function(e){C(e.options.enable,[e])&&(t=t.concat(e.getTouchAction()))})),ie(t.join(" "))},preventDefaults:function(t){var e=t.srcEvent,n=t.offsetDirection;if(this.manager.session.prevented)e.preventDefault();else{var r=this.actions,i=R(r,$t)&&!ne[$t],o=R(r,ee)&&!ne[ee],a=R(r,te)&&!ne[te];if(i){var s=1===t.pointers.length,u=t.distance<2,c=t.deltaTime<250;if(s&&u&&c)return}if(!a||!o)return i||o&&n&ot||a&&n&at?this.preventSrc(e):void 0}},preventSrc:function(t){this.manager.session.prevented=!0,t.preventDefault()}};var ae=1,se=2,ue=4,ce=8,le=ce,he=16,fe=32;function pe(t){this.options=c({},this.defaults,t||{}),this.id=B(),this.manager=null,this.options.enable=k(this.options.enable,!0),this.state=ae,this.simultaneous={},this.requireFail=[]}function de(t){return t&he?"cancel":t&ce?"end":t&ue?"move":t&se?"start":""}function ve(t){return t==it?"down":t==rt?"up":t==et?"left":t==nt?"right":""}function me(t,e){var n=e.manager;return n?n.get(t):t}function ge(){pe.apply(this,arguments)}function ye(){ge.apply(this,arguments),this.pX=null,this.pY=null}function _e(){ge.apply(this,arguments)}function xe(){pe.apply(this,arguments),this._timer=null,this._input=null}function be(){ge.apply(this,arguments)}function we(){ge.apply(this,arguments)}function Ee(){pe.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}function Se(t,e){return e=e||{},e.recognizers=k(e.recognizers,Se.defaults.preset),new Ce(t,e)}pe.prototype={defaults:{},set:function(t){return c(this.options,t),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(t){if(x(t,"recognizeWith",this))return this;var e=this.simultaneous;return t=me(t,this),e[t.id]||(e[t.id]=t,t.recognizeWith(this)),this},dropRecognizeWith:function(t){return x(t,"dropRecognizeWith",this)||(t=me(t,this),delete this.simultaneous[t.id]),this},requireFailure:function(t){if(x(t,"requireFailure",this))return this;var e=this.requireFail;return t=me(t,this),-1===O(e,t)&&(e.push(t),t.requireFailure(this)),this},dropRequireFailure:function(t){if(x(t,"dropRequireFailure",this))return this;t=me(t,this);var e=O(this.requireFail,t);return e>-1&&this.requireFail.splice(e,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(t){return!!this.simultaneous[t.id]},emit:function(t){var e=this,n=this.state;function r(n){e.manager.emit(n,t)}n<ce&&r(e.options.event+de(n)),r(e.options.event),t.additionalEvent&&r(t.additionalEvent),n>=ce&&r(e.options.event+de(n))},tryEmit:function(t){if(this.canEmit())return this.emit(t);this.state=fe},canEmit:function(){var t=0;while(t<this.requireFail.length){if(!(this.requireFail[t].state&(fe|ae)))return!1;t++}return!0},recognize:function(t){var e=c({},t);if(!C(this.options.enable,[this,e]))return this.reset(),void(this.state=fe);this.state&(le|he|fe)&&(this.state=ae),this.state=this.process(e),this.state&(se|ue|ce|he)&&this.tryEmit(e)},process:function(t){},getTouchAction:function(){},reset:function(){}},A(ge,pe,{defaults:{pointers:1},attrTest:function(t){var e=this.options.pointers;return 0===e||t.pointers.length===e},process:function(t){var e=this.state,n=t.eventType,r=e&(se|ue),i=this.attrTest(t);return r&&(n&$||!i)?e|he:r||i?n&J?e|ce:e&se?e|ue:se:fe}}),A(ye,ge,{defaults:{event:"pan",threshold:10,pointers:1,direction:st},getTouchAction:function(){var t=this.options.direction,e=[];return t&ot&&e.push(ee),t&at&&e.push(te),e},directionTest:function(t){var e=this.options,n=!0,r=t.distance,i=t.direction,o=t.deltaX,a=t.deltaY;return i&e.direction||(e.direction&ot?(i=0===o?tt:o<0?et:nt,n=o!=this.pX,r=Math.abs(t.deltaX)):(i=0===a?tt:a<0?rt:it,n=a!=this.pY,r=Math.abs(t.deltaY))),t.direction=i,n&&r>e.threshold&&i&e.direction},attrTest:function(t){return ge.prototype.attrTest.call(this,t)&&(this.state&se||!(this.state&se)&&this.directionTest(t))},emit:function(t){this.pX=t.deltaX,this.pY=t.deltaY;var e=ve(t.direction);e&&(t.additionalEvent=this.options.event+e),this._super.emit.call(this,t)}}),A(_e,ge,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[$t]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.scale-1)>this.options.threshold||this.state&se)},emit:function(t){if(1!==t.scale){var e=t.scale<1?"in":"out";t.additionalEvent=this.options.event+e}this._super.emit.call(this,t)}}),A(xe,pe,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[Qt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime>e.time;if(this._input=t,!r||!n||t.eventType&(J|$)&&!i)this.reset();else if(t.eventType&K)this.reset(),this._timer=_((function(){this.state=le,this.tryEmit()}),e.time,this);else if(t.eventType&J)return le;return fe},reset:function(){clearTimeout(this._timer)},emit:function(t){this.state===le&&(t&&t.eventType&J?this.manager.emit(this.options.event+"up",t):(this._input.timeStamp=y(),this.manager.emit(this.options.event,this._input)))}}),A(be,ge,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[$t]},attrTest:function(t){return this._super.attrTest.call(this,t)&&(Math.abs(t.rotation)>this.options.threshold||this.state&se)}}),A(we,ge,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:ot|at,pointers:1},getTouchAction:function(){return ye.prototype.getTouchAction.call(this)},attrTest:function(t){var e,n=this.options.direction;return n&(ot|at)?e=t.overallVelocity:n&ot?e=t.overallVelocityX:n&at&&(e=t.overallVelocityY),this._super.attrTest.call(this,t)&&n&t.offsetDirection&&t.distance>this.options.threshold&&t.maxPointers==this.options.pointers&&g(e)>this.options.velocity&&t.eventType&J},emit:function(t){var e=ve(t.offsetDirection);e&&this.manager.emit(this.options.event+e,t),this.manager.emit(this.options.event,t)}}),A(Ee,pe,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[Jt]},process:function(t){var e=this.options,n=t.pointers.length===e.pointers,r=t.distance<e.threshold,i=t.deltaTime<e.time;if(this.reset(),t.eventType&K&&0===this.count)return this.failTimeout();if(r&&i&&n){if(t.eventType!=J)return this.failTimeout();var o=!this.pTime||t.timeStamp-this.pTime<e.interval,a=!this.pCenter||xt(this.pCenter,t.center)<e.posThreshold;this.pTime=t.timeStamp,this.pCenter=t.center,a&&o?this.count+=1:this.count=1,this._input=t;var s=this.count%e.taps;if(0===s)return this.hasRequireFailures()?(this._timer=_((function(){this.state=le,this.tryEmit()}),e.interval,this),se):le}return fe},failTimeout:function(){return this._timer=_((function(){this.state=fe}),this.options.interval,this),fe},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==le&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}}),Se.VERSION="2.0.7",Se.defaults={domEvents:!1,touchAction:Kt,enable:!0,inputTarget:null,inputClass:null,preset:[[be,{enable:!1}],[_e,{enable:!1},["rotate"]],[we,{direction:ot}],[ye,{direction:ot},["swipe"]],[Ee],[Ee,{event:"doubletap",taps:2},["tap"]],[xe]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var Ae=1,Te=2;function Ce(t,e){this.options=c({},Se.defaults,e||{}),this.options.inputTarget=this.options.inputTarget||t,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=t,this.input=ht(this),this.touchAction=new re(this,this.options.touchAction),ke(this,!0),b(this.options.recognizers,(function(t){var e=this.add(new t[0](t[1]));t[2]&&e.recognizeWith(t[2]),t[3]&&e.requireFailure(t[3])}),this)}function ke(t,e){var n,r=t.element;r.style&&(b(t.options.cssProps,(function(i,o){n=z(r.style,o),e?(t.oldCssProps[n]=r.style[n],r.style[n]=i):r.style[n]=t.oldCssProps[n]||""})),e||(t.oldCssProps={}))}function Me(t,e){if(!f){var n=a.createEvent("Event");n.initEvent(t,!0,!0),n.gesture=e,e.target.dispatchEvent(n)}}if(Ce.prototype={set:function(t){return c(this.options,t),t.touchAction&&this.touchAction.update(),t.inputTarget&&(this.input.destroy(),this.input.target=t.inputTarget,this.input.init()),this},stop:function(t){this.session.stopped=t?Te:Ae},recognize:function(t){var e=this.session;if(!e.stopped){var n;this.touchAction.preventDefaults(t);var r=this.recognizers,i=e.curRecognizer;(!i||i&&i.state&le)&&(i=e.curRecognizer=null);var o=0;while(o<r.length)n=r[o],e.stopped===Te||i&&n!=i&&!n.canRecognizeWith(i)?n.reset():n.recognize(t),!i&&n.state&(se|ue|ce)&&(i=e.curRecognizer=n),o++}},get:function(t){if(t instanceof pe)return t;for(var e=this.recognizers,n=0;n<e.length;n++)if(e[n].options.event==t)return e[n];return null},add:function(t){if(x(t,"add",this))return this;var e=this.get(t.options.event);return e&&this.remove(e),this.recognizers.push(t),t.manager=this,this.touchAction.update(),t},remove:function(t){if(x(t,"remove",this))return this;if(t=this.get(t),t){var e=this.recognizers,n=O(e,t);-1!==n&&(e.splice(n,1),this.touchAction.update())}return this},on:function(t,e){if(t!==u&&e!==u){var n=this.handlers;return b(L(t),(function(t){n[t]=n[t]||[],n[t].push(e)})),this}},off:function(t,e){if(t!==u){var n=this.handlers;return b(L(t),(function(t){e?n[t]&&n[t].splice(O(n[t],e),1):delete n[t]})),this}},emit:function(t,e){this.options.domEvents&&Me(t,e);var n=this.handlers[t]&&this.handlers[t].slice();if(n&&n.length){e.type=t,e.preventDefault=function(){e.srcEvent.preventDefault()};var r=0;while(r<n.length)n[r](e),r++}},destroy:function(){this.element&&ke(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}},!f){c(Se,{INPUT_START:K,INPUT_MOVE:Q,INPUT_END:J,INPUT_CANCEL:$,STATE_POSSIBLE:ae,STATE_BEGAN:se,STATE_CHANGED:ue,STATE_ENDED:ce,STATE_RECOGNIZED:le,STATE_CANCELLED:he,STATE_FAILED:fe,DIRECTION_NONE:tt,DIRECTION_LEFT:et,DIRECTION_RIGHT:nt,DIRECTION_UP:rt,DIRECTION_DOWN:it,DIRECTION_HORIZONTAL:ot,DIRECTION_VERTICAL:at,DIRECTION_ALL:st,Manager:Ce,Input:lt,TouchAction:re,TouchInput:Ut,MouseInput:Ct,PointerEventInput:Rt,TouchMouseInput:Gt,SingleTouchInput:Nt,Recognizer:pe,AttrRecognizer:ge,Tap:Ee,Pan:ye,Swipe:we,Pinch:_e,Rotate:be,Press:xe,on:M,off:P,each:b,merge:S,extend:E,assign:c,inherit:A,bindFn:T,prefixed:z});var Pe="undefined"!==typeof window?window:"undefined"!==typeof self?self:{};Pe.Hammer=Se,r=function(){return Se}.call(e,n,e,t),r===u||(t.exports=r)}}("undefined"!==typeof window?window:{console:null,MSPointerEvent:null,PointerEvent:null,CSS:null},document)},98999:function(t,e,n){var r,i,o,a=n(1692)["default"];n(39575),n(82472),n(48675),n(33105),n(63408),n(14590),n(3462),n(33824),n(23767),n(8585),n(68696),n(8255),n(29135),n(87145),n(35109),n(65125),n(44197),n(76495),n(49743),n(87714),n(82801),n(1174),n(21703),n(74916),n(57658),n(73210),n(15306),n(18264),n(2707),n(38862),function(s,u){"object"===a(e)?t.exports=u(n(33671)):(i=[n(33671)],r=u,o="function"===typeof r?r.apply(e,i):r,void 0===o||(t.exports=o))}(0,(function(t){"use strict";var e=function(t){return t instanceof Uint8Array||t instanceof Uint16Array||t instanceof Uint32Array||t instanceof Int8Array||t instanceof Int16Array||t instanceof Int32Array||t instanceof Float32Array||t instanceof Float64Array||t instanceof Uint8ClampedArray},n=function(t,e){for(var n=Object.keys(e),r=0;r<n.length;++r)t[n[r]]=e[n[r]];return t},r="\n";function i(t){return"undefined"!==typeof atob?atob(t):"base64:"+t}function o(t){var e=new Error("(regl) "+t);throw e}function s(t,e){t||o(e)}function u(t){return t?": "+t:""}function c(t,e,n){t in e||o("unknown parameter ("+t+")"+u(n)+". possible values: "+Object.keys(e).join())}function l(t,n){e(t)||o("invalid parameter type"+u(n)+". must be a typed array")}function h(t,e){switch(e){case"number":return"number"===typeof t;case"object":return"object"===a(t);case"string":return"string"===typeof t;case"boolean":return"boolean"===typeof t;case"function":return"function"===typeof t;case"undefined":return"undefined"===typeof t;case"symbol":return"symbol"===a(t)}}function f(t,e,n){h(t,e)||o("invalid parameter type"+u(n)+". expected "+e+", got "+a(t))}function p(t,e){t>=0&&(0|t)===t||o("invalid parameter type, ("+t+")"+u(e)+". must be a nonnegative integer")}function d(t,e,n){e.indexOf(t)<0&&o("invalid value"+u(n)+". must be one of: "+e)}var v=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function m(t){Object.keys(t).forEach((function(t){v.indexOf(t)<0&&o('invalid regl constructor argument "'+t+'". must be one of '+v)}))}function g(t,e){t+="";while(t.length<e)t=" "+t;return t}function y(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function _(t,e){this.number=t,this.line=e,this.errors=[]}function x(t,e,n){this.file=t,this.line=e,this.message=n}function b(){var t=new Error,e=(t.stack||t).toString(),n=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(e);return r?r[1]:"unknown"}function w(){var t=new Error,e=(t.stack||t).toString(),n=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(e);if(n)return n[1];var r=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(e);return r?r[1]:"unknown"}function E(t,e){var n=t.split("\n"),r=1,o=0,a={unknown:new y,0:new y};a.unknown.name=a[0].name=e||b(),a.unknown.lines.push(new _(0,""));for(var s=0;s<n.length;++s){var u=n[s],c=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(u);if(c)switch(c[1]){case"line":var l=/(\d+)(\s+\d+)?/.exec(c[2]);l&&(r=0|l[1],l[2]&&(o=0|l[2],o in a||(a[o]=new y)));break;case"define":var h=/SHADER_NAME(_B64)?\s+(.*)$/.exec(c[2]);h&&(a[o].name=h[1]?i(h[2]):h[2]);break}a[o].lines.push(new _(r++,u))}return Object.keys(a).forEach((function(t){var e=a[t];e.lines.forEach((function(t){e.index[t.number]=t}))})),a}function S(t){var e=[];return t.split("\n").forEach((function(t){if(!(t.length<5)){var n=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(t);n?e.push(new x(0|n[1],0|n[2],n[3].trim())):t.length>0&&e.push(new x("unknown",0,t))}})),e}function A(t,e){e.forEach((function(e){var n=t[e.file];if(n){var r=n.index[e.line];if(r)return r.errors.push(e),void(n.hasErrors=!0)}t.unknown.hasErrors=!0,t.unknown.lines[0].errors.push(e)}))}function T(t,e,n,i,o){if(!t.getShaderParameter(e,t.COMPILE_STATUS)){var a=t.getShaderInfoLog(e),u=i===t.FRAGMENT_SHADER?"fragment":"vertex";L(n,"string",u+" shader source must be a string",o);var c=E(n,o),l=S(a);A(c,l),Object.keys(c).forEach((function(t){var e=c[t];if(e.hasErrors){var n=[""],i=[""];o("file number "+t+": "+e.name+"\n","color:red;text-decoration:underline;font-weight:bold"),e.lines.forEach((function(t){if(t.errors.length>0){o(g(t.number,4)+"|  ","background-color:yellow; font-weight:bold"),o(t.line+r,"color:red; background-color:yellow; font-weight:bold");var e=0;t.errors.forEach((function(n){var i=n.message,a=/^\s*'(.*)'\s*:\s*(.*)$/.exec(i);if(a){var s=a[1];switch(i=a[2],s){case"assign":s="=";break}e=Math.max(t.line.indexOf(s,e),0)}else e=0;o(g("| ",6)),o(g("^^^",e+3)+r,"font-weight:bold"),o(g("| ",6)),o(i+r,"font-weight:bold")})),o(g("| ",6)+r)}else o(g(t.number,4)+"|  "),o(t.line+r,"color:red")})),"undefined"===typeof document||window.chrome||(i[0]=n.join("%c"))}function o(t,e){n.push(t),i.push(e||"")}})),s.raise("Error compiling "+u+" shader, "+c[0].name)}}function C(t,e,n,r,i){if(!t.getProgramParameter(e,t.LINK_STATUS)){t.getProgramInfoLog(e);var o=E(n,i),a=E(r,i),u='Error linking program with vertex shader, "'+a[0].name+'", and fragment shader "'+o[0].name+'"';s.raise(u)}}function k(t){t._commandRef=b()}function M(t,e,n,r){function i(t){return t?r.id(t):0}function o(t,e){Object.keys(e).forEach((function(e){t[r.id(e)]=!0}))}k(t),t._fragId=i(t.static.frag),t._vertId=i(t.static.vert);var a=t._uniformSet={};o(a,e.static),o(a,e.dynamic);var s=t._attributeSet={};o(s,n.static),o(s,n.dynamic),t._hasCount="count"in t.static||"count"in t.dynamic||"elements"in t.static||"elements"in t.dynamic}function P(t,e){var n=w();o(t+" in command "+(e||b())+("unknown"===n?"":" called from "+n))}function I(t,e,n){t||P(e,n||b())}function R(t,e,n,r){t in e||P("unknown parameter ("+t+")"+u(n)+". possible values: "+Object.keys(e).join(),r||b())}function L(t,e,n,r){h(t,e)||P("invalid parameter type"+u(n)+". expected "+e+", got "+a(t),r||b())}function O(t){t()}function D(t,e,n){t.texture?d(t.texture._texture.internalformat,e,"unsupported texture format for attachment"):d(t.renderbuffer._renderbuffer.format,n,"unsupported renderbuffer format for attachment")}var N=33071,z=9728,F=9984,B=9985,U=9986,j=9987,Z=5120,V=5121,G=5122,H=5123,W=5124,q=5125,X=5126,Y=32819,K=32820,Q=33635,J=34042,$=36193,tt={};function et(t,e){return t===K||t===Y||t===Q?2:t===J?4:tt[t]*e}function nt(t){return!(t&t-1)&&!!t}function rt(t,e,n){var r,i=e.width,o=e.height,a=e.channels;s(i>0&&i<=n.maxTextureSize&&o>0&&o<=n.maxTextureSize,"invalid texture shape"),t.wrapS===N&&t.wrapT===N||s(nt(i)&&nt(o),"incompatible wrap mode for texture, both width and height must be power of 2"),1===e.mipmask?1!==i&&1!==o&&s(t.minFilter!==F&&t.minFilter!==U&&t.minFilter!==B&&t.minFilter!==j,"min filter requires mipmap"):(s(nt(i)&&nt(o),"texture must be a square power of 2 to support mipmapping"),s(e.mipmask===(i<<1)-1,"missing or incomplete mipmap data")),e.type===X&&(n.extensions.indexOf("oes_texture_float_linear")<0&&s(t.minFilter===z&&t.magFilter===z,"filter not supported, must enable oes_texture_float_linear"),s(!t.genMipmaps,"mipmap generation not supported with float textures"));var u=e.images;for(r=0;r<16;++r)if(u[r]){var c=i>>r,l=o>>r;s(e.mipmask&1<<r,"missing mipmap data");var h=u[r];if(s(h.width===c&&h.height===l,"invalid shape for mip images"),s(h.format===e.format&&h.internalformat===e.internalformat&&h.type===e.type,"incompatible type for mip image"),h.compressed);else if(h.data){var f=Math.ceil(et(h.type,a)*c/h.unpackAlignment)*h.unpackAlignment;s(h.data.byteLength===f*l,"invalid data for image, buffer size is inconsistent with image format")}else h.element||h.copy}else t.genMipmaps||s(0===(e.mipmask&1<<r),"extra mipmap data");e.compressed&&s(!t.genMipmaps,"mipmap generation for compressed images not supported")}function it(t,e,n,r){var i=t.width,o=t.height,a=t.channels;s(i>0&&i<=r.maxTextureSize&&o>0&&o<=r.maxTextureSize,"invalid texture shape"),s(i===o,"cube map must be square"),s(e.wrapS===N&&e.wrapT===N,"wrap mode not supported by cube map");for(var u=0;u<n.length;++u){var c=n[u];s(c.width===i&&c.height===o,"inconsistent cube map face shape"),e.genMipmaps&&(s(!c.compressed,"can not generate mipmap for compressed textures"),s(1===c.mipmask,"can not specify mipmaps and generate mipmaps"));for(var l=c.images,h=0;h<16;++h){var f=l[h];if(f){var p=i>>h,d=o>>h;s(c.mipmask&1<<h,"missing mipmap data"),s(f.width===p&&f.height===d,"invalid shape for mip images"),s(f.format===t.format&&f.internalformat===t.internalformat&&f.type===t.type,"incompatible type for mip image"),f.compressed||(f.data?s(f.data.byteLength===p*d*Math.max(et(f.type,a),f.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):f.element||f.copy)}}}}tt[Z]=tt[V]=1,tt[G]=tt[H]=tt[$]=tt[Q]=tt[Y]=tt[K]=2,tt[W]=tt[q]=tt[X]=tt[J]=4;var ot=n(s,{optional:O,raise:o,commandRaise:P,command:I,parameter:c,commandParameter:R,constructor:m,type:f,commandType:L,isTypedArray:l,nni:p,oneOf:d,shaderError:T,linkError:C,callSite:w,saveCommandRef:k,saveDrawInfo:M,framebufferFormat:D,guessCommand:b,texture2D:rt,textureCube:it}),at=0,st=0,ut=5,ct=6;function lt(t,e){this.id=at++,this.type=t,this.data=e}function ht(t){return t.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function ft(t){if(0===t.length)return[];var e=t.charAt(0),n=t.charAt(t.length-1);if(t.length>1&&e===n&&('"'===e||"'"===e))return['"'+ht(t.substr(1,t.length-2))+'"'];var r=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(t);if(r)return ft(t.substr(0,r.index)).concat(ft(r[1])).concat(ft(t.substr(r.index+r[0].length)));var i=t.split(".");if(1===i.length)return['"'+ht(t)+'"'];for(var o=[],a=0;a<i.length;++a)o=o.concat(ft(i[a]));return o}function pt(t){return"["+ft(t).join("][")+"]"}function dt(t,e){return new lt(t,pt(e+""))}function vt(t){return"function"===typeof t&&!t._reglType||t instanceof lt}function mt(t,e){return"function"===typeof t?new lt(st,t):"number"===typeof t||"boolean"===typeof t?new lt(ut,t):Array.isArray(t)?new lt(ct,t.map((function(t,n){return mt(t,e+"["+n+"]")}))):t instanceof lt?t:void ot(!1,"invalid option type in uniform "+e)}var gt={DynamicVariable:lt,define:dt,isDynamic:vt,unbox:mt,accessor:pt},yt={next:"function"===typeof requestAnimationFrame?function(t){return requestAnimationFrame(t)}:function(t){return setTimeout(t,16)},cancel:"function"===typeof cancelAnimationFrame?function(t){return cancelAnimationFrame(t)}:clearTimeout},_t="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,xt=_t?function(){return+new Date}:"undefined"!==typeof performance&&performance.now?function(){return performance.now()}:function(){return+new Date};function bt(){var t={"":0},e=[""];return{id:function(n){var r=t[n];return r||(r=t[n]=e.length,e.push(n),r)},str:function(t){return e[t]}}}function wt(t,e,r){var i,o=document.createElement("canvas");function a(){var e=window.innerWidth,n=window.innerHeight;if(t!==document.body){var i=o.getBoundingClientRect();e=i.right-i.left,n=i.bottom-i.top}o.width=r*e,o.height=r*n}function s(){i?i.disconnect():window.removeEventListener("resize",a),t.removeChild(o)}return n(o.style,{border:0,margin:0,padding:0,top:0,left:0,width:"100%",height:"100%"}),t.appendChild(o),t===document.body&&(o.style.position="absolute",n(t.style,{margin:0,padding:0})),t!==document.body&&"function"===typeof ResizeObserver?(i=new ResizeObserver((function(){setTimeout(a)})),i.observe(t)):window.addEventListener("resize",a,!1),a(),{canvas:o,onDestroy:s}}function Et(t,e){function n(n){try{return t.getContext(n,e)}catch(r){return null}}return n("webgl")||n("experimental-webgl")||n("webgl-experimental")}function St(t){return"string"===typeof t.nodeName&&"function"===typeof t.appendChild&&"function"===typeof t.getBoundingClientRect}function At(t){return"function"===typeof t.drawArrays||"function"===typeof t.drawElements}function Tt(t){return"string"===typeof t?t.split():(ot(Array.isArray(t),"invalid extension array"),t)}function Ct(t){return"string"===typeof t?(ot("undefined"!==typeof document,"not supported outside of DOM"),document.querySelector(t)):t}function kt(t){var e,n,r,i,o=t||{},s={},u=[],c=[],l="undefined"===typeof window?1:window.devicePixelRatio,h=!1,f=function(t){t&&ot.raise(t)},p=function(){};if("string"===typeof o?(ot("undefined"!==typeof document,"selector queries only supported in DOM environments"),e=document.querySelector(o),ot(e,"invalid query string for element")):"object"===a(o)?St(o)?e=o:At(o)?(i=o,r=i.canvas):(ot.constructor(o),"gl"in o?i=o.gl:"canvas"in o?r=Ct(o.canvas):"container"in o&&(n=Ct(o.container)),"attributes"in o&&(s=o.attributes,ot.type(s,"object","invalid context attributes")),"extensions"in o&&(u=Tt(o.extensions)),"optionalExtensions"in o&&(c=Tt(o.optionalExtensions)),"onDone"in o&&(ot.type(o.onDone,"function","invalid or missing onDone callback"),f=o.onDone),"profile"in o&&(h=!!o.profile),"pixelRatio"in o&&(l=+o.pixelRatio,ot(l>0,"invalid pixel ratio"))):ot.raise("invalid arguments to regl"),e&&("canvas"===e.nodeName.toLowerCase()?r=e:n=e),!i){if(!r){ot("undefined"!==typeof document,"must manually specify webgl context outside of DOM environments");var d=wt(n||document.body,f,l);if(!d)return null;r=d.canvas,p=d.onDestroy}void 0===s.premultipliedAlpha&&(s.premultipliedAlpha=!0),i=Et(r,s)}return i?{gl:i,canvas:r,container:n,extensions:u,optionalExtensions:c,pixelRatio:l,profile:h,onDone:f,onDestroy:p}:(p(),f("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Mt(t,e){var n={};function r(t){ot.type(t,"string","extension name must be string");var e,r=t.toLowerCase();try{e=n[r]=i(t)}catch(o){}return!!e}function i(e){return t.getExtension(e)?t.getExtension(e):t.getExtension(e.toLowerCase())?t.getExtension(e.toLowerCase()):null}for(var o=0;o<e.extensions.length;++o){var a=e.extensions[o];if(!r(a))return e.onDestroy(),e.onDone('"'+a+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return e.optionalExtensions.forEach(r),{extensions:n,restore:function(){Object.keys(n).forEach((function(t){if(n[t]&&!r(t))throw new Error("(regl): error restoring extension "+t)}))}}}function Pt(t,e){for(var n=Array(t),r=0;r<t;++r)n[r]=e(r);return n}var It=5120,Rt=5121,Lt=5122,Ot=5123,Dt=5124,Nt=5125,zt=5126;function Ft(t){for(var e=16;e<=1<<28;e*=16)if(t<=e)return e;return 0}function Bt(t){var e,n;return e=(t>65535)<<4,t>>>=e,n=(t>255)<<3,t>>>=n,e|=n,n=(t>15)<<2,t>>>=n,e|=n,n=(t>3)<<1,t>>>=n,e|=n,e|t>>1}function Ut(){var t=Pt(8,(function(){return[]}));function e(e){var n=Ft(e),r=t[Bt(n)>>2];return r.length>0?r.pop():new ArrayBuffer(n)}function n(e){t[Bt(e.byteLength)>>2].push(e)}function r(t,n){var r=null;switch(t){case It:r=new Int8Array(e(n),0,n);break;case Rt:r=new Uint8Array(e(n),0,n);break;case Lt:r=new Int16Array(e(2*n),0,n);break;case Ot:r=new Uint16Array(e(2*n),0,n);break;case Dt:r=new Int32Array(e(4*n),0,n);break;case Nt:r=new Uint32Array(e(4*n),0,n);break;case zt:r=new Float32Array(e(4*n),0,n);break;default:return null}return r.length!==n?r.subarray(0,n):r}function i(t){n(t.buffer)}return{alloc:e,free:n,allocType:r,freeType:i}}var jt=Ut();jt.zero=Ut();var Zt=3408,Vt=3410,Gt=3411,Ht=3412,Wt=3413,qt=3414,Xt=3415,Yt=33901,Kt=33902,Qt=3379,Jt=3386,$t=34921,te=36347,ee=36348,ne=35661,re=35660,ie=34930,oe=36349,ae=34076,se=34024,ue=7936,ce=7937,le=7938,he=35724,fe=34047,pe=36063,de=34852,ve=3553,me=34067,ge=34069,ye=33984,_e=6408,xe=5126,be=5121,we=36160,Ee=36053,Se=36064,Ae=16384,Te=function(t,e){var n=1;e.ext_texture_filter_anisotropic&&(n=t.getParameter(fe));var r=1,i=1;e.webgl_draw_buffers&&(r=t.getParameter(de),i=t.getParameter(pe));var o=!!e.oes_texture_float;if(o){var a=t.createTexture();t.bindTexture(ve,a),t.texImage2D(ve,0,_e,1,1,0,_e,xe,null);var s=t.createFramebuffer();if(t.bindFramebuffer(we,s),t.framebufferTexture2D(we,Se,ve,a,0),t.bindTexture(ve,null),t.checkFramebufferStatus(we)!==Ee)o=!1;else{t.viewport(0,0,1,1),t.clearColor(1,0,0,1),t.clear(Ae);var u=jt.allocType(xe,4);t.readPixels(0,0,1,1,_e,xe,u),t.getError()?o=!1:(t.deleteFramebuffer(s),t.deleteTexture(a),o=1===u[0]),jt.freeType(u)}}var c="undefined"!==typeof navigator&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),l=!0;if(!c){var h=t.createTexture(),f=jt.allocType(be,36);t.activeTexture(ye),t.bindTexture(me,h),t.texImage2D(ge,0,_e,3,3,0,_e,be,f),jt.freeType(f),t.bindTexture(me,null),t.deleteTexture(h),l=!t.getError()}return{colorBits:[t.getParameter(Vt),t.getParameter(Gt),t.getParameter(Ht),t.getParameter(Wt)],depthBits:t.getParameter(qt),stencilBits:t.getParameter(Xt),subpixelBits:t.getParameter(Zt),extensions:Object.keys(e).filter((function(t){return!!e[t]})),maxAnisotropic:n,maxDrawbuffers:r,maxColorAttachments:i,pointSizeDims:t.getParameter(Yt),lineWidthDims:t.getParameter(Kt),maxViewportDims:t.getParameter(Jt),maxCombinedTextureUnits:t.getParameter(ne),maxCubeMapSize:t.getParameter(ae),maxRenderbufferSize:t.getParameter(se),maxTextureUnits:t.getParameter(ie),maxTextureSize:t.getParameter(Qt),maxAttributes:t.getParameter($t),maxVertexUniforms:t.getParameter(te),maxVertexTextureUnits:t.getParameter(re),maxVaryingVectors:t.getParameter(ee),maxFragmentUniforms:t.getParameter(oe),glsl:t.getParameter(he),renderer:t.getParameter(ce),vendor:t.getParameter(ue),version:t.getParameter(le),readFloat:o,npotTextureCube:l}};function Ce(t){return!!t&&"object"===a(t)&&Array.isArray(t.shape)&&Array.isArray(t.stride)&&"number"===typeof t.offset&&t.shape.length===t.stride.length&&(Array.isArray(t.data)||e(t.data))}var ke=function(t){return Object.keys(t).map((function(e){return t[e]}))},Me={shape:De,flatten:Oe};function Pe(t,e,n){for(var r=0;r<e;++r)n[r]=t[r]}function Ie(t,e,n,r){for(var i=0,o=0;o<e;++o)for(var a=t[o],s=0;s<n;++s)r[i++]=a[s]}function Re(t,e,n,r,i,o){for(var a=o,s=0;s<e;++s)for(var u=t[s],c=0;c<n;++c)for(var l=u[c],h=0;h<r;++h)i[a++]=l[h]}function Le(t,e,n,r,i){for(var o=1,a=n+1;a<e.length;++a)o*=e[a];var s=e[n];if(e.length-n===4){var u=e[n+1],c=e[n+2],l=e[n+3];for(a=0;a<s;++a)Re(t[a],u,c,l,r,i),i+=o}else for(a=0;a<s;++a)Le(t[a],e,n+1,r,i),i+=o}function Oe(t,e,n,r){var i=1;if(e.length)for(var o=0;o<e.length;++o)i*=e[o];else i=0;var a=r||jt.allocType(n,i);switch(e.length){case 0:break;case 1:Pe(t,e[0],a);break;case 2:Ie(t,e[0],e[1],a);break;case 3:Re(t,e[0],e[1],e[2],a,0);break;default:Le(t,e,0,a,0)}return a}function De(t){for(var e=[],n=t;n.length;n=n[0])e.push(n.length);return e}var Ne={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ze=5120,Fe=5122,Be=5124,Ue=5121,je=5123,Ze=5125,Ve=5126,Ge=5126,He={int8:ze,int16:Fe,int32:Be,uint8:Ue,uint16:je,uint32:Ze,float:Ve,float32:Ge},We=35048,qe=35040,Xe={dynamic:We,stream:qe,static:35044},Ye=Me.flatten,Ke=Me.shape,Qe=35044,Je=35040,$e=5121,tn=5126,en=[];function nn(t){return 0|Ne[Object.prototype.toString.call(t)]}function rn(t,e){for(var n=0;n<e.length;++n)t[n]=e[n]}function on(t,e,n,r,i,o,a){for(var s=0,u=0;u<n;++u)for(var c=0;c<r;++c)t[s++]=e[i*u+o*c+a]}function an(t,n,r,i){var o=0,a={};function s(e){this.id=o++,this.buffer=t.createBuffer(),this.type=e,this.usage=Qe,this.byteLength=0,this.dimension=1,this.dtype=$e,this.persistentData=null,r.profile&&(this.stats={size:0})}s.prototype.bind=function(){t.bindBuffer(this.type,this.buffer)},s.prototype.destroy=function(){p(this)};var u=[];function c(t,e){var n=u.pop();return n||(n=new s(t)),n.bind(),f(n,e,Je,0,1,!1),n}function l(t){u.push(t)}function h(e,n,r){e.byteLength=n.byteLength,t.bufferData(e.type,n,r)}function f(t,n,r,i,o,a){var s,u;if(t.usage=r,Array.isArray(n)){if(t.dtype=i||tn,n.length>0)if(Array.isArray(n[0])){s=Ke(n);for(var c=1,l=1;l<s.length;++l)c*=s[l];t.dimension=c,u=Ye(n,s,t.dtype),h(t,u,r),a?t.persistentData=u:jt.freeType(u)}else if("number"===typeof n[0]){t.dimension=o;var f=jt.allocType(t.dtype,n.length);rn(f,n),h(t,f,r),a?t.persistentData=f:jt.freeType(f)}else e(n[0])?(t.dimension=n[0].length,t.dtype=i||nn(n[0])||tn,u=Ye(n,[n.length,n[0].length],t.dtype),h(t,u,r),a?t.persistentData=u:jt.freeType(u)):ot.raise("invalid buffer data")}else if(e(n))t.dtype=i||nn(n),t.dimension=o,h(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n.buffer)));else if(Ce(n)){s=n.shape;var p=n.stride,d=n.offset,v=0,m=0,g=0,y=0;1===s.length?(v=s[0],m=1,g=p[0],y=0):2===s.length?(v=s[0],m=s[1],g=p[0],y=p[1]):ot.raise("invalid shape"),t.dtype=i||nn(n.data)||tn,t.dimension=m;var _=jt.allocType(t.dtype,v*m);on(_,n.data,v,m,g,y,d),h(t,_,r),a?t.persistentData=_:jt.freeType(_)}else n instanceof ArrayBuffer?(t.dtype=$e,t.dimension=o,h(t,n,r),a&&(t.persistentData=new Uint8Array(new Uint8Array(n)))):ot.raise("invalid buffer data")}function p(e){n.bufferCount--,i(e);var r=e.buffer;ot(r,"buffer must not be deleted already"),t.deleteBuffer(r),e.buffer=null,delete a[e.id]}function d(i,o,u,c){n.bufferCount++;var l=new s(o);function h(n){var i=Qe,o=null,a=0,s=0,u=1;return Array.isArray(n)||e(n)||Ce(n)||n instanceof ArrayBuffer?o=n:"number"===typeof n?a=0|n:n&&(ot.type(n,"object","buffer arguments must be an object, a number or an array"),"data"in n&&(ot(null===o||Array.isArray(o)||e(o)||Ce(o),"invalid data for buffer"),o=n.data),"usage"in n&&(ot.parameter(n.usage,Xe,"invalid buffer usage"),i=Xe[n.usage]),"type"in n&&(ot.parameter(n.type,He,"invalid buffer type"),s=He[n.type]),"dimension"in n&&(ot.type(n.dimension,"number","invalid dimension"),u=0|n.dimension),"length"in n&&(ot.nni(a,"buffer length must be a nonnegative integer"),a=0|n.length)),l.bind(),o?f(l,o,i,s,u,c):(a&&t.bufferData(l.type,a,i),l.dtype=s||$e,l.usage=i,l.dimension=u,l.byteLength=a),r.profile&&(l.stats.size=l.byteLength*en[l.dtype]),h}function d(e,n){ot(n+e.byteLength<=l.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+e.byteLength+" starting from offset "+n+" to a buffer of size "+l.byteLength),t.bufferSubData(l.type,n,e)}function v(t,n){var r,i=0|(n||0);if(l.bind(),e(t)||t instanceof ArrayBuffer)d(t,i);else if(Array.isArray(t)){if(t.length>0)if("number"===typeof t[0]){var o=jt.allocType(l.dtype,t.length);rn(o,t),d(o,i),jt.freeType(o)}else if(Array.isArray(t[0])||e(t[0])){r=Ke(t);var a=Ye(t,r,l.dtype);d(a,i),jt.freeType(a)}else ot.raise("invalid buffer data")}else if(Ce(t)){r=t.shape;var s=t.stride,u=0,c=0,f=0,p=0;1===r.length?(u=r[0],c=1,f=s[0],p=0):2===r.length?(u=r[0],c=r[1],f=s[0],p=s[1]):ot.raise("invalid shape");var v=Array.isArray(t.data)?l.dtype:nn(t.data),m=jt.allocType(v,u*c);on(m,t.data,u,c,f,p,t.offset),d(m,i),jt.freeType(m)}else ot.raise("invalid data for buffer subdata");return h}return a[l.id]=l,u||h(i),h._reglType="buffer",h._buffer=l,h.subdata=v,r.profile&&(h.stats=l.stats),h.destroy=function(){p(l)},h}function v(){ke(a).forEach((function(e){e.buffer=t.createBuffer(),t.bindBuffer(e.type,e.buffer),t.bufferData(e.type,e.persistentData||e.byteLength,e.usage)}))}return r.profile&&(n.getTotalBufferSize=function(){var t=0;return Object.keys(a).forEach((function(e){t+=a[e].stats.size})),t}),{create:d,createStream:c,destroyStream:l,clear:function(){ke(a).forEach(p),u.forEach(p)},getBuffer:function(t){return t&&t._buffer instanceof s?t._buffer:null},restore:v,_initBuffer:f}}en[5120]=1,en[5122]=2,en[5124]=4,en[5121]=1,en[5123]=2,en[5125]=4,en[5126]=4;var sn=0,un=0,cn=1,ln=1,hn=4,fn=4,pn={points:sn,point:un,lines:cn,line:ln,triangles:hn,triangle:fn,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},dn=0,vn=1,mn=4,gn=5120,yn=5121,_n=5122,xn=5123,bn=5124,wn=5125,En=34963,Sn=35040,An=35044;function Tn(t,n,r,i){var o={},a=0,s={uint8:yn,uint16:xn};function u(t){this.id=a++,o[this.id]=this,this.buffer=t,this.primType=mn,this.vertCount=0,this.type=0}n.oes_element_index_uint&&(s.uint32=wn),u.prototype.bind=function(){this.buffer.bind()};var c=[];function l(t){var e=c.pop();return e||(e=new u(r.create(null,En,!0,!1)._buffer)),f(e,t,Sn,-1,-1,0,0),e}function h(t){c.push(t)}function f(i,o,a,s,u,c,l){var h;if(i.buffer.bind(),o){var f=l;l||e(o)&&(!Ce(o)||e(o.data))||(f=n.oes_element_index_uint?wn:xn),r._initBuffer(i.buffer,o,a,f,3)}else t.bufferData(En,c,a),i.buffer.dtype=h||yn,i.buffer.usage=a,i.buffer.dimension=3,i.buffer.byteLength=c;if(h=l,!l){switch(i.buffer.dtype){case yn:case gn:h=yn;break;case xn:case _n:h=xn;break;case wn:case bn:h=wn;break;default:ot.raise("unsupported type for element array")}i.buffer.dtype=h}i.type=h,ot(h!==wn||!!n.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var p=u;p<0&&(p=i.buffer.byteLength,h===xn?p>>=1:h===wn&&(p>>=2)),i.vertCount=p;var d=s;if(s<0){d=mn;var v=i.buffer.dimension;1===v&&(d=dn),2===v&&(d=vn),3===v&&(d=mn)}i.primType=d}function p(t){i.elementsCount--,ot(null!==t.buffer,"must not double destroy elements"),delete o[t.id],t.buffer.destroy(),t.buffer=null}function d(t,n){var o=r.create(null,En,!0),a=new u(o._buffer);function c(t){if(t)if("number"===typeof t)o(t),a.primType=mn,a.vertCount=0|t,a.type=yn;else{var n=null,r=An,i=-1,u=-1,l=0,h=0;Array.isArray(t)||e(t)||Ce(t)?n=t:(ot.type(t,"object","invalid arguments for elements"),"data"in t&&(n=t.data,ot(Array.isArray(n)||e(n)||Ce(n),"invalid data for element buffer")),"usage"in t&&(ot.parameter(t.usage,Xe,"invalid element buffer usage"),r=Xe[t.usage]),"primitive"in t&&(ot.parameter(t.primitive,pn,"invalid element buffer primitive"),i=pn[t.primitive]),"count"in t&&(ot("number"===typeof t.count&&t.count>=0,"invalid vertex count for elements"),u=0|t.count),"type"in t&&(ot.parameter(t.type,s,"invalid buffer type"),h=s[t.type]),"length"in t?l=0|t.length:(l=u,h===xn||h===_n?l*=2:h!==wn&&h!==bn||(l*=4))),f(a,n,r,i,u,l,h)}else o(),a.primType=mn,a.vertCount=0,a.type=yn;return c}return i.elementsCount++,c(t),c._reglType="elements",c._elements=a,c.subdata=function(t,e){return o.subdata(t,e),c},c.destroy=function(){p(a)},c}return{create:d,createStream:l,destroyStream:h,getElements:function(t){return"function"===typeof t&&t._elements instanceof u?t._elements:null},clear:function(){ke(o).forEach(p)}}}var Cn=new Float32Array(1),kn=new Uint32Array(Cn.buffer),Mn=5123;function Pn(t){for(var e=jt.allocType(Mn,t.length),n=0;n<t.length;++n)if(isNaN(t[n]))e[n]=65535;else if(t[n]===1/0)e[n]=31744;else if(t[n]===-1/0)e[n]=64512;else{Cn[0]=t[n];var r=kn[0],i=r>>>31<<15,o=(r<<1>>>24)-127,a=r>>13&1023;if(o<-24)e[n]=i;else if(o<-14){var s=-14-o;e[n]=i+(a+1024>>s)}else e[n]=o>15?i+31744:i+(o+15<<10)+a}return e}function In(t){return Array.isArray(t)||e(t)}var Rn=function(t){return!(t&t-1)&&!!t},Ln=34467,On=3553,Dn=34067,Nn=34069,zn=6408,Fn=6406,Bn=6407,Un=6409,jn=6410,Zn=32854,Vn=32855,Gn=36194,Hn=32819,Wn=32820,qn=33635,Xn=34042,Yn=6402,Kn=34041,Qn=35904,Jn=35906,$n=36193,tr=33776,er=33777,nr=33778,rr=33779,ir=35986,or=35987,ar=34798,sr=35840,ur=35841,cr=35842,lr=35843,hr=36196,fr=5121,pr=5123,dr=5125,vr=5126,mr=10242,gr=10243,yr=10497,_r=33071,xr=33648,br=10240,wr=10241,Er=9728,Sr=9729,Ar=9984,Tr=9985,Cr=9986,kr=9987,Mr=33170,Pr=4352,Ir=4353,Rr=4354,Lr=34046,Or=3317,Dr=37440,Nr=37441,zr=37443,Fr=37444,Br=33984,Ur=[Ar,Cr,Tr,kr],jr=[0,Un,jn,Bn,zn],Zr={};function Vr(t){return"[object "+t+"]"}Zr[Un]=Zr[Fn]=Zr[Yn]=1,Zr[Kn]=Zr[jn]=2,Zr[Bn]=Zr[Qn]=3,Zr[zn]=Zr[Jn]=4;var Gr=Vr("HTMLCanvasElement"),Hr=Vr("OffscreenCanvas"),Wr=Vr("CanvasRenderingContext2D"),qr=Vr("ImageBitmap"),Xr=Vr("HTMLImageElement"),Yr=Vr("HTMLVideoElement"),Kr=Object.keys(Ne).concat([Gr,Hr,Wr,qr,Xr,Yr]),Qr=[];Qr[fr]=1,Qr[vr]=4,Qr[$n]=2,Qr[pr]=2,Qr[dr]=4;var Jr=[];function $r(t){return Array.isArray(t)&&(0===t.length||"number"===typeof t[0])}function ti(t){if(!Array.isArray(t))return!1;var e=t.length;return!(0===e||!In(t[0]))}function ei(t){return Object.prototype.toString.call(t)}function ni(t){return ei(t)===Gr}function ri(t){return ei(t)===Hr}function ii(t){return ei(t)===Wr}function oi(t){return ei(t)===qr}function ai(t){return ei(t)===Xr}function si(t){return ei(t)===Yr}function ui(t){var e="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;return!!(e&&t&&t.getContext)}function ci(t){var e="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;return!!(e&&t&&"src"in t&&"crossOrigin"in t)}function li(t){if(!t)return!1;if(ui(t)||ci(t))return!0;var e=ei(t);return Kr.indexOf(e)>=0||($r(t)||ti(t)||Ce(t))}function hi(t){return 0|Ne[Object.prototype.toString.call(t)]}function fi(t,e){var n=e.length;switch(t.type){case fr:case pr:case dr:case vr:var r=jt.allocType(t.type,n);r.set(e),t.data=r;break;case $n:t.data=Pn(e);break;default:ot.raise("unsupported texture type, must specify a typed array")}}function pi(t,e){return jt.allocType(t.type===$n?vr:t.type,e)}function di(t,e){t.type===$n?(t.data=Pn(e),jt.freeType(e)):t.data=e}function vi(t,e,n,r,i,o){for(var a=t.width,s=t.height,u=t.channels,c=a*s*u,l=pi(t,c),h=0,f=0;f<s;++f)for(var p=0;p<a;++p)for(var d=0;d<u;++d)l[h++]=e[n*p+r*f+i*d+o];di(t,l)}function mi(t,e,n,r,i,o){var a;if(a="undefined"!==typeof Jr[t]?Jr[t]:Zr[t]*Qr[e],o&&(a*=6),i){var s=0,u=n;while(u>=1)s+=a*u*u,u/=2;return s}return a*n*r}function gi(t,r,i,o,s,u,c){var l={"don't care":Pr,"dont care":Pr,nice:Rr,fast:Ir},h={repeat:yr,clamp:_r,mirror:xr},f={nearest:Er,linear:Sr},p=n({mipmap:kr,"nearest mipmap nearest":Ar,"linear mipmap nearest":Tr,"nearest mipmap linear":Cr,"linear mipmap linear":kr},f),d={none:0,browser:Fr},v={uint8:fr,rgba4:Hn,rgb565:qn,"rgb5 a1":Wn},m={alpha:Fn,luminance:Un,"luminance alpha":jn,rgb:Bn,rgba:zn,rgba4:Zn,"rgb5 a1":Vn,rgb565:Gn},g={};r.ext_srgb&&(m.srgb=Qn,m.srgba=Jn),r.oes_texture_float&&(v.float32=v.float=vr),r.oes_texture_half_float&&(v["float16"]=v["half float"]=$n),r.webgl_depth_texture&&(n(m,{depth:Yn,"depth stencil":Kn}),n(v,{uint16:pr,uint32:dr,"depth stencil":Xn})),r.webgl_compressed_texture_s3tc&&n(g,{"rgb s3tc dxt1":tr,"rgba s3tc dxt1":er,"rgba s3tc dxt3":nr,"rgba s3tc dxt5":rr}),r.webgl_compressed_texture_atc&&n(g,{"rgb atc":ir,"rgba atc explicit alpha":or,"rgba atc interpolated alpha":ar}),r.webgl_compressed_texture_pvrtc&&n(g,{"rgb pvrtc 4bppv1":sr,"rgb pvrtc 2bppv1":ur,"rgba pvrtc 4bppv1":cr,"rgba pvrtc 2bppv1":lr}),r.webgl_compressed_texture_etc1&&(g["rgb etc1"]=hr);var y=Array.prototype.slice.call(t.getParameter(Ln)||new Uint32Array(0));Object.keys(g).forEach((function(t){var e=g[t];y.indexOf(e)>=0&&(m[t]=e)}));var _=Object.keys(m);i.textureFormats=_;var x=[];Object.keys(m).forEach((function(t){var e=m[t];x[e]=t}));var b=[];Object.keys(v).forEach((function(t){var e=v[t];b[e]=t}));var w=[];Object.keys(f).forEach((function(t){var e=f[t];w[e]=t}));var E=[];Object.keys(p).forEach((function(t){var e=p[t];E[e]=t}));var S=[];Object.keys(h).forEach((function(t){var e=h[t];S[e]=t}));var A=_.reduce((function(t,e){var n=m[e];return n===Un||n===Fn||n===Un||n===jn||n===Yn||n===Kn||r.ext_srgb&&(n===Qn||n===Jn)?t[n]=n:n===Vn||e.indexOf("rgba")>=0?t[n]=zn:t[n]=Bn,t}),{});function T(){this.internalformat=zn,this.format=zn,this.type=fr,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=Fr,this.width=0,this.height=0,this.channels=0}function C(t,e){t.internalformat=e.internalformat,t.format=e.format,t.type=e.type,t.compressed=e.compressed,t.premultiplyAlpha=e.premultiplyAlpha,t.flipY=e.flipY,t.unpackAlignment=e.unpackAlignment,t.colorSpace=e.colorSpace,t.width=e.width,t.height=e.height,t.channels=e.channels}function k(t,e){if("object"===a(e)&&e){if("premultiplyAlpha"in e&&(ot.type(e.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),t.premultiplyAlpha=e.premultiplyAlpha),"flipY"in e&&(ot.type(e.flipY,"boolean","invalid texture flip"),t.flipY=e.flipY),"alignment"in e&&(ot.oneOf(e.alignment,[1,2,4,8],"invalid texture unpack alignment"),t.unpackAlignment=e.alignment),"colorSpace"in e&&(ot.parameter(e.colorSpace,d,"invalid colorSpace"),t.colorSpace=d[e.colorSpace]),"type"in e){var n=e.type;ot(r.oes_texture_float||!("float"===n||"float32"===n),"you must enable the OES_texture_float extension in order to use floating point textures."),ot(r.oes_texture_half_float||!("half float"===n||"float16"===n),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),ot(r.webgl_depth_texture||!("uint16"===n||"uint32"===n||"depth stencil"===n),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ot.parameter(n,v,"invalid texture type"),t.type=v[n]}var o=t.width,s=t.height,u=t.channels,c=!1;"shape"in e?(ot(Array.isArray(e.shape)&&e.shape.length>=2,"shape must be an array"),o=e.shape[0],s=e.shape[1],3===e.shape.length&&(u=e.shape[2],ot(u>0&&u<=4,"invalid number of channels"),c=!0),ot(o>=0&&o<=i.maxTextureSize,"invalid width"),ot(s>=0&&s<=i.maxTextureSize,"invalid height")):("radius"in e&&(o=s=e.radius,ot(o>=0&&o<=i.maxTextureSize,"invalid radius")),"width"in e&&(o=e.width,ot(o>=0&&o<=i.maxTextureSize,"invalid width")),"height"in e&&(s=e.height,ot(s>=0&&s<=i.maxTextureSize,"invalid height")),"channels"in e&&(u=e.channels,ot(u>0&&u<=4,"invalid number of channels"),c=!0)),t.width=0|o,t.height=0|s,t.channels=0|u;var l=!1;if("format"in e){var h=e.format;ot(r.webgl_depth_texture||!("depth"===h||"depth stencil"===h),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),ot.parameter(h,m,"invalid texture format");var f=t.internalformat=m[h];t.format=A[f],h in v&&("type"in e||(t.type=v[h])),h in g&&(t.compressed=!0),l=!0}!c&&l?t.channels=Zr[t.format]:c&&!l?t.channels!==jr[t.format]&&(t.format=t.internalformat=jr[t.channels]):l&&c&&ot(t.channels===Zr[t.format],"number of channels inconsistent with specified format")}}function M(e){t.pixelStorei(Dr,e.flipY),t.pixelStorei(Nr,e.premultiplyAlpha),t.pixelStorei(zr,e.colorSpace),t.pixelStorei(Or,e.unpackAlignment)}function P(){T.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function I(t,n){var r=null;if(li(n)?r=n:n&&(ot.type(n,"object","invalid pixel data type"),k(t,n),"x"in n&&(t.xOffset=0|n.x),"y"in n&&(t.yOffset=0|n.y),li(n.data)&&(r=n.data)),ot(!t.compressed||r instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),n.copy){ot(!r,"can not specify copy and data field for the same texture");var o=s.viewportWidth,a=s.viewportHeight;t.width=t.width||o-t.xOffset,t.height=t.height||a-t.yOffset,t.needsCopy=!0,ot(t.xOffset>=0&&t.xOffset<o&&t.yOffset>=0&&t.yOffset<a&&t.width>0&&t.width<=o&&t.height>0&&t.height<=a,"copy texture read out of bounds")}else if(r){if(e(r))t.channels=t.channels||4,t.data=r,"type"in n||t.type!==fr||(t.type=hi(r));else if($r(r))t.channels=t.channels||4,fi(t,r),t.alignment=1,t.needsFree=!0;else if(Ce(r)){var u=r.data;Array.isArray(u)||t.type!==fr||(t.type=hi(u));var c,l,h,f,p,d,v=r.shape,m=r.stride;3===v.length?(h=v[2],d=m[2]):(ot(2===v.length,"invalid ndarray pixel data, must be 2 or 3D"),h=1,d=1),c=v[0],l=v[1],f=m[0],p=m[1],t.alignment=1,t.width=c,t.height=l,t.channels=h,t.format=t.internalformat=jr[h],t.needsFree=!0,vi(t,u,f,p,d,r.offset)}else if(ui(r)||ni(r)||ri(r)||ii(r))ui(r)||ni(r)||ri(r)?t.element=r:t.element=r.canvas,t.width=t.element.width,t.height=t.element.height,t.channels=4;else if(oi(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(ai(r))t.element=r,t.width=r.naturalWidth,t.height=r.naturalHeight,t.channels=4;else if(ci(r))t.element=r,t.width=r.width,t.height=r.height,t.channels=4;else if(si(r))t.element=r,t.width=r.videoWidth,t.height=r.videoHeight,t.channels=4;else if(ti(r)){var g=t.width||r[0].length,y=t.height||r.length,_=t.channels;_=In(r[0][0])?_||r[0][0].length:_||1;for(var x=Me.shape(r),b=1,w=0;w<x.length;++w)b*=x[w];var E=pi(t,b);Me.flatten(r,x,"",E),di(t,E),t.alignment=1,t.width=g,t.height=y,t.channels=_,t.format=t.internalformat=jr[_],t.needsFree=!0}}else t.width=t.width||1,t.height=t.height||1,t.channels=t.channels||4;t.type===vr?ot(i.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):t.type===$n&&ot(i.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function R(e,n,r){var i=e.element,a=e.data,s=e.internalformat,u=e.format,c=e.type,l=e.width,h=e.height;M(e),i?t.texImage2D(n,r,u,u,c,i):e.compressed?t.compressedTexImage2D(n,r,s,l,h,0,a):e.needsCopy?(o(),t.copyTexImage2D(n,r,u,e.xOffset,e.yOffset,l,h,0)):t.texImage2D(n,r,u,l,h,0,u,c,a||null)}function L(e,n,r,i,a){var s=e.element,u=e.data,c=e.internalformat,l=e.format,h=e.type,f=e.width,p=e.height;M(e),s?t.texSubImage2D(n,a,r,i,l,h,s):e.compressed?t.compressedTexSubImage2D(n,a,r,i,c,f,p,u):e.needsCopy?(o(),t.copyTexSubImage2D(n,a,r,i,e.xOffset,e.yOffset,f,p)):t.texSubImage2D(n,a,r,i,f,p,l,h,u)}var O=[];function D(){return O.pop()||new P}function N(t){t.needsFree&&jt.freeType(t.data),P.call(t),O.push(t)}function z(){T.call(this),this.genMipmaps=!1,this.mipmapHint=Pr,this.mipmask=0,this.images=Array(16)}function F(t,e,n){var r=t.images[0]=D();t.mipmask=1,r.width=t.width=e,r.height=t.height=n,r.channels=t.channels=4}function B(t,e){var n=null;if(li(e))n=t.images[0]=D(),C(n,t),I(n,e),t.mipmask=1;else if(k(t,e),Array.isArray(e.mipmap))for(var r=e.mipmap,i=0;i<r.length;++i)n=t.images[i]=D(),C(n,t),n.width>>=i,n.height>>=i,I(n,r[i]),t.mipmask|=1<<i;else n=t.images[0]=D(),C(n,t),I(n,e),t.mipmask=1;C(t,t.images[0]),!t.compressed||t.internalformat!==tr&&t.internalformat!==er&&t.internalformat!==nr&&t.internalformat!==rr||ot(t.width%4===0&&t.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function U(t,e){for(var n=t.images,r=0;r<n.length;++r){if(!n[r])return;R(n[r],e,r)}}var j=[];function Z(){var t=j.pop()||new z;T.call(t),t.mipmask=0;for(var e=0;e<16;++e)t.images[e]=null;return t}function V(t){for(var e=t.images,n=0;n<e.length;++n)e[n]&&N(e[n]),e[n]=null;j.push(t)}function G(){this.minFilter=Er,this.magFilter=Er,this.wrapS=_r,this.wrapT=_r,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Pr}function H(t,e){if("min"in e){var n=e.min;ot.parameter(n,p),t.minFilter=p[n],Ur.indexOf(t.minFilter)>=0&&!("faces"in e)&&(t.genMipmaps=!0)}if("mag"in e){var r=e.mag;ot.parameter(r,f),t.magFilter=f[r]}var o=t.wrapS,s=t.wrapT;if("wrap"in e){var u=e.wrap;"string"===typeof u?(ot.parameter(u,h),o=s=h[u]):Array.isArray(u)&&(ot.parameter(u[0],h),ot.parameter(u[1],h),o=h[u[0]],s=h[u[1]])}else{if("wrapS"in e){var c=e.wrapS;ot.parameter(c,h),o=h[c]}if("wrapT"in e){var d=e.wrapT;ot.parameter(d,h),s=h[d]}}if(t.wrapS=o,t.wrapT=s,"anisotropic"in e){var v=e.anisotropic;ot("number"===typeof v&&v>=1&&v<=i.maxAnisotropic,"aniso samples must be between 1 and "),t.anisotropic=e.anisotropic}if("mipmap"in e){var m=!1;switch(a(e.mipmap)){case"string":ot.parameter(e.mipmap,l,"invalid mipmap hint"),t.mipmapHint=l[e.mipmap],t.genMipmaps=!0,m=!0;break;case"boolean":m=t.genMipmaps=e.mipmap;break;case"object":ot(Array.isArray(e.mipmap),"invalid mipmap type"),t.genMipmaps=!1,m=!0;break;default:ot.raise("invalid mipmap type")}m&&!("min"in e)&&(t.minFilter=Ar)}}function W(e,n){t.texParameteri(n,wr,e.minFilter),t.texParameteri(n,br,e.magFilter),t.texParameteri(n,mr,e.wrapS),t.texParameteri(n,gr,e.wrapT),r.ext_texture_filter_anisotropic&&t.texParameteri(n,Lr,e.anisotropic),e.genMipmaps&&(t.hint(Mr,e.mipmapHint),t.generateMipmap(n))}var q=0,X={},Y=i.maxTextureUnits,K=Array(Y).map((function(){return null}));function Q(e){T.call(this),this.mipmask=0,this.internalformat=zn,this.id=q++,this.refCount=1,this.target=e,this.texture=t.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new G,c.profile&&(this.stats={size:0})}function J(e){t.activeTexture(Br),t.bindTexture(e.target,e.texture)}function $(){var e=K[0];e?t.bindTexture(e.target,e.texture):t.bindTexture(On,null)}function tt(e){var n=e.texture;ot(n,"must not double destroy texture");var r=e.unit,i=e.target;r>=0&&(t.activeTexture(Br+r),t.bindTexture(i,null),K[r]=null),t.deleteTexture(n),e.texture=null,e.params=null,e.pixels=null,e.refCount=0,delete X[e.id],u.textureCount--}function et(e,n){var r=new Q(On);function o(t,e){var n=r.texInfo;G.call(n);var a=Z();return"number"===typeof t?F(a,0|t,"number"===typeof e?0|e:0|t):t?(ot.type(t,"object","invalid arguments to regl.texture"),H(n,t),B(a,t)):F(a,1,1),n.genMipmaps&&(a.mipmask=(a.width<<1)-1),r.mipmask=a.mipmask,C(r,a),ot.texture2D(n,a,i),r.internalformat=a.internalformat,o.width=a.width,o.height=a.height,J(r),U(a,On),W(n,On),$(),V(a),c.profile&&(r.stats.size=mi(r.internalformat,r.type,a.width,a.height,n.genMipmaps,!1)),o.format=x[r.internalformat],o.type=b[r.type],o.mag=w[n.magFilter],o.min=E[n.minFilter],o.wrapS=S[n.wrapS],o.wrapT=S[n.wrapT],o}function a(t,e,n,i){ot(!!t,"must specify image data");var a=0|e,s=0|n,u=0|i,c=D();return C(c,r),c.width=0,c.height=0,I(c,t),c.width=c.width||(r.width>>u)-a,c.height=c.height||(r.height>>u)-s,ot(r.type===c.type&&r.format===c.format&&r.internalformat===c.internalformat,"incompatible format for texture.subimage"),ot(a>=0&&s>=0&&a+c.width<=r.width&&s+c.height<=r.height,"texture.subimage write out of bounds"),ot(r.mipmask&1<<u,"missing mipmap data"),ot(c.data||c.element||c.needsCopy,"missing image data"),J(r),L(c,On,a,s,u),$(),N(c),o}function s(e,n){var i=0|e,a=0|n||i;if(i===r.width&&a===r.height)return o;o.width=r.width=i,o.height=r.height=a,J(r);for(var s=0;r.mipmask>>s;++s){var u=i>>s,l=a>>s;if(!u||!l)break;t.texImage2D(On,s,r.format,u,l,0,r.format,r.type,null)}return $(),c.profile&&(r.stats.size=mi(r.internalformat,r.type,i,a,!1,!1)),o}return X[r.id]=r,u.textureCount++,o(e,n),o.subimage=a,o.resize=s,o._reglType="texture2d",o._texture=r,c.profile&&(o.stats=r.stats),o.destroy=function(){r.decRef()},o}function nt(e,n,r,o,s,l){var h=new Q(Dn);X[h.id]=h,u.cubeCount++;var f=new Array(6);function p(t,e,n,r,o,s){var u,l=h.texInfo;for(G.call(l),u=0;u<6;++u)f[u]=Z();if("number"!==typeof t&&t)if("object"===a(t))if(e)B(f[0],t),B(f[1],e),B(f[2],n),B(f[3],r),B(f[4],o),B(f[5],s);else if(H(l,t),k(h,t),"faces"in t){var d=t.faces;for(ot(Array.isArray(d)&&6===d.length,"cube faces must be a length 6 array"),u=0;u<6;++u)ot("object"===a(d[u])&&!!d[u],"invalid input for cube map face"),C(f[u],h),B(f[u],d[u])}else for(u=0;u<6;++u)B(f[u],t);else ot.raise("invalid arguments to cube map");else{var v=0|t||1;for(u=0;u<6;++u)F(f[u],v,v)}for(C(h,f[0]),ot.optional((function(){i.npotTextureCube||ot(Rn(h.width)&&Rn(h.height),"your browser does not support non power or two texture dimensions")})),l.genMipmaps?h.mipmask=(f[0].width<<1)-1:h.mipmask=f[0].mipmask,ot.textureCube(h,l,f,i),h.internalformat=f[0].internalformat,p.width=f[0].width,p.height=f[0].height,J(h),u=0;u<6;++u)U(f[u],Nn+u);for(W(l,Dn),$(),c.profile&&(h.stats.size=mi(h.internalformat,h.type,p.width,p.height,l.genMipmaps,!0)),p.format=x[h.internalformat],p.type=b[h.type],p.mag=w[l.magFilter],p.min=E[l.minFilter],p.wrapS=S[l.wrapS],p.wrapT=S[l.wrapT],u=0;u<6;++u)V(f[u]);return p}function d(t,e,n,r,i){ot(!!e,"must specify image data"),ot("number"===typeof t&&t===(0|t)&&t>=0&&t<6,"invalid face");var o=0|n,a=0|r,s=0|i,u=D();return C(u,h),u.width=0,u.height=0,I(u,e),u.width=u.width||(h.width>>s)-o,u.height=u.height||(h.height>>s)-a,ot(h.type===u.type&&h.format===u.format&&h.internalformat===u.internalformat,"incompatible format for texture.subimage"),ot(o>=0&&a>=0&&o+u.width<=h.width&&a+u.height<=h.height,"texture.subimage write out of bounds"),ot(h.mipmask&1<<s,"missing mipmap data"),ot(u.data||u.element||u.needsCopy,"missing image data"),J(h),L(u,Nn+t,o,a,s),$(),N(u),p}function v(e){var n=0|e;if(n!==h.width){p.width=h.width=n,p.height=h.height=n,J(h);for(var r=0;r<6;++r)for(var i=0;h.mipmask>>i;++i)t.texImage2D(Nn+r,i,h.format,n>>i,n>>i,0,h.format,h.type,null);return $(),c.profile&&(h.stats.size=mi(h.internalformat,h.type,p.width,p.height,!1,!0)),p}}return p(e,n,r,o,s,l),p.subimage=d,p.resize=v,p._reglType="textureCube",p._texture=h,c.profile&&(p.stats=h.stats),p.destroy=function(){h.decRef()},p}function rt(){for(var e=0;e<Y;++e)t.activeTexture(Br+e),t.bindTexture(On,null),K[e]=null;ke(X).forEach(tt),u.cubeCount=0,u.textureCount=0}function it(){for(var e=0;e<Y;++e){var n=K[e];n&&(n.bindCount=0,n.unit=-1,K[e]=null)}ke(X).forEach((function(e){e.texture=t.createTexture(),t.bindTexture(e.target,e.texture);for(var n=0;n<32;++n)if(0!==(e.mipmask&1<<n))if(e.target===On)t.texImage2D(On,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);else for(var r=0;r<6;++r)t.texImage2D(Nn+r,n,e.internalformat,e.width>>n,e.height>>n,0,e.internalformat,e.type,null);W(e.texInfo,e.target)}))}function at(){for(var e=0;e<Y;++e){var n=K[e];n&&(n.bindCount=0,n.unit=-1,K[e]=null),t.activeTexture(Br+e),t.bindTexture(On,null),t.bindTexture(Dn,null)}}return n(Q.prototype,{bind:function(){var e=this;e.bindCount+=1;var n=e.unit;if(n<0){for(var r=0;r<Y;++r){var i=K[r];if(i){if(i.bindCount>0)continue;i.unit=-1}K[r]=e,n=r;break}n>=Y&&ot.raise("insufficient number of texture units"),c.profile&&u.maxTextureUnits<n+1&&(u.maxTextureUnits=n+1),e.unit=n,t.activeTexture(Br+n),t.bindTexture(e.target,e.texture)}return n},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&tt(this)}}),c.profile&&(u.getTotalTextureSize=function(){var t=0;return Object.keys(X).forEach((function(e){t+=X[e].stats.size})),t}),{create2D:et,createCube:nt,clear:rt,getTexture:function(t){return null},restore:it,refresh:at}}Jr[Zn]=2,Jr[Vn]=2,Jr[Gn]=2,Jr[Kn]=4,Jr[tr]=.5,Jr[er]=.5,Jr[nr]=1,Jr[rr]=1,Jr[ir]=.5,Jr[or]=1,Jr[ar]=1,Jr[sr]=.5,Jr[ur]=.25,Jr[cr]=.5,Jr[lr]=.25,Jr[hr]=.5;var yi=36161,_i=32854,xi=32855,bi=36194,wi=33189,Ei=36168,Si=34041,Ai=35907,Ti=34836,Ci=34842,ki=34843,Mi=[];function Pi(t,e,n){return Mi[t]*e*n}Mi[_i]=2,Mi[xi]=2,Mi[bi]=2,Mi[wi]=2,Mi[Ei]=1,Mi[Si]=4,Mi[Ai]=4,Mi[Ti]=16,Mi[Ci]=8,Mi[ki]=6;var Ii=function(t,e,n,r,i){var o={rgba4:_i,rgb565:bi,"rgb5 a1":xi,depth:wi,stencil:Ei,"depth stencil":Si};e.ext_srgb&&(o["srgba"]=Ai),e.ext_color_buffer_half_float&&(o["rgba16f"]=Ci,o["rgb16f"]=ki),e.webgl_color_buffer_float&&(o["rgba32f"]=Ti);var s=[];Object.keys(o).forEach((function(t){var e=o[t];s[e]=t}));var u=0,c={};function l(t){this.id=u++,this.refCount=1,this.renderbuffer=t,this.format=_i,this.width=0,this.height=0,i.profile&&(this.stats={size:0})}function h(e){var n=e.renderbuffer;ot(n,"must not double destroy renderbuffer"),t.bindRenderbuffer(yi,null),t.deleteRenderbuffer(n),e.renderbuffer=null,e.refCount=0,delete c[e.id],r.renderbufferCount--}function f(e,u){var h=new l(t.createRenderbuffer());function f(e,r){var u=0,c=0,l=_i;if("object"===a(e)&&e){var p=e;if("shape"in p){var d=p.shape;ot(Array.isArray(d)&&d.length>=2,"invalid renderbuffer shape"),u=0|d[0],c=0|d[1]}else"radius"in p&&(u=c=0|p.radius),"width"in p&&(u=0|p.width),"height"in p&&(c=0|p.height);"format"in p&&(ot.parameter(p.format,o,"invalid renderbuffer format"),l=o[p.format])}else"number"===typeof e?(u=0|e,c="number"===typeof r?0|r:u):e?ot.raise("invalid arguments to renderbuffer constructor"):u=c=1;if(ot(u>0&&c>0&&u<=n.maxRenderbufferSize&&c<=n.maxRenderbufferSize,"invalid renderbuffer size"),u!==h.width||c!==h.height||l!==h.format)return f.width=h.width=u,f.height=h.height=c,h.format=l,t.bindRenderbuffer(yi,h.renderbuffer),t.renderbufferStorage(yi,l,u,c),ot(0===t.getError(),"invalid render buffer format"),i.profile&&(h.stats.size=Pi(h.format,h.width,h.height)),f.format=s[h.format],f}function p(e,r){var o=0|e,a=0|r||o;return o===h.width&&a===h.height||(ot(o>0&&a>0&&o<=n.maxRenderbufferSize&&a<=n.maxRenderbufferSize,"invalid renderbuffer size"),f.width=h.width=o,f.height=h.height=a,t.bindRenderbuffer(yi,h.renderbuffer),t.renderbufferStorage(yi,h.format,o,a),ot(0===t.getError(),"invalid render buffer format"),i.profile&&(h.stats.size=Pi(h.format,h.width,h.height))),f}return c[h.id]=h,r.renderbufferCount++,f(e,u),f.resize=p,f._reglType="renderbuffer",f._renderbuffer=h,i.profile&&(f.stats=h.stats),f.destroy=function(){h.decRef()},f}function p(){ke(c).forEach((function(e){e.renderbuffer=t.createRenderbuffer(),t.bindRenderbuffer(yi,e.renderbuffer),t.renderbufferStorage(yi,e.format,e.width,e.height)})),t.bindRenderbuffer(yi,null)}return l.prototype.decRef=function(){--this.refCount<=0&&h(this)},i.profile&&(r.getTotalRenderbufferSize=function(){var t=0;return Object.keys(c).forEach((function(e){t+=c[e].stats.size})),t}),{create:f,clear:function(){ke(c).forEach(h)},restore:p}},Ri=36160,Li=36161,Oi=3553,Di=34069,Ni=36064,zi=36096,Fi=36128,Bi=33306,Ui=36053,ji=36054,Zi=36055,Vi=36057,Gi=36061,Hi=36193,Wi=5121,qi=5126,Xi=6407,Yi=6408,Ki=6402,Qi=[Xi,Yi],Ji=[];Ji[Yi]=4,Ji[Xi]=3;var $i=[];$i[Wi]=1,$i[qi]=4,$i[Hi]=2;var to=32854,eo=32855,no=36194,ro=33189,io=36168,oo=34041,ao=35907,so=34836,uo=34842,co=34843,lo=[to,eo,no,ao,uo,co,so],ho={};function fo(t,e,r,i,o,s){var u={cur:null,next:null,dirty:!1,setFBO:null},c=["rgba"],l=["rgba4","rgb565","rgb5 a1"];e.ext_srgb&&l.push("srgba"),e.ext_color_buffer_half_float&&l.push("rgba16f","rgb16f"),e.webgl_color_buffer_float&&l.push("rgba32f");var h=["uint8"];function f(t,e,n){this.target=t,this.texture=e,this.renderbuffer=n;var r=0,i=0;e?(r=e.width,i=e.height):n&&(r=n.width,i=n.height),this.width=r,this.height=i}function p(t){t&&(t.texture&&t.texture._texture.decRef(),t.renderbuffer&&t.renderbuffer._renderbuffer.decRef())}function d(t,e,n){if(t)if(t.texture){var r=t.texture._texture,i=Math.max(1,r.width),o=Math.max(1,r.height);ot(i===e&&o===n,"inconsistent width/height for supplied texture"),r.refCount+=1}else{var a=t.renderbuffer._renderbuffer;ot(a.width===e&&a.height===n,"inconsistent width/height for renderbuffer"),a.refCount+=1}}function v(e,n){n&&(n.texture?t.framebufferTexture2D(Ri,e,n.target,n.texture._texture.texture,0):t.framebufferRenderbuffer(Ri,e,Li,n.renderbuffer._renderbuffer.renderbuffer))}function m(t){var e=Oi,n=null,r=null,i=t;"object"===a(t)&&(i=t.data,"target"in t&&(e=0|t.target)),ot.type(i,"function","invalid attachment data");var o=i._reglType;return"texture2d"===o?(n=i,ot(e===Oi)):"textureCube"===o?(n=i,ot(e>=Di&&e<Di+6,"invalid cube map target")):"renderbuffer"===o?(r=i,e=Li):ot.raise("invalid regl object for attachment"),new f(e,n,r)}function g(t,e,n,r,a){if(n){var s=i.create2D({width:t,height:e,format:r,type:a});return s._texture.refCount=0,new f(Oi,s,null)}var u=o.create({width:t,height:e,format:r});return u._renderbuffer.refCount=0,new f(Li,null,u)}function y(t){return t&&(t.texture||t.renderbuffer)}function _(t,e,n){t&&(t.texture?t.texture.resize(e,n):t.renderbuffer&&t.renderbuffer.resize(e,n),t.width=e,t.height=n)}e.oes_texture_half_float&&h.push("half float","float16"),e.oes_texture_float&&h.push("float","float32");var x=0,b={};function w(){this.id=x++,b[this.id]=this,this.framebuffer=t.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function E(t){t.colorAttachments.forEach(p),p(t.depthAttachment),p(t.stencilAttachment),p(t.depthStencilAttachment)}function S(e){var n=e.framebuffer;ot(n,"must not double destroy framebuffer"),t.deleteFramebuffer(n),e.framebuffer=null,s.framebufferCount--,delete b[e.id]}function A(e){var n;t.bindFramebuffer(Ri,e.framebuffer);var i=e.colorAttachments;for(n=0;n<i.length;++n)v(Ni+n,i[n]);for(n=i.length;n<r.maxColorAttachments;++n)t.framebufferTexture2D(Ri,Ni+n,Oi,null,0);t.framebufferTexture2D(Ri,Bi,Oi,null,0),t.framebufferTexture2D(Ri,zi,Oi,null,0),t.framebufferTexture2D(Ri,Fi,Oi,null,0),v(zi,e.depthAttachment),v(Fi,e.stencilAttachment),v(Bi,e.depthStencilAttachment);var o=t.checkFramebufferStatus(Ri);t.isContextLost()||o===Ui||ot.raise("framebuffer configuration not supported, status = "+ho[o]),t.bindFramebuffer(Ri,u.next?u.next.framebuffer:null),u.cur=u.next,t.getError()}function T(t,i){var o=new w;function a(t,n){var i;ot(u.next!==o,"can not update framebuffer which is currently in use");var s=0,f=0,p=!0,v=!0,_=null,x=!0,b="rgba",w="uint8",S=1,T=null,C=null,k=null,M=!1;if("number"===typeof t)s=0|t,f=0|n||s;else if(t){ot.type(t,"object","invalid arguments for framebuffer");var P=t;if("shape"in P){var I=P.shape;ot(Array.isArray(I)&&I.length>=2,"invalid shape for framebuffer"),s=I[0],f=I[1]}else"radius"in P&&(s=f=P.radius),"width"in P&&(s=P.width),"height"in P&&(f=P.height);("color"in P||"colors"in P)&&(_=P.color||P.colors,Array.isArray(_)&&ot(1===_.length||e.webgl_draw_buffers,"multiple render targets not supported")),_||("colorCount"in P&&(S=0|P.colorCount,ot(S>0,"invalid color buffer count")),"colorTexture"in P&&(x=!!P.colorTexture,b="rgba4"),"colorType"in P&&(w=P.colorType,x?(ot(e.oes_texture_float||!("float"===w||"float32"===w),"you must enable OES_texture_float in order to use floating point framebuffer objects"),ot(e.oes_texture_half_float||!("half float"===w||"float16"===w),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):"half float"===w||"float16"===w?(ot(e.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),b="rgba16f"):"float"!==w&&"float32"!==w||(ot(e.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),b="rgba32f"),ot.oneOf(w,h,"invalid color type")),"colorFormat"in P&&(b=P.colorFormat,c.indexOf(b)>=0?x=!0:l.indexOf(b)>=0?x=!1:ot.optional((function(){x?ot.oneOf(P.colorFormat,c,"invalid color format for texture"):ot.oneOf(P.colorFormat,l,"invalid color format for renderbuffer")})))),("depthTexture"in P||"depthStencilTexture"in P)&&(M=!(!P.depthTexture&&!P.depthStencilTexture),ot(!M||e.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in P&&("boolean"===typeof P.depth?p=P.depth:(T=P.depth,v=!1)),"stencil"in P&&("boolean"===typeof P.stencil?v=P.stencil:(C=P.stencil,p=!1)),"depthStencil"in P&&("boolean"===typeof P.depthStencil?p=v=P.depthStencil:(k=P.depthStencil,p=!1,v=!1))}else s=f=1;var R=null,L=null,O=null,D=null;if(Array.isArray(_))R=_.map(m);else if(_)R=[m(_)];else for(R=new Array(S),i=0;i<S;++i)R[i]=g(s,f,x,b,w);ot(e.webgl_draw_buffers||R.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),ot(R.length<=r.maxColorAttachments,"too many color attachments, not supported"),s=s||R[0].width,f=f||R[0].height,T?L=m(T):p&&!v&&(L=g(s,f,M,"depth","uint32")),C?O=m(C):v&&!p&&(O=g(s,f,!1,"stencil","uint8")),k?D=m(k):!T&&!C&&v&&p&&(D=g(s,f,M,"depth stencil","depth stencil")),ot(!!T+!!C+!!k<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var N=null;for(i=0;i<R.length;++i)if(d(R[i],s,f),ot(!R[i]||R[i].texture&&Qi.indexOf(R[i].texture._texture.format)>=0||R[i].renderbuffer&&lo.indexOf(R[i].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+i+" is invalid"),R[i]&&R[i].texture){var z=Ji[R[i].texture._texture.format]*$i[R[i].texture._texture.type];null===N?N=z:ot(N===z,"all color attachments much have the same number of bits per pixel.")}return d(L,s,f),ot(!L||L.texture&&L.texture._texture.format===Ki||L.renderbuffer&&L.renderbuffer._renderbuffer.format===ro,"invalid depth attachment for framebuffer object"),d(O,s,f),ot(!O||O.renderbuffer&&O.renderbuffer._renderbuffer.format===io,"invalid stencil attachment for framebuffer object"),d(D,s,f),ot(!D||D.texture&&D.texture._texture.format===oo||D.renderbuffer&&D.renderbuffer._renderbuffer.format===oo,"invalid depth-stencil attachment for framebuffer object"),E(o),o.width=s,o.height=f,o.colorAttachments=R,o.depthAttachment=L,o.stencilAttachment=O,o.depthStencilAttachment=D,a.color=R.map(y),a.depth=y(L),a.stencil=y(O),a.depthStencil=y(D),a.width=o.width,a.height=o.height,A(o),a}function f(t,e){ot(u.next!==o,"can not resize a framebuffer which is currently in use");var n=Math.max(0|t,1),r=Math.max(0|e||n,1);if(n===o.width&&r===o.height)return a;for(var i=o.colorAttachments,s=0;s<i.length;++s)_(i[s],n,r);return _(o.depthAttachment,n,r),_(o.stencilAttachment,n,r),_(o.depthStencilAttachment,n,r),o.width=a.width=n,o.height=a.height=r,A(o),a}return s.framebufferCount++,a(t,i),n(a,{resize:f,_reglType:"framebuffer",_framebuffer:o,destroy:function(){S(o),E(o)},use:function(t){u.setFBO({framebuffer:a},t)}})}function C(t){var o=Array(6);function a(t){var r;ot(o.indexOf(u.next)<0,"can not update framebuffer which is currently in use");var s,l={color:null},f=0,p=null,d="rgba",v="uint8",m=1;if("number"===typeof t)f=0|t;else if(t){ot.type(t,"object","invalid arguments for framebuffer");var g=t;if("shape"in g){var y=g.shape;ot(Array.isArray(y)&&y.length>=2,"invalid shape for framebuffer"),ot(y[0]===y[1],"cube framebuffer must be square"),f=y[0]}else"radius"in g&&(f=0|g.radius),"width"in g?(f=0|g.width,"height"in g&&ot(g.height===f,"must be square")):"height"in g&&(f=0|g.height);("color"in g||"colors"in g)&&(p=g.color||g.colors,Array.isArray(p)&&ot(1===p.length||e.webgl_draw_buffers,"multiple render targets not supported")),p||("colorCount"in g&&(m=0|g.colorCount,ot(m>0,"invalid color buffer count")),"colorType"in g&&(ot.oneOf(g.colorType,h,"invalid color type"),v=g.colorType),"colorFormat"in g&&(d=g.colorFormat,ot.oneOf(g.colorFormat,c,"invalid color format for texture"))),"depth"in g&&(l.depth=g.depth),"stencil"in g&&(l.stencil=g.stencil),"depthStencil"in g&&(l.depthStencil=g.depthStencil)}else f=1;if(p)if(Array.isArray(p))for(s=[],r=0;r<p.length;++r)s[r]=p[r];else s=[p];else{s=Array(m);var _={radius:f,format:d,type:v};for(r=0;r<m;++r)s[r]=i.createCube(_)}for(l.color=Array(s.length),r=0;r<s.length;++r){var x=s[r];ot("function"===typeof x&&"textureCube"===x._reglType,"invalid cube map"),f=f||x.width,ot(x.width===f&&x.height===f,"invalid cube map shape"),l.color[r]={target:Di,data:s[r]}}for(r=0;r<6;++r){for(var b=0;b<s.length;++b)l.color[b].target=Di+r;r>0&&(l.depth=o[0].depth,l.stencil=o[0].stencil,l.depthStencil=o[0].depthStencil),o[r]?o[r](l):o[r]=T(l)}return n(a,{width:f,height:f,color:s})}function s(t){var e,n=0|t;if(ot(n>0&&n<=r.maxCubeMapSize,"invalid radius for cube fbo"),n===a.width)return a;var i=a.color;for(e=0;e<i.length;++e)i[e].resize(n);for(e=0;e<6;++e)o[e].resize(n);return a.width=a.height=n,a}return a(t),n(a,{faces:o,resize:s,_reglType:"framebufferCube",destroy:function(){o.forEach((function(t){t.destroy()}))}})}function k(){u.cur=null,u.next=null,u.dirty=!0,ke(b).forEach((function(e){e.framebuffer=t.createFramebuffer(),A(e)}))}return n(u,{getFramebuffer:function(t){if("function"===typeof t&&"framebuffer"===t._reglType){var e=t._framebuffer;if(e instanceof w)return e}return null},create:T,createCube:C,clear:function(){ke(b).forEach(S)},restore:k})}ho[Ui]="complete",ho[ji]="incomplete attachment",ho[Vi]="incomplete dimensions",ho[Zi]="incomplete, missing attachment",ho[Gi]="unsupported";var po=5126,vo=34962,mo=34963,go=["attributes","elements","offset","count","primitive","instances"];function yo(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=po,this.offset=0,this.stride=0,this.divisor=0}function _o(t,n,r,i,o,s,u){for(var c=r.maxAttributes,l=new Array(c),h=0;h<c;++h)l[h]=new yo;var f=0,p={},d={Record:yo,scope:{},state:l,currentVAO:null,targetVAO:null,restore:m()?E:function(){},createVAO:S,getVAO:y,destroyBuffer:v,setVAO:m()?_:x,clear:m()?b:function(){}};function v(e){for(var n=0;n<l.length;++n){var r=l[n];r.buffer===e&&(t.disableVertexAttribArray(n),r.buffer=null)}}function m(){return n.oes_vertex_array_object}function g(){return n.angle_instanced_arrays}function y(t){return"function"===typeof t&&t._vao?t._vao:null}function _(t){if(t!==d.currentVAO){var e=m();t?e.bindVertexArrayOES(t.vao):e.bindVertexArrayOES(null),d.currentVAO=t}}function x(e){if(e!==d.currentVAO){if(e)e.bindAttrs();else{for(var n=g(),r=0;r<l.length;++r){var i=l[r];i.buffer?(t.enableVertexAttribArray(r),i.buffer.bind(),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offfset),n&&i.divisor&&n.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}u.elements?t.bindBuffer(mo,u.elements.buffer.buffer):t.bindBuffer(mo,null)}d.currentVAO=e}}function b(){ke(p).forEach((function(t){t.destroy()}))}function w(){this.id=++f,this.attributes=[],this.elements=null,this.ownsElements=!1,this.count=0,this.offset=0,this.instances=-1,this.primitive=4;var t=m();this.vao=t?t.createVertexArrayOES():null,p[this.id]=this,this.buffers=[]}function E(){var t=m();t&&ke(p).forEach((function(t){t.refresh()}))}function S(t){var r=new w;function u(t){var i;if(Array.isArray(t))i=t,r.elements&&r.ownsElements&&r.elements.destroy(),r.elements=null,r.ownsElements=!1,r.offset=0,r.count=0,r.instances=-1,r.primitive=4;else{if(ot("object"===a(t),"invalid arguments for create vao"),ot("attributes"in t,"must specify attributes for vao"),t.elements){var l=t.elements;r.ownsElements?"function"===typeof l&&"elements"===l._reglType?(r.elements.destroy(),r.ownsElements=!1):(r.elements(l),r.ownsElements=!1):s.getElements(t.elements)?(r.elements=t.elements,r.ownsElements=!1):(r.elements=s.create(t.elements),r.ownsElements=!0)}else r.elements=null,r.ownsElements=!1;i=t.attributes,r.offset=0,r.count=-1,r.instances=-1,r.primitive=4,r.elements&&(r.count=r.elements._elements.vertCount,r.primitive=r.elements._elements.primType),"offset"in t&&(r.offset=0|t.offset),"count"in t&&(r.count=0|t.count),"instances"in t&&(r.instances=0|t.instances),"primitive"in t&&(ot(t.primitive in pn,"bad primitive type: "+t.primitive),r.primitive=pn[t.primitive]),ot.optional((function(){for(var e=Object.keys(t),n=0;n<e.length;++n)ot(go.indexOf(e[n])>=0,'invalid option for vao: "'+e[n]+'" valid options are '+go)})),ot(Array.isArray(i),"attributes must be an array")}ot(i.length<c,"too many attributes"),ot(i.length>0,"must specify at least one attribute");var h={},f=r.attributes;f.length=i.length;for(var p=0;p<i.length;++p){var d,v=i[p],m=f[p]=new yo,g=v.data||v;if(Array.isArray(g)||e(g)||Ce(g))r.buffers[p]&&(d=r.buffers[p],e(g)&&d._buffer.byteLength>=g.byteLength?d.subdata(g):(d.destroy(),r.buffers[p]=null)),r.buffers[p]||(d=r.buffers[p]=o.create(v,vo,!1,!0)),m.buffer=o.getBuffer(d),m.size=0|m.buffer.dimension,m.normalized=!1,m.type=m.buffer.dtype,m.offset=0,m.stride=0,m.divisor=0,m.state=1,h[p]=1;else o.getBuffer(v)?(m.buffer=o.getBuffer(v),m.size=0|m.buffer.dimension,m.normalized=!1,m.type=m.buffer.dtype,m.offset=0,m.stride=0,m.divisor=0,m.state=1):o.getBuffer(v.buffer)?(m.buffer=o.getBuffer(v.buffer),m.size=0|(+v.size||m.buffer.dimension),m.normalized=!!v.normalized||!1,"type"in v?(ot.parameter(v.type,He,"invalid buffer type"),m.type=He[v.type]):m.type=m.buffer.dtype,m.offset=0|(v.offset||0),m.stride=0|(v.stride||0),m.divisor=0|(v.divisor||0),m.state=1,ot(m.size>=1&&m.size<=4,"size must be between 1 and 4"),ot(m.offset>=0,"invalid offset"),ot(m.stride>=0&&m.stride<=255,"stride must be between 0 and 255"),ot(m.divisor>=0,"divisor must be positive"),ot(!m.divisor||!!n.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in v?(ot(p>0,"first attribute must not be a constant"),m.x=+v.x||0,m.y=+v.y||0,m.z=+v.z||0,m.w=+v.w||0,m.state=2):ot(!1,"invalid attribute spec for location "+p)}for(var y=0;y<r.buffers.length;++y)!h[y]&&r.buffers[y]&&(r.buffers[y].destroy(),r.buffers[y]=null);return r.refresh(),u}return i.vaoCount+=1,u.destroy=function(){for(var t=0;t<r.buffers.length;++t)r.buffers[t]&&r.buffers[t].destroy();r.buffers.length=0,r.ownsElements&&(r.elements.destroy(),r.elements=null,r.ownsElements=!1),r.destroy()},u._vao=r,u._reglType="vao",u(t)}return w.prototype.bindAttrs=function(){for(var e=g(),n=this.attributes,r=0;r<n.length;++r){var i=n[r];i.buffer?(t.enableVertexAttribArray(r),t.bindBuffer(vo,i.buffer.buffer),t.vertexAttribPointer(r,i.size,i.type,i.normalized,i.stride,i.offset),e&&i.divisor&&e.vertexAttribDivisorANGLE(r,i.divisor)):(t.disableVertexAttribArray(r),t.vertexAttrib4f(r,i.x,i.y,i.z,i.w))}for(var o=n.length;o<c;++o)t.disableVertexAttribArray(o);var a=s.getElements(this.elements);a?t.bindBuffer(mo,a.buffer.buffer):t.bindBuffer(mo,null)},w.prototype.refresh=function(){var t=m();t&&(t.bindVertexArrayOES(this.vao),this.bindAttrs(),d.currentVAO=null,t.bindVertexArrayOES(null))},w.prototype.destroy=function(){if(this.vao){var t=m();this===d.currentVAO&&(d.currentVAO=null,t.bindVertexArrayOES(null)),t.deleteVertexArrayOES(this.vao),this.vao=null}this.ownsElements&&(this.elements.destroy(),this.elements=null,this.ownsElements=!1),p[this.id]&&(delete p[this.id],i.vaoCount-=1)},d}var xo=35632,bo=35633,wo=35718,Eo=35721;function So(t,e,r,i){var o={},a={};function s(t,e,n,r){this.name=t,this.id=e,this.location=n,this.info=r}function u(t,e){for(var n=0;n<t.length;++n)if(t[n].id===e.id)return void(t[n].location=e.location);t.push(e)}function c(n,r,i){var s=n===xo?o:a,u=s[r];if(!u){var c=e.str(r);u=t.createShader(n),t.shaderSource(u,c),t.compileShader(u),ot.shaderError(t,u,c,n,i),s[r]=u}return u}var l={},h=[],f=0;function p(t,e){this.id=f++,this.fragId=t,this.vertId=e,this.program=null,this.uniforms=[],this.attributes=[],this.refCount=1,i.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function d(n,r,o){var a,l,h=c(xo,n.fragId),f=c(bo,n.vertId),p=n.program=t.createProgram();if(t.attachShader(p,h),t.attachShader(p,f),o)for(a=0;a<o.length;++a){var d=o[a];t.bindAttribLocation(p,d[0],d[1])}t.linkProgram(p),ot.linkError(t,p,e.str(n.fragId),e.str(n.vertId),r);var v=t.getProgramParameter(p,wo);i.profile&&(n.stats.uniformsCount=v);var m=n.uniforms;for(a=0;a<v;++a)if(l=t.getActiveUniform(p,a),l)if(l.size>1)for(var g=0;g<l.size;++g){var y=l.name.replace("[0]","["+g+"]");u(m,new s(y,e.id(y),t.getUniformLocation(p,y),l))}else u(m,new s(l.name,e.id(l.name),t.getUniformLocation(p,l.name),l));var _=t.getProgramParameter(p,Eo);i.profile&&(n.stats.attributesCount=_);var x=n.attributes;for(a=0;a<_;++a)l=t.getActiveAttrib(p,a),l&&u(x,new s(l.name,e.id(l.name),t.getAttribLocation(p,l.name),l))}function v(){o={},a={};for(var t=0;t<h.length;++t)d(h[t],null,h[t].attributes.map((function(t){return[t.location,t.name]})))}return i.profile&&(r.getMaxUniformsCount=function(){var t=0;return h.forEach((function(e){e.stats.uniformsCount>t&&(t=e.stats.uniformsCount)})),t},r.getMaxAttributesCount=function(){var t=0;return h.forEach((function(e){e.stats.attributesCount>t&&(t=e.stats.attributesCount)})),t}),{clear:function(){var e=t.deleteShader.bind(t);ke(o).forEach(e),o={},ke(a).forEach(e),a={},h.forEach((function(e){t.deleteProgram(e.program)})),h.length=0,l={},r.shaderCount=0},program:function(e,i,s,u){ot.command(e>=0,"missing vertex shader",s),ot.command(i>=0,"missing fragment shader",s);var c=l[i];c||(c=l[i]={});var f=c[e];if(f&&(f.refCount++,!u))return f;var v=new p(i,e);return r.shaderCount++,d(v,s,u),f||(c[e]=v),h.push(v),n(v,{destroy:function(){if(v.refCount--,v.refCount<=0){t.deleteProgram(v.program);var e=h.indexOf(v);h.splice(e,1),r.shaderCount--}c[v.vertId].refCount<=0&&(t.deleteShader(a[v.vertId]),delete a[v.vertId],delete l[v.fragId][v.vertId]),Object.keys(l[v.fragId]).length||(t.deleteShader(o[v.fragId]),delete o[v.fragId],delete l[v.fragId])}})},restore:v,shader:c,frag:-1,vert:-1}}var Ao=6408,To=5121,Co=3333,ko=5126;function Mo(t,n,r,i,o,a,s){function u(u){var c;null===n.next?(ot(o.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),c=To):(ot(null!==n.next.colorAttachments[0].texture,"You cannot read from a renderbuffer"),c=n.next.colorAttachments[0].texture._texture.type,ot.optional((function(){a.oes_texture_float?(ot(c===To||c===ko,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),c===ko&&ot(s.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):ot(c===To,"Reading from a framebuffer is only allowed for the type 'uint8'")})));var l=0,h=0,f=i.framebufferWidth,p=i.framebufferHeight,d=null;e(u)?d=u:u&&(ot.type(u,"object","invalid arguments to regl.read()"),l=0|u.x,h=0|u.y,ot(l>=0&&l<i.framebufferWidth,"invalid x offset for regl.read"),ot(h>=0&&h<i.framebufferHeight,"invalid y offset for regl.read"),f=0|(u.width||i.framebufferWidth-l),p=0|(u.height||i.framebufferHeight-h),d=u.data||null),d&&(c===To?ot(d instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):c===ko&&ot(d instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),ot(f>0&&f+l<=i.framebufferWidth,"invalid width for read pixels"),ot(p>0&&p+h<=i.framebufferHeight,"invalid height for read pixels"),r();var v=f*p*4;return d||(c===To?d=new Uint8Array(v):c===ko&&(d=d||new Float32Array(v))),ot.isTypedArray(d,"data buffer for regl.read() must be a typedarray"),ot(d.byteLength>=v,"data buffer for regl.read() too small"),t.pixelStorei(Co,4),t.readPixels(l,h,f,p,Ao,c,d),d}function c(t){var e;return n.setFBO({framebuffer:t.framebuffer},(function(){e=u(t)})),e}function l(t){return t&&"framebuffer"in t?c(t):u(t)}return l}function Po(t){return Array.prototype.slice.call(t)}function Io(t){return Po(t).join("")}function Ro(){var e=0,r=[],i=[];function o(t){for(var n=0;n<i.length;++n)if(i[n]===t)return r[n];var o="g"+e++;return r.push(o),i.push(t),o}function a(){var t=[];function r(){t.push.apply(t,Po(arguments))}var i=[];function o(){var n="v"+e++;return i.push(n),arguments.length>0&&(t.push(n,"="),t.push.apply(t,Po(arguments)),t.push(";")),n}return n(r,{def:o,toString:function(){return Io([i.length>0?"var "+i.join(",")+";":"",Io(t)])}})}function s(){var t=a(),e=a(),r=t.toString,i=e.toString;function o(n,r){e(n,r,"=",t.def(n,r),";")}return n((function(){t.apply(t,Po(arguments))}),{def:t.def,entry:t,exit:e,save:o,set:function(e,n,r){o(e,n),t(e,n,"=",r,";")},toString:function(){return r()+i()}})}function u(){var t=Io(arguments),e=s(),r=s(),i=e.toString,o=r.toString;return n(e,{then:function(){return e.apply(e,Po(arguments)),this},else:function(){return r.apply(r,Po(arguments)),this},toString:function(){var e=o();return e&&(e="else{"+e+"}"),Io(["if(",t,"){",i(),"}",e])}})}var c=a(),l={};function h(t,e){var r=[];function i(){var t="a"+r.length;return r.push(t),t}e=e||0;for(var o=0;o<e;++o)i();var a=s(),u=a.toString,c=l[t]=n(a,{arg:i,toString:function(){return Io(["function(",r.join(),"){",u(),"}"])}});return c}function f(){var e=['"use strict";',c,"return {"];Object.keys(l).forEach((function(t){e.push('"',t,'":',l[t].toString(),",")})),e.push("}");var n=Io(e).replace(/;/g,";\n").replace(/}/g,"}\n").replace(/{/g,"{\n"),o="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM,a=o?t.Function.apply(null,r.concat(n)):Function.apply(null,r.concat(n));return a.apply(null,i)}return{global:c,link:o,block:a,proc:h,scope:s,cond:u,compile:f}}var Lo="xyzw".split(""),Oo=5121,Do=1,No=2,zo=0,Fo=1,Bo=2,Uo=3,jo=4,Zo=5,Vo=6,Go="dither",Ho="blend.enable",Wo="blend.color",qo="blend.equation",Xo="blend.func",Yo="depth.enable",Ko="depth.func",Qo="depth.range",Jo="depth.mask",$o="colorMask",ta="cull.enable",ea="cull.face",na="frontFace",ra="lineWidth",ia="polygonOffset.enable",oa="polygonOffset.offset",aa="sample.alpha",sa="sample.enable",ua="sample.coverage",ca="stencil.enable",la="stencil.mask",ha="stencil.func",fa="stencil.opFront",pa="stencil.opBack",da="scissor.enable",va="scissor.box",ma="viewport",ga="profile",ya="framebuffer",_a="vert",xa="frag",ba="elements",wa="primitive",Ea="count",Sa="offset",Aa="instances",Ta="vao",Ca="Width",ka="Height",Ma=ya+Ca,Pa=ya+ka,Ia=ma+Ca,Ra=ma+ka,La="drawingBuffer",Oa=La+Ca,Da=La+ka,Na=[Xo,qo,ha,fa,pa,ua,ma,va,oa],za=34962,Fa=34963,Ba=35632,Ua=35633,ja=3553,Za=34067,Va=2884,Ga=3042,Ha=3024,Wa=2960,qa=2929,Xa=3089,Ya=32823,Ka=32926,Qa=32928,Ja=5126,$a=35664,ts=35665,es=35666,ns=5124,rs=35667,is=35668,os=35669,as=35670,ss=35671,us=35672,cs=35673,ls=35674,hs=35675,fs=35676,ps=35678,ds=35680,vs=4,ms=1028,gs=1029,ys=2304,_s=2305,xs=32775,bs=32776,ws=519,Es=7680,Ss=0,As=1,Ts=32774,Cs=513,ks=36160,Ms=36064,Ps={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},Is=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Rs={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Ls={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},Os={frag:Ba,vert:Ua},Ds={cw:ys,ccw:_s};function Ns(t){return Array.isArray(t)||e(t)||Ce(t)}function zs(t){return t.sort((function(t,e){return t===ma?-1:e===ma?1:t<e?-1:1}))}function Fs(t,e,n,r){this.thisDep=t,this.contextDep=e,this.propDep=n,this.append=r}function Bs(t){return t&&!(t.thisDep||t.contextDep||t.propDep)}function Us(t){return new Fs(!1,!1,!1,t)}function js(t,e){var n=t.type;if(n===zo){var r=t.data.length;return new Fs(!0,r>=1,r>=2,e)}if(n===jo){var i=t.data;return new Fs(i.thisDep,i.contextDep,i.propDep,e)}if(n===Zo)return new Fs(!1,!1,!1,e);if(n===Vo){for(var o=!1,a=!1,s=!1,u=0;u<t.data.length;++u){var c=t.data[u];if(c.type===Fo)s=!0;else if(c.type===Bo)a=!0;else if(c.type===Uo)o=!0;else if(c.type===zo){o=!0;var l=c.data;l>=1&&(a=!0),l>=2&&(s=!0)}else c.type===jo&&(o=o||c.data.thisDep,a=a||c.data.contextDep,s=s||c.data.propDep)}return new Fs(o,a,s,e)}return new Fs(n===Uo,n===Bo,n===Fo,e)}var Zs=new Fs(!1,!1,!1,(function(){}));function Vs(t,e,r,i,o,s,u,c,l,h,f,p,d,v,m){var g=h.Record,y={add:32774,subtract:32778,"reverse subtract":32779};r.ext_blend_minmax&&(y.min=xs,y.max=bs);var _=r.angle_instanced_arrays,x=r.webgl_draw_buffers,b=r.oes_vertex_array_object,w={dirty:!0,profile:m.profile},E={},S=[],A={},T={};function C(t){return t.replace(".","_")}function k(t,e,n){var r=C(t);S.push(t),E[r]=w[r]=!!n,A[r]=e}function M(t,e,n){var r=C(t);S.push(t),Array.isArray(n)?(w[r]=n.slice(),E[r]=n.slice()):w[r]=E[r]=n,T[r]=e}k(Go,Ha),k(Ho,Ga),M(Wo,"blendColor",[0,0,0,0]),M(qo,"blendEquationSeparate",[Ts,Ts]),M(Xo,"blendFuncSeparate",[As,Ss,As,Ss]),k(Yo,qa,!0),M(Ko,"depthFunc",Cs),M(Qo,"depthRange",[0,1]),M(Jo,"depthMask",!0),M($o,$o,[!0,!0,!0,!0]),k(ta,Va),M(ea,"cullFace",gs),M(na,na,_s),M(ra,ra,1),k(ia,Ya),M(oa,"polygonOffset",[0,0]),k(aa,Ka),k(sa,Qa),M(ua,"sampleCoverage",[1,!1]),k(ca,Wa),M(la,"stencilMask",-1),M(ha,"stencilFunc",[ws,0,-1]),M(fa,"stencilOpSeparate",[ms,Es,Es,Es]),M(pa,"stencilOpSeparate",[gs,Es,Es,Es]),k(da,Xa),M(va,"scissor",[0,0,t.drawingBufferWidth,t.drawingBufferHeight]),M(ma,ma,[0,0,t.drawingBufferWidth,t.drawingBufferHeight]);var P={gl:t,context:d,strings:e,next:E,current:w,draw:p,elements:s,buffer:o,shader:f,attributes:h.state,vao:h,uniforms:l,framebuffer:c,extensions:r,timer:v,isBufferArgs:Ns},I={primTypes:pn,compareFuncs:Rs,blendFuncs:Ps,blendEquations:y,stencilOps:Ls,glTypes:He,orientationType:Ds};ot.optional((function(){P.isArrayLike=In})),x&&(I.backBuffer=[gs],I.drawBuffer=Pt(i.maxDrawbuffers,(function(t){return 0===t?[0]:Pt(t,(function(t){return Ms+t}))})));var R=0;function L(){var t=Ro(),n=t.link,r=t.global;t.id=R++,t.batchId="0";var i=n(P),o=t.shared={props:"a0"};Object.keys(P).forEach((function(t){o[t]=r.def(i,".",t)})),ot.optional((function(){t.CHECK=n(ot),t.commandStr=ot.guessCommand(),t.command=n(t.commandStr),t.assert=function(t,e,r){t("if(!(",e,"))",this.CHECK,".commandRaise(",n(r),",",this.command,");")},I.invalidBlendCombinations=Is}));var a=t.next={},s=t.current={};Object.keys(T).forEach((function(t){Array.isArray(w[t])&&(a[t]=r.def(o.next,".",t),s[t]=r.def(o.current,".",t))}));var u=t.constants={};Object.keys(I).forEach((function(t){u[t]=r.def(JSON.stringify(I[t]))})),t.invoke=function(e,r){switch(r.type){case zo:var i=["this",o.context,o.props,t.batchId];return e.def(n(r.data),".call(",i.slice(0,Math.max(r.data.length+1,4)),")");case Fo:return e.def(o.props,r.data);case Bo:return e.def(o.context,r.data);case Uo:return e.def("this",r.data);case jo:return r.data.append(t,e),r.data.ref;case Zo:return r.data.toString();case Vo:return r.data.map((function(n){return t.invoke(e,n)}))}},t.attribCache={};var c={};return t.scopeAttrib=function(t){var r=e.id(t);if(r in c)return c[r];var i=h.scope[r];i||(i=h.scope[r]=new g);var o=c[r]=n(i);return o},t}function O(t){var e,n=t.static,r=t.dynamic;if(ga in n){var i=!!n[ga];e=Us((function(t,e){return i})),e.enable=i}else if(ga in r){var o=r[ga];e=js(o,(function(t,e){return t.invoke(e,o)}))}return e}function D(t,e){var n=t.static,r=t.dynamic;if(ya in n){var i=n[ya];return i?(i=c.getFramebuffer(i),ot.command(i,"invalid framebuffer object"),Us((function(t,e){var n=t.link(i),r=t.shared;e.set(r.framebuffer,".next",n);var o=r.context;return e.set(o,"."+Ma,n+".width"),e.set(o,"."+Pa,n+".height"),n}))):Us((function(t,e){var n=t.shared;e.set(n.framebuffer,".next","null");var r=n.context;return e.set(r,"."+Ma,r+"."+Oa),e.set(r,"."+Pa,r+"."+Da),"null"}))}if(ya in r){var o=r[ya];return js(o,(function(t,e){var n=t.invoke(e,o),r=t.shared,i=r.framebuffer,a=e.def(i,".getFramebuffer(",n,")");ot.optional((function(){t.assert(e,"!"+n+"||"+a,"invalid framebuffer object")})),e.set(i,".next",a);var s=r.context;return e.set(s,"."+Ma,a+"?"+a+".width:"+s+"."+Oa),e.set(s,"."+Pa,a+"?"+a+".height:"+s+"."+Da),a}))}return null}function N(t,e,n){var r=t.static,i=t.dynamic;function o(t){if(t in r){var o=r[t];ot.commandType(o,"object","invalid "+t,n.commandStr);var a,s,u=!0,c=0|o.x,l=0|o.y;return"width"in o?(a=0|o.width,ot.command(a>=0,"invalid "+t,n.commandStr)):u=!1,"height"in o?(s=0|o.height,ot.command(s>=0,"invalid "+t,n.commandStr)):u=!1,new Fs(!u&&e&&e.thisDep,!u&&e&&e.contextDep,!u&&e&&e.propDep,(function(t,e){var n=t.shared.context,r=a;"width"in o||(r=e.def(n,".",Ma,"-",c));var i=s;return"height"in o||(i=e.def(n,".",Pa,"-",l)),[c,l,r,i]}))}if(t in i){var h=i[t],f=js(h,(function(e,n){var r=e.invoke(n,h);ot.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=e.shared.context,o=n.def(r,".x|0"),a=n.def(r,".y|0"),s=n.def('"width" in ',r,"?",r,".width|0:","(",i,".",Ma,"-",o,")"),u=n.def('"height" in ',r,"?",r,".height|0:","(",i,".",Pa,"-",a,")");return ot.optional((function(){e.assert(n,s+">=0&&"+u+">=0","invalid "+t)})),[o,a,s,u]}));return e&&(f.thisDep=f.thisDep||e.thisDep,f.contextDep=f.contextDep||e.contextDep,f.propDep=f.propDep||e.propDep),f}return e?new Fs(e.thisDep,e.contextDep,e.propDep,(function(t,e){var n=t.shared.context;return[0,0,e.def(n,".",Ma),e.def(n,".",Pa)]})):null}var a=o(ma);if(a){var s=a;a=new Fs(a.thisDep,a.contextDep,a.propDep,(function(t,e){var n=s.append(t,e),r=t.shared.context;return e.set(r,"."+Ia,n[2]),e.set(r,"."+Ra,n[3]),n}))}return{viewport:a,scissor_box:o(va)}}function z(t,e){var n=t.static,r="string"===typeof n[xa]&&"string"===typeof n[_a];if(r){if(Object.keys(e.dynamic).length>0)return null;var i=e.static,o=Object.keys(i);if(o.length>0&&"number"===typeof i[o[0]]){for(var a=[],s=0;s<o.length;++s)ot("number"===typeof i[o[s]],"must specify all vertex attribute locations when using vaos"),a.push([0|i[o[s]],o[s]]);return a}}return null}function F(t,n,r){var i=t.static,o=t.dynamic;function a(t){if(t in i){var n=e.id(i[t]);ot.optional((function(){f.shader(Os[t],n,ot.guessCommand())}));var r=Us((function(){return n}));return r.id=n,r}if(t in o){var a=o[t];return js(a,(function(e,n){var r=e.invoke(n,a),i=n.def(e.shared.strings,".id(",r,")");return ot.optional((function(){n(e.shared.shader,".shader(",Os[t],",",i,",",e.command,");")})),i}))}return null}var s,u=a(xa),c=a(_a),l=null;return Bs(u)&&Bs(c)?(l=f.program(c.id,u.id,null,r),s=Us((function(t,e){return t.link(l)}))):s=new Fs(u&&u.thisDep||c&&c.thisDep,u&&u.contextDep||c&&c.contextDep,u&&u.propDep||c&&c.propDep,(function(t,e){var n,r,i=t.shared.shader;n=u?u.append(t,e):e.def(i,".",xa),r=c?c.append(t,e):e.def(i,".",_a);var o=i+".program("+r+","+n;return ot.optional((function(){o+=","+t.command})),e.def(o+")")})),{frag:u,vert:c,progVar:s,program:l}}function B(t,e){var n=t.static,r=t.dynamic,i={},o=!1;function a(){if(Ta in n){var t=n[Ta];return null!==t&&null===h.getVAO(t)&&(t=h.createVAO(t)),o=!0,i.vao=t,Us((function(e){var n=h.getVAO(t);return n?e.link(n):"null"}))}if(Ta in r){o=!0;var e=r[Ta];return js(e,(function(t,n){var r=t.invoke(n,e);return n.def(t.shared.vao+".getVAO("+r+")")}))}return null}var u=a(),c=!1;function l(){if(ba in n){var t=n[ba];if(i.elements=t,Ns(t)){var a=i.elements=s.create(t,!0);t=s.getElements(a),c=!0}else t&&(t=s.getElements(t),c=!0,ot.command(t,"invalid elements",e.commandStr));var l=Us((function(e,n){if(t){var r=e.link(t);return e.ELEMENTS=r,r}return e.ELEMENTS=null,null}));return l.value=t,l}if(ba in r){c=!0;var h=r[ba];return js(h,(function(t,e){var n=t.shared,r=n.isBufferArgs,i=n.elements,o=t.invoke(e,h),a=e.def("null"),s=e.def(r,"(",o,")"),u=t.cond(s).then(a,"=",i,".createStream(",o,");").else(a,"=",i,".getElements(",o,");");return ot.optional((function(){t.assert(u.else,"!"+o+"||"+a,"invalid elements")})),e.entry(u),e.exit(t.cond(s).then(i,".destroyStream(",a,");")),t.ELEMENTS=a,a}))}return o?new Fs(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.elements+".getElements("+t.shared.vao+".currentVAO.elements):null")})):null}var f=l();function p(){if(wa in n){var t=n[wa];return i.primitive=t,ot.commandParameter(t,pn,"invalid primitve",e.commandStr),Us((function(e,n){return pn[t]}))}if(wa in r){var a=r[wa];return js(a,(function(t,e){var n=t.constants.primTypes,r=t.invoke(e,a);return ot.optional((function(){t.assert(e,r+" in "+n,"invalid primitive, must be one of "+Object.keys(pn))})),e.def(n,"[",r,"]")}))}return c?Bs(f)?f.value?Us((function(t,e){return e.def(t.ELEMENTS,".primType")})):Us((function(){return vs})):new Fs(f.thisDep,f.contextDep,f.propDep,(function(t,e){var n=t.ELEMENTS;return e.def(n,"?",n,".primType:",vs)})):o?new Fs(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.primitive:"+vs)})):null}function d(t,a){if(t in n){var s=0|n[t];return a?i.offset=s:i.instances=s,ot.command(!a||s>=0,"invalid "+t,e.commandStr),Us((function(t,e){return a&&(t.OFFSET=s),s}))}if(t in r){var l=r[t];return js(l,(function(e,n){var r=e.invoke(n,l);return a&&(e.OFFSET=r,ot.optional((function(){e.assert(n,r+">=0","invalid "+t)}))),r}))}if(a){if(c)return Us((function(t,e){return t.OFFSET=0,0}));if(o)return new Fs(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.offset:0")}))}else if(o)return new Fs(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao+".currentVAO?"+t.shared.vao+".currentVAO.instances:-1")}));return null}var v=d(Sa,!0);function m(){if(Ea in n){var t=0|n[Ea];return i.count=t,ot.command("number"===typeof t&&t>=0,"invalid vertex count",e.commandStr),Us((function(){return t}))}if(Ea in r){var a=r[Ea];return js(a,(function(t,e){var n=t.invoke(e,a);return ot.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">=0&&"+n+"===("+n+"|0)","invalid vertex count")})),n}))}if(c){if(Bs(f)){if(f)return v?new Fs(v.thisDep,v.contextDep,v.propDep,(function(t,e){var n=e.def(t.ELEMENTS,".vertCount-",t.OFFSET);return ot.optional((function(){t.assert(e,n+">=0","invalid vertex offset/element buffer too small")})),n})):Us((function(t,e){return e.def(t.ELEMENTS,".vertCount")}));var s=Us((function(){return-1}));return ot.optional((function(){s.MISSING=!0})),s}var l=new Fs(f.thisDep||v.thisDep,f.contextDep||v.contextDep,f.propDep||v.propDep,(function(t,e){var n=t.ELEMENTS;return t.OFFSET?e.def(n,"?",n,".vertCount-",t.OFFSET,":-1"):e.def(n,"?",n,".vertCount:-1")}));return ot.optional((function(){l.DYNAMIC=!0})),l}if(o){var h=new Fs(u.thisDep,u.contextDep,u.propDep,(function(t,e){return e.def(t.shared.vao,".currentVAO?",t.shared.vao,".currentVAO.count:-1")}));return h}return null}var g=p(),y=m(),_=d(Aa,!1);return{elements:f,primitive:g,count:y,instances:_,offset:v,vao:u,vaoActive:o,elementsActive:c,static:i}}function U(t,e){var n=t.static,r=t.dynamic,o={};return S.forEach((function(t){var s=C(t);function u(e,i){if(t in n){var a=e(n[t]);o[s]=Us((function(){return a}))}else if(t in r){var u=r[t];o[s]=js(u,(function(t,e){return i(t,e,t.invoke(e,u))}))}}switch(t){case ta:case Ho:case Go:case ca:case Yo:case da:case ia:case aa:case sa:case Jo:return u((function(n){return ot.commandType(n,"boolean",t,e.commandStr),n}),(function(e,n,r){return ot.optional((function(){e.assert(n,"typeof "+r+'==="boolean"',"invalid flag "+t,e.commandStr)})),r}));case Ko:return u((function(n){return ot.commandParameter(n,Rs,"invalid "+t,e.commandStr),Rs[n]}),(function(e,n,r){var i=e.constants.compareFuncs;return ot.optional((function(){e.assert(n,r+" in "+i,"invalid "+t+", must be one of "+Object.keys(Rs))})),n.def(i,"[",r,"]")}));case Qo:return u((function(t){return ot.command(In(t)&&2===t.length&&"number"===typeof t[0]&&"number"===typeof t[1]&&t[0]<=t[1],"depth range is 2d array",e.commandStr),t}),(function(t,e,n){ot.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===2&&typeof "+n+'[0]==="number"&&typeof '+n+'[1]==="number"&&'+n+"[0]<="+n+"[1]","depth range must be a 2d array")}));var r=e.def("+",n,"[0]"),i=e.def("+",n,"[1]");return[r,i]}));case Xo:return u((function(t){ot.commandType(t,"object","blend.func",e.commandStr);var n="srcRGB"in t?t.srcRGB:t.src,r="srcAlpha"in t?t.srcAlpha:t.src,i="dstRGB"in t?t.dstRGB:t.dst,o="dstAlpha"in t?t.dstAlpha:t.dst;return ot.commandParameter(n,Ps,s+".srcRGB",e.commandStr),ot.commandParameter(r,Ps,s+".srcAlpha",e.commandStr),ot.commandParameter(i,Ps,s+".dstRGB",e.commandStr),ot.commandParameter(o,Ps,s+".dstAlpha",e.commandStr),ot.command(-1===Is.indexOf(n+", "+i),"unallowed blending combination (srcRGB, dstRGB) = ("+n+", "+i+")",e.commandStr),[Ps[n],Ps[i],Ps[r],Ps[o]]}),(function(e,n,r){var i=e.constants.blendFuncs;function o(o,a){var s=n.def('"',o,a,'" in ',r,"?",r,".",o,a,":",r,".",o);return ot.optional((function(){e.assert(n,s+" in "+i,"invalid "+t+"."+o+a+", must be one of "+Object.keys(Ps))})),s}ot.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid blend func, must be an object")}));var a=o("src","RGB"),s=o("dst","RGB");ot.optional((function(){var t=e.constants.invalidBlendCombinations;e.assert(n,t+".indexOf("+a+'+", "+'+s+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")}));var u=n.def(i,"[",a,"]"),c=n.def(i,"[",o("src","Alpha"),"]"),l=n.def(i,"[",s,"]"),h=n.def(i,"[",o("dst","Alpha"),"]");return[u,l,c,h]}));case qo:return u((function(n){return"string"===typeof n?(ot.commandParameter(n,y,"invalid "+t,e.commandStr),[y[n],y[n]]):"object"===a(n)?(ot.commandParameter(n.rgb,y,t+".rgb",e.commandStr),ot.commandParameter(n.alpha,y,t+".alpha",e.commandStr),[y[n.rgb],y[n.alpha]]):void ot.commandRaise("invalid blend.equation",e.commandStr)}),(function(e,n,r){var i=e.constants.blendEquations,o=n.def(),a=n.def(),s=e.cond("typeof ",r,'==="string"');return ot.optional((function(){function n(t,n,r){e.assert(t,r+" in "+i,"invalid "+n+", must be one of "+Object.keys(y))}n(s.then,t,r),e.assert(s.else,r+"&&typeof "+r+'==="object"',"invalid "+t),n(s.else,t+".rgb",r+".rgb"),n(s.else,t+".alpha",r+".alpha")})),s.then(o,"=",a,"=",i,"[",r,"];"),s.else(o,"=",i,"[",r,".rgb];",a,"=",i,"[",r,".alpha];"),n(s),[o,a]}));case Wo:return u((function(t){return ot.command(In(t)&&4===t.length,"blend.color must be a 4d array",e.commandStr),Pt(4,(function(e){return+t[e]}))}),(function(t,e,n){return ot.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","blend.color must be a 4d array")})),Pt(4,(function(t){return e.def("+",n,"[",t,"]")}))}));case la:return u((function(t){return ot.commandType(t,"number",s,e.commandStr),0|t}),(function(t,e,n){return ot.optional((function(){t.assert(e,"typeof "+n+'==="number"',"invalid stencil.mask")})),e.def(n,"|0")}));case ha:return u((function(n){ot.commandType(n,"object",s,e.commandStr);var r=n.cmp||"keep",i=n.ref||0,o="mask"in n?n.mask:-1;return ot.commandParameter(r,Rs,t+".cmp",e.commandStr),ot.commandType(i,"number",t+".ref",e.commandStr),ot.commandType(o,"number",t+".mask",e.commandStr),[Rs[r],i,o]}),(function(t,e,n){var r=t.constants.compareFuncs;ot.optional((function(){function i(){t.assert(e,Array.prototype.join.call(arguments,""),"invalid stencil.func")}i(n+"&&typeof ",n,'==="object"'),i('!("cmp" in ',n,")||(",n,".cmp in ",r,")")}));var i=e.def('"cmp" in ',n,"?",r,"[",n,".cmp]",":",Es),o=e.def(n,".ref|0"),a=e.def('"mask" in ',n,"?",n,".mask|0:-1");return[i,o,a]}));case fa:case pa:return u((function(n){ot.commandType(n,"object",s,e.commandStr);var r=n.fail||"keep",i=n.zfail||"keep",o=n.zpass||"keep";return ot.commandParameter(r,Ls,t+".fail",e.commandStr),ot.commandParameter(i,Ls,t+".zfail",e.commandStr),ot.commandParameter(o,Ls,t+".zpass",e.commandStr),[t===pa?gs:ms,Ls[r],Ls[i],Ls[o]]}),(function(e,n,r){var i=e.constants.stencilOps;function o(o){return ot.optional((function(){e.assert(n,'!("'+o+'" in '+r+")||("+r+"."+o+" in "+i+")","invalid "+t+"."+o+", must be one of "+Object.keys(Ls))})),n.def('"',o,'" in ',r,"?",i,"[",r,".",o,"]:",Es)}return ot.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)})),[t===pa?gs:ms,o("fail"),o("zfail"),o("zpass")]}));case oa:return u((function(t){ot.commandType(t,"object",s,e.commandStr);var n=0|t.factor,r=0|t.units;return ot.commandType(n,"number",s+".factor",e.commandStr),ot.commandType(r,"number",s+".units",e.commandStr),[n,r]}),(function(e,n,r){ot.optional((function(){e.assert(n,r+"&&typeof "+r+'==="object"',"invalid "+t)}));var i=n.def(r,".factor|0"),o=n.def(r,".units|0");return[i,o]}));case ea:return u((function(t){var n=0;return"front"===t?n=ms:"back"===t&&(n=gs),ot.command(!!n,s,e.commandStr),n}),(function(t,e,n){return ot.optional((function(){t.assert(e,n+'==="front"||'+n+'==="back"',"invalid cull.face")})),e.def(n,'==="front"?',ms,":",gs)}));case ra:return u((function(t){return ot.command("number"===typeof t&&t>=i.lineWidthDims[0]&&t<=i.lineWidthDims[1],"invalid line width, must be a positive number between "+i.lineWidthDims[0]+" and "+i.lineWidthDims[1],e.commandStr),t}),(function(t,e,n){return ot.optional((function(){t.assert(e,"typeof "+n+'==="number"&&'+n+">="+i.lineWidthDims[0]+"&&"+n+"<="+i.lineWidthDims[1],"invalid line width")})),n}));case na:return u((function(t){return ot.commandParameter(t,Ds,s,e.commandStr),Ds[t]}),(function(t,e,n){return ot.optional((function(){t.assert(e,n+'==="cw"||'+n+'==="ccw"',"invalid frontFace, must be one of cw,ccw")})),e.def(n+'==="cw"?'+ys+":"+_s)}));case $o:return u((function(t){return ot.command(In(t)&&4===t.length,"color.mask must be length 4 array",e.commandStr),t.map((function(t){return!!t}))}),(function(t,e,n){return ot.optional((function(){t.assert(e,t.shared.isArrayLike+"("+n+")&&"+n+".length===4","invalid color.mask")})),Pt(4,(function(t){return"!!"+n+"["+t+"]"}))}));case ua:return u((function(t){ot.command("object"===a(t)&&t,s,e.commandStr);var n="value"in t?t.value:1,r=!!t.invert;return ot.command("number"===typeof n&&n>=0&&n<=1,"sample.coverage.value must be a number between 0 and 1",e.commandStr),[n,r]}),(function(t,e,n){ot.optional((function(){t.assert(e,n+"&&typeof "+n+'==="object"',"invalid sample.coverage")}));var r=e.def('"value" in ',n,"?+",n,".value:1"),i=e.def("!!",n,".invert");return[r,i]}))}})),o}function j(t,e){var n=t.static,r=t.dynamic,i={};return Object.keys(n).forEach((function(t){var r,o=n[t];if("number"===typeof o||"boolean"===typeof o)r=Us((function(){return o}));else if("function"===typeof o){var a=o._reglType;"texture2d"===a||"textureCube"===a?r=Us((function(t){return t.link(o)})):"framebuffer"===a||"framebufferCube"===a?(ot.command(o.color.length>0,'missing color attachment for framebuffer sent to uniform "'+t+'"',e.commandStr),r=Us((function(t){return t.link(o.color[0])}))):ot.commandRaise('invalid data for uniform "'+t+'"',e.commandStr)}else In(o)?r=Us((function(e){var n=e.global.def("[",Pt(o.length,(function(n){return ot.command("number"===typeof o[n]||"boolean"===typeof o[n],"invalid uniform "+t,e.commandStr),o[n]})),"]");return n})):ot.commandRaise('invalid or missing data for uniform "'+t+'"',e.commandStr);r.value=o,i[t]=r})),Object.keys(r).forEach((function(t){var e=r[t];i[t]=js(e,(function(t,n){return t.invoke(n,e)}))})),i}function Z(t,n){var r=t.static,i=t.dynamic,s={};return Object.keys(r).forEach((function(t){var i=r[t],u=e.id(t),c=new g;if(Ns(i))c.state=Do,c.buffer=o.getBuffer(o.create(i,za,!1,!0)),c.type=0;else{var l=o.getBuffer(i);if(l)c.state=Do,c.buffer=l,c.type=0;else if(ot.command("object"===a(i)&&i,"invalid data for attribute "+t,n.commandStr),"constant"in i){var h=i.constant;c.buffer="null",c.state=No,"number"===typeof h?c.x=h:(ot.command(In(h)&&h.length>0&&h.length<=4,"invalid constant for attribute "+t,n.commandStr),Lo.forEach((function(t,e){e<h.length&&(c[t]=h[e])})))}else{l=Ns(i.buffer)?o.getBuffer(o.create(i.buffer,za,!1,!0)):o.getBuffer(i.buffer),ot.command(!!l,'missing buffer for attribute "'+t+'"',n.commandStr);var f=0|i.offset;ot.command(f>=0,'invalid offset for attribute "'+t+'"',n.commandStr);var p=0|i.stride;ot.command(p>=0&&p<256,'invalid stride for attribute "'+t+'", must be integer betweeen [0, 255]',n.commandStr);var d=0|i.size;ot.command(!("size"in i)||d>0&&d<=4,'invalid size for attribute "'+t+'", must be 1,2,3,4',n.commandStr);var v=!!i.normalized,m=0;"type"in i&&(ot.commandParameter(i.type,He,"invalid type for attribute "+t,n.commandStr),m=He[i.type]);var y=0|i.divisor;ot.optional((function(){"divisor"in i&&(ot.command(0===y||_,'cannot specify divisor for attribute "'+t+'", instancing not supported',n.commandStr),ot.command(y>=0,'invalid divisor for attribute "'+t+'"',n.commandStr));var e=n.commandStr,r=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(i).forEach((function(n){ot.command(r.indexOf(n)>=0,'unknown parameter "'+n+'" for attribute pointer "'+t+'" (valid parameters are '+r+")",e)}))})),c.buffer=l,c.state=Do,c.size=d,c.normalized=v,c.type=m||l.dtype,c.offset=f,c.stride=p,c.divisor=y}}s[t]=Us((function(t,e){var n=t.attribCache;if(u in n)return n[u];var r={isStream:!1};return Object.keys(c).forEach((function(t){r[t]=c[t]})),c.buffer&&(r.buffer=t.link(c.buffer),r.type=r.type||r.buffer+".dtype"),n[u]=r,r}))})),Object.keys(i).forEach((function(t){var e=i[t];function n(n,r){var i=n.invoke(r,e),o=n.shared,a=n.constants,s=o.isBufferArgs,u=o.buffer;ot.optional((function(){n.assert(r,i+"&&(typeof "+i+'==="object"||typeof '+i+'==="function")&&('+s+"("+i+")||"+u+".getBuffer("+i+")||"+u+".getBuffer("+i+".buffer)||"+s+"("+i+'.buffer)||("constant" in '+i+"&&(typeof "+i+'.constant==="number"||'+o.isArrayLike+"("+i+".constant))))",'invalid dynamic attribute "'+t+'"')}));var c={isStream:r.def(!1)},l=new g;l.state=Do,Object.keys(l).forEach((function(t){c[t]=r.def(""+l[t])}));var h=c.buffer,f=c.type;function p(t){r(c[t],"=",i,".",t,"|0;")}return r("if(",s,"(",i,")){",c.isStream,"=true;",h,"=",u,".createStream(",za,",",i,");",f,"=",h,".dtype;","}else{",h,"=",u,".getBuffer(",i,");","if(",h,"){",f,"=",h,".dtype;",'}else if("constant" in ',i,"){",c.state,"=",No,";","if(typeof "+i+'.constant === "number"){',c[Lo[0]],"=",i,".constant;",Lo.slice(1).map((function(t){return c[t]})).join("="),"=0;","}else{",Lo.map((function(t,e){return c[t]+"="+i+".constant.length>"+e+"?"+i+".constant["+e+"]:0;"})).join(""),"}}else{","if(",s,"(",i,".buffer)){",h,"=",u,".createStream(",za,",",i,".buffer);","}else{",h,"=",u,".getBuffer(",i,".buffer);","}",f,'="type" in ',i,"?",a.glTypes,"[",i,".type]:",h,".dtype;",c.normalized,"=!!",i,".normalized;"),p("size"),p("offset"),p("stride"),p("divisor"),r("}}"),r.exit("if(",c.isStream,"){",u,".destroyStream(",h,");","}"),c}s[t]=js(e,n)})),s}function V(t){var e=t.static,n=t.dynamic,r={};return Object.keys(e).forEach((function(t){var n=e[t];r[t]=Us((function(t,e){return"number"===typeof n||"boolean"===typeof n?""+n:t.link(n)}))})),Object.keys(n).forEach((function(t){var e=n[t];r[t]=js(e,(function(t,n){return t.invoke(n,e)}))})),r}function G(t,e,n,i,o){var a=t.static,s=t.dynamic;ot.optional((function(){var t=[ya,_a,xa,ba,wa,Sa,Ea,Aa,ga,Ta].concat(S);function e(e){Object.keys(e).forEach((function(e){ot.command(t.indexOf(e)>=0,'unknown parameter "'+e+'"',o.commandStr)}))}e(a),e(s)}));var u=z(t,e),c=D(t,o),l=N(t,c,o),f=B(t,o),p=U(t,o),d=F(t,o,u);function v(t){var e=l[t];e&&(p[t]=e)}v(ma),v(C(va));var m=Object.keys(p).length>0,g={framebuffer:c,draw:f,shader:d,state:p,dirty:m,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(g.profile=O(t,o),g.uniforms=j(n,o),g.drawVAO=g.scopeVAO=f.vao,!g.drawVAO&&d.program&&!u&&r.angle_instanced_arrays&&f.static.elements){var y=!0,_=d.program.attributes.map((function(t){var n=e.static[t];return y=y&&!!n,n}));if(y&&_.length>0){var x=h.getVAO(h.createVAO({attributes:_,elements:f.static.elements}));g.drawVAO=new Fs(null,null,null,(function(t,e){return t.link(x)})),g.useVAO=!0}}return u?g.useVAO=!0:g.attributes=Z(e,o),g.context=V(i,o),g}function H(t,e,n){var r=t.shared,i=r.context,o=t.scope();Object.keys(n).forEach((function(r){e.save(i,"."+r);var a=n[r],s=a.append(t,e);Array.isArray(s)?o(i,".",r,"=[",s.join(),"];"):o(i,".",r,"=",s,";")})),e(o)}function W(t,e,n,r){var i,o=t.shared,a=o.gl,s=o.framebuffer;x&&(i=e.def(o.extensions,".webgl_draw_buffers"));var u,c=t.constants,l=c.drawBuffer,h=c.backBuffer;u=n?n.append(t,e):e.def(s,".next"),r||e("if(",u,"!==",s,".cur){"),e("if(",u,"){",a,".bindFramebuffer(",ks,",",u,".framebuffer);"),x&&e(i,".drawBuffersWEBGL(",l,"[",u,".colorAttachments.length]);"),e("}else{",a,".bindFramebuffer(",ks,",null);"),x&&e(i,".drawBuffersWEBGL(",h,");"),e("}",s,".cur=",u,";"),r||e("}")}function q(t,e,n){var r=t.shared,i=r.gl,o=t.current,a=t.next,s=r.current,u=r.next,c=t.cond(s,".dirty");S.forEach((function(e){var r,l,h=C(e);if(!(h in n.state))if(h in a){r=a[h],l=o[h];var f=Pt(w[h].length,(function(t){return c.def(r,"[",t,"]")}));c(t.cond(f.map((function(t,e){return t+"!=="+l+"["+e+"]"})).join("||")).then(i,".",T[h],"(",f,");",f.map((function(t,e){return l+"["+e+"]="+t})).join(";"),";"))}else{r=c.def(u,".",h);var p=t.cond(r,"!==",s,".",h);c(p),h in A?p(t.cond(r).then(i,".enable(",A[h],");").else(i,".disable(",A[h],");"),s,".",h,"=",r,";"):p(i,".",T[h],"(",r,");",s,".",h,"=",r,";")}})),0===Object.keys(n.state).length&&c(s,".dirty=false;"),e(c)}function X(t,e,n,r){var i=t.shared,o=t.current,a=i.current,s=i.gl;zs(Object.keys(n)).forEach((function(i){var u=n[i];if(!r||r(u)){var c=u.append(t,e);if(A[i]){var l=A[i];Bs(u)?e(s,c?".enable(":".disable(",l,");"):e(t.cond(c).then(s,".enable(",l,");").else(s,".disable(",l,");")),e(a,".",i,"=",c,";")}else if(In(c)){var h=o[i];e(s,".",T[i],"(",c,");",c.map((function(t,e){return h+"["+e+"]="+t})).join(";"),";")}else e(s,".",T[i],"(",c,");",a,".",i,"=",c,";")}}))}function Y(t,e){_&&(t.instancing=e.def(t.shared.extensions,".angle_instanced_arrays"))}function K(t,e,n,r,i){var o,a,s,u=t.shared,c=t.stats,l=u.current,h=u.timer,f=n.profile;function p(){var t="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;return t||"undefined"===typeof performance?"Date.now()":"performance.now()"}function d(t){o=e.def(),t(o,"=",p(),";"),"string"===typeof i?t(c,".count+=",i,";"):t(c,".count++;"),v&&(r?(a=e.def(),t(a,"=",h,".getNumPendingQueries();")):t(h,".beginQuery(",c,");"))}function m(t){t(c,".cpuTime+=",p(),"-",o,";"),v&&(r?t(h,".pushScopeStats(",a,",",h,".getNumPendingQueries(),",c,");"):t(h,".endQuery();"))}function g(t){var n=e.def(l,".profile");e(l,".profile=",t,";"),e.exit(l,".profile=",n,";")}if(f){if(Bs(f))return void(f.enable?(d(e),m(e.exit),g("true")):g("false"));s=f.append(t,e),g(s)}else s=e.def(l,".profile");var y=t.block();d(y),e("if(",s,"){",y,"}");var _=t.block();m(_),e.exit("if(",s,"){",_,"}")}function Q(t,e,n,r,i){var o=t.shared;function a(t){switch(t){case $a:case rs:case ss:return 2;case ts:case is:case us:return 3;case es:case os:case cs:return 4;default:return 1}}function s(n,r,i){var a=o.gl,s=e.def(n,".location"),u=e.def(o.attributes,"[",s,"]"),c=i.state,l=i.buffer,h=[i.x,i.y,i.z,i.w],f=["buffer","normalized","offset","stride"];function p(){e("if(!",u,".buffer){",a,".enableVertexAttribArray(",s,");}");var n,o=i.type;if(n=i.size?e.def(i.size,"||",r):r,e("if(",u,".type!==",o,"||",u,".size!==",n,"||",f.map((function(t){return u+"."+t+"!=="+i[t]})).join("||"),"){",a,".bindBuffer(",za,",",l,".buffer);",a,".vertexAttribPointer(",[s,n,o,i.normalized,i.stride,i.offset],");",u,".type=",o,";",u,".size=",n,";",f.map((function(t){return u+"."+t+"="+i[t]+";"})).join(""),"}"),_){var c=i.divisor;e("if(",u,".divisor!==",c,"){",t.instancing,".vertexAttribDivisorANGLE(",[s,c],");",u,".divisor=",c,";}")}}function d(){e("if(",u,".buffer){",a,".disableVertexAttribArray(",s,");",u,".buffer=null;","}if(",Lo.map((function(t,e){return u+"."+t+"!=="+h[e]})).join("||"),"){",a,".vertexAttrib4f(",s,",",h,");",Lo.map((function(t,e){return u+"."+t+"="+h[e]+";"})).join(""),"}")}c===Do?p():c===No?d():(e("if(",c,"===",Do,"){"),p(),e("}else{"),d(),e("}"))}r.forEach((function(r){var o,u=r.name,c=n.attributes[u];if(c){if(!i(c))return;o=c.append(t,e)}else{if(!i(Zs))return;var l=t.scopeAttrib(u);ot.optional((function(){t.assert(e,l+".state","missing attribute "+u)})),o={},Object.keys(new g).forEach((function(t){o[t]=e.def(l,".",t)}))}s(t.link(r),a(r.info.type),o)}))}function J(t,n,r,i,o,a){for(var s,u=t.shared,c=u.gl,l=0;l<i.length;++l){var h,f=i[l],p=f.name,d=f.info.type,v=r.uniforms[p],m=t.link(f),g=m+".location";if(v){if(!o(v))continue;if(Bs(v)){var y=v.value;if(ot.command(null!==y&&"undefined"!==typeof y,'missing uniform "'+p+'"',t.commandStr),d===ps||d===ds){ot.command("function"===typeof y&&(d===ps&&("texture2d"===y._reglType||"framebuffer"===y._reglType)||d===ds&&("textureCube"===y._reglType||"framebufferCube"===y._reglType)),"invalid texture for uniform "+p,t.commandStr);var _=t.link(y._texture||y.color[0]._texture);n(c,".uniform1i(",g,",",_+".bind());"),n.exit(_,".unbind();")}else if(d===ls||d===hs||d===fs){ot.optional((function(){ot.command(In(y),"invalid matrix for uniform "+p,t.commandStr),ot.command(d===ls&&4===y.length||d===hs&&9===y.length||d===fs&&16===y.length,"invalid length for matrix uniform "+p,t.commandStr)}));var x=t.global.def("new Float32Array(["+Array.prototype.slice.call(y)+"])"),b=2;d===hs?b=3:d===fs&&(b=4),n(c,".uniformMatrix",b,"fv(",g,",false,",x,");")}else{switch(d){case Ja:ot.commandType(y,"number","uniform "+p,t.commandStr),s="1f";break;case $a:ot.command(In(y)&&2===y.length,"uniform "+p,t.commandStr),s="2f";break;case ts:ot.command(In(y)&&3===y.length,"uniform "+p,t.commandStr),s="3f";break;case es:ot.command(In(y)&&4===y.length,"uniform "+p,t.commandStr),s="4f";break;case as:ot.commandType(y,"boolean","uniform "+p,t.commandStr),s="1i";break;case ns:ot.commandType(y,"number","uniform "+p,t.commandStr),s="1i";break;case ss:ot.command(In(y)&&2===y.length,"uniform "+p,t.commandStr),s="2i";break;case rs:ot.command(In(y)&&2===y.length,"uniform "+p,t.commandStr),s="2i";break;case us:ot.command(In(y)&&3===y.length,"uniform "+p,t.commandStr),s="3i";break;case is:ot.command(In(y)&&3===y.length,"uniform "+p,t.commandStr),s="3i";break;case cs:ot.command(In(y)&&4===y.length,"uniform "+p,t.commandStr),s="4i";break;case os:ot.command(In(y)&&4===y.length,"uniform "+p,t.commandStr),s="4i";break}n(c,".uniform",s,"(",g,",",In(y)?Array.prototype.slice.call(y):y,");")}continue}h=v.append(t,n)}else{if(!o(Zs))continue;h=n.def(u.uniforms,"[",e.id(p),"]")}d===ps?(ot(!Array.isArray(h),"must specify a scalar prop for textures"),n("if(",h,"&&",h,'._reglType==="framebuffer"){',h,"=",h,".color[0];","}")):d===ds&&(ot(!Array.isArray(h),"must specify a scalar prop for cube maps"),n("if(",h,"&&",h,'._reglType==="framebufferCube"){',h,"=",h,".color[0];","}")),ot.optional((function(){function e(e,r){t.assert(n,e,'bad data or missing for uniform "'+p+'".  '+r)}function r(t){ot(!Array.isArray(h),"must not specify an array type for uniform"),e("typeof "+h+'==="'+t+'"',"invalid type, expected "+t)}function i(n,r){Array.isArray(h)?ot(h.length===n,"must have length "+n):e(u.isArrayLike+"("+h+")&&"+h+".length==="+n,"invalid vector, should have length "+n,t.commandStr)}function o(n){ot(!Array.isArray(h),"must not specify a value type"),e("typeof "+h+'==="function"&&'+h+'._reglType==="texture'+(n===ja?"2d":"Cube")+'"',"invalid texture type",t.commandStr)}switch(d){case ns:r("number");break;case rs:i(2,"number");break;case is:i(3,"number");break;case os:i(4,"number");break;case Ja:r("number");break;case $a:i(2,"number");break;case ts:i(3,"number");break;case es:i(4,"number");break;case as:r("boolean");break;case ss:i(2,"boolean");break;case us:i(3,"boolean");break;case cs:i(4,"boolean");break;case ls:i(4,"number");break;case hs:i(9,"number");break;case fs:i(16,"number");break;case ps:o(ja);break;case ds:o(Za);break}}));var w=1;switch(d){case ps:case ds:var E=n.def(h,"._texture");n(c,".uniform1i(",g,",",E,".bind());"),n.exit(E,".unbind();");continue;case ns:case as:s="1i";break;case rs:case ss:s="2i",w=2;break;case is:case us:s="3i",w=3;break;case os:case cs:s="4i",w=4;break;case Ja:s="1f";break;case $a:s="2f",w=2;break;case ts:s="3f",w=3;break;case es:s="4f",w=4;break;case ls:s="Matrix2fv";break;case hs:s="Matrix3fv";break;case fs:s="Matrix4fv";break}if("M"===s.charAt(0)){n(c,".uniform",s,"(",g,",");var S=Math.pow(d-ls+2,2),A=t.global.def("new Float32Array(",S,")");Array.isArray(h)?n("false,(",Pt(S,(function(t){return A+"["+t+"]="+h[t]})),",",A,")"):n("false,(Array.isArray(",h,")||",h," instanceof Float32Array)?",h,":(",Pt(S,(function(t){return A+"["+t+"]="+h+"["+t+"]"})),",",A,")"),n(");")}else if(w>1){for(var T=[],C=[],k=0;k<w;++k)Array.isArray(h)?C.push(h[k]):C.push(n.def(h+"["+k+"]")),a&&T.push(n.def());a&&n("if(!",t.batchId,"||",T.map((function(t,e){return t+"!=="+C[e]})).join("||"),"){",T.map((function(t,e){return t+"="+C[e]+";"})).join("")),n(c,".uniform",s,"(",g,",",C.join(","),");"),a&&n("}")}else{if(ot(!Array.isArray(h),"uniform value must not be an array"),a){var M=n.def();n("if(!",t.batchId,"||",M,"!==",h,"){",M,"=",h,";")}n(c,".uniform",s,"(",g,",",h,");"),a&&n("}")}}}function $(t,e,n,r){var i=t.shared,o=i.gl,a=i.draw,s=r.draw;function u(){var u,c=s.elements,l=e;return c?((c.contextDep&&r.contextDynamic||c.propDep)&&(l=n),u=c.append(t,l),s.elementsActive&&l("if("+u+")"+o+".bindBuffer("+Fa+","+u+".buffer.buffer);")):(u=l.def(),l(u,"=",a,".",ba,";","if(",u,"){",o,".bindBuffer(",Fa,",",u,".buffer.buffer);}","else if(",i.vao,".currentVAO){",u,"=",t.shared.elements+".getElements("+i.vao,".currentVAO.elements);",b?"":"if("+u+")"+o+".bindBuffer("+Fa+","+u+".buffer.buffer);","}")),u}function c(){var i,o=s.count,u=e;return o?((o.contextDep&&r.contextDynamic||o.propDep)&&(u=n),i=o.append(t,u),ot.optional((function(){o.MISSING&&t.assert(e,"false","missing vertex count"),o.DYNAMIC&&t.assert(u,i+">=0","missing vertex count")}))):(i=u.def(a,".",Ea),ot.optional((function(){t.assert(u,i+">=0","missing vertex count")}))),i}var l=u();function h(i){var o=s[i];return o?o.contextDep&&r.contextDynamic||o.propDep?o.append(t,n):o.append(t,e):e.def(a,".",i)}var f,p,d=h(wa),v=h(Sa),m=c();if("number"===typeof m){if(0===m)return}else n("if(",m,"){"),n.exit("}");_&&(f=h(Aa),p=t.instancing);var g=l+".type",y=s.elements&&Bs(s.elements)&&!s.vaoActive;function x(){function t(){n(p,".drawElementsInstancedANGLE(",[d,m,g,v+"<<(("+g+"-"+Oo+")>>1)",f],");")}function e(){n(p,".drawArraysInstancedANGLE(",[d,v,m,f],");")}l&&"null"!==l?y?t():(n("if(",l,"){"),t(),n("}else{"),e(),n("}")):e()}function w(){function t(){n(o+".drawElements("+[d,m,g,v+"<<(("+g+"-"+Oo+")>>1)"]+");")}function e(){n(o+".drawArrays("+[d,v,m]+");")}l&&"null"!==l?y?t():(n("if(",l,"){"),t(),n("}else{"),e(),n("}")):e()}_&&("number"!==typeof f||f>=0)?"string"===typeof f?(n("if(",f,">0){"),x(),n("}else if(",f,"<0){"),w(),n("}")):x():w()}function tt(t,e,n,r,i){var o=L(),a=o.proc("body",i);return ot.optional((function(){o.commandStr=e.commandStr,o.command=o.link(e.commandStr)})),_&&(o.instancing=a.def(o.shared.extensions,".angle_instanced_arrays")),t(o,a,n,r),o.compile().body}function et(t,e,n,r){Y(t,e),n.useVAO?n.drawVAO?e(t.shared.vao,".setVAO(",n.drawVAO.append(t,e),");"):e(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(e(t.shared.vao,".setVAO(null);"),Q(t,e,n,r.attributes,(function(){return!0}))),J(t,e,n,r.uniforms,(function(){return!0}),!1),$(t,e,e,n)}function nt(t,e){var n=t.proc("draw",1);Y(t,n),H(t,n,e.context),W(t,n,e.framebuffer),q(t,n,e),X(t,n,e.state),K(t,n,e,!1,!0);var r=e.shader.progVar.append(t,n);if(n(t.shared.gl,".useProgram(",r,".program);"),e.shader.program)et(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var i=t.global.def("{}"),o=n.def(r,".id"),a=n.def(i,"[",o,"]");n(t.cond(a).then(a,".call(this,a0);").else(a,"=",i,"[",o,"]=",t.link((function(n){return tt(et,t,e,n,1)})),"(",r,");",a,".call(this,a0);"))}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function rt(t,e,n,r){function i(){return!0}t.batchId="a1",Y(t,e),Q(t,e,n,r.attributes,i),J(t,e,n,r.uniforms,i,!1),$(t,e,e,n)}function it(t,e,n,r){Y(t,e);var i=n.contextDep,o=e.def(),a="a0",s="a1",u=e.def();t.shared.props=u,t.batchId=o;var c=t.scope(),l=t.scope();function h(t){return t.contextDep&&i||t.propDep}function f(t){return!h(t)}if(e(c.entry,"for(",o,"=0;",o,"<",s,";++",o,"){",u,"=",a,"[",o,"];",l,"}",c.exit),n.needsContext&&H(t,l,n.context),n.needsFramebuffer&&W(t,l,n.framebuffer),X(t,l,n.state,h),n.profile&&h(n.profile)&&K(t,l,n,!1,!0),r)n.useVAO?n.drawVAO?h(n.drawVAO)?l(t.shared.vao,".setVAO(",n.drawVAO.append(t,l),");"):c(t.shared.vao,".setVAO(",n.drawVAO.append(t,c),");"):c(t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"):(c(t.shared.vao,".setVAO(null);"),Q(t,c,n,r.attributes,f),Q(t,l,n,r.attributes,h)),J(t,c,n,r.uniforms,f,!1),J(t,l,n,r.uniforms,h,!0),$(t,c,l,n);else{var p=t.global.def("{}"),d=n.shader.progVar.append(t,l),v=l.def(d,".id"),m=l.def(p,"[",v,"]");l(t.shared.gl,".useProgram(",d,".program);","if(!",m,"){",m,"=",p,"[",v,"]=",t.link((function(e){return tt(rt,t,n,e,2)})),"(",d,");}",m,".call(this,a0[",o,"],",o,");")}}function at(t,e){var n=t.proc("batch",2);t.batchId="0",Y(t,n);var r=!1,i=!0;Object.keys(e.context).forEach((function(t){r=r||e.context[t].propDep})),r||(H(t,n,e.context),i=!1);var o=e.framebuffer,a=!1;function s(t){return t.contextDep&&r||t.propDep}o?(o.propDep?r=a=!0:o.contextDep&&r&&(a=!0),a||W(t,n,o)):W(t,n,null),e.state.viewport&&e.state.viewport.propDep&&(r=!0),q(t,n,e),X(t,n,e.state,(function(t){return!s(t)})),e.profile&&s(e.profile)||K(t,n,e,!1,"a1"),e.contextDep=r,e.needsContext=i,e.needsFramebuffer=a;var u=e.shader.progVar;if(u.contextDep&&r||u.propDep)it(t,n,e,null);else{var c=u.append(t,n);if(n(t.shared.gl,".useProgram(",c,".program);"),e.shader.program)it(t,n,e,e.shader.program);else{n(t.shared.vao,".setVAO(null);");var l=t.global.def("{}"),h=n.def(c,".id"),f=n.def(l,"[",h,"]");n(t.cond(f).then(f,".call(this,a0,a1);").else(f,"=",l,"[",h,"]=",t.link((function(n){return tt(it,t,e,n,2)})),"(",c,");",f,".call(this,a0,a1);"))}}Object.keys(e.state).length>0&&n(t.shared.current,".dirty=true;"),t.shared.vao&&n(t.shared.vao,".setVAO(null);")}function st(t,n){var r=t.proc("scope",3);t.batchId="a2";var i=t.shared,o=i.current;function a(e){var o=n.shader[e];o&&r.set(i.shader,"."+e,o.append(t,r))}H(t,r,n.context),n.framebuffer&&n.framebuffer.append(t,r),zs(Object.keys(n.state)).forEach((function(e){var o=n.state[e],a=o.append(t,r);In(a)?a.forEach((function(n,i){r.set(t.next[e],"["+i+"]",n)})):r.set(i.next,"."+e,a)})),K(t,r,n,!0,!0),[ba,Sa,Ea,Aa,wa].forEach((function(e){var o=n.draw[e];o&&r.set(i.draw,"."+e,""+o.append(t,r))})),Object.keys(n.uniforms).forEach((function(o){var a=n.uniforms[o].append(t,r);Array.isArray(a)&&(a="["+a.join()+"]"),r.set(i.uniforms,"["+e.id(o)+"]",a)})),Object.keys(n.attributes).forEach((function(e){var i=n.attributes[e].append(t,r),o=t.scopeAttrib(e);Object.keys(new g).forEach((function(t){r.set(o,"."+t,i[t])}))})),n.scopeVAO&&r.set(i.vao,".targetVAO",n.scopeVAO.append(t,r)),a(_a),a(xa),Object.keys(n.state).length>0&&(r(o,".dirty=true;"),r.exit(o,".dirty=true;")),r("a1(",t.shared.context,",a0,",t.batchId,");")}function ut(t){if("object"===a(t)&&!In(t)){for(var e=Object.keys(t),n=0;n<e.length;++n)if(gt.isDynamic(t[e[n]]))return!0;return!1}}function ct(t,e,n){var r=e.static[n];if(r&&ut(r)){var i=t.global,o=Object.keys(r),s=!1,u=!1,c=!1,l=t.global.def("{}");o.forEach((function(e){var n=r[e];if(gt.isDynamic(n)){"function"===typeof n&&(n=r[e]=gt.unbox(n));var o=js(n,null);s=s||o.thisDep,c=c||o.propDep,u=u||o.contextDep}else{switch(i(l,".",e,"="),a(n)){case"number":i(n);break;case"string":i('"',n,'"');break;case"object":Array.isArray(n)&&i("[",n.join(),"]");break;default:i(t.link(n));break}i(";")}})),e.dynamic[n]=new gt.DynamicVariable(jo,{thisDep:s,contextDep:u,propDep:c,ref:l,append:h}),delete e.static[n]}function h(t,e){o.forEach((function(n){var i=r[n];if(gt.isDynamic(i)){var o=t.invoke(e,i);e(l,".",n,"=",o,";")}}))}}function lt(t,e,r,i,o){var a=L();a.stats=a.link(o),Object.keys(e.static).forEach((function(t){ct(a,e,t)})),Na.forEach((function(e){ct(a,t,e)}));var s=G(t,e,r,i,a);return nt(a,s),st(a,s),at(a,s),n(a.compile(),{destroy:function(){s.shader.program.destroy()}})}return{next:E,current:w,procs:function(){var t=L(),e=t.proc("poll"),n=t.proc("refresh"),o=t.block();e(o),n(o);var a,s=t.shared,u=s.gl,c=s.next,l=s.current;o(l,".dirty=false;"),W(t,e),W(t,n,null,!0),_&&(a=t.link(_)),r.oes_vertex_array_object&&n(t.link(r.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var h=0;h<i.maxAttributes;++h){var f=n.def(s.attributes,"[",h,"]"),p=t.cond(f,".buffer");p.then(u,".enableVertexAttribArray(",h,");",u,".bindBuffer(",za,",",f,".buffer.buffer);",u,".vertexAttribPointer(",h,",",f,".size,",f,".type,",f,".normalized,",f,".stride,",f,".offset);").else(u,".disableVertexAttribArray(",h,");",u,".vertexAttrib4f(",h,",",f,".x,",f,".y,",f,".z,",f,".w);",f,".buffer=null;"),n(p),_&&n(a,".vertexAttribDivisorANGLE(",h,",",f,".divisor);")}return n(t.shared.vao,".currentVAO=null;",t.shared.vao,".setVAO(",t.shared.vao,".targetVAO);"),Object.keys(A).forEach((function(r){var i=A[r],a=o.def(c,".",r),s=t.block();s("if(",a,"){",u,".enable(",i,")}else{",u,".disable(",i,")}",l,".",r,"=",a,";"),n(s),e("if(",a,"!==",l,".",r,"){",s,"}")})),Object.keys(T).forEach((function(r){var i,a,s=T[r],h=w[r],f=t.block();if(f(u,".",s,"("),In(h)){var p=h.length;i=t.global.def(c,".",r),a=t.global.def(l,".",r),f(Pt(p,(function(t){return i+"["+t+"]"})),");",Pt(p,(function(t){return a+"["+t+"]="+i+"["+t+"];"})).join("")),e("if(",Pt(p,(function(t){return i+"["+t+"]!=="+a+"["+t+"]"})).join("||"),"){",f,"}")}else i=o.def(c,".",r),a=o.def(l,".",r),f(i,");",l,".",r,"=",i,";"),e("if(",i,"!==",a,"){",f,"}");n(f)})),t.compile()}(),compile:lt}}function Gs(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Hs=34918,Ws=34919,qs=35007,Xs=function(t,e){if(!e.ext_disjoint_timer_query)return null;var n=[];function r(){return n.pop()||e.ext_disjoint_timer_query.createQueryEXT()}function i(t){n.push(t)}var o=[];function a(t){var n=r();e.ext_disjoint_timer_query.beginQueryEXT(qs,n),o.push(n),p(o.length-1,o.length,t)}function s(){e.ext_disjoint_timer_query.endQueryEXT(qs)}function u(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var c=[];function l(){return c.pop()||new u}function h(t){c.push(t)}var f=[];function p(t,e,n){var r=l();r.startQueryIndex=t,r.endQueryIndex=e,r.sum=0,r.stats=n,f.push(r)}var d=[],v=[];function m(){var t,n,r=o.length;if(0!==r){v.length=Math.max(v.length,r+1),d.length=Math.max(d.length,r+1),d[0]=0,v[0]=0;var a=0;for(t=0,n=0;n<o.length;++n){var s=o[n];e.ext_disjoint_timer_query.getQueryObjectEXT(s,Ws)?(a+=e.ext_disjoint_timer_query.getQueryObjectEXT(s,Hs),i(s)):o[t++]=s,d[n+1]=a,v[n+1]=t}for(o.length=t,t=0,n=0;n<f.length;++n){var u=f[n],c=u.startQueryIndex,l=u.endQueryIndex;u.sum+=d[l]-d[c];var p=v[c],m=v[l];m===p?(u.stats.gpuTime+=u.sum/1e6,h(u)):(u.startQueryIndex=p,u.endQueryIndex=m,f[t++]=u)}f.length=t}}return{beginQuery:a,endQuery:s,pushScopeStats:p,update:m,getNumPendingQueries:function(){return o.length},clear:function(){n.push.apply(n,o);for(var t=0;t<n.length;t++)e.ext_disjoint_timer_query.deleteQueryEXT(n[t]);o.length=0,n.length=0},restore:function(){o.length=0,n.length=0}}},Ys=16384,Ks=256,Qs=1024,Js=34962,$s="webglcontextlost",tu="webglcontextrestored",eu=1,nu=2,ru=3;function iu(t,e){for(var n=0;n<t.length;++n)if(t[n]===e)return n;return-1}function ou(t){var e=kt(t);if(!e)return null;var r=e.gl,i=r.getContextAttributes(),o=r.isContextLost(),s=Mt(r,e);if(!s)return null;var u=bt(),c=Gs(),l=s.extensions,h=Xs(r,l),f=xt(),p=r.drawingBufferWidth,d=r.drawingBufferHeight,v={tick:0,time:0,viewportWidth:p,viewportHeight:d,framebufferWidth:p,framebufferHeight:d,drawingBufferWidth:p,drawingBufferHeight:d,pixelRatio:e.pixelRatio},m={},g={elements:null,primitive:4,count:-1,offset:0,instances:-1},y=Te(r,l),_=an(r,c,e,w),x=Tn(r,l,_,c),b=_o(r,l,y,c,_,x,g);function w(t){return b.destroyBuffer(t)}var E=So(r,u,c,e),S=gi(r,l,y,(function(){C.procs.poll()}),v,c,e),A=Ii(r,l,y,c,e),T=fo(r,l,y,S,A,c),C=Vs(r,u,l,y,_,x,S,T,m,b,E,g,v,h,e),k=Mo(r,T,C.procs.poll,v,i,l,y),M=C.next,P=r.canvas,I=[],R=[],L=[],O=[e.onDestroy],D=null;function N(){if(0===I.length)return h&&h.update(),void(D=null);D=yt.next(N),Y();for(var t=I.length-1;t>=0;--t){var e=I[t];e&&e(v,null,0)}r.flush(),h&&h.update()}function z(){!D&&I.length>0&&(D=yt.next(N))}function F(){D&&(yt.cancel(N),D=null)}function B(t){t.preventDefault(),o=!0,F(),R.forEach((function(t){t()}))}function U(t){r.getError(),o=!1,s.restore(),E.restore(),_.restore(),S.restore(),A.restore(),T.restore(),b.restore(),h&&h.restore(),C.procs.refresh(),z(),L.forEach((function(t){t()}))}var j="undefined"!==typeof my&&!!my&&"function"===typeof my.showToast&&!0!==my.isFRM;function Z(){I.length=0,F(),!j&&P&&(P.removeEventListener($s,B),P.removeEventListener(tu,U)),E.clear(),T.clear(),A.clear(),b.clear(),S.clear(),x.clear(),_.clear(),h&&h.clear(),O.forEach((function(t){t()}))}function V(t){function e(t){var e=n({},t);function r(t){if(t in e){var n=e[t];delete e[t],Object.keys(n).forEach((function(r){e[t+"."+r]=n[r]}))}}return delete e.uniforms,delete e.attributes,delete e.context,delete e.vao,"stencil"in e&&e.stencil.op&&(e.stencil.opBack=e.stencil.opFront=e.stencil.op,delete e.stencil.op),r("blend"),r("depth"),r("cull"),r("stencil"),r("polygonOffset"),r("scissor"),r("sample"),"vao"in t&&(e.vao=t.vao),e}function r(t,e){var n={},r={};return Object.keys(t).forEach((function(i){var o=t[i];if(gt.isDynamic(o))r[i]=gt.unbox(o,i);else{if(e&&Array.isArray(o))for(var a=0;a<o.length;++a)if(gt.isDynamic(o[a]))return void(r[i]=gt.unbox(o,i));n[i]=o}})),{dynamic:r,static:n}}ot(!!t,"invalid args to regl({...})"),ot.type(t,"object","invalid args to regl({...})");var i=r(t.context||{},!0),a=r(t.uniforms||{},!0),s=r(t.attributes||{},!1),u=r(e(t),!1),c={gpuTime:0,cpuTime:0,count:0},l=C.compile(u,s,a,i,c),h=l.draw,f=l.batch,p=l.scope,d=[];function v(t){while(d.length<t)d.push(null);return d}function m(t,e){var n;if(o&&ot.raise("context lost"),"function"===typeof t)return p.call(this,null,t,0);if("function"===typeof e)if("number"===typeof t)for(n=0;n<t;++n)p.call(this,null,e,n);else{if(!Array.isArray(t))return p.call(this,t,e,0);for(n=0;n<t.length;++n)p.call(this,t[n],e,n)}else if("number"===typeof t){if(t>0)return f.call(this,v(0|t),0|t)}else{if(!Array.isArray(t))return h.call(this,t);if(t.length)return f.call(this,t,t.length)}}return n(m,{stats:c,destroy:function(){l.destroy()}})}!j&&P&&(P.addEventListener($s,B,!1),P.addEventListener(tu,U,!1));var G=T.setFBO=V({framebuffer:gt.define.call(null,eu,"framebuffer")});function H(t,e){var n=0;C.procs.poll();var i=e.color;i&&(r.clearColor(+i[0]||0,+i[1]||0,+i[2]||0,+i[3]||0),n|=Ys),"depth"in e&&(r.clearDepth(+e.depth),n|=Ks),"stencil"in e&&(r.clearStencil(0|e.stencil),n|=Qs),ot(!!n,"called regl.clear with no buffer specified"),r.clear(n)}function W(t){if(ot("object"===a(t)&&t,"regl.clear() takes an object as input"),"framebuffer"in t)if(t.framebuffer&&"framebufferCube"===t.framebuffer_reglType)for(var e=0;e<6;++e)G(n({framebuffer:t.framebuffer.faces[e]},t),H);else G(t,H);else H(null,t)}function q(t){function e(){var e=iu(I,t);function n(){var t=iu(I,n);I[t]=I[I.length-1],I.length-=1,I.length<=0&&F()}ot(e>=0,"cannot cancel a frame twice"),I[e]=n}return ot.type(t,"function","regl.frame() callback must be a function"),I.push(t),z(),{cancel:e}}function X(){var t=M.viewport,e=M.scissor_box;t[0]=t[1]=e[0]=e[1]=0,v.viewportWidth=v.framebufferWidth=v.drawingBufferWidth=t[2]=e[2]=r.drawingBufferWidth,v.viewportHeight=v.framebufferHeight=v.drawingBufferHeight=t[3]=e[3]=r.drawingBufferHeight}function Y(){v.tick+=1,v.time=Q(),X(),C.procs.poll()}function K(){S.refresh(),X(),C.procs.refresh(),h&&h.update()}function Q(){return(xt()-f)/1e3}function J(t,e){var n;switch(ot.type(e,"function","listener callback must be a function"),t){case"frame":return q(e);case"lost":n=R;break;case"restore":n=L;break;case"destroy":n=O;break;default:ot.raise("invalid event, must be one of frame,lost,restore,destroy")}return n.push(e),{cancel:function(){for(var t=0;t<n.length;++t)if(n[t]===e)return n[t]=n[n.length-1],void n.pop()}}}K();var $=n(V,{clear:W,prop:gt.define.bind(null,eu),context:gt.define.bind(null,nu),this:gt.define.bind(null,ru),draw:V({}),buffer:function(t){return _.create(t,Js,!1,!1)},elements:function(t){return x.create(t,!1)},texture:S.create2D,cube:S.createCube,renderbuffer:A.create,framebuffer:T.create,framebufferCube:T.createCube,vao:b.createVAO,attributes:i,frame:q,on:J,limits:y,hasExtension:function(t){return y.extensions.indexOf(t.toLowerCase())>=0},read:k,destroy:Z,_gl:r,_refresh:K,poll:function(){Y(),h&&h.update()},now:Q,stats:c});return e.onDone(null,$),$}return ou}))},76697:function(t,e,n){var r=n(67567),i=n(23377),o=n(9443),a=n(16568),s=n(96467);function u(t){var e=-1,n=null==t?0:t.length;this.clear();while(++e<n){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype["delete"]=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},85657:function(t,e,n){var r=n(42981),i=n(21023),o=n(95119),a=n(85314),s=n(19202);function u(t){var e=-1,n=null==t?0:t.length;this.clear();while(++e<n){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype["delete"]=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},45670:function(t,e,n){var r=n(53244),i=n(80195),o=r(i,"Map");t.exports=o},41636:function(t,e,n){var r=n(62208),i=n(28923),o=n(14581),a=n(86024),s=n(40732);function u(t){var e=-1,n=null==t?0:t.length;this.clear();while(++e<n){var r=t[e];this.set(r[0],r[1])}}u.prototype.clear=r,u.prototype["delete"]=i,u.prototype.get=o,u.prototype.has=a,u.prototype.set=s,t.exports=u},13792:function(t,e,n){var r=n(85657),i=n(89614),o=n(46841),a=n(92235),s=n(87064),u=n(63559);function c(t){var e=this.__data__=new r(t);this.size=e.size}c.prototype.clear=i,c.prototype["delete"]=o,c.prototype.get=a,c.prototype.has=s,c.prototype.set=u,t.exports=c},25841:function(t,e,n){var r=n(80195),i=r.Symbol;t.exports=i},8865:function(t,e,n){var r=n(80195),i=r.Uint8Array;t.exports=i},89159:function(t){function e(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}t.exports=e},89335:function(t,e,n){n(57658);var r=n(79779),i=n(79275),o=n(5569),a=n(49410),s=n(92041),u=n(75540),c=Object.prototype,l=c.hasOwnProperty;function h(t,e){var n=o(t),c=!n&&i(t),h=!n&&!c&&a(t),f=!n&&!c&&!h&&u(t),p=n||c||h||f,d=p?r(t.length,String):[],v=d.length;for(var m in t)!e&&!l.call(t,m)||p&&("length"==m||h&&("offset"==m||"parent"==m)||f&&("buffer"==m||"byteLength"==m||"byteOffset"==m)||s(m,v))||d.push(m);return d}t.exports=h},34591:function(t,e,n){var r=n(68900),i=n(60710);function o(t,e,n){(void 0!==n&&!i(t[e],n)||void 0===n&&!(e in t))&&r(t,e,n)}t.exports=o},59817:function(t,e,n){var r=n(68900),i=n(60710),o=Object.prototype,a=o.hasOwnProperty;function s(t,e,n){var o=t[e];a.call(t,e)&&i(o,n)&&(void 0!==n||e in t)||r(t,e,n)}t.exports=s},2107:function(t,e,n){var r=n(60710);function i(t,e){var n=t.length;while(n--)if(r(t[n][0],e))return n;return-1}t.exports=i},68900:function(t,e,n){var r=n(78760);function i(t,e,n){"__proto__"==e&&r?r(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}t.exports=i},28507:function(t,e,n){var r=n(41442),i=Object.create,o=function(){function t(){}return function(e){if(!r(e))return{};if(i)return i(e);t.prototype=e;var n=new t;return t.prototype=void 0,n}}();t.exports=o},12315:function(t,e,n){var r=n(13802),i=r();t.exports=i},4812:function(t,e,n){var r=n(25841),i=n(97039),o=n(34492),a="[object Null]",s="[object Undefined]",u=r?r.toStringTag:void 0;function c(t){return null==t?void 0===t?s:a:u&&u in Object(t)?i(t):o(t)}t.exports=c},86994:function(t,e,n){var r=n(4812),i=n(3862),o="[object Arguments]";function a(t){return i(t)&&r(t)==o}t.exports=a},1791:function(t,e,n){n(24603),n(28450),n(74916),n(15306);var r=n(43943),i=n(17923),o=n(41442),a=n(26475),s=/[\\^$.*+?()[\]{}|]/g,u=/^\[object .+?Constructor\]$/,c=Function.prototype,l=Object.prototype,h=c.toString,f=l.hasOwnProperty,p=RegExp("^"+h.call(f).replace(s,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$");function d(t){if(!o(t)||i(t))return!1;var e=r(t)?p:u;return e.test(a(t))}t.exports=d},43769:function(t,e,n){var r=n(4812),i=n(43781),o=n(3862),a="[object Arguments]",s="[object Array]",u="[object Boolean]",c="[object Date]",l="[object Error]",h="[object Function]",f="[object Map]",p="[object Number]",d="[object Object]",v="[object RegExp]",m="[object Set]",g="[object String]",y="[object WeakMap]",_="[object ArrayBuffer]",x="[object DataView]",b="[object Float32Array]",w="[object Float64Array]",E="[object Int8Array]",S="[object Int16Array]",A="[object Int32Array]",T="[object Uint8Array]",C="[object Uint8ClampedArray]",k="[object Uint16Array]",M="[object Uint32Array]",P={};function I(t){return o(t)&&i(t.length)&&!!P[r(t)]}P[b]=P[w]=P[E]=P[S]=P[A]=P[T]=P[C]=P[k]=P[M]=!0,P[a]=P[s]=P[_]=P[u]=P[x]=P[c]=P[l]=P[h]=P[f]=P[p]=P[d]=P[v]=P[m]=P[g]=P[y]=!1,t.exports=I},83394:function(t,e,n){n(57658);var r=n(41442),i=n(49282),o=n(48130),a=Object.prototype,s=a.hasOwnProperty;function u(t){if(!r(t))return o(t);var e=i(t),n=[];for(var a in t)("constructor"!=a||!e&&s.call(t,a))&&n.push(a);return n}t.exports=u},54227:function(t,e,n){var r=n(13792),i=n(34591),o=n(12315),a=n(62793),s=n(41442),u=n(44549),c=n(8328);function l(t,e,n,h,f){t!==e&&o(e,(function(o,u){if(f||(f=new r),s(o))a(t,e,u,n,l,h,f);else{var p=h?h(c(t,u),o,u+"",t,e,f):void 0;void 0===p&&(p=o),i(t,u,p)}}),u)}t.exports=l},62793:function(t,e,n){var r=n(34591),i=n(84078),o=n(71087),a=n(71049),s=n(32042),u=n(79275),c=n(5569),l=n(84749),h=n(49410),f=n(43943),p=n(41442),d=n(31773),v=n(75540),m=n(8328),g=n(72864);function y(t,e,n,y,_,x,b){var w=m(t,n),E=m(e,n),S=b.get(E);if(S)r(t,n,S);else{var A=x?x(w,E,n+"",t,e,b):void 0,T=void 0===A;if(T){var C=c(E),k=!C&&h(E),M=!C&&!k&&v(E);A=E,C||k||M?c(w)?A=w:l(w)?A=a(w):k?(T=!1,A=i(E,!0)):M?(T=!1,A=o(E,!0)):A=[]:d(E)||u(E)?(A=w,u(w)?A=g(w):p(w)&&!f(w)||(A=s(E))):T=!1}T&&(b.set(E,A),_(A,E,y,x,b),b["delete"](E)),r(t,n,A)}}t.exports=y},17694:function(t,e,n){var r=n(59027),i=n(64532),o=n(19120);function a(t,e){return o(i(t,e,r),t+"")}t.exports=a},10565:function(t,e,n){var r=n(25987),i=n(78760),o=n(59027),a=i?function(t,e){return i(t,"toString",{configurable:!0,enumerable:!1,value:r(e),writable:!0})}:o;t.exports=a},79779:function(t){function e(t,e){var n=-1,r=Array(t);while(++n<t)r[n]=e(n);return r}t.exports=e},51369:function(t){function e(t){return function(e){return t(e)}}t.exports=e},33777:function(t,e,n){var r=n(8865);function i(t){var e=new t.constructor(t.byteLength);return new r(e).set(new r(t)),e}t.exports=i},84078:function(t,e,n){t=n.nmd(t);var r=n(1692)["default"],i=n(80195),o="object"==r(e)&&e&&!e.nodeType&&e,a=o&&"object"==r(t)&&t&&!t.nodeType&&t,s=a&&a.exports===o,u=s?i.Buffer:void 0,c=u?u.allocUnsafe:void 0;function l(t,e){if(e)return t.slice();var n=t.length,r=c?c(n):new t.constructor(n);return t.copy(r),r}t.exports=l},71087:function(t,e,n){var r=n(33777);function i(t,e){var n=e?r(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}t.exports=i},71049:function(t){function e(t,e){var n=-1,r=t.length;e||(e=Array(r));while(++n<r)e[n]=t[n];return e}t.exports=e},97952:function(t,e,n){var r=n(59817),i=n(68900);function o(t,e,n,o){var a=!n;n||(n={});var s=-1,u=e.length;while(++s<u){var c=e[s],l=o?o(n[c],t[c],c,n,t):void 0;void 0===l&&(l=t[c]),a?i(n,c,l):r(n,c,l)}return n}t.exports=o},57928:function(t,e,n){var r=n(80195),i=r["__core-js_shared__"];t.exports=i},77525:function(t,e,n){var r=n(17694),i=n(88473);function o(t){return r((function(e,n){var r=-1,o=n.length,a=o>1?n[o-1]:void 0,s=o>2?n[2]:void 0;a=t.length>3&&"function"==typeof a?(o--,a):void 0,s&&i(n[0],n[1],s)&&(a=o<3?void 0:a,o=1),e=Object(e);while(++r<o){var u=n[r];u&&t(e,u,r,a)}return e}))}t.exports=o},13802:function(t){function e(t){return function(e,n,r){var i=-1,o=Object(e),a=r(e),s=a.length;while(s--){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}t.exports=e},78760:function(t,e,n){var r=n(53244),i=function(){try{var t=r(Object,"defineProperty");return t({},"",{}),t}catch(e){}}();t.exports=i},73412:function(t,e,n){var r=n(1692)["default"],i="object"==("undefined"===typeof n.g?"undefined":r(n.g))&&n.g&&n.g.Object===Object&&n.g;t.exports=i},49101:function(t,e,n){var r=n(63407);function i(t,e){var n=t.__data__;return r(e)?n["string"==typeof e?"string":"hash"]:n.map}t.exports=i},53244:function(t,e,n){var r=n(1791),i=n(26312);function o(t,e){var n=i(t,e);return r(n)?n:void 0}t.exports=o},26546:function(t,e,n){var r=n(90391),i=r(Object.getPrototypeOf,Object);t.exports=i},97039:function(t,e,n){var r=n(25841),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;function u(t){var e=o.call(t,s),n=t[s];try{t[s]=void 0;var r=!0}catch(u){}var i=a.call(t);return r&&(e?t[s]=n:delete t[s]),i}t.exports=u},26312:function(t){function e(t,e){return null==t?void 0:t[e]}t.exports=e},67567:function(t,e,n){var r=n(80885);function i(){this.__data__=r?r(null):{},this.size=0}t.exports=i},23377:function(t){function e(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}t.exports=e},9443:function(t,e,n){var r=n(80885),i="__lodash_hash_undefined__",o=Object.prototype,a=o.hasOwnProperty;function s(t){var e=this.__data__;if(r){var n=e[t];return n===i?void 0:n}return a.call(e,t)?e[t]:void 0}t.exports=s},16568:function(t,e,n){var r=n(80885),i=Object.prototype,o=i.hasOwnProperty;function a(t){var e=this.__data__;return r?void 0!==e[t]:o.call(e,t)}t.exports=a},96467:function(t,e,n){var r=n(80885),i="__lodash_hash_undefined__";function o(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=r&&void 0===e?i:e,this}t.exports=o},32042:function(t,e,n){var r=n(28507),i=n(26546),o=n(49282);function a(t){return"function"!=typeof t.constructor||o(t)?{}:r(i(t))}t.exports=a},92041:function(t,e,n){var r=n(1692)["default"];n(74916);var i=9007199254740991,o=/^(?:0|[1-9]\d*)$/;function a(t,e){var n=r(t);return e=null==e?i:e,!!e&&("number"==n||"symbol"!=n&&o.test(t))&&t>-1&&t%1==0&&t<e}t.exports=a},88473:function(t,e,n){var r=n(1692)["default"],i=n(60710),o=n(78270),a=n(92041),s=n(41442);function u(t,e,n){if(!s(n))return!1;var u=r(e);return!!("number"==u?o(n)&&a(e,n.length):"string"==u&&e in n)&&i(n[e],t)}t.exports=u},63407:function(t,e,n){var r=n(1692)["default"];function i(t){var e=r(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}t.exports=i},17923:function(t,e,n){n(74916),n(33948);var r=n(57928),i=function(){var t=/[^.]+$/.exec(r&&r.keys&&r.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}();function o(t){return!!i&&i in t}t.exports=o},49282:function(t){var e=Object.prototype;function n(t){var n=t&&t.constructor,r="function"==typeof n&&n.prototype||e;return t===r}t.exports=n},42981:function(t){function e(){this.__data__=[],this.size=0}t.exports=e},21023:function(t,e,n){var r=n(2107),i=Array.prototype,o=i.splice;function a(t){var e=this.__data__,n=r(e,t);if(n<0)return!1;var i=e.length-1;return n==i?e.pop():o.call(e,n,1),--this.size,!0}t.exports=a},95119:function(t,e,n){var r=n(2107);function i(t){var e=this.__data__,n=r(e,t);return n<0?void 0:e[n][1]}t.exports=i},85314:function(t,e,n){var r=n(2107);function i(t){return r(this.__data__,t)>-1}t.exports=i},19202:function(t,e,n){n(57658);var r=n(2107);function i(t,e){var n=this.__data__,i=r(n,t);return i<0?(++this.size,n.push([t,e])):n[i][1]=e,this}t.exports=i},62208:function(t,e,n){var r=n(76697),i=n(85657),o=n(45670);function a(){this.size=0,this.__data__={hash:new r,map:new(o||i),string:new r}}t.exports=a},28923:function(t,e,n){var r=n(49101);function i(t){var e=r(this,t)["delete"](t);return this.size-=e?1:0,e}t.exports=i},14581:function(t,e,n){var r=n(49101);function i(t){return r(this,t).get(t)}t.exports=i},86024:function(t,e,n){var r=n(49101);function i(t){return r(this,t).has(t)}t.exports=i},40732:function(t,e,n){var r=n(49101);function i(t,e){var n=r(this,t),i=n.size;return n.set(t,e),this.size+=n.size==i?0:1,this}t.exports=i},80885:function(t,e,n){var r=n(53244),i=r(Object,"create");t.exports=i},48130:function(t,e,n){function r(t){var e=[];if(null!=t)for(var n in Object(t))e.push(n);return e}n(57658),t.exports=r},38365:function(t,e,n){t=n.nmd(t);var r=n(1692)["default"],i=n(73412),o="object"==r(e)&&e&&!e.nodeType&&e,a=o&&"object"==r(t)&&t&&!t.nodeType&&t,s=a&&a.exports===o,u=s&&i.process,c=function(){try{var t=a&&a.require&&a.require("util").types;return t||u&&u.binding&&u.binding("util")}catch(e){}}();t.exports=c},34492:function(t){var e=Object.prototype,n=e.toString;function r(t){return n.call(t)}t.exports=r},90391:function(t){function e(t,e){return function(n){return t(e(n))}}t.exports=e},64532:function(t,e,n){var r=n(89159),i=Math.max;function o(t,e,n){return e=i(void 0===e?t.length-1:e,0),function(){var o=arguments,a=-1,s=i(o.length-e,0),u=Array(s);while(++a<s)u[a]=o[e+a];a=-1;var c=Array(e+1);while(++a<e)c[a]=o[a];return c[e]=n(u),r(t,this,c)}}t.exports=o},80195:function(t,e,n){var r=n(1692)["default"],i=n(73412),o="object"==("undefined"===typeof self?"undefined":r(self))&&self&&self.Object===Object&&self,a=i||o||Function("return this")();t.exports=a},8328:function(t){function e(t,e){if(("constructor"!==e||"function"!==typeof t[e])&&"__proto__"!=e)return t[e]}t.exports=e},19120:function(t,e,n){var r=n(10565),i=n(16841),o=i(r);t.exports=o},16841:function(t){var e=800,n=16,r=Date.now;function i(t){var i=0,o=0;return function(){var a=r(),s=n-(a-o);if(o=a,s>0){if(++i>=e)return arguments[0]}else i=0;return t.apply(void 0,arguments)}}t.exports=i},89614:function(t,e,n){var r=n(85657);function i(){this.__data__=new r,this.size=0}t.exports=i},46841:function(t){function e(t){var e=this.__data__,n=e["delete"](t);return this.size=e.size,n}t.exports=e},92235:function(t){function e(t){return this.__data__.get(t)}t.exports=e},87064:function(t){function e(t){return this.__data__.has(t)}t.exports=e},63559:function(t,e,n){n(57658);var r=n(85657),i=n(45670),o=n(41636),a=200;function s(t,e){var n=this.__data__;if(n instanceof r){var s=n.__data__;if(!i||s.length<a-1)return s.push([t,e]),this.size=++n.size,this;n=this.__data__=new o(s)}return n.set(t,e),this.size=n.size,this}t.exports=s},26475:function(t){var e=Function.prototype,n=e.toString;function r(t){if(null!=t){try{return n.call(t)}catch(e){}try{return t+""}catch(e){}}return""}t.exports=r},25987:function(t){function e(t){return function(){return t}}t.exports=e},60710:function(t){function e(t,e){return t===e||t!==t&&e!==e}t.exports=e},59027:function(t){function e(t){return t}t.exports=e},79275:function(t,e,n){var r=n(86994),i=n(3862),o=Object.prototype,a=o.hasOwnProperty,s=o.propertyIsEnumerable,u=r(function(){return arguments}())?r:function(t){return i(t)&&a.call(t,"callee")&&!s.call(t,"callee")};t.exports=u},5569:function(t){var e=Array.isArray;t.exports=e},78270:function(t,e,n){var r=n(43943),i=n(43781);function o(t){return null!=t&&i(t.length)&&!r(t)}t.exports=o},84749:function(t,e,n){var r=n(78270),i=n(3862);function o(t){return i(t)&&r(t)}t.exports=o},49410:function(t,e,n){t=n.nmd(t);var r=n(1692)["default"],i=n(80195),o=n(47648),a="object"==r(e)&&e&&!e.nodeType&&e,s=a&&"object"==r(t)&&t&&!t.nodeType&&t,u=s&&s.exports===a,c=u?i.Buffer:void 0,l=c?c.isBuffer:void 0,h=l||o;t.exports=h},43943:function(t,e,n){var r=n(4812),i=n(41442),o="[object AsyncFunction]",a="[object Function]",s="[object GeneratorFunction]",u="[object Proxy]";function c(t){if(!i(t))return!1;var e=r(t);return e==a||e==s||e==o||e==u}t.exports=c},43781:function(t){var e=9007199254740991;function n(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=e}t.exports=n},41442:function(t,e,n){var r=n(1692)["default"];function i(t){var e=r(t);return null!=t&&("object"==e||"function"==e)}t.exports=i},3862:function(t,e,n){var r=n(1692)["default"];function i(t){return null!=t&&"object"==r(t)}t.exports=i},31773:function(t,e,n){var r=n(4812),i=n(26546),o=n(3862),a="[object Object]",s=Function.prototype,u=Object.prototype,c=s.toString,l=u.hasOwnProperty,h=c.call(Object);function f(t){if(!o(t)||r(t)!=a)return!1;var e=i(t);if(null===e)return!0;var n=l.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&c.call(n)==h}t.exports=f},75540:function(t,e,n){var r=n(43769),i=n(51369),o=n(38365),a=o&&o.isTypedArray,s=a?i(a):r;t.exports=s},44549:function(t,e,n){var r=n(89335),i=n(83394),o=n(78270);function a(t){return o(t)?r(t,!0):i(t)}t.exports=a},51579:function(t,e,n){var r;t=n.nmd(t);var i=n(1692)["default"];n(24603),n(28450),n(74916),n(2707),n(15306),n(57658),n(33948),n(65069),n(18264),n(39575),n(52262),n(24506),n(86535),n(99244),n(67635),n(77287),n(66528),n(83112),n(73210),n(48702),n(55674),n(83753),function(){var o,a="4.17.21",s=200,u="Unsupported core-js use. Try https://npms.io/search?q=ponyfill.",c="Expected a function",l="Invalid `variable` option passed into `_.template`",h="__lodash_hash_undefined__",f=500,p="__lodash_placeholder__",d=1,v=2,m=4,g=1,y=2,_=1,x=2,b=4,w=8,E=16,S=32,A=64,T=128,C=256,k=512,M=30,P="...",I=800,R=16,L=1,O=2,D=3,N=1/0,z=9007199254740991,F=17976931348623157e292,B=NaN,U=4294967295,j=U-1,Z=U>>>1,V=[["ary",T],["bind",_],["bindKey",x],["curry",w],["curryRight",E],["flip",k],["partial",S],["partialRight",A],["rearg",C]],G="[object Arguments]",H="[object Array]",W="[object AsyncFunction]",q="[object Boolean]",X="[object Date]",Y="[object DOMException]",K="[object Error]",Q="[object Function]",J="[object GeneratorFunction]",$="[object Map]",tt="[object Number]",et="[object Null]",nt="[object Object]",rt="[object Promise]",it="[object Proxy]",ot="[object RegExp]",at="[object Set]",st="[object String]",ut="[object Symbol]",ct="[object Undefined]",lt="[object WeakMap]",ht="[object WeakSet]",ft="[object ArrayBuffer]",pt="[object DataView]",dt="[object Float32Array]",vt="[object Float64Array]",mt="[object Int8Array]",gt="[object Int16Array]",yt="[object Int32Array]",_t="[object Uint8Array]",xt="[object Uint8ClampedArray]",bt="[object Uint16Array]",wt="[object Uint32Array]",Et=/\b__p \+= '';/g,St=/\b(__p \+=) '' \+/g,At=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Tt=/&(?:amp|lt|gt|quot|#39);/g,Ct=/[&<>"']/g,kt=RegExp(Tt.source),Mt=RegExp(Ct.source),Pt=/<%-([\s\S]+?)%>/g,It=/<%([\s\S]+?)%>/g,Rt=/<%=([\s\S]+?)%>/g,Lt=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ot=/^\w*$/,Dt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,Nt=/[\\^$.*+?()[\]{}|]/g,zt=RegExp(Nt.source),Ft=/^\s+/,Bt=/\s/,Ut=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,jt=/\{\n\/\* \[wrapped with (.+)\] \*/,Zt=/,? & /,Vt=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Gt=/[()=,{}\[\]\/\s]/,Ht=/\\(\\)?/g,Wt=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,qt=/\w*$/,Xt=/^[-+]0x[0-9a-f]+$/i,Yt=/^0b[01]+$/i,Kt=/^\[object .+?Constructor\]$/,Qt=/^0o[0-7]+$/i,Jt=/^(?:0|[1-9]\d*)$/,$t=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,te=/($^)/,ee=/['\n\r\u2028\u2029\\]/g,ne="\\ud800-\\udfff",re="\\u0300-\\u036f",ie="\\ufe20-\\ufe2f",oe="\\u20d0-\\u20ff",ae=re+ie+oe,se="\\u2700-\\u27bf",ue="a-z\\xdf-\\xf6\\xf8-\\xff",ce="\\xac\\xb1\\xd7\\xf7",le="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",he="\\u2000-\\u206f",fe=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pe="A-Z\\xc0-\\xd6\\xd8-\\xde",de="\\ufe0e\\ufe0f",ve=ce+le+he+fe,me="['’]",ge="["+ne+"]",ye="["+ve+"]",_e="["+ae+"]",xe="\\d+",be="["+se+"]",we="["+ue+"]",Ee="[^"+ne+ve+xe+se+ue+pe+"]",Se="\\ud83c[\\udffb-\\udfff]",Ae="(?:"+_e+"|"+Se+")",Te="[^"+ne+"]",Ce="(?:\\ud83c[\\udde6-\\uddff]){2}",ke="[\\ud800-\\udbff][\\udc00-\\udfff]",Me="["+pe+"]",Pe="\\u200d",Ie="(?:"+we+"|"+Ee+")",Re="(?:"+Me+"|"+Ee+")",Le="(?:"+me+"(?:d|ll|m|re|s|t|ve))?",Oe="(?:"+me+"(?:D|LL|M|RE|S|T|VE))?",De=Ae+"?",Ne="["+de+"]?",ze="(?:"+Pe+"(?:"+[Te,Ce,ke].join("|")+")"+Ne+De+")*",Fe="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Be="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Ue=Ne+De+ze,je="(?:"+[be,Ce,ke].join("|")+")"+Ue,Ze="(?:"+[Te+_e+"?",_e,Ce,ke,ge].join("|")+")",Ve=RegExp(me,"g"),Ge=RegExp(_e,"g"),He=RegExp(Se+"(?="+Se+")|"+Ze+Ue,"g"),We=RegExp([Me+"?"+we+"+"+Le+"(?="+[ye,Me,"$"].join("|")+")",Re+"+"+Oe+"(?="+[ye,Me+Ie,"$"].join("|")+")",Me+"?"+Ie+"+"+Le,Me+"+"+Oe,Be,Fe,xe,je].join("|"),"g"),qe=RegExp("["+Pe+ne+ae+de+"]"),Xe=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,Ye=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],Ke=-1,Qe={};Qe[dt]=Qe[vt]=Qe[mt]=Qe[gt]=Qe[yt]=Qe[_t]=Qe[xt]=Qe[bt]=Qe[wt]=!0,Qe[G]=Qe[H]=Qe[ft]=Qe[q]=Qe[pt]=Qe[X]=Qe[K]=Qe[Q]=Qe[$]=Qe[tt]=Qe[nt]=Qe[ot]=Qe[at]=Qe[st]=Qe[lt]=!1;var Je={};Je[G]=Je[H]=Je[ft]=Je[pt]=Je[q]=Je[X]=Je[dt]=Je[vt]=Je[mt]=Je[gt]=Je[yt]=Je[$]=Je[tt]=Je[nt]=Je[ot]=Je[at]=Je[st]=Je[ut]=Je[_t]=Je[xt]=Je[bt]=Je[wt]=!0,Je[K]=Je[Q]=Je[lt]=!1;var $e={"À":"A","Á":"A","Â":"A","Ã":"A","Ä":"A","Å":"A","à":"a","á":"a","â":"a","ã":"a","ä":"a","å":"a","Ç":"C","ç":"c","Ð":"D","ð":"d","È":"E","É":"E","Ê":"E","Ë":"E","è":"e","é":"e","ê":"e","ë":"e","Ì":"I","Í":"I","Î":"I","Ï":"I","ì":"i","í":"i","î":"i","ï":"i","Ñ":"N","ñ":"n","Ò":"O","Ó":"O","Ô":"O","Õ":"O","Ö":"O","Ø":"O","ò":"o","ó":"o","ô":"o","õ":"o","ö":"o","ø":"o","Ù":"U","Ú":"U","Û":"U","Ü":"U","ù":"u","ú":"u","û":"u","ü":"u","Ý":"Y","ý":"y","ÿ":"y","Æ":"Ae","æ":"ae","Þ":"Th","þ":"th","ß":"ss","Ā":"A","Ă":"A","Ą":"A","ā":"a","ă":"a","ą":"a","Ć":"C","Ĉ":"C","Ċ":"C","Č":"C","ć":"c","ĉ":"c","ċ":"c","č":"c","Ď":"D","Đ":"D","ď":"d","đ":"d","Ē":"E","Ĕ":"E","Ė":"E","Ę":"E","Ě":"E","ē":"e","ĕ":"e","ė":"e","ę":"e","ě":"e","Ĝ":"G","Ğ":"G","Ġ":"G","Ģ":"G","ĝ":"g","ğ":"g","ġ":"g","ģ":"g","Ĥ":"H","Ħ":"H","ĥ":"h","ħ":"h","Ĩ":"I","Ī":"I","Ĭ":"I","Į":"I","İ":"I","ĩ":"i","ī":"i","ĭ":"i","į":"i","ı":"i","Ĵ":"J","ĵ":"j","Ķ":"K","ķ":"k","ĸ":"k","Ĺ":"L","Ļ":"L","Ľ":"L","Ŀ":"L","Ł":"L","ĺ":"l","ļ":"l","ľ":"l","ŀ":"l","ł":"l","Ń":"N","Ņ":"N","Ň":"N","Ŋ":"N","ń":"n","ņ":"n","ň":"n","ŋ":"n","Ō":"O","Ŏ":"O","Ő":"O","ō":"o","ŏ":"o","ő":"o","Ŕ":"R","Ŗ":"R","Ř":"R","ŕ":"r","ŗ":"r","ř":"r","Ś":"S","Ŝ":"S","Ş":"S","Š":"S","ś":"s","ŝ":"s","ş":"s","š":"s","Ţ":"T","Ť":"T","Ŧ":"T","ţ":"t","ť":"t","ŧ":"t","Ũ":"U","Ū":"U","Ŭ":"U","Ů":"U","Ű":"U","Ų":"U","ũ":"u","ū":"u","ŭ":"u","ů":"u","ű":"u","ų":"u","Ŵ":"W","ŵ":"w","Ŷ":"Y","ŷ":"y","Ÿ":"Y","Ź":"Z","Ż":"Z","Ž":"Z","ź":"z","ż":"z","ž":"z","Ĳ":"IJ","ĳ":"ij","Œ":"Oe","œ":"oe","ŉ":"'n","ſ":"s"},tn={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},en={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"},nn={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},rn=parseFloat,on=parseInt,an="object"==("undefined"===typeof n.g?"undefined":i(n.g))&&n.g&&n.g.Object===Object&&n.g,sn="object"==("undefined"===typeof self?"undefined":i(self))&&self&&self.Object===Object&&self,un=an||sn||Function("return this")(),cn="object"==i(e)&&e&&!e.nodeType&&e,ln=cn&&"object"==i(t)&&t&&!t.nodeType&&t,hn=ln&&ln.exports===cn,fn=hn&&an.process,pn=function(){try{var t=ln&&ln.require&&ln.require("util").types;return t||fn&&fn.binding&&fn.binding("util")}catch(e){}}(),dn=pn&&pn.isArrayBuffer,vn=pn&&pn.isDate,mn=pn&&pn.isMap,gn=pn&&pn.isRegExp,yn=pn&&pn.isSet,_n=pn&&pn.isTypedArray;function xn(t,e,n){switch(n.length){case 0:return t.call(e);case 1:return t.call(e,n[0]);case 2:return t.call(e,n[0],n[1]);case 3:return t.call(e,n[0],n[1],n[2])}return t.apply(e,n)}function bn(t,e,n,r){var i=-1,o=null==t?0:t.length;while(++i<o){var a=t[i];e(r,a,n(a),t)}return r}function wn(t,e){var n=-1,r=null==t?0:t.length;while(++n<r)if(!1===e(t[n],n,t))break;return t}function En(t,e){var n=null==t?0:t.length;while(n--)if(!1===e(t[n],n,t))break;return t}function Sn(t,e){var n=-1,r=null==t?0:t.length;while(++n<r)if(!e(t[n],n,t))return!1;return!0}function An(t,e){var n=-1,r=null==t?0:t.length,i=0,o=[];while(++n<r){var a=t[n];e(a,n,t)&&(o[i++]=a)}return o}function Tn(t,e){var n=null==t?0:t.length;return!!n&&Fn(t,e,0)>-1}function Cn(t,e,n){var r=-1,i=null==t?0:t.length;while(++r<i)if(n(e,t[r]))return!0;return!1}function kn(t,e){var n=-1,r=null==t?0:t.length,i=Array(r);while(++n<r)i[n]=e(t[n],n,t);return i}function Mn(t,e){var n=-1,r=e.length,i=t.length;while(++n<r)t[i+n]=e[n];return t}function Pn(t,e,n,r){var i=-1,o=null==t?0:t.length;r&&o&&(n=t[++i]);while(++i<o)n=e(n,t[i],i,t);return n}function In(t,e,n,r){var i=null==t?0:t.length;r&&i&&(n=t[--i]);while(i--)n=e(n,t[i],i,t);return n}function Rn(t,e){var n=-1,r=null==t?0:t.length;while(++n<r)if(e(t[n],n,t))return!0;return!1}var Ln=Zn("length");function On(t){return t.split("")}function Dn(t){return t.match(Vt)||[]}function Nn(t,e,n){var r;return n(t,(function(t,n,i){if(e(t,n,i))return r=n,!1})),r}function zn(t,e,n,r){var i=t.length,o=n+(r?1:-1);while(r?o--:++o<i)if(e(t[o],o,t))return o;return-1}function Fn(t,e,n){return e===e?dr(t,e,n):zn(t,Un,n)}function Bn(t,e,n,r){var i=n-1,o=t.length;while(++i<o)if(r(t[i],e))return i;return-1}function Un(t){return t!==t}function jn(t,e){var n=null==t?0:t.length;return n?Wn(t,e)/n:B}function Zn(t){return function(e){return null==e?o:e[t]}}function Vn(t){return function(e){return null==t?o:t[e]}}function Gn(t,e,n,r,i){return i(t,(function(t,i,o){n=r?(r=!1,t):e(n,t,i,o)})),n}function Hn(t,e){var n=t.length;t.sort(e);while(n--)t[n]=t[n].value;return t}function Wn(t,e){var n,r=-1,i=t.length;while(++r<i){var a=e(t[r]);a!==o&&(n=n===o?a:n+a)}return n}function qn(t,e){var n=-1,r=Array(t);while(++n<t)r[n]=e(n);return r}function Xn(t,e){return kn(e,(function(e){return[e,t[e]]}))}function Yn(t){return t?t.slice(0,yr(t)+1).replace(Ft,""):t}function Kn(t){return function(e){return t(e)}}function Qn(t,e){return kn(e,(function(e){return t[e]}))}function Jn(t,e){return t.has(e)}function $n(t,e){var n=-1,r=t.length;while(++n<r&&Fn(e,t[n],0)>-1);return n}function tr(t,e){var n=t.length;while(n--&&Fn(e,t[n],0)>-1);return n}function er(t,e){var n=t.length,r=0;while(n--)t[n]===e&&++r;return r}var nr=Vn($e),rr=Vn(tn);function ir(t){return"\\"+nn[t]}function or(t,e){return null==t?o:t[e]}function ar(t){return qe.test(t)}function sr(t){return Xe.test(t)}function ur(t){var e,n=[];while(!(e=t.next()).done)n.push(e.value);return n}function cr(t){var e=-1,n=Array(t.size);return t.forEach((function(t,r){n[++e]=[r,t]})),n}function lr(t,e){return function(n){return t(e(n))}}function hr(t,e){var n=-1,r=t.length,i=0,o=[];while(++n<r){var a=t[n];a!==e&&a!==p||(t[n]=p,o[i++]=n)}return o}function fr(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=t})),n}function pr(t){var e=-1,n=Array(t.size);return t.forEach((function(t){n[++e]=[t,t]})),n}function dr(t,e,n){var r=n-1,i=t.length;while(++r<i)if(t[r]===e)return r;return-1}function vr(t,e,n){var r=n+1;while(r--)if(t[r]===e)return r;return r}function mr(t){return ar(t)?xr(t):Ln(t)}function gr(t){return ar(t)?br(t):On(t)}function yr(t){var e=t.length;while(e--&&Bt.test(t.charAt(e)));return e}var _r=Vn(en);function xr(t){var e=He.lastIndex=0;while(He.test(t))++e;return e}function br(t){return t.match(He)||[]}function wr(t){return t.match(We)||[]}var Er=function t(e){e=null==e?un:Sr.defaults(un.Object(),e,Sr.pick(un,Ye));var n=e.Array,r=e.Date,Bt=e.Error,Vt=e.Function,ne=e.Math,re=e.Object,ie=e.RegExp,oe=e.String,ae=e.TypeError,se=n.prototype,ue=Vt.prototype,ce=re.prototype,le=e["__core-js_shared__"],he=ue.toString,fe=ce.hasOwnProperty,pe=0,de=function(){var t=/[^.]+$/.exec(le&&le.keys&&le.keys.IE_PROTO||"");return t?"Symbol(src)_1."+t:""}(),ve=ce.toString,me=he.call(re),ge=un._,ye=ie("^"+he.call(fe).replace(Nt,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),_e=hn?e.Buffer:o,xe=e.Symbol,be=e.Uint8Array,we=_e?_e.allocUnsafe:o,Ee=lr(re.getPrototypeOf,re),Se=re.create,Ae=ce.propertyIsEnumerable,Te=se.splice,Ce=xe?xe.isConcatSpreadable:o,ke=xe?xe.iterator:o,Me=xe?xe.toStringTag:o,Pe=function(){try{var t=Xa(re,"defineProperty");return t({},"",{}),t}catch(e){}}(),Ie=e.clearTimeout!==un.clearTimeout&&e.clearTimeout,Re=r&&r.now!==un.Date.now&&r.now,Le=e.setTimeout!==un.setTimeout&&e.setTimeout,Oe=ne.ceil,De=ne.floor,Ne=re.getOwnPropertySymbols,ze=_e?_e.isBuffer:o,Fe=e.isFinite,Be=se.join,Ue=lr(re.keys,re),je=ne.max,Ze=ne.min,He=r.now,We=e.parseInt,qe=ne.random,Xe=se.reverse,$e=Xa(e,"DataView"),tn=Xa(e,"Map"),en=Xa(e,"Promise"),nn=Xa(e,"Set"),an=Xa(e,"WeakMap"),sn=Xa(re,"create"),cn=an&&new an,ln={},fn=Ls($e),pn=Ls(tn),Ln=Ls(en),On=Ls(nn),Vn=Ls(an),dr=xe?xe.prototype:o,xr=dr?dr.valueOf:o,br=dr?dr.toString:o;function Er(t){if(Tl(t)&&!cl(t)&&!(t instanceof kr)){if(t instanceof Cr)return t;if(fe.call(t,"__wrapped__"))return Ds(t)}return new Cr(t)}var Ar=function(){function t(){}return function(e){if(!Al(e))return{};if(Se)return Se(e);t.prototype=e;var n=new t;return t.prototype=o,n}}();function Tr(){}function Cr(t,e){this.__wrapped__=t,this.__actions__=[],this.__chain__=!!e,this.__index__=0,this.__values__=o}function kr(t){this.__wrapped__=t,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=U,this.__views__=[]}function Mr(){var t=new kr(this.__wrapped__);return t.__actions__=oa(this.__actions__),t.__dir__=this.__dir__,t.__filtered__=this.__filtered__,t.__iteratees__=oa(this.__iteratees__),t.__takeCount__=this.__takeCount__,t.__views__=oa(this.__views__),t}function Pr(){if(this.__filtered__){var t=new kr(this);t.__dir__=-1,t.__filtered__=!0}else t=this.clone(),t.__dir__*=-1;return t}function Ir(){var t=this.__wrapped__.value(),e=this.__dir__,n=cl(t),r=e<0,i=n?t.length:0,o=$a(0,i,this.__views__),a=o.start,s=o.end,u=s-a,c=r?s:a-1,l=this.__iteratees__,h=l.length,f=0,p=Ze(u,this.__takeCount__);if(!n||!r&&i==u&&p==u)return Uo(t,this.__actions__);var d=[];t:while(u--&&f<p){c+=e;var v=-1,m=t[c];while(++v<h){var g=l[v],y=g.iteratee,_=g.type,x=y(m);if(_==O)m=x;else if(!x){if(_==L)continue t;break t}}d[f++]=m}return d}function Rr(t){var e=-1,n=null==t?0:t.length;this.clear();while(++e<n){var r=t[e];this.set(r[0],r[1])}}function Lr(){this.__data__=sn?sn(null):{},this.size=0}function Or(t){var e=this.has(t)&&delete this.__data__[t];return this.size-=e?1:0,e}function Dr(t){var e=this.__data__;if(sn){var n=e[t];return n===h?o:n}return fe.call(e,t)?e[t]:o}function Nr(t){var e=this.__data__;return sn?e[t]!==o:fe.call(e,t)}function zr(t,e){var n=this.__data__;return this.size+=this.has(t)?0:1,n[t]=sn&&e===o?h:e,this}function Fr(t){var e=-1,n=null==t?0:t.length;this.clear();while(++e<n){var r=t[e];this.set(r[0],r[1])}}function Br(){this.__data__=[],this.size=0}function Ur(t){var e=this.__data__,n=hi(e,t);if(n<0)return!1;var r=e.length-1;return n==r?e.pop():Te.call(e,n,1),--this.size,!0}function jr(t){var e=this.__data__,n=hi(e,t);return n<0?o:e[n][1]}function Zr(t){return hi(this.__data__,t)>-1}function Vr(t,e){var n=this.__data__,r=hi(n,t);return r<0?(++this.size,n.push([t,e])):n[r][1]=e,this}function Gr(t){var e=-1,n=null==t?0:t.length;this.clear();while(++e<n){var r=t[e];this.set(r[0],r[1])}}function Hr(){this.size=0,this.__data__={hash:new Rr,map:new(tn||Fr),string:new Rr}}function Wr(t){var e=Wa(this,t)["delete"](t);return this.size-=e?1:0,e}function qr(t){return Wa(this,t).get(t)}function Xr(t){return Wa(this,t).has(t)}function Yr(t,e){var n=Wa(this,t),r=n.size;return n.set(t,e),this.size+=n.size==r?0:1,this}function Kr(t){var e=-1,n=null==t?0:t.length;this.__data__=new Gr;while(++e<n)this.add(t[e])}function Qr(t){return this.__data__.set(t,h),this}function Jr(t){return this.__data__.has(t)}function $r(t){var e=this.__data__=new Fr(t);this.size=e.size}function ti(){this.__data__=new Fr,this.size=0}function ei(t){var e=this.__data__,n=e["delete"](t);return this.size=e.size,n}function ni(t){return this.__data__.get(t)}function ri(t){return this.__data__.has(t)}function ii(t,e){var n=this.__data__;if(n instanceof Fr){var r=n.__data__;if(!tn||r.length<s-1)return r.push([t,e]),this.size=++n.size,this;n=this.__data__=new Gr(r)}return n.set(t,e),this.size=n.size,this}function oi(t,e){var n=cl(t),r=!n&&ul(t),i=!n&&!r&&dl(t),o=!n&&!r&&!i&&jl(t),a=n||r||i||o,s=a?qn(t.length,oe):[],u=s.length;for(var c in t)!e&&!fe.call(t,c)||a&&("length"==c||i&&("offset"==c||"parent"==c)||o&&("buffer"==c||"byteLength"==c||"byteOffset"==c)||ss(c,u))||s.push(c);return s}function ai(t){var e=t.length;return e?t[_o(0,e-1)]:o}function si(t,e){return Ps(oa(t),gi(e,0,t.length))}function ui(t){return Ps(oa(t))}function ci(t,e,n){(n!==o&&!ol(t[e],n)||n===o&&!(e in t))&&vi(t,e,n)}function li(t,e,n){var r=t[e];fe.call(t,e)&&ol(r,n)&&(n!==o||e in t)||vi(t,e,n)}function hi(t,e){var n=t.length;while(n--)if(ol(t[n][0],e))return n;return-1}function fi(t,e,n,r){return Ei(t,(function(t,i,o){e(r,t,n(t),o)})),r}function pi(t,e){return t&&aa(e,Eh(e),t)}function di(t,e){return t&&aa(e,Sh(e),t)}function vi(t,e,n){"__proto__"==e&&Pe?Pe(t,e,{configurable:!0,enumerable:!0,value:n,writable:!0}):t[e]=n}function mi(t,e){var r=-1,i=e.length,a=n(i),s=null==t;while(++r<i)a[r]=s?o:gh(t,e[r]);return a}function gi(t,e,n){return t===t&&(n!==o&&(t=t<=n?t:n),e!==o&&(t=t>=e?t:e)),t}function yi(t,e,n,r,i,a){var s,u=e&d,c=e&v,l=e&m;if(n&&(s=i?n(t,r,i,a):n(t)),s!==o)return s;if(!Al(t))return t;var h=cl(t);if(h){if(s=ns(t),!u)return oa(t,s)}else{var f=Ja(t),p=f==Q||f==J;if(dl(t))return Yo(t,u);if(f==nt||f==G||p&&!i){if(s=c||p?{}:rs(t),!u)return c?ua(t,di(s,t)):sa(t,pi(s,t))}else{if(!Je[f])return i?t:{};s=is(t,f,u)}}a||(a=new $r);var g=a.get(t);if(g)return g;a.set(t,s),Fl(t)?t.forEach((function(r){s.add(yi(r,e,n,r,t,a))})):Cl(t)&&t.forEach((function(r,i){s.set(i,yi(r,e,n,i,t,a))}));var y=l?c?ja:Ua:c?Sh:Eh,_=h?o:y(t);return wn(_||t,(function(r,i){_&&(i=r,r=t[i]),li(s,i,yi(r,e,n,i,t,a))})),s}function _i(t){var e=Eh(t);return function(n){return xi(n,t,e)}}function xi(t,e,n){var r=n.length;if(null==t)return!r;t=re(t);while(r--){var i=n[r],a=e[i],s=t[i];if(s===o&&!(i in t)||!a(s))return!1}return!0}function bi(t,e,n){if("function"!=typeof t)throw new ae(c);return Ts((function(){t.apply(o,n)}),e)}function wi(t,e,n,r){var i=-1,o=Tn,a=!0,u=t.length,c=[],l=e.length;if(!u)return c;n&&(e=kn(e,Kn(n))),r?(o=Cn,a=!1):e.length>=s&&(o=Jn,a=!1,e=new Kr(e));t:while(++i<u){var h=t[i],f=null==n?h:n(h);if(h=r||0!==h?h:0,a&&f===f){var p=l;while(p--)if(e[p]===f)continue t;c.push(h)}else o(e,f,r)||c.push(h)}return c}Er.templateSettings={escape:Pt,evaluate:It,interpolate:Rt,variable:"",imports:{_:Er}},Er.prototype=Tr.prototype,Er.prototype.constructor=Er,Cr.prototype=Ar(Tr.prototype),Cr.prototype.constructor=Cr,kr.prototype=Ar(Tr.prototype),kr.prototype.constructor=kr,Rr.prototype.clear=Lr,Rr.prototype["delete"]=Or,Rr.prototype.get=Dr,Rr.prototype.has=Nr,Rr.prototype.set=zr,Fr.prototype.clear=Br,Fr.prototype["delete"]=Ur,Fr.prototype.get=jr,Fr.prototype.has=Zr,Fr.prototype.set=Vr,Gr.prototype.clear=Hr,Gr.prototype["delete"]=Wr,Gr.prototype.get=qr,Gr.prototype.has=Xr,Gr.prototype.set=Yr,Kr.prototype.add=Kr.prototype.push=Qr,Kr.prototype.has=Jr,$r.prototype.clear=ti,$r.prototype["delete"]=ei,$r.prototype.get=ni,$r.prototype.has=ri,$r.prototype.set=ii;var Ei=ha(Ri),Si=ha(Li,!0);function Ai(t,e){var n=!0;return Ei(t,(function(t,r,i){return n=!!e(t,r,i),n})),n}function Ti(t,e,n){var r=-1,i=t.length;while(++r<i){var a=t[r],s=e(a);if(null!=s&&(u===o?s===s&&!Ul(s):n(s,u)))var u=s,c=a}return c}function Ci(t,e,n,r){var i=t.length;n=Yl(n),n<0&&(n=-n>i?0:i+n),r=r===o||r>i?i:Yl(r),r<0&&(r+=i),r=n>r?0:Kl(r);while(n<r)t[n++]=e;return t}function ki(t,e){var n=[];return Ei(t,(function(t,r,i){e(t,r,i)&&n.push(t)})),n}function Mi(t,e,n,r,i){var o=-1,a=t.length;n||(n=as),i||(i=[]);while(++o<a){var s=t[o];e>0&&n(s)?e>1?Mi(s,e-1,n,r,i):Mn(i,s):r||(i[i.length]=s)}return i}var Pi=fa(),Ii=fa(!0);function Ri(t,e){return t&&Pi(t,e,Eh)}function Li(t,e){return t&&Ii(t,e,Eh)}function Oi(t,e){return An(e,(function(e){return wl(t[e])}))}function Di(t,e){e=Ho(e,t);var n=0,r=e.length;while(null!=t&&n<r)t=t[Rs(e[n++])];return n&&n==r?t:o}function Ni(t,e,n){var r=e(t);return cl(t)?r:Mn(r,n(t))}function zi(t){return null==t?t===o?ct:et:Me&&Me in re(t)?Ya(t):xs(t)}function Fi(t,e){return t>e}function Bi(t,e){return null!=t&&fe.call(t,e)}function Ui(t,e){return null!=t&&e in re(t)}function ji(t,e,n){return t>=Ze(e,n)&&t<je(e,n)}function Zi(t,e,r){var i=r?Cn:Tn,a=t[0].length,s=t.length,u=s,c=n(s),l=1/0,h=[];while(u--){var f=t[u];u&&e&&(f=kn(f,Kn(e))),l=Ze(f.length,l),c[u]=!r&&(e||a>=120&&f.length>=120)?new Kr(u&&f):o}f=t[0];var p=-1,d=c[0];t:while(++p<a&&h.length<l){var v=f[p],m=e?e(v):v;if(v=r||0!==v?v:0,!(d?Jn(d,m):i(h,m,r))){u=s;while(--u){var g=c[u];if(!(g?Jn(g,m):i(t[u],m,r)))continue t}d&&d.push(m),h.push(v)}}return h}function Vi(t,e,n,r){return Ri(t,(function(t,i,o){e(r,n(t),i,o)})),r}function Gi(t,e,n){e=Ho(e,t),t=ws(t,e);var r=null==t?t:t[Rs(au(e))];return null==r?o:xn(r,t,n)}function Hi(t){return Tl(t)&&zi(t)==G}function Wi(t){return Tl(t)&&zi(t)==ft}function qi(t){return Tl(t)&&zi(t)==X}function Xi(t,e,n,r,i){return t===e||(null==t||null==e||!Tl(t)&&!Tl(e)?t!==t&&e!==e:Yi(t,e,n,r,Xi,i))}function Yi(t,e,n,r,i,o){var a=cl(t),s=cl(e),u=a?H:Ja(t),c=s?H:Ja(e);u=u==G?nt:u,c=c==G?nt:c;var l=u==nt,h=c==nt,f=u==c;if(f&&dl(t)){if(!dl(e))return!1;a=!0,l=!1}if(f&&!l)return o||(o=new $r),a||jl(t)?Na(t,e,n,r,i,o):za(t,e,u,n,r,i,o);if(!(n&g)){var p=l&&fe.call(t,"__wrapped__"),d=h&&fe.call(e,"__wrapped__");if(p||d){var v=p?t.value():t,m=d?e.value():e;return o||(o=new $r),i(v,m,n,r,o)}}return!!f&&(o||(o=new $r),Fa(t,e,n,r,i,o))}function Ki(t){return Tl(t)&&Ja(t)==$}function Qi(t,e,n,r){var i=n.length,a=i,s=!r;if(null==t)return!a;t=re(t);while(i--){var u=n[i];if(s&&u[2]?u[1]!==t[u[0]]:!(u[0]in t))return!1}while(++i<a){u=n[i];var c=u[0],l=t[c],h=u[1];if(s&&u[2]){if(l===o&&!(c in t))return!1}else{var f=new $r;if(r)var p=r(l,h,c,t,e,f);if(!(p===o?Xi(h,l,g|y,r,f):p))return!1}}return!0}function Ji(t){if(!Al(t)||fs(t))return!1;var e=wl(t)?ye:Kt;return e.test(Ls(t))}function $i(t){return Tl(t)&&zi(t)==ot}function to(t){return Tl(t)&&Ja(t)==at}function eo(t){return Tl(t)&&Sl(t.length)&&!!Qe[zi(t)]}function no(t){return"function"==typeof t?t:null==t?Rf:"object"==i(t)?cl(t)?uo(t[0],t[1]):so(t):Hf(t)}function ro(t){if(!ds(t))return Ue(t);var e=[];for(var n in re(t))fe.call(t,n)&&"constructor"!=n&&e.push(n);return e}function io(t){if(!Al(t))return _s(t);var e=ds(t),n=[];for(var r in t)("constructor"!=r||!e&&fe.call(t,r))&&n.push(r);return n}function oo(t,e){return t<e}function ao(t,e){var r=-1,i=hl(t)?n(t.length):[];return Ei(t,(function(t,n,o){i[++r]=e(t,n,o)})),i}function so(t){var e=qa(t);return 1==e.length&&e[0][2]?ms(e[0][0],e[0][1]):function(n){return n===t||Qi(n,t,e)}}function uo(t,e){return cs(t)&&vs(e)?ms(Rs(t),e):function(n){var r=gh(n,t);return r===o&&r===e?_h(n,t):Xi(e,r,g|y)}}function co(t,e,n,r,i){t!==e&&Pi(e,(function(a,s){if(i||(i=new $r),Al(a))lo(t,e,s,n,co,r,i);else{var u=r?r(Ss(t,s),a,s+"",t,e,i):o;u===o&&(u=a),ci(t,s,u)}}),Sh)}function lo(t,e,n,r,i,a,s){var u=Ss(t,n),c=Ss(e,n),l=s.get(c);if(l)ci(t,n,l);else{var h=a?a(u,c,n+"",t,e,s):o,f=h===o;if(f){var p=cl(c),d=!p&&dl(c),v=!p&&!d&&jl(c);h=c,p||d||v?cl(u)?h=u:fl(u)?h=oa(u):d?(f=!1,h=Yo(c,!0)):v?(f=!1,h=ta(c,!0)):h=[]:Dl(c)||ul(c)?(h=u,ul(u)?h=Jl(u):Al(u)&&!wl(u)||(h=rs(c))):f=!1}f&&(s.set(c,h),i(h,c,r,a,s),s["delete"](c)),ci(t,n,h)}}function ho(t,e){var n=t.length;if(n)return e+=e<0?n:0,ss(e,n)?t[e]:o}function fo(t,e,n){e=e.length?kn(e,(function(t){return cl(t)?function(e){return Di(e,1===t.length?t[0]:t)}:t})):[Rf];var r=-1;e=kn(e,Kn(Ha()));var i=ao(t,(function(t,n,i){var o=kn(e,(function(e){return e(t)}));return{criteria:o,index:++r,value:t}}));return Hn(i,(function(t,e){return na(t,e,n)}))}function po(t,e){return vo(t,e,(function(e,n){return _h(t,n)}))}function vo(t,e,n){var r=-1,i=e.length,o={};while(++r<i){var a=e[r],s=Di(t,a);n(s,a)&&Ao(o,Ho(a,t),s)}return o}function mo(t){return function(e){return Di(e,t)}}function go(t,e,n,r){var i=r?Bn:Fn,o=-1,a=e.length,s=t;t===e&&(e=oa(e)),n&&(s=kn(t,Kn(n)));while(++o<a){var u=0,c=e[o],l=n?n(c):c;while((u=i(s,l,u,r))>-1)s!==t&&Te.call(s,u,1),Te.call(t,u,1)}return t}function yo(t,e){var n=t?e.length:0,r=n-1;while(n--){var i=e[n];if(n==r||i!==o){var o=i;ss(i)?Te.call(t,i,1):zo(t,i)}}return t}function _o(t,e){return t+De(qe()*(e-t+1))}function xo(t,e,r,i){var o=-1,a=je(Oe((e-t)/(r||1)),0),s=n(a);while(a--)s[i?a:++o]=t,t+=r;return s}function bo(t,e){var n="";if(!t||e<1||e>z)return n;do{e%2&&(n+=t),e=De(e/2),e&&(t+=t)}while(e);return n}function wo(t,e){return Cs(bs(t,e,Rf),t+"")}function Eo(t){return ai(Zh(t))}function So(t,e){var n=Zh(t);return Ps(n,gi(e,0,n.length))}function Ao(t,e,n,r){if(!Al(t))return t;e=Ho(e,t);var i=-1,a=e.length,s=a-1,u=t;while(null!=u&&++i<a){var c=Rs(e[i]),l=n;if("__proto__"===c||"constructor"===c||"prototype"===c)return t;if(i!=s){var h=u[c];l=r?r(h,c,u):o,l===o&&(l=Al(h)?h:ss(e[i+1])?[]:{})}li(u,c,l),u=u[c]}return t}var To=cn?function(t,e){return cn.set(t,e),t}:Rf,Co=Pe?function(t,e){return Pe(t,"toString",{configurable:!0,enumerable:!1,value:kf(e),writable:!0})}:Rf;function ko(t){return Ps(Zh(t))}function Mo(t,e,r){var i=-1,o=t.length;e<0&&(e=-e>o?0:o+e),r=r>o?o:r,r<0&&(r+=o),o=e>r?0:r-e>>>0,e>>>=0;var a=n(o);while(++i<o)a[i]=t[i+e];return a}function Po(t,e){var n;return Ei(t,(function(t,r,i){return n=e(t,r,i),!n})),!!n}function Io(t,e,n){var r=0,i=null==t?r:t.length;if("number"==typeof e&&e===e&&i<=Z){while(r<i){var o=r+i>>>1,a=t[o];null!==a&&!Ul(a)&&(n?a<=e:a<e)?r=o+1:i=o}return i}return Ro(t,e,Rf,n)}function Ro(t,e,n,r){var i=0,a=null==t?0:t.length;if(0===a)return 0;e=n(e);var s=e!==e,u=null===e,c=Ul(e),l=e===o;while(i<a){var h=De((i+a)/2),f=n(t[h]),p=f!==o,d=null===f,v=f===f,m=Ul(f);if(s)var g=r||v;else g=l?v&&(r||p):u?v&&p&&(r||!d):c?v&&p&&!d&&(r||!m):!d&&!m&&(r?f<=e:f<e);g?i=h+1:a=h}return Ze(a,j)}function Lo(t,e){var n=-1,r=t.length,i=0,o=[];while(++n<r){var a=t[n],s=e?e(a):a;if(!n||!ol(s,u)){var u=s;o[i++]=0===a?0:a}}return o}function Oo(t){return"number"==typeof t?t:Ul(t)?B:+t}function Do(t){if("string"==typeof t)return t;if(cl(t))return kn(t,Do)+"";if(Ul(t))return br?br.call(t):"";var e=t+"";return"0"==e&&1/t==-N?"-0":e}function No(t,e,n){var r=-1,i=Tn,o=t.length,a=!0,u=[],c=u;if(n)a=!1,i=Cn;else if(o>=s){var l=e?null:Pa(t);if(l)return fr(l);a=!1,i=Jn,c=new Kr}else c=e?[]:u;t:while(++r<o){var h=t[r],f=e?e(h):h;if(h=n||0!==h?h:0,a&&f===f){var p=c.length;while(p--)if(c[p]===f)continue t;e&&c.push(f),u.push(h)}else i(c,f,n)||(c!==u&&c.push(f),u.push(h))}return u}function zo(t,e){return e=Ho(e,t),t=ws(t,e),null==t||delete t[Rs(au(e))]}function Fo(t,e,n,r){return Ao(t,e,n(Di(t,e)),r)}function Bo(t,e,n,r){var i=t.length,o=r?i:-1;while((r?o--:++o<i)&&e(t[o],o,t));return n?Mo(t,r?0:o,r?o+1:i):Mo(t,r?o+1:0,r?i:o)}function Uo(t,e){var n=t;return n instanceof kr&&(n=n.value()),Pn(e,(function(t,e){return e.func.apply(e.thisArg,Mn([t],e.args))}),n)}function jo(t,e,r){var i=t.length;if(i<2)return i?No(t[0]):[];var o=-1,a=n(i);while(++o<i){var s=t[o],u=-1;while(++u<i)u!=o&&(a[o]=wi(a[o]||s,t[u],e,r))}return No(Mi(a,1),e,r)}function Zo(t,e,n){var r=-1,i=t.length,a=e.length,s={};while(++r<i){var u=r<a?e[r]:o;n(s,t[r],u)}return s}function Vo(t){return fl(t)?t:[]}function Go(t){return"function"==typeof t?t:Rf}function Ho(t,e){return cl(t)?t:cs(t,e)?[t]:Is(th(t))}var Wo=wo;function qo(t,e,n){var r=t.length;return n=n===o?r:n,!e&&n>=r?t:Mo(t,e,n)}var Xo=Ie||function(t){return un.clearTimeout(t)};function Yo(t,e){if(e)return t.slice();var n=t.length,r=we?we(n):new t.constructor(n);return t.copy(r),r}function Ko(t){var e=new t.constructor(t.byteLength);return new be(e).set(new be(t)),e}function Qo(t,e){var n=e?Ko(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.byteLength)}function Jo(t){var e=new t.constructor(t.source,qt.exec(t));return e.lastIndex=t.lastIndex,e}function $o(t){return xr?re(xr.call(t)):{}}function ta(t,e){var n=e?Ko(t.buffer):t.buffer;return new t.constructor(n,t.byteOffset,t.length)}function ea(t,e){if(t!==e){var n=t!==o,r=null===t,i=t===t,a=Ul(t),s=e!==o,u=null===e,c=e===e,l=Ul(e);if(!u&&!l&&!a&&t>e||a&&s&&c&&!u&&!l||r&&s&&c||!n&&c||!i)return 1;if(!r&&!a&&!l&&t<e||l&&n&&i&&!r&&!a||u&&n&&i||!s&&i||!c)return-1}return 0}function na(t,e,n){var r=-1,i=t.criteria,o=e.criteria,a=i.length,s=n.length;while(++r<a){var u=ea(i[r],o[r]);if(u){if(r>=s)return u;var c=n[r];return u*("desc"==c?-1:1)}}return t.index-e.index}function ra(t,e,r,i){var o=-1,a=t.length,s=r.length,u=-1,c=e.length,l=je(a-s,0),h=n(c+l),f=!i;while(++u<c)h[u]=e[u];while(++o<s)(f||o<a)&&(h[r[o]]=t[o]);while(l--)h[u++]=t[o++];return h}function ia(t,e,r,i){var o=-1,a=t.length,s=-1,u=r.length,c=-1,l=e.length,h=je(a-u,0),f=n(h+l),p=!i;while(++o<h)f[o]=t[o];var d=o;while(++c<l)f[d+c]=e[c];while(++s<u)(p||o<a)&&(f[d+r[s]]=t[o++]);return f}function oa(t,e){var r=-1,i=t.length;e||(e=n(i));while(++r<i)e[r]=t[r];return e}function aa(t,e,n,r){var i=!n;n||(n={});var a=-1,s=e.length;while(++a<s){var u=e[a],c=r?r(n[u],t[u],u,n,t):o;c===o&&(c=t[u]),i?vi(n,u,c):li(n,u,c)}return n}function sa(t,e){return aa(t,Ka(t),e)}function ua(t,e){return aa(t,Qa(t),e)}function ca(t,e){return function(n,r){var i=cl(n)?bn:fi,o=e?e():{};return i(n,t,Ha(r,2),o)}}function la(t){return wo((function(e,n){var r=-1,i=n.length,a=i>1?n[i-1]:o,s=i>2?n[2]:o;a=t.length>3&&"function"==typeof a?(i--,a):o,s&&us(n[0],n[1],s)&&(a=i<3?o:a,i=1),e=re(e);while(++r<i){var u=n[r];u&&t(e,u,r,a)}return e}))}function ha(t,e){return function(n,r){if(null==n)return n;if(!hl(n))return t(n,r);var i=n.length,o=e?i:-1,a=re(n);while(e?o--:++o<i)if(!1===r(a[o],o,a))break;return n}}function fa(t){return function(e,n,r){var i=-1,o=re(e),a=r(e),s=a.length;while(s--){var u=a[t?s:++i];if(!1===n(o[u],u,o))break}return e}}function pa(t,e,n){var r=e&_,i=ma(t);function o(){var e=this&&this!==un&&this instanceof o?i:t;return e.apply(r?n:this,arguments)}return o}function da(t){return function(e){e=th(e);var n=ar(e)?gr(e):o,r=n?n[0]:e.charAt(0),i=n?qo(n,1).join(""):e.slice(1);return r[t]()+i}}function va(t){return function(e){return Pn(Ef(Yh(e).replace(Ve,"")),t,"")}}function ma(t){return function(){var e=arguments;switch(e.length){case 0:return new t;case 1:return new t(e[0]);case 2:return new t(e[0],e[1]);case 3:return new t(e[0],e[1],e[2]);case 4:return new t(e[0],e[1],e[2],e[3]);case 5:return new t(e[0],e[1],e[2],e[3],e[4]);case 6:return new t(e[0],e[1],e[2],e[3],e[4],e[5]);case 7:return new t(e[0],e[1],e[2],e[3],e[4],e[5],e[6])}var n=Ar(t.prototype),r=t.apply(n,e);return Al(r)?r:n}}function ga(t,e,r){var i=ma(t);function a(){var s=arguments.length,u=n(s),c=s,l=Ga(a);while(c--)u[c]=arguments[c];var h=s<3&&u[0]!==l&&u[s-1]!==l?[]:hr(u,l);if(s-=h.length,s<r)return ka(t,e,xa,a.placeholder,o,u,h,o,o,r-s);var f=this&&this!==un&&this instanceof a?i:t;return xn(f,this,u)}return a}function ya(t){return function(e,n,r){var i=re(e);if(!hl(e)){var a=Ha(n,3);e=Eh(e),n=function(t){return a(i[t],t,i)}}var s=t(e,n,r);return s>-1?i[a?e[s]:s]:o}}function _a(t){return Ba((function(e){var n=e.length,r=n,i=Cr.prototype.thru;t&&e.reverse();while(r--){var a=e[r];if("function"!=typeof a)throw new ae(c);if(i&&!s&&"wrapper"==Va(a))var s=new Cr([],!0)}r=s?r:n;while(++r<n){a=e[r];var u=Va(a),l="wrapper"==u?Za(a):o;s=l&&hs(l[0])&&l[1]==(T|w|S|C)&&!l[4].length&&1==l[9]?s[Va(l[0])].apply(s,l[3]):1==a.length&&hs(a)?s[u]():s.thru(a)}return function(){var t=arguments,r=t[0];if(s&&1==t.length&&cl(r))return s.plant(r).value();var i=0,o=n?e[i].apply(this,t):r;while(++i<n)o=e[i].call(this,o);return o}}))}function xa(t,e,r,i,a,s,u,c,l,h){var f=e&T,p=e&_,d=e&x,v=e&(w|E),m=e&k,g=d?o:ma(t);function y(){var o=arguments.length,_=n(o),x=o;while(x--)_[x]=arguments[x];if(v)var b=Ga(y),w=er(_,b);if(i&&(_=ra(_,i,a,v)),s&&(_=ia(_,s,u,v)),o-=w,v&&o<h){var E=hr(_,b);return ka(t,e,xa,y.placeholder,r,_,E,c,l,h-o)}var S=p?r:this,A=d?S[t]:t;return o=_.length,c?_=Es(_,c):m&&o>1&&_.reverse(),f&&l<o&&(_.length=l),this&&this!==un&&this instanceof y&&(A=g||ma(A)),A.apply(S,_)}return y}function ba(t,e){return function(n,r){return Vi(n,t,e(r),{})}}function wa(t,e){return function(n,r){var i;if(n===o&&r===o)return e;if(n!==o&&(i=n),r!==o){if(i===o)return r;"string"==typeof n||"string"==typeof r?(n=Do(n),r=Do(r)):(n=Oo(n),r=Oo(r)),i=t(n,r)}return i}}function Ea(t){return Ba((function(e){return e=kn(e,Kn(Ha())),wo((function(n){var r=this;return t(e,(function(t){return xn(t,r,n)}))}))}))}function Sa(t,e){e=e===o?" ":Do(e);var n=e.length;if(n<2)return n?bo(e,t):e;var r=bo(e,Oe(t/mr(e)));return ar(e)?qo(gr(r),0,t).join(""):r.slice(0,t)}function Aa(t,e,r,i){var o=e&_,a=ma(t);function s(){var e=-1,u=arguments.length,c=-1,l=i.length,h=n(l+u),f=this&&this!==un&&this instanceof s?a:t;while(++c<l)h[c]=i[c];while(u--)h[c++]=arguments[++e];return xn(f,o?r:this,h)}return s}function Ta(t){return function(e,n,r){return r&&"number"!=typeof r&&us(e,n,r)&&(n=r=o),e=Xl(e),n===o?(n=e,e=0):n=Xl(n),r=r===o?e<n?1:-1:Xl(r),xo(e,n,r,t)}}function Ca(t){return function(e,n){return"string"==typeof e&&"string"==typeof n||(e=Ql(e),n=Ql(n)),t(e,n)}}function ka(t,e,n,r,i,a,s,u,c,l){var h=e&w,f=h?s:o,p=h?o:s,d=h?a:o,v=h?o:a;e|=h?S:A,e&=~(h?A:S),e&b||(e&=~(_|x));var m=[t,e,i,d,f,v,p,u,c,l],g=n.apply(o,m);return hs(t)&&As(g,m),g.placeholder=r,ks(g,t,e)}function Ma(t){var e=ne[t];return function(t,n){if(t=Ql(t),n=null==n?0:Ze(Yl(n),292),n&&Fe(t)){var r=(th(t)+"e").split("e"),i=e(r[0]+"e"+(+r[1]+n));return r=(th(i)+"e").split("e"),+(r[0]+"e"+(+r[1]-n))}return e(t)}}var Pa=nn&&1/fr(new nn([,-0]))[1]==N?function(t){return new nn(t)}:Uf;function Ia(t){return function(e){var n=Ja(e);return n==$?cr(e):n==at?pr(e):Xn(e,t(e))}}function Ra(t,e,n,r,i,a,s,u){var l=e&x;if(!l&&"function"!=typeof t)throw new ae(c);var h=r?r.length:0;if(h||(e&=~(S|A),r=i=o),s=s===o?s:je(Yl(s),0),u=u===o?u:Yl(u),h-=i?i.length:0,e&A){var f=r,p=i;r=i=o}var d=l?o:Za(t),v=[t,e,n,r,i,f,p,a,s,u];if(d&&ys(v,d),t=v[0],e=v[1],n=v[2],r=v[3],i=v[4],u=v[9]=v[9]===o?l?0:t.length:je(v[9]-h,0),!u&&e&(w|E)&&(e&=~(w|E)),e&&e!=_)m=e==w||e==E?ga(t,e,u):e!=S&&e!=(_|S)||i.length?xa.apply(o,v):Aa(t,e,n,r);else var m=pa(t,e,n);var g=d?To:As;return ks(g(m,v),t,e)}function La(t,e,n,r){return t===o||ol(t,ce[n])&&!fe.call(r,n)?e:t}function Oa(t,e,n,r,i,a){return Al(t)&&Al(e)&&(a.set(e,t),co(t,e,o,Oa,a),a["delete"](e)),t}function Da(t){return Dl(t)?o:t}function Na(t,e,n,r,i,a){var s=n&g,u=t.length,c=e.length;if(u!=c&&!(s&&c>u))return!1;var l=a.get(t),h=a.get(e);if(l&&h)return l==e&&h==t;var f=-1,p=!0,d=n&y?new Kr:o;a.set(t,e),a.set(e,t);while(++f<u){var v=t[f],m=e[f];if(r)var _=s?r(m,v,f,e,t,a):r(v,m,f,t,e,a);if(_!==o){if(_)continue;p=!1;break}if(d){if(!Rn(e,(function(t,e){if(!Jn(d,e)&&(v===t||i(v,t,n,r,a)))return d.push(e)}))){p=!1;break}}else if(v!==m&&!i(v,m,n,r,a)){p=!1;break}}return a["delete"](t),a["delete"](e),p}function za(t,e,n,r,i,o,a){switch(n){case pt:if(t.byteLength!=e.byteLength||t.byteOffset!=e.byteOffset)return!1;t=t.buffer,e=e.buffer;case ft:return!(t.byteLength!=e.byteLength||!o(new be(t),new be(e)));case q:case X:case tt:return ol(+t,+e);case K:return t.name==e.name&&t.message==e.message;case ot:case st:return t==e+"";case $:var s=cr;case at:var u=r&g;if(s||(s=fr),t.size!=e.size&&!u)return!1;var c=a.get(t);if(c)return c==e;r|=y,a.set(t,e);var l=Na(s(t),s(e),r,i,o,a);return a["delete"](t),l;case ut:if(xr)return xr.call(t)==xr.call(e)}return!1}function Fa(t,e,n,r,i,a){var s=n&g,u=Ua(t),c=u.length,l=Ua(e),h=l.length;if(c!=h&&!s)return!1;var f=c;while(f--){var p=u[f];if(!(s?p in e:fe.call(e,p)))return!1}var d=a.get(t),v=a.get(e);if(d&&v)return d==e&&v==t;var m=!0;a.set(t,e),a.set(e,t);var y=s;while(++f<c){p=u[f];var _=t[p],x=e[p];if(r)var b=s?r(x,_,p,e,t,a):r(_,x,p,t,e,a);if(!(b===o?_===x||i(_,x,n,r,a):b)){m=!1;break}y||(y="constructor"==p)}if(m&&!y){var w=t.constructor,E=e.constructor;w==E||!("constructor"in t)||!("constructor"in e)||"function"==typeof w&&w instanceof w&&"function"==typeof E&&E instanceof E||(m=!1)}return a["delete"](t),a["delete"](e),m}function Ba(t){return Cs(bs(t,o,Ys),t+"")}function Ua(t){return Ni(t,Eh,Ka)}function ja(t){return Ni(t,Sh,Qa)}var Za=cn?function(t){return cn.get(t)}:Uf;function Va(t){var e=t.name+"",n=ln[e],r=fe.call(ln,e)?n.length:0;while(r--){var i=n[r],o=i.func;if(null==o||o==t)return i.name}return e}function Ga(t){var e=fe.call(Er,"placeholder")?Er:t;return e.placeholder}function Ha(){var t=Er.iteratee||Lf;return t=t===Lf?no:t,arguments.length?t(arguments[0],arguments[1]):t}function Wa(t,e){var n=t.__data__;return ls(e)?n["string"==typeof e?"string":"hash"]:n.map}function qa(t){var e=Eh(t),n=e.length;while(n--){var r=e[n],i=t[r];e[n]=[r,i,vs(i)]}return e}function Xa(t,e){var n=or(t,e);return Ji(n)?n:o}function Ya(t){var e=fe.call(t,Me),n=t[Me];try{t[Me]=o;var r=!0}catch(a){}var i=ve.call(t);return r&&(e?t[Me]=n:delete t[Me]),i}var Ka=Ne?function(t){return null==t?[]:(t=re(t),An(Ne(t),(function(e){return Ae.call(t,e)})))}:Yf,Qa=Ne?function(t){var e=[];while(t)Mn(e,Ka(t)),t=Ee(t);return e}:Yf,Ja=zi;function $a(t,e,n){var r=-1,i=n.length;while(++r<i){var o=n[r],a=o.size;switch(o.type){case"drop":t+=a;break;case"dropRight":e-=a;break;case"take":e=Ze(e,t+a);break;case"takeRight":t=je(t,e-a);break}}return{start:t,end:e}}function ts(t){var e=t.match(jt);return e?e[1].split(Zt):[]}function es(t,e,n){e=Ho(e,t);var r=-1,i=e.length,o=!1;while(++r<i){var a=Rs(e[r]);if(!(o=null!=t&&n(t,a)))break;t=t[a]}return o||++r!=i?o:(i=null==t?0:t.length,!!i&&Sl(i)&&ss(a,i)&&(cl(t)||ul(t)))}function ns(t){var e=t.length,n=new t.constructor(e);return e&&"string"==typeof t[0]&&fe.call(t,"index")&&(n.index=t.index,n.input=t.input),n}function rs(t){return"function"!=typeof t.constructor||ds(t)?{}:Ar(Ee(t))}function is(t,e,n){var r=t.constructor;switch(e){case ft:return Ko(t);case q:case X:return new r(+t);case pt:return Qo(t,n);case dt:case vt:case mt:case gt:case yt:case _t:case xt:case bt:case wt:return ta(t,n);case $:return new r;case tt:case st:return new r(t);case ot:return Jo(t);case at:return new r;case ut:return $o(t)}}function os(t,e){var n=e.length;if(!n)return t;var r=n-1;return e[r]=(n>1?"& ":"")+e[r],e=e.join(n>2?", ":" "),t.replace(Ut,"{\n/* [wrapped with "+e+"] */\n")}function as(t){return cl(t)||ul(t)||!!(Ce&&t&&t[Ce])}function ss(t,e){var n=i(t);return e=null==e?z:e,!!e&&("number"==n||"symbol"!=n&&Jt.test(t))&&t>-1&&t%1==0&&t<e}function us(t,e,n){if(!Al(n))return!1;var r=i(e);return!!("number"==r?hl(n)&&ss(e,n.length):"string"==r&&e in n)&&ol(n[e],t)}function cs(t,e){if(cl(t))return!1;var n=i(t);return!("number"!=n&&"symbol"!=n&&"boolean"!=n&&null!=t&&!Ul(t))||(Ot.test(t)||!Lt.test(t)||null!=e&&t in re(e))}function ls(t){var e=i(t);return"string"==e||"number"==e||"symbol"==e||"boolean"==e?"__proto__"!==t:null===t}function hs(t){var e=Va(t),n=Er[e];if("function"!=typeof n||!(e in kr.prototype))return!1;if(t===n)return!0;var r=Za(n);return!!r&&t===r[0]}function fs(t){return!!de&&de in t}($e&&Ja(new $e(new ArrayBuffer(1)))!=pt||tn&&Ja(new tn)!=$||en&&Ja(en.resolve())!=rt||nn&&Ja(new nn)!=at||an&&Ja(new an)!=lt)&&(Ja=function(t){var e=zi(t),n=e==nt?t.constructor:o,r=n?Ls(n):"";if(r)switch(r){case fn:return pt;case pn:return $;case Ln:return rt;case On:return at;case Vn:return lt}return e});var ps=le?wl:Kf;function ds(t){var e=t&&t.constructor,n="function"==typeof e&&e.prototype||ce;return t===n}function vs(t){return t===t&&!Al(t)}function ms(t,e){return function(n){return null!=n&&(n[t]===e&&(e!==o||t in re(n)))}}function gs(t){var e=jc(t,(function(t){return n.size===f&&n.clear(),t})),n=e.cache;return e}function ys(t,e){var n=t[1],r=e[1],i=n|r,o=i<(_|x|T),a=r==T&&n==w||r==T&&n==C&&t[7].length<=e[8]||r==(T|C)&&e[7].length<=e[8]&&n==w;if(!o&&!a)return t;r&_&&(t[2]=e[2],i|=n&_?0:b);var s=e[3];if(s){var u=t[3];t[3]=u?ra(u,s,e[4]):s,t[4]=u?hr(t[3],p):e[4]}return s=e[5],s&&(u=t[5],t[5]=u?ia(u,s,e[6]):s,t[6]=u?hr(t[5],p):e[6]),s=e[7],s&&(t[7]=s),r&T&&(t[8]=null==t[8]?e[8]:Ze(t[8],e[8])),null==t[9]&&(t[9]=e[9]),t[0]=e[0],t[1]=i,t}function _s(t){var e=[];if(null!=t)for(var n in re(t))e.push(n);return e}function xs(t){return ve.call(t)}function bs(t,e,r){return e=je(e===o?t.length-1:e,0),function(){var i=arguments,o=-1,a=je(i.length-e,0),s=n(a);while(++o<a)s[o]=i[e+o];o=-1;var u=n(e+1);while(++o<e)u[o]=i[o];return u[e]=r(s),xn(t,this,u)}}function ws(t,e){return e.length<2?t:Di(t,Mo(e,0,-1))}function Es(t,e){var n=t.length,r=Ze(e.length,n),i=oa(t);while(r--){var a=e[r];t[r]=ss(a,n)?i[a]:o}return t}function Ss(t,e){if(("constructor"!==e||"function"!==typeof t[e])&&"__proto__"!=e)return t[e]}var As=Ms(To),Ts=Le||function(t,e){return un.setTimeout(t,e)},Cs=Ms(Co);function ks(t,e,n){var r=e+"";return Cs(t,os(r,Os(ts(r),n)))}function Ms(t){var e=0,n=0;return function(){var r=He(),i=R-(r-n);if(n=r,i>0){if(++e>=I)return arguments[0]}else e=0;return t.apply(o,arguments)}}function Ps(t,e){var n=-1,r=t.length,i=r-1;e=e===o?r:e;while(++n<e){var a=_o(n,i),s=t[a];t[a]=t[n],t[n]=s}return t.length=e,t}var Is=gs((function(t){var e=[];return 46===t.charCodeAt(0)&&e.push(""),t.replace(Dt,(function(t,n,r,i){e.push(r?i.replace(Ht,"$1"):n||t)})),e}));function Rs(t){if("string"==typeof t||Ul(t))return t;var e=t+"";return"0"==e&&1/t==-N?"-0":e}function Ls(t){if(null!=t){try{return he.call(t)}catch(e){}try{return t+""}catch(e){}}return""}function Os(t,e){return wn(V,(function(n){var r="_."+n[0];e&n[1]&&!Tn(t,r)&&t.push(r)})),t.sort()}function Ds(t){if(t instanceof kr)return t.clone();var e=new Cr(t.__wrapped__,t.__chain__);return e.__actions__=oa(t.__actions__),e.__index__=t.__index__,e.__values__=t.__values__,e}function Ns(t,e,r){e=(r?us(t,e,r):e===o)?1:je(Yl(e),0);var i=null==t?0:t.length;if(!i||e<1)return[];var a=0,s=0,u=n(Oe(i/e));while(a<i)u[s++]=Mo(t,a,a+=e);return u}function zs(t){var e=-1,n=null==t?0:t.length,r=0,i=[];while(++e<n){var o=t[e];o&&(i[r++]=o)}return i}function Fs(){var t=arguments.length;if(!t)return[];var e=n(t-1),r=arguments[0],i=t;while(i--)e[i-1]=arguments[i];return Mn(cl(r)?oa(r):[r],Mi(e,1))}var Bs=wo((function(t,e){return fl(t)?wi(t,Mi(e,1,fl,!0)):[]})),Us=wo((function(t,e){var n=au(e);return fl(n)&&(n=o),fl(t)?wi(t,Mi(e,1,fl,!0),Ha(n,2)):[]})),js=wo((function(t,e){var n=au(e);return fl(n)&&(n=o),fl(t)?wi(t,Mi(e,1,fl,!0),o,n):[]}));function Zs(t,e,n){var r=null==t?0:t.length;return r?(e=n||e===o?1:Yl(e),Mo(t,e<0?0:e,r)):[]}function Vs(t,e,n){var r=null==t?0:t.length;return r?(e=n||e===o?1:Yl(e),e=r-e,Mo(t,0,e<0?0:e)):[]}function Gs(t,e){return t&&t.length?Bo(t,Ha(e,3),!0,!0):[]}function Hs(t,e){return t&&t.length?Bo(t,Ha(e,3),!0):[]}function Ws(t,e,n,r){var i=null==t?0:t.length;return i?(n&&"number"!=typeof n&&us(t,e,n)&&(n=0,r=i),Ci(t,e,n,r)):[]}function qs(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Yl(n);return i<0&&(i=je(r+i,0)),zn(t,Ha(e,3),i)}function Xs(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r-1;return n!==o&&(i=Yl(n),i=n<0?je(r+i,0):Ze(i,r-1)),zn(t,Ha(e,3),i,!0)}function Ys(t){var e=null==t?0:t.length;return e?Mi(t,1):[]}function Ks(t){var e=null==t?0:t.length;return e?Mi(t,N):[]}function Qs(t,e){var n=null==t?0:t.length;return n?(e=e===o?1:Yl(e),Mi(t,e)):[]}function Js(t){var e=-1,n=null==t?0:t.length,r={};while(++e<n){var i=t[e];r[i[0]]=i[1]}return r}function $s(t){return t&&t.length?t[0]:o}function tu(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=null==n?0:Yl(n);return i<0&&(i=je(r+i,0)),Fn(t,e,i)}function eu(t){var e=null==t?0:t.length;return e?Mo(t,0,-1):[]}var nu=wo((function(t){var e=kn(t,Vo);return e.length&&e[0]===t[0]?Zi(e):[]})),ru=wo((function(t){var e=au(t),n=kn(t,Vo);return e===au(n)?e=o:n.pop(),n.length&&n[0]===t[0]?Zi(n,Ha(e,2)):[]})),iu=wo((function(t){var e=au(t),n=kn(t,Vo);return e="function"==typeof e?e:o,e&&n.pop(),n.length&&n[0]===t[0]?Zi(n,o,e):[]}));function ou(t,e){return null==t?"":Be.call(t,e)}function au(t){var e=null==t?0:t.length;return e?t[e-1]:o}function su(t,e,n){var r=null==t?0:t.length;if(!r)return-1;var i=r;return n!==o&&(i=Yl(n),i=i<0?je(r+i,0):Ze(i,r-1)),e===e?vr(t,e,i):zn(t,Un,i,!0)}function uu(t,e){return t&&t.length?ho(t,Yl(e)):o}var cu=wo(lu);function lu(t,e){return t&&t.length&&e&&e.length?go(t,e):t}function hu(t,e,n){return t&&t.length&&e&&e.length?go(t,e,Ha(n,2)):t}function fu(t,e,n){return t&&t.length&&e&&e.length?go(t,e,o,n):t}var pu=Ba((function(t,e){var n=null==t?0:t.length,r=mi(t,e);return yo(t,kn(e,(function(t){return ss(t,n)?+t:t})).sort(ea)),r}));function du(t,e){var n=[];if(!t||!t.length)return n;var r=-1,i=[],o=t.length;e=Ha(e,3);while(++r<o){var a=t[r];e(a,r,t)&&(n.push(a),i.push(r))}return yo(t,i),n}function vu(t){return null==t?t:Xe.call(t)}function mu(t,e,n){var r=null==t?0:t.length;return r?(n&&"number"!=typeof n&&us(t,e,n)?(e=0,n=r):(e=null==e?0:Yl(e),n=n===o?r:Yl(n)),Mo(t,e,n)):[]}function gu(t,e){return Io(t,e)}function yu(t,e,n){return Ro(t,e,Ha(n,2))}function _u(t,e){var n=null==t?0:t.length;if(n){var r=Io(t,e);if(r<n&&ol(t[r],e))return r}return-1}function xu(t,e){return Io(t,e,!0)}function bu(t,e,n){return Ro(t,e,Ha(n,2),!0)}function wu(t,e){var n=null==t?0:t.length;if(n){var r=Io(t,e,!0)-1;if(ol(t[r],e))return r}return-1}function Eu(t){return t&&t.length?Lo(t):[]}function Su(t,e){return t&&t.length?Lo(t,Ha(e,2)):[]}function Au(t){var e=null==t?0:t.length;return e?Mo(t,1,e):[]}function Tu(t,e,n){return t&&t.length?(e=n||e===o?1:Yl(e),Mo(t,0,e<0?0:e)):[]}function Cu(t,e,n){var r=null==t?0:t.length;return r?(e=n||e===o?1:Yl(e),e=r-e,Mo(t,e<0?0:e,r)):[]}function ku(t,e){return t&&t.length?Bo(t,Ha(e,3),!1,!0):[]}function Mu(t,e){return t&&t.length?Bo(t,Ha(e,3)):[]}var Pu=wo((function(t){return No(Mi(t,1,fl,!0))})),Iu=wo((function(t){var e=au(t);return fl(e)&&(e=o),No(Mi(t,1,fl,!0),Ha(e,2))})),Ru=wo((function(t){var e=au(t);return e="function"==typeof e?e:o,No(Mi(t,1,fl,!0),o,e)}));function Lu(t){return t&&t.length?No(t):[]}function Ou(t,e){return t&&t.length?No(t,Ha(e,2)):[]}function Du(t,e){return e="function"==typeof e?e:o,t&&t.length?No(t,o,e):[]}function Nu(t){if(!t||!t.length)return[];var e=0;return t=An(t,(function(t){if(fl(t))return e=je(t.length,e),!0})),qn(e,(function(e){return kn(t,Zn(e))}))}function zu(t,e){if(!t||!t.length)return[];var n=Nu(t);return null==e?n:kn(n,(function(t){return xn(e,o,t)}))}var Fu=wo((function(t,e){return fl(t)?wi(t,e):[]})),Bu=wo((function(t){return jo(An(t,fl))})),Uu=wo((function(t){var e=au(t);return fl(e)&&(e=o),jo(An(t,fl),Ha(e,2))})),ju=wo((function(t){var e=au(t);return e="function"==typeof e?e:o,jo(An(t,fl),o,e)})),Zu=wo(Nu);function Vu(t,e){return Zo(t||[],e||[],li)}function Gu(t,e){return Zo(t||[],e||[],Ao)}var Hu=wo((function(t){var e=t.length,n=e>1?t[e-1]:o;return n="function"==typeof n?(t.pop(),n):o,zu(t,n)}));function Wu(t){var e=Er(t);return e.__chain__=!0,e}function qu(t,e){return e(t),t}function Xu(t,e){return e(t)}var Yu=Ba((function(t){var e=t.length,n=e?t[0]:0,r=this.__wrapped__,i=function(e){return mi(e,t)};return!(e>1||this.__actions__.length)&&r instanceof kr&&ss(n)?(r=r.slice(n,+n+(e?1:0)),r.__actions__.push({func:Xu,args:[i],thisArg:o}),new Cr(r,this.__chain__).thru((function(t){return e&&!t.length&&t.push(o),t}))):this.thru(i)}));function Ku(){return Wu(this)}function Qu(){return new Cr(this.value(),this.__chain__)}function Ju(){this.__values__===o&&(this.__values__=ql(this.value()));var t=this.__index__>=this.__values__.length,e=t?o:this.__values__[this.__index__++];return{done:t,value:e}}function $u(){return this}function tc(t){var e,n=this;while(n instanceof Tr){var r=Ds(n);r.__index__=0,r.__values__=o,e?i.__wrapped__=r:e=r;var i=r;n=n.__wrapped__}return i.__wrapped__=t,e}function ec(){var t=this.__wrapped__;if(t instanceof kr){var e=t;return this.__actions__.length&&(e=new kr(this)),e=e.reverse(),e.__actions__.push({func:Xu,args:[vu],thisArg:o}),new Cr(e,this.__chain__)}return this.thru(vu)}function nc(){return Uo(this.__wrapped__,this.__actions__)}var rc=ca((function(t,e,n){fe.call(t,n)?++t[n]:vi(t,n,1)}));function ic(t,e,n){var r=cl(t)?Sn:Ai;return n&&us(t,e,n)&&(e=o),r(t,Ha(e,3))}function oc(t,e){var n=cl(t)?An:ki;return n(t,Ha(e,3))}var ac=ya(qs),sc=ya(Xs);function uc(t,e){return Mi(gc(t,e),1)}function cc(t,e){return Mi(gc(t,e),N)}function lc(t,e,n){return n=n===o?1:Yl(n),Mi(gc(t,e),n)}function hc(t,e){var n=cl(t)?wn:Ei;return n(t,Ha(e,3))}function fc(t,e){var n=cl(t)?En:Si;return n(t,Ha(e,3))}var pc=ca((function(t,e,n){fe.call(t,n)?t[n].push(e):vi(t,n,[e])}));function dc(t,e,n,r){t=hl(t)?t:Zh(t),n=n&&!r?Yl(n):0;var i=t.length;return n<0&&(n=je(i+n,0)),Bl(t)?n<=i&&t.indexOf(e,n)>-1:!!i&&Fn(t,e,n)>-1}var vc=wo((function(t,e,r){var i=-1,o="function"==typeof e,a=hl(t)?n(t.length):[];return Ei(t,(function(t){a[++i]=o?xn(e,t,r):Gi(t,e,r)})),a})),mc=ca((function(t,e,n){vi(t,n,e)}));function gc(t,e){var n=cl(t)?kn:ao;return n(t,Ha(e,3))}function yc(t,e,n,r){return null==t?[]:(cl(e)||(e=null==e?[]:[e]),n=r?o:n,cl(n)||(n=null==n?[]:[n]),fo(t,e,n))}var _c=ca((function(t,e,n){t[n?0:1].push(e)}),(function(){return[[],[]]}));function xc(t,e,n){var r=cl(t)?Pn:Gn,i=arguments.length<3;return r(t,Ha(e,4),n,i,Ei)}function bc(t,e,n){var r=cl(t)?In:Gn,i=arguments.length<3;return r(t,Ha(e,4),n,i,Si)}function wc(t,e){var n=cl(t)?An:ki;return n(t,Zc(Ha(e,3)))}function Ec(t){var e=cl(t)?ai:Eo;return e(t)}function Sc(t,e,n){e=(n?us(t,e,n):e===o)?1:Yl(e);var r=cl(t)?si:So;return r(t,e)}function Ac(t){var e=cl(t)?ui:ko;return e(t)}function Tc(t){if(null==t)return 0;if(hl(t))return Bl(t)?mr(t):t.length;var e=Ja(t);return e==$||e==at?t.size:ro(t).length}function Cc(t,e,n){var r=cl(t)?Rn:Po;return n&&us(t,e,n)&&(e=o),r(t,Ha(e,3))}var kc=wo((function(t,e){if(null==t)return[];var n=e.length;return n>1&&us(t,e[0],e[1])?e=[]:n>2&&us(e[0],e[1],e[2])&&(e=[e[0]]),fo(t,Mi(e,1),[])})),Mc=Re||function(){return un.Date.now()};function Pc(t,e){if("function"!=typeof e)throw new ae(c);return t=Yl(t),function(){if(--t<1)return e.apply(this,arguments)}}function Ic(t,e,n){return e=n?o:e,e=t&&null==e?t.length:e,Ra(t,T,o,o,o,o,e)}function Rc(t,e){var n;if("function"!=typeof e)throw new ae(c);return t=Yl(t),function(){return--t>0&&(n=e.apply(this,arguments)),t<=1&&(e=o),n}}var Lc=wo((function(t,e,n){var r=_;if(n.length){var i=hr(n,Ga(Lc));r|=S}return Ra(t,r,e,n,i)})),Oc=wo((function(t,e,n){var r=_|x;if(n.length){var i=hr(n,Ga(Oc));r|=S}return Ra(e,r,t,n,i)}));function Dc(t,e,n){e=n?o:e;var r=Ra(t,w,o,o,o,o,o,e);return r.placeholder=Dc.placeholder,r}function Nc(t,e,n){e=n?o:e;var r=Ra(t,E,o,o,o,o,o,e);return r.placeholder=Nc.placeholder,r}function zc(t,e,n){var r,i,a,s,u,l,h=0,f=!1,p=!1,d=!0;if("function"!=typeof t)throw new ae(c);function v(e){var n=r,a=i;return r=i=o,h=e,s=t.apply(a,n),s}function m(t){return h=t,u=Ts(_,e),f?v(t):s}function g(t){var n=t-l,r=t-h,i=e-n;return p?Ze(i,a-r):i}function y(t){var n=t-l,r=t-h;return l===o||n>=e||n<0||p&&r>=a}function _(){var t=Mc();if(y(t))return x(t);u=Ts(_,g(t))}function x(t){return u=o,d&&r?v(t):(r=i=o,s)}function b(){u!==o&&Xo(u),h=0,r=l=i=u=o}function w(){return u===o?s:x(Mc())}function E(){var t=Mc(),n=y(t);if(r=arguments,i=this,l=t,n){if(u===o)return m(l);if(p)return Xo(u),u=Ts(_,e),v(l)}return u===o&&(u=Ts(_,e)),s}return e=Ql(e)||0,Al(n)&&(f=!!n.leading,p="maxWait"in n,a=p?je(Ql(n.maxWait)||0,e):a,d="trailing"in n?!!n.trailing:d),E.cancel=b,E.flush=w,E}var Fc=wo((function(t,e){return bi(t,1,e)})),Bc=wo((function(t,e,n){return bi(t,Ql(e)||0,n)}));function Uc(t){return Ra(t,k)}function jc(t,e){if("function"!=typeof t||null!=e&&"function"!=typeof e)throw new ae(c);var n=function n(){var r=arguments,i=e?e.apply(this,r):r[0],o=n.cache;if(o.has(i))return o.get(i);var a=t.apply(this,r);return n.cache=o.set(i,a)||o,a};return n.cache=new(jc.Cache||Gr),n}function Zc(t){if("function"!=typeof t)throw new ae(c);return function(){var e=arguments;switch(e.length){case 0:return!t.call(this);case 1:return!t.call(this,e[0]);case 2:return!t.call(this,e[0],e[1]);case 3:return!t.call(this,e[0],e[1],e[2])}return!t.apply(this,e)}}function Vc(t){return Rc(2,t)}jc.Cache=Gr;var Gc=Wo((function(t,e){e=1==e.length&&cl(e[0])?kn(e[0],Kn(Ha())):kn(Mi(e,1),Kn(Ha()));var n=e.length;return wo((function(r){var i=-1,o=Ze(r.length,n);while(++i<o)r[i]=e[i].call(this,r[i]);return xn(t,this,r)}))})),Hc=wo((function(t,e){var n=hr(e,Ga(Hc));return Ra(t,S,o,e,n)})),Wc=wo((function(t,e){var n=hr(e,Ga(Wc));return Ra(t,A,o,e,n)})),qc=Ba((function(t,e){return Ra(t,C,o,o,o,e)}));function Xc(t,e){if("function"!=typeof t)throw new ae(c);return e=e===o?e:Yl(e),wo(t,e)}function Yc(t,e){if("function"!=typeof t)throw new ae(c);return e=null==e?0:je(Yl(e),0),wo((function(n){var r=n[e],i=qo(n,0,e);return r&&Mn(i,r),xn(t,this,i)}))}function Kc(t,e,n){var r=!0,i=!0;if("function"!=typeof t)throw new ae(c);return Al(n)&&(r="leading"in n?!!n.leading:r,i="trailing"in n?!!n.trailing:i),zc(t,e,{leading:r,maxWait:e,trailing:i})}function Qc(t){return Ic(t,1)}function Jc(t,e){return Hc(Go(e),t)}function $c(){if(!arguments.length)return[];var t=arguments[0];return cl(t)?t:[t]}function tl(t){return yi(t,m)}function el(t,e){return e="function"==typeof e?e:o,yi(t,m,e)}function nl(t){return yi(t,d|m)}function rl(t,e){return e="function"==typeof e?e:o,yi(t,d|m,e)}function il(t,e){return null==e||xi(t,e,Eh(e))}function ol(t,e){return t===e||t!==t&&e!==e}var al=Ca(Fi),sl=Ca((function(t,e){return t>=e})),ul=Hi(function(){return arguments}())?Hi:function(t){return Tl(t)&&fe.call(t,"callee")&&!Ae.call(t,"callee")},cl=n.isArray,ll=dn?Kn(dn):Wi;function hl(t){return null!=t&&Sl(t.length)&&!wl(t)}function fl(t){return Tl(t)&&hl(t)}function pl(t){return!0===t||!1===t||Tl(t)&&zi(t)==q}var dl=ze||Kf,vl=vn?Kn(vn):qi;function ml(t){return Tl(t)&&1===t.nodeType&&!Dl(t)}function gl(t){if(null==t)return!0;if(hl(t)&&(cl(t)||"string"==typeof t||"function"==typeof t.splice||dl(t)||jl(t)||ul(t)))return!t.length;var e=Ja(t);if(e==$||e==at)return!t.size;if(ds(t))return!ro(t).length;for(var n in t)if(fe.call(t,n))return!1;return!0}function yl(t,e){return Xi(t,e)}function _l(t,e,n){n="function"==typeof n?n:o;var r=n?n(t,e):o;return r===o?Xi(t,e,o,n):!!r}function xl(t){if(!Tl(t))return!1;var e=zi(t);return e==K||e==Y||"string"==typeof t.message&&"string"==typeof t.name&&!Dl(t)}function bl(t){return"number"==typeof t&&Fe(t)}function wl(t){if(!Al(t))return!1;var e=zi(t);return e==Q||e==J||e==W||e==it}function El(t){return"number"==typeof t&&t==Yl(t)}function Sl(t){return"number"==typeof t&&t>-1&&t%1==0&&t<=z}function Al(t){var e=i(t);return null!=t&&("object"==e||"function"==e)}function Tl(t){return null!=t&&"object"==i(t)}var Cl=mn?Kn(mn):Ki;function kl(t,e){return t===e||Qi(t,e,qa(e))}function Ml(t,e,n){return n="function"==typeof n?n:o,Qi(t,e,qa(e),n)}function Pl(t){return Ol(t)&&t!=+t}function Il(t){if(ps(t))throw new Bt(u);return Ji(t)}function Rl(t){return null===t}function Ll(t){return null==t}function Ol(t){return"number"==typeof t||Tl(t)&&zi(t)==tt}function Dl(t){if(!Tl(t)||zi(t)!=nt)return!1;var e=Ee(t);if(null===e)return!0;var n=fe.call(e,"constructor")&&e.constructor;return"function"==typeof n&&n instanceof n&&he.call(n)==me}var Nl=gn?Kn(gn):$i;function zl(t){return El(t)&&t>=-z&&t<=z}var Fl=yn?Kn(yn):to;function Bl(t){return"string"==typeof t||!cl(t)&&Tl(t)&&zi(t)==st}function Ul(t){return"symbol"==i(t)||Tl(t)&&zi(t)==ut}var jl=_n?Kn(_n):eo;function Zl(t){return t===o}function Vl(t){return Tl(t)&&Ja(t)==lt}function Gl(t){return Tl(t)&&zi(t)==ht}var Hl=Ca(oo),Wl=Ca((function(t,e){return t<=e}));function ql(t){if(!t)return[];if(hl(t))return Bl(t)?gr(t):oa(t);if(ke&&t[ke])return ur(t[ke]());var e=Ja(t),n=e==$?cr:e==at?fr:Zh;return n(t)}function Xl(t){if(!t)return 0===t?t:0;if(t=Ql(t),t===N||t===-N){var e=t<0?-1:1;return e*F}return t===t?t:0}function Yl(t){var e=Xl(t),n=e%1;return e===e?n?e-n:e:0}function Kl(t){return t?gi(Yl(t),0,U):0}function Ql(t){if("number"==typeof t)return t;if(Ul(t))return B;if(Al(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=Al(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=Yn(t);var n=Yt.test(t);return n||Qt.test(t)?on(t.slice(2),n?2:8):Xt.test(t)?B:+t}function Jl(t){return aa(t,Sh(t))}function $l(t){return t?gi(Yl(t),-z,z):0===t?t:0}function th(t){return null==t?"":Do(t)}var eh=la((function(t,e){if(ds(e)||hl(e))aa(e,Eh(e),t);else for(var n in e)fe.call(e,n)&&li(t,n,e[n])})),nh=la((function(t,e){aa(e,Sh(e),t)})),rh=la((function(t,e,n,r){aa(e,Sh(e),t,r)})),ih=la((function(t,e,n,r){aa(e,Eh(e),t,r)})),oh=Ba(mi);function ah(t,e){var n=Ar(t);return null==e?n:pi(n,e)}var sh=wo((function(t,e){t=re(t);var n=-1,r=e.length,i=r>2?e[2]:o;i&&us(e[0],e[1],i)&&(r=1);while(++n<r){var a=e[n],s=Sh(a),u=-1,c=s.length;while(++u<c){var l=s[u],h=t[l];(h===o||ol(h,ce[l])&&!fe.call(t,l))&&(t[l]=a[l])}}return t})),uh=wo((function(t){return t.push(o,Oa),xn(kh,o,t)}));function ch(t,e){return Nn(t,Ha(e,3),Ri)}function lh(t,e){return Nn(t,Ha(e,3),Li)}function hh(t,e){return null==t?t:Pi(t,Ha(e,3),Sh)}function fh(t,e){return null==t?t:Ii(t,Ha(e,3),Sh)}function ph(t,e){return t&&Ri(t,Ha(e,3))}function dh(t,e){return t&&Li(t,Ha(e,3))}function vh(t){return null==t?[]:Oi(t,Eh(t))}function mh(t){return null==t?[]:Oi(t,Sh(t))}function gh(t,e,n){var r=null==t?o:Di(t,e);return r===o?n:r}function yh(t,e){return null!=t&&es(t,e,Bi)}function _h(t,e){return null!=t&&es(t,e,Ui)}var xh=ba((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=ve.call(e)),t[e]=n}),kf(Rf)),bh=ba((function(t,e,n){null!=e&&"function"!=typeof e.toString&&(e=ve.call(e)),fe.call(t,e)?t[e].push(n):t[e]=[n]}),Ha),wh=wo(Gi);function Eh(t){return hl(t)?oi(t):ro(t)}function Sh(t){return hl(t)?oi(t,!0):io(t)}function Ah(t,e){var n={};return e=Ha(e,3),Ri(t,(function(t,r,i){vi(n,e(t,r,i),t)})),n}function Th(t,e){var n={};return e=Ha(e,3),Ri(t,(function(t,r,i){vi(n,r,e(t,r,i))})),n}var Ch=la((function(t,e,n){co(t,e,n)})),kh=la((function(t,e,n,r){co(t,e,n,r)})),Mh=Ba((function(t,e){var n={};if(null==t)return n;var r=!1;e=kn(e,(function(e){return e=Ho(e,t),r||(r=e.length>1),e})),aa(t,ja(t),n),r&&(n=yi(n,d|v|m,Da));var i=e.length;while(i--)zo(n,e[i]);return n}));function Ph(t,e){return Rh(t,Zc(Ha(e)))}var Ih=Ba((function(t,e){return null==t?{}:po(t,e)}));function Rh(t,e){if(null==t)return{};var n=kn(ja(t),(function(t){return[t]}));return e=Ha(e),vo(t,n,(function(t,n){return e(t,n[0])}))}function Lh(t,e,n){e=Ho(e,t);var r=-1,i=e.length;i||(i=1,t=o);while(++r<i){var a=null==t?o:t[Rs(e[r])];a===o&&(r=i,a=n),t=wl(a)?a.call(t):a}return t}function Oh(t,e,n){return null==t?t:Ao(t,e,n)}function Dh(t,e,n,r){return r="function"==typeof r?r:o,null==t?t:Ao(t,e,n,r)}var Nh=Ia(Eh),zh=Ia(Sh);function Fh(t,e,n){var r=cl(t),i=r||dl(t)||jl(t);if(e=Ha(e,4),null==n){var o=t&&t.constructor;n=i?r?new o:[]:Al(t)&&wl(o)?Ar(Ee(t)):{}}return(i?wn:Ri)(t,(function(t,r,i){return e(n,t,r,i)})),n}function Bh(t,e){return null==t||zo(t,e)}function Uh(t,e,n){return null==t?t:Fo(t,e,Go(n))}function jh(t,e,n,r){return r="function"==typeof r?r:o,null==t?t:Fo(t,e,Go(n),r)}function Zh(t){return null==t?[]:Qn(t,Eh(t))}function Vh(t){return null==t?[]:Qn(t,Sh(t))}function Gh(t,e,n){return n===o&&(n=e,e=o),n!==o&&(n=Ql(n),n=n===n?n:0),e!==o&&(e=Ql(e),e=e===e?e:0),gi(Ql(t),e,n)}function Hh(t,e,n){return e=Xl(e),n===o?(n=e,e=0):n=Xl(n),t=Ql(t),ji(t,e,n)}function Wh(t,e,n){if(n&&"boolean"!=typeof n&&us(t,e,n)&&(e=n=o),n===o&&("boolean"==typeof e?(n=e,e=o):"boolean"==typeof t&&(n=t,t=o)),t===o&&e===o?(t=0,e=1):(t=Xl(t),e===o?(e=t,t=0):e=Xl(e)),t>e){var r=t;t=e,e=r}if(n||t%1||e%1){var i=qe();return Ze(t+i*(e-t+rn("1e-"+((i+"").length-1))),e)}return _o(t,e)}var qh=va((function(t,e,n){return e=e.toLowerCase(),t+(n?Xh(e):e)}));function Xh(t){return wf(th(t).toLowerCase())}function Yh(t){return t=th(t),t&&t.replace($t,nr).replace(Ge,"")}function Kh(t,e,n){t=th(t),e=Do(e);var r=t.length;n=n===o?r:gi(Yl(n),0,r);var i=n;return n-=e.length,n>=0&&t.slice(n,i)==e}function Qh(t){return t=th(t),t&&Mt.test(t)?t.replace(Ct,rr):t}function Jh(t){return t=th(t),t&&zt.test(t)?t.replace(Nt,"\\$&"):t}var $h=va((function(t,e,n){return t+(n?"-":"")+e.toLowerCase()})),tf=va((function(t,e,n){return t+(n?" ":"")+e.toLowerCase()})),ef=da("toLowerCase");function nf(t,e,n){t=th(t),e=Yl(e);var r=e?mr(t):0;if(!e||r>=e)return t;var i=(e-r)/2;return Sa(De(i),n)+t+Sa(Oe(i),n)}function rf(t,e,n){t=th(t),e=Yl(e);var r=e?mr(t):0;return e&&r<e?t+Sa(e-r,n):t}function of(t,e,n){t=th(t),e=Yl(e);var r=e?mr(t):0;return e&&r<e?Sa(e-r,n)+t:t}function af(t,e,n){return n||null==e?e=0:e&&(e=+e),We(th(t).replace(Ft,""),e||0)}function sf(t,e,n){return e=(n?us(t,e,n):e===o)?1:Yl(e),bo(th(t),e)}function uf(){var t=arguments,e=th(t[0]);return t.length<3?e:e.replace(t[1],t[2])}var cf=va((function(t,e,n){return t+(n?"_":"")+e.toLowerCase()}));function lf(t,e,n){return n&&"number"!=typeof n&&us(t,e,n)&&(e=n=o),n=n===o?U:n>>>0,n?(t=th(t),t&&("string"==typeof e||null!=e&&!Nl(e))&&(e=Do(e),!e&&ar(t))?qo(gr(t),0,n):t.split(e,n)):[]}var hf=va((function(t,e,n){return t+(n?" ":"")+wf(e)}));function ff(t,e,n){return t=th(t),n=null==n?0:gi(Yl(n),0,t.length),e=Do(e),t.slice(n,n+e.length)==e}function pf(t,e,n){var r=Er.templateSettings;n&&us(t,e,n)&&(e=o),t=th(t),e=rh({},e,r,La);var i,a,s=rh({},e.imports,r.imports,La),u=Eh(s),c=Qn(s,u),h=0,f=e.interpolate||te,p="__p += '",d=ie((e.escape||te).source+"|"+f.source+"|"+(f===Rt?Wt:te).source+"|"+(e.evaluate||te).source+"|$","g"),v="//# sourceURL="+(fe.call(e,"sourceURL")?(e.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++Ke+"]")+"\n";t.replace(d,(function(e,n,r,o,s,u){return r||(r=o),p+=t.slice(h,u).replace(ee,ir),n&&(i=!0,p+="' +\n__e("+n+") +\n'"),s&&(a=!0,p+="';\n"+s+";\n__p += '"),r&&(p+="' +\n((__t = ("+r+")) == null ? '' : __t) +\n'"),h=u+e.length,e})),p+="';\n";var m=fe.call(e,"variable")&&e.variable;if(m){if(Gt.test(m))throw new Bt(l)}else p="with (obj) {\n"+p+"\n}\n";p=(a?p.replace(Et,""):p).replace(St,"$1").replace(At,"$1;"),p="function("+(m||"obj")+") {\n"+(m?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(i?", __e = _.escape":"")+(a?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+p+"return __p\n}";var g=Sf((function(){return Vt(u,v+"return "+p).apply(o,c)}));if(g.source=p,xl(g))throw g;return g}function df(t){return th(t).toLowerCase()}function vf(t){return th(t).toUpperCase()}function mf(t,e,n){if(t=th(t),t&&(n||e===o))return Yn(t);if(!t||!(e=Do(e)))return t;var r=gr(t),i=gr(e),a=$n(r,i),s=tr(r,i)+1;return qo(r,a,s).join("")}function gf(t,e,n){if(t=th(t),t&&(n||e===o))return t.slice(0,yr(t)+1);if(!t||!(e=Do(e)))return t;var r=gr(t),i=tr(r,gr(e))+1;return qo(r,0,i).join("")}function yf(t,e,n){if(t=th(t),t&&(n||e===o))return t.replace(Ft,"");if(!t||!(e=Do(e)))return t;var r=gr(t),i=$n(r,gr(e));return qo(r,i).join("")}function _f(t,e){var n=M,r=P;if(Al(e)){var i="separator"in e?e.separator:i;n="length"in e?Yl(e.length):n,r="omission"in e?Do(e.omission):r}t=th(t);var a=t.length;if(ar(t)){var s=gr(t);a=s.length}if(n>=a)return t;var u=n-mr(r);if(u<1)return r;var c=s?qo(s,0,u).join(""):t.slice(0,u);if(i===o)return c+r;if(s&&(u+=c.length-u),Nl(i)){if(t.slice(u).search(i)){var l,h=c;i.global||(i=ie(i.source,th(qt.exec(i))+"g")),i.lastIndex=0;while(l=i.exec(h))var f=l.index;c=c.slice(0,f===o?u:f)}}else if(t.indexOf(Do(i),u)!=u){var p=c.lastIndexOf(i);p>-1&&(c=c.slice(0,p))}return c+r}function xf(t){return t=th(t),t&&kt.test(t)?t.replace(Tt,_r):t}var bf=va((function(t,e,n){return t+(n?" ":"")+e.toUpperCase()})),wf=da("toUpperCase");function Ef(t,e,n){return t=th(t),e=n?o:e,e===o?sr(t)?wr(t):Dn(t):t.match(e)||[]}var Sf=wo((function(t,e){try{return xn(t,o,e)}catch(n){return xl(n)?n:new Bt(n)}})),Af=Ba((function(t,e){return wn(e,(function(e){e=Rs(e),vi(t,e,Lc(t[e],t))})),t}));function Tf(t){var e=null==t?0:t.length,n=Ha();return t=e?kn(t,(function(t){if("function"!=typeof t[1])throw new ae(c);return[n(t[0]),t[1]]})):[],wo((function(n){var r=-1;while(++r<e){var i=t[r];if(xn(i[0],this,n))return xn(i[1],this,n)}}))}function Cf(t){return _i(yi(t,d))}function kf(t){return function(){return t}}function Mf(t,e){return null==t||t!==t?e:t}var Pf=_a(),If=_a(!0);function Rf(t){return t}function Lf(t){return no("function"==typeof t?t:yi(t,d))}function Of(t){return so(yi(t,d))}function Df(t,e){return uo(t,yi(e,d))}var Nf=wo((function(t,e){return function(n){return Gi(n,t,e)}})),zf=wo((function(t,e){return function(n){return Gi(t,n,e)}}));function Ff(t,e,n){var r=Eh(e),i=Oi(e,r);null!=n||Al(e)&&(i.length||!r.length)||(n=e,e=t,t=this,i=Oi(e,Eh(e)));var o=!(Al(n)&&"chain"in n)||!!n.chain,a=wl(t);return wn(i,(function(n){var r=e[n];t[n]=r,a&&(t.prototype[n]=function(){var e=this.__chain__;if(o||e){var n=t(this.__wrapped__),i=n.__actions__=oa(this.__actions__);return i.push({func:r,args:arguments,thisArg:t}),n.__chain__=e,n}return r.apply(t,Mn([this.value()],arguments))})})),t}function Bf(){return un._===this&&(un._=ge),this}function Uf(){}function jf(t){return t=Yl(t),wo((function(e){return ho(e,t)}))}var Zf=Ea(kn),Vf=Ea(Sn),Gf=Ea(Rn);function Hf(t){return cs(t)?Zn(Rs(t)):mo(t)}function Wf(t){return function(e){return null==t?o:Di(t,e)}}var qf=Ta(),Xf=Ta(!0);function Yf(){return[]}function Kf(){return!1}function Qf(){return{}}function Jf(){return""}function $f(){return!0}function tp(t,e){if(t=Yl(t),t<1||t>z)return[];var n=U,r=Ze(t,U);e=Ha(e),t-=U;var i=qn(r,e);while(++n<t)e(n);return i}function ep(t){return cl(t)?kn(t,Rs):Ul(t)?[t]:oa(Is(th(t)))}function np(t){var e=++pe;return th(t)+e}var rp=wa((function(t,e){return t+e}),0),ip=Ma("ceil"),op=wa((function(t,e){return t/e}),1),ap=Ma("floor");function sp(t){return t&&t.length?Ti(t,Rf,Fi):o}function up(t,e){return t&&t.length?Ti(t,Ha(e,2),Fi):o}function cp(t){return jn(t,Rf)}function lp(t,e){return jn(t,Ha(e,2))}function hp(t){return t&&t.length?Ti(t,Rf,oo):o}function fp(t,e){return t&&t.length?Ti(t,Ha(e,2),oo):o}var pp=wa((function(t,e){return t*e}),1),dp=Ma("round"),vp=wa((function(t,e){return t-e}),0);function mp(t){return t&&t.length?Wn(t,Rf):0}function gp(t,e){return t&&t.length?Wn(t,Ha(e,2)):0}return Er.after=Pc,Er.ary=Ic,Er.assign=eh,Er.assignIn=nh,Er.assignInWith=rh,Er.assignWith=ih,Er.at=oh,Er.before=Rc,Er.bind=Lc,Er.bindAll=Af,Er.bindKey=Oc,Er.castArray=$c,Er.chain=Wu,Er.chunk=Ns,Er.compact=zs,Er.concat=Fs,Er.cond=Tf,Er.conforms=Cf,Er.constant=kf,Er.countBy=rc,Er.create=ah,Er.curry=Dc,Er.curryRight=Nc,Er.debounce=zc,Er.defaults=sh,Er.defaultsDeep=uh,Er.defer=Fc,Er.delay=Bc,Er.difference=Bs,Er.differenceBy=Us,Er.differenceWith=js,Er.drop=Zs,Er.dropRight=Vs,Er.dropRightWhile=Gs,Er.dropWhile=Hs,Er.fill=Ws,Er.filter=oc,Er.flatMap=uc,Er.flatMapDeep=cc,Er.flatMapDepth=lc,Er.flatten=Ys,Er.flattenDeep=Ks,Er.flattenDepth=Qs,Er.flip=Uc,Er.flow=Pf,Er.flowRight=If,Er.fromPairs=Js,Er.functions=vh,Er.functionsIn=mh,Er.groupBy=pc,Er.initial=eu,Er.intersection=nu,Er.intersectionBy=ru,Er.intersectionWith=iu,Er.invert=xh,Er.invertBy=bh,Er.invokeMap=vc,Er.iteratee=Lf,Er.keyBy=mc,Er.keys=Eh,Er.keysIn=Sh,Er.map=gc,Er.mapKeys=Ah,Er.mapValues=Th,Er.matches=Of,Er.matchesProperty=Df,Er.memoize=jc,Er.merge=Ch,Er.mergeWith=kh,Er.method=Nf,Er.methodOf=zf,Er.mixin=Ff,Er.negate=Zc,Er.nthArg=jf,Er.omit=Mh,Er.omitBy=Ph,Er.once=Vc,Er.orderBy=yc,Er.over=Zf,Er.overArgs=Gc,Er.overEvery=Vf,Er.overSome=Gf,Er.partial=Hc,Er.partialRight=Wc,Er.partition=_c,Er.pick=Ih,Er.pickBy=Rh,Er.property=Hf,Er.propertyOf=Wf,Er.pull=cu,Er.pullAll=lu,Er.pullAllBy=hu,Er.pullAllWith=fu,Er.pullAt=pu,Er.range=qf,Er.rangeRight=Xf,Er.rearg=qc,Er.reject=wc,Er.remove=du,Er.rest=Xc,Er.reverse=vu,Er.sampleSize=Sc,Er.set=Oh,Er.setWith=Dh,Er.shuffle=Ac,Er.slice=mu,Er.sortBy=kc,Er.sortedUniq=Eu,Er.sortedUniqBy=Su,Er.split=lf,Er.spread=Yc,Er.tail=Au,Er.take=Tu,Er.takeRight=Cu,Er.takeRightWhile=ku,Er.takeWhile=Mu,Er.tap=qu,Er.throttle=Kc,Er.thru=Xu,Er.toArray=ql,Er.toPairs=Nh,Er.toPairsIn=zh,Er.toPath=ep,Er.toPlainObject=Jl,Er.transform=Fh,Er.unary=Qc,Er.union=Pu,Er.unionBy=Iu,Er.unionWith=Ru,Er.uniq=Lu,Er.uniqBy=Ou,Er.uniqWith=Du,Er.unset=Bh,Er.unzip=Nu,Er.unzipWith=zu,Er.update=Uh,Er.updateWith=jh,Er.values=Zh,Er.valuesIn=Vh,Er.without=Fu,Er.words=Ef,Er.wrap=Jc,Er.xor=Bu,Er.xorBy=Uu,Er.xorWith=ju,Er.zip=Zu,Er.zipObject=Vu,Er.zipObjectDeep=Gu,Er.zipWith=Hu,Er.entries=Nh,Er.entriesIn=zh,Er.extend=nh,Er.extendWith=rh,Ff(Er,Er),Er.add=rp,Er.attempt=Sf,Er.camelCase=qh,Er.capitalize=Xh,Er.ceil=ip,Er.clamp=Gh,Er.clone=tl,Er.cloneDeep=nl,Er.cloneDeepWith=rl,Er.cloneWith=el,Er.conformsTo=il,Er.deburr=Yh,Er.defaultTo=Mf,Er.divide=op,Er.endsWith=Kh,Er.eq=ol,Er.escape=Qh,Er.escapeRegExp=Jh,Er.every=ic,Er.find=ac,Er.findIndex=qs,Er.findKey=ch,Er.findLast=sc,Er.findLastIndex=Xs,Er.findLastKey=lh,Er.floor=ap,Er.forEach=hc,Er.forEachRight=fc,Er.forIn=hh,Er.forInRight=fh,Er.forOwn=ph,Er.forOwnRight=dh,Er.get=gh,Er.gt=al,Er.gte=sl,Er.has=yh,Er.hasIn=_h,Er.head=$s,Er.identity=Rf,Er.includes=dc,Er.indexOf=tu,Er.inRange=Hh,Er.invoke=wh,Er.isArguments=ul,Er.isArray=cl,Er.isArrayBuffer=ll,Er.isArrayLike=hl,Er.isArrayLikeObject=fl,Er.isBoolean=pl,Er.isBuffer=dl,Er.isDate=vl,Er.isElement=ml,Er.isEmpty=gl,Er.isEqual=yl,Er.isEqualWith=_l,Er.isError=xl,Er.isFinite=bl,Er.isFunction=wl,Er.isInteger=El,Er.isLength=Sl,Er.isMap=Cl,Er.isMatch=kl,Er.isMatchWith=Ml,Er.isNaN=Pl,Er.isNative=Il,Er.isNil=Ll,Er.isNull=Rl,Er.isNumber=Ol,Er.isObject=Al,Er.isObjectLike=Tl,Er.isPlainObject=Dl,Er.isRegExp=Nl,Er.isSafeInteger=zl,Er.isSet=Fl,Er.isString=Bl,Er.isSymbol=Ul,Er.isTypedArray=jl,Er.isUndefined=Zl,Er.isWeakMap=Vl,Er.isWeakSet=Gl,Er.join=ou,Er.kebabCase=$h,Er.last=au,Er.lastIndexOf=su,Er.lowerCase=tf,Er.lowerFirst=ef,Er.lt=Hl,Er.lte=Wl,Er.max=sp,Er.maxBy=up,Er.mean=cp,Er.meanBy=lp,Er.min=hp,Er.minBy=fp,Er.stubArray=Yf,Er.stubFalse=Kf,Er.stubObject=Qf,Er.stubString=Jf,Er.stubTrue=$f,Er.multiply=pp,Er.nth=uu,Er.noConflict=Bf,Er.noop=Uf,Er.now=Mc,Er.pad=nf,Er.padEnd=rf,Er.padStart=of,Er.parseInt=af,Er.random=Wh,Er.reduce=xc,Er.reduceRight=bc,Er.repeat=sf,Er.replace=uf,Er.result=Lh,Er.round=dp,Er.runInContext=t,Er.sample=Ec,Er.size=Tc,Er.snakeCase=cf,Er.some=Cc,Er.sortedIndex=gu,Er.sortedIndexBy=yu,Er.sortedIndexOf=_u,Er.sortedLastIndex=xu,Er.sortedLastIndexBy=bu,Er.sortedLastIndexOf=wu,Er.startCase=hf,Er.startsWith=ff,Er.subtract=vp,Er.sum=mp,Er.sumBy=gp,Er.template=pf,Er.times=tp,Er.toFinite=Xl,Er.toInteger=Yl,Er.toLength=Kl,Er.toLower=df,Er.toNumber=Ql,Er.toSafeInteger=$l,Er.toString=th,Er.toUpper=vf,Er.trim=mf,Er.trimEnd=gf,Er.trimStart=yf,Er.truncate=_f,Er.unescape=xf,Er.uniqueId=np,Er.upperCase=bf,Er.upperFirst=wf,Er.each=hc,Er.eachRight=fc,Er.first=$s,Ff(Er,function(){var t={};return Ri(Er,(function(e,n){fe.call(Er.prototype,n)||(t[n]=e)})),t}(),{chain:!1}),Er.VERSION=a,wn(["bind","bindKey","curry","curryRight","partial","partialRight"],(function(t){Er[t].placeholder=Er})),wn(["drop","take"],(function(t,e){kr.prototype[t]=function(n){n=n===o?1:je(Yl(n),0);var r=this.__filtered__&&!e?new kr(this):this.clone();return r.__filtered__?r.__takeCount__=Ze(n,r.__takeCount__):r.__views__.push({size:Ze(n,U),type:t+(r.__dir__<0?"Right":"")}),r},kr.prototype[t+"Right"]=function(e){return this.reverse()[t](e).reverse()}})),wn(["filter","map","takeWhile"],(function(t,e){var n=e+1,r=n==L||n==D;kr.prototype[t]=function(t){var e=this.clone();return e.__iteratees__.push({iteratee:Ha(t,3),type:n}),e.__filtered__=e.__filtered__||r,e}})),wn(["head","last"],(function(t,e){var n="take"+(e?"Right":"");kr.prototype[t]=function(){return this[n](1).value()[0]}})),wn(["initial","tail"],(function(t,e){var n="drop"+(e?"":"Right");kr.prototype[t]=function(){return this.__filtered__?new kr(this):this[n](1)}})),kr.prototype.compact=function(){return this.filter(Rf)},kr.prototype.find=function(t){return this.filter(t).head()},kr.prototype.findLast=function(t){return this.reverse().find(t)},kr.prototype.invokeMap=wo((function(t,e){return"function"==typeof t?new kr(this):this.map((function(n){return Gi(n,t,e)}))})),kr.prototype.reject=function(t){return this.filter(Zc(Ha(t)))},kr.prototype.slice=function(t,e){t=Yl(t);var n=this;return n.__filtered__&&(t>0||e<0)?new kr(n):(t<0?n=n.takeRight(-t):t&&(n=n.drop(t)),e!==o&&(e=Yl(e),n=e<0?n.dropRight(-e):n.take(e-t)),n)},kr.prototype.takeRightWhile=function(t){return this.reverse().takeWhile(t).reverse()},kr.prototype.toArray=function(){return this.take(U)},Ri(kr.prototype,(function(t,e){var n=/^(?:filter|find|map|reject)|While$/.test(e),r=/^(?:head|last)$/.test(e),i=Er[r?"take"+("last"==e?"Right":""):e],a=r||/^find/.test(e);i&&(Er.prototype[e]=function(){var e=this.__wrapped__,s=r?[1]:arguments,u=e instanceof kr,c=s[0],l=u||cl(e),h=function(t){var e=i.apply(Er,Mn([t],s));return r&&f?e[0]:e};l&&n&&"function"==typeof c&&1!=c.length&&(u=l=!1);var f=this.__chain__,p=!!this.__actions__.length,d=a&&!f,v=u&&!p;if(!a&&l){e=v?e:new kr(this);var m=t.apply(e,s);return m.__actions__.push({func:Xu,args:[h],thisArg:o}),new Cr(m,f)}return d&&v?t.apply(this,s):(m=this.thru(h),d?r?m.value()[0]:m.value():m)})})),wn(["pop","push","shift","sort","splice","unshift"],(function(t){var e=se[t],n=/^(?:push|sort|unshift)$/.test(t)?"tap":"thru",r=/^(?:pop|shift)$/.test(t);Er.prototype[t]=function(){var t=arguments;if(r&&!this.__chain__){var i=this.value();return e.apply(cl(i)?i:[],t)}return this[n]((function(n){return e.apply(cl(n)?n:[],t)}))}})),Ri(kr.prototype,(function(t,e){var n=Er[e];if(n){var r=n.name+"";fe.call(ln,r)||(ln[r]=[]),ln[r].push({name:e,func:n})}})),ln[xa(o,x).name]=[{name:"wrapper",func:o}],kr.prototype.clone=Mr,kr.prototype.reverse=Pr,kr.prototype.value=Ir,Er.prototype.at=Yu,Er.prototype.chain=Ku,Er.prototype.commit=Qu,Er.prototype.next=Ju,Er.prototype.plant=tc,Er.prototype.reverse=ec,Er.prototype.toJSON=Er.prototype.valueOf=Er.prototype.value=nc,Er.prototype.first=Er.prototype.head,ke&&(Er.prototype[ke]=$u),Er},Sr=Er();"object"==i(n.amdO)&&n.amdO?(un._=Sr,r=function(){return Sr}.call(e,n,e,t),r===o||(t.exports=r)):ln?((ln.exports=Sr)._=Sr,cn._=Sr):un._=Sr}.call(this)},98878:function(t,e,n){var r=n(54227),i=n(77525),o=i((function(t,e,n){r(t,e,n)}));t.exports=o},47648:function(t){function e(){return!1}t.exports=e},72864:function(t,e,n){var r=n(97952),i=n(44549);function o(t){return r(t,i(t))}t.exports=o},69096:function(t,e,n){var r,i,o=n(1692)["default"];n(33948),n(60285),n(41637),n(74916),n(15306),n(21703),n(57658),n(87714),n(82801),n(1174),n(38862),n(39575),n(82472),n(48675),n(33105),n(63408),n(14590),n(3462),n(33824),n(23767),n(8585),n(68696),n(83753),n(65069),n(2707),n(18264),n(65125),n(24603),n(28450),n(87145),n(35109),n(8255),n(29135),n(44197),n(76495),n(49743),n(73210),n(30541),function(a,s){"object"===o(e)?t.exports=s():(r=s,i="function"===typeof r?r.call(e,n,e,t):r,void 0===i||(t.exports=i))}(0,(function(){"use strict";var t,e,n;function r(r,i){if(t)if(e){var o="var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk);",a={};t(a),n=i(a),"undefined"!==typeof window&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=i;else t=i}return r(["exports"],(function(t){function e(t,e){return t(e={exports:{}},e.exports),e.exports}var n=r;function r(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}r.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},r.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},r.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},r.prototype.solveCurveX=function(t,e){var n,r,i,o,a;for(void 0===e&&(e=1e-6),i=t,a=0;a<8;a++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var s=this.sampleCurveDerivativeX(i);if(Math.abs(s)<1e-6)break;i-=o/s}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},r.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=a;function a(t,e){this.x=t,this.y=e}a.prototype={clone:function(){return new a(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},a.convert=function(t){return t instanceof a?t:Array.isArray(t)?new a(t[0],t[1]):t};var s="undefined"!=typeof self?self:{},u=Math.pow(2,53)-1;function c(t,e,r,i){var o=new n(t,e,r,i);return function(t){return o.solve(t)}}var l=c(.25,.1,.25,1);function h(t,e,n){return Math.min(n,Math.max(e,t))}function f(t,e,n){var r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function p(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}var d=1;function v(){return d++}function m(){return function t(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function g(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function y(t,e){t.forEach((function(t){e[t]&&(e[t]=e[t].bind(e))}))}function _(t,e){return-1!==t.indexOf(e,t.length-e.length)}function x(t,e,n){var r={};for(var i in t)r[i]=e.call(n||this,t[i],i,t);return r}function b(t,e,n){var r={};for(var i in t)e.call(n||this,t[i],i,t)&&(r[i]=t[i]);return r}function w(t){return Array.isArray(t)?t.map(w):"object"==o(t)&&t?x(t,w):t}var E={};function S(t){E[t]||(E[t]=!0)}function A(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function T(t){for(var e=0,n=0,r=t.length,i=r-1,o=void 0,a=void 0;n<r;i=n++)e+=((a=t[i]).x-(o=t[n]).x)*(o.y+a.y);return e}function C(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function k(t){var e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(function(t,n,r,i){var o=r||i;return e[n]=!o||o.toLowerCase(),""})),e["max-age"]){var n=parseInt(e["max-age"],10);isNaN(n)?delete e["max-age"]:e["max-age"]=n}return e}var M=null;function P(t){if(null==M){var e=t.navigator?t.navigator.userAgent:null;M=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return M}function I(t){try{var e=s[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}var R,L,O,D,N=s.performance&&s.performance.now?s.performance.now.bind(s.performance):Date.now.bind(Date),z=s.requestAnimationFrame||s.mozRequestAnimationFrame||s.webkitRequestAnimationFrame||s.msRequestAnimationFrame,F=s.cancelAnimationFrame||s.mozCancelAnimationFrame||s.webkitCancelAnimationFrame||s.msCancelAnimationFrame,B={now:N,frame:function(t){var e=z(t);return{cancel:function(){return F(e)}}},getImageData:function(t,e){void 0===e&&(e=0);var n=s.document.createElement("canvas"),r=n.getContext("2d");if(!r)throw new Error("failed to create canvas 2d context");return n.width=t.width,n.height=t.height,r.drawImage(t,0,0,t.width,t.height),r.getImageData(-e,-e,t.width+2*e,t.height+2*e)},resolveURL:function(t){return R||(R=s.document.createElement("a")),R.href=t,R.href},hardwareConcurrency:s.navigator&&s.navigator.hardwareConcurrency||4,get devicePixelRatio(){return s.devicePixelRatio},get prefersReducedMotion(){return!!s.matchMedia&&(null==L&&(L=s.matchMedia("(prefers-reduced-motion: reduce)")),L.matches)}},U={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},j={supported:!1,testSupport:function(t){!Z&&D&&(V?G(t):O=t)}},Z=!1,V=!1;function G(t){var e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,D),t.isContextLost())return;j.supported=!0}catch(t){}t.deleteTexture(e),Z=!0}s.document&&((D=s.document.createElement("img")).onload=function(){O&&G(O),O=null,V=!0},D.onerror=function(){Z=!0,O=null},D.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var H="01",W=function(t,e){this._transformRequestFn=t,this._customAccessToken=e,this._createSkuToken()};function q(t){return 0===t.indexOf("mapbox:")}W.prototype._createSkuToken=function(){var t=function(){for(var t="",e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",H,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt},W.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},W.prototype.transformRequest=function(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}},W.prototype.normalizeStyleURL=function(t,e){if(!q(t))return t;var n=Q(t);return n.path="/styles/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeGlyphsURL=function(t,e){if(!q(t))return t;var n=Q(t);return n.path="/fonts/v1"+n.path,this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeSourceURL=function(t,e){if(!q(t))return t;var n=Q(t);return n.path="/v4/"+n.authority+".json",n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)},W.prototype.normalizeSpriteURL=function(t,e,n,r){var i=Q(t);return q(t)?(i.path="/styles/v1"+i.path+"/sprite"+e+n,this._makeAPIURL(i,this._customAccessToken||r)):(i.path+=""+e+n,J(i))},W.prototype.normalizeTileURL=function(t,e){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!q(t))return t;var n=Q(t);n.path=n.path.replace(/(\.(png|jpg)\d*)(?=$)/,(B.devicePixelRatio>=2||512===e?"@2x":"")+(j.supported?".webp":"$1")),n.path=n.path.replace(/^.+\/v4\//,"/"),n.path="/v4"+n.path;var r=this._customAccessToken||function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e].match(/^access_token=(.*)$/);if(r)return r[1]}return null}(n.params)||U.ACCESS_TOKEN;return U.REQUIRE_ACCESS_TOKEN&&r&&this._skuToken&&n.params.push("sku="+this._skuToken),this._makeAPIURL(n,r)},W.prototype.canonicalizeTileURL=function(t,e){var n=Q(t);if(!n.path.match(/(^\/v4\/)/)||!n.path.match(/\.[\w]+$/))return t;var r="mapbox://tiles/";r+=n.path.replace("/v4/","");var i=n.params;return e&&(i=i.filter((function(t){return!t.match(/^access_token=/)}))),i.length&&(r+="?"+i.join("&")),r},W.prototype.canonicalizeTileset=function(t,e){for(var n=!!e&&q(e),r=[],i=0,o=t.tiles||[];i<o.length;i+=1){var a=o[i];Y(a)?r.push(this.canonicalizeTileURL(a,n)):r.push(a)}return r},W.prototype._makeAPIURL=function(t,e){var n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=Q(U.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){var i=t.params.indexOf("secure");i>=0&&t.params.splice(i,1)}if("/"!==r.path&&(t.path=""+r.path+t.path),!U.REQUIRE_ACCESS_TOKEN)return J(t);if(!(e=e||U.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+n);if("s"===e[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+n);return t.params=t.params.filter((function(t){return-1===t.indexOf("access_token")})),t.params.push("access_token="+e),J(t)};var X=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Y(t){return X.test(t)}var K=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Q(t){var e=t.match(K);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function J(t){var e=t.params.length?"?"+t.params.join("&"):"";return t.protocol+"://"+t.authority+t.path+e}function $(t){if(!t)return null;var e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(s.atob(e[1]).split("").map((function(t){return"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)})).join("")))}catch(t){return null}}var tt=function(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};tt.prototype.getStorageKey=function(t){var e,n=$(U.ACCESS_TOKEN);return e=n&&n.u?s.btoa(encodeURIComponent(n.u).replace(/%([0-9A-F]{2})/g,(function(t,e){return String.fromCharCode(Number("0x"+e))}))):U.ACCESS_TOKEN||"",t?"mapbox.eventData."+t+":"+e:"mapbox.eventData:"+e},tt.prototype.fetchEventData=function(){var t=I("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{var r=s.localStorage.getItem(e);r&&(this.eventData=JSON.parse(r));var i=s.localStorage.getItem(n);i&&(this.anonId=i)}catch(t){S("Unable to read from LocalStorage")}},tt.prototype.saveEventData=function(){var t=I("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{s.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&s.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){S("Unable to write to LocalStorage")}},tt.prototype.processRequests=function(t){},tt.prototype.postEvent=function(t,e,n,r){var i=this;if(U.EVENTS_URL){var o=Q(U.EVENTS_URL);o.params.push("access_token="+(r||U.ACCESS_TOKEN||""));var a={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:H,userId:this.anonId},s=e?p(a,e):a,u={url:J(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([s])};this.pendingRequest=wt(u,(function(t){i.pendingRequest=null,n(t),i.saveEventData(),i.processRequests(r)}))}},tt.prototype.queueRequest=function(t,e){this.queue.push(t),this.processRequests(e)};var et,nt,rt=function(t){function e(){t.call(this,"map.load"),this.success={},this.skuToken=""}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postMapLoadEvent=function(t,e,n,r){this.skuToken=n;var i=!(!r&&!U.ACCESS_TOKEN),o=Array.isArray(t)&&t.some((function(t){return q(t)||Y(t)}));U.EVENTS_URL&&i&&o&&this.queueRequest({id:e,timestamp:Date.now()},r)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){var n=this.queue.shift(),r=n.id,i=n.timestamp;r&&this.success[r]||(this.anonId||this.fetchEventData(),g(this.anonId)||(this.anonId=m()),this.postEvent(i,{skuToken:this.skuToken},(function(t){t||r&&(e.success[r]=!0)}),t))}},e}(tt),it=new(function(t){function e(e){t.call(this,"appUserTurnstile"),this._customAccessToken=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.postTurnstileEvent=function(t,e){U.EVENTS_URL&&U.ACCESS_TOKEN&&Array.isArray(t)&&t.some((function(t){return q(t)||Y(t)}))&&this.queueRequest(Date.now(),e)},e.prototype.processRequests=function(t){var e=this;if(!this.pendingRequest&&0!==this.queue.length){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var n=$(U.ACCESS_TOKEN),r=n?n.u:U.ACCESS_TOKEN,i=r!==this.eventData.tokenU;g(this.anonId)||(this.anonId=m(),i=!0);var o=this.queue.shift();if(this.eventData.lastSuccess){var a=new Date(this.eventData.lastSuccess),s=new Date(o),u=(o-this.eventData.lastSuccess)/864e5;i=i||u>=1||u<-1||a.getDate()!==s.getDate()}else i=!0;if(!i)return this.processRequests();this.postEvent(o,{"enabled.telemetry":!1},(function(t){t||(e.eventData.lastSuccess=o,e.eventData.tokenU=r)}),t)}},e}(tt)),ot=it.postTurnstileEvent.bind(it),at=new rt,st=at.postMapLoadEvent.bind(at),ut=500,ct=50;function lt(){s.caches&&!et&&(et=s.caches.open("mapbox-tiles"))}function ht(t){var e=t.indexOf("?");return e<0?t:t.slice(0,e)}var ft,pt=1/0;function dt(){return null==ft&&(ft=s.OffscreenCanvas&&new s.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof s.createImageBitmap),ft}var vt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(vt);var mt,gt,yt=function(t){function e(e,n,r){401===n&&Y(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),t.call(this,e),this.status=n,this.url=r,this.name=this.constructor.name,this.message=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},e}(Error),_t=C()?function(){return self.worker&&self.worker.referrer}:function(){return("blob:"===s.location.protocol?s.parent:s).location.href},xt=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(_t())&&!/^\w+:/.test(n))){if(s.fetch&&s.Request&&s.AbortController&&s.Request.prototype.hasOwnProperty("signal"))return function(t,e){var n,r=new s.AbortController,i=new s.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:_t(),signal:r.signal}),o=!1,a=!1,u=(n=i.url).indexOf("sku=")>0&&Y(n);"json"===t.type&&i.headers.set("Accept","application/json");var c=function(n,r,o){if(!a){if(n&&"SecurityError"!==n.message&&S(n),r&&o)return l(r);var c=Date.now();s.fetch(i).then((function(n){if(n.ok){var r=u?n.clone():null;return l(n,r,c)}return e(new yt(n.statusText,n.status,t.url))})).catch((function(t){20!==t.code&&e(new Error(t.message))}))}},l=function(n,r,u){("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then((function(t){a||(r&&u&&function(t,e,n){if(lt(),et){var r={status:e.status,statusText:e.statusText,headers:new s.Headers};e.headers.forEach((function(t,e){return r.headers.set(e,t)}));var i=k(e.headers.get("Cache-Control")||"");i["no-store"]||(i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString()),new Date(r.headers.get("Expires")).getTime()-n<42e4||function(t,e){if(void 0===nt)try{new Response(new ReadableStream),nt=!0}catch(t){nt=!1}nt?e(t.body):t.blob().then(e)}(e,(function(e){var n=new s.Response(e,r);lt(),et&&et.then((function(e){return e.put(ht(t.url),n)})).catch((function(t){return S(t.message)}))})))}}(i,r,u),o=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))})).catch((function(t){a||e(new Error(t.message))}))};return u?function(t,e){if(lt(),!et)return e(null);var n=ht(t.url);et.then((function(t){t.match(n).then((function(r){var i=function(t){if(!t)return!1;var e=new Date(t.headers.get("Expires")||0),n=k(t.headers.get("Cache-Control")||"");return e>Date.now()&&!n["no-cache"]}(r);t.delete(n),i&&t.put(n,r.clone()),e(null,r,i)})).catch(e)})).catch(e)}(i,c):c(null,null),{cancel:function(){a=!0,o||r.abort()}}}(t,e);if(C()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){var n=new s.XMLHttpRequest;for(var r in n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer"),t.headers)n.setRequestHeader(r,t.headers[r]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=function(){e(new Error(n.statusText))},n.onload=function(){if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){var r=n.response;if("json"===t.type)try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new yt(n.statusText,n.status,t.url))},n.send(t.body),{cancel:function(){return n.abort()}}}(t,e)},bt=function(t,e){return xt(p(t,{type:"arrayBuffer"}),e)},wt=function(t,e){return xt(p(t,{method:"POST"}),e)},Et="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";mt=[],gt=0;var St=function t(e,n){if(j.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),gt>=U.MAX_PARALLEL_IMAGE_REQUESTS){var r={requestParameters:e,callback:n,cancelled:!1,cancel:function(){this.cancelled=!0}};return mt.push(r),r}gt++;var i=!1,o=function(){if(!i)for(i=!0,gt--;mt.length&&gt<U.MAX_PARALLEL_IMAGE_REQUESTS;){var e=mt.shift();e.cancelled||(e.cancel=t(e.requestParameters,e.callback).cancel)}},a=bt(e,(function(t,e,r,i){o(),t?n(t):e&&(dt()?function(t,e){var n=new s.Blob([new Uint8Array(t)],{type:"image/png"});s.createImageBitmap(n).then((function(t){e(null,t)})).catch((function(t){e(new Error("Could not load image because of "+t.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))}))}(e,n):function(t,e,n,r){var i=new s.Image,o=s.URL;i.onload=function(){e(null,i),o.revokeObjectURL(i.src),i.onload=null,s.requestAnimationFrame((function(){i.src=Et}))},i.onerror=function(){return e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var a=new s.Blob([new Uint8Array(t)],{type:"image/png"});i.cacheControl=n,i.expires=r,i.src=t.byteLength?o.createObjectURL(a):Et}(e,n,r,i))}));return{cancel:function(){a.cancel(),o()}}};function At(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Tt(t,e,n){if(n&&n[t]){var r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}var Ct=function(t,e){void 0===e&&(e={}),p(this,e),this.type=t},kt=function(t){function e(e,n){void 0===n&&(n={}),t.call(this,"error",p({error:e},n))}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Ct),Mt=function(){};Mt.prototype.on=function(t,e){return this._listeners=this._listeners||{},At(t,e,this._listeners),this},Mt.prototype.off=function(t,e){return Tt(t,e,this._listeners),Tt(t,e,this._oneTimeListeners),this},Mt.prototype.once=function(t,e){return this._oneTimeListeners=this._oneTimeListeners||{},At(t,e,this._oneTimeListeners),this},Mt.prototype.fire=function(t,e){"string"==typeof t&&(t=new Ct(t,e||{}));var n=t.type;if(this.listens(n)){t.target=this;for(var r=0,i=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];r<i.length;r+=1)i[r].call(this,t);for(var o=0,a=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];o<a.length;o+=1){var s=a[o];Tt(n,s,this._oneTimeListeners),s.call(this,t)}var u=this._eventedParent;u&&(p(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),u.fire(t))}return this},Mt.prototype.listens=function(t){return this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t)},Mt.prototype.setEventedParent=function(t,e){return this._eventedParent=t,this._eventedParentData=e,this};var Pt={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},It=function(t,e,n,r){this.message=(t?t+": ":"")+n,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)};function Rt(t){var e=t.value;return e?[new It(t.key,e,"constants have been deprecated as of v8")]:[]}function Lt(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];for(var r=0,i=e;r<i.length;r+=1){var o=i[r];for(var a in o)t[a]=o[a]}return t}function Ot(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function Dt(t){if(Array.isArray(t))return t.map(Dt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){var e={};for(var n in t)e[n]=Dt(t[n]);return e}return Ot(t)}var Nt=function(t){function e(e,n){t.call(this,n),this.message=n,this.key=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Error),zt=function(t,e){void 0===e&&(e=[]),this.parent=t,this.bindings={};for(var n=0,r=e;n<r.length;n+=1){var i=r[n];this.bindings[i[0]]=i[1]}};zt.prototype.concat=function(t){return new zt(this,t)},zt.prototype.get=function(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(t+" not found in scope.")},zt.prototype.has=function(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)};var Ft={kind:"null"},Bt={kind:"number"},Ut={kind:"string"},jt={kind:"boolean"},Zt={kind:"color"},Vt={kind:"object"},Gt={kind:"value"},Ht={kind:"collator"},Wt={kind:"formatted"},qt={kind:"resolvedImage"};function Xt(t,e){return{kind:"array",itemType:t,N:e}}function Yt(t){if("array"===t.kind){var e=Yt(t.itemType);return"number"==typeof t.N?"array<"+e+", "+t.N+">":"value"===t.itemType.kind?"array":"array<"+e+">"}return t.kind}var Kt=[Ft,Bt,Ut,jt,Zt,Wt,Vt,Xt(Gt),qt];function Qt(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!Qt(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(var n=0,r=Kt;n<r.length;n+=1)if(!Qt(r[n],e))return null}return"Expected "+Yt(t)+" but found "+Yt(e)+" instead."}function Jt(t,e){return e.some((function(e){return e.kind===t.kind}))}function $t(t,e){return e.some((function(e){return"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==o(t):e===o(t)}))}var te=e((function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return r("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function a(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,s=t.replace(/ /g,"").toLowerCase();if(s in n)return n[s].slice();if("#"===s[0])return 4===s.length?(e=parseInt(s.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===s.length&&(e=parseInt(s.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var u=s.indexOf("("),c=s.indexOf(")");if(-1!==u&&c+1===s.length){var l=s.substr(0,u),h=s.substr(u+1,c-(u+1)).split(","),f=1;switch(l){case"rgba":if(4!==h.length)return null;f=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),f];case"hsla":if(4!==h.length)return null;f=o(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,d=o(h[1]),v=o(h[2]),m=v<=.5?v*(d+1):v+d-v*d,g=2*v-m;return[r(255*a(g,m,p+1/3)),r(255*a(g,m,p)),r(255*a(g,m,p-1/3)),f];default:return null}}return null}}catch(t){}})).parseCSSColor,ee=function(t,e,n,r){void 0===r&&(r=1),this.r=t,this.g=e,this.b=n,this.a=r};ee.parse=function(t){if(t){if(t instanceof ee)return t;if("string"==typeof t){var e=te(t);if(e)return new ee(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3])}}},ee.prototype.toString=function(){var t=this.toArray(),e=t[1],n=t[2],r=t[3];return"rgba("+Math.round(t[0])+","+Math.round(e)+","+Math.round(n)+","+r+")"},ee.prototype.toArray=function(){var t=this.a;return 0===t?[0,0,0,0]:[255*this.r/t,255*this.g/t,255*this.b/t,t]},ee.black=new ee(0,0,0,1),ee.white=new ee(1,1,1,1),ee.transparent=new ee(0,0,0,0),ee.red=new ee(1,0,0,1);var ne=function(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};ne.prototype.compare=function(t,e){return this.collator.compare(t,e)},ne.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var re=function(t,e,n,r,i){this.text=t,this.image=e,this.scale=n,this.fontStack=r,this.textColor=i},ie=function(t){this.sections=t};ie.fromString=function(t){return new ie([new re(t,null,null,null,null)])},ie.prototype.isEmpty=function(){return 0===this.sections.length||!this.sections.some((function(t){return 0!==t.text.length||t.image&&0!==t.image.name.length}))},ie.factory=function(t){return t instanceof ie?t:ie.fromString(t)},ie.prototype.toString=function(){return 0===this.sections.length?"":this.sections.map((function(t){return t.text})).join("")},ie.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];if(r.image)t.push(["image",r.image.name]);else{t.push(r.text);var i={};r.fontStack&&(i["text-font"]=["literal",r.fontStack.split(",")]),r.scale&&(i["font-scale"]=r.scale),r.textColor&&(i["text-color"]=["rgba"].concat(r.textColor.toArray())),t.push(i)}}return t};var oe=function(t){this.name=t.name,this.available=t.available};function ae(t,e,n,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:"Invalid rgba value ["+[t,e,n,r].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+("number"==typeof r?[t,e,n,r]:[t,e,n]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function se(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof ee)return!0;if(t instanceof ne)return!0;if(t instanceof ie)return!0;if(t instanceof oe)return!0;if(Array.isArray(t)){for(var e=0,n=t;e<n.length;e+=1)if(!se(n[e]))return!1;return!0}if("object"==o(t)){for(var r in t)if(!se(t[r]))return!1;return!0}return!1}function ue(t){if(null===t)return Ft;if("string"==typeof t)return Ut;if("boolean"==typeof t)return jt;if("number"==typeof t)return Bt;if(t instanceof ee)return Zt;if(t instanceof ne)return Ht;if(t instanceof ie)return Wt;if(t instanceof oe)return qt;if(Array.isArray(t)){for(var e,n=t.length,r=0,i=t;r<i.length;r+=1){var o=ue(i[r]);if(e){if(e===o)continue;e=Gt;break}e=o}return Xt(e||Gt,n)}return Vt}function ce(t){var e=o(t);return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ee||t instanceof ie||t instanceof oe?t.toString():JSON.stringify(t)}oe.prototype.toString=function(){return this.name},oe.fromString=function(t){return t?new oe({name:t,available:!1}):null},oe.prototype.serialize=function(){return["image",this.name]};var le=function(t,e){this.type=t,this.value=e};le.parse=function(t,e){if(2!==t.length)return e.error("'literal' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(!se(t[1]))return e.error("invalid value");var n=t[1],r=ue(n),i=e.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new le(r,n)},le.prototype.evaluate=function(){return this.value},le.prototype.eachChild=function(){},le.prototype.outputDefined=function(){return!0},le.prototype.serialize=function(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ee?["rgba"].concat(this.value.toArray()):this.value instanceof ie?this.value.serialize():this.value};var he=function(t){this.name="ExpressionEvaluationError",this.message=t};he.prototype.toJSON=function(){return this.message};var fe={string:Ut,number:Bt,boolean:jt,object:Vt},pe=function(t,e){this.type=t,this.args=e};pe.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n,r=1,i=t[0];if("array"===i){var o,a;if(t.length>2){var s=t[1];if("string"!=typeof s||!(s in fe)||"object"===s)return e.error('The item type argument of "array" must be one of string, number, boolean',1);o=fe[s],r++}else o=Gt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);a=t[2],r++}n=Xt(o,a)}else n=fe[i];for(var u=[];r<t.length;r++){var c=e.parse(t[r],r,Gt);if(!c)return null;u.push(c)}return new pe(n,u)},pe.prototype.evaluate=function(t){for(var e=0;e<this.args.length;e++){var n=this.args[e].evaluate(t);if(!Qt(this.type,ue(n)))return n;if(e===this.args.length-1)throw new he("Expected value to be of type "+Yt(this.type)+", but found "+Yt(ue(n))+" instead.")}return null},pe.prototype.eachChild=function(t){this.args.forEach(t)},pe.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},pe.prototype.serialize=function(){var t=this.type,e=[t.kind];if("array"===t.kind){var n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);var r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map((function(t){return t.serialize()})))};var de=function(t){this.type=Wt,this.sections=t};de.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[1];if(!Array.isArray(n)&&"object"==o(n))return e.error("First argument must be an image or text section.");for(var r=[],i=!1,a=1;a<=t.length-1;++a){var s=t[a];if(i&&"object"==o(s)&&!Array.isArray(s)){i=!1;var u=null;if(s["font-scale"]&&!(u=e.parse(s["font-scale"],1,Bt)))return null;var c=null;if(s["text-font"]&&!(c=e.parse(s["text-font"],1,Xt(Ut))))return null;var l=null;if(s["text-color"]&&!(l=e.parse(s["text-color"],1,Zt)))return null;var h=r[r.length-1];h.scale=u,h.font=c,h.textColor=l}else{var f=e.parse(t[a],1,Gt);if(!f)return null;var p=f.type.kind;if("string"!==p&&"value"!==p&&"null"!==p&&"resolvedImage"!==p)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:f,scale:null,font:null,textColor:null})}}return new de(r)},de.prototype.evaluate=function(t){return new ie(this.sections.map((function(e){var n=e.content.evaluate(t);return ue(n)===qt?new re("",n,null,null,null):new re(ce(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)})))},de.prototype.eachChild=function(t){for(var e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t(r.content),r.scale&&t(r.scale),r.font&&t(r.font),r.textColor&&t(r.textColor)}},de.prototype.outputDefined=function(){return!1},de.prototype.serialize=function(){for(var t=["format"],e=0,n=this.sections;e<n.length;e+=1){var r=n[e];t.push(r.content.serialize());var i={};r.scale&&(i["font-scale"]=r.scale.serialize()),r.font&&(i["text-font"]=r.font.serialize()),r.textColor&&(i["text-color"]=r.textColor.serialize()),t.push(i)}return t};var ve=function(t){this.type=qt,this.input=t};ve.parse=function(t,e){if(2!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Ut);return n?new ve(n):e.error("No image name provided.")},ve.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=oe.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n},ve.prototype.eachChild=function(t){t(this.input)},ve.prototype.outputDefined=function(){return!1},ve.prototype.serialize=function(){return["image",this.input.serialize()]};var me={"to-boolean":jt,"to-color":Zt,"to-number":Bt,"to-string":Ut},ge=function(t,e){this.type=t,this.args=e};ge.parse=function(t,e){if(t.length<2)return e.error("Expected at least one argument.");var n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");for(var r=me[n],i=[],o=1;o<t.length;o++){var a=e.parse(t[o],o,Gt);if(!a)return null;i.push(a)}return new ge(r,i)},ge.prototype.evaluate=function(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){for(var e,n,r=0,i=this.args;r<i.length;r+=1){if(n=null,(e=i[r].evaluate(t))instanceof ee)return e;if("string"==typeof e){var o=t.parseColor(e);if(o)return o}else if(Array.isArray(e)&&!(n=e.length<3||e.length>4?"Invalid rbga value "+JSON.stringify(e)+": expected an array containing either three or four numeric values.":ae(e[0],e[1],e[2],e[3])))return new ee(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new he(n||"Could not parse color from value '"+("string"==typeof e?e:String(JSON.stringify(e)))+"'")}if("number"===this.type.kind){for(var a=null,s=0,u=this.args;s<u.length;s+=1){if(null===(a=u[s].evaluate(t)))return 0;var c=Number(a);if(!isNaN(c))return c}throw new he("Could not convert "+JSON.stringify(a)+" to number.")}return"formatted"===this.type.kind?ie.fromString(ce(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?oe.fromString(ce(this.args[0].evaluate(t))):ce(this.args[0].evaluate(t))},ge.prototype.eachChild=function(t){this.args.forEach(t)},ge.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},ge.prototype.serialize=function(){if("formatted"===this.type.kind)return new de([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new ve(this.args[0]).serialize();var t=["to-"+this.type.kind];return this.eachChild((function(e){t.push(e.serialize())})),t};var ye=["Unknown","Point","LineString","Polygon"],_e=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};_e.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},_e.prototype.geometryType=function(){return this.feature?"number"==typeof this.feature.type?ye[this.feature.type]:this.feature.type:null},_e.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},_e.prototype.canonicalID=function(){return this.canonical},_e.prototype.properties=function(){return this.feature&&this.feature.properties||{}},_e.prototype.parseColor=function(t){var e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ee.parse(t)),e};var xe=function(t,e,n,r){this.name=t,this.type=e,this._evaluate=n,this.args=r};xe.prototype.evaluate=function(t){return this._evaluate(t,this.args)},xe.prototype.eachChild=function(t){this.args.forEach(t)},xe.prototype.outputDefined=function(){return!1},xe.prototype.serialize=function(){return[this.name].concat(this.args.map((function(t){return t.serialize()})))},xe.parse=function(t,e){var n,r=t[0],i=xe.definitions[r];if(!i)return e.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0);for(var o=Array.isArray(i)?i[0]:i.type,a=Array.isArray(i)?[[i[1],i[2]]]:i.overloads,s=a.filter((function(e){var n=e[0];return!Array.isArray(n)||n.length===t.length-1})),u=null,c=0,l=s;c<l.length;c+=1){var h=l[c],f=h[0],p=h[1];u=new Ze(e.registry,e.path,null,e.scope);for(var d=[],v=!1,m=1;m<t.length;m++){var g=t[m],y=Array.isArray(f)?f[m-1]:f.type,_=u.parse(g,1+d.length,y);if(!_){v=!0;break}d.push(_)}if(!v)if(Array.isArray(f)&&f.length!==d.length)u.error("Expected "+f.length+" arguments, but found "+d.length+" instead.");else{for(var x=0;x<d.length;x++){var b=Array.isArray(f)?f[x]:f.type,w=d[x];u.concat(x+1).checkSubtype(b,w.type)}if(0===u.errors.length)return new xe(r,o,p,d)}}if(1===s.length)(n=e.errors).push.apply(n,u.errors);else{for(var E=(s.length?s:a).map((function(t){var e;return e=t[0],Array.isArray(e)?"("+e.map(Yt).join(", ")+")":"("+Yt(e.type)+"...)"})).join(" | "),S=[],A=1;A<t.length;A++){var T=e.parse(t[A],1+S.length);if(!T)return null;S.push(Yt(T.type))}e.error("Expected arguments of type "+E+", but found ("+S.join(", ")+") instead.")}return null},xe.register=function(t,e){for(var n in xe.definitions=e,e)t[n]=xe};var be=function(t,e,n){this.type=Ht,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e};function we(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function Ee(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Se(t,e){var n=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(n*i*8192),Math.round(r*i*8192)]}function Ae(t,e,n){return e[1]>t[1]!=n[1]>t[1]&&t[0]<(n[0]-e[0])*(t[1]-e[1])/(n[1]-e[1])+e[0]}function Te(t,e){for(var n,r,i,o,a,s,u,c=!1,l=0,h=e.length;l<h;l++)for(var f=e[l],p=0,d=f.length;p<d-1;p++){if((o=(n=t)[0]-(r=f[p])[0])*(u=n[1]-(i=f[p+1])[1])-(s=n[0]-i[0])*(a=n[1]-r[1])==0&&o*s<=0&&a*u<=0)return!1;Ae(t,f[p],f[p+1])&&(c=!c)}return c}function Ce(t,e){for(var n=0;n<e.length;n++)if(Te(t,e[n]))return!0;return!1}function ke(t,e,n,r){var i=r[0]-n[0],o=r[1]-n[1],a=(t[0]-n[0])*o-i*(t[1]-n[1]),s=(e[0]-n[0])*o-i*(e[1]-n[1]);return a>0&&s<0||a<0&&s>0}function Me(t,e,n){for(var r=0,i=n;r<i.length;r+=1)for(var o=i[r],a=0;a<o.length-1;++a)if(0!=(h=[(l=o[a+1])[0]-(c=o[a])[0],l[1]-c[1]])[0]*(f=[(u=e)[0]-(s=t)[0],u[1]-s[1]])[1]-h[1]*f[0]&&ke(s,u,c,l)&&ke(c,l,s,u))return!0;var s,u,c,l,h,f;return!1}function Pe(t,e){for(var n=0;n<t.length;++n)if(!Te(t[n],e))return!1;for(var r=0;r<t.length-1;++r)if(Me(t[r],t[r+1],e))return!1;return!0}function Ie(t,e){for(var n=0;n<e.length;n++)if(Pe(t,e[n]))return!0;return!1}function Re(t,e,n){for(var r=[],i=0;i<t.length;i++){for(var o=[],a=0;a<t[i].length;a++){var s=Se(t[i][a],n);we(e,s),o.push(s)}r.push(o)}return r}function Le(t,e,n){for(var r=[],i=0;i<t.length;i++){var o=Re(t[i],e,n);r.push(o)}return r}function Oe(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){var i=.5*r,o=t[0]-n[0]>i?-r:n[0]-t[0]>i?r:0;0===o&&(o=t[0]-n[2]>i?-r:n[2]-t[0]>i?r:0),t[0]+=o}we(e,t)}function De(t,e,n,r){for(var i=8192*Math.pow(2,r.z),o=[8192*r.x,8192*r.y],a=[],s=0,u=t;s<u.length;s+=1)for(var c=0,l=u[s];c<l.length;c+=1){var h=l[c],f=[h.x+o[0],h.y+o[1]];Oe(f,e,n,i),a.push(f)}return a}function Ne(t,e,n,r){for(var i,o=8192*Math.pow(2,r.z),a=[8192*r.x,8192*r.y],s=[],u=0,c=t;u<c.length;u+=1){for(var l=[],h=0,f=c[u];h<f.length;h+=1){var p=f[h],d=[p.x+a[0],p.y+a[1]];we(e,d),l.push(d)}s.push(l)}if(e[2]-e[0]<=o/2){(i=e)[0]=i[1]=1/0,i[2]=i[3]=-1/0;for(var v=0,m=s;v<m.length;v+=1)for(var g=0,y=m[v];g<y.length;g+=1)Oe(y[g],e,n,o)}return s}be.parse=function(t,e){if(2!==t.length)return e.error("Expected one argument.");var n=t[1];if("object"!=o(n)||Array.isArray(n))return e.error("Collator options argument must be an object.");var r=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,jt);if(!r)return null;var i=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,jt);if(!i)return null;var a=null;return n.locale&&!(a=e.parse(n.locale,1,Ut))?null:new be(r,i,a)},be.prototype.evaluate=function(t){return new ne(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)},be.prototype.eachChild=function(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)},be.prototype.outputDefined=function(){return!1},be.prototype.serialize=function(){var t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]};var ze=function(t,e){this.type=jt,this.geojson=t,this.geometries=e};function Fe(t){if(t instanceof xe){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof ze)return!1;var e=!0;return t.eachChild((function(t){e&&!Fe(t)&&(e=!1)})),e}function Be(t){if(t instanceof xe&&"feature-state"===t.name)return!1;var e=!0;return t.eachChild((function(t){e&&!Be(t)&&(e=!1)})),e}function Ue(t,e){if(t instanceof xe&&e.indexOf(t.name)>=0)return!1;var n=!0;return t.eachChild((function(t){n&&!Ue(t,e)&&(n=!1)})),n}ze.parse=function(t,e){if(2!==t.length)return e.error("'within' expression requires exactly one argument, but found "+(t.length-1)+" instead.");if(se(t[1])){var n=t[1];if("FeatureCollection"===n.type)for(var r=0;r<n.features.length;++r){var i=n.features[r].geometry.type;if("Polygon"===i||"MultiPolygon"===i)return new ze(n,n.features[r].geometry)}else if("Feature"===n.type){var o=n.geometry.type;if("Polygon"===o||"MultiPolygon"===o)return new ze(n,n.geometry)}else if("Polygon"===n.type||"MultiPolygon"===n.type)return new ze(n,n)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")},ze.prototype.evaluate=function(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Re(e.coordinates,r,i),a=De(t.geometry(),n,r,i);if(!Ee(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Te(u[s],o))return!1}if("MultiPolygon"===e.type){var c=Le(e.coordinates,r,i),l=De(t.geometry(),n,r,i);if(!Ee(n,r))return!1;for(var h=0,f=l;h<f.length;h+=1)if(!Ce(f[h],c))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){var n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if("Polygon"===e.type){var o=Re(e.coordinates,r,i),a=Ne(t.geometry(),n,r,i);if(!Ee(n,r))return!1;for(var s=0,u=a;s<u.length;s+=1)if(!Pe(u[s],o))return!1}if("MultiPolygon"===e.type){var c=Le(e.coordinates,r,i),l=Ne(t.geometry(),n,r,i);if(!Ee(n,r))return!1;for(var h=0,f=l;h<f.length;h+=1)if(!Ie(f[h],c))return!1}return!0}(t,this.geometries)}return!1},ze.prototype.eachChild=function(){},ze.prototype.outputDefined=function(){return!0},ze.prototype.serialize=function(){return["within",this.geojson]};var je=function(t,e){this.type=e.type,this.name=t,this.boundExpression=e};je.parse=function(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");var n=t[1];return e.scope.has(n)?new je(n,e.scope.get(n)):e.error('Unknown variable "'+n+'". Make sure "'+n+'" has been bound in an enclosing "let" expression before using it.',1)},je.prototype.evaluate=function(t){return this.boundExpression.evaluate(t)},je.prototype.eachChild=function(){},je.prototype.outputDefined=function(){return!1},je.prototype.serialize=function(){return["var",this.name]};var Ze=function(t,e,n,r,i){void 0===e&&(e=[]),void 0===r&&(r=new zt),void 0===i&&(i=[]),this.registry=t,this.path=e,this.key=e.map((function(t){return"["+t+"]"})).join(""),this.scope=r,this.errors=i,this.expectedType=n};function Ve(t,e){for(var n,r=t.length-1,i=0,o=r,a=0;i<=o;)if((n=t[a=Math.floor((i+o)/2)])<=e){if(a===r||e<t[a+1])return a;i=a+1}else{if(!(n>e))throw new he("Input is not a number.");o=a-1}return 0}Ze.prototype.parse=function(t,e,n,r,i){return void 0===i&&(i={}),e?this.concat(e,n,r)._parse(t,i):this._parse(t,i)},Ze.prototype._parse=function(t,e){function n(t,e,n){return"assert"===n?new pe(e,[t]):"coerce"===n?new ge(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var r=t[0];if("string"!=typeof r)return this.error("Expression name must be a string, but found "+o(r)+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var i=this.registry[r];if(i){var a=i.parse(t,this);if(!a)return null;if(this.expectedType){var s=this.expectedType,u=a.type;if("string"!==s.kind&&"number"!==s.kind&&"boolean"!==s.kind&&"object"!==s.kind&&"array"!==s.kind||"value"!==u.kind)if("color"!==s.kind&&"formatted"!==s.kind&&"resolvedImage"!==s.kind||"value"!==u.kind&&"string"!==u.kind){if(this.checkSubtype(s,u))return null}else a=n(a,s,e.typeAnnotation||"coerce");else a=n(a,s,e.typeAnnotation||"assert")}if(!(a instanceof le)&&"resolvedImage"!==a.type.kind&&function t(e){if(e instanceof je)return t(e.boundExpression);if(e instanceof xe&&"error"===e.name)return!1;if(e instanceof be)return!1;if(e instanceof ze)return!1;var n=e instanceof ge||e instanceof pe,r=!0;return e.eachChild((function(e){r=n?r&&t(e):r&&e instanceof le})),!!r&&Fe(e)&&Ue(e,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(a)){var c=new _e;try{a=new le(a.type,a.evaluate(c))}catch(t){return this.error(t.message),null}}return a}return this.error('Unknown expression "'+r+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==o(t)?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+o(t)+" instead.")},Ze.prototype.concat=function(t,e,n){var r="number"==typeof t?this.path.concat(t):this.path,i=n?this.scope.concat(n):this.scope;return new Ze(this.registry,r,e||null,i,this.errors)},Ze.prototype.error=function(t){for(var e=[],n=arguments.length-1;n-- >0;)e[n]=arguments[n+1];var r=""+this.key+e.map((function(t){return"["+t+"]"})).join("");this.errors.push(new Nt(r,t))},Ze.prototype.checkSubtype=function(t,e){var n=Qt(t,e);return n&&this.error(n),n};var Ge=function(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(var r=0,i=n;r<i.length;r+=1){var o=i[r],a=o[1];this.labels.push(o[0]),this.outputs.push(a)}};function He(t,e,n){return t*(1-n)+e*n}Ge.parse=function(t,e){if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");var n=e.parse(t[1],1,Bt);if(!n)return null;var r=[],i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(var o=1;o<t.length;o+=2){var a=1===o?-1/0:t[o],s=t[o+1],u=o,c=o+1;if("number"!=typeof a)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',u);if(r.length&&r[r.length-1][0]>=a)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',u);var l=e.parse(s,c,i);if(!l)return null;i=i||l.type,r.push([a,l])}return new Ge(i,n,r)},Ge.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;return r>=e[i-1]?n[i-1].evaluate(t):n[Ve(e,r)].evaluate(t)},Ge.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},Ge.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},Ge.prototype.serialize=function(){for(var t=["step",this.input.serialize()],e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t};var We=Object.freeze({__proto__:null,number:He,color:function(t,e,n){return new ee(He(t.r,e.r,n),He(t.g,e.g,n),He(t.b,e.b,n),He(t.a,e.a,n))},array:function(t,e,n){return t.map((function(t,r){return He(t,e[r],n)}))}}),qe=6/29*3*(6/29),Xe=Math.PI/180,Ye=180/Math.PI;function Ke(t){return t>.008856451679035631?Math.pow(t,1/3):t/qe+4/29}function Qe(t){return t>6/29?t*t*t:qe*(t-4/29)}function Je(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function $e(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function tn(t){var e=$e(t.r),n=$e(t.g),r=$e(t.b),i=Ke((.4124564*e+.3575761*n+.1804375*r)/.95047),o=Ke((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-Ke((.0193339*e+.119192*n+.9503041*r)/1.08883)),alpha:t.a}}function en(t){var e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*Qe(e),n=.95047*Qe(n),r=1.08883*Qe(r),new ee(Je(3.2404542*n-1.5371385*e-.4985314*r),Je(-.969266*n+1.8760108*e+.041556*r),Je(.0556434*n-.2040259*e+1.0572252*r),t.alpha)}function nn(t,e,n){var r=e-t;return t+n*(r>180||r<-180?r-360*Math.round(r/360):r)}var rn={forward:tn,reverse:en,interpolate:function(t,e,n){return{l:He(t.l,e.l,n),a:He(t.a,e.a,n),b:He(t.b,e.b,n),alpha:He(t.alpha,e.alpha,n)}}},on={forward:function(t){var e=tn(t),n=e.l,r=e.a,i=e.b,o=Math.atan2(i,r)*Ye;return{h:o<0?o+360:o,c:Math.sqrt(r*r+i*i),l:n,alpha:t.a}},reverse:function(t){var e=t.h*Xe,n=t.c;return en({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:nn(t.h,e.h,n),c:He(t.c,e.c,n),l:He(t.l,e.l,n),alpha:He(t.alpha,e.alpha,n)}}},an=Object.freeze({__proto__:null,lab:rn,hcl:on}),sn=function(t,e,n,r,i){this.type=t,this.operator=e,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(var o=0,a=i;o<a.length;o+=1){var s=a[o],u=s[1];this.labels.push(s[0]),this.outputs.push(u)}};function un(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}sn.interpolationFactor=function(t,e,r,i){var o=0;if("exponential"===t.name)o=un(e,t.base,r,i);else if("linear"===t.name)o=un(e,1,r,i);else if("cubic-bezier"===t.name){var a=t.controlPoints;o=new n(a[0],a[1],a[2],a[3]).solve(un(e,1,r,i))}return o},sn.parse=function(t,e){var n=t[0],r=t[1],i=t[2],o=t.slice(3);if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){var a=r[1];if("number"!=typeof a)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:a}}else{if("cubic-bezier"!==r[0])return e.error("Unknown interpolation type "+String(r[0]),1,0);var s=r.slice(1);if(4!==s.length||s.some((function(t){return"number"!=typeof t||t<0||t>1})))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:s}}if(t.length-1<4)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(!(i=e.parse(i,2,Bt)))return null;var u=[],c=null;"interpolate-hcl"===n||"interpolate-lab"===n?c=Zt:e.expectedType&&"value"!==e.expectedType.kind&&(c=e.expectedType);for(var l=0;l<o.length;l+=2){var h=o[l],f=o[l+1],p=l+3,d=l+4;if("number"!=typeof h)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',p);if(u.length&&u[u.length-1][0]>=h)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',p);var v=e.parse(f,d,c);if(!v)return null;c=c||v.type,u.push([h,v])}return"number"===c.kind||"color"===c.kind||"array"===c.kind&&"number"===c.itemType.kind&&"number"==typeof c.N?new sn(c,n,r,i,u):e.error("Type "+Yt(c)+" is not interpolatable.")},sn.prototype.evaluate=function(t){var e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);var r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);var i=e.length;if(r>=e[i-1])return n[i-1].evaluate(t);var o=Ve(e,r),a=sn.interpolationFactor(this.interpolation,r,e[o],e[o+1]),s=n[o].evaluate(t),u=n[o+1].evaluate(t);return"interpolate"===this.operator?We[this.type.kind.toLowerCase()](s,u,a):"interpolate-hcl"===this.operator?on.reverse(on.interpolate(on.forward(s),on.forward(u),a)):rn.reverse(rn.interpolate(rn.forward(s),rn.forward(u),a))},sn.prototype.eachChild=function(t){t(this.input);for(var e=0,n=this.outputs;e<n.length;e+=1)t(n[e])},sn.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))},sn.prototype.serialize=function(){var t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var e=[this.operator,t,this.input.serialize()],n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e};var cn=function(t,e){this.type=t,this.args=e};cn.parse=function(t,e){if(t.length<2)return e.error("Expectected at least one argument.");var n=null,r=e.expectedType;r&&"value"!==r.kind&&(n=r);for(var i=[],o=0,a=t.slice(1);o<a.length;o+=1){var s=e.parse(a[o],1+i.length,n,void 0,{typeAnnotation:"omit"});if(!s)return null;n=n||s.type,i.push(s)}var u=r&&i.some((function(t){return Qt(r,t.type)}));return new cn(u?Gt:n,i)},cn.prototype.evaluate=function(t){for(var e,n=null,r=0,i=0,o=this.args;i<o.length&&(r++,(n=o[i].evaluate(t))&&n instanceof oe&&!n.available&&(e||(e=n.name),n=null,r===this.args.length&&(n=e)),null===n);i+=1);return n},cn.prototype.eachChild=function(t){this.args.forEach(t)},cn.prototype.outputDefined=function(){return this.args.every((function(t){return t.outputDefined()}))},cn.prototype.serialize=function(){var t=["coalesce"];return this.eachChild((function(e){t.push(e.serialize())})),t};var ln=function(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e};ln.prototype.evaluate=function(t){return this.result.evaluate(t)},ln.prototype.eachChild=function(t){for(var e=0,n=this.bindings;e<n.length;e+=1)t(n[e][1]);t(this.result)},ln.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found "+(t.length-1)+" instead.");for(var n=[],r=1;r<t.length-1;r+=2){var i=t[r];if("string"!=typeof i)return e.error("Expected string, but found "+o(i)+" instead.",r);if(/[^a-zA-Z0-9_]/.test(i))return e.error("Variable names must contain only alphanumeric characters or '_'.",r);var a=e.parse(t[r+1],r+1);if(!a)return null;n.push([i,a])}var s=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return s?new ln(n,s):null},ln.prototype.outputDefined=function(){return this.result.outputDefined()},ln.prototype.serialize=function(){for(var t=["let"],e=0,n=this.bindings;e<n.length;e+=1){var r=n[e];t.push(r[0],r[1].serialize())}return t.push(this.result.serialize()),t};var hn=function(t,e,n){this.type=t,this.index=e,this.input=n};hn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Bt),r=e.parse(t[2],2,Xt(e.expectedType||Gt));return n&&r?new hn(r.type.itemType,n,r):null},hn.prototype.evaluate=function(t){var e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new he("Array index out of bounds: "+e+" < 0.");if(e>=n.length)throw new he("Array index out of bounds: "+e+" > "+(n.length-1)+".");if(e!==Math.floor(e))throw new he("Array index must be an integer, but found "+e+" instead.");return n[e]},hn.prototype.eachChild=function(t){t(this.index),t(this.input)},hn.prototype.outputDefined=function(){return!1},hn.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var fn=function(t,e){this.type=jt,this.needle=t,this.haystack=e};fn.parse=function(t,e){if(3!==t.length)return e.error("Expected 2 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Gt);return n&&r?Jt(n.type,[jt,Ut,Bt,Ft,Gt])?new fn(n,r):e.error("Expected first argument to be of type boolean, string, number or null, but found "+Yt(n.type)+" instead"):null},fn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!n)return!1;if(!$t(e,["boolean","string","number","null"]))throw new he("Expected first argument to be of type boolean, string, number or null, but found "+Yt(ue(e))+" instead.");if(!$t(n,["string","array"]))throw new he("Expected second argument to be of type array or string, but found "+Yt(ue(n))+" instead.");return n.indexOf(e)>=0},fn.prototype.eachChild=function(t){t(this.needle),t(this.haystack)},fn.prototype.outputDefined=function(){return!0},fn.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var pn=function(t,e,n){this.type=Bt,this.needle=t,this.haystack=e,this.fromIndex=n};pn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Gt);if(!n||!r)return null;if(!Jt(n.type,[jt,Ut,Bt,Ft,Gt]))return e.error("Expected first argument to be of type boolean, string, number or null, but found "+Yt(n.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Bt);return i?new pn(n,r,i):null}return new pn(n,r)},pn.prototype.evaluate=function(t){var e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!$t(e,["boolean","string","number","null"]))throw new he("Expected first argument to be of type boolean, string, number or null, but found "+Yt(ue(e))+" instead.");if(!$t(n,["string","array"]))throw new he("Expected second argument to be of type array or string, but found "+Yt(ue(n))+" instead.");if(this.fromIndex){var r=this.fromIndex.evaluate(t);return n.indexOf(e,r)}return n.indexOf(e)},pn.prototype.eachChild=function(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)},pn.prototype.outputDefined=function(){return!1},pn.prototype.serialize=function(){if(null!=this.fromIndex&&void 0!==this.fromIndex){var t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var dn=function(t,e,n,r,i,o){this.inputType=t,this.type=e,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o};dn.parse=function(t,e){if(t.length<5)return e.error("Expected at least 4 arguments, but found only "+(t.length-1)+".");if(t.length%2!=1)return e.error("Expected an even number of arguments.");var n,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);for(var i={},o=[],a=2;a<t.length-1;a+=2){var s=t[a],u=t[a+1];Array.isArray(s)||(s=[s]);var c=e.concat(a);if(0===s.length)return c.error("Expected at least one branch label.");for(var l=0,h=s;l<h.length;l+=1){var f=h[l];if("number"!=typeof f&&"string"!=typeof f)return c.error("Branch labels must be numbers or strings.");if("number"==typeof f&&Math.abs(f)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if("number"==typeof f&&Math.floor(f)!==f)return c.error("Numeric branch labels must be integer values.");if(n){if(c.checkSubtype(n,ue(f)))return null}else n=ue(f);if(void 0!==i[String(f)])return c.error("Branch labels must be unique.");i[String(f)]=o.length}var p=e.parse(u,a,r);if(!p)return null;r=r||p.type,o.push(p)}var d=e.parse(t[1],1,Gt);if(!d)return null;var v=e.parse(t[t.length-1],t.length-1,r);return v?"value"!==d.type.kind&&e.concat(1).checkSubtype(n,d.type)?null:new dn(n,r,d,i,o,v):null},dn.prototype.evaluate=function(t){var e=this.input.evaluate(t);return(ue(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)},dn.prototype.eachChild=function(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)},dn.prototype.outputDefined=function(){return this.outputs.every((function(t){return t.outputDefined()}))&&this.otherwise.outputDefined()},dn.prototype.serialize=function(){for(var t=this,e=["match",this.input.serialize()],n=[],r={},i=0,o=Object.keys(this.cases).sort();i<o.length;i+=1){var a=o[i];void 0===(h=r[this.cases[a]])?(r[this.cases[a]]=n.length,n.push([this.cases[a],[a]])):n[h][1].push(a)}for(var s=function(e){return"number"===t.inputType.kind?Number(e):e},u=0,c=n;u<c.length;u+=1){var l=c[u],h=l[0],f=l[1];e.push(1===f.length?s(f[0]):f.map(s)),e.push(this.outputs[outputIndex$1].serialize())}return e.push(this.otherwise.serialize()),e};var vn=function(t,e,n){this.type=t,this.branches=e,this.otherwise=n};vn.parse=function(t,e){if(t.length<4)return e.error("Expected at least 3 arguments, but found only "+(t.length-1)+".");if(t.length%2!=0)return e.error("Expected an odd number of arguments.");var n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);for(var r=[],i=1;i<t.length-1;i+=2){var o=e.parse(t[i],i,jt);if(!o)return null;var a=e.parse(t[i+1],i+1,n);if(!a)return null;r.push([o,a]),n=n||a.type}var s=e.parse(t[t.length-1],t.length-1,n);return s?new vn(n,r,s):null},vn.prototype.evaluate=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[1];if(r[0].evaluate(t))return i.evaluate(t)}return this.otherwise.evaluate(t)},vn.prototype.eachChild=function(t){for(var e=0,n=this.branches;e<n.length;e+=1){var r=n[e],i=r[1];t(r[0]),t(i)}t(this.otherwise)},vn.prototype.outputDefined=function(){return this.branches.every((function(t){return t[1].outputDefined()}))&&this.otherwise.outputDefined()},vn.prototype.serialize=function(){var t=["case"];return this.eachChild((function(e){t.push(e.serialize())})),t};var mn=function(t,e,n,r){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=r};function gn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function yn(t,e,n,r){return 0===r.compare(e,n)}function _n(t,e,n){var r="=="!==t&&"!="!==t;return function(){function i(t,e,n){this.type=jt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}return i.parse=function(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");var n=t[0],o=e.parse(t[1],1,Gt);if(!o)return null;if(!gn(n,o.type))return e.concat(1).error('"'+n+"\" comparisons are not supported for type '"+Yt(o.type)+"'.");var a=e.parse(t[2],2,Gt);if(!a)return null;if(!gn(n,a.type))return e.concat(2).error('"'+n+"\" comparisons are not supported for type '"+Yt(a.type)+"'.");if(o.type.kind!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot compare types '"+Yt(o.type)+"' and '"+Yt(a.type)+"'.");r&&("value"===o.type.kind&&"value"!==a.type.kind?o=new pe(a.type,[o]):"value"!==o.type.kind&&"value"===a.type.kind&&(a=new pe(o.type,[a])));var s=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==a.type.kind&&"value"!==o.type.kind&&"value"!==a.type.kind)return e.error("Cannot use collator to compare non-string types.");if(!(s=e.parse(t[3],3,Ht)))return null}return new i(o,a,s)},i.prototype.evaluate=function(i){var o=this.lhs.evaluate(i),a=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){var s=ue(o),u=ue(a);if(s.kind!==u.kind||"string"!==s.kind&&"number"!==s.kind)throw new he('Expected arguments for "'+t+'" to be (string, string) or (number, number), but found ('+s.kind+", "+u.kind+") instead.")}if(this.collator&&!r&&this.hasUntypedArgument){var c=ue(o),l=ue(a);if("string"!==c.kind||"string"!==l.kind)return e(i,o,a)}return this.collator?n(i,o,a,this.collator.evaluate(i)):e(i,o,a)},i.prototype.eachChild=function(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)},i.prototype.outputDefined=function(){return!0},i.prototype.serialize=function(){var e=[t];return this.eachChild((function(t){e.push(t.serialize())})),e},i}()}mn.parse=function(t,e){if(t.length<=2||t.length>=5)return e.error("Expected 3 or 4 arguments, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1,Gt),r=e.parse(t[2],2,Bt);if(!n||!r)return null;if(!Jt(n.type,[Xt(Gt),Ut,Gt]))return e.error("Expected first argument to be of type array or string, but found "+Yt(n.type)+" instead");if(4===t.length){var i=e.parse(t[3],3,Bt);return i?new mn(n.type,n,r,i):null}return new mn(n.type,n,r)},mn.prototype.evaluate=function(t){var e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!$t(e,["string","array"]))throw new he("Expected first argument to be of type array or string, but found "+Yt(ue(e))+" instead.");if(this.endIndex){var r=this.endIndex.evaluate(t);return e.slice(n,r)}return e.slice(n)},mn.prototype.eachChild=function(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)},mn.prototype.outputDefined=function(){return!1},mn.prototype.serialize=function(){if(null!=this.endIndex&&void 0!==this.endIndex){var t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var xn=_n("==",(function(t,e,n){return e===n}),yn),bn=_n("!=",(function(t,e,n){return e!==n}),(function(t,e,n,r){return!yn(0,e,n,r)})),wn=_n("<",(function(t,e,n){return e<n}),(function(t,e,n,r){return r.compare(e,n)<0})),En=_n(">",(function(t,e,n){return e>n}),(function(t,e,n,r){return r.compare(e,n)>0})),Sn=_n("<=",(function(t,e,n){return e<=n}),(function(t,e,n,r){return r.compare(e,n)<=0})),An=_n(">=",(function(t,e,n){return e>=n}),(function(t,e,n,r){return r.compare(e,n)>=0})),Tn=function(t,e,n,r,i){this.type=Ut,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i};Tn.parse=function(t,e){if(3!==t.length)return e.error("Expected two arguments.");var n=e.parse(t[1],1,Bt);if(!n)return null;var r=t[2];if("object"!=o(r)||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");var i=null;if(r.locale&&!(i=e.parse(r.locale,1,Ut)))return null;var a=null;if(r.currency&&!(a=e.parse(r.currency,1,Ut)))return null;var s=null;if(r["min-fraction-digits"]&&!(s=e.parse(r["min-fraction-digits"],1,Bt)))return null;var u=null;return r["max-fraction-digits"]&&!(u=e.parse(r["max-fraction-digits"],1,Bt))?null:new Tn(n,i,a,s,u)},Tn.prototype.evaluate=function(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))},Tn.prototype.eachChild=function(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)},Tn.prototype.outputDefined=function(){return!1},Tn.prototype.serialize=function(){var t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]};var Cn=function(t){this.type=Bt,this.input=t};Cn.parse=function(t,e){if(2!==t.length)return e.error("Expected 1 argument, but found "+(t.length-1)+" instead.");var n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error("Expected argument of type string or array, but found "+Yt(n.type)+" instead."):new Cn(n):null},Cn.prototype.evaluate=function(t){var e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new he("Expected value to be of type string or array, but found "+Yt(ue(e))+" instead.")},Cn.prototype.eachChild=function(t){t(this.input)},Cn.prototype.outputDefined=function(){return!1},Cn.prototype.serialize=function(){var t=["length"];return this.eachChild((function(e){t.push(e.serialize())})),t};var kn={"==":xn,"!=":bn,">":En,"<":wn,">=":An,"<=":Sn,array:pe,at:hn,boolean:pe,case:vn,coalesce:cn,collator:be,format:de,image:ve,in:fn,"index-of":pn,interpolate:sn,"interpolate-hcl":sn,"interpolate-lab":sn,length:Cn,let:ln,literal:le,match:dn,number:pe,"number-format":Tn,object:pe,slice:mn,step:Ge,string:pe,"to-boolean":ge,"to-color":ge,"to-number":ge,"to-string":ge,var:je,within:ze};function Mn(t,e){var n=e[0],r=e[1],i=e[2],o=e[3];n=n.evaluate(t),r=r.evaluate(t),i=i.evaluate(t);var a=o?o.evaluate(t):1,s=ae(n,r,i,a);if(s)throw new he(s);return new ee(n/255*a,r/255*a,i/255*a,a)}function Pn(t,e){return t in e}function In(t,e){var n=e[t];return void 0===n?null:n}function Rn(t){return{type:t}}function Ln(t){return{result:"success",value:t}}function On(t){return{result:"error",value:t}}function Dn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Nn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function zn(t){return!!t.expression&&t.expression.interpolated}function Fn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":o(t)}function Bn(t){return"object"==o(t)&&null!==t&&!Array.isArray(t)}function Un(t){return t}function jn(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function Zn(t,e,n,r,i){return jn(o(n)===i?r[n]:void 0,t.default,e.default)}function Vn(t,e,n){if("number"!==Fn(n))return jn(t.default,e.default);var r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];var i=Ve(t.stops.map((function(t){return t[0]})),n);return t.stops[i][1]}function Gn(t,e,n){var r=void 0!==t.base?t.base:1;if("number"!==Fn(n))return jn(t.default,e.default);var i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];var o=Ve(t.stops.map((function(t){return t[0]})),n),a=function(t,e,n,r){var i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(n,r,t.stops[o][0],t.stops[o+1][0]),s=t.stops[o][1],u=t.stops[o+1][1],c=We[e.type]||Un;if(t.colorSpace&&"rgb"!==t.colorSpace){var l=an[t.colorSpace];c=function(t,e){return l.reverse(l.interpolate(l.forward(t),l.forward(e),a))}}return"function"==typeof s.evaluate?{evaluate:function(){for(var t=[],e=arguments.length;e--;)t[e]=arguments[e];var n=s.evaluate.apply(void 0,t),r=u.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==r)return c(n,r,a)}}:c(s,u,a)}function Hn(t,e,n){return"color"===e.type?n=ee.parse(n):"formatted"===e.type?n=ie.fromString(n.toString()):"resolvedImage"===e.type?n=oe.fromString(n.toString()):Fn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),jn(n,t.default,e.default)}xe.register(kn,{error:[{kind:"error"},[Ut],function(t,e){throw new he(e[0].evaluate(t))}],typeof:[Ut,[Gt],function(t,e){return Yt(ue(e[0].evaluate(t)))}],"to-rgba":[Xt(Bt,4),[Zt],function(t,e){return e[0].evaluate(t).toArray()}],rgb:[Zt,[Bt,Bt,Bt],Mn],rgba:[Zt,[Bt,Bt,Bt,Bt],Mn],has:{type:jt,overloads:[[[Ut],function(t,e){return Pn(e[0].evaluate(t),t.properties())}],[[Ut,Vt],function(t,e){var n=e[1];return Pn(e[0].evaluate(t),n.evaluate(t))}]]},get:{type:Gt,overloads:[[[Ut],function(t,e){return In(e[0].evaluate(t),t.properties())}],[[Ut,Vt],function(t,e){var n=e[1];return In(e[0].evaluate(t),n.evaluate(t))}]]},"feature-state":[Gt,[Ut],function(t,e){return In(e[0].evaluate(t),t.featureState||{})}],properties:[Vt,[],function(t){return t.properties()}],"geometry-type":[Ut,[],function(t){return t.geometryType()}],id:[Gt,[],function(t){return t.id()}],zoom:[Bt,[],function(t){return t.globals.zoom}],"heatmap-density":[Bt,[],function(t){return t.globals.heatmapDensity||0}],"line-progress":[Bt,[],function(t){return t.globals.lineProgress||0}],accumulated:[Gt,[],function(t){return void 0===t.globals.accumulated?null:t.globals.accumulated}],"+":[Bt,Rn(Bt),function(t,e){for(var n=0,r=0,i=e;r<i.length;r+=1)n+=i[r].evaluate(t);return n}],"*":[Bt,Rn(Bt),function(t,e){for(var n=1,r=0,i=e;r<i.length;r+=1)n*=i[r].evaluate(t);return n}],"-":{type:Bt,overloads:[[[Bt,Bt],function(t,e){var n=e[1];return e[0].evaluate(t)-n.evaluate(t)}],[[Bt],function(t,e){return-e[0].evaluate(t)}]]},"/":[Bt,[Bt,Bt],function(t,e){var n=e[1];return e[0].evaluate(t)/n.evaluate(t)}],"%":[Bt,[Bt,Bt],function(t,e){var n=e[1];return e[0].evaluate(t)%n.evaluate(t)}],ln2:[Bt,[],function(){return Math.LN2}],pi:[Bt,[],function(){return Math.PI}],e:[Bt,[],function(){return Math.E}],"^":[Bt,[Bt,Bt],function(t,e){var n=e[1];return Math.pow(e[0].evaluate(t),n.evaluate(t))}],sqrt:[Bt,[Bt],function(t,e){return Math.sqrt(e[0].evaluate(t))}],log10:[Bt,[Bt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN10}],ln:[Bt,[Bt],function(t,e){return Math.log(e[0].evaluate(t))}],log2:[Bt,[Bt],function(t,e){return Math.log(e[0].evaluate(t))/Math.LN2}],sin:[Bt,[Bt],function(t,e){return Math.sin(e[0].evaluate(t))}],cos:[Bt,[Bt],function(t,e){return Math.cos(e[0].evaluate(t))}],tan:[Bt,[Bt],function(t,e){return Math.tan(e[0].evaluate(t))}],asin:[Bt,[Bt],function(t,e){return Math.asin(e[0].evaluate(t))}],acos:[Bt,[Bt],function(t,e){return Math.acos(e[0].evaluate(t))}],atan:[Bt,[Bt],function(t,e){return Math.atan(e[0].evaluate(t))}],min:[Bt,Rn(Bt),function(t,e){return Math.min.apply(Math,e.map((function(e){return e.evaluate(t)})))}],max:[Bt,Rn(Bt),function(t,e){return Math.max.apply(Math,e.map((function(e){return e.evaluate(t)})))}],abs:[Bt,[Bt],function(t,e){return Math.abs(e[0].evaluate(t))}],round:[Bt,[Bt],function(t,e){var n=e[0].evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Bt,[Bt],function(t,e){return Math.floor(e[0].evaluate(t))}],ceil:[Bt,[Bt],function(t,e){return Math.ceil(e[0].evaluate(t))}],"filter-==":[jt,[Ut,Gt],function(t,e){var n=e[0],r=e[1];return t.properties()[n.value]===r.value}],"filter-id-==":[jt,[Gt],function(t,e){var n=e[0];return t.id()===n.value}],"filter-type-==":[jt,[Ut],function(t,e){var n=e[0];return t.geometryType()===n.value}],"filter-<":[jt,[Ut,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],a=r.value;return o(i)==o(a)&&i<a}],"filter-id-<":[jt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return o(r)==o(i)&&r<i}],"filter->":[jt,[Ut,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],a=r.value;return o(i)==o(a)&&i>a}],"filter-id->":[jt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return o(r)==o(i)&&r>i}],"filter-<=":[jt,[Ut,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],a=r.value;return o(i)==o(a)&&i<=a}],"filter-id-<=":[jt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return o(r)==o(i)&&r<=i}],"filter->=":[jt,[Ut,Gt],function(t,e){var n=e[0],r=e[1],i=t.properties()[n.value],a=r.value;return o(i)==o(a)&&i>=a}],"filter-id->=":[jt,[Gt],function(t,e){var n=e[0],r=t.id(),i=n.value;return o(r)==o(i)&&r>=i}],"filter-has":[jt,[Gt],function(t,e){return e[0].value in t.properties()}],"filter-has-id":[jt,[],function(t){return null!==t.id()&&void 0!==t.id()}],"filter-type-in":[jt,[Xt(Ut)],function(t,e){return e[0].value.indexOf(t.geometryType())>=0}],"filter-id-in":[jt,[Xt(Gt)],function(t,e){return e[0].value.indexOf(t.id())>=0}],"filter-in-small":[jt,[Ut,Xt(Gt)],function(t,e){var n=e[0];return e[1].value.indexOf(t.properties()[n.value])>=0}],"filter-in-large":[jt,[Ut,Xt(Gt)],function(t,e){var n=e[0],r=e[1];return function(t,e,n,r){for(;n<=r;){var i=n+r>>1;if(e[i]===t)return!0;e[i]>t?r=i-1:n=i+1}return!1}(t.properties()[n.value],r.value,0,r.value.length-1)}],all:{type:jt,overloads:[[[jt,jt],function(t,e){var n=e[1];return e[0].evaluate(t)&&n.evaluate(t)}],[Rn(jt),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(!r[n].evaluate(t))return!1;return!0}]]},any:{type:jt,overloads:[[[jt,jt],function(t,e){var n=e[1];return e[0].evaluate(t)||n.evaluate(t)}],[Rn(jt),function(t,e){for(var n=0,r=e;n<r.length;n+=1)if(r[n].evaluate(t))return!0;return!1}]]},"!":[jt,[jt],function(t,e){return!e[0].evaluate(t)}],"is-supported-script":[jt,[Ut],function(t,e){var n=t.globals&&t.globals.isSupportedScript;return!n||n(e[0].evaluate(t))}],upcase:[Ut,[Ut],function(t,e){return e[0].evaluate(t).toUpperCase()}],downcase:[Ut,[Ut],function(t,e){return e[0].evaluate(t).toLowerCase()}],concat:[Ut,Rn(Gt),function(t,e){return e.map((function(e){return ce(e.evaluate(t))})).join("")}],"resolved-locale":[Ut,[Ht],function(t,e){return e[0].evaluate(t).resolvedLocale()}]});var Wn=function(t,e){this.expression=t,this._warningHistory={},this._evaluator=new _e,this._defaultValue=e?function(t){return"color"===t.type&&Bn(t.default)?new ee(0,0,0,0):"color"===t.type?ee.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null};function qn(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in kn}function Xn(t,e){var n=new Ze(kn,[],e?function(t){var e={color:Zt,string:Ut,number:Bt,enum:Ut,boolean:jt,formatted:Wt,resolvedImage:qt};return"array"===t.type?Xt(e[t.value]||Gt,t.length):e[t.type]}(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?Ln(new Wn(r,e)):On(n.errors)}Wn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this.expression.evaluate(this._evaluator)},Wn.prototype.evaluate=function(t,e,n,r,i,o){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null;try{var a=this.expression.evaluate(this._evaluator);if(null==a||"number"==typeof a&&a!=a)return this._defaultValue;if(this._enumValues&&!(a in this._enumValues))throw new he("Expected value to be one of "+Object.keys(this._enumValues).map((function(t){return JSON.stringify(t)})).join(", ")+", but found "+JSON.stringify(a)+" instead.");return a}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0),this._defaultValue}};var Yn=function(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Be(e.expression)};Yn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)},Yn.prototype.evaluate=function(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)};var Kn=function(t,e,n,r){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Be(e.expression),this.interpolationType=r};function Qn(t,e){if("error"===(t=Xn(t,e)).result)return t;var n=t.value.expression,r=Fe(n);if(!r&&!Dn(e))return On([new Nt("","data expressions not supported")]);var i=Ue(n,["zoom"]);if(!i&&!Nn(e))return On([new Nt("","zoom expressions not supported")]);var o=function t(e){var n=null;if(e instanceof ln)n=t(e.result);else if(e instanceof cn)for(var r=0,i=e.args;r<i.length&&!(n=t(i[r]));r+=1);else(e instanceof Ge||e instanceof sn)&&e.input instanceof xe&&"zoom"===e.input.name&&(n=e);return n instanceof Nt||e.eachChild((function(e){var r=t(e);r instanceof Nt?n=r:!n&&r?n=new Nt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):n&&r&&n!==r&&(n=new Nt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),n}(n);return o||i?o instanceof Nt?On([o]):o instanceof sn&&!zn(e)?On([new Nt("",'"interpolate" expressions cannot be used with this property')]):Ln(o?new Kn(r?"camera":"composite",t.value,o.labels,o instanceof sn?o.interpolation:void 0):new Yn(r?"constant":"source",t.value)):On([new Nt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Kn.prototype.evaluateWithoutErrorHandling=function(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)},Kn.prototype.evaluate=function(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)},Kn.prototype.interpolationFactor=function(t,e,n){return this.interpolationType?sn.interpolationFactor(this.interpolationType,t,e,n):0};var Jn=function(t,e){this._parameters=t,this._specification=e,Lt(this,function t(e,n){var r,i,a,s="color"===n.type,u=e.stops&&"object"==o(e.stops[0][0]),c=u||!(u||void 0!==e.property),l=e.type||(zn(n)?"exponential":"interval");if(s&&((e=Lt({},e)).stops&&(e.stops=e.stops.map((function(t){return[t[0],ee.parse(t[1])]}))),e.default=ee.parse(e.default?e.default:n.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!an[e.colorSpace])throw new Error("Unknown color space: "+e.colorSpace);if("exponential"===l)r=Gn;else if("interval"===l)r=Vn;else if("categorical"===l){r=Zn,i=Object.create(null);for(var h=0,f=e.stops;h<f.length;h+=1){var p=f[h];i[p[0]]=p[1]}a=o(e.stops[0][0])}else{if("identity"!==l)throw new Error('Unknown function type "'+l+'"');r=Hn}if(u){for(var d={},v=[],m=0;m<e.stops.length;m++){var g=e.stops[m],y=g[0].zoom;void 0===d[y]&&(d[y]={zoom:y,type:e.type,property:e.property,default:e.default,stops:[]},v.push(y)),d[y].stops.push([g[0].value,g[1]])}for(var _=[],x=0,b=v;x<b.length;x+=1){var w=b[x];_.push([d[w].zoom,t(d[w],n)])}var E={name:"linear"};return{kind:"composite",interpolationType:E,interpolationFactor:sn.interpolationFactor.bind(void 0,E),zoomStops:_.map((function(t){return t[0]})),evaluate:function(t,r){var i=t.zoom;return Gn({stops:_,base:e.base},n,i).evaluate(i,r)}}}if(c){var S="exponential"===l?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:S,interpolationFactor:sn.interpolationFactor.bind(void 0,S),zoomStops:e.stops.map((function(t){return t[0]})),evaluate:function(t){return r(e,n,t.zoom,i,a)}}}return{kind:"source",evaluate:function(t,o){var s=o&&o.properties?o.properties[e.property]:void 0;return void 0===s?jn(e.default,n.default):r(e,n,s,i,a)}}}(this._parameters,this._specification))};function $n(t){var e=t.key,n=t.value,r=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,a=t.styleSpec,s=[],u=Fn(n);if("object"!==u)return[new It(e,n,"object expected, "+u+" found")];for(var c in n){var l=c.split(".")[0],h=r[l]||r["*"],f=void 0;if(i[l])f=i[l];else if(r[l])f=Sr;else if(i["*"])f=i["*"];else{if(!r["*"]){s.push(new It(e,n[c],'unknown property "'+c+'"'));continue}f=Sr}s=s.concat(f({key:(e?e+".":e)+c,value:n[c],valueSpec:h,style:o,styleSpec:a,object:n,objectKey:c},n))}for(var p in r)i[p]||r[p].required&&void 0===r[p].default&&void 0===n[p]&&s.push(new It(e,n,'missing required property "'+p+'"'));return s}function tr(t){var e=t.value,n=t.valueSpec,r=t.style,i=t.styleSpec,o=t.key,a=t.arrayElementValidator||Sr;if("array"!==Fn(e))return[new It(o,e,"array expected, "+Fn(e)+" found")];if(n.length&&e.length!==n.length)return[new It(o,e,"array length "+n.length+" expected, length "+e.length+" found")];if(n["min-length"]&&e.length<n["min-length"])return[new It(o,e,"array length at least "+n["min-length"]+" expected, length "+e.length+" found")];var s={type:n.value,values:n.values};i.$version<7&&(s.function=n.function),"object"===Fn(n.value)&&(s=n.value);for(var u=[],c=0;c<e.length;c++)u=u.concat(a({array:e,arrayIndex:c,value:e[c],valueSpec:s,style:r,styleSpec:i,key:o+"["+c+"]"}));return u}function er(t){var e=t.key,n=t.value,r=t.valueSpec,i=Fn(n);return"number"===i&&n!=n&&(i="NaN"),"number"!==i?[new It(e,n,"number expected, "+i+" found")]:"minimum"in r&&n<r.minimum?[new It(e,n,n+" is less than the minimum value "+r.minimum)]:"maximum"in r&&n>r.maximum?[new It(e,n,n+" is greater than the maximum value "+r.maximum)]:[]}function nr(t){var e,n,r,i=t.valueSpec,o=Ot(t.value.type),a={},s="categorical"!==o&&void 0===t.value.property,u=!s,c="array"===Fn(t.value.stops)&&"array"===Fn(t.value.stops[0])&&"object"===Fn(t.value.stops[0][0]),l=$n({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===o)return[new It(t.key,t.value,'identity function may not have a "stops" property')];var e=[],n=t.value;return e=e.concat(tr({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Fn(n)&&0===n.length&&e.push(new It(t.key,n,"array must have at least one stop")),e},default:function(t){return Sr({key:t.key,value:t.value,valueSpec:i,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===o&&s&&l.push(new It(t.key,t.value,'missing required property "property"')),"identity"===o||t.value.stops||l.push(new It(t.key,t.value,'missing required property "stops"')),"exponential"===o&&t.valueSpec.expression&&!zn(t.valueSpec)&&l.push(new It(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(u&&!Dn(t.valueSpec)?l.push(new It(t.key,t.value,"property functions not supported")):s&&!Nn(t.valueSpec)&&l.push(new It(t.key,t.value,"zoom functions not supported"))),"categorical"!==o&&!c||void 0!==t.value.property||l.push(new It(t.key,t.value,'"property" property is required')),l;function h(t){var e=[],o=t.value,s=t.key;if("array"!==Fn(o))return[new It(s,o,"array expected, "+Fn(o)+" found")];if(2!==o.length)return[new It(s,o,"array length 2 expected, length "+o.length+" found")];if(c){if("object"!==Fn(o[0]))return[new It(s,o,"object expected, "+Fn(o[0])+" found")];if(void 0===o[0].zoom)return[new It(s,o,"object stop key must have zoom")];if(void 0===o[0].value)return[new It(s,o,"object stop key must have value")];if(r&&r>Ot(o[0].zoom))return[new It(s,o[0].zoom,"stop zoom values must appear in ascending order")];Ot(o[0].zoom)!==r&&(r=Ot(o[0].zoom),n=void 0,a={}),e=e.concat($n({key:s+"[0]",value:o[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:er,value:f}}))}else e=e.concat(f({key:s+"[0]",value:o[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},o));return qn(Dt(o[1]))?e.concat([new It(s+"[1]",o[1],"expressions are not allowed in function stops.")]):e.concat(Sr({key:s+"[1]",value:o[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function f(t,r){var s=Fn(t.value),u=Ot(t.value),c=null!==t.value?t.value:r;if(e){if(s!==e)return[new It(t.key,c,s+" stop domain type must match previous stop domain type "+e)]}else e=s;if("number"!==s&&"string"!==s&&"boolean"!==s)return[new It(t.key,c,"stop domain value must be a number, string, or boolean")];if("number"!==s&&"categorical"!==o){var l="number expected, "+s+" found";return Dn(i)&&void 0===o&&(l+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new It(t.key,c,l)]}return"categorical"!==o||"number"!==s||isFinite(u)&&Math.floor(u)===u?"categorical"!==o&&"number"===s&&void 0!==n&&u<n?[new It(t.key,c,"stop domain values must appear in ascending order")]:(n=u,"categorical"===o&&u in a?[new It(t.key,c,"stop domain values must be unique")]:(a[u]=!0,[])):[new It(t.key,c,"integer expected, found "+u)]}}function rr(t){var e=("property"===t.expressionContext?Qn:Xn)(Dt(t.value),t.valueSpec);if("error"===e.result)return e.value.map((function(e){return new It(""+t.key+e.key,t.value,e.message)}));var n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new It(t.key,t.value,'Invalid data expression for "'+t.propertyKey+'". Output values must be contained as literals within the expression.')];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Be(n))return[new It(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext&&!Be(n))return[new It(t.key,t.value,'"feature-state" data expressions are not supported with filters.')];if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Ue(n,["zoom","feature-state"]))return[new It(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Fe(n))return[new It(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ir(t){var e=t.key,n=t.value,r=t.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Ot(n))&&i.push(new It(e,n,"expected one of ["+r.values.join(", ")+"], "+JSON.stringify(n)+" found")):-1===Object.keys(r.values).indexOf(Ot(n))&&i.push(new It(e,n,"expected one of ["+Object.keys(r.values).join(", ")+"], "+JSON.stringify(n)+" found")),i}function or(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(var e=0,n=t.slice(1);e<n.length;e+=1){var r=n[e];if(!or(r)&&"boolean"!=typeof r)return!1}return!0;default:return!0}}Jn.deserialize=function(t){return new Jn(t._parameters,t._specification)},Jn.serialize=function(t){return{_parameters:t._parameters,_specification:t._specification}};var ar={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function sr(t){if(null==t)return{filter:function(){return!0},needGeometry:!1};or(t)||(t=cr(t));var e=Xn(t,ar);if("error"===e.result)throw new Error(e.value.map((function(t){return t.key+": "+t.message})).join(", "));return{filter:function(t,n,r){return e.value.evaluate(t,n,{},r)},needGeometry:function t(e){if(!Array.isArray(e))return!1;if("within"===e[0])return!0;for(var n=1;n<e.length;n++)if(t(e[n]))return!0;return!1}(t)}}function ur(t,e){return t<e?-1:t>e?1:0}function cr(t){if(!t)return!0;var e,n=t[0];return t.length<=1?"any"!==n:"=="===n?lr(t[1],t[2],"=="):"!="===n?pr(lr(t[1],t[2],"==")):"<"===n||">"===n||"<="===n||">="===n?lr(t[1],t[2],n):"any"===n?(e=t.slice(1),["any"].concat(e.map(cr))):"all"===n?["all"].concat(t.slice(1).map(cr)):"none"===n?["all"].concat(t.slice(1).map(cr).map(pr)):"in"===n?hr(t[1],t.slice(2)):"!in"===n?pr(hr(t[1],t.slice(2))):"has"===n?fr(t[1]):"!has"===n?pr(fr(t[1])):"within"!==n||t}function lr(t,e,n){switch(t){case"$type":return["filter-type-"+n,e];case"$id":return["filter-id-"+n,e];default:return["filter-"+n,t,e]}}function hr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some((function(t){return o(t)!=o(e[0])}))?["filter-in-large",t,["literal",e.sort(ur)]]:["filter-in-small",t,["literal",e]]}}function fr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function pr(t){return["!",t]}function dr(t){return or(Dt(t.value))?rr(Lt({},t,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function t(e){var n=e.value,r=e.key;if("array"!==Fn(n))return[new It(r,n,"array expected, "+Fn(n)+" found")];var i,o=e.styleSpec,a=[];if(n.length<1)return[new It(r,n,"filter array must have at least 1 element")];switch(a=a.concat(ir({key:r+"[0]",value:n[0],valueSpec:o.filter_operator,style:e.style,styleSpec:e.styleSpec})),Ot(n[0])){case"<":case"<=":case">":case">=":n.length>=2&&"$type"===Ot(n[1])&&a.push(new It(r,n,'"$type" cannot be use with operator "'+n[0]+'"'));case"==":case"!=":3!==n.length&&a.push(new It(r,n,'filter array for operator "'+n[0]+'" must have 3 elements'));case"in":case"!in":n.length>=2&&"string"!==(i=Fn(n[1]))&&a.push(new It(r+"[1]",n[1],"string expected, "+i+" found"));for(var s=2;s<n.length;s++)i=Fn(n[s]),"$type"===Ot(n[1])?a=a.concat(ir({key:r+"["+s+"]",value:n[s],valueSpec:o.geometry_type,style:e.style,styleSpec:e.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&a.push(new It(r+"["+s+"]",n[s],"string, number, or boolean expected, "+i+" found"));break;case"any":case"all":case"none":for(var u=1;u<n.length;u++)a=a.concat(t({key:r+"["+u+"]",value:n[u],style:e.style,styleSpec:e.styleSpec}));break;case"has":case"!has":i=Fn(n[1]),2!==n.length?a.push(new It(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"string"!==i&&a.push(new It(r+"[1]",n[1],"string expected, "+i+" found"));break;case"within":i=Fn(n[1]),2!==n.length?a.push(new It(r,n,'filter array for "'+n[0]+'" operator must have 2 elements')):"object"!==i&&a.push(new It(r+"[1]",n[1],"object expected, "+i+" found"))}return a}(t)}function vr(t,e){var n=t.key,r=t.style,i=t.styleSpec,o=t.value,a=t.objectKey,s=i[e+"_"+t.layerType];if(!s)return[];var u=a.match(/^(.*)-transition$/);if("paint"===e&&u&&s[u[1]]&&s[u[1]].transition)return Sr({key:n,value:o,valueSpec:i.transition,style:r,styleSpec:i});var c,l=t.valueSpec||s[a];if(!l)return[new It(n,o,'unknown property "'+a+'"')];if("string"===Fn(o)&&Dn(l)&&!l.tokens&&(c=/^{([^}]+)}$/.exec(o)))return[new It(n,o,'"'+a+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(c[1])+" }`.")];var h=[];return"symbol"===t.layerType&&("text-field"===a&&r&&!r.glyphs&&h.push(new It(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===a&&Bn(Dt(o))&&"identity"===Ot(o.type)&&h.push(new It(n,o,'"text-font" does not support identity functions'))),h.concat(Sr({key:t.key,value:o,valueSpec:l,style:r,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:a}))}function mr(t){return vr(t,"paint")}function gr(t){return vr(t,"layout")}function yr(t){var e=[],n=t.value,r=t.key,i=t.style,o=t.styleSpec;n.type||n.ref||e.push(new It(r,n,'either "type" or "ref" is required'));var a,s=Ot(n.type),u=Ot(n.ref);if(n.id)for(var c=Ot(n.id),l=0;l<t.arrayIndex;l++){var h=i.layers[l];Ot(h.id)===c&&e.push(new It(r,n.id,'duplicate layer id "'+n.id+'", previously used at line '+h.id.__line__))}if("ref"in n)["type","source","source-layer","filter","layout"].forEach((function(t){t in n&&e.push(new It(r,n[t],'"'+t+'" is prohibited for ref layers'))})),i.layers.forEach((function(t){Ot(t.id)===u&&(a=t)})),a?a.ref?e.push(new It(r,n.ref,"ref cannot reference another ref layer")):s=Ot(a.type):e.push(new It(r,n.ref,'ref layer "'+u+'" not found'));else if("background"!==s)if(n.source){var f=i.sources&&i.sources[n.source],p=f&&Ot(f.type);f?"vector"===p&&"raster"===s?e.push(new It(r,n.source,'layer "'+n.id+'" requires a raster source')):"raster"===p&&"raster"!==s?e.push(new It(r,n.source,'layer "'+n.id+'" requires a vector source')):"vector"!==p||n["source-layer"]?"raster-dem"===p&&"hillshade"!==s?e.push(new It(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===p&&f.lineMetrics||e.push(new It(r,n,'layer "'+n.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):e.push(new It(r,n,'layer "'+n.id+'" must specify a "source-layer"')):e.push(new It(r,n.source,'source "'+n.source+'" not found'))}else e.push(new It(r,n,'missing required property "source"'));return e=e.concat($n({key:r,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Sr({key:r+".type",value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"})},filter:dr,layout:function(t){return $n({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return gr(Lt({layerType:s},t))}}})},paint:function(t){return $n({layer:n,key:t.key,value:t.value,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":function(t){return mr(Lt({layerType:s},t))}}})}}}))}function _r(t){var e=t.value,n=t.key,r=Fn(e);return"string"!==r?[new It(n,e,"string expected, "+r+" found")]:[]}var xr={promoteId:function(t){var e=t.key,n=t.value;if("string"===Fn(n))return _r({key:e,value:n});var r=[];for(var i in n)r.push.apply(r,_r({key:e+"."+i,value:n[i]}));return r}};function br(t){var e=t.value,n=t.key,r=t.styleSpec,i=t.style;if(!e.type)return[new It(n,e,'"type" is required')];var o,a=Ot(e.type);switch(a){case"vector":case"raster":case"raster-dem":return $n({key:n,value:e,valueSpec:r["source_"+a.replace("-","_")],style:t.style,styleSpec:r,objectElementValidators:xr});case"geojson":if(o=$n({key:n,value:e,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:xr}),e.cluster)for(var s in e.clusterProperties){var u=e.clusterProperties[s],c=u[0],l="string"==typeof c?[c,["accumulated"],["get",s]]:c;o.push.apply(o,rr({key:n+"."+s+".map",value:u[1],expressionContext:"cluster-map"})),o.push.apply(o,rr({key:n+"."+s+".reduce",value:l,expressionContext:"cluster-reduce"}))}return o;case"video":return $n({key:n,value:e,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return $n({key:n,value:e,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new It(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return ir({key:n+".type",value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function wr(t){var e=t.value,n=t.styleSpec,r=n.light,i=t.style,o=[],a=Fn(e);if(void 0===e)return o;if("object"!==a)return o.concat([new It("light",e,"object expected, "+a+" found")]);for(var s in e){var u=s.match(/^(.*)-transition$/);o=o.concat(u&&r[u[1]]&&r[u[1]].transition?Sr({key:s,value:e[s],valueSpec:n.transition,style:i,styleSpec:n}):r[s]?Sr({key:s,value:e[s],valueSpec:r[s],style:i,styleSpec:n}):[new It(s,e[s],'unknown property "'+s+'"')])}return o}var Er={"*":function(){return[]},array:tr,boolean:function(t){var e=t.value,n=t.key,r=Fn(e);return"boolean"!==r?[new It(n,e,"boolean expected, "+r+" found")]:[]},number:er,color:function(t){var e=t.key,n=t.value,r=Fn(n);return"string"!==r?[new It(e,n,"color expected, "+r+" found")]:null===te(n)?[new It(e,n,'color expected, "'+n+'" found')]:[]},constants:Rt,enum:ir,filter:dr,function:nr,layer:yr,object:$n,source:br,light:wr,string:_r,formatted:function(t){return 0===_r(t).length?[]:rr(t)},resolvedImage:function(t){return 0===_r(t).length?[]:rr(t)}};function Sr(t){var e=t.value,n=t.valueSpec,r=t.styleSpec;return n.expression&&Bn(Ot(e))?nr(t):n.expression&&qn(Dt(e))?rr(t):n.type&&Er[n.type]?Er[n.type](t):$n(Lt({},t,{valueSpec:n.type?r[n.type]:n}))}function Ar(t){var e=t.value,n=t.key,r=_r(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new It(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new It(n,e,'"glyphs" url must include a "{range}" token'))),r}function Tr(t,e){void 0===e&&(e=Pt);var n=[];return n=n.concat(Sr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Ar,"*":function(){return[]}}})),t.constants&&(n=n.concat(Rt({key:"constants",value:t.constants,style:t,styleSpec:e}))),Cr(n)}function Cr(t){return[].concat(t).sort((function(t,e){return t.line-e.line}))}function kr(t){return function(){for(var e=[],n=arguments.length;n--;)e[n]=arguments[n];return Cr(t.apply(this,e))}}Tr.source=kr(br),Tr.light=kr(wr),Tr.layer=kr(yr),Tr.filter=kr(dr),Tr.paintProperty=kr(mr),Tr.layoutProperty=kr(gr);var Mr=Tr,Pr=Mr.light,Ir=Mr.paintProperty,Rr=Mr.layoutProperty;function Lr(t,e){var n=!1;if(e&&e.length)for(var r=0,i=e;r<i.length;r+=1)t.fire(new kt(new Error(i[r].message))),n=!0;return n}var Or=Dr;function Dr(t,e,n){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(n=i[2]);for(var o=0;o<this.d*this.d;o++){var a=i[3+o],s=i[3+o+1];r.push(a===s?null:i.subarray(a,s))}var u=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],u),this.bboxes=i.subarray(u),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var c=0;c<this.d*this.d;c++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var l=n/e*t;this.min=-l,this.max=t+l}Dr.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Dr.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},Dr.prototype._insertCell=function(t,e,n,r,i,o){this.cells[i].push(o)},Dr.prototype.query=function(t,e,n,r,i){var o=this.min,a=this.max;if(t<=o&&e<=o&&a<=n&&a<=r&&!i)return Array.prototype.slice.call(this.keys);var s=[];return this._forEachCell(t,e,n,r,this._queryCell,s,{},i),s},Dr.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=this.cells[i];if(null!==u)for(var c=this.keys,l=this.bboxes,h=0;h<u.length;h++){var f=u[h];if(void 0===a[f]){var p=4*f;(s?s(l[p+0],l[p+1],l[p+2],l[p+3]):t<=l[p+2]&&e<=l[p+3]&&n>=l[p+0]&&r>=l[p+1])?(a[f]=!0,o.push(c[f])):a[f]=!1}}},Dr.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToCellCoord(t),c=this._convertToCellCoord(e),l=this._convertToCellCoord(n),h=this._convertToCellCoord(r),f=u;f<=l;f++)for(var p=c;p<=h;p++){var d=this.d*p+f;if((!s||s(this._convertFromCellCoord(f),this._convertFromCellCoord(p),this._convertFromCellCoord(f+1),this._convertFromCellCoord(p+1)))&&i.call(this,t,e,n,r,d,o,a,s))return}},Dr.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},Dr.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},Dr.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,a=0;a<t.length;a++){var s=t[a];i[3+a]=o,i.set(s,o),o+=s.length}return i[3+t.length]=o,i.set(this.keys,o),i[3+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};var Nr=s.ImageData,zr=s.ImageBitmap,Fr={};function Br(t,e,n){void 0===n&&(n={}),Object.defineProperty(e,"_classRegistryKey",{value:t,writeable:!1}),Fr[t]={klass:e,omit:n.omit||[],shallow:n.shallow||[]}}for(var Ur in Br("Object",Object),Or.serialize=function(t,e){var n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},Or.deserialize=function(t){return new Or(t.buffer)},Br("Grid",Or),Br("Color",ee),Br("Error",Error),Br("ResolvedImage",oe),Br("StylePropertyFunction",Jn),Br("StyleExpression",Wn,{omit:["_evaluator"]}),Br("ZoomDependentExpression",Kn),Br("ZoomConstantExpression",Yn),Br("CompoundExpression",xe,{omit:["_evaluate"]}),kn)kn[Ur]._classRegistryKey||Br("Expression_"+Ur,kn[Ur]);function jr(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function Zr(t){return zr&&t instanceof zr}function Vr(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(jr(t)||Zr(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){var n=t;return e&&e.push(n.buffer),n}if(t instanceof Nr)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){for(var r=[],i=0,a=t;i<a.length;i+=1)r.push(Vr(a[i],e));return r}if("object"==o(t)){var s=t.constructor,u=s._classRegistryKey;if(!u)throw new Error("can't serialize object of unregistered class");var c=s.serialize?s.serialize(t,e):{};if(!s.serialize){for(var l in t)if(t.hasOwnProperty(l)&&!(Fr[u].omit.indexOf(l)>=0)){var h=t[l];c[l]=Fr[u].shallow.indexOf(l)>=0?h:Vr(h,e)}t instanceof Error&&(c.message=t.message)}if(c.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==u&&(c.$name=u),c}throw new Error("can't serialize object of type "+o(t))}function Gr(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||jr(t)||Zr(t)||ArrayBuffer.isView(t)||t instanceof Nr)return t;if(Array.isArray(t))return t.map(Gr);if("object"==o(t)){var e=t.$name||"Object",n=Fr[e].klass;if(!n)throw new Error("can't deserialize unregistered class "+e);if(n.deserialize)return n.deserialize(t);for(var r=Object.create(n.prototype),i=0,a=Object.keys(t);i<a.length;i+=1){var s=a[i];if("$name"!==s){var u=t[s];r[s]=Fr[e].shallow.indexOf(s)>=0?u:Gr(u)}}return r}throw new Error("can't deserialize object of type "+o(t))}var Hr=function(){this.first=!0};Hr.prototype.update=function(t,e){var n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))};var Wr={"Latin-1 Supplement":function(t){return t>=128&&t<=255},Arabic:function(t){return t>=1536&&t<=1791},"Arabic Supplement":function(t){return t>=1872&&t<=1919},"Arabic Extended-A":function(t){return t>=2208&&t<=2303},"Hangul Jamo":function(t){return t>=4352&&t<=4607},"Unified Canadian Aboriginal Syllabics":function(t){return t>=5120&&t<=5759},Khmer:function(t){return t>=6016&&t<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(t){return t>=6320&&t<=6399},"General Punctuation":function(t){return t>=8192&&t<=8303},"Letterlike Symbols":function(t){return t>=8448&&t<=8527},"Number Forms":function(t){return t>=8528&&t<=8591},"Miscellaneous Technical":function(t){return t>=8960&&t<=9215},"Control Pictures":function(t){return t>=9216&&t<=9279},"Optical Character Recognition":function(t){return t>=9280&&t<=9311},"Enclosed Alphanumerics":function(t){return t>=9312&&t<=9471},"Geometric Shapes":function(t){return t>=9632&&t<=9727},"Miscellaneous Symbols":function(t){return t>=9728&&t<=9983},"Miscellaneous Symbols and Arrows":function(t){return t>=11008&&t<=11263},"CJK Radicals Supplement":function(t){return t>=11904&&t<=12031},"Kangxi Radicals":function(t){return t>=12032&&t<=12255},"Ideographic Description Characters":function(t){return t>=12272&&t<=12287},"CJK Symbols and Punctuation":function(t){return t>=12288&&t<=12351},Hiragana:function(t){return t>=12352&&t<=12447},Katakana:function(t){return t>=12448&&t<=12543},Bopomofo:function(t){return t>=12544&&t<=12591},"Hangul Compatibility Jamo":function(t){return t>=12592&&t<=12687},Kanbun:function(t){return t>=12688&&t<=12703},"Bopomofo Extended":function(t){return t>=12704&&t<=12735},"CJK Strokes":function(t){return t>=12736&&t<=12783},"Katakana Phonetic Extensions":function(t){return t>=12784&&t<=12799},"Enclosed CJK Letters and Months":function(t){return t>=12800&&t<=13055},"CJK Compatibility":function(t){return t>=13056&&t<=13311},"CJK Unified Ideographs Extension A":function(t){return t>=13312&&t<=19903},"Yijing Hexagram Symbols":function(t){return t>=19904&&t<=19967},"CJK Unified Ideographs":function(t){return t>=19968&&t<=40959},"Yi Syllables":function(t){return t>=40960&&t<=42127},"Yi Radicals":function(t){return t>=42128&&t<=42191},"Hangul Jamo Extended-A":function(t){return t>=43360&&t<=43391},"Hangul Syllables":function(t){return t>=44032&&t<=55215},"Hangul Jamo Extended-B":function(t){return t>=55216&&t<=55295},"Private Use Area":function(t){return t>=57344&&t<=63743},"CJK Compatibility Ideographs":function(t){return t>=63744&&t<=64255},"Arabic Presentation Forms-A":function(t){return t>=64336&&t<=65023},"Vertical Forms":function(t){return t>=65040&&t<=65055},"CJK Compatibility Forms":function(t){return t>=65072&&t<=65103},"Small Form Variants":function(t){return t>=65104&&t<=65135},"Arabic Presentation Forms-B":function(t){return t>=65136&&t<=65279},"Halfwidth and Fullwidth Forms":function(t){return t>=65280&&t<=65519}};function qr(t){for(var e=0,n=t;e<n.length;e+=1)if(Xr(n[e].charCodeAt(0)))return!0;return!1}function Xr(t){return!(746!==t&&747!==t&&(t<4352||!(Wr["Bopomofo Extended"](t)||Wr.Bopomofo(t)||Wr["CJK Compatibility Forms"](t)&&!(t>=65097&&t<=65103)||Wr["CJK Compatibility Ideographs"](t)||Wr["CJK Compatibility"](t)||Wr["CJK Radicals Supplement"](t)||Wr["CJK Strokes"](t)||!(!Wr["CJK Symbols and Punctuation"](t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Wr["CJK Unified Ideographs Extension A"](t)||Wr["CJK Unified Ideographs"](t)||Wr["Enclosed CJK Letters and Months"](t)||Wr["Hangul Compatibility Jamo"](t)||Wr["Hangul Jamo Extended-A"](t)||Wr["Hangul Jamo Extended-B"](t)||Wr["Hangul Jamo"](t)||Wr["Hangul Syllables"](t)||Wr.Hiragana(t)||Wr["Ideographic Description Characters"](t)||Wr.Kanbun(t)||Wr["Kangxi Radicals"](t)||Wr["Katakana Phonetic Extensions"](t)||Wr.Katakana(t)&&12540!==t||!(!Wr["Halfwidth and Fullwidth Forms"](t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Wr["Small Form Variants"](t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||Wr["Unified Canadian Aboriginal Syllabics"](t)||Wr["Unified Canadian Aboriginal Syllabics Extended"](t)||Wr["Vertical Forms"](t)||Wr["Yijing Hexagram Symbols"](t)||Wr["Yi Syllables"](t)||Wr["Yi Radicals"](t))))}function Yr(t){return!(Xr(t)||function(t){return!!(Wr["Latin-1 Supplement"](t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||Wr["General Punctuation"](t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||Wr["Letterlike Symbols"](t)||Wr["Number Forms"](t)||Wr["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||Wr["Control Pictures"](t)&&9251!==t||Wr["Optical Character Recognition"](t)||Wr["Enclosed Alphanumerics"](t)||Wr["Geometric Shapes"](t)||Wr["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||Wr["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||Wr["CJK Symbols and Punctuation"](t)||Wr.Katakana(t)||Wr["Private Use Area"](t)||Wr["CJK Compatibility Forms"](t)||Wr["Small Form Variants"](t)||Wr["Halfwidth and Fullwidth Forms"](t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Kr(t){return t>=1424&&t<=2303||Wr["Arabic Presentation Forms-A"](t)||Wr["Arabic Presentation Forms-B"](t)}function Qr(t,e){return!(!e&&Kr(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||Wr.Khmer(t))}function Jr(t){for(var e=0,n=t;e<n.length;e+=1)if(Kr(n[e].charCodeAt(0)))return!0;return!1}var $r=null,ti="unavailable",ei=null,ni=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(ti="error"),$r&&$r(t)};function ri(){ii.fire(new Ct("pluginStateChange",{pluginStatus:ti,pluginURL:ei}))}var ii=new Mt,oi=function(){return ti},ai=function(){if("deferred"!==ti||!ei)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");ti="loading",ri(),ei&&bt({url:ei},(function(t){t?ni(t):(ti="loaded",ri())}))},si={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return"loaded"===ti||null!=si.applyArabicShaping},isLoading:function(){return"loading"===ti},setState:function(t){ti=t.pluginStatus,ei=t.pluginURL},isParsed:function(){return null!=si.applyArabicShaping&&null!=si.processBidirectionalText&&null!=si.processStyledBidirectionalText},getPluginURL:function(){return ei}},ui=function(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Hr,this.transition={})};ui.prototype.isSupportedScript=function(t){return function(t,e){for(var n=0,r=t;n<r.length;n+=1)if(!Qr(r[n].charCodeAt(0),e))return!1;return!0}(t,si.isLoaded())},ui.prototype.crossFadingFactor=function(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},ui.prototype.getCrossfadeParameters=function(){var t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}};var ci=function(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(Bn(t))return new Jn(t,e);if(qn(t)){var n=Qn(t,e);if("error"===n.result)throw new Error(n.value.map((function(t){return t.key+": "+t.message})).join(", "));return n.value}var r=t;return"string"==typeof t&&"color"===e.type&&(r=ee.parse(t)),{kind:"constant",evaluate:function(){return r}}}(void 0===e?t.specification.default:e,t.specification)};ci.prototype.isDataDriven=function(){return"source"===this.expression.kind||"composite"===this.expression.kind},ci.prototype.possiblyEvaluate=function(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)};var li=function(t){this.property=t,this.value=new ci(t,void 0)};li.prototype.transitioned=function(t,e){return new fi(this.property,this.value,e,p({},t.transition,this.transition),t.now)},li.prototype.untransitioned=function(){return new fi(this.property,this.value,null,{},0)};var hi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)};hi.prototype.getValue=function(t){return w(this._values[t].value.value)},hi.prototype.setValue=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new li(this._values[t].property)),this._values[t].value=new ci(this._values[t].property,null===e?void 0:w(e))},hi.prototype.getTransition=function(t){return w(this._values[t].transition)},hi.prototype.setTransition=function(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new li(this._values[t].property)),this._values[t].transition=w(e)||void 0},hi.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i);var o=this.getTransition(r);void 0!==o&&(t[r+"-transition"]=o)}return t},hi.prototype.transitioned=function(t,e){for(var n=new pi(this._properties),r=0,i=Object.keys(this._values);r<i.length;r+=1){var o=i[r];n._values[o]=this._values[o].transitioned(t,e._values[o])}return n},hi.prototype.untransitioned=function(){for(var t=new pi(this._properties),e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e];t._values[r]=this._values[r].untransitioned()}return t};var fi=function(t,e,n,r,i){this.property=t,this.value=e,this.begin=i+r.delay||0,this.end=this.begin+r.duration||0,t.specification.transition&&(r.delay||r.duration)&&(this.prior=n)};fi.prototype.possiblyEvaluate=function(t,e,n){var r=t.now||0,i=this.value.possiblyEvaluate(t,e,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(t,e,n);var a=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,n),i,function(t){if(t<=0)return 0;if(t>=1)return 1;var e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}(a))}return i};var pi=function(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)};pi.prototype.possiblyEvaluate=function(t,e,n){for(var r=new mi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(t,e,n)}return r},pi.prototype.hasTransition=function(){for(var t=0,e=Object.keys(this._values);t<e.length;t+=1)if(this._values[e[t]].prior)return!0;return!1};var di=function(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)};di.prototype.getValue=function(t){return w(this._values[t].value)},di.prototype.setValue=function(t,e){this._values[t]=new ci(this._values[t].property,null===e?void 0:w(e))},di.prototype.serialize=function(){for(var t={},e=0,n=Object.keys(this._values);e<n.length;e+=1){var r=n[e],i=this.getValue(r);void 0!==i&&(t[r]=i)}return t},di.prototype.possiblyEvaluate=function(t,e,n){for(var r=new mi(this._properties),i=0,o=Object.keys(this._values);i<o.length;i+=1){var a=o[i];r._values[a]=this._values[a].possiblyEvaluate(t,e,n)}return r};var vi=function(t,e,n){this.property=t,this.value=e,this.parameters=n};vi.prototype.isConstant=function(){return"constant"===this.value.kind},vi.prototype.constantOr=function(t){return"constant"===this.value.kind?this.value.value:t},vi.prototype.evaluate=function(t,e,n,r){return this.property.evaluate(this.value,this.parameters,t,e,n,r)};var mi=function(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)};mi.prototype.get=function(t){return this._values[t]};var gi=function(t){this.specification=t};gi.prototype.possiblyEvaluate=function(t,e){return t.expression.evaluate(e)},gi.prototype.interpolate=function(t,e,n){var r=We[this.specification.type];return r?r(t,e,n):t};var yi=function(t,e){this.specification=t,this.overrides=e};yi.prototype.possiblyEvaluate=function(t,e,n,r){return new vi(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,r)}:t.expression,e)},yi.prototype.interpolate=function(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new vi(this,{kind:"constant",value:void 0},t.parameters);var r=We[this.specification.type];return r?new vi(this,{kind:"constant",value:r(t.value.value,e.value.value,n)},t.parameters):t},yi.prototype.evaluate=function(t,e,n,r,i,o){return"constant"===t.kind?t.value:t.evaluate(e,n,r,i,o)};var _i=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(t,e,n,r){if(void 0===t.value)return new vi(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,a=this._calculate(o,o,o,e);return new vi(this,{kind:"constant",value:a},e)}if("camera"===t.expression.kind){var s=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new vi(this,{kind:"constant",value:s},e)}return new vi(this,t.expression,e)},e.prototype.evaluate=function(t,e,n,r,i,o){if("source"===t.kind){var a=t.evaluate(e,n,r,i,o);return this._calculate(a,a,a,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,r),t.evaluate({zoom:Math.floor(e.zoom)},n,r),t.evaluate({zoom:Math.floor(e.zoom)+1},n,r),e):t.value},e.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},e.prototype.interpolate=function(t){return t},e}(yi),xi=function(t){this.specification=t};xi.prototype.possiblyEvaluate=function(t,e,n,r){if(void 0!==t.value){if("constant"===t.expression.kind){var i=t.expression.evaluate(e,null,{},n,r);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new ui(Math.floor(e.zoom-1),e)),t.expression.evaluate(new ui(Math.floor(e.zoom),e)),t.expression.evaluate(new ui(Math.floor(e.zoom+1),e)),e)}},xi.prototype._calculate=function(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}},xi.prototype.interpolate=function(t){return t};var bi=function(t){this.specification=t};bi.prototype.possiblyEvaluate=function(t,e,n,r){return!!t.expression.evaluate(e,null,{},n,r)},bi.prototype.interpolate=function(){return!1};var wi=function(t){for(var e in this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],t){var n=t[e];n.specification.overridable&&this.overridableProperties.push(e);var r=this.defaultPropertyValues[e]=new ci(n,void 0),i=this.defaultTransitionablePropertyValues[e]=new li(n);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}};Br("DataDrivenProperty",yi),Br("DataConstantProperty",gi),Br("CrossFadedDataDrivenProperty",_i),Br("CrossFadedProperty",xi),Br("ColorRampProperty",bi);var Ei=function(t){function e(e,n){if(t.call(this),this.id=e.id,this.type=e.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},"custom"!==e.type&&(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,"background"!==e.type&&(this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter),n.layout&&(this._unevaluatedLayout=new di(n.layout)),n.paint)){for(var r in this._transitionablePaint=new hi(n.paint),e.paint)this.setPaintProperty(r,e.paint[r],{validate:!1});for(var i in e.layout)this.setLayoutProperty(i,e.layout[i],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mi(n.paint)}}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},e.prototype.getLayoutProperty=function(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)},e.prototype.setLayoutProperty=function(t,e,n){void 0===n&&(n={}),null!=e&&this._validate(Rr,"layers."+this.id+".layout."+t,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)},e.prototype.getPaintProperty=function(t){return _(t,"-transition")?this._transitionablePaint.getTransition(t.slice(0,-"-transition".length)):this._transitionablePaint.getValue(t)},e.prototype.setPaintProperty=function(t,e,n){if(void 0===n&&(n={}),null!=e&&this._validate(Ir,"layers."+this.id+".paint."+t,t,e,n))return!1;if(_(t,"-transition"))return this._transitionablePaint.setTransition(t.slice(0,-"-transition".length),e||void 0),!1;var r=this._transitionablePaint._values[t],i="cross-faded-data-driven"===r.property.specification["property-type"],o=r.value.isDataDriven(),a=r.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);var s=this._transitionablePaint._values[t].value;return s.isDataDriven()||o||i||this._handleOverridablePaintPropertyUpdate(t,a,s)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){},e.prototype._handleOverridablePaintPropertyUpdate=function(t,e,n){return!1},e.prototype.isHidden=function(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility},e.prototype.updateTransitions=function(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)},e.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},e.prototype.recalculate=function(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)},e.prototype.serialize=function(){var t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),b(t,(function(t,e){return!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length)}))},e.prototype._validate=function(t,e,n,r,i){return void 0===i&&(i={}),(!i||!1!==i.validate)&&Lr(this,t.call(Mr,{key:e,layerType:this.type,objectKey:n,value:r,styleSpec:Pt,style:{glyphs:!0,sprite:!0}}))},e.prototype.is3D=function(){return!1},e.prototype.isTileClipped=function(){return!1},e.prototype.hasOffscreenPass=function(){return!1},e.prototype.resize=function(){},e.prototype.isStateDependent=function(){for(var t in this.paint._values){var e=this.paint.get(t);if(e instanceof vi&&Dn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1},e}(Mt),Si={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Ai=function(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},Ti=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function Ci(t,e){void 0===e&&(e=1);var n=0,r=0;return{members:t.map((function(t){var i=Si[t.type].BYTES_PER_ELEMENT,o=n=ki(n,Math.max(e,i)),a=t.components||1;return r=Math.max(r,i),n+=i*a,{name:t.name,type:t.type,components:a,offset:o}})),size:ki(n,Math.max(r,e)),alignment:e}}function ki(t,e){return Math.ceil(t/e)*e}Ti.serialize=function(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}},Ti.deserialize=function(t){var e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e},Ti.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},Ti.prototype.clear=function(){this.length=0},Ti.prototype.resize=function(t){this.reserve(t),this.length=t},Ti.prototype.reserve=function(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}},Ti.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.int16[r+0]=e,this.int16[r+1]=n,t},e}(Ti);Mi.prototype.bytesPerElement=4,Br("StructArrayLayout2i4",Mi);var Pi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.int16[o+0]=e,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,t},e}(Ti);Pi.prototype.bytesPerElement=8,Br("StructArrayLayout4i8",Pi);var Ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ti);Ii.prototype.bytesPerElement=12,Br("StructArrayLayout2i4i12",Ii);var Ri=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=4*t,u=8*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.uint8[u+4]=r,this.uint8[u+5]=i,this.uint8[u+6]=o,this.uint8[u+7]=a,t},e}(Ti);Ri.prototype.bytesPerElement=8,Br("StructArrayLayout2i4ub8",Ri);var Li=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.float32[r+0]=e,this.float32[r+1]=n,t},e}(Ti);Li.prototype.bytesPerElement=8,Br("StructArrayLayout2f8",Li);var Oi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,c){var l=this.length;return this.resize(l+1),this.emplace(l,t,e,n,r,i,o,a,s,u,c)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,c,l){var h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=i,this.uint16[h+4]=o,this.uint16[h+5]=a,this.uint16[h+6]=s,this.uint16[h+7]=u,this.uint16[h+8]=c,this.uint16[h+9]=l,t},e}(Ti);Oi.prototype.bytesPerElement=20,Br("StructArrayLayout10ui20",Oi);var Di=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,c,l,h){var f=this.length;return this.resize(f+1),this.emplace(f,t,e,n,r,i,o,a,s,u,c,l,h)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,c,l,h,f){var p=12*t;return this.int16[p+0]=e,this.int16[p+1]=n,this.int16[p+2]=r,this.int16[p+3]=i,this.uint16[p+4]=o,this.uint16[p+5]=a,this.uint16[p+6]=s,this.uint16[p+7]=u,this.int16[p+8]=c,this.int16[p+9]=l,this.int16[p+10]=h,this.int16[p+11]=f,t},e}(Ti);Di.prototype.bytesPerElement=24,Br("StructArrayLayout4i4ui4i24",Di);var Ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.float32[i+0]=e,this.float32[i+1]=n,this.float32[i+2]=r,t},e}(Ti);Ni.prototype.bytesPerElement=12,Br("StructArrayLayout3f12",Ni);var zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint32[1*t+0]=e,t},e}(Ti);zi.prototype.bytesPerElement=4,Br("StructArrayLayout1ul4",zi);var Fi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u){var c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,r,i,o,a,s,u)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,c){var l=10*t,h=5*t;return this.int16[l+0]=e,this.int16[l+1]=n,this.int16[l+2]=r,this.int16[l+3]=i,this.int16[l+4]=o,this.int16[l+5]=a,this.uint32[h+3]=s,this.uint16[l+8]=u,this.uint16[l+9]=c,t},e}(Ti);Fi.prototype.bytesPerElement=20,Br("StructArrayLayout6i1ul2ui20",Fi);var Bi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o){var a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o)},e.prototype.emplace=function(t,e,n,r,i,o,a){var s=6*t;return this.int16[s+0]=e,this.int16[s+1]=n,this.int16[s+2]=r,this.int16[s+3]=i,this.int16[s+4]=o,this.int16[s+5]=a,t},e}(Ti);Bi.prototype.bytesPerElement=12,Br("StructArrayLayout2i2i2i12",Bi);var Ui=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i){var o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,r,i)},e.prototype.emplace=function(t,e,n,r,i,o){var a=4*t,s=8*t;return this.float32[a+0]=e,this.float32[a+1]=n,this.float32[a+2]=r,this.int16[s+6]=i,this.int16[s+7]=o,t},e}(Ti);Ui.prototype.bytesPerElement=16,Br("StructArrayLayout2f1f2i16",Ui);var ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=12*t,a=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=n,this.float32[a+1]=r,this.float32[a+2]=i,t},e}(Ti);ji.prototype.bytesPerElement=12,Br("StructArrayLayout2ub2f12",ji);var Zi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,this.uint16[i+2]=r,t},e}(Ti);Zi.prototype.bytesPerElement=6,Br("StructArrayLayout3ui6",Zi);var Vi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m){var g=this.length;return this.resize(g+1),this.emplace(g,t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m,g){var y=24*t,_=12*t,x=48*t;return this.int16[y+0]=e,this.int16[y+1]=n,this.uint16[y+2]=r,this.uint16[y+3]=i,this.uint32[_+2]=o,this.uint32[_+3]=a,this.uint32[_+4]=s,this.uint16[y+10]=u,this.uint16[y+11]=c,this.uint16[y+12]=l,this.float32[_+7]=h,this.float32[_+8]=f,this.uint8[x+36]=p,this.uint8[x+37]=d,this.uint8[x+38]=v,this.uint32[_+10]=m,this.int16[y+22]=g,t},e}(Ti);Vi.prototype.bytesPerElement=48,Br("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Vi);var Gi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m,g,y,_,x,b,w,E,S,A,T,C){var k=this.length;return this.resize(k+1),this.emplace(k,t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m,g,y,_,x,b,w,E,S,A,T,C)},e.prototype.emplace=function(t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m,g,y,_,x,b,w,E,S,A,T,C,k){var M=34*t,P=17*t;return this.int16[M+0]=e,this.int16[M+1]=n,this.int16[M+2]=r,this.int16[M+3]=i,this.int16[M+4]=o,this.int16[M+5]=a,this.int16[M+6]=s,this.int16[M+7]=u,this.uint16[M+8]=c,this.uint16[M+9]=l,this.uint16[M+10]=h,this.uint16[M+11]=f,this.uint16[M+12]=p,this.uint16[M+13]=d,this.uint16[M+14]=v,this.uint16[M+15]=m,this.uint16[M+16]=g,this.uint16[M+17]=y,this.uint16[M+18]=_,this.uint16[M+19]=x,this.uint16[M+20]=b,this.uint16[M+21]=w,this.uint16[M+22]=E,this.uint32[P+12]=S,this.float32[P+13]=A,this.float32[P+14]=T,this.float32[P+15]=C,this.float32[P+16]=k,t},e}(Ti);Gi.prototype.bytesPerElement=68,Br("StructArrayLayout8i15ui1ul4f68",Gi);var Hi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.float32[1*t+0]=e,t},e}(Ti);Hi.prototype.bytesPerElement=4,Br("StructArrayLayout1f4",Hi);var Wi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=3*t;return this.int16[i+0]=e,this.int16[i+1]=n,this.int16[i+2]=r,t},e}(Ti);Wi.prototype.bytesPerElement=6,Br("StructArrayLayout3i6",Wi);var qi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n){var r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)},e.prototype.emplace=function(t,e,n,r){var i=4*t;return this.uint32[2*t+0]=e,this.uint16[i+2]=n,this.uint16[i+3]=r,t},e}(Ti);qi.prototype.bytesPerElement=8,Br("StructArrayLayout1ul2ui8",qi);var Xi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e){var n=this.length;return this.resize(n+1),this.emplace(n,t,e)},e.prototype.emplace=function(t,e,n){var r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,t},e}(Ti);Xi.prototype.bytesPerElement=4,Br("StructArrayLayout2ui4",Xi);var Yi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t){var e=this.length;return this.resize(e+1),this.emplace(e,t)},e.prototype.emplace=function(t,e){return this.uint16[1*t+0]=e,t},e}(Ti);Yi.prototype.bytesPerElement=2,Br("StructArrayLayout1ui2",Yi);var Ki=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},e.prototype.emplaceBack=function(t,e,n,r){var i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)},e.prototype.emplace=function(t,e,n,r,i){var o=4*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,t},e}(Ti);Ki.prototype.bytesPerElement=16,Br("StructArrayLayout4f16",Ki);var Qi=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return n.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},n.x1.get=function(){return this._structArray.int16[this._pos2+2]},n.y1.get=function(){return this._structArray.int16[this._pos2+3]},n.x2.get=function(){return this._structArray.int16[this._pos2+4]},n.y2.get=function(){return this._structArray.int16[this._pos2+5]},n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.anchorPoint.get=function(){return new i(this.anchorPointX,this.anchorPointY)},Object.defineProperties(e.prototype,n),e}(Ai);Qi.prototype.size=20;var Ji=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new Qi(this,t)},e}(Fi);Br("CollisionBoxArray",Ji);var $i=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},n.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},n.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},n.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},n.segment.get=function(){return this._structArray.uint16[this._pos2+10]},n.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},n.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},n.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},n.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},n.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},n.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},n.placedOrientation.set=function(t){this._structArray.uint8[this._pos1+37]=t},n.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},n.hidden.set=function(t){this._structArray.uint8[this._pos1+38]=t},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+10]=t},n.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(e.prototype,n),e}(Ai);$i.prototype.size=48;var to=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new $i(this,t)},e}(Vi);Br("PlacedSymbolArray",to);var eo=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return n.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},n.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},n.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},n.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},n.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},n.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},n.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},n.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},n.key.get=function(){return this._structArray.uint16[this._pos2+8]},n.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},n.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},n.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},n.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},n.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},n.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},n.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},n.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},n.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},n.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},n.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},n.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},n.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},n.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},n.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},n.crossTileID.set=function(t){this._structArray.uint32[this._pos4+12]=t},n.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},n.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},n.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},n.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(e.prototype,n),e}(Ai);eo.prototype.size=68;var no=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new eo(this,t)},e}(Gi);Br("SymbolInstanceArray",no);var ro=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getoffsetX=function(t){return this.float32[1*t+0]},e}(Hi);Br("GlyphOffsetArray",ro);var io=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getx=function(t){return this.int16[3*t+0]},e.prototype.gety=function(t){return this.int16[3*t+1]},e.prototype.gettileUnitDistanceFromAnchor=function(t){return this.int16[3*t+2]},e}(Wi);Br("SymbolLineVertexArray",io);var oo=function(t){function e(){t.apply(this,arguments)}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return n.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},n.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},n.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(e.prototype,n),e}(Ai);oo.prototype.size=8;var ao=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.get=function(t){return new oo(this,t)},e}(qi);Br("FeatureIndexArray",ao);var so=Ci([{name:"a_pos",components:2,type:"Int16"}],4).members,uo=function(t){void 0===t&&(t=[]),this.segments=t};function co(t,e){return 256*(t=h(Math.floor(t),0,255))+h(Math.floor(e),0,255)}uo.prototype.prepareSegment=function(t,e,n,r){var i=this.segments[this.segments.length-1];return t>uo.MAX_VERTEX_ARRAY_LENGTH&&S("Max vertices per segment is "+uo.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+t),(!i||i.vertexLength+t>uo.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i},uo.prototype.get=function(){return this.segments},uo.prototype.destroy=function(){for(var t=0,e=this.segments;t<e.length;t+=1){var n=e[t];for(var r in n.vaos)n.vaos[r].destroy()}},uo.simpleSegment=function(t,e,n,r){return new uo([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])},uo.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Br("SegmentVector",uo);var lo=Ci([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),ho=e((function(t){t.exports=function(t,e){var n,r,i,o,a,s,u,c;for(r=t.length-(n=3&t.length),i=e,a=3432918353,s=461845907,c=0;c<r;)u=255&t.charCodeAt(c)|(255&t.charCodeAt(++c))<<8|(255&t.charCodeAt(++c))<<16|(255&t.charCodeAt(++c))<<24,++c,i=27492+(65535&(o=5*(65535&(i=(i^=u=(65535&(u=(u=(65535&u)*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(u=0,n){case 3:u^=(255&t.charCodeAt(c+2))<<16;case 2:u^=(255&t.charCodeAt(c+1))<<8;case 1:i^=u=(65535&(u=(u=(65535&(u^=255&t.charCodeAt(c)))*a+(((u>>>16)*a&65535)<<16)&4294967295)<<15|u>>>17))*s+(((u>>>16)*s&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}})),fo=e((function(t){t.exports=function(t,e){for(var n,r=t.length,i=e^r,o=0;r>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}})),po=ho,vo=fo;po.murmur3=ho,po.murmur2=vo;var mo=function(){this.ids=[],this.positions=[],this.indexed=!1};mo.prototype.add=function(t,e,n,r){this.ids.push(yo(t)),this.positions.push(e,n,r)},mo.prototype.getPositions=function(t){for(var e=yo(t),n=0,r=this.ids.length-1;n<r;){var i=n+r>>1;this.ids[i]>=e?r=i:n=i+1}for(var o=[];this.ids[n]===e;)o.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return o},mo.serialize=function(t,e){var n=new Float64Array(t.ids),r=new Uint32Array(t.positions);return function t(e,n,r,i){for(;r<i;){for(var o=e[r+i>>1],a=r-1,s=i+1;;){do{a++}while(e[a]<o);do{s--}while(e[s]>o);if(a>=s)break;_o(e,a,s),_o(n,3*a,3*s),_o(n,3*a+1,3*s+1),_o(n,3*a+2,3*s+2)}s-r<i-s?(t(e,n,r,s),r=s+1):(t(e,n,s+1,i),i=s)}}(n,r,0,n.length-1),e&&e.push(n.buffer,r.buffer),{ids:n,positions:r}},mo.deserialize=function(t){var e=new mo;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e};var go=Math.pow(2,53)-1;function yo(t){var e=+t;return!isNaN(e)&&e<=go?e:po(String(t))}function _o(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}Br("FeaturePositionMap",mo);var xo=function(t,e){this.gl=t.gl,this.location=e},bo=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))},e}(xo),wo=function(t){function e(e,n){t.call(this,e,n),this.current=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))},e}(xo),Eo=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))},e}(xo),So=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))},e}(xo),Ao=function(t){function e(e,n){t.call(this,e,n),this.current=[0,0,0,0]}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))},e}(xo),To=function(t){function e(e,n){t.call(this,e,n),this.current=ee.transparent}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))},e}(xo),Co=new Float32Array(16),ko=function(t){function e(e,n){t.call(this,e,n),this.current=Co}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(var e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}},e}(xo);function Mo(t){return[co(255*t.r,255*t.g),co(255*t.b,255*t.a)]}var Po=function(t,e,n){this.value=t,this.uniformNames=e.map((function(t){return"u_"+t})),this.type=n};Po.prototype.setUniform=function(t,e,n){t.set(n.constantOr(this.value))},Po.prototype.getBinding=function(t,e,n){return"color"===this.type?new To(t,e):new wo(t,e)};var Io=function(t,e){this.uniformNames=e.map((function(t){return"u_"+t})),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};Io.prototype.setConstantPatternPositions=function(t,e){this.pixelRatioFrom=e.pixelRatio,this.pixelRatioTo=t.pixelRatio,this.patternFrom=e.tlbr,this.patternTo=t.tlbr},Io.prototype.setUniform=function(t,e,n,r){var i="u_pattern_to"===r?this.patternTo:"u_pattern_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;i&&t.set(i)},Io.prototype.getBinding=function(t,e,n){return"u_pattern"===n.substr(0,9)?new Ao(t,e):new wo(t,e)};var Ro=function(t,e,n,r){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?2:1,offset:0}})),this.paintVertexArray=new r};Ro.prototype.populatePaintArray=function(t,e,n,r,i){var o=this.paintVertexArray.length,a=this.expression.evaluate(new ui(0),e,{},r,[],i);this.paintVertexArray.resize(t),this._setPaintValue(o,t,a)},Ro.prototype.updatePaintArray=function(t,e,n,r){var i=this.expression.evaluate({zoom:0},n,r);this._setPaintValue(t,e,i)},Ro.prototype._setPaintValue=function(t,e,n){if("color"===this.type)for(var r=Mo(n),i=t;i<e;i++)this.paintVertexArray.emplace(i,r[0],r[1]);else{for(var o=t;o<e;o++)this.paintVertexArray.emplace(o,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}},Ro.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Ro.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Lo=function(t,e,n,r,i,o){this.expression=t,this.uniformNames=e.map((function(t){return"u_"+t+"_t"})),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map((function(t){return{name:"a_"+t,type:"Float32",components:"color"===n?4:2,offset:0}})),this.paintVertexArray=new o};Lo.prototype.populatePaintArray=function(t,e,n,r,i){var o=this.expression.evaluate(new ui(this.zoom),e,{},r,[],i),a=this.expression.evaluate(new ui(this.zoom+1),e,{},r,[],i),s=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(s,t,o,a)},Lo.prototype.updatePaintArray=function(t,e,n,r){var i=this.expression.evaluate({zoom:this.zoom},n,r),o=this.expression.evaluate({zoom:this.zoom+1},n,r);this._setPaintValue(t,e,i,o)},Lo.prototype._setPaintValue=function(t,e,n,r){if("color"===this.type)for(var i=Mo(n),o=Mo(r),a=t;a<e;a++)this.paintVertexArray.emplace(a,i[0],i[1],o[0],o[1]);else{for(var s=t;s<e;s++)this.paintVertexArray.emplace(s,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}},Lo.prototype.upload=function(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Lo.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Lo.prototype.setUniform=function(t,e){var n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=h(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(r)},Lo.prototype.getBinding=function(t,e,n){return new wo(t,e)};var Oo=function(t,e,n,r,i,o){this.expression=t,this.type=e,this.useIntegerZoom=n,this.zoom=r,this.layerId=o,this.zoomInPaintVertexArray=new i,this.zoomOutPaintVertexArray=new i};Oo.prototype.populatePaintArray=function(t,e,n){var r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],n)},Oo.prototype.updatePaintArray=function(t,e,n,r,i){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],i)},Oo.prototype._setPaintValues=function(t,e,n,r){if(r&&n){var i=r[n.min],o=r[n.mid],a=r[n.max];if(i&&o&&a)for(var s=t;s<e;s++)this.zoomInPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],i.tl[0],i.tl[1],i.br[0],i.br[1],o.pixelRatio,i.pixelRatio),this.zoomOutPaintVertexArray.emplace(s,o.tl[0],o.tl[1],o.br[0],o.br[1],a.tl[0],a.tl[1],a.br[0],a.br[1],o.pixelRatio,a.pixelRatio)}},Oo.prototype.upload=function(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,lo.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,lo.members,this.expression.isStateDependent))},Oo.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Do=function(t,e,n){this.binders={},this._buffers=[];var r=[];for(var i in t.paint._values)if(n(i)){var o=t.paint.get(i);if(o instanceof vi&&Dn(o.property.specification)){var a=zo(i,t.type),s=o.value,u=o.property.specification.type,c=o.property.useIntegerZoom,l=o.property.specification["property-type"],h="cross-faded"===l||"cross-faded-data-driven"===l;if("constant"===s.kind)this.binders[i]=h?new Io(s.value,a):new Po(s.value,a,u),r.push("/u_"+i);else if("source"===s.kind||h){var f=Fo(i,u,"source");this.binders[i]=h?new Oo(s,u,c,e,f,t.id):new Ro(s,a,u,f),r.push("/a_"+i)}else{var p=Fo(i,u,"composite");this.binders[i]=new Lo(s,a,u,c,e,p),r.push("/z_"+i)}}}this.cacheKey=r.sort().join("")};Do.prototype.getMaxValue=function(t){var e=this.binders[t];return e instanceof Ro||e instanceof Lo?e.maxValue:0},Do.prototype.populatePaintArrays=function(t,e,n,r,i){for(var o in this.binders){var a=this.binders[o];(a instanceof Ro||a instanceof Lo||a instanceof Oo)&&a.populatePaintArray(t,e,n,r,i)}},Do.prototype.setConstantPatternPositions=function(t,e){for(var n in this.binders){var r=this.binders[n];r instanceof Io&&r.setConstantPatternPositions(t,e)}},Do.prototype.updatePaintArrays=function(t,e,n,r,i){var o=!1;for(var a in t)for(var s=0,u=e.getPositions(a);s<u.length;s+=1){var c=u[s],l=n.feature(c.index);for(var h in this.binders){var f=this.binders[h];if((f instanceof Ro||f instanceof Lo||f instanceof Oo)&&!0===f.expression.isStateDependent){var p=r.paint.get(h);f.expression=p.value,f.updatePaintArray(c.start,c.end,l,t[a],i),o=!0}}}return o},Do.prototype.defines=function(){var t=[];for(var e in this.binders){var n=this.binders[e];(n instanceof Po||n instanceof Io)&&t.push.apply(t,n.uniformNames.map((function(t){return"#define HAS_UNIFORM_"+t})))}return t},Do.prototype.getBinderAttributes=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Ro||n instanceof Lo)for(var r=0;r<n.paintVertexAttributes.length;r++)t.push(n.paintVertexAttributes[r].name);else if(n instanceof Oo)for(var i=0;i<lo.members.length;i++)t.push(lo.members[i].name)}return t},Do.prototype.getBinderUniforms=function(){var t=[];for(var e in this.binders){var n=this.binders[e];if(n instanceof Po||n instanceof Io||n instanceof Lo)for(var r=0,i=n.uniformNames;r<i.length;r+=1)t.push(i[r])}return t},Do.prototype.getPaintVertexBuffers=function(){return this._buffers},Do.prototype.getUniforms=function(t,e){var n=[];for(var r in this.binders){var i=this.binders[r];if(i instanceof Po||i instanceof Io||i instanceof Lo)for(var o=0,a=i.uniformNames;o<a.length;o+=1){var s=a[o];if(e[s]){var u=i.getBinding(t,e[s],s);n.push({name:s,property:r,binding:u})}}}return n},Do.prototype.setUniforms=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.name,u=a.property;this.binders[u].setUniform(a.binding,r,n.get(u),s)}},Do.prototype.updatePaintBuffers=function(t){for(var e in this._buffers=[],this.binders){var n=this.binders[e];if(t&&n instanceof Oo){var r=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;r&&this._buffers.push(r)}else(n instanceof Ro||n instanceof Lo)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}},Do.prototype.upload=function(t){for(var e in this.binders){var n=this.binders[e];(n instanceof Ro||n instanceof Lo||n instanceof Oo)&&n.upload(t)}this.updatePaintBuffers()},Do.prototype.destroy=function(){for(var t in this.binders){var e=this.binders[t];(e instanceof Ro||e instanceof Lo||e instanceof Oo)&&e.destroy()}};var No=function(t,e,n){void 0===n&&(n=function(){return!0}),this.programConfigurations={};for(var r=0,i=t;r<i.length;r+=1){var o=i[r];this.programConfigurations[o.id]=new Do(o,e,n)}this.needsUpload=!1,this._featureMap=new mo,this._bufferOffset=0};function zo(t,e){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[t]||[t.replace(e+"-","").replace(/-/g,"_")]}function Fo(t,e,n){var r={color:{source:Li,composite:Ki},number:{source:Hi,composite:Li}},i=function(t){return{"line-pattern":{source:Oi,composite:Oi},"fill-pattern":{source:Oi,composite:Oi},"fill-extrusion-pattern":{source:Oi,composite:Oi}}[t]}(t);return i&&i[n]||r[e][n]}No.prototype.populatePaintArrays=function(t,e,n,r,i,o){for(var a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,r,i,o);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0},No.prototype.updatePaintArrays=function(t,e,n,r){for(var i=0,o=n;i<o.length;i+=1){var a=o[i];this.needsUpload=this.programConfigurations[a.id].updatePaintArrays(t,this._featureMap,e,a,r)||this.needsUpload}},No.prototype.get=function(t){return this.programConfigurations[t]},No.prototype.upload=function(t){if(this.needsUpload){for(var e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}},No.prototype.destroy=function(){for(var t in this.programConfigurations)this.programConfigurations[t].destroy()},Br("ConstantBinder",Po),Br("CrossFadedConstantBinder",Io),Br("SourceExpressionBinder",Ro),Br("CrossFadedCompositeBinder",Oo),Br("CompositeExpressionBinder",Lo),Br("ProgramConfiguration",Do,{omit:["_buffers"]}),Br("ProgramConfigurationSet",No);var Bo=Math.pow(2,14)-1,Uo=-Bo-1;function jo(t){for(var e=8192/t.extent,n=t.loadGeometry(),r=0;r<n.length;r++)for(var i=n[r],o=0;o<i.length;o++){var a=i[o],s=Math.round(a.x*e),u=Math.round(a.y*e);a.x=h(s,Uo,Bo),a.y=h(u,Uo,Bo),(s<a.x||s>a.x+1||u<a.y||u>a.y+1)&&S("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return n}function Zo(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?jo(t):[]}}function Vo(t,e,n,r,i){t.emplaceBack(2*e+(r+1)/2,2*n+(i+1)/2)}var Go=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Mi,this.indexArray=new Zi,this.segments=new uo,this.programConfigurations=new No(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ho(t,e){for(var n=0;n<t.length;n++)if(ta(e,t[n]))return!0;for(var r=0;r<e.length;r++)if(ta(t,e[r]))return!0;return!!Yo(t,e)}function Wo(t,e,n){return!!ta(t,e)||!!Qo(e,t,n)}function qo(t,e){if(1===t.length)return $o(e,t[0]);for(var n=0;n<e.length;n++)for(var r=e[n],i=0;i<r.length;i++)if(ta(t,r[i]))return!0;for(var o=0;o<t.length;o++)if($o(e,t[o]))return!0;for(var a=0;a<e.length;a++)if(Yo(t,e[a]))return!0;return!1}function Xo(t,e,n){if(t.length>1){if(Yo(t,e))return!0;for(var r=0;r<e.length;r++)if(Qo(e[r],t,n))return!0}for(var i=0;i<t.length;i++)if(Qo(t[i],e,n))return!0;return!1}function Yo(t,e){if(0===t.length||0===e.length)return!1;for(var n=0;n<t.length-1;n++)for(var r=t[n],i=t[n+1],o=0;o<e.length-1;o++)if(Ko(r,i,e[o],e[o+1]))return!0;return!1}function Ko(t,e,n,r){return A(t,n,r)!==A(e,n,r)&&A(t,e,n)!==A(t,e,r)}function Qo(t,e,n){var r=n*n;if(1===e.length)return t.distSqr(e[0])<r;for(var i=1;i<e.length;i++)if(Jo(t,e[i-1],e[i])<r)return!0;return!1}function Jo(t,e,n){var r=e.distSqr(n);if(0===r)return t.distSqr(e);var i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return t.distSqr(i<0?e:i>1?n:n.sub(e)._mult(i)._add(e))}function $o(t,e){for(var n,r,i,o=!1,a=0;a<t.length;a++)for(var s=0,u=(n=t[a]).length-1;s<n.length;u=s++)(r=n[s]).y>e.y!=(i=n[u]).y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(o=!o);return o}function ta(t,e){for(var n=!1,r=0,i=t.length-1;r<t.length;i=r++){var o=t[r],a=t[i];o.y>e.y!=a.y>e.y&&e.x<(a.x-o.x)*(e.y-o.y)/(a.y-o.y)+o.x&&(n=!n)}return n}function ea(t,e,n){var r=n[0],i=n[2];if(t.x<r.x&&e.x<r.x||t.x>i.x&&e.x>i.x||t.y<r.y&&e.y<r.y||t.y>i.y&&e.y>i.y)return!1;var o=A(t,e,n[0]);return o!==A(t,e,n[1])||o!==A(t,e,n[2])||o!==A(t,e,n[3])}function na(t,e,n){var r=e.paint.get(t).value;return"constant"===r.kind?r.value:n.programConfigurations.get(e.id).getMaxValue(t)}function ra(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function ia(t,e,n,r,o){if(!e[0]&&!e[1])return t;var a=i.convert(e)._mult(o);"viewport"===n&&a._rotate(-r);for(var s=[],u=0;u<t.length;u++)s.push(t[u].sub(a));return s}Go.prototype.populate=function(t,e,n){var r=this.layers[0],i=[],o=null;"circle"===r.type&&(o=r.layout.get("circle-sort-key"));for(var a=0,s=t;a<s.length;a+=1){var u=s[a],c=u.feature,l=u.id,h=u.index,f=u.sourceLayerIndex,p=this.layers[0]._featureFilter.needGeometry,d=Zo(c,p);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),d,n)){var v=o?o.evaluate(d,{},n):void 0,m={id:l,properties:c.properties,type:c.type,sourceLayerIndex:f,index:h,geometry:p?d.geometry:jo(c),patterns:{},sortKey:v};i.push(m)}}o&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var g=0,y=i;g<y.length;g+=1){var _=y[g],x=_.geometry,b=_.index,w=_.sourceLayerIndex,E=t[b].feature;this.addFeature(_,x,b,n),e.featureIndex.insert(E,x,b,w,this.index)}},Go.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Go.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Go.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Go.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,so),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Go.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Go.prototype.addFeature=function(t,e,n,r){for(var i=0,o=e;i<o.length;i+=1)for(var a=0,s=o[i];a<s.length;a+=1){var u=s[a],c=u.x,l=u.y;if(!(c<0||c>=8192||l<0||l>=8192)){var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),f=h.vertexLength;Vo(this.layoutVertexArray,c,l,-1,-1),Vo(this.layoutVertexArray,c,l,1,-1),Vo(this.layoutVertexArray,c,l,1,1),Vo(this.layoutVertexArray,c,l,-1,1),this.indexArray.emplaceBack(f,f+1,f+2),this.indexArray.emplaceBack(f,f+3,f+2),h.vertexLength+=4,h.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},r)},Br("CircleBucket",Go,{omit:["layers"]});var oa=new wi({"circle-sort-key":new yi(Pt.layout_circle["circle-sort-key"])}),aa={paint:new wi({"circle-radius":new yi(Pt.paint_circle["circle-radius"]),"circle-color":new yi(Pt.paint_circle["circle-color"]),"circle-blur":new yi(Pt.paint_circle["circle-blur"]),"circle-opacity":new yi(Pt.paint_circle["circle-opacity"]),"circle-translate":new gi(Pt.paint_circle["circle-translate"]),"circle-translate-anchor":new gi(Pt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new gi(Pt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new gi(Pt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new yi(Pt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new yi(Pt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new yi(Pt.paint_circle["circle-stroke-opacity"])}),layout:oa},sa="undefined"!=typeof Float32Array?Float32Array:Array;function ua(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function ca(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],p=e[10],d=e[11],v=e[12],m=e[13],g=e[14],y=e[15],_=n[0],x=n[1],b=n[2],w=n[3];return t[0]=_*r+x*s+b*h+w*v,t[1]=_*i+x*u+b*f+w*m,t[2]=_*o+x*c+b*p+w*g,t[3]=_*a+x*l+b*d+w*y,t[4]=(_=n[4])*r+(x=n[5])*s+(b=n[6])*h+(w=n[7])*v,t[5]=_*i+x*u+b*f+w*m,t[6]=_*o+x*c+b*p+w*g,t[7]=_*a+x*l+b*d+w*y,t[8]=(_=n[8])*r+(x=n[9])*s+(b=n[10])*h+(w=n[11])*v,t[9]=_*i+x*u+b*f+w*m,t[10]=_*o+x*c+b*p+w*g,t[11]=_*a+x*l+b*d+w*y,t[12]=(_=n[12])*r+(x=n[13])*s+(b=n[14])*h+(w=n[15])*v,t[13]=_*i+x*u+b*f+w*m,t[14]=_*o+x*c+b*p+w*g,t[15]=_*a+x*l+b*d+w*y,t}Math.hypot||(Math.hypot=function(){for(var t=arguments,e=0,n=arguments.length;n--;)e+=t[n]*t[n];return Math.sqrt(e)});var la,ha=ca;function fa(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*a,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*a,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*a,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*a,t}la=new sa(3),sa!=Float32Array&&(la[0]=0,la[1]=0,la[2]=0),function(){var t=new sa(4);sa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0,t[3]=0)}();var pa=(function(){var t=new sa(2);sa!=Float32Array&&(t[0]=0,t[1]=0)}(),function(t){function e(e){t.call(this,e,aa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new Go(t)},e.prototype.queryRadius=function(t){var e=t;return na("circle-radius",this,e)+na("circle-stroke-width",this,e)+ra(this.paint.get("circle-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a,s){for(var u=ia(t,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,a),c=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n),l="map"===this.paint.get("circle-pitch-alignment"),h=l?u:function(t,e){return t.map((function(t){return da(t,e)}))}(u,s),f=l?c*a:c,p=0,d=r;p<d.length;p+=1)for(var v=0,m=d[p];v<m.length;v+=1){var g=m[v],y=l?g:da(g,s),_=f,x=fa([],[g.x,g.y,0,1],s);if("viewport"===this.paint.get("circle-pitch-scale")&&"map"===this.paint.get("circle-pitch-alignment")?_*=x[3]/o.cameraToCenterDistance:"map"===this.paint.get("circle-pitch-scale")&&"viewport"===this.paint.get("circle-pitch-alignment")&&(_*=o.cameraToCenterDistance/x[3]),Wo(h,y,_))return!0}return!1},e}(Ei));function da(t,e){var n=fa([],[t.x,t.y,0,1],e);return new i(n[0]/n[3],n[1]/n[3])}var va=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Go);function ma(t,e,n,r){var i=e.width,o=e.height;if(r){if(r instanceof Uint8ClampedArray)r=new Uint8Array(r.buffer);else if(r.length!==i*o*n)throw new RangeError("mismatched image size")}else r=new Uint8Array(i*o*n);return t.width=i,t.height=o,t.data=r,t}function ga(t,e,n){var r=e.width,i=e.height;if(r!==t.width||i!==t.height){var o=ma({},{width:r,height:i},n);ya(t,o,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,i)},n),t.width=r,t.height=i,t.data=o.data}}function ya(t,e,n,r,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");for(var a=t.data,s=e.data,u=0;u<i.height;u++)for(var c=((n.y+u)*t.width+n.x)*o,l=((r.y+u)*e.width+r.x)*o,h=0;h<i.width*o;h++)s[l+h]=a[c+h];return e}Br("HeatmapBucket",va,{omit:["layers"]});var _a=function(t,e){ma(this,t,1,e)};_a.prototype.resize=function(t){ga(this,t,1)},_a.prototype.clone=function(){return new _a({width:this.width,height:this.height},new Uint8Array(this.data))},_a.copy=function(t,e,n,r,i){ya(t,e,n,r,i,1)};var xa=function(t,e){ma(this,t,4,e)};xa.prototype.resize=function(t){ga(this,t,4)},xa.prototype.replace=function(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t},xa.prototype.clone=function(){return new xa({width:this.width,height:this.height},new Uint8Array(this.data))},xa.copy=function(t,e,n,r,i){ya(t,e,n,r,i,4)},Br("AlphaImage",_a),Br("RGBAImage",xa);var ba={paint:new wi({"heatmap-radius":new yi(Pt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new yi(Pt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new gi(Pt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new bi(Pt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new gi(Pt.paint_heatmap["heatmap-opacity"])})};function wa(t){var e={},n=t.resolution||256,r=t.clips?t.clips.length:1,i=t.image||new xa({width:n,height:r}),o=function(n,r,o){e[t.evaluationKey]=o;var a=t.expression.evaluate(e);i.data[n+r+0]=Math.floor(255*a.r/a.a),i.data[n+r+1]=Math.floor(255*a.g/a.a),i.data[n+r+2]=Math.floor(255*a.b/a.a),i.data[n+r+3]=Math.floor(255*a.a)};if(t.clips)for(var a=0,s=0;a<r;++a,s+=4*n)for(var u=0,c=0;u<n;u++,c+=4){var l=u/(n-1),h=t.clips[a];o(s,c,h.start*(1-l)+h.end*l)}else for(var f=0,p=0;f<n;f++,p+=4)o(0,p,f/(n-1));return i}var Ea=function(t){function e(e){t.call(this,e,ba),this._updateColorRamp()}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new va(t)},e.prototype._handleSpecialPaintPropertyUpdate=function(t){"heatmap-color"===t&&this._updateColorRamp()},e.prototype._updateColorRamp=function(){this.colorRamp=wa({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},e.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility},e}(Ei),Sa={paint:new wi({"hillshade-illumination-direction":new gi(Pt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new gi(Pt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new gi(Pt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new gi(Pt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new gi(Pt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new gi(Pt.paint_hillshade["hillshade-accent-color"])})},Aa=function(t){function e(e){t.call(this,e,Sa)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.hasOffscreenPass=function(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility},e}(Ei),Ta=Ci([{name:"a_pos",components:2,type:"Int16"}],4).members,Ca=Ma,ka=Ma;function Ma(t,e,n){n=n||2;var r,i,o,a,s,u,c,l=e&&e.length,h=l?e[0]*n:t.length,f=Pa(t,0,h,n,!0),p=[];if(!f||f.next===f.prev)return p;if(l&&(f=function(t,e,n,r){var i,o,a,s=[];for(i=0,o=e.length;i<o;i++)(a=Pa(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===a.next&&(a.steiner=!0),s.push(ja(a));for(s.sort(za),i=0;i<s.length;i++)Fa(s[i],n),n=Ia(n,n.next);return n}(t,e,f,n)),t.length>80*n){r=o=t[0],i=a=t[1];for(var d=n;d<h;d+=n)(s=t[d])<r&&(r=s),(u=t[d+1])<i&&(i=u),s>o&&(o=s),u>a&&(a=u);c=0!==(c=Math.max(o-r,a-i))?1/c:0}return Ra(f,p,n,r,i,c),p}function Pa(t,e,n,r,i){var o,a;if(i===ts(t,e,n,r)>0)for(o=e;o<n;o+=r)a=Qa(o,t[o],t[o+1],a);else for(o=n-r;o>=e;o-=r)a=Qa(o,t[o],t[o+1],a);return a&&Ha(a,a.next)&&(Ja(a),a=a.next),a}function Ia(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!Ha(r,r.next)&&0!==Ga(r.prev,r,r.next))r=r.next;else{if(Ja(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Ra(t,e,n,r,i,o,a){if(t){!a&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=Ua(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,a,s,u,c=1;do{for(n=t,t=null,o=null,a=0;n;){for(a++,r=n,s=0,e=0;e<c&&(s++,r=r.nextZ);e++);for(u=c;s>0||u>0&&r;)0!==s&&(0===u||!r||n.z<=r.z)?(i=n,n=n.nextZ,s--):(i=r,r=r.nextZ,u--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,c*=2}while(a>1)}(i)}(t,r,i,o);for(var s,u,c=t;t.prev!==t.next;)if(s=t.prev,u=t.next,o?Oa(t,r,i,o):La(t))e.push(s.i/n),e.push(t.i/n),e.push(u.i/n),Ja(t),t=u.next,c=u.next;else if((t=u)===c){a?1===a?Ra(t=Da(Ia(t),e,n),e,n,r,i,o,2):2===a&&Na(t,e,n,r,i,o):Ra(Ia(t),e,n,r,i,o,1);break}}}function La(t){var e=t.prev,n=t,r=t.next;if(Ga(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Za(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Ga(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function Oa(t,e,n,r){var i=t.prev,o=t,a=t.next;if(Ga(i,o,a)>=0)return!1;for(var s=i.x>o.x?i.x>a.x?i.x:a.x:o.x>a.x?o.x:a.x,u=i.y>o.y?i.y>a.y?i.y:a.y:o.y>a.y?o.y:a.y,c=Ua(i.x<o.x?i.x<a.x?i.x:a.x:o.x<a.x?o.x:a.x,i.y<o.y?i.y<a.y?i.y:a.y:o.y<a.y?o.y:a.y,e,n,r),l=Ua(s,u,e,n,r),h=t.prevZ,f=t.nextZ;h&&h.z>=c&&f&&f.z<=l;){if(h!==t.prev&&h!==t.next&&Za(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,f!==t.prev&&f!==t.next&&Za(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Ga(f.prev,f,f.next)>=0)return!1;f=f.nextZ}for(;h&&h.z>=c;){if(h!==t.prev&&h!==t.next&&Za(i.x,i.y,o.x,o.y,a.x,a.y,h.x,h.y)&&Ga(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;f&&f.z<=l;){if(f!==t.prev&&f!==t.next&&Za(i.x,i.y,o.x,o.y,a.x,a.y,f.x,f.y)&&Ga(f.prev,f,f.next)>=0)return!1;f=f.nextZ}return!0}function Da(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!Ha(i,o)&&Wa(i,r,r.next,o)&&Ya(i,o)&&Ya(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),Ja(r),Ja(r.next),r=t=o),r=r.next}while(r!==t);return Ia(r)}function Na(t,e,n,r,i,o){var a=t;do{for(var s=a.next.next;s!==a.prev;){if(a.i!==s.i&&Va(a,s)){var u=Ka(a,s);return a=Ia(a,a.next),u=Ia(u,u.next),Ra(a,e,n,r,i,o),void Ra(u,e,n,r,i,o)}s=s.next}a=a.next}while(a!==t)}function za(t,e){return t.x-e.x}function Fa(t,e){if(e=function(t,e){var n,r=e,i=t.x,o=t.y,a=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var s=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(s<=i&&s>a){if(a=s,s===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===a)return n;var u,c=n,l=n.x,h=n.y,f=1/0;r=n;do{i>=r.x&&r.x>=l&&i!==r.x&&Za(o<h?i:a,o,l,h,o<h?a:i,o,r.x,r.y)&&(u=Math.abs(o-r.y)/(i-r.x),Ya(r,t)&&(u<f||u===f&&(r.x>n.x||r.x===n.x&&Ba(n,r)))&&(n=r,f=u)),r=r.next}while(r!==c);return n}(t,e)){var n=Ka(e,t);Ia(e,e.next),Ia(n,n.next)}}function Ba(t,e){return Ga(t.prev,t,e.prev)<0&&Ga(e.next,t,t.next)<0}function Ua(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function ja(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Za(t,e,n,r,i,o,a,s){return(i-a)*(e-s)-(t-a)*(o-s)>=0&&(t-a)*(r-s)-(n-a)*(e-s)>=0&&(n-a)*(o-s)-(i-a)*(r-s)>=0}function Va(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&Wa(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(Ya(t,e)&&Ya(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Ga(t.prev,t,e.prev)||Ga(t,e.prev,e))||Ha(t,e)&&Ga(t.prev,t,t.next)>0&&Ga(e.prev,e,e.next)>0)}function Ga(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function Ha(t,e){return t.x===e.x&&t.y===e.y}function Wa(t,e,n,r){var i=Xa(Ga(t,e,n)),o=Xa(Ga(t,e,r)),a=Xa(Ga(n,r,t)),s=Xa(Ga(n,r,e));return i!==o&&a!==s||!(0!==i||!qa(t,n,e))||!(0!==o||!qa(t,r,e))||!(0!==a||!qa(n,t,r))||!(0!==s||!qa(n,e,r))}function qa(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function Xa(t){return t>0?1:t<0?-1:0}function Ya(t,e){return Ga(t.prev,t,t.next)<0?Ga(t,e,t.next)>=0&&Ga(t,t.prev,e)>=0:Ga(t,e,t.prev)<0||Ga(t,t.next,e)<0}function Ka(t,e){var n=new $a(t.i,t.x,t.y),r=new $a(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function Qa(t,e,n,r){var i=new $a(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function Ja(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function $a(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ts(t,e,n,r){for(var i=0,o=e,a=n-r;o<n;o+=r)i+=(t[a]-t[o])*(t[o+1]+t[a+1]),a=o;return i}function es(t,e,n,r,i){!function t(e,n,r,i,o){for(;i>r;){if(i-r>600){var a=i-r+1,s=n-r+1,u=Math.log(a),c=.5*Math.exp(2*u/3),l=.5*Math.sqrt(u*c*(a-c)/a)*(s-a/2<0?-1:1);t(e,n,Math.max(r,Math.floor(n-s*c/a+l)),Math.min(i,Math.floor(n+(a-s)*c/a+l)),o)}var h=e[n],f=r,p=i;for(ns(e,r,n),o(e[i],h)>0&&ns(e,r,i);f<p;){for(ns(e,f,p),f++,p--;o(e[f],h)<0;)f++;for(;o(e[p],h)>0;)p--}0===o(e[r],h)?ns(e,r,p):ns(e,++p,i),p<=n&&(r=p+1),n<=p&&(i=p-1)}}(t,e,n||0,r||t.length-1,i||rs)}function ns(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function rs(t,e){return t<e?-1:t>e?1:0}function is(t,e){var n=t.length;if(n<=1)return[t];for(var r,i,o=[],a=0;a<n;a++){var s=T(t[a]);0!==s&&(t[a].area=Math.abs(s),void 0===i&&(i=s<0),i===s<0?(r&&o.push(r),r=[t[a]]):r.push(t[a]))}if(r&&o.push(r),e>1)for(var u=0;u<o.length;u++)o[u].length<=e||(es(o[u],e,1,o[u].length-1,os),o[u]=o[u].slice(0,e));return o}function os(t,e){return e.area-t.area}function as(t,e,n){for(var r=n.patternDependencies,i=!1,o=0,a=e;o<a.length;o+=1){var s=a[o].paint.get(t+"-pattern");s.isConstant()||(i=!0);var u=s.constantOr(null);u&&(i=!0,r[u.to]=!0,r[u.from]=!0)}return i}function ss(t,e,n,r,i){for(var o=i.patternDependencies,a=0,s=e;a<s.length;a+=1){var u=s[a],c=u.paint.get(t+"-pattern").value;if("constant"!==c.kind){var l=c.evaluate({zoom:r-1},n,{},i.availableImages),h=c.evaluate({zoom:r},n,{},i.availableImages),f=c.evaluate({zoom:r+1},n,{},i.availableImages);h=h&&h.name?h.name:h,f=f&&f.name?f.name:f,o[l=l&&l.name?l.name:l]=!0,o[h]=!0,o[f]=!0,n.patterns[u.id]={min:l,mid:h,max:f}}}return n}Ma.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs(ts(t,0,i?e[0]*n:t.length,n));if(i)for(var a=0,s=e.length;a<s;a++)o-=Math.abs(ts(t,e[a]*n,a<s-1?e[a+1]*n:t.length,n));var u=0;for(a=0;a<r.length;a+=3){var c=r[a]*n,l=r[a+1]*n,h=r[a+2]*n;u+=Math.abs((t[c]-t[h])*(t[l+1]-t[c+1])-(t[c]-t[l])*(t[h+1]-t[c+1]))}return 0===o&&0===u?0:Math.abs((u-o)/o)},Ma.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var a=0;a<e;a++)n.vertices.push(t[i][o][a]);i>0&&n.holes.push(r+=t[i-1].length)}return n},Ca.default=ka;var us=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Mi,this.indexArray=new Zi,this.indexArray2=new Xi,this.programConfigurations=new No(t.layers,t.zoom),this.segments=new uo,this.segments2=new uo,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};us.prototype.populate=function(t,e,n){this.hasPattern=as("fill",this.layers,e);for(var r=this.layers[0].layout.get("fill-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,c=s.id,l=s.index,h=s.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,p=Zo(u,f);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),p,n)){var d=r?r.evaluate(p,{},n,e.availableImages):void 0,v={id:c,properties:u.properties,type:u.type,sourceLayerIndex:h,index:l,geometry:f?p.geometry:jo(u),patterns:{},sortKey:d};i.push(v)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,g=i;m<g.length;m+=1){var y=g[m],_=y.geometry,x=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var w=ss("fill",this.layers,y,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(y,_,x,n,{});e.featureIndex.insert(t[x].feature,_,x,b,this.index)}},us.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},us.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},us.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},us.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},us.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Ta),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0},us.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},us.prototype.addFeature=function(t,e,n,r,i){for(var o=0,a=is(e,500);o<a.length;o+=1){for(var s=a[o],u=0,c=0,l=s;c<l.length;c+=1)u+=l[c].length;for(var h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray),f=h.vertexLength,p=[],d=[],v=0,m=s;v<m.length;v+=1){var g=m[v];if(0!==g.length){g!==s[0]&&d.push(p.length/2);var y=this.segments2.prepareSegment(g.length,this.layoutVertexArray,this.indexArray2),_=y.vertexLength;this.layoutVertexArray.emplaceBack(g[0].x,g[0].y),this.indexArray2.emplaceBack(_+g.length-1,_),p.push(g[0].x),p.push(g[0].y);for(var x=1;x<g.length;x++)this.layoutVertexArray.emplaceBack(g[x].x,g[x].y),this.indexArray2.emplaceBack(_+x-1,_+x),p.push(g[x].x),p.push(g[x].y);y.vertexLength+=g.length,y.primitiveLength+=g.length}}for(var b=Ca(p,d),w=0;w<b.length;w+=3)this.indexArray.emplaceBack(f+b[w],f+b[w+1],f+b[w+2]);h.vertexLength+=u,h.primitiveLength+=b.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Br("FillBucket",us,{omit:["layers","patternFeatures"]});var cs=new wi({"fill-sort-key":new yi(Pt.layout_fill["fill-sort-key"])}),ls={paint:new wi({"fill-antialias":new gi(Pt.paint_fill["fill-antialias"]),"fill-opacity":new yi(Pt.paint_fill["fill-opacity"]),"fill-color":new yi(Pt.paint_fill["fill-color"]),"fill-outline-color":new yi(Pt.paint_fill["fill-outline-color"]),"fill-translate":new gi(Pt.paint_fill["fill-translate"]),"fill-translate-anchor":new gi(Pt.paint_fill["fill-translate-anchor"]),"fill-pattern":new _i(Pt.paint_fill["fill-pattern"])}),layout:cs},hs=function(t){function e(e){t.call(this,e,ls)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n);var r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},e.prototype.createBucket=function(t){return new us(t)},e.prototype.queryRadius=function(){return ra(this.paint.get("fill-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,i,o,a){return qo(ia(t,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,a),r)},e.prototype.isTileClipped=function(){return!0},e}(Ei),fs=Ci([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,ps=ds;function ds(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(vs,this,e)}function vs(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function ms(t){for(var e,n,r=0,i=0,o=t.length,a=o-1;i<o;a=i++)r+=((n=t[a]).x-(e=t[i]).x)*(e.y+n.y);return r}ds.types=["Unknown","Point","LineString","Polygon"],ds.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,o=0,a=0,s=0,u=[];t.pos<n;){if(o<=0){var c=t.readVarint();r=7&c,o=c>>3}if(o--,1===r||2===r)a+=t.readSVarint(),s+=t.readSVarint(),1===r&&(e&&u.push(e),e=[]),e.push(new i(a,s));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&u.push(e),u},ds.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,a=1/0,s=-1/0,u=1/0,c=-1/0;t.pos<e;){if(r<=0){var l=t.readVarint();n=7&l,r=l>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<a&&(a=i),i>s&&(s=i),(o+=t.readSVarint())<u&&(u=o),o>c&&(c=o);else if(7!==n)throw new Error("unknown command "+n)}return[a,u,s,c]},ds.prototype.toGeoJSON=function(t,e,n){var r,i,o=this.extent*Math.pow(2,n),a=this.extent*t,s=this.extent*e,u=this.loadGeometry(),c=ds.types[this.type];function l(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+a)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+s)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<u.length;r++)h[r]=u[r][0];l(u=h);break;case 2:for(r=0;r<u.length;r++)l(u[r]);break;case 3:for(u=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var a=ms(t[o]);0!==a&&(void 0===r&&(r=a<0),r===a<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(u),r=0;r<u.length;r++)for(i=0;i<u[r].length;i++)l(u[r][i])}1===u.length?u=u[0]:c="Multi"+c;var f={type:"Feature",geometry:{type:c,coordinates:u},properties:this.properties};return"id"in this&&(f.id=this.id),f};var gs=ys;function ys(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(_s,this,e),this.length=this._features.length}function _s(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}function xs(t,e,n){if(3===t){var r=new gs(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}ys.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new ps(this._pbf,e,this.extent,this._keys,this._values)};var bs={VectorTile:function(t,e){this.layers=t.readFields(xs,{},e)},VectorTileFeature:ps,VectorTileLayer:gs},ws=bs.VectorTileFeature.types,Es=Math.pow(2,13);function Ss(t,e,n,r,i,o,a,s){t.emplaceBack(e,n,2*Math.floor(r*Es)+a,i*Es*2,o*Es*2,Math.round(s))}var As=function(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.layoutVertexArray=new Ii,this.indexArray=new Zi,this.programConfigurations=new No(t.layers,t.zoom),this.segments=new uo,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};function Ts(t,e){return t.x===e.x&&(t.x<0||t.x>8192)||t.y===e.y&&(t.y<0||t.y>8192)}As.prototype.populate=function(t,e,n){this.features=[],this.hasPattern=as("fill-extrusion",this.layers,e);for(var r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.feature,s=o.id,u=o.index,c=o.sourceLayerIndex,l=this.layers[0]._featureFilter.needGeometry,h=Zo(a,l);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),h,n)){var f={id:s,sourceLayerIndex:c,index:u,geometry:l?h.geometry:jo(a),properties:a.properties,type:a.type,patterns:{}};this.hasPattern?this.features.push(ss("fill-extrusion",this.layers,f,this.zoom,e)):this.addFeature(f,f.geometry,u,n,{}),e.featureIndex.insert(a,f.geometry,u,c,this.index,!0)}}},As.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.features;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},As.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},As.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},As.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},As.prototype.upload=function(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,fs),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},As.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},As.prototype.addFeature=function(t,e,n,r,i){for(var o=0,a=is(e,500);o<a.length;o+=1){for(var s=a[o],u=0,c=0,l=s;c<l.length;c+=1)u+=l[c].length;for(var h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),f=0,p=s;f<p.length;f+=1){var d=p[f];if(0!==d.length&&!((R=d).every((function(t){return t.x<0}))||R.every((function(t){return t.x>8192}))||R.every((function(t){return t.y<0}))||R.every((function(t){return t.y>8192}))))for(var v=0,m=0;m<d.length;m++){var g=d[m];if(m>=1){var y=d[m-1];if(!Ts(g,y)){h.vertexLength+4>uo.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var _=g.sub(y)._perp()._unit(),x=y.dist(g);v+x>32768&&(v=0),Ss(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,0,v),Ss(this.layoutVertexArray,g.x,g.y,_.x,_.y,0,1,v),Ss(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,0,v+=x),Ss(this.layoutVertexArray,y.x,y.y,_.x,_.y,0,1,v);var b=h.vertexLength;this.indexArray.emplaceBack(b,b+2,b+1),this.indexArray.emplaceBack(b+1,b+2,b+3),h.vertexLength+=4,h.primitiveLength+=2}}}}if(h.vertexLength+u>uo.MAX_VERTEX_ARRAY_LENGTH&&(h=this.segments.prepareSegment(u,this.layoutVertexArray,this.indexArray)),"Polygon"===ws[t.type]){for(var w=[],E=[],S=h.vertexLength,A=0,T=s;A<T.length;A+=1){var C=T[A];if(0!==C.length){C!==s[0]&&E.push(w.length/2);for(var k=0;k<C.length;k++){var M=C[k];Ss(this.layoutVertexArray,M.x,M.y,0,0,1,1,0),w.push(M.x),w.push(M.y)}}}for(var P=Ca(w,E),I=0;I<P.length;I+=3)this.indexArray.emplaceBack(S+P[I],S+P[I+2],S+P[I+1]);h.primitiveLength+=P.length/3,h.vertexLength+=u}}var R;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Br("FillExtrusionBucket",As,{omit:["layers","features"]});var Cs={paint:new wi({"fill-extrusion-opacity":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new yi(Pt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _i(Pt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new yi(Pt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new yi(Pt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new gi(Pt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},ks=function(t){function e(e){t.call(this,e,Cs)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.createBucket=function(t){return new As(t)},e.prototype.queryRadius=function(){return ra(this.paint.get("fill-extrusion-translate"))},e.prototype.is3D=function(){return!0},e.prototype.queryIntersectsFeature=function(t,e,n,r,o,a,s,u){var c=ia(t,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),a.angle,s),l=this.paint.get("fill-extrusion-height").evaluate(e,n),h=this.paint.get("fill-extrusion-base").evaluate(e,n),f=function(t,e,n,r){for(var o=[],a=0,s=t;a<s.length;a+=1){var u=s[a],c=[u.x,u.y,0,1];fa(c,c,e),o.push(new i(c[0]/c[3],c[1]/c[3]))}return o}(c,u),p=function(t,e,n,r){for(var o=[],a=[],s=r[8]*e,u=r[9]*e,c=r[10]*e,l=r[11]*e,h=r[8]*n,f=r[9]*n,p=r[10]*n,d=r[11]*n,v=0,m=t;v<m.length;v+=1){for(var g=[],y=[],_=0,x=m[v];_<x.length;_+=1){var b=x[_],w=b.x,E=b.y,S=r[0]*w+r[4]*E+r[12],A=r[1]*w+r[5]*E+r[13],T=r[2]*w+r[6]*E+r[14],C=r[3]*w+r[7]*E+r[15],k=T+c,M=C+l,P=S+h,I=A+f,R=T+p,L=C+d,O=new i((S+s)/M,(A+u)/M);O.z=k/M,g.push(O);var D=new i(P/L,I/L);D.z=R/L,y.push(D)}o.push(g),a.push(y)}return[o,a]}(r,h,l,u);return function(t,e,n){var r=1/0;qo(n,e)&&(r=Ps(n,e[0]));for(var i=0;i<e.length;i++)for(var o=e[i],a=t[i],s=0;s<o.length-1;s++){var u=o[s],c=[u,o[s+1],a[s+1],a[s],u];Ho(n,c)&&(r=Math.min(r,Ps(n,c)))}return r!==1/0&&r}(p[0],p[1],f)},e}(Ei);function Ms(t,e){return t.x*e.x+t.y*e.y}function Ps(t,e){if(1===t.length){for(var n,r=0,i=e[r++];!n||i.equals(n);)if(!(n=e[r++]))return 1/0;for(;r<e.length;r++){var o=e[r],a=t[0],s=n.sub(i),u=o.sub(i),c=a.sub(i),l=Ms(s,s),h=Ms(s,u),f=Ms(u,u),p=Ms(c,s),d=Ms(c,u),v=l*f-h*h,m=(f*p-h*d)/v,g=(l*d-h*p)/v,y=i.z*(1-m-g)+n.z*m+o.z*g;if(isFinite(y))return y}return 1/0}for(var _=1/0,x=0,b=e;x<b.length;x+=1)_=Math.min(_,b[x].z);return _}var Is=Ci([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Rs=Ci([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Ls=bs.VectorTileFeature.types,Os=Math.cos(Math.PI/180*37.5),Ds=Math.pow(2,14)/.5,Ns=function(t){var e=this;this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((function(t){e.gradients[t.id]={}})),this.layoutVertexArray=new Ri,this.layoutVertexArray2=new Li,this.indexArray=new Zi,this.programConfigurations=new No(t.layers,t.zoom),this.segments=new uo,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id}))};Ns.prototype.populate=function(t,e,n){this.hasPattern=as("line",this.layers,e);for(var r=this.layers[0].layout.get("line-sort-key"),i=[],o=0,a=t;o<a.length;o+=1){var s=a[o],u=s.feature,c=s.id,l=s.index,h=s.sourceLayerIndex,f=this.layers[0]._featureFilter.needGeometry,p=Zo(u,f);if(this.layers[0]._featureFilter.filter(new ui(this.zoom),p,n)){var d=r?r.evaluate(p,{},n):void 0,v={id:c,properties:u.properties,type:u.type,sourceLayerIndex:h,index:l,geometry:f?p.geometry:jo(u),patterns:{},sortKey:d};i.push(v)}}r&&i.sort((function(t,e){return t.sortKey-e.sortKey}));for(var m=0,g=i;m<g.length;m+=1){var y=g[m],_=y.geometry,x=y.index,b=y.sourceLayerIndex;if(this.hasPattern){var w=ss("line",this.layers,y,this.zoom,e);this.patternFeatures.push(w)}else this.addFeature(y,_,x,n,{});e.featureIndex.insert(t[x].feature,_,x,b,this.index)}},Ns.prototype.update=function(t,e,n){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n)},Ns.prototype.addFeatures=function(t,e,n){for(var r=0,i=this.patternFeatures;r<i.length;r+=1){var o=i[r];this.addFeature(o,o.geometry,o.index,e,n)}},Ns.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length},Ns.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ns.prototype.upload=function(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Rs)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Is),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0},Ns.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ns.prototype.lineFeatureClips=function(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}},Ns.prototype.addFeature=function(t,e,n,r,i){var o=this.layers[0].layout,a=o.get("line-join").evaluate(t,{}),s=o.get("line-cap"),u=o.get("line-miter-limit"),c=o.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(var l=0,h=e;l<h.length;l+=1)this.addLine(h[l],t,a,s,u,c);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,r)},Ns.prototype.addLine=function(t,e,n,r,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var a=0;a<t.length-1;a++)this.totalDistance+=t[a].dist(t[a+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var s="Polygon"===Ls[e.type],u=t.length;u>=2&&t[u-1].equals(t[u-2]);)u--;for(var c=0;c<u-1&&t[c].equals(t[c+1]);)c++;if(!(u<(s?3:2))){"bevel"===n&&(i=1.05);var l,h=this.overscaling<=16?122880/(512*this.overscaling):0,f=this.segments.prepareSegment(10*u,this.layoutVertexArray,this.indexArray),p=void 0,d=void 0,v=void 0,m=void 0;this.e1=this.e2=-1,s&&(m=t[c].sub(l=t[u-2])._unit()._perp());for(var g=c;g<u;g++)if(!(d=g===u-1?s?t[c+1]:void 0:t[g+1])||!t[g].equals(d)){m&&(v=m),l&&(p=l),l=t[g],m=d?d.sub(l)._unit()._perp():v;var y=(v=v||m).add(m);0===y.x&&0===y.y||y._unit();var _=v.x*m.x+v.y*m.y,x=y.x*m.x+y.y*m.y,b=0!==x?1/x:1/0,w=2*Math.sqrt(2-2*x),E=x<Os&&p&&d,S=v.x*m.y-v.y*m.x>0;if(E&&g>c){var A=l.dist(p);if(A>2*h){var T=l.sub(l.sub(p)._mult(h/A)._round());this.updateDistance(p,T),this.addCurrentVertex(T,v,0,0,f),p=T}}var C=p&&d,k=C?n:s?"butt":r;if(C&&"round"===k&&(b<o?k="miter":b<=2&&(k="fakeround")),"miter"===k&&b>i&&(k="bevel"),"bevel"===k&&(b>2&&(k="flipbevel"),b<i&&(k="miter")),p&&this.updateDistance(p,l),"miter"===k)y._mult(b),this.addCurrentVertex(l,y,0,0,f);else if("flipbevel"===k){if(b>100)y=m.mult(-1);else{var M=b*v.add(m).mag()/v.sub(m).mag();y._perp()._mult(M*(S?-1:1))}this.addCurrentVertex(l,y,0,0,f),this.addCurrentVertex(l,y.mult(-1),0,0,f)}else if("bevel"===k||"fakeround"===k){var P=-Math.sqrt(b*b-1),I=S?P:0,R=S?0:P;if(p&&this.addCurrentVertex(l,v,I,R,f),"fakeround"===k)for(var L=Math.round(180*w/Math.PI/20),O=1;O<L;O++){var D=O/L;if(.5!==D){var N=D-.5;D+=D*N*(D-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*N*N+(.848013+_*(.215638*_-1.06021)))}var z=m.sub(v)._mult(D)._add(v)._unit()._mult(S?-1:1);this.addHalfVertex(l,z.x,z.y,!1,S,0,f)}d&&this.addCurrentVertex(l,m,-I,-R,f)}else if("butt"===k)this.addCurrentVertex(l,y,0,0,f);else if("square"===k){var F=p?1:-1;this.addCurrentVertex(l,y,F,F,f)}else"round"===k&&(p&&(this.addCurrentVertex(l,v,0,0,f),this.addCurrentVertex(l,v,1,1,f,!0)),d&&(this.addCurrentVertex(l,m,-1,-1,f,!0),this.addCurrentVertex(l,m,0,0,f)));if(E&&g<u-1){var B=l.dist(d);if(B>2*h){var U=l.add(d.sub(l)._mult(h/B)._round());this.updateDistance(l,U),this.addCurrentVertex(U,m,0,0,f),l=U}}}}},Ns.prototype.addCurrentVertex=function(t,e,n,r,i,o){void 0===o&&(o=!1);var a=e.y*r-e.x,s=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,o,!1,n,i),this.addHalfVertex(t,a,s,o,!0,-r,i),this.distance>Ds/2&&0===this.totalDistance&&(this.distance=0,this.addCurrentVertex(t,e,n,r,i,o))},Ns.prototype.addHalfVertex=function(t,e,n,r,i,o,a){var s=.5*(this.lineClips?this.scaledDistance*(Ds-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((t.x<<1)+(r?1:0),(t.y<<1)+(i?1:0),Math.round(63*e)+128,Math.round(63*n)+128,1+(0===o?0:o<0?-1:1)|(63&s)<<2,s>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var u=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),a.primitiveLength++),i?this.e2=u:this.e1=u},Ns.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ns.prototype.updateDistance=function(t,e){this.distance+=t.dist(e),this.updateScaledDistance()},Br("LineBucket",Ns,{omit:["layers","patternFeatures"]});var zs=new wi({"line-cap":new gi(Pt.layout_line["line-cap"]),"line-join":new yi(Pt.layout_line["line-join"]),"line-miter-limit":new gi(Pt.layout_line["line-miter-limit"]),"line-round-limit":new gi(Pt.layout_line["line-round-limit"]),"line-sort-key":new yi(Pt.layout_line["line-sort-key"])}),Fs={paint:new wi({"line-opacity":new yi(Pt.paint_line["line-opacity"]),"line-color":new yi(Pt.paint_line["line-color"]),"line-translate":new gi(Pt.paint_line["line-translate"]),"line-translate-anchor":new gi(Pt.paint_line["line-translate-anchor"]),"line-width":new yi(Pt.paint_line["line-width"]),"line-gap-width":new yi(Pt.paint_line["line-gap-width"]),"line-offset":new yi(Pt.paint_line["line-offset"]),"line-blur":new yi(Pt.paint_line["line-blur"]),"line-dasharray":new xi(Pt.paint_line["line-dasharray"]),"line-pattern":new _i(Pt.paint_line["line-pattern"]),"line-gradient":new bi(Pt.paint_line["line-gradient"])}),layout:zs},Bs=new(function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.possiblyEvaluate=function(e,n){return n=new ui(Math.floor(n.zoom),{now:n.now,fadeDuration:n.fadeDuration,zoomHistory:n.zoomHistory,transition:n.transition}),t.prototype.possiblyEvaluate.call(this,e,n)},e.prototype.evaluate=function(e,n,r,i){return n=p({},n,{zoom:Math.floor(n.zoom)}),t.prototype.evaluate.call(this,e,n,r,i)},e}(yi))(Fs.paint.properties["line-width"].specification);Bs.useIntegerZoom=!0;var Us=function(t){function e(e){t.call(this,e,Fs),this.gradientVersion=0}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._handleSpecialPaintPropertyUpdate=function(t){"line-gradient"===t&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ge,this.gradientVersion=(this.gradientVersion+1)%u)},e.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},e.prototype.recalculate=function(e,n){t.prototype.recalculate.call(this,e,n),this.paint._values["line-floorwidth"]=Bs.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)},e.prototype.createBucket=function(t){return new Ns(t)},e.prototype.queryRadius=function(t){var e=t,n=js(na("line-width",this,e),na("line-gap-width",this,e)),r=na("line-offset",this,e);return n/2+Math.abs(r)+ra(this.paint.get("line-translate"))},e.prototype.queryIntersectsFeature=function(t,e,n,r,o,a,s){var u=ia(t,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),a.angle,s),c=s/2*js(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),l=this.paint.get("line-offset").evaluate(e,n);return l&&(r=function(t,e){for(var n=[],r=new i(0,0),o=0;o<t.length;o++){for(var a=t[o],s=[],u=0;u<a.length;u++){var c=a[u],l=a[u+1],h=0===u?r:c.sub(a[u-1])._unit()._perp(),f=u===a.length-1?r:l.sub(c)._unit()._perp(),p=h._add(f)._unit();p._mult(1/(p.x*f.x+p.y*f.y)),s.push(p._mult(e)._add(c))}n.push(s)}return n}(r,l*s)),function(t,e,n){for(var r=0;r<e.length;r++){var i=e[r];if(t.length>=3)for(var o=0;o<i.length;o++)if(ta(t,i[o]))return!0;if(Xo(t,i,n))return!0}return!1}(u,r,c)},e.prototype.isTileClipped=function(){return!0},e}(Ei);function js(t,e){return e>0?e+2*t:t}var Zs=Ci([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Vs=Ci([{name:"a_projected_pos",components:3,type:"Float32"}],4),Gs=(Ci([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),Ci([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Hs=(Ci([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),Ci([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),Ws=Ci([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function qs(t,e,n){return t.sections.forEach((function(t){t.text=function(t,e,n){var r=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),si.applyArabicShaping&&(t=si.applyArabicShaping(t)),t}(t.text,e,n)})),t}Ci([{name:"triangle",components:3,type:"Uint16"}]),Ci([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),Ci([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Ci([{type:"Float32",name:"offsetX"}]),Ci([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Xs={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂"},Ys=function(t,e,n,r,i){var o,a,s=8*i-r-1,u=(1<<s)-1,c=u>>1,l=-7,h=n?i-1:0,f=n?-1:1,p=t[e+h];for(h+=f,o=p&(1<<-l)-1,p>>=-l,l+=s;l>0;o=256*o+t[e+h],h+=f,l-=8);for(a=o&(1<<-l)-1,o>>=-l,l+=r;l>0;a=256*a+t[e+h],h+=f,l-=8);if(0===o)o=1-c;else{if(o===u)return a?NaN:1/0*(p?-1:1);a+=Math.pow(2,r),o-=c}return(p?-1:1)*a*Math.pow(2,o-r)},Ks=function(t,e,n,r,i,o){var a,s,u,c=8*o-i-1,l=(1<<c)-1,h=l>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,d=r?1:-1,v=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(s=isNaN(e)?1:0,a=l):(a=Math.floor(Math.log(e)/Math.LN2),e*(u=Math.pow(2,-a))<1&&(a--,u*=2),(e+=a+h>=1?f/u:f*Math.pow(2,1-h))*u>=2&&(a++,u/=2),a+h>=l?(s=0,a=l):a+h>=1?(s=(e*u-1)*Math.pow(2,i),a+=h):(s=e*Math.pow(2,h-1)*Math.pow(2,i),a=0));i>=8;t[n+p]=255&s,p+=d,s/=256,i-=8);for(a=a<<i|s,c+=i;c>0;t[n+p]=255&a,p+=d,a/=256,c-=8);t[n+p-d]|=128*v},Qs=Js;function Js(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Js.Varint=0,Js.Fixed64=1,Js.Bytes=2,Js.Fixed32=5;var $s="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function tu(t){return t.type===Js.Bytes?t.readVarint()+t.pos:t.pos+1}function eu(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function nu(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function ru(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function iu(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function ou(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function au(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function su(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function uu(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function cu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function lu(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function hu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function fu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function pu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function du(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function vu(t,e,n){1===t&&n.readMessage(mu,e)}function mu(t,e,n){if(3===t){var r=n.readMessage(gu,{}),i=r.width,o=r.height,a=r.left,s=r.top,u=r.advance;e.push({id:r.id,bitmap:new _a({width:i+6,height:o+6},r.bitmap),metrics:{width:i,height:o,left:a,top:s,advance:u}})}}function gu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function yu(t){for(var e=0,n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];e+=o.w*o.h,n=Math.max(n,o.w)}t.sort((function(t,e){return e.h-t.h}));for(var a=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}],s=0,u=0,c=0,l=t;c<l.length;c+=1)for(var h=l[c],f=a.length-1;f>=0;f--){var p=a[f];if(!(h.w>p.w||h.h>p.h)){if(h.x=p.x,h.y=p.y,u=Math.max(u,h.y+h.h),s=Math.max(s,h.x+h.w),h.w===p.w&&h.h===p.h){var d=a.pop();f<a.length&&(a[f]=d)}else h.h===p.h?(p.x+=h.w,p.w-=h.w):h.w===p.w?(p.y+=h.h,p.h-=h.h):(a.push({x:p.x+h.w,y:p.y,w:p.w-h.w,h:h.h}),p.y+=h.h,p.h-=h.h);break}}return{w:s,h:u,fill:e/(s*u)||0}}Js.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=fu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=du(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=fu(this.buf,this.pos)+4294967296*fu(this.buf,this.pos+4);return this.pos+=8,t},readSFixed64:function(){var t=fu(this.buf,this.pos)+4294967296*du(this.buf,this.pos+4);return this.pos+=8,t},readFloat:function(){var t=Ys(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=Ys(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return eu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return eu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return eu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return eu(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return eu(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return eu(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&$s?function(t,e,n){return $s.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var r="",i=e;i<n;){var o,a,s,u=t[i],c=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l>n)break;1===l?u<128&&(c=u):2===l?128==(192&(o=t[i+1]))&&(c=(31&u)<<6|63&o)<=127&&(c=null):3===l?(a=t[i+2],128==(192&(o=t[i+1]))&&128==(192&a)&&((c=(15&u)<<12|(63&o)<<6|63&a)<=2047||c>=55296&&c<=57343)&&(c=null)):4===l&&(a=t[i+2],s=t[i+3],128==(192&(o=t[i+1]))&&128==(192&a)&&128==(192&s)&&((c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s)<=65535||c>=1114112)&&(c=null)),null===c?(c=65533,l=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),i+=l}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Js.Bytes)return t.push(this.readVarint(e));var n=tu(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Js.Bytes)return t.push(this.readSVarint());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Js.Bytes)return t.push(this.readBoolean());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Js.Bytes)return t.push(this.readFloat());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Js.Bytes)return t.push(this.readDouble());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Js.Bytes)return t.push(this.readFixed32());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Js.Bytes)return t.push(this.readSFixed32());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Js.Bytes)return t.push(this.readFixed64());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Js.Bytes)return t.push(this.readSFixed64());var e=tu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Js.Varint)for(;this.buf[this.pos++]>127;);else if(e===Js.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Js.Fixed32)this.pos+=4;else{if(e!==Js.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),pu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),pu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),pu(this.buf,-1&t,this.pos),pu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),pu(this.buf,-1&t,this.pos),pu(this.buf,Math.floor(t*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&nu(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),Ks(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),Ks(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&nu(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Js.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,ru,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,iu,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,su,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,ou,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,au,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,uu,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,cu,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,lu,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,hu,e)},writeBytesField:function(t,e){this.writeTag(t,Js.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Js.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Js.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Js.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Js.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Js.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Js.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Js.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Js.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Js.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};var _u=function(t,e){var n=e.pixelRatio,r=e.version,i=e.stretchX,o=e.stretchY,a=e.content;this.paddedRect=t,this.pixelRatio=n,this.stretchX=i,this.stretchY=o,this.content=a,this.version=r},xu={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};xu.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},xu.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},xu.tlbr.get=function(){return this.tl.concat(this.br)},xu.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(_u.prototype,xu);var bu=function(t,e){var n={},r={};this.haveRenderCallbacks=[];var i=[];this.addImages(t,n,i),this.addImages(e,r,i);var o=yu(i),a=new xa({width:o.w||1,height:o.h||1});for(var s in t){var u=t[s],c=n[s].paddedRect;xa.copy(u.data,a,{x:0,y:0},{x:c.x+1,y:c.y+1},u.data)}for(var l in e){var h=e[l],f=r[l].paddedRect,p=f.x+1,d=f.y+1,v=h.data.width,m=h.data.height;xa.copy(h.data,a,{x:0,y:0},{x:p,y:d},h.data),xa.copy(h.data,a,{x:0,y:m-1},{x:p,y:d-1},{width:v,height:1}),xa.copy(h.data,a,{x:0,y:0},{x:p,y:d+m},{width:v,height:1}),xa.copy(h.data,a,{x:v-1,y:0},{x:p-1,y:d},{width:1,height:m}),xa.copy(h.data,a,{x:0,y:0},{x:p+v,y:d},{width:1,height:m})}this.image=a,this.iconPositions=n,this.patternPositions=r};bu.prototype.addImages=function(t,e,n){for(var r in t){var i=t[r],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(o),e[r]=new _u(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}},bu.prototype.patchUpdatedImages=function(t,e){for(var n in t.dispatchRenderCallbacks(this.haveRenderCallbacks),t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)},bu.prototype.patchUpdatedImage=function(t,e,n){if(t&&e&&t.version!==e.version){t.version=e.version;var r=t.tl;n.update(e.data,void 0,{x:r[0],y:r[1]})}},Br("ImagePosition",_u),Br("ImageAtlas",bu);var wu={horizontal:1,vertical:2,horizontalOnly:3},Eu=function(){this.scale=1,this.fontStack="",this.imageName=null};Eu.forText=function(t,e){var n=new Eu;return n.scale=t||1,n.fontStack=e,n},Eu.forImage=function(t){var e=new Eu;return e.imageName=t,e};var Su=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function Au(t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v){var m,g=Su.fromFeature(t,i);h===wu.vertical&&g.verticalizePunctuation();var y=si.processBidirectionalText,_=si.processStyledBidirectionalText;if(y&&1===g.sections.length){m=[];for(var x=0,b=y(g.toString(),Ru(g,c,o,e,r,p,d));x<b.length;x+=1){var w=b[x],E=new Su;E.text=w,E.sections=g.sections;for(var S=0;S<w.length;S++)E.sectionIndex.push(0);m.push(E)}}else if(_){m=[];for(var A=0,T=_(g.text,g.sectionIndex,Ru(g,c,o,e,r,p,d));A<T.length;A+=1){var C=T[A],k=new Su;k.text=C[0],k.sectionIndex=C[1],k.sections=g.sections,m.push(k)}}else m=function(t,e){for(var n=[],r=t.text,i=0,o=0,a=e;o<a.length;o+=1){var s=a[o];n.push(t.substring(i,s)),i=s}return i<r.length&&n.push(t.substring(i,r.length)),n}(g,Ru(g,c,o,e,r,p,d));var M=[],P={positionedLines:M,text:g.toString(),top:l[1],bottom:l[1],left:l[0],right:l[0],writingMode:h,iconsInText:!1,verticalizable:!1};return function(t,e,n,r,i,o,a,s,u,c,l,h){for(var f=0,p=-17,d=0,v=0,m="right"===s?1:"left"===s?0:.5,g=0,y=0,_=i;y<_.length;y+=1){var x=_[y];x.trim();var b=x.getMaxScale(),w=24*(b-1),E={positionedGlyphs:[],lineOffset:0};t.positionedLines[g]=E;var S=E.positionedGlyphs,A=0;if(x.length()){for(var T=0;T<x.length();T++){var C=x.getSection(T),k=x.getSectionIndex(T),M=x.getCharCode(T),P=0,I=null,R=null,L=null,O=24,D=!(u===wu.horizontal||!l&&!Xr(M)||l&&(Tu[M]||(G=M,Wr.Arabic(G)||Wr["Arabic Supplement"](G)||Wr["Arabic Extended-A"](G)||Wr["Arabic Presentation Forms-A"](G)||Wr["Arabic Presentation Forms-B"](G))));if(C.imageName){var N=r[C.imageName];if(!N)continue;L=C.imageName,t.iconsInText=t.iconsInText||!0,R=N.paddedRect;var z=N.displaySize;C.scale=24*C.scale/h,P=w+(24-z[1]*C.scale),O=(I={width:z[0],height:z[1],left:1,top:-3,advance:D?z[1]:z[0]}).advance;var F=D?z[0]*C.scale-24*b:z[1]*C.scale-24*b;F>0&&F>A&&(A=F)}else{var B=n[C.fontStack],U=B&&B[M];if(U&&U.rect)R=U.rect,I=U.metrics;else{var j=e[C.fontStack],Z=j&&j[M];if(!Z)continue;I=Z.metrics}P=24*(b-C.scale)}D?(t.verticalizable=!0,S.push({glyph:M,imageName:L,x:f,y:p+P,vertical:D,scale:C.scale,fontStack:C.fontStack,sectionIndex:k,metrics:I,rect:R}),f+=O*C.scale+c):(S.push({glyph:M,imageName:L,x:f,y:p+P,vertical:D,scale:C.scale,fontStack:C.fontStack,sectionIndex:k,metrics:I,rect:R}),f+=I.advance*C.scale+c)}0!==S.length&&(d=Math.max(f-c,d),Ou(S,0,S.length-1,m,A)),f=0;var V=o*b+A;E.lineOffset=Math.max(A,w),p+=V,v=Math.max(V,v),++g}else p+=o,++g}var G,H=p- -17,W=Lu(a),q=W.horizontalAlign,X=W.verticalAlign;(function(t,e,n,r,i,o,a,s,u){var c,l=(e-n)*i;c=o!==a?-s*r- -17:(-r*u+.5)*a;for(var h=0,f=t;h<f.length;h+=1)for(var p=0,d=f[h].positionedGlyphs;p<d.length;p+=1){var v=d[p];v.x+=l,v.y+=c}})(t.positionedLines,m,q,X,d,v,o,H,i.length),t.top+=-X*H,t.bottom=t.top+H,t.left+=-q*d,t.right=t.left+d}(P,e,n,r,m,a,s,u,h,c,f,v),!function(t){for(var e=0,n=t;e<n.length;e+=1)if(0!==n[e].positionedGlyphs.length)return!1;return!0}(M)&&P}Su.fromFeature=function(t,e){for(var n=new Su,r=0;r<t.sections.length;r++){var i=t.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,e)}return n},Su.prototype.length=function(){return this.text.length},Su.prototype.getSection=function(t){return this.sections[this.sectionIndex[t]]},Su.prototype.getSectionIndex=function(t){return this.sectionIndex[t]},Su.prototype.getCharCode=function(t){return this.text.charCodeAt(t)},Su.prototype.verticalizePunctuation=function(){this.text=function(t){for(var e="",n=0;n<t.length;n++){var r=t.charCodeAt(n+1)||null,i=t.charCodeAt(n-1)||null;e+=r&&Yr(r)&&!Xs[t[n+1]]||i&&Yr(i)&&!Xs[t[n-1]]||!Xs[t[n]]?t[n]:Xs[t[n]]}return e}(this.text)},Su.prototype.trim=function(){for(var t=0,e=0;e<this.text.length&&Tu[this.text.charCodeAt(e)];e++)t++;for(var n=this.text.length,r=this.text.length-1;r>=0&&r>=t&&Tu[this.text.charCodeAt(r)];r--)n--;this.text=this.text.substring(t,n),this.sectionIndex=this.sectionIndex.slice(t,n)},Su.prototype.substring=function(t,e){var n=new Su;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n},Su.prototype.toString=function(){return this.text},Su.prototype.getMaxScale=function(){var t=this;return this.sectionIndex.reduce((function(e,n){return Math.max(e,t.sections[n].scale)}),0)},Su.prototype.addTextSection=function(t,e){this.text+=t.text,this.sections.push(Eu.forText(t.scale,t.fontStack||e));for(var n=this.sections.length-1,r=0;r<t.text.length;++r)this.sectionIndex.push(n)},Su.prototype.addImageSection=function(t){var e=t.image?t.image.name:"";if(0!==e.length){var n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Eu.forImage(e)),this.sectionIndex.push(this.sections.length-1)):S("Reached maximum number of images 6401")}else S("Can't add FormattedSection with an empty image.")},Su.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var Tu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Cu={};function ku(t,e,n,r,i,o){if(e.imageName){var a=r[e.imageName];return a?a.displaySize[0]*e.scale*24/o+i:0}var s=n[e.fontStack],u=s&&s[t];return u?u.metrics.advance*e.scale+i:0}function Mu(t,e,n,r){var i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(n)*n}function Pu(t,e,n){var r=0;return 10===t&&(r-=1e4),n&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function Iu(t,e,n,r,i,o){for(var a=null,s=Mu(e,n,i,o),u=0,c=r;u<c.length;u+=1){var l=c[u],h=Mu(e-l.x,n,i,o)+l.badness;h<=s&&(a=l,s=h)}return{index:t,x:e,priorBreak:a,badness:s}}function Ru(t,e,n,r,i,o,a){if("point"!==o)return[];if(!t)return[];for(var s,u=[],c=function(t,e,n,r,i,o){for(var a=0,s=0;s<t.length();s++){var u=t.getSection(s);a+=ku(t.getCharCode(s),u,r,i,e,o)}return a/Math.max(1,Math.ceil(a/n))}(t,e,n,r,i,a),l=t.text.indexOf("​")>=0,h=0,f=0;f<t.length();f++){var p=t.getSection(f),d=t.getCharCode(f);if(Tu[d]||(h+=ku(d,p,r,i,e,a)),f<t.length()-1){var v=!((s=d)<11904||!(Wr["Bopomofo Extended"](s)||Wr.Bopomofo(s)||Wr["CJK Compatibility Forms"](s)||Wr["CJK Compatibility Ideographs"](s)||Wr["CJK Compatibility"](s)||Wr["CJK Radicals Supplement"](s)||Wr["CJK Strokes"](s)||Wr["CJK Symbols and Punctuation"](s)||Wr["CJK Unified Ideographs Extension A"](s)||Wr["CJK Unified Ideographs"](s)||Wr["Enclosed CJK Letters and Months"](s)||Wr["Halfwidth and Fullwidth Forms"](s)||Wr.Hiragana(s)||Wr["Ideographic Description Characters"](s)||Wr["Kangxi Radicals"](s)||Wr["Katakana Phonetic Extensions"](s)||Wr.Katakana(s)||Wr["Vertical Forms"](s)||Wr["Yi Radicals"](s)||Wr["Yi Syllables"](s)));(Cu[d]||v||p.imageName)&&u.push(Iu(f+1,h,c,u,Pu(d,t.getCharCode(f+1),v&&l),!1))}}return function t(e){return e?t(e.priorBreak).concat(e.index):[]}(Iu(t.length(),h,c,u,0,!0))}function Lu(t){var e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function Ou(t,e,n,r,i){if(r||i)for(var o=t[n],a=(t[n].x+o.metrics.advance*o.scale)*r,s=e;s<=n;s++)t[s].x-=a,t[s].y+=i}function Du(t,e,n,r,i,o){var a,s=t.image;if(s.content){var u=s.content,c=s.pixelRatio||1;a=[u[0]/c,u[1]/c,s.displaySize[0]-u[2]/c,s.displaySize[1]-u[3]/c]}var l,h,f,p,d=e.left*o,v=e.right*o;"width"===n||"both"===n?(p=i[0]+d-r[3],h=i[0]+v+r[1]):h=(p=i[0]+(d+v-s.displaySize[0])/2)+s.displaySize[0];var m=e.top*o,g=e.bottom*o;return"height"===n||"both"===n?(l=i[1]+m-r[0],f=i[1]+g+r[2]):f=(l=i[1]+(m+g-s.displaySize[1])/2)+s.displaySize[1],{image:s,top:l,right:h,bottom:f,left:p,collisionPadding:a}}Cu[10]=!0,Cu[32]=!0,Cu[38]=!0,Cu[40]=!0,Cu[41]=!0,Cu[43]=!0,Cu[45]=!0,Cu[47]=!0,Cu[173]=!0,Cu[183]=!0,Cu[8203]=!0,Cu[8208]=!0,Cu[8211]=!0,Cu[8231]=!0;var Nu=function(t){function e(e,n,r,i){t.call(this,e,n),this.angle=r,void 0!==i&&(this.segment=i)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.clone=function(){return new e(this.x,this.y,this.angle,this.segment)},e}(i);function zu(t,e){var n=e.expression;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new ui(t+1))};if("source"===n.kind)return{kind:"source"};for(var r=n.zoomStops,i=n.interpolationType,o=0;o<r.length&&r[o]<=t;)o++;for(var a=o=Math.max(0,o-1);a<r.length&&r[a]<t+1;)a++;a=Math.min(r.length-1,a);var s=r[o],u=r[a];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:u,interpolationType:i}:{kind:"camera",minZoom:s,maxZoom:u,minSize:n.evaluate(new ui(s)),maxSize:n.evaluate(new ui(u)),interpolationType:i}}function Fu(t,e,n){var r=e.uSize,i=n.lowerSize;return"source"===t.kind?i/128:"composite"===t.kind?He(i/128,n.upperSize/128,e.uSizeT):r}function Bu(t,e){var n=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){var i=t.interpolationType,o=i?h(sn.interpolationFactor(i,e,t.minZoom,t.maxZoom),0,1):0;"camera"===t.kind?r=He(t.minSize,t.maxSize,o):n=o}return{uSizeT:n,uSize:r}}Br("Anchor",Nu);var Uu=Object.freeze({__proto__:null,getSizeData:zu,evaluateSizeForFeature:Fu,evaluateSizeForZoom:Bu,SIZE_PACK_FACTOR:128});function ju(t,e,n,r,i){if(void 0===e.segment)return!0;for(var o=e,a=e.segment+1,s=0;s>-n/2;){if(--a<0)return!1;s-=t[a].dist(o),o=t[a]}s+=t[a].dist(t[a+1]),a++;for(var u=[],c=0;s<n/2;){var l=t[a],h=t[a+1];if(!h)return!1;var f=t[a-1].angleTo(l)-l.angleTo(h);for(f=Math.abs((f+3*Math.PI)%(2*Math.PI)-Math.PI),u.push({distance:s,angleDelta:f}),c+=f;s-u[0].distance>r;)c-=u.shift().angleDelta;if(c>i)return!1;a++,s+=l.dist(h)}return!0}function Zu(t){for(var e=0,n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function Vu(t,e,n){return t?.6*e*n:0}function Gu(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function Hu(t,e,n,r,i,o){for(var a=Vu(n,i,o),s=Gu(n,r)*o,u=0,c=Zu(t)/2,l=0;l<t.length-1;l++){var h=t[l],f=t[l+1],p=h.dist(f);if(u+p>c){var d=(c-u)/p,v=He(h.x,f.x,d),m=He(h.y,f.y,d),g=new Nu(v,m,f.angleTo(h),l);return g._round(),!a||ju(t,g,s,a,e)?g:void 0}u+=p}}function Wu(t,e,n,r,i,o,a,s,u){var c=Vu(r,o,a),l=Gu(r,i),h=l*a,f=0===t[0].x||t[0].x===u||0===t[0].y||t[0].y===u;return e-h<e/4&&(e=h+e/4),function t(e,n,r,i,o,a,s,u,c){for(var l=a/2,h=Zu(e),f=0,p=n-r,d=[],v=0;v<e.length-1;v++){for(var m=e[v],g=e[v+1],y=m.dist(g),_=g.angleTo(m);p+r<f+y;){var x=((p+=r)-f)/y,b=He(m.x,g.x,x),w=He(m.y,g.y,x);if(b>=0&&b<c&&w>=0&&w<c&&p-l>=0&&p+l<=h){var E=new Nu(b,w,_,v);E._round(),i&&!ju(e,E,a,i,o)||d.push(E)}}f+=y}return u||d.length||s||(d=t(e,f/2,r,i,o,a,s,!0,c)),d}(t,f?e/2*s%e:(l/2+2*o)*a*s%e,e,c,n,h,f,!1,u)}function qu(t,e,n,r,o){for(var a=[],s=0;s<t.length;s++)for(var u=t[s],c=void 0,l=0;l<u.length-1;l++){var h=u[l],f=u[l+1];h.x<e&&f.x<e||(h.x<e?h=new i(e,h.y+(e-h.x)/(f.x-h.x)*(f.y-h.y))._round():f.x<e&&(f=new i(e,h.y+(e-h.x)/(f.x-h.x)*(f.y-h.y))._round()),h.y<n&&f.y<n||(h.y<n?h=new i(h.x+(n-h.y)/(f.y-h.y)*(f.x-h.x),n)._round():f.y<n&&(f=new i(h.x+(n-h.y)/(f.y-h.y)*(f.x-h.x),n)._round()),h.x>=r&&f.x>=r||(h.x>=r?h=new i(r,h.y+(r-h.x)/(f.x-h.x)*(f.y-h.y))._round():f.x>=r&&(f=new i(r,h.y+(r-h.x)/(f.x-h.x)*(f.y-h.y))._round()),h.y>=o&&f.y>=o||(h.y>=o?h=new i(h.x+(o-h.y)/(f.y-h.y)*(f.x-h.x),o)._round():f.y>=o&&(f=new i(h.x+(o-h.y)/(f.y-h.y)*(f.x-h.x),o)._round()),c&&h.equals(c[c.length-1])||a.push(c=[h]),c.push(f)))))}return a}function Xu(t,e,n,r){var o=[],a=t.image,s=a.pixelRatio,u=a.paddedRect.w-2,c=a.paddedRect.h-2,l=t.right-t.left,h=t.bottom-t.top,f=a.stretchX||[[0,u]],p=a.stretchY||[[0,c]],d=function(t,e){return t+e[1]-e[0]},v=f.reduce(d,0),m=p.reduce(d,0),g=u-v,y=c-m,_=0,x=v,b=0,w=m,E=0,S=g,A=0,T=y;if(a.content&&r){var C=a.content;_=Yu(f,0,C[0]),b=Yu(p,0,C[1]),x=Yu(f,C[0],C[2]),w=Yu(p,C[1],C[3]),E=C[0]-_,A=C[1]-b,S=C[2]-C[0]-x,T=C[3]-C[1]-w}var k=function(r,o,u,c){var f=Qu(r.stretch-_,x,l,t.left),p=Ju(r.fixed-E,S,r.stretch,v),d=Qu(o.stretch-b,w,h,t.top),g=Ju(o.fixed-A,T,o.stretch,m),y=Qu(u.stretch-_,x,l,t.left),C=Ju(u.fixed-E,S,u.stretch,v),k=Qu(c.stretch-b,w,h,t.top),M=Ju(c.fixed-A,T,c.stretch,m),P=new i(f,d),I=new i(y,d),R=new i(y,k),L=new i(f,k),O=new i(p/s,g/s),D=new i(C/s,M/s),N=e*Math.PI/180;if(N){var z=Math.sin(N),F=Math.cos(N),B=[F,-z,z,F];P._matMult(B),I._matMult(B),L._matMult(B),R._matMult(B)}var U=r.stretch+r.fixed,j=o.stretch+o.fixed;return{tl:P,tr:I,bl:L,br:R,tex:{x:a.paddedRect.x+1+U,y:a.paddedRect.y+1+j,w:u.stretch+u.fixed-U,h:c.stretch+c.fixed-j},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:O,pixelOffsetBR:D,minFontScaleX:S/s/l,minFontScaleY:T/s/h,isSDF:n}};if(r&&(a.stretchX||a.stretchY))for(var M=Ku(f,g,v),P=Ku(p,y,m),I=0;I<M.length-1;I++)for(var R=M[I],L=M[I+1],O=0;O<P.length-1;O++)o.push(k(R,P[O],L,P[O+1]));else o.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:u+1},{fixed:0,stretch:c+1}));return o}function Yu(t,e,n){for(var r=0,i=0,o=t;i<o.length;i+=1){var a=o[i];r+=Math.max(e,Math.min(n,a[1]))-Math.max(e,Math.min(n,a[0]))}return r}function Ku(t,e,n){for(var r=[{fixed:-1,stretch:0}],i=0,o=t;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],c=r[r.length-1];r.push({fixed:s-c.stretch,stretch:c.stretch}),r.push({fixed:s-c.stretch,stretch:c.stretch+(u-s)})}return r.push({fixed:e+1,stretch:n}),r}function Qu(t,e,n,r){return t/e*n+r}function Ju(t,e,n,r){return t-e*n/r}var $u=function(t,e,n,r,o,a,s,u,c,l){if(this.boxStartIndex=t.length,c){var h=a.top,f=a.bottom,p=a.collisionPadding;p&&(h-=p[1],f+=p[3]);var d=f-h;d>0&&(d=Math.max(10,d),this.circleDiameter=d)}else{var v=a.top*s-u,m=a.bottom*s+u,g=a.left*s-u,y=a.right*s+u,_=a.collisionPadding;if(_&&(g-=_[0]*s,v-=_[1]*s,y+=_[2]*s,m+=_[3]*s),l){var x=new i(g,v),b=new i(y,v),w=new i(g,m),E=new i(y,m),S=l*Math.PI/180;x._rotate(S),b._rotate(S),w._rotate(S),E._rotate(S),g=Math.min(x.x,b.x,w.x,E.x),y=Math.max(x.x,b.x,w.x,E.x),v=Math.min(x.y,b.y,w.y,E.y),m=Math.max(x.y,b.y,w.y,E.y)}t.emplaceBack(e.x,e.y,g,v,y,m,n,r,o)}this.boxEndIndex=t.length},tc=function(t,e){if(void 0===t&&(t=[]),void 0===e&&(e=ec),this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(var n=(this.length>>1)-1;n>=0;n--)this._down(n)};function ec(t,e){return t<e?-1:t>e?1:0}function nc(t,e,n){void 0===e&&(e=1),void 0===n&&(n=!1);for(var r=1/0,o=1/0,a=-1/0,s=-1/0,u=t[0],c=0;c<u.length;c++){var l=u[c];(!c||l.x<r)&&(r=l.x),(!c||l.y<o)&&(o=l.y),(!c||l.x>a)&&(a=l.x),(!c||l.y>s)&&(s=l.y)}var h=Math.min(a-r,s-o),f=h/2,p=new tc([],rc);if(0===h)return new i(r,o);for(var d=r;d<a;d+=h)for(var v=o;v<s;v+=h)p.push(new ic(d+f,v+f,f,t));var m=function(t){for(var e=0,n=0,r=0,i=t[0],o=0,a=i.length,s=a-1;o<a;s=o++){var u=i[o],c=i[s],l=u.x*c.y-c.x*u.y;n+=(u.x+c.x)*l,r+=(u.y+c.y)*l,e+=3*l}return new ic(n/e,r/e,0,t)}(t);for(p.length;p.length;){var g=p.pop();(g.d>m.d||!m.d)&&(m=g),g.max-m.d<=e||(p.push(new ic(g.p.x-(f=g.h/2),g.p.y-f,f,t)),p.push(new ic(g.p.x+f,g.p.y-f,f,t)),p.push(new ic(g.p.x-f,g.p.y+f,f,t)),p.push(new ic(g.p.x+f,g.p.y+f,f,t)),4)}return m.p}function rc(t,e){return e.max-t.max}function ic(t,e,n,r){this.p=new i(t,e),this.h=n,this.d=function(t,e){for(var n=!1,r=1/0,i=0;i<e.length;i++)for(var o=e[i],a=0,s=o.length,u=s-1;a<s;u=a++){var c=o[a],l=o[u];c.y>t.y!=l.y>t.y&&t.x<(l.x-c.x)*(t.y-c.y)/(l.y-c.y)+c.x&&(n=!n),r=Math.min(r,Jo(t,c,l))}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}tc.prototype.push=function(t){this.data.push(t),this.length++,this._up(this.length-1)},tc.prototype.pop=function(){if(0!==this.length){var t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}},tc.prototype.peek=function(){return this.data[0]},tc.prototype._up=function(t){for(var e=this.data,n=this.compare,r=e[t];t>0;){var i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r},tc.prototype._down=function(t){for(var e=this.data,n=this.compare,r=this.length>>1,i=e[t];t<r;){var o=1+(t<<1),a=e[o],s=o+1;if(s<this.length&&n(e[s],a)<0&&(o=s,a=e[s]),n(a,i)>=0)break;e[t]=a,t=o}e[t]=i};var oc=Number.POSITIVE_INFINITY;function ac(t,e){return e[1]!==oc?function(t,e,n){var r=0,i=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,i]}(t,e[0],e[1]):function(t,e){var n=0,r=0;e<0&&(e=0);var i=e/Math.sqrt(2);switch(t){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-e;break;case"top":r=e-7}switch(t){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=e;break;case"right":n=-e}return[n,r]}(t,e[0])}function sc(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function uc(t,e,n,r,o,a,s,u,c,l,h,f,p,d,v){var m=function(t,e,n,r,o,a,s,u){for(var c=r.layout.get("text-rotate").evaluate(a,{})*Math.PI/180,l=[],h=0,f=e.positionedLines;h<f.length;h+=1)for(var p=f[h],d=0,v=p.positionedGlyphs;d<v.length;d+=1){var m=v[d];if(m.rect){var g=m.rect||{},y=4,_=!0,x=1,b=0,w=(o||u)&&m.vertical,E=m.metrics.advance*m.scale/2;if(u&&e.verticalizable&&(b=p.lineOffset/2-(m.imageName?-(24-m.metrics.width*m.scale)/2:24*(m.scale-1))),m.imageName){var S=s[m.imageName];_=S.sdf,y=1/(x=S.pixelRatio)}var A=o?[m.x+E,m.y]:[0,0],T=o?[0,0]:[m.x+E+n[0],m.y+n[1]-b],C=[0,0];w&&(C=T,T=[0,0]);var k=(m.metrics.left-y)*m.scale-E+T[0],M=(-m.metrics.top-y)*m.scale+T[1],P=k+g.w*m.scale/x,I=M+g.h*m.scale/x,R=new i(k,M),L=new i(P,M),O=new i(k,I),D=new i(P,I);if(w){var N=new i(-E,E- -17),z=-Math.PI/2,F=12-E,B=new i(22-F,-(m.imageName?F:0)),U=new(Function.prototype.bind.apply(i,[null].concat(C)));R._rotateAround(z,N)._add(B)._add(U),L._rotateAround(z,N)._add(B)._add(U),O._rotateAround(z,N)._add(B)._add(U),D._rotateAround(z,N)._add(B)._add(U)}if(c){var j=Math.sin(c),Z=Math.cos(c),V=[Z,-j,j,Z];R._matMult(V),L._matMult(V),O._matMult(V),D._matMult(V)}var G=new i(0,0),H=new i(0,0);l.push({tl:R,tr:L,bl:O,br:D,tex:g,writingMode:e.writingMode,glyphOffset:A,sectionIndex:m.sectionIndex,isSDF:_,pixelOffsetTL:G,pixelOffsetBR:H,minFontScaleX:0,minFontScaleY:0})}}return l}(0,n,u,o,a,s,r,t.allowVerticalPlacement),g=t.textSizeData,y=null;"source"===g.kind?(y=[128*o.layout.get("text-size").evaluate(s,{})])[0]>32640&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):"composite"===g.kind&&((y=[128*d.compositeTextSizes[0].evaluate(s,{},v),128*d.compositeTextSizes[1].evaluate(s,{},v)])[0]>32640||y[1]>32640)&&S(t.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),t.addSymbols(t.text,m,y,u,a,s,l,e,c.lineStartIndex,c.lineLength,p,v);for(var _=0,x=h;_<x.length;_+=1)f[x[_]]=t.text.placedSymbolArray.length-1;return 4*m.length}function cc(t){for(var e in t)return t[e];return null}function lc(t,e,n,r){var i=t.compareText;if(e in i){for(var o=i[e],a=o.length-1;a>=0;a--)if(r.dist(o[a])<n)return!0}else i[e]=[];return i[e].push(r),!1}var hc=bs.VectorTileFeature.types,fc=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function pc(t,e,n,r,i,o,a,s,u,c,l,h,f){var p=s?Math.min(32640,Math.round(s[0])):0,d=s?Math.min(32640,Math.round(s[1])):0;t.emplaceBack(e,n,Math.round(32*r),Math.round(32*i),o,a,(p<<1)+(u?1:0),d,16*c,16*l,256*h,256*f)}function dc(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function vc(t){for(var e=0,n=t.sections;e<n.length;e+=1)if(Jr(n[e].text))return!0;return!1}var mc=function(t){this.layoutVertexArray=new Di,this.indexArray=new Zi,this.programConfigurations=t,this.segments=new uo,this.dynamicLayoutVertexArray=new Ni,this.opacityVertexArray=new zi,this.placedSymbolArray=new to};mc.prototype.isEmpty=function(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length},mc.prototype.upload=function(t,e,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zs.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,Vs.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,fc,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(t))},mc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},Br("SymbolBuffers",mc);var gc=function(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new uo,this.collisionVertexArray=new ji};gc.prototype.upload=function(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,Gs.members,!0)},gc.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},Br("CollisionBuffers",gc);var yc=function(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((function(t){return t.id})),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ua([]),this.placementViewportMatrix=ua([]);var e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=zu(this.zoom,e["text-size"]),this.iconSizeData=zu(this.zoom,e["icon-size"]);var n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,"point"===n.get("symbol-placement")&&(this.writingModes=n.get("text-writing-mode").map((function(t){return wu[t]}))),this.stateDependentLayerIds=this.layers.filter((function(t){return t.isStateDependent()})).map((function(t){return t.id})),this.sourceID=t.sourceID};yc.prototype.createArrays=function(){this.text=new mc(new No(this.layers,this.zoom,(function(t){return/^text/.test(t)}))),this.icon=new mc(new No(this.layers,this.zoom,(function(t){return/^icon/.test(t)}))),this.glyphOffsetArray=new ro,this.lineVertexArray=new io,this.symbolInstances=new no},yc.prototype.calculateGlyphDependencies=function(t,e,n,r,i){for(var o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,(n||r)&&i){var a=Xs[t.charAt(o)];a&&(e[a.charCodeAt(0)]=!0)}},yc.prototype.populate=function(t,e,n){var r=this.layers[0],i=r.layout,o=i.get("text-font"),a=i.get("text-field"),s=i.get("icon-image"),u=("constant"!==a.value.kind||a.value.value instanceof ie&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==o.value.kind||o.value.value.length>0),c="constant"!==s.value.kind||!!s.value.value||Object.keys(s.parameters).length>0,l=i.get("symbol-sort-key");if(this.features=[],u||c){for(var h=e.iconDependencies,f=e.glyphDependencies,p=e.availableImages,d=new ui(this.zoom),v=0,m=t;v<m.length;v+=1){var g=m[v],y=g.feature,_=g.id,x=g.index,b=g.sourceLayerIndex,w=r._featureFilter.needGeometry,E=Zo(y,w);if(r._featureFilter.filter(d,E,n)){w||(E.geometry=jo(y));var S=void 0;if(u){var A=r.getValueAndResolveTokens("text-field",E,n,p),T=ie.factory(A);vc(T)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===oi()||this.hasRTLText&&si.isParsed())&&(S=qs(T,r,E))}var C=void 0;if(c){var k=r.getValueAndResolveTokens("icon-image",E,n,p);C=k instanceof oe?k:oe.fromString(k)}if(S||C){var M=this.sortFeaturesByKey?l.evaluate(E,{},n):void 0;if(this.features.push({id:_,text:S,icon:C,index:x,sourceLayerIndex:b,geometry:E.geometry,properties:y.properties,type:hc[y.type],sortKey:M}),C&&(h[C.name]=!0),S){var P=o.evaluate(E,{},n).join(","),I="map"===i.get("text-rotation-alignment")&&"point"!==i.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(wu.vertical)>=0;for(var R=0,L=S.sections;R<L.length;R+=1){var O=L[R];if(O.image)h[O.image.name]=!0;else{var D=qr(S.toString()),N=O.fontStack||P,z=f[N]=f[N]||{};this.calculateGlyphDependencies(O.text,z,I,this.allowVerticalPlacement,D)}}}}}}"line"===i.get("symbol-placement")&&(this.features=function(t){var e={},n={},r=[],i=0;function o(e){r.push(t[e]),i++}function a(t,e,i){var o=n[t];return delete n[t],n[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function s(t,n,i){var o=e[n];return delete e[n],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function u(t,e,n){var r=n?e[0][e[0].length-1]:e[0][0];return t+":"+r.x+":"+r.y}for(var c=0;c<t.length;c++){var l=t[c],h=l.geometry,f=l.text?l.text.toString():null;if(f){var p=u(f,h),d=u(f,h,!0);if(p in n&&d in e&&n[p]!==e[d]){var v=s(p,d,h),m=a(p,d,r[v].geometry);delete e[p],delete n[d],n[u(f,r[m].geometry,!0)]=m,r[v].geometry=null}else p in n?a(p,d,h):d in e?s(p,d,h):(o(c),e[p]=i-1,n[d]=i-1)}else o(c)}return r.filter((function(t){return t.geometry}))}(this.features)),this.sortFeaturesByKey&&this.features.sort((function(t,e){return t.sortKey-e.sortKey}))}},yc.prototype.update=function(t,e,n){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n))},yc.prototype.isEmpty=function(){return 0===this.symbolInstances.length&&!this.hasRTLText},yc.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},yc.prototype.upload=function(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},yc.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},yc.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},yc.prototype.addToLineVertexArray=function(t,e){var n=this.lineVertexArray.length;if(void 0!==t.segment){for(var r=t.dist(e[t.segment+1]),i=t.dist(e[t.segment]),o={},a=t.segment+1;a<e.length;a++)o[a]={x:e[a].x,y:e[a].y,tileUnitDistanceFromAnchor:r},a<e.length-1&&(r+=e[a+1].dist(e[a]));for(var s=t.segment||0;s>=0;s--)o[s]={x:e[s].x,y:e[s].y,tileUnitDistanceFromAnchor:i},s>0&&(i+=e[s-1].dist(e[s]));for(var u=0;u<e.length;u++){var c=o[u];this.lineVertexArray.emplaceBack(c.x,c.y,c.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}},yc.prototype.addSymbols=function(t,e,n,r,i,o,a,s,u,c,l,h){for(var f=t.indexArray,p=t.layoutVertexArray,d=t.segments.prepareSegment(4*e.length,p,f,this.canOverlap?o.sortKey:void 0),v=this.glyphOffsetArray.length,m=d.vertexLength,g=this.allowVerticalPlacement&&a===wu.vertical?Math.PI/2:0,y=o.text&&o.text.sections,_=0;_<e.length;_++){var x=e[_],b=x.tl,w=x.tr,E=x.bl,S=x.br,A=x.tex,T=x.pixelOffsetTL,C=x.pixelOffsetBR,k=x.minFontScaleX,M=x.minFontScaleY,P=x.glyphOffset,I=x.isSDF,R=x.sectionIndex,L=d.vertexLength,O=P[1];pc(p,s.x,s.y,b.x,O+b.y,A.x,A.y,n,I,T.x,T.y,k,M),pc(p,s.x,s.y,w.x,O+w.y,A.x+A.w,A.y,n,I,C.x,T.y,k,M),pc(p,s.x,s.y,E.x,O+E.y,A.x,A.y+A.h,n,I,T.x,C.y,k,M),pc(p,s.x,s.y,S.x,O+S.y,A.x+A.w,A.y+A.h,n,I,C.x,C.y,k,M),dc(t.dynamicLayoutVertexArray,s,g),f.emplaceBack(L,L+1,L+2),f.emplaceBack(L+1,L+2,L+3),d.vertexLength+=4,d.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(P[0]),_!==e.length-1&&R===e[_+1].sectionIndex||t.programConfigurations.populatePaintArrays(p.length,o,o.index,{},h,y&&y[R])}t.placedSymbolArray.emplaceBack(s.x,s.y,v,this.glyphOffsetArray.length-v,m,u,c,s.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],a,0,!1,0,l)},yc.prototype._addCollisionDebugVertex=function(t,e,n,r,i,o){return e.emplaceBack(0,0),t.emplaceBack(n.x,n.y,r,i,Math.round(o.x),Math.round(o.y))},yc.prototype.addCollisionDebugVertices=function(t,e,n,r,o,a,s){var u=o.segments.prepareSegment(4,o.layoutVertexArray,o.indexArray),c=u.vertexLength,l=o.layoutVertexArray,h=o.collisionVertexArray,f=s.anchorX,p=s.anchorY;this._addCollisionDebugVertex(l,h,a,f,p,new i(t,e)),this._addCollisionDebugVertex(l,h,a,f,p,new i(n,e)),this._addCollisionDebugVertex(l,h,a,f,p,new i(n,r)),this._addCollisionDebugVertex(l,h,a,f,p,new i(t,r)),u.vertexLength+=4;var d=o.indexArray;d.emplaceBack(c,c+1),d.emplaceBack(c+1,c+2),d.emplaceBack(c+2,c+3),d.emplaceBack(c+3,c),u.primitiveLength+=4},yc.prototype.addDebugCollisionBoxes=function(t,e,n,r){for(var i=t;i<e;i++){var o=this.collisionBoxArray.get(i);this.addCollisionDebugVertices(o.x1,o.y1,o.x2,o.y2,r?this.textCollisionBox:this.iconCollisionBox,o.anchorPoint,n)}},yc.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new gc(Bi,Hs.members,Xi),this.iconCollisionBox=new gc(Bi,Hs.members,Xi);for(var t=0;t<this.symbolInstances.length;t++){var e=this.symbolInstances.get(t);this.addDebugCollisionBoxes(e.textBoxStartIndex,e.textBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.verticalTextBoxStartIndex,e.verticalTextBoxEndIndex,e,!0),this.addDebugCollisionBoxes(e.iconBoxStartIndex,e.iconBoxEndIndex,e,!1),this.addDebugCollisionBoxes(e.verticalIconBoxStartIndex,e.verticalIconBoxEndIndex,e,!1)}},yc.prototype._deserializeCollisionBoxesForSymbol=function(t,e,n,r,i,o,a,s,u){for(var c={},l=e;l<n;l++){var h=t.get(l);c.textBox={x1:h.x1,y1:h.y1,x2:h.x2,y2:h.y2,anchorPointX:h.anchorPointX,anchorPointY:h.anchorPointY},c.textFeatureIndex=h.featureIndex;break}for(var f=r;f<i;f++){var p=t.get(f);c.verticalTextBox={x1:p.x1,y1:p.y1,x2:p.x2,y2:p.y2,anchorPointX:p.anchorPointX,anchorPointY:p.anchorPointY},c.verticalTextFeatureIndex=p.featureIndex;break}for(var d=o;d<a;d++){var v=t.get(d);c.iconBox={x1:v.x1,y1:v.y1,x2:v.x2,y2:v.y2,anchorPointX:v.anchorPointX,anchorPointY:v.anchorPointY},c.iconFeatureIndex=v.featureIndex;break}for(var m=s;m<u;m++){var g=t.get(m);c.verticalIconBox={x1:g.x1,y1:g.y1,x2:g.x2,y2:g.y2,anchorPointX:g.anchorPointX,anchorPointY:g.anchorPointY},c.verticalIconFeatureIndex=g.featureIndex;break}return c},yc.prototype.deserializeCollisionBoxes=function(t){this.collisionArrays=[];for(var e=0;e<this.symbolInstances.length;e++){var n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}},yc.prototype.hasTextData=function(){return this.text.segments.get().length>0},yc.prototype.hasIconData=function(){return this.icon.segments.get().length>0},yc.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},yc.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},yc.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},yc.prototype.addIndicesForPlacedSymbol=function(t,e){for(var n=t.placedSymbolArray.get(e),r=n.vertexStartIndex+4*n.numGlyphs,i=n.vertexStartIndex;i<r;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)},yc.prototype.getSortedSymbolIndexes=function(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;for(var e=Math.sin(t),n=Math.cos(t),r=[],i=[],o=[],a=0;a<this.symbolInstances.length;++a){o.push(a);var s=this.symbolInstances.get(a);r.push(0|Math.round(e*s.anchorX+n*s.anchorY)),i.push(s.featureIndex)}return o.sort((function(t,e){return r[t]-r[e]||i[e]-i[t]})),o},yc.prototype.addToSortKeyRanges=function(t,e){var n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})},yc.prototype.sortFeatures=function(t){var e=this;if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var n=0,r=this.symbolInstanceIndexes;n<r.length;n+=1){var i=this.symbolInstances.get(r[n]);this.featureSortOrder.push(i.featureIndex),[i.rightJustifiedTextSymbolIndex,i.centerJustifiedTextSymbolIndex,i.leftJustifiedTextSymbolIndex].forEach((function(t,n,r){t>=0&&r.indexOf(t)===n&&e.addIndicesForPlacedSymbol(e.text,t)})),i.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,i.verticalPlacedTextSymbolIndex),i.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.placedIconSymbolIndex),i.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,i.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},Br("SymbolBucket",yc,{omit:["layers","collisionBoxArray","features","compareText"]}),yc.MAX_GLYPHS=65535,yc.addDynamicAttributes=dc;var _c=new wi({"symbol-placement":new gi(Pt.layout_symbol["symbol-placement"]),"symbol-spacing":new gi(Pt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new gi(Pt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new yi(Pt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new gi(Pt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new gi(Pt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new gi(Pt.layout_symbol["icon-ignore-placement"]),"icon-optional":new gi(Pt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new gi(Pt.layout_symbol["icon-rotation-alignment"]),"icon-size":new yi(Pt.layout_symbol["icon-size"]),"icon-text-fit":new gi(Pt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new gi(Pt.layout_symbol["icon-text-fit-padding"]),"icon-image":new yi(Pt.layout_symbol["icon-image"]),"icon-rotate":new yi(Pt.layout_symbol["icon-rotate"]),"icon-padding":new gi(Pt.layout_symbol["icon-padding"]),"icon-keep-upright":new gi(Pt.layout_symbol["icon-keep-upright"]),"icon-offset":new yi(Pt.layout_symbol["icon-offset"]),"icon-anchor":new yi(Pt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new gi(Pt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new gi(Pt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new gi(Pt.layout_symbol["text-rotation-alignment"]),"text-field":new yi(Pt.layout_symbol["text-field"]),"text-font":new yi(Pt.layout_symbol["text-font"]),"text-size":new yi(Pt.layout_symbol["text-size"]),"text-max-width":new yi(Pt.layout_symbol["text-max-width"]),"text-line-height":new gi(Pt.layout_symbol["text-line-height"]),"text-letter-spacing":new yi(Pt.layout_symbol["text-letter-spacing"]),"text-justify":new yi(Pt.layout_symbol["text-justify"]),"text-radial-offset":new yi(Pt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new gi(Pt.layout_symbol["text-variable-anchor"]),"text-anchor":new yi(Pt.layout_symbol["text-anchor"]),"text-max-angle":new gi(Pt.layout_symbol["text-max-angle"]),"text-writing-mode":new gi(Pt.layout_symbol["text-writing-mode"]),"text-rotate":new yi(Pt.layout_symbol["text-rotate"]),"text-padding":new gi(Pt.layout_symbol["text-padding"]),"text-keep-upright":new gi(Pt.layout_symbol["text-keep-upright"]),"text-transform":new yi(Pt.layout_symbol["text-transform"]),"text-offset":new yi(Pt.layout_symbol["text-offset"]),"text-allow-overlap":new gi(Pt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new gi(Pt.layout_symbol["text-ignore-placement"]),"text-optional":new gi(Pt.layout_symbol["text-optional"])}),xc={paint:new wi({"icon-opacity":new yi(Pt.paint_symbol["icon-opacity"]),"icon-color":new yi(Pt.paint_symbol["icon-color"]),"icon-halo-color":new yi(Pt.paint_symbol["icon-halo-color"]),"icon-halo-width":new yi(Pt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new yi(Pt.paint_symbol["icon-halo-blur"]),"icon-translate":new gi(Pt.paint_symbol["icon-translate"]),"icon-translate-anchor":new gi(Pt.paint_symbol["icon-translate-anchor"]),"text-opacity":new yi(Pt.paint_symbol["text-opacity"]),"text-color":new yi(Pt.paint_symbol["text-color"],{runtimeType:Zt,getOverride:function(t){return t.textColor},hasOverride:function(t){return!!t.textColor}}),"text-halo-color":new yi(Pt.paint_symbol["text-halo-color"]),"text-halo-width":new yi(Pt.paint_symbol["text-halo-width"]),"text-halo-blur":new yi(Pt.paint_symbol["text-halo-blur"]),"text-translate":new gi(Pt.paint_symbol["text-translate"]),"text-translate-anchor":new gi(Pt.paint_symbol["text-translate-anchor"])}),layout:_c},bc=function(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Ft,this.defaultValue=t};bc.prototype.evaluate=function(t){if(t.formattedSection){var e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default},bc.prototype.eachChild=function(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)},bc.prototype.outputDefined=function(){return!1},bc.prototype.serialize=function(){return null},Br("FormatSectionOverride",bc,{omit:["defaultValue"]});var wc=function(t){function e(e){t.call(this,e,xc)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.recalculate=function(e,n){if(t.prototype.recalculate.call(this,e,n),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),"point"===this.layout.get("symbol-placement")){var r=this.layout.get("text-writing-mode");if(r){for(var i=[],o=0,a=r;o<a.length;o+=1){var s=a[o];i.indexOf(s)<0&&i.push(s)}this.layout._values["text-writing-mode"]=i}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},e.prototype.getValueAndResolveTokens=function(t,e,n,r){var i=this.layout.get(t).evaluate(e,{},n,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||qn(o.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(function(e,n){return n in t?String(t[n]):""}))}(e.properties,i)},e.prototype.createBucket=function(t){return new yc(t)},e.prototype.queryRadius=function(){return 0},e.prototype.queryIntersectsFeature=function(){return!1},e.prototype._setPaintOverrides=function(){for(var t=0,n=xc.paint.overridableProperties;t<n.length;t+=1){var r=n[t];if(e.hasPaintOverride(this.layout,r)){var i,o=this.paint.get(r),a=new bc(o),s=new Wn(a,o.property.specification);i="constant"===o.value.kind||"source"===o.value.kind?new Yn("source",s):new Kn("composite",s,o.value.zoomStops,o.value._interpolationType),this.paint._values[r]=new vi(o.property,i,o.parameters)}}},e.prototype._handleOverridablePaintPropertyUpdate=function(t,n,r){return!(!this.layout||n.isDataDriven()||r.isDataDriven())&&e.hasPaintOverride(this.layout,t)},e.hasPaintOverride=function(t,e){var n=t.get("text-field"),r=xc.paint.properties[e],i=!1,o=function(t){for(var e=0,n=t;e<n.length;e+=1)if(r.overrides&&r.overrides.hasOverride(n[e]))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof ie)o(n.value.value.sections);else if("source"===n.value.kind){var a=function t(e){i||(e instanceof le&&ue(e.value)===Wt?o(e.value.sections):e instanceof de?o(e.sections):e.eachChild(t))},s=n.value;s._styleExpression&&a(s._styleExpression.expression)}return i},e}(Ei),Ec={paint:new wi({"background-color":new gi(Pt.paint_background["background-color"]),"background-pattern":new xi(Pt.paint_background["background-pattern"]),"background-opacity":new gi(Pt.paint_background["background-opacity"])})},Sc=function(t){function e(e){t.call(this,e,Ec)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Ei),Ac={paint:new wi({"raster-opacity":new gi(Pt.paint_raster["raster-opacity"]),"raster-hue-rotate":new gi(Pt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new gi(Pt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new gi(Pt.paint_raster["raster-brightness-max"]),"raster-saturation":new gi(Pt.paint_raster["raster-saturation"]),"raster-contrast":new gi(Pt.paint_raster["raster-contrast"]),"raster-resampling":new gi(Pt.paint_raster["raster-resampling"]),"raster-fade-duration":new gi(Pt.paint_raster["raster-fade-duration"])})},Tc=function(t){function e(e){t.call(this,e,Ac)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(Ei),Cc=function(t){function e(e){t.call(this,e,{}),this.implementation=e}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.is3D=function(){return"3d"===this.implementation.renderingMode},e.prototype.hasOffscreenPass=function(){return void 0!==this.implementation.prerender},e.prototype.recalculate=function(){},e.prototype.updateTransitions=function(){},e.prototype.hasTransition=function(){},e.prototype.serialize=function(){},e.prototype.onAdd=function(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)},e.prototype.onRemove=function(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)},e}(Ei),kc={circle:pa,heatmap:Ea,hillshade:Aa,fill:hs,"fill-extrusion":ks,line:Us,symbol:wc,background:Sc,raster:Tc},Mc=s.HTMLImageElement,Pc=s.HTMLCanvasElement,Ic=s.HTMLVideoElement,Rc=s.ImageData,Lc=s.ImageBitmap,Oc=function(t,e,n,r){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,r)};Oc.prototype.update=function(t,e,n){var r=t.width,i=t.height,o=!(this.size&&this.size[0]===r&&this.size[1]===i||n),a=this.context,s=a.gl;if(this.useMipmap=Boolean(e&&e.useMipmap),s.bindTexture(s.TEXTURE_2D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA&&(!e||!1!==e.premultiply)),o)this.size=[r,i],t instanceof Mc||t instanceof Pc||t instanceof Ic||t instanceof Rc||Lc&&t instanceof Lc?s.texImage2D(s.TEXTURE_2D,0,this.format,this.format,s.UNSIGNED_BYTE,t):s.texImage2D(s.TEXTURE_2D,0,this.format,r,i,0,this.format,s.UNSIGNED_BYTE,t.data);else{var u=n||{x:0,y:0},c=u.x,l=u.y;t instanceof Mc||t instanceof Pc||t instanceof Ic||t instanceof Rc||Lc&&t instanceof Lc?s.texSubImage2D(s.TEXTURE_2D,0,c,l,s.RGBA,s.UNSIGNED_BYTE,t):s.texSubImage2D(s.TEXTURE_2D,0,c,l,r,i,s.RGBA,s.UNSIGNED_BYTE,t.data)}this.useMipmap&&this.isSizePowerOfTwo()&&s.generateMipmap(s.TEXTURE_2D)},Oc.prototype.bind=function(t,e,n){var r=this.context.gl;r.bindTexture(r.TEXTURE_2D,this.texture),n!==r.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(n=r.LINEAR),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,n||t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)},Oc.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Oc.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Dc=function(t){var e=this;this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){e._triggered=!1,e._callback()})};Dc.prototype.trigger=function(){var t=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((function(){t._triggered=!1,t._callback()}),0))},Dc.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Nc=function(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},y(["receive","process"],this),this.invoker=new Dc(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=C()?t:s};function zc(t,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}Nc.prototype.send=function(t,e,n,r,i){var o=this;void 0===i&&(i=!1);var a=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(this.callbacks[a]=n);var s=P(this.globalScope)?void 0:[];return this.target.postMessage({id:a,type:t,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:Vr(e,s)},s),{cancel:function(){n&&delete o.callbacks[a],o.target.postMessage({id:a,type:"<cancel>",targetMapId:r,sourceMapId:o.mapId})}}},Nc.prototype.receive=function(t){var e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){delete this.tasks[n];var r=this.cancelCallbacks[n];delete this.cancelCallbacks[n],r&&r()}else C()||e.mustQueue?(this.tasks[n]=e,this.taskQueue.push(n),this.invoker.trigger()):this.processTask(n,e)},Nc.prototype.process=function(){if(this.taskQueue.length){var t=this.taskQueue.shift(),e=this.tasks[t];delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),e&&this.processTask(t,e)}},Nc.prototype.processTask=function(t,e){var n=this;if("<response>"===e.type){var r=this.callbacks[t];delete this.callbacks[t],r&&(e.error?r(Gr(e.error)):r(null,Gr(e.data)))}else{var i=!1,o=P(this.globalScope)?void 0:[],a=e.hasCallback?function(e,r){i=!0,delete n.cancelCallbacks[t],n.target.postMessage({id:t,type:"<response>",sourceMapId:n.mapId,error:e?Vr(e):null,data:Vr(r,o)},o)}:function(t){i=!0},s=null,u=Gr(e.data);if(this.parent[e.type])s=this.parent[e.type](e.sourceMapId,u,a);else if(this.parent.getWorkerSource){var c=e.type.split(".");s=this.parent.getWorkerSource(e.sourceMapId,c[0],u.source)[c[1]](u,a)}else a(new Error("Could not find function "+e.type));!i&&s&&s.cancel&&(this.cancelCallbacks[t]=s.cancel)}},Nc.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Fc=function(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))};Fc.prototype.setNorthEast=function(t){return this._ne=t instanceof Bc?new Bc(t.lng,t.lat):Bc.convert(t),this},Fc.prototype.setSouthWest=function(t){return this._sw=t instanceof Bc?new Bc(t.lng,t.lat):Bc.convert(t),this},Fc.prototype.extend=function(t){var e,n,r=this._sw,i=this._ne;if(t instanceof Bc)e=t,n=t;else{if(!(t instanceof Fc))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Fc.convert(t)):this.extend(Bc.convert(t)):this;if(n=t._ne,!(e=t._sw)||!n)return this}return r||i?(r.lng=Math.min(e.lng,r.lng),r.lat=Math.min(e.lat,r.lat),i.lng=Math.max(n.lng,i.lng),i.lat=Math.max(n.lat,i.lat)):(this._sw=new Bc(e.lng,e.lat),this._ne=new Bc(n.lng,n.lat)),this},Fc.prototype.getCenter=function(){return new Bc((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Fc.prototype.getSouthWest=function(){return this._sw},Fc.prototype.getNorthEast=function(){return this._ne},Fc.prototype.getNorthWest=function(){return new Bc(this.getWest(),this.getNorth())},Fc.prototype.getSouthEast=function(){return new Bc(this.getEast(),this.getSouth())},Fc.prototype.getWest=function(){return this._sw.lng},Fc.prototype.getSouth=function(){return this._sw.lat},Fc.prototype.getEast=function(){return this._ne.lng},Fc.prototype.getNorth=function(){return this._ne.lat},Fc.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Fc.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Fc.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Fc.prototype.contains=function(t){var e=Bc.convert(t),n=e.lng,r=e.lat,i=this._sw.lng<=n&&n<=this._ne.lng;return this._sw.lng>this._ne.lng&&(i=this._sw.lng>=n&&n>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&i},Fc.convert=function(t){return!t||t instanceof Fc?t:new Fc(t)};var Bc=function(t,e){if(isNaN(t)||isNaN(e))throw new Error("Invalid LngLat object: ("+t+", "+e+")");if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Bc.prototype.wrap=function(){return new Bc(f(this.lng,-180,180),this.lat)},Bc.prototype.toArray=function(){return[this.lng,this.lat]},Bc.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Bc.prototype.distanceTo=function(t){var e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return 6371008.8*Math.acos(Math.min(i,1))},Bc.prototype.toBounds=function(t){void 0===t&&(t=0);var e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new Fc(new Bc(this.lng-n,this.lat-e),new Bc(this.lng+n,this.lat+e))},Bc.convert=function(t){if(t instanceof Bc)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Bc(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==o(t)&&null!==t)return new Bc(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var Uc=2*Math.PI*6371008.8;function jc(t){return Uc*Math.cos(t*Math.PI/180)}function Zc(t){return(180+t)/360}function Vc(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function Gc(t,e){return t/jc(e)}function Hc(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}var Wc=function(t,e,n){void 0===n&&(n=0),this.x=+t,this.y=+e,this.z=+n};Wc.fromLngLat=function(t,e){void 0===e&&(e=0);var n=Bc.convert(t);return new Wc(Zc(n.lng),Vc(n.lat),Gc(e,n.lat))},Wc.prototype.toLngLat=function(){return new Bc(360*this.x-180,Hc(this.y))},Wc.prototype.toAltitude=function(){return this.z*jc(Hc(this.y))},Wc.prototype.meterInMercatorCoordinateUnits=function(){return 1/Uc*(t=Hc(this.y),1/Math.cos(t*Math.PI/180));var t};var qc=function(t,e,n){this.z=t,this.x=e,this.y=n,this.key=Kc(0,t,t,e,n)};qc.prototype.equals=function(t){return this.z===t.z&&this.x===t.x&&this.y===t.y},qc.prototype.url=function(t,e){var n,r,i,o,a,s=(r=this.y,i=this.z,o=zc(256*(n=this.x),256*(r=Math.pow(2,i)-r-1),i),a=zc(256*(n+1),256*(r+1),i),o[0]+","+o[1]+","+a[0]+","+a[1]),u=function(t,e,n){for(var r,i="",o=t;o>0;o--)i+=(e&(r=1<<o-1)?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",u).replace("{bbox-epsg-3857}",s)},qc.prototype.getTilePoint=function(t){var e=Math.pow(2,this.z);return new i(8192*(t.x*e-this.x),8192*(t.y*e-this.y))},qc.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Xc=function(t,e){this.wrap=t,this.canonical=e,this.key=Kc(t,e.z,e.z,e.x,e.y)},Yc=function(t,e,n,r,i){this.overscaledZ=t,this.wrap=e,this.canonical=new qc(n,+r,+i),this.key=Kc(e,t,n,r,i)};function Kc(t,e,n,r,i){(t*=2)<0&&(t=-1*t-1);var o=1<<n;return(o*o*t+o*i+r).toString(36)+n.toString(36)+e.toString(36)}Yc.prototype.equals=function(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)},Yc.prototype.scaledTo=function(t){var e=this.canonical.z-t;return t>this.canonical.z?new Yc(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Yc(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)},Yc.prototype.calculateScaledKey=function(t,e){var n=this.canonical.z-t;return t>this.canonical.z?Kc(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y):Kc(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)},Yc.prototype.isChildOf=function(t){if(t.wrap!==this.wrap)return!1;var e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e},Yc.prototype.children=function(t){if(this.overscaledZ>=t)return[new Yc(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var e=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Yc(e,this.wrap,e,n,r),new Yc(e,this.wrap,e,n+1,r),new Yc(e,this.wrap,e,n,r+1),new Yc(e,this.wrap,e,n+1,r+1)]},Yc.prototype.isLessThan=function(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))},Yc.prototype.wrapped=function(){return new Yc(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},Yc.prototype.unwrapTo=function(t){return new Yc(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)},Yc.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},Yc.prototype.toUnwrapped=function(){return new Xc(this.wrap,this.canonical)},Yc.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},Yc.prototype.getTilePoint=function(t){return this.canonical.getTilePoint(new Wc(t.x-this.wrap,t.y))},Br("CanonicalTileID",qc),Br("OverscaledTileID",Yc,{omit:["posMatrix"]});var Qc=function(t,e,n){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return S('"'+n+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=e.height;var r=this.dim=e.height-2;this.data=new Uint32Array(e.data.buffer),this.encoding=n||"mapbox";for(var i=0;i<r;i++)this.data[this._idx(-1,i)]=this.data[this._idx(0,i)],this.data[this._idx(r,i)]=this.data[this._idx(r-1,i)],this.data[this._idx(i,-1)]=this.data[this._idx(i,0)],this.data[this._idx(i,r)]=this.data[this._idx(i,r-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(r,-1)]=this.data[this._idx(r-1,0)],this.data[this._idx(-1,r)]=this.data[this._idx(0,r-1)],this.data[this._idx(r,r)]=this.data[this._idx(r-1,r-1)]};Qc.prototype.get=function(t,e){var n=new Uint8Array(this.data.buffer),r=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(n[r],n[r+1],n[r+2])},Qc.prototype.getUnpackVector=function(){return"terrarium"===this.encoding?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Qc.prototype._idx=function(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)},Qc.prototype._unpackMapbox=function(t,e,n){return(256*t*256+256*e+n)/10-1e4},Qc.prototype._unpackTerrarium=function(t,e,n){return 256*t+e+n/256-32768},Qc.prototype.getPixels=function(){return new xa({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Qc.prototype.backfillBorder=function(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");var r=e*this.dim,i=e*this.dim+this.dim,o=n*this.dim,a=n*this.dim+this.dim;switch(e){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=a-1;break;case 1:a=o+1}for(var s=-e*this.dim,u=-n*this.dim,c=o;c<a;c++)for(var l=r;l<i;l++)this.data[this._idx(l,c)]=t.data[this._idx(l+s,c+u)]},Br("DEMData",Qc);var Jc=function(t){this._stringToNumber={},this._numberToString=[];for(var e=0;e<t.length;e++){var n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}};Jc.prototype.encode=function(t){return this._stringToNumber[t]},Jc.prototype.decode=function(t){return this._numberToString[t]};var $c=function(t,e,n,r,i){this.type="Feature",this._vectorTileFeature=t,t._z=e,t._x=n,t._y=r,this.properties=t.properties,this.id=i},tl={geometry:{configurable:!0}};tl.geometry.get=function(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},tl.geometry.set=function(t){this._geometry=t},$c.prototype.toJSON=function(){var t={geometry:this.geometry};for(var e in this)"_geometry"!==e&&"_vectorTileFeature"!==e&&(t[e]=this[e]);return t},Object.defineProperties($c.prototype,tl);var el=function(){this.state={},this.stateChanges={},this.deletedStates={}};el.prototype.updateState=function(t,e,n){var r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},p(this.stateChanges[t][r],n),null===this.deletedStates[t])for(var i in this.deletedStates[t]={},this.state[t])i!==r&&(this.deletedStates[t][i]=null);else if(this.deletedStates[t]&&null===this.deletedStates[t][r])for(var o in this.deletedStates[t][r]={},this.state[t][r])n[o]||(this.deletedStates[t][r][o]=null);else for(var a in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][a]&&delete this.deletedStates[t][r][a]},el.prototype.removeFeatureState=function(t,e,n){if(null!==this.deletedStates[t]){var r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(n in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][n]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}},el.prototype.getState=function(t,e){var n=String(e),r=p({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){var i=this.deletedStates[t][e];if(null===i)return{};for(var o in i)delete r[o]}return r},el.prototype.initializeTileState=function(t,e){t.setFeatureState(this.state,e)},el.prototype.coalesceChanges=function(t,e){var n={};for(var r in this.stateChanges){this.state[r]=this.state[r]||{};var i={};for(var o in this.stateChanges[r])this.state[r][o]||(this.state[r][o]={}),p(this.state[r][o],this.stateChanges[r][o]),i[o]=this.state[r][o];n[r]=i}for(var a in this.deletedStates){this.state[a]=this.state[a]||{};var s={};if(null===this.deletedStates[a])for(var u in this.state[a])s[u]={},this.state[a][u]={};else for(var c in this.deletedStates[a]){if(null===this.deletedStates[a][c])this.state[a][c]={};else for(var l=0,h=Object.keys(this.deletedStates[a][c]);l<h.length;l+=1)delete this.state[a][c][h[l]];s[c]=this.state[a][c]}n[a]=n[a]||{},p(n[a],s)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(var f in t)t[f].setFeatureState(n,e)};var nl=function(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Or(8192,16,0),this.grid3D=new Or(8192,16,0),this.featureIndexArray=new ao,this.promoteId=e};function rl(t,e,n,r,i){return x(t,(function(t,o){var a=e instanceof mi?e.get(o):null;return a&&a.evaluate?a.evaluate(n,r,i):a}))}function il(t){for(var e=1/0,n=1/0,r=-1/0,i=-1/0,o=0,a=t;o<a.length;o+=1){var s=a[o];e=Math.min(e,s.x),n=Math.min(n,s.y),r=Math.max(r,s.x),i=Math.max(i,s.y)}return{minX:e,minY:n,maxX:r,maxY:i}}function ol(t,e){return e-t}nl.prototype.insert=function(t,e,n,r,i,o){var a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i);for(var s=o?this.grid3D:this.grid,u=0;u<e.length;u++){for(var c=e[u],l=[1/0,1/0,-1/0,-1/0],h=0;h<c.length;h++){var f=c[h];l[0]=Math.min(l[0],f.x),l[1]=Math.min(l[1],f.y),l[2]=Math.max(l[2],f.x),l[3]=Math.max(l[3],f.y)}l[0]<8192&&l[1]<8192&&l[2]>=0&&l[3]>=0&&s.insert(a,l[0],l[1],l[2],l[3])}},nl.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new bs.VectorTile(new Qs(this.rawTileData)).layers,this.sourceLayerCoder=new Jc(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},nl.prototype.query=function(t,e,n,r){var o=this;this.loadVTLayers();for(var a=t.params||{},s=8192/t.tileSize/t.scale,u=sr(a.filter),c=t.queryGeometry,l=t.queryPadding*s,h=il(c),f=this.grid.query(h.minX-l,h.minY-l,h.maxX+l,h.maxY+l),p=il(t.cameraQueryGeometry),d=this.grid3D.query(p.minX-l,p.minY-l,p.maxX+l,p.maxY+l,(function(e,n,r,o){return function(t,e,n,r,o){for(var a=0,s=t;a<s.length;a+=1){var u=s[a];if(e<=u.x&&n<=u.y&&r>=u.x&&o>=u.y)return!0}var c=[new i(e,n),new i(e,o),new i(r,o),new i(r,n)];if(t.length>2)for(var l=0,h=c;l<h.length;l+=1)if(ta(t,h[l]))return!0;for(var f=0;f<t.length-1;f++)if(ea(t[f],t[f+1],c))return!0;return!1}(t.cameraQueryGeometry,e-l,n-l,r+l,o+l)})),v=0,m=d;v<m.length;v+=1)f.push(m[v]);f.sort(ol);for(var g,y={},_=function(i){var l=f[i];if(l!==g){g=l;var h=o.featureIndexArray.get(l),p=null;o.loadMatchingFeature(y,h.bucketIndex,h.sourceLayerIndex,h.featureIndex,u,a.layers,a.availableImages,e,n,r,(function(e,n,r){return p||(p=jo(e)),n.queryIntersectsFeature(c,e,r,p,o.z,t.transform,s,t.pixelPosMatrix)}))}},x=0;x<f.length;x++)_(x);return y},nl.prototype.loadMatchingFeature=function(t,e,n,r,i,o,a,s,u,c,l){var h=this.bucketLayerIDs[e];if(!o||function(t,e){for(var n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(o,h)){var f=this.sourceLayerCoder.decode(n),d=this.vtLayers[f].feature(r);if(i.needGeometry){var v=Zo(d,!0);if(!i.filter(new ui(this.tileID.overscaledZ),v,this.tileID.canonical))return}else if(!i.filter(new ui(this.tileID.overscaledZ),d))return;for(var m=this.getId(d,f),g=0;g<h.length;g++){var y=h[g];if(!(o&&o.indexOf(y)<0)){var _=s[y];if(_){var x={};void 0!==m&&c&&(x=c.getState(_.sourceLayer||"_geojsonTileLayer",m));var b=p({},u[y]);b.paint=rl(b.paint,_.paint,d,x,a),b.layout=rl(b.layout,_.layout,d,x,a);var w=!l||l(d,_,x);if(w){var E=new $c(d,this.z,this.x,this.y,m);E.layer=b;var S=t[y];void 0===S&&(S=t[y]=[]),S.push({featureIndex:r,feature:E,intersectionZ:w})}}}}}},nl.prototype.lookupSymbolFeatures=function(t,e,n,r,i,o,a,s){var u={};this.loadVTLayers();for(var c=sr(i),l=0,h=t;l<h.length;l+=1)this.loadMatchingFeature(u,n,r,h[l],c,o,a,s,e);return u},nl.prototype.hasLayer=function(t){for(var e=0,n=this.bucketLayerIDs;e<n.length;e+=1)for(var r=0,i=n[e];r<i.length;r+=1)if(t===i[r])return!0;return!1},nl.prototype.getId=function(t,e){var n=t.id;return this.promoteId&&"boolean"==typeof(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]])&&(n=Number(n)),n},Br("FeatureIndex",nl,{omit:["rawTileData","sourceLayerCoder"]});var al=function(t,e){this.tileID=t,this.uid=v(),this.uses=0,this.tileSize=e,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};al.prototype.registerFadeDuration=function(t){var e=t+this.timeAdded;e<B.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)},al.prototype.wasRequested=function(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state},al.prototype.loadVectorData=function(t,e,n){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",t){for(var r in t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){var n={};if(!e)return n;for(var r=function(){var t=o[i],r=t.layerIds.map((function(t){return e.getLayer(t)})).filter(Boolean);if(0!==r.length){t.layers=r,t.stateDependentLayerIds&&(t.stateDependentLayers=t.stateDependentLayerIds.map((function(t){return r.filter((function(e){return e.id===t}))[0]})));for(var a=0,s=r;a<s.length;a+=1)n[s[a].id]=t}},i=0,o=t;i<o.length;i+=1)r();return n}(t.buckets,e.style),this.hasSymbolBuckets=!1,this.buckets){var i=this.buckets[r];if(i instanceof yc){if(this.hasSymbolBuckets=!0,!n)break;i.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var o in this.buckets){var a=this.buckets[o];if(a instanceof yc&&a.hasRTLText){this.hasRTLText=!0,si.isLoading()||si.isLoaded()||"deferred"!==oi()||ai();break}}for(var s in this.queryPadding=0,this.buckets){var u=this.buckets[s];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(s).queryRadius(u))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage)}else this.collisionBoxArray=new Ji},al.prototype.unloadVectorData=function(){for(var t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},al.prototype.getBucket=function(t){return this.buckets[t.id]},al.prototype.upload=function(t){for(var e in this.buckets){var n=this.buckets[e];n.uploadPending()&&n.upload(t)}var r=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Oc(t,this.imageAtlas.image,r.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Oc(t,this.glyphAtlasImage,r.ALPHA),this.glyphAtlasImage=null)},al.prototype.prepare=function(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)},al.prototype.queryRenderedFeatures=function(t,e,n,r,i,o,a,s,u,c){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:r,cameraQueryGeometry:i,scale:o,tileSize:this.tileSize,pixelPosMatrix:c,transform:s,params:a,queryPadding:this.queryPadding*u},t,e,n):{}},al.prototype.querySourceFeatures=function(t,e){var n=this.latestFeatureIndex;if(n&&n.rawTileData){var r=n.loadVTLayers(),i=e?e.sourceLayer:"",o=r._geojsonTileLayer||r[i];if(o)for(var a=sr(e&&e.filter),s=this.tileID.canonical,u=s.z,c=s.x,l=s.y,h={z:u,x:c,y:l},f=0;f<o.length;f++){var p=o.feature(f);if(a.needGeometry){var d=Zo(p,!0);if(!a.filter(new ui(this.tileID.overscaledZ),d,this.tileID.canonical))continue}else if(!a.filter(new ui(this.tileID.overscaledZ),p))continue;var v=n.getId(p,i),m=new $c(p,u,c,l,v);m.tile=h,t.push(m)}}},al.prototype.hasData=function(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state},al.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},al.prototype.setExpiryData=function(t){var e=this.expirationTime;if(t.cacheControl){var n=k(t.cacheControl);n["max-age"]&&(this.expirationTime=Date.now()+1e3*n["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){var r=Date.now(),i=!1;if(this.expirationTime>r)i=!1;else if(e)if(this.expirationTime<e)i=!0;else{var o=this.expirationTime-e;o?this.expirationTime=r+Math.max(o,3e4):i=!0}else i=!0;i?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},al.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)},al.prototype.setFeatureState=function(t,e){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&0!==Object.keys(t).length){var n=this.latestFeatureIndex.loadVTLayers();for(var r in this.buckets)if(e.style.hasLayer(r)){var i=this.buckets[r],o=i.layers[0].sourceLayer||"_geojsonTileLayer",a=n[o],s=t[o];if(a&&s&&0!==Object.keys(s).length){i.update(s,a,this.imageAtlas&&this.imageAtlas.patternPositions||{});var u=e&&e.style&&e.style.getLayer(r);u&&(this.queryPadding=Math.max(this.queryPadding,u.queryRadius(i)))}}}},al.prototype.holdingForFade=function(){return void 0!==this.symbolFadeHoldUntil},al.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<B.now()},al.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},al.prototype.setHoldDuration=function(t){this.symbolFadeHoldUntil=B.now()+t},al.prototype.setDependencies=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1)n[i[r]]=!0;this.dependencies[t]=n},al.prototype.hasDependency=function(t,e){for(var n=0,r=t;n<r.length;n+=1){var i=this.dependencies[r[n]];if(i)for(var o=0,a=e;o<a.length;o+=1)if(i[a[o]])return!0}return!1};var sl=s.performance,ul=function(t){this._marks={start:[t.url,"start"].join("#"),end:[t.url,"end"].join("#"),measure:t.url.toString()},sl.mark(this._marks.start)};ul.prototype.finish=function(){sl.mark(this._marks.end);var t=sl.getEntriesByName(this._marks.measure);return 0===t.length&&(sl.measure(this._marks.measure,this._marks.start,this._marks.end),t=sl.getEntriesByName(this._marks.measure),sl.clearMarks(this._marks.start),sl.clearMarks(this._marks.end),sl.clearMeasures(this._marks.measure)),t},t.Actor=Nc,t.AlphaImage=_a,t.CanonicalTileID=qc,t.CollisionBoxArray=Ji,t.Color=ee,t.DEMData=Qc,t.DataConstantProperty=gi,t.DictionaryCoder=Jc,t.EXTENT=8192,t.ErrorEvent=kt,t.EvaluationParameters=ui,t.Event=Ct,t.Evented=Mt,t.FeatureIndex=nl,t.FillBucket=us,t.FillExtrusionBucket=As,t.ImageAtlas=bu,t.ImagePosition=_u,t.LineBucket=Ns,t.LngLat=Bc,t.LngLatBounds=Fc,t.MercatorCoordinate=Wc,t.ONE_EM=24,t.OverscaledTileID=Yc,t.Point=i,t.Point$1=i,t.Properties=wi,t.Protobuf=Qs,t.RGBAImage=xa,t.RequestManager=W,t.RequestPerformance=ul,t.ResourceType=vt,t.SegmentVector=uo,t.SourceFeatureState=el,t.StructArrayLayout1ui2=Yi,t.StructArrayLayout2f1f2i16=Ui,t.StructArrayLayout2i4=Mi,t.StructArrayLayout3ui6=Zi,t.StructArrayLayout4i8=Pi,t.SymbolBucket=yc,t.Texture=Oc,t.Tile=al,t.Transitionable=hi,t.Uniform1f=wo,t.Uniform1i=bo,t.Uniform2f=Eo,t.Uniform3f=So,t.Uniform4f=Ao,t.UniformColor=To,t.UniformMatrix4f=ko,t.UnwrappedTileID=Xc,t.ValidationError=It,t.WritingMode=wu,t.ZoomHistory=Hr,t.add=function(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t},t.addDynamicAttributes=dc,t.asyncAll=function(t,e,n){if(!t.length)return n(null,[]);var r=t.length,i=new Array(t.length),o=null;t.forEach((function(t,a){e(t,(function(t,e){t&&(o=t),i[a]=e,0==--r&&n(o,i)}))}))},t.bezier=c,t.bindAll=y,t.browser=B,t.cacheEntryPossiblyAdded=function(t){++pt>ct&&(t.getActor().send("enforceCacheSizeLimit",ut),pt=0)},t.clamp=h,t.clearTileCache=function(t){var e=s.caches.delete("mapbox-tiles");t&&e.catch(t).then((function(){return t()}))},t.clipLine=qu,t.clone=function(t){var e=new sa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=w,t.clone$2=function(t){var e=new sa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e},t.collisionCircleLayout=Ws,t.config=U,t.create=function(){var t=new sa(16);return sa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=function(){var t=new sa(9);return sa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t},t.create$2=function(){var t=new sa(4);return sa!=Float32Array&&(t[1]=0,t[2]=0),t[0]=1,t[3]=1,t},t.createCommonjsModule=e,t.createExpression=Xn,t.createLayout=Ci,t.createStyleLayer=function(t){return"custom"===t.type?new Cc(t):new kc[t.type](t)},t.cross=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=n[0],s=n[1],u=n[2];return t[0]=i*u-o*s,t[1]=o*a-r*u,t[2]=r*s-i*a,t},t.deepEqual=function t(e,n){if(Array.isArray(e)){if(!Array.isArray(n)||e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(!t(e[r],n[r]))return!1;return!0}if("object"==o(e)&&null!==e&&null!==n){if("object"!=o(n))return!1;if(Object.keys(e).length!==Object.keys(n).length)return!1;for(var i in e)if(!t(e[i],n[i]))return!1;return!0}return e===n},t.dot=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]},t.dot$1=function(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]+t[3]*e[3]},t.ease=l,t.emitValidationErrors=Lr,t.endsWith=_,t.enforceCacheSizeLimit=function(t){lt(),et&&et.then((function(e){e.keys().then((function(n){for(var r=0;r<n.length-t;r++)e.delete(n[r])}))}))},t.evaluateSizeForFeature=Fu,t.evaluateSizeForZoom=Bu,t.evaluateVariableOffset=ac,t.evented=ii,t.extend=p,t.featureFilter=sr,t.filterObject=b,t.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.getAnchorAlignment=Lu,t.getAnchorJustification=sc,t.getArrayBuffer=bt,t.getImage=St,t.getJSON=function(t,e){return xt(p(t,{type:"json"}),e)},t.getRTLTextPluginStatus=oi,t.getReferrer=_t,t.getVideo=function(t,e){var n,r,i=s.document.createElement("video");i.muted=!0,i.onloadstart=function(){e(null,i)};for(var o=0;o<t.length;o++){var a=s.document.createElement("source");n=t[o],r=void 0,(r=s.document.createElement("a")).href=n,(r.protocol!==s.document.location.protocol||r.host!==s.document.location.host)&&(i.crossOrigin="Anonymous"),a.src=t[o],i.appendChild(a)}return{cancel:function(){}}},t.identity=ua,t.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],a=e[4],s=e[5],u=e[6],c=e[7],l=e[8],h=e[9],f=e[10],p=e[11],d=e[12],v=e[13],m=e[14],g=e[15],y=n*s-r*a,_=n*u-i*a,x=n*c-o*a,b=r*u-i*s,w=r*c-o*s,E=i*c-o*u,S=l*v-h*d,A=l*m-f*d,T=l*g-p*d,C=h*m-f*v,k=h*g-p*v,M=f*g-p*m,P=y*M-_*k+x*C+b*T-w*A+E*S;return P?(t[0]=(s*M-u*k+c*C)*(P=1/P),t[1]=(i*k-r*M-o*C)*P,t[2]=(v*E-m*w+g*b)*P,t[3]=(f*w-h*E-p*b)*P,t[4]=(u*T-a*M-c*A)*P,t[5]=(n*M-i*T+o*A)*P,t[6]=(m*x-d*E-g*_)*P,t[7]=(l*E-f*x+p*_)*P,t[8]=(a*k-s*T+c*S)*P,t[9]=(r*T-n*k-o*S)*P,t[10]=(d*w-v*x+g*y)*P,t[11]=(h*x-l*w-p*y)*P,t[12]=(s*A-a*C-u*S)*P,t[13]=(n*C-r*A+i*S)*P,t[14]=(v*_-d*b-m*y)*P,t[15]=(l*b-h*_+f*y)*P,t):null},t.isChar=Wr,t.isMapboxURL=q,t.keysDifference=function(t,e){var n=[];for(var r in t)r in e||n.push(r);return n},t.makeRequest=xt,t.mapObject=x,t.mercatorXfromLng=Zc,t.mercatorYfromLat=Vc,t.mercatorZfromAltitude=Gc,t.mul=ha,t.multiply=ca,t.mvt=bs,t.nextPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))},t.normalize=function(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t},t.number=He,t.offscreenCanvasSupported=dt,t.ortho=function(t,e,n,r,i,o,a){var s=1/(e-n),u=1/(r-i),c=1/(o-a);return t[0]=-2*s,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*u,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*c,t[11]=0,t[12]=(e+n)*s,t[13]=(i+r)*u,t[14]=(a+o)*c,t[15]=1,t},t.parseGlyphPBF=function(t){return new Qs(t).readFields(vu,[])},t.pbf=Qs,t.performSymbolLayout=function(t,e,n,r,i,o,a){t.createArrays(),t.tilePixelRatio=8192/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;var s=t.layers[0].layout,u=t.layers[0]._unevaluatedLayout._values,c={};if("composite"===t.textSizeData.kind){var l=t.textSizeData,h=l.maxZoom;c.compositeTextSizes=[u["text-size"].possiblyEvaluate(new ui(l.minZoom),a),u["text-size"].possiblyEvaluate(new ui(h),a)]}if("composite"===t.iconSizeData.kind){var f=t.iconSizeData,p=f.maxZoom;c.compositeIconSizes=[u["icon-size"].possiblyEvaluate(new ui(f.minZoom),a),u["icon-size"].possiblyEvaluate(new ui(p),a)]}c.layoutTextSize=u["text-size"].possiblyEvaluate(new ui(t.zoom+1),a),c.layoutIconSize=u["icon-size"].possiblyEvaluate(new ui(t.zoom+1),a),c.textMaxSize=u["text-size"].possiblyEvaluate(new ui(18));for(var d=24*s.get("text-line-height"),v="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement"),m=s.get("text-keep-upright"),g=s.get("text-size"),y=function(){var o=x[_],u=s.get("text-font").evaluate(o,{},a).join(","),l=g.evaluate(o,{},a),h=c.layoutTextSize.evaluate(o,{},a),f=c.layoutIconSize.evaluate(o,{},a),p={horizontal:{},vertical:void 0},y=o.text,b=[0,0];if(y){var w=y.toString(),E=24*s.get("text-letter-spacing").evaluate(o,{},a),A=function(t){for(var e=0,n=t;e<n.length;e+=1)if(r=n[e].charCodeAt(0),Wr.Arabic(r)||Wr["Arabic Supplement"](r)||Wr["Arabic Extended-A"](r)||Wr["Arabic Presentation Forms-A"](r)||Wr["Arabic Presentation Forms-B"](r))return!1;var r;return!0}(w)?E:0,T=s.get("text-anchor").evaluate(o,{},a),C=s.get("text-variable-anchor");if(!C){var k=s.get("text-radial-offset").evaluate(o,{},a);b=k?ac(T,[24*k,oc]):s.get("text-offset").evaluate(o,{},a).map((function(t){return 24*t}))}var M=v?"center":s.get("text-justify").evaluate(o,{},a),P=s.get("symbol-placement"),I="point"===P?24*s.get("text-max-width").evaluate(o,{},a):0,R=function(){t.allowVerticalPlacement&&qr(w)&&(p.vertical=Au(y,e,n,i,u,I,d,T,"left",A,b,wu.vertical,!0,P,h,l))};if(!v&&C){for(var L="auto"===M?C.map((function(t){return sc(t)})):[M],O=!1,D=0;D<L.length;D++){var N=L[D];if(!p.horizontal[N])if(O)p.horizontal[N]=p.horizontal[0];else{var z=Au(y,e,n,i,u,I,d,"center",N,A,b,wu.horizontal,!1,P,h,l);z&&(p.horizontal[N]=z,O=1===z.positionedLines.length)}}R()}else{"auto"===M&&(M=sc(T));var F=Au(y,e,n,i,u,I,d,T,M,A,b,wu.horizontal,!1,P,h,l);F&&(p.horizontal[M]=F),R(),qr(w)&&v&&m&&(p.vertical=Au(y,e,n,i,u,I,d,T,M,A,b,wu.vertical,!1,P,h,l))}}var B=void 0,U=!1;if(o.icon&&o.icon.name){var j=r[o.icon.name];j&&(B=function(t,e,n){var r=Lu(n),i=e[0]-t.displaySize[0]*r.horizontalAlign,o=e[1]-t.displaySize[1]*r.verticalAlign;return{image:t,top:o,bottom:o+t.displaySize[1],left:i,right:i+t.displaySize[0]}}(i[o.icon.name],s.get("icon-offset").evaluate(o,{},a),s.get("icon-anchor").evaluate(o,{},a)),U=j.sdf,void 0===t.sdfIcons?t.sdfIcons=j.sdf:t.sdfIcons!==j.sdf&&S("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(j.pixelRatio!==t.pixelRatio||0!==s.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}var Z=cc(p.horizontal)||p.vertical;t.iconsInText=!!Z&&Z.iconsInText,(Z||B)&&function(t,e,n,r,i,o,a,s,u,c,l){var h=o.textMaxSize.evaluate(e,{});void 0===h&&(h=a);var f,p=t.layers[0].layout,d=p.get("icon-offset").evaluate(e,{},l),v=cc(n.horizontal),m=a/24,g=t.tilePixelRatio*m,y=t.tilePixelRatio*h/24,_=t.tilePixelRatio*s,x=t.tilePixelRatio*p.get("symbol-spacing"),b=p.get("text-padding")*t.tilePixelRatio,w=p.get("icon-padding")*t.tilePixelRatio,E=p.get("text-max-angle")/180*Math.PI,A="map"===p.get("text-rotation-alignment")&&"point"!==p.get("symbol-placement"),T="map"===p.get("icon-rotation-alignment")&&"point"!==p.get("symbol-placement"),C=p.get("symbol-placement"),k=x/2,M=p.get("icon-text-fit");r&&"none"!==M&&(t.allowVerticalPlacement&&n.vertical&&(f=Du(r,n.vertical,M,p.get("icon-text-fit-padding"),d,m)),v&&(r=Du(r,v,M,p.get("icon-text-fit-padding"),d,m)));var P=function(s,h){h.x<0||h.x>=8192||h.y<0||h.y>=8192||function(t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v,m,g,y,_,x,b,w,E,A){var T,C,k,M,P,I=t.addToLineVertexArray(e,n),R=0,L=0,O=0,D=0,N=-1,z=-1,F={},B=po(""),U=0,j=0;if(void 0===s._unevaluatedLayout.getValue("text-radial-offset")?(U=(T=s.layout.get("text-offset").evaluate(x,{},E).map((function(t){return 24*t})))[0],j=T[1]):(U=24*s.layout.get("text-radial-offset").evaluate(x,{},E),j=oc),t.allowVerticalPlacement&&r.vertical){var Z=s.layout.get("text-rotate").evaluate(x,{},E)+90;M=new $u(u,e,c,l,h,r.vertical,f,p,d,Z),a&&(P=new $u(u,e,c,l,h,a,m,g,d,Z))}if(i){var V=s.layout.get("icon-rotate").evaluate(x,{}),G="none"!==s.layout.get("icon-text-fit"),H=Xu(i,V,w,G),W=a?Xu(a,V,w,G):void 0;k=new $u(u,e,c,l,h,i,m,g,!1,V),R=4*H.length;var q=t.iconSizeData,X=null;"source"===q.kind?(X=[128*s.layout.get("icon-size").evaluate(x,{})])[0]>32640&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):"composite"===q.kind&&((X=[128*b.compositeIconSizes[0].evaluate(x,{},E),128*b.compositeIconSizes[1].evaluate(x,{},E)])[0]>32640||X[1]>32640)&&S(t.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),t.addSymbols(t.icon,H,X,_,y,x,!1,e,I.lineStartIndex,I.lineLength,-1,E),N=t.icon.placedSymbolArray.length-1,W&&(L=4*W.length,t.addSymbols(t.icon,W,X,_,y,x,wu.vertical,e,I.lineStartIndex,I.lineLength,-1,E),z=t.icon.placedSymbolArray.length-1)}for(var Y in r.horizontal){var K=r.horizontal[Y];if(!C){B=po(K.text);var Q=s.layout.get("text-rotate").evaluate(x,{},E);C=new $u(u,e,c,l,h,K,f,p,d,Q)}var J=1===K.positionedLines.length;if(O+=uc(t,e,K,o,s,d,x,v,I,r.vertical?wu.horizontal:wu.horizontalOnly,J?Object.keys(r.horizontal):[Y],F,N,b,E),J)break}r.vertical&&(D+=uc(t,e,r.vertical,o,s,d,x,v,I,wu.vertical,["vertical"],F,z,b,E));var $=C?C.boxStartIndex:t.collisionBoxArray.length,tt=C?C.boxEndIndex:t.collisionBoxArray.length,et=M?M.boxStartIndex:t.collisionBoxArray.length,nt=M?M.boxEndIndex:t.collisionBoxArray.length,rt=k?k.boxStartIndex:t.collisionBoxArray.length,it=k?k.boxEndIndex:t.collisionBoxArray.length,ot=P?P.boxStartIndex:t.collisionBoxArray.length,at=P?P.boxEndIndex:t.collisionBoxArray.length,st=-1,ut=function(t,e){return t&&t.circleDiameter?Math.max(t.circleDiameter,e):e};st=ut(C,st),st=ut(M,st),st=ut(k,st);var ct=(st=ut(P,st))>-1?1:0;ct&&(st*=A/24),t.glyphOffsetArray.length>=yc.MAX_GLYPHS&&S("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,x.sortKey),t.symbolInstances.emplaceBack(e.x,e.y,F.right>=0?F.right:-1,F.center>=0?F.center:-1,F.left>=0?F.left:-1,F.vertical||-1,N,z,B,$,tt,et,nt,rt,it,ot,at,c,O,D,R,L,ct,0,f,U,j,st)}(t,h,s,n,r,i,f,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,g,b,A,u,_,w,T,d,e,o,c,l,a)};if("line"===C)for(var I=0,R=qu(e.geometry,0,0,8192,8192);I<R.length;I+=1)for(var L=R[I],O=0,D=Wu(L,x,E,n.vertical||v,r,24,y,t.overscaling,8192);O<D.length;O+=1){var N=D[O];v&&lc(t,v.text,k,N)||P(L,N)}else if("line-center"===C)for(var z=0,F=e.geometry;z<F.length;z+=1){var B=F[z];if(B.length>1){var U=Hu(B,E,n.vertical||v,r,24,y);U&&P(B,U)}}else if("Polygon"===e.type)for(var j=0,Z=is(e.geometry,0);j<Z.length;j+=1){var V=Z[j],G=nc(V,16);P(V[0],new Nu(G.x,G.y,0))}else if("LineString"===e.type)for(var H=0,W=e.geometry;H<W.length;H+=1){var q=W[H];P(q,new Nu(q[0].x,q[0].y,0))}else if("Point"===e.type)for(var X=0,Y=e.geometry;X<Y.length;X+=1)for(var K=0,Q=Y[X];K<Q.length;K+=1){var J=Q[K];P([J],new Nu(J.x,J.y,0))}}(t,o,p,B,r,c,h,f,b,U,a)},_=0,x=t.features;_<x.length;_+=1)y();o&&t.generateCollisionDebugBuffers()},t.perspective=function(t,e,n,r,i){var o,a=1/Math.tan(e/2);return t[0]=a/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=a,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+r)*(o=1/(r-i)),t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t},t.pick=function(t,e){for(var n={},r=0;r<e.length;r++){var i=e[r];i in t&&(n[i]=t[i])}return n},t.plugin=si,t.polygonIntersectsPolygon=Ho,t.postMapLoadEvent=st,t.postTurnstileEvent=ot,t.potpack=yu,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.register=Br,t.registerForPluginStateChange=function(t){return t({pluginStatus:ti,pluginURL:ei}),ii.on("pluginStateChange",t),t},t.renderColorRamp=wa,t.rotate=function(t,e,n){var r=e[0],i=e[1],o=e[2],a=e[3],s=Math.sin(n),u=Math.cos(n);return t[0]=r*u+o*s,t[1]=i*u+a*s,t[2]=r*-s+o*u,t[3]=i*-s+a*u,t},t.rotateX=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],a=e[5],s=e[6],u=e[7],c=e[8],l=e[9],h=e[10],f=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+c*r,t[5]=a*i+l*r,t[6]=s*i+h*r,t[7]=u*i+f*r,t[8]=c*i-o*r,t[9]=l*i-a*r,t[10]=h*i-s*r,t[11]=f*i-u*r,t},t.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],a=e[1],s=e[2],u=e[3],c=e[4],l=e[5],h=e[6],f=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+c*r,t[1]=a*i+l*r,t[2]=s*i+h*r,t[3]=u*i+f*r,t[4]=c*i-o*r,t[5]=l*i-a*r,t[6]=h*i-s*r,t[7]=f*i-u*r,t},t.scale=function(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t},t.scale$1=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.scale$2=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t},t.setCacheLimits=function(t,e){ut=t,ct=e},t.setRTLTextPlugin=function(t,e,n){if(void 0===n&&(n=!1),"deferred"===ti||"loading"===ti||"loaded"===ti)throw new Error("setRTLTextPlugin cannot be called multiple times.");ei=B.resolveURL(t),ti="deferred",$r=e,ri(),n||ai()},t.sphericalToCartesian=function(t){var e=t[0],n=t[1],r=t[2];return n+=90,n*=Math.PI/180,r*=Math.PI/180,{x:e*Math.cos(n)*Math.sin(r),y:e*Math.sin(n)*Math.sin(r),z:e*Math.cos(r)}},t.sqrLen=function(t){var e=t[0],n=t[1];return e*e+n*n},t.styleSpec=Pt,t.sub=function(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t},t.symbolSize=Uu,t.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},t.transformMat4=fa,t.translate=function(t,e,n){var r,i,o,a,s,u,c,l,h,f,p,d,v=n[0],m=n[1],g=n[2];return e===t?(t[12]=e[0]*v+e[4]*m+e[8]*g+e[12],t[13]=e[1]*v+e[5]*m+e[9]*g+e[13],t[14]=e[2]*v+e[6]*m+e[10]*g+e[14],t[15]=e[3]*v+e[7]*m+e[11]*g+e[15]):(i=e[1],o=e[2],a=e[3],s=e[4],u=e[5],c=e[6],l=e[7],h=e[8],f=e[9],p=e[10],d=e[11],t[0]=r=e[0],t[1]=i,t[2]=o,t[3]=a,t[4]=s,t[5]=u,t[6]=c,t[7]=l,t[8]=h,t[9]=f,t[10]=p,t[11]=d,t[12]=r*v+s*m+h*g+e[12],t[13]=i*v+u*m+f*g+e[13],t[14]=o*v+c*m+p*g+e[14],t[15]=a*v+l*m+d*g+e[15]),t},t.triggerPluginCompletionEvent=ni,t.uniqueId=v,t.validateCustomStyleLayer=function(t){var e=[],n=t.id;return void 0===n&&e.push({message:"layers."+n+': missing required property "id"'}),void 0===t.render&&e.push({message:"layers."+n+': missing required method "render"'}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:"layers."+n+': property "renderingMode" must be either "2d" or "3d"'}),e},t.validateLight=Pr,t.validateStyle=Mr,t.values=function(t){var e=[];for(var n in t)e.push(t[n]);return e},t.vectorTile=bs,t.version="1.13.3",t.warnOnce=S,t.webpSupported=j,t.window=s,t.wrap=f})),r(["./shared"],(function(t){function e(t){var n=o(t);if("number"===n||"boolean"===n||"string"===n||null==t)return JSON.stringify(t);if(Array.isArray(t)){for(var r="[",i=0,a=t;i<a.length;i+=1)r+=e(a[i])+",";return r+"]"}for(var s=Object.keys(t).sort(),u="{",c=0;c<s.length;c++)u+=JSON.stringify(s[c])+":"+e(t[s[c]])+",";return u+"}"}function n(n){for(var r="",i=0,o=t.refProperties;i<o.length;i+=1)r+="/"+e(n[o[i]]);return r}var r=function(t){this.keyCache={},t&&this.replace(t)};r.prototype.replace=function(t){this._layerConfigs={},this._layers={},this.update(t,[])},r.prototype.update=function(e,r){for(var i=this,o=0,a=e;o<a.length;o+=1){var s=a[o];this._layerConfigs[s.id]=s;var u=this._layers[s.id]=t.createStyleLayer(s);u._featureFilter=t.featureFilter(u.filter),this.keyCache[s.id]&&delete this.keyCache[s.id]}for(var c=0,l=r;c<l.length;c+=1){var h=l[c];delete this.keyCache[h],delete this._layerConfigs[h],delete this._layers[h]}this.familiesBySource={};for(var f=0,p=function(t,e){for(var r={},i=0;i<t.length;i++){var o=e&&e[t[i].id]||n(t[i]);e&&(e[t[i].id]=o);var a=r[o];a||(a=r[o]=[]),a.push(t[i])}var s=[];for(var u in r)s.push(r[u]);return s}(t.values(this._layerConfigs),this.keyCache);f<p.length;f+=1){var d=p[f].map((function(t){return i._layers[t.id]})),v=d[0];if("none"!==v.visibility){var m=v.source||"",g=this.familiesBySource[m];g||(g=this.familiesBySource[m]={});var y=v.sourceLayer||"_geojsonTileLayer",_=g[y];_||(_=g[y]=[]),_.push(d)}}};var i=function(e){var n={},r=[];for(var i in e){var o=e[i],a=n[i]={};for(var s in o){var u=o[+s];if(u&&0!==u.bitmap.width&&0!==u.bitmap.height){var c={x:0,y:0,w:u.bitmap.width+2,h:u.bitmap.height+2};r.push(c),a[s]={rect:c,metrics:u.metrics}}}}var l=t.potpack(r),h=new t.AlphaImage({width:l.w||1,height:l.h||1});for(var f in e){var p=e[f];for(var d in p){var v=p[+d];if(v&&0!==v.bitmap.width&&0!==v.bitmap.height){var m=n[f][d].rect;t.AlphaImage.copy(v.bitmap,h,{x:0,y:0},{x:m.x+1,y:m.y+1},v.bitmap)}}}this.image=h,this.positions=n};t.register("GlyphAtlas",i);var a=function(e){this.tileID=new t.OverscaledTileID(e.tileID.overscaledZ,e.tileID.wrap,e.tileID.canonical.z,e.tileID.canonical.x,e.tileID.canonical.y),this.uid=e.uid,this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.tileSize=e.tileSize,this.source=e.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=e.showCollisionBoxes,this.collectResourceTiming=!!e.collectResourceTiming,this.returnDependencies=!!e.returnDependencies,this.promoteId=e.promoteId};function s(e,n,r){for(var i=new t.EvaluationParameters(n),o=0,a=e;o<a.length;o+=1)a[o].recalculate(i,r)}function u(e,n){var r=t.getArrayBuffer(e.request,(function(e,r,i,o){e?n(e):r&&n(null,{vectorTile:new t.vectorTile.VectorTile(new t.pbf(r)),rawData:r,cacheControl:i,expires:o})}));return function(){r.cancel(),n()}}a.prototype.parse=function(e,n,r,o,a){var u=this;this.status="parsing",this.data=e,this.collisionBoxArray=new t.CollisionBoxArray;var c=new t.DictionaryCoder(Object.keys(e.layers).sort()),l=new t.FeatureIndex(this.tileID,this.promoteId);l.bucketLayerIDs=[];var h,f,p,d,v={},m={featureIndex:l,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:r},g=n.familiesBySource[this.source];for(var y in g){var _=e.layers[y];if(_){1===_.version&&t.warnOnce('Vector tile source "'+this.source+'" layer "'+y+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var x=c.encode(y),b=[],w=0;w<_.length;w++){var E=_.feature(w),S=l.getId(E,y);b.push({feature:E,id:S,index:w,sourceLayerIndex:x})}for(var A=0,T=g[y];A<T.length;A+=1){var C=T[A],k=C[0];k.minzoom&&this.zoom<Math.floor(k.minzoom)||k.maxzoom&&this.zoom>=k.maxzoom||"none"!==k.visibility&&(s(C,this.zoom,r),(v[k.id]=k.createBucket({index:l.bucketLayerIDs.length,layers:C,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:x,sourceID:this.source})).populate(b,m,this.tileID.canonical),l.bucketLayerIDs.push(C.map((function(t){return t.id}))))}}}var M=t.mapObject(m.glyphDependencies,(function(t){return Object.keys(t).map(Number)}));Object.keys(M).length?o.send("getGlyphs",{uid:this.uid,stacks:M},(function(t,e){h||(h=t,f=e,R.call(u))})):f={};var P=Object.keys(m.iconDependencies);P.length?o.send("getImages",{icons:P,source:this.source,tileID:this.tileID,type:"icons"},(function(t,e){h||(h=t,p=e,R.call(u))})):p={};var I=Object.keys(m.patternDependencies);function R(){if(h)return a(h);if(f&&p&&d){var e=new i(f),n=new t.ImageAtlas(p,d);for(var o in v){var u=v[o];u instanceof t.SymbolBucket?(s(u.layers,this.zoom,r),t.performSymbolLayout(u,f,e.positions,p,n.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):u.hasPattern&&(u instanceof t.LineBucket||u instanceof t.FillBucket||u instanceof t.FillExtrusionBucket)&&(s(u.layers,this.zoom,r),u.addFeatures(m,this.tileID.canonical,n.patternPositions))}this.status="done",a(null,{buckets:t.values(v).filter((function(t){return!t.isEmpty()})),featureIndex:l,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:e.image,imageAtlas:n,glyphMap:this.returnDependencies?f:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?e.positions:null})}}I.length?o.send("getImages",{icons:I,source:this.source,tileID:this.tileID,type:"patterns"},(function(t,e){h||(h=t,d=e,R.call(u))})):d={},R.call(this)};var c=function(t,e,n,r){this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=r||u,this.loading={},this.loaded={}};c.prototype.loadTile=function(e,n){var r=this,i=e.uid;this.loading||(this.loading={});var o=!!(e&&e.request&&e.request.collectResourceTiming)&&new t.RequestPerformance(e.request),s=this.loading[i]=new a(e);s.abort=this.loadVectorData(e,(function(e,a){if(delete r.loading[i],e||!a)return s.status="done",r.loaded[i]=s,n(e);var u=a.rawData,c={};a.expires&&(c.expires=a.expires),a.cacheControl&&(c.cacheControl=a.cacheControl);var l={};if(o){var h=o.finish();h&&(l.resourceTiming=JSON.parse(JSON.stringify(h)))}s.vectorTile=a.vectorTile,s.parse(a.vectorTile,r.layerIndex,r.availableImages,r.actor,(function(e,r){if(e||!r)return n(e);n(null,t.extend({rawTileData:u.slice(0)},r,c,l))})),r.loaded=r.loaded||{},r.loaded[i]=s}))},c.prototype.reloadTile=function(t,e){var n=this,r=this.loaded,i=t.uid,o=this;if(r&&r[i]){var a=r[i];a.showCollisionBoxes=t.showCollisionBoxes;var s=function(t,r){var i=a.reloadCallback;i&&(delete a.reloadCallback,a.parse(a.vectorTile,o.layerIndex,n.availableImages,o.actor,i)),e(t,r)};"parsing"===a.status?a.reloadCallback=s:"done"===a.status&&(a.vectorTile?a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}},c.prototype.abortTile=function(t,e){var n=this.loading,r=t.uid;n&&n[r]&&n[r].abort&&(n[r].abort(),delete n[r]),e()},c.prototype.removeTile=function(t,e){var n=this.loaded,r=t.uid;n&&n[r]&&delete n[r],e()};var l=t.window.ImageBitmap,h=function(){this.loaded={}};function f(t,e){if(0!==t.length){p(t[0],e);for(var n=1;n<t.length;n++)p(t[n],!e)}}function p(t,e){for(var n=0,r=0,i=0,o=t.length,a=o-1;i<o;a=i++){var s=(t[i][0]-t[a][0])*(t[a][1]+t[i][1]),u=n+s;r+=Math.abs(n)>=Math.abs(s)?n-u+s:s-u+n,n=u}n+r>=0!=!!e&&t.reverse()}h.prototype.loadTile=function(e,n){var r=e.uid,i=e.encoding,o=e.rawImageData,a=l&&o instanceof l?this.getImageData(o):o,s=new t.DEMData(r,a,i);this.loaded=this.loaded||{},this.loaded[r]=s,n(null,s)},h.prototype.getImageData=function(e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);var n=this.offscreenCanvasContext.getImageData(-1,-1,e.width+2,e.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new t.RGBAImage({width:n.width,height:n.height},n.data)},h.prototype.removeTile=function(t){var e=this.loaded,n=t.uid;e&&e[n]&&delete e[n]};var d=t.vectorTile.VectorTileFeature.prototype.toGeoJSON,v=function(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))};v.prototype.loadGeometry=function(){if(1===this._feature.type){for(var e=[],n=0,r=this._feature.geometry;n<r.length;n+=1){var i=r[n];e.push([new t.Point$1(i[0],i[1])])}return e}for(var o=[],a=0,s=this._feature.geometry;a<s.length;a+=1){for(var u=[],c=0,l=s[a];c<l.length;c+=1){var h=l[c];u.push(new t.Point$1(h[0],h[1]))}o.push(u)}return o},v.prototype.toGeoJSON=function(t,e,n){return d.call(this,t,e,n)};var m=function(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e};m.prototype.feature=function(t){return new v(this._features[t])};var g=t.vectorTile.VectorTileFeature,y=_;function _(t,e){this.options=e||{},this.features=t,this.length=t.length}function x(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}_.prototype.feature=function(t){return new x(this.features[t],this.options.extent)},x.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<r.length;o++)i.push(new t.Point$1(r[o][0],r[o][1]));this.geometry.push(i)}return this.geometry},x.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<t.length;o++)for(var a=t[o],s=0;s<a.length;s++){var u=a[s];e=Math.min(e,u.x),n=Math.max(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.y)}return[e,r,n,i]},x.prototype.toGeoJSON=g.prototype.toGeoJSON;var b=E,w=y;function E(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,S,t.layers[n])}(e,n),n.finish()}function S(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)r.feature=t.feature(n),e.writeMessage(2,A,r);var i=r.keys;for(n=0;n<i.length;n++)e.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)e.writeMessage(4,P,o[n])}function A(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,T,t),e.writeVarintField(3,n.type),e.writeMessage(4,M,n)}function T(t,e){var n=t.feature,r=t.keys,i=t.values,a=t.keycache,s=t.valuecache;for(var u in n.properties){var c=a[u];void 0===c&&(r.push(u),a[u]=c=r.length-1),e.writeVarint(c);var l=n.properties[u],h=o(l);"string"!==h&&"boolean"!==h&&"number"!==h&&(l=JSON.stringify(l));var f=h+":"+l,p=s[f];void 0===p&&(i.push(l),s[f]=p=i.length-1),e.writeVarint(p)}}function C(t,e){return(e<<3)+(7&t)}function k(t){return t<<1^t>>31}function M(t,e){for(var n=t.loadGeometry(),r=t.type,i=0,o=0,a=n.length,s=0;s<a;s++){var u=n[s],c=1;1===r&&(c=u.length),e.writeVarint(C(1,c));for(var l=3===r?u.length-1:u.length,h=0;h<l;h++){1===h&&1!==r&&e.writeVarint(C(2,l-1));var f=u[h].x-i,p=u[h].y-o;e.writeVarint(k(f)),e.writeVarint(k(p)),i+=f,o+=p}3===r&&e.writeVarint(C(7,1))}}function P(t,e){var n=o(t);"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function I(t,e,n,r){R(t,n,r),R(e,2*n,2*r),R(e,2*n+1,2*r+1)}function R(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function L(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}b.fromVectorTileJs=E,b.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var r in t)n[r]=new y(t[r].features,e),n[r].name=r,n[r].version=e.version,n[r].extent=e.extent;return E({layers:n})},b.GeoJSONWrapper=w;var O=function(t){return t[0]},D=function(t){return t[1]},N=function(t,e,n,r,i){void 0===e&&(e=O),void 0===n&&(n=D),void 0===r&&(r=64),void 0===i&&(i=Float64Array),this.nodeSize=r,this.points=t;for(var o=t.length<65536?Uint16Array:Uint32Array,a=this.ids=new o(t.length),s=this.coords=new i(2*t.length),u=0;u<t.length;u++)a[u]=u,s[2*u]=e(t[u]),s[2*u+1]=n(t[u]);!function t(e,n,r,i,o,a){if(!(o-i<=r)){var s=i+o>>1;!function t(e,n,r,i,o,a){for(;o>i;){if(o-i>600){var s=o-i+1,u=r-i+1,c=Math.log(s),l=.5*Math.exp(2*c/3),h=.5*Math.sqrt(c*l*(s-l)/s)*(u-s/2<0?-1:1);t(e,n,r,Math.max(i,Math.floor(r-u*l/s+h)),Math.min(o,Math.floor(r+(s-u)*l/s+h)),a)}var f=n[2*r+a],p=i,d=o;for(I(e,n,i,r),n[2*o+a]>f&&I(e,n,i,o);p<d;){for(I(e,n,p,d),p++,d--;n[2*p+a]<f;)p++;for(;n[2*d+a]>f;)d--}n[2*i+a]===f?I(e,n,i,d):I(e,n,++d,o),d<=r&&(i=d+1),r<=d&&(o=d-1)}}(e,n,s,i,o,a%2),t(e,n,r,i,s-1,a+1),t(e,n,r,s+1,o,a+1)}}(a,s,r,0,a.length-1,0)};N.prototype.range=function(t,e,n,r){return function(t,e,n,r,i,o,a){for(var s,u,c=[0,t.length-1,0],l=[];c.length;){var h=c.pop(),f=c.pop(),p=c.pop();if(f-p<=a)for(var d=p;d<=f;d++)u=e[2*d+1],(s=e[2*d])>=n&&s<=i&&u>=r&&u<=o&&l.push(t[d]);else{var v=Math.floor((p+f)/2);u=e[2*v+1],(s=e[2*v])>=n&&s<=i&&u>=r&&u<=o&&l.push(t[v]);var m=(h+1)%2;(0===h?n<=s:r<=u)&&(c.push(p),c.push(v-1),c.push(m)),(0===h?i>=s:o>=u)&&(c.push(v+1),c.push(f),c.push(m))}}return l}(this.ids,this.coords,t,e,n,r,this.nodeSize)},N.prototype.within=function(t,e,n){return function(t,e,n,r,i,o){for(var a=[0,t.length-1,0],s=[],u=i*i;a.length;){var c=a.pop(),l=a.pop(),h=a.pop();if(l-h<=o)for(var f=h;f<=l;f++)L(e[2*f],e[2*f+1],n,r)<=u&&s.push(t[f]);else{var p=Math.floor((h+l)/2),d=e[2*p],v=e[2*p+1];L(d,v,n,r)<=u&&s.push(t[p]);var m=(c+1)%2;(0===c?n-i<=d:r-i<=v)&&(a.push(h),a.push(p-1),a.push(m)),(0===c?n+i>=d:r+i>=v)&&(a.push(p+1),a.push(l),a.push(m))}}return s}(this.ids,this.coords,t,e,n,this.nodeSize)};var z={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},F=function(t){this.options=H(Object.create(z),t),this.trees=new Array(this.options.maxZoom+1)};function B(t,e,n,r,i){return{x:t,y:e,zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function U(t,e){var n=t.geometry.coordinates,r=n[1];return{x:V(n[0]),y:G(r),zoom:1/0,index:e,parentId:-1}}function j(t){return{type:"Feature",id:t.id,properties:Z(t),geometry:{type:"Point",coordinates:[(r=t.x,360*(r-.5)),(e=t.y,n=(180-360*e)*Math.PI/180,360*Math.atan(Math.exp(n))/Math.PI-90)]}};var e,n,r}function Z(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return H(H({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function V(t){return t/360+.5}function G(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function H(t,e){for(var n in e)t[n]=e[n];return t}function W(t){return t.x}function q(t){return t.y}function X(t,e,n,r,i,o){var a=i-n,s=o-r;if(0!==a||0!==s){var u=((t-n)*a+(e-r)*s)/(a*a+s*s);u>1?(n=i,r=o):u>0&&(n+=a*u,r+=s*u)}return(a=t-n)*a+(s=e-r)*s}function Y(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)K(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)K(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)K(t,e[r][i])}(i),i}function K(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function Q(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,a=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),s=[],u=e.id;if(n.promoteId?u=e.properties[n.promoteId]:n.generateId&&(u=r||0),"Point"===o)J(i,s);else if("MultiPoint"===o)for(var c=0;c<i.length;c++)J(i[c],s);else if("LineString"===o)$(i,s,a,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(c=0;c<i.length;c++)$(i[c],s=[],a,!1),t.push(Y(u,"LineString",s,e.properties));return}tt(i,s,a,!1)}else if("Polygon"===o)tt(i,s,a,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(c=0;c<e.geometry.geometries.length;c++)Q(t,{id:u,geometry:e.geometry.geometries[c],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(c=0;c<i.length;c++){var l=[];tt(i[c],l,a,!0),s.push(l)}}t.push(Y(u,o,s,e.properties))}}function J(t,e){e.push(et(t[0])),e.push(nt(t[1])),e.push(0)}function $(t,e,n,r){for(var i,o,a=0,s=0;s<t.length;s++){var u=et(t[s][0]),c=nt(t[s][1]);e.push(u),e.push(c),e.push(0),s>0&&(a+=r?(i*c-u*o)/2:Math.sqrt(Math.pow(u-i,2)+Math.pow(c-o,2))),i=u,o=c}var l=e.length-3;e[2]=1,function t(e,n,r,i){for(var o,a=i,s=r-n>>1,u=r-n,c=e[n],l=e[n+1],h=e[r],f=e[r+1],p=n+3;p<r;p+=3){var d=X(e[p],e[p+1],c,l,h,f);if(d>a)o=p,a=d;else if(d===a){var v=Math.abs(p-s);v<u&&(o=p,u=v)}}a>i&&(o-n>3&&t(e,n,o,i),e[o+2]=a,r-o>3&&t(e,o,r,i))}(e,0,l,n),e[l+2]=1,e.size=Math.abs(a),e.start=0,e.end=e.size}function tt(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];$(t[i],o,n,r),e.push(o)}}function et(t){return t/360+.5}function nt(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function rt(t,e,n,r,i,o,a,s){if(r/=e,o>=(n/=e)&&a<r)return t;if(a<n||o>=r)return null;for(var u=[],c=0;c<t.length;c++){var l=t[c],h=l.geometry,f=l.type,p=0===i?l.minX:l.minY,d=0===i?l.maxX:l.maxY;if(p>=n&&d<r)u.push(l);else if(!(d<n||p>=r)){var v=[];if("Point"===f||"MultiPoint"===f)it(h,v,n,r,i);else if("LineString"===f)ot(h,v,n,r,i,!1,s.lineMetrics);else if("MultiLineString"===f)st(h,v,n,r,i,!1);else if("Polygon"===f)st(h,v,n,r,i,!0);else if("MultiPolygon"===f)for(var m=0;m<h.length;m++){var g=[];st(h[m],g,n,r,i,!0),g.length&&v.push(g)}if(v.length){if(s.lineMetrics&&"LineString"===f){for(m=0;m<v.length;m++)u.push(Y(l.id,f,v[m],l.tags));continue}"LineString"!==f&&"MultiLineString"!==f||(1===v.length?(f="LineString",v=v[0]):f="MultiLineString"),"Point"!==f&&"MultiPoint"!==f||(f=3===v.length?"Point":"MultiPoint"),u.push(Y(l.id,f,v,l.tags))}}}return u.length?u:null}function it(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var a=t[o+i];a>=n&&a<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function ot(t,e,n,r,i,o,a){for(var s,u,c=at(t),l=0===i?ct:lt,h=t.start,f=0;f<t.length-3;f+=3){var p=t[f],d=t[f+1],v=t[f+2],m=t[f+3],g=t[f+4],y=0===i?p:d,_=0===i?m:g,x=!1;a&&(s=Math.sqrt(Math.pow(p-m,2)+Math.pow(d-g,2))),y<n?_>n&&(u=l(c,p,d,m,g,n),a&&(c.start=h+s*u)):y>r?_<r&&(u=l(c,p,d,m,g,r),a&&(c.start=h+s*u)):ut(c,p,d,v),_<n&&y>=n&&(u=l(c,p,d,m,g,n),x=!0),_>r&&y<=r&&(u=l(c,p,d,m,g,r),x=!0),!o&&x&&(a&&(c.end=h+s*u),e.push(c),c=at(t)),a&&(h+=s)}var b=t.length-3;p=t[b],d=t[b+1],v=t[b+2],(y=0===i?p:d)>=n&&y<=r&&ut(c,p,d,v),b=c.length-3,o&&b>=3&&(c[b]!==c[0]||c[b+1]!==c[1])&&ut(c,c[0],c[1],c[2]),c.length&&e.push(c)}function at(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function st(t,e,n,r,i,o){for(var a=0;a<t.length;a++)ot(t[a],e,n,r,i,o,!1)}function ut(t,e,n,r){t.push(e),t.push(n),t.push(r)}function ct(t,e,n,r,i,o){var a=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*a),t.push(1),a}function lt(t,e,n,r,i,o){var a=(o-n)/(i-n);return t.push(e+(r-e)*a),t.push(o),t.push(1),a}function ht(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],a=o.type;if("Point"===a||"MultiPoint"===a||"LineString"===a)i=ft(o.geometry,e);else if("MultiLineString"===a||"Polygon"===a){i=[];for(var s=0;s<o.geometry.length;s++)i.push(ft(o.geometry[s],e))}else if("MultiPolygon"===a)for(i=[],s=0;s<o.geometry.length;s++){for(var u=[],c=0;c<o.geometry[s].length;c++)u.push(ft(o.geometry[s][c],e));i.push(u)}n.push(Y(o.id,a,i,o.tags))}return n}function ft(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function pt(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,a=t.x,s=t.y;for(n=0;n<t.features.length;n++){var u=t.features[n],c=u.geometry,l=u.type;if(u.geometry=[],1===l)for(r=0;r<c.length;r+=2)u.geometry.push(dt(c[r],c[r+1],e,o,a,s));else for(r=0;r<c.length;r++){var h=[];for(i=0;i<c[r].length;i+=2)h.push(dt(c[r][i],c[r][i+1],e,o,a,s));u.geometry.push(h)}}return t.transformed=!0,t}function dt(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function vt(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),a={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},s=0;s<t.length;s++){a.numFeatures++,mt(a,t[s],o,i);var u=t[s].minX,c=t[s].minY,l=t[s].maxX,h=t[s].maxY;u<a.minX&&(a.minX=u),c<a.minY&&(a.minY=c),l>a.maxX&&(a.maxX=l),h>a.maxY&&(a.maxY=h)}return a}function mt(t,e,n,r){var i=e.geometry,o=e.type,a=[];if("Point"===o||"MultiPoint"===o)for(var s=0;s<i.length;s+=3)a.push(i[s]),a.push(i[s+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)gt(a,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(s=0;s<i.length;s++)gt(a,i[s],t,n,"Polygon"===o,0===s);else if("MultiPolygon"===o)for(var u=0;u<i.length;u++){var c=i[u];for(s=0;s<c.length;s++)gt(a,c[s],t,n,!0,0===s)}if(a.length){var l=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in l={},e.tags)l[h]=e.tags[h];l.mapbox_clip_start=i.start/i.size,l.mapbox_clip_end=i.end/i.size}var f={geometry:a,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:l};null!==e.id&&(f.id=e.id),t.features.push(f)}}function gt(t,e,n,r,i,o){var a=r*r;if(r>0&&e.size<(i?a:r))n.numPoints+=e.length/3;else{for(var s=[],u=0;u<e.length;u+=3)(0===r||e[u+2]>a)&&(n.numSimplified++,s.push(e[u]),s.push(e[u+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var a=t[r],s=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=a,t[i-1-r]=s}}(s,o),t.push(s)}}function yt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)Q(n,t.features[r],e,r);else Q(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(this.stats={},this.total=0),(r=function(t,e){var n=e.buffer/e.extent,r=t,i=rt(t,1,-1-n,n,0,-1,2,e),o=rt(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=rt(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=ht(i,1).concat(r)),o&&(r=r.concat(ht(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),n&&r.length}function _t(t,e,n){return 32*((1<<t)*n+e)+t}function xt(t,e){var n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);var r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return e(null,null);var i=new m(r.features),o=b(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}F.prototype.load=function(t){var e=this.options,n=(e.log,e.minZoom),r=e.maxZoom,i=e.nodeSize;t.length;this.points=t;for(var o=[],a=0;a<t.length;a++)t[a].geometry&&o.push(U(t[a],a));this.trees[r+1]=new N(o,W,q,i,Float32Array);for(var s=r;s>=n;s--){Date.now();o=this._cluster(o,s),this.trees[s]=new N(o,W,q,i,Float32Array)}return this},F.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],c=[],l=0,h=u.range(V(n),G(o),V(i),G(r));l<h.length;l+=1){var f=u.points[h[l]];c.push(f.numPoints?j(f):this.points[f.index])}return c},F.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=[],u=0,c=i.within(o.x,o.y,a);u<c.length;u+=1){var l=i.points[c[u]];l.parentId===t&&s.push(l.numPoints?j(l):this.points[l.index])}if(0===s.length)throw new Error(r);return s},F.prototype.getLeaves=function(t,e,n){var r=[];return this._appendLeaves(r,t,e=e||10,n=n||0,0),r},F.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.radius/o.extent,s=(n-a)/i,u=(n+1+a)/i,c={features:[]};return this._addTileFeatures(r.range((e-a)/i,s,(e+1+a)/i,u),r.points,e,n,i,c),0===e&&this._addTileFeatures(r.range(1-a/i,s,1,u),r.points,i,n,i,c),e===i-1&&this._addTileFeatures(r.range(0,s,a/i,u),r.points,-1,n,i,c),c.features.length?c:null},F.prototype.getClusterExpansionZoom=function(t){for(var e=this._getOriginZoom(t)-1;e<=this.options.maxZoom;){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},F.prototype._appendLeaves=function(t,e,n,r,i){for(var o=0,a=this.getChildren(e);o<a.length;o+=1){var s=a[o],u=s.properties;if(u&&u.cluster?i+u.point_count<=r?i+=u.point_count:i=this._appendLeaves(t,u.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i},F.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=e[s[a]],c=u.numPoints,l={type:1,geometry:[[Math.round(this.options.extent*(u.x*i-n)),Math.round(this.options.extent*(u.y*i-r))]],tags:c?Z(u):this.points[u.index].properties},h=void 0;c?h=u.id:this.options.generateId?h=u.index:this.points[u.index].id&&(h=this.points[u.index].id),void 0!==h&&(l.id=h),o.features.push(l)}},F.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))},F.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.reduce,o=r.minPoints,a=r.radius/(r.extent*Math.pow(2,e)),s=0;s<t.length;s++){var u=t[s];if(!(u.zoom<=e)){u.zoom=e;for(var c=this.trees[e+1],l=c.within(u.x,u.y,a),h=u.numPoints||1,f=h,p=0,d=l;p<d.length;p+=1){var v=c.points[d[p]];v.zoom>e&&(f+=v.numPoints||1)}if(f>=o){for(var m=u.x*h,g=u.y*h,y=i&&h>1?this._map(u,!0):null,_=(s<<5)+(e+1)+this.points.length,x=0,b=l;x<b.length;x+=1){var w=c.points[b[x]];if(!(w.zoom<=e)){w.zoom=e;var E=w.numPoints||1;m+=w.x*E,g+=w.y*E,w.parentId=_,i&&(y||(y=this._map(u,!0)),i(y,this._map(w)))}}u.parentId=_,n.push(B(m/f,g/f,_,f,y))}else if(n.push(u),f>1)for(var S=0,A=l;S<A.length;S+=1){var T=c.points[A[S]];T.zoom<=e||(T.zoom=e,n.push(T))}}}return n},F.prototype._getOriginId=function(t){return t-this.points.length>>5},F.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},F.prototype._map=function(t,e){if(t.numPoints)return e?H({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?H({},r):r},yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(t,e,n,r,i,o,a){for(var s=[t,e,n,r],u=this.options,c=u.debug;s.length;){r=s.pop(),n=s.pop(),e=s.pop(),t=s.pop();var l=1<<e,h=_t(e,n,r),f=this.tiles[h];if(!f&&(f=this.tiles[h]=vt(t,e,n,r,u),this.tileCoords.push({z:e,x:n,y:r}),c)){var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(f.source=t,i){if(e===u.maxZoom||e===i)continue;var d=1<<i-e;if(n!==Math.floor(o/d)||r!==Math.floor(a/d))continue}else if(e===u.indexMaxZoom||f.numPoints<=u.indexMaxPoints)continue;if(f.source=null,0!==t.length){var v,m,g,y,_,x,b=.5*u.buffer/u.extent,w=.5-b,E=.5+b,S=1+b;v=m=g=y=null,_=rt(t,l,n-b,n+E,0,f.minX,f.maxX,u),x=rt(t,l,n+w,n+S,0,f.minX,f.maxX,u),t=null,_&&(v=rt(_,l,r-b,r+E,1,f.minY,f.maxY,u),m=rt(_,l,r+w,r+S,1,f.minY,f.maxY,u),_=null),x&&(g=rt(x,l,r-b,r+E,1,f.minY,f.maxY,u),y=rt(x,l,r+w,r+S,1,f.minY,f.maxY,u),x=null),s.push(v||[],e+1,2*n,2*r),s.push(m||[],e+1,2*n,2*r+1),s.push(g||[],e+1,2*n+1,2*r),s.push(y||[],e+1,2*n+1,2*r+1)}}},yt.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent;r.debug;if(t<0||t>24)return null;var o=1<<t,a=_t(t,e=(e%o+o)%o,n);if(this.tiles[a])return pt(this.tiles[a],i);for(var s,u=t,c=e,l=n;!s&&u>0;)u--,c=Math.floor(c/2),l=Math.floor(l/2),s=this.tiles[_t(u,c,l)];return s&&s.source?(this.splitTile(s.source,u,c,l,t,e,n),this.tiles[a]?pt(this.tiles[a],i):null):null};var bt=function(e){function n(t,n,r,i){e.call(this,t,n,r,xt),i&&(this.loadGeoJSON=i)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadData=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=e,this._pendingLoadDataParams=t,this._state&&"Idle"!==this._state?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},n.prototype._loadData=function(){var e=this;if(this._pendingCallback&&this._pendingLoadDataParams){var n=this._pendingCallback,r=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var i=!!(r&&r.request&&r.request.collectResourceTiming)&&new t.RequestPerformance(r.request);this.loadGeoJSON(r,(function(a,s){if(a||!s)return n(a);if("object"!=o(s))return n(new Error("Input data given to '"+r.source+"' is not a valid GeoJSON object."));!function t(e,n){var r,i=e&&e.type;if("FeatureCollection"===i)for(r=0;r<e.features.length;r++)t(e.features[r],n);else if("GeometryCollection"===i)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],n);else if("Feature"===i)t(e.geometry,n);else if("Polygon"===i)f(e.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<e.coordinates.length;r++)f(e.coordinates[r],n);return e}(s,!0);try{if(r.filter){var u=t.createExpression(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===u.result)throw new Error(u.value.map((function(t){return t.key+": "+t.message})).join(", "));var c=s.features.filter((function(t){return u.value.evaluate({zoom:0},t)}));s={type:"FeatureCollection",features:c}}e._geoJSONIndex=r.cluster?new F(function(e){var n=e.superclusterOptions,r=e.clusterProperties;if(!r||!n)return n;for(var i={},o={},a={accumulated:null,zoom:0},s={properties:null},u=Object.keys(r),c=0,l=u;c<l.length;c+=1){var h=l[c],f=r[h],p=f[0],d=t.createExpression(f[1]),v=t.createExpression("string"==typeof p?[p,["accumulated"],["get",h]]:p);i[h]=d.value,o[h]=v.value}return n.map=function(t){s.properties=t;for(var e={},n=0,r=u;n<r.length;n+=1){var o=r[n];e[o]=i[o].evaluate(a,s)}return e},n.reduce=function(t,e){s.properties=e;for(var n=0,r=u;n<r.length;n+=1){var i=r[n];a.accumulated=t[i],t[i]=o[i].evaluate(a,s)}},n}(r)).load(s.features):function(t,e){return new yt(t,e)}(s,r.geojsonVtOptions)}catch(a){return n(a)}e.loaded={};var l={};if(i){var h=i.finish();h&&(l.resourceTiming={},l.resourceTiming[r.source]=JSON.parse(JSON.stringify(h)))}n(null,l)}))}},n.prototype.coalesce=function(){"Coalescing"===this._state?this._state="Idle":"NeedsLoadData"===this._state&&(this._state="Coalescing",this._loadData())},n.prototype.reloadTile=function(t,n){var r=this.loaded;return r&&r[t.uid]?e.prototype.reloadTile.call(this,t,n):this.loadTile(t,n)},n.prototype.loadGeoJSON=function(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error("Input data given to '"+e.source+"' is not a valid GeoJSON object."))}}},n.prototype.removeSource=function(t,e){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),e()},n.prototype.getClusterExpansionZoom=function(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterChildren=function(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}},n.prototype.getClusterLeaves=function(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}},n}(c),wt=function(e){var n=this;this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:c,geojson:bt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function(t,e){if(n.workerSourceTypes[t])throw new Error('Worker source with name "'+t+'" already registered.');n.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=function(e){if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}};return wt.prototype.setReferrer=function(t,e){this.referrer=e},wt.prototype.setImages=function(t,e,n){for(var r in this.availableImages[t]=e,this.workerSources[t]){var i=this.workerSources[t][r];for(var o in i)i[o].availableImages=e}n()},wt.prototype.setLayers=function(t,e,n){this.getLayerIndex(t).replace(e),n()},wt.prototype.updateLayers=function(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()},wt.prototype.loadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).loadTile(e,n)},wt.prototype.loadDEMTile=function(t,e,n){this.getDEMWorkerSource(t,e.source).loadTile(e,n)},wt.prototype.reloadTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).reloadTile(e,n)},wt.prototype.abortTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)},wt.prototype.removeTile=function(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)},wt.prototype.removeDEMTile=function(t,e){this.getDEMWorkerSource(t,e.source).removeTile(e)},wt.prototype.removeSource=function(t,e,n){if(this.workerSources[t]&&this.workerSources[t][e.type]&&this.workerSources[t][e.type][e.source]){var r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,n):n()}},wt.prototype.loadWorkerSource=function(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}},wt.prototype.syncRTLPluginState=function(e,n,r){try{t.plugin.setState(n);var i=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=i){this.self.importScripts(i);var o=t.plugin.isParsed();r(o?void 0:new Error("RTL Text Plugin failed to import scripts from "+i),o)}}catch(t){r(t.toString())}},wt.prototype.getAvailableImages=function(t){var e=this.availableImages[t];return e||(e=[]),e},wt.prototype.getLayerIndex=function(t){var e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e},wt.prototype.getWorkerSource=function(t,e,n){var r=this;return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][n]||(this.workerSources[t][e][n]=new this.workerSourceTypes[e]({send:function(e,n,i){r.actor.send(e,n,i,t)}},this.getLayerIndex(t),this.getAvailableImages(t))),this.workerSources[t][e][n]},wt.prototype.getDEMWorkerSource=function(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new h),this.demWorkerSources[t][e]},wt.prototype.enforceCacheSizeLimit=function(e,n){t.enforceCacheSizeLimit(n)},"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new wt(self)),wt})),r(["./shared"],(function(t){var e=t.createCommonjsModule((function(t){function e(t){return!n(t)}function n(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()?(void 0===r[n=t&&t.failIfMajorPerformanceCaveat]&&(r[n]=function(t){var n=function(t){var n=document.createElement("canvas"),r=Object.create(e.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,n.probablySupportsContext?n.probablySupportsContext("webgl",r)||n.probablySupportsContext("experimental-webgl",r):n.supportsContext?n.supportsContext("webgl",r)||n.supportsContext("experimental-webgl",r):n.getContext("webgl",r)||n.getContext("experimental-webgl",r)}(t);if(!n)return!1;var r=n.createShader(n.VERTEX_SHADER);return!(!r||n.isContextLost())&&(n.shaderSource(r,"void main() {}"),n.compileShader(r),!0===n.getShaderParameter(r,n.COMPILE_STATUS))}(n)),r[n]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var n}t.exports?t.exports=e:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=e,window.mapboxgl.notSupportedReason=n);var r={};e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}})),n={create:function(e,n,r){var i=t.window.document.createElement(e);return void 0!==n&&(i.className=n),r&&r.appendChild(i),i},createNS:function(e,n){return t.window.document.createElementNS(e,n)}},r=t.window.document&&t.window.document.documentElement.style;function i(t){if(!r)return t[0];for(var e=0;e<t.length;e++)if(t[e]in r)return t[e];return t[0]}var a,s=i(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);n.disableDrag=function(){r&&s&&(a=r[s],r[s]="none")},n.enableDrag=function(){r&&s&&(r[s]=a)};var u=i(["transform","WebkitTransform"]);n.setTransform=function(t,e){t.style[u]=e};var c=!1;try{var l=Object.defineProperty({},"passive",{get:function(){c=!0}});t.window.addEventListener("test",l,l),t.window.removeEventListener("test",l,l)}catch(t){c=!1}n.addEventListener=function(t,e,n,r){void 0===r&&(r={}),t.addEventListener(e,n,"passive"in r&&c?r:r.capture)},n.removeEventListener=function(t,e,n,r){void 0===r&&(r={}),t.removeEventListener(e,n,"passive"in r&&c?r:r.capture)};var h=function e(n){n.preventDefault(),n.stopPropagation(),t.window.removeEventListener("click",e,!0)};function f(t){var e=t.userImage;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}n.suppressClick=function(){t.window.addEventListener("click",h,!0),t.window.setTimeout((function(){t.window.removeEventListener("click",h,!0)}),0)},n.mousePos=function(e,n){var r=e.getBoundingClientRect();return new t.Point(n.clientX-r.left-e.clientLeft,n.clientY-r.top-e.clientTop)},n.touchPos=function(e,n){for(var r=e.getBoundingClientRect(),i=[],o=0;o<n.length;o++)i.push(new t.Point(n[o].clientX-r.left-e.clientLeft,n[o].clientY-r.top-e.clientTop));return i},n.mouseButton=function(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button},n.remove=function(t){t.parentNode&&t.parentNode.removeChild(t)};var p=function(e){function n(){e.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.isLoaded=function(){return this.loaded},n.prototype.setLoaded=function(t){if(this.loaded!==t&&(this.loaded=t,t)){for(var e=0,n=this.requestors;e<n.length;e+=1){var r=n[e];this._notify(r.ids,r.callback)}this.requestors=[]}},n.prototype.getImage=function(t){return this.images[t]},n.prototype.addImage=function(t,e){this._validate(t,e)&&(this.images[t]=e)},n.prototype._validate=function(e,n){var r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchX" value'))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "stretchY" value'))),r=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error('Image "'+e+'" has invalid "content" value'))),r=!1),r},n.prototype._validateStretch=function(t,e){if(!t)return!0;for(var n=0,r=0,i=t;r<i.length;r+=1){var o=i[r];if(o[0]<n||o[1]<o[0]||e<o[1])return!1;n=o[1]}return!0},n.prototype._validateContent=function(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))},n.prototype.updateImage=function(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0},n.prototype.removeImage=function(t){var e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()},n.prototype.listImages=function(){return Object.keys(this.images)},n.prototype.getImages=function(t,e){var n=!0;if(!this.isLoaded())for(var r=0,i=t;r<i.length;r+=1)this.images[i[r]]||(n=!1);this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})},n.prototype._notify=function(e,n){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i];this.images[a]||this.fire(new t.Event("styleimagemissing",{id:a}));var s=this.images[a];s?r[a]={data:s.data.clone(),pixelRatio:s.pixelRatio,sdf:s.sdf,version:s.version,stretchX:s.stretchX,stretchY:s.stretchY,content:s.content,hasRenderCallback:Boolean(s.userImage&&s.userImage.render)}:t.warnOnce('Image "'+a+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}n(null,r)},n.prototype.getPixelSize=function(){var t=this.atlasImage;return{width:t.width,height:t.height}},n.prototype.getPattern=function(e){var n=this.patterns[e],r=this.getImage(e);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{var i={w:r.data.width+2,h:r.data.height+2,x:0,y:0},o=new t.ImagePosition(i,r);this.patterns[e]={bin:i,position:o}}return this._updatePatternAtlas(),this.patterns[e].position},n.prototype.bind=function(e){var n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)},n.prototype._updatePatternAtlas=function(){var e=[];for(var n in this.patterns)e.push(this.patterns[n].bin);var r=t.potpack(e),i=r.w,o=r.h,a=this.atlasImage;for(var s in a.resize({width:i||1,height:o||1}),this.patterns){var u=this.patterns[s].bin,c=u.x+1,l=u.y+1,h=this.images[s].data,f=h.width,p=h.height;t.RGBAImage.copy(h,a,{x:0,y:0},{x:c,y:l},{width:f,height:p}),t.RGBAImage.copy(h,a,{x:0,y:p-1},{x:c,y:l-1},{width:f,height:1}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:c,y:l+p},{width:f,height:1}),t.RGBAImage.copy(h,a,{x:f-1,y:0},{x:c-1,y:l},{width:1,height:p}),t.RGBAImage.copy(h,a,{x:0,y:0},{x:c+f,y:l},{width:1,height:p})}this.dirty=!0},n.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},n.prototype.dispatchRenderCallbacks=function(t){for(var e=0,n=t;e<n.length;e+=1){var r=n[e];if(!this.callbackDispatchedThisFrame[r]){this.callbackDispatchedThisFrame[r]=!0;var i=this.images[r];f(i)&&this.updateImage(r,i)}}},n}(t.Evented),d=g,v=g,m=1e20;function g(t,e,n,r,i,o){this.fontSize=t||24,this.buffer=void 0===e?3:e,this.cutoff=r||.25,this.fontFamily=i||"sans-serif",this.fontWeight=o||"normal",this.radius=n||8;var a=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=a,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.d=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Int16Array(a),this.middle=Math.round(a/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function y(t,e,n,r,i,o,a){for(var s=0;s<e;s++){for(var u=0;u<n;u++)r[u]=t[u*e+s];for(_(r,i,o,a,n),u=0;u<n;u++)t[u*e+s]=i[u]}for(u=0;u<n;u++){for(s=0;s<e;s++)r[s]=t[u*e+s];for(_(r,i,o,a,e),s=0;s<e;s++)t[u*e+s]=Math.sqrt(i[s])}}function _(t,e,n,r,i){n[0]=0,r[0]=-m,r[1]=+m;for(var o=1,a=0;o<i;o++){for(var s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);s<=r[a];)a--,s=(t[o]+o*o-(t[n[a]]+n[a]*n[a]))/(2*o-2*n[a]);n[++a]=o,r[a]=s,r[a+1]=+m}for(o=0,a=0;o<i;o++){for(;r[a+1]<o;)a++;e[o]=(o-n[a])*(o-n[a])+t[n[a]]}}g.prototype.draw=function(t){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(t,this.buffer,this.middle);for(var e=this.ctx.getImageData(0,0,this.size,this.size),n=new Uint8ClampedArray(this.size*this.size),r=0;r<this.size*this.size;r++){var i=e.data[4*r+3]/255;this.gridOuter[r]=1===i?0:0===i?m:Math.pow(Math.max(0,.5-i),2),this.gridInner[r]=1===i?m:0===i?0:Math.pow(Math.max(0,i-.5),2)}for(y(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),y(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),r=0;r<this.size*this.size;r++)n[r]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[r]-this.gridInner[r])/this.radius+this.cutoff))));return n},d.default=v;var x=function(t,e){this.requestManager=t,this.localIdeographFontFamily=e,this.entries={}};x.prototype.setURL=function(t){this.url=t},x.prototype.getGlyphs=function(e,n){var r=this,i=[];for(var o in e)for(var a=0,s=e[o];a<s.length;a+=1)i.push({stack:o,id:s[a]});t.asyncAll(i,(function(t,e){var n=t.stack,i=t.id,o=r.entries[n];o||(o=r.entries[n]={glyphs:{},requests:{},ranges:{}});var a=o.glyphs[i];if(void 0===a){if(a=r._tinySDF(o,n,i))return o.glyphs[i]=a,void e(null,{stack:n,id:i,glyph:a});var s=Math.floor(i/256);if(256*s>65535)e(new Error("glyphs > 65535 not supported"));else if(o.ranges[s])e(null,{stack:n,id:i,glyph:a});else{var u=o.requests[s];u||(u=o.requests[s]=[],x.loadGlyphRange(n,s,r.url,r.requestManager,(function(t,e){if(e){for(var n in e)r._doesCharSupportLocalGlyph(+n)||(o.glyphs[+n]=e[+n]);o.ranges[s]=!0}for(var i=0,a=u;i<a.length;i+=1)(0,a[i])(t,e);delete o.requests[s]}))),u.push((function(t,r){t?e(t):r&&e(null,{stack:n,id:i,glyph:r[i]||null})}))}}else e(null,{stack:n,id:i,glyph:a})}),(function(t,e){if(t)n(t);else if(e){for(var r={},i=0,o=e;i<o.length;i+=1){var a=o[i],s=a.stack,u=a.id,c=a.glyph;(r[s]||(r[s]={}))[u]=c&&{id:c.id,bitmap:c.bitmap.clone(),metrics:c.metrics}}n(null,r)}}))},x.prototype._doesCharSupportLocalGlyph=function(e){return!!this.localIdeographFontFamily&&(t.isChar["CJK Unified Ideographs"](e)||t.isChar["Hangul Syllables"](e)||t.isChar.Hiragana(e)||t.isChar.Katakana(e))},x.prototype._tinySDF=function(e,n,r){var i=this.localIdeographFontFamily;if(i&&this._doesCharSupportLocalGlyph(r)){var o=e.tinySDF;if(!o){var a="400";/bold/i.test(n)?a="900":/medium/i.test(n)?a="500":/light/i.test(n)&&(a="200"),o=e.tinySDF=new x.TinySDF(24,3,8,.25,i,a)}return{id:r,bitmap:new t.AlphaImage({width:30,height:30},o.draw(String.fromCharCode(r))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},x.loadGlyphRange=function(e,n,r,i,o){var a=256*n,s=a+255,u=i.transformRequest(i.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}",a+"-"+s),t.ResourceType.Glyphs);t.getArrayBuffer(u,(function(e,n){if(e)o(e);else if(n){for(var r={},i=0,a=t.parseGlyphPBF(n);i<a.length;i+=1){var s=a[i];r[s.id]=s}o(null,r)}}))},x.TinySDF=d;var b=function(){this.specification=t.styleSpec.light.position};b.prototype.possiblyEvaluate=function(e,n){return t.sphericalToCartesian(e.expression.evaluate(n))},b.prototype.interpolate=function(e,n,r){return{x:t.number(e.x,n.x,r),y:t.number(e.y,n.y,r),z:t.number(e.z,n.z,r)}};var w=new t.Properties({anchor:new t.DataConstantProperty(t.styleSpec.light.anchor),position:new b,color:new t.DataConstantProperty(t.styleSpec.light.color),intensity:new t.DataConstantProperty(t.styleSpec.light.intensity)}),E=function(e){function n(n){e.call(this),this._transitionable=new t.Transitionable(w),this.setLight(n),this._transitioning=this._transitionable.untransitioned()}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getLight=function(){return this._transitionable.serialize()},n.prototype.setLight=function(e,n){if(void 0===n&&(n={}),!this._validate(t.validateLight,e,n))for(var r in e){var i=e[r];t.endsWith(r,"-transition")?this._transitionable.setTransition(r.slice(0,-"-transition".length),i):this._transitionable.setValue(r,i)}},n.prototype.updateTransitions=function(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)},n.prototype.hasTransition=function(){return this._transitioning.hasTransition()},n.prototype.recalculate=function(t){this.properties=this._transitioning.possiblyEvaluate(t)},n.prototype._validate=function(e,n,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.styleSpec})))},n}(t.Evented),S=function(t,e){this.width=t,this.height=e,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};S.prototype.getDash=function(t,e){var n=t.join(",")+String(e);return this.dashEntry[n]||(this.dashEntry[n]=this.addDash(t,e)),this.dashEntry[n]},S.prototype.getDashRanges=function(t,e,n){var r=[],i=t.length%2==1?-t[t.length-1]*n:0,o=t[0]*n,a=!0;r.push({left:i,right:o,isDash:a,zeroLength:0===t[0]});for(var s=t[0],u=1;u<t.length;u++){var c=t[u];r.push({left:i=s*n,right:o=(s+=c)*n,isDash:a=!a,zeroLength:0===c})}return r},S.prototype.addRoundDash=function(t,e,n){for(var r=e/2,i=-n;i<=n;i++)for(var o=this.width*(this.nextRow+n+i),a=0,s=t[a],u=0;u<this.width;u++){u/s.right>1&&(s=t[++a]);var c=Math.abs(u-s.left),l=Math.abs(u-s.right),h=Math.min(c,l),f=void 0,p=i/n*(r+1);if(s.isDash){var d=r-Math.abs(p);f=Math.sqrt(h*h+d*d)}else f=r-Math.sqrt(h*h+p*p);this.data[o+u]=Math.max(0,Math.min(255,f+128))}},S.prototype.addRegularDash=function(t){for(var e=t.length-1;e>=0;--e){var n=t[e],r=t[e+1];n.zeroLength?t.splice(e,1):r&&r.isDash===n.isDash&&(r.left=n.left,t.splice(e,1))}var i=t[0],o=t[t.length-1];i.isDash===o.isDash&&(i.left=o.left-this.width,o.right=i.right+this.width);for(var a=this.width*this.nextRow,s=0,u=t[s],c=0;c<this.width;c++){c/u.right>1&&(u=t[++s]);var l=Math.abs(c-u.left),h=Math.abs(c-u.right),f=Math.min(l,h);this.data[a+c]=Math.max(0,Math.min(255,(u.isDash?f:-f)+128))}},S.prototype.addDash=function(e,n){var r=n?7:0,i=2*r+1;if(this.nextRow+i>this.height)return t.warnOnce("LineAtlas out of space"),null;for(var o=0,a=0;a<e.length;a++)o+=e[a];if(0!==o){var s=this.width/o,u=this.getDashRanges(e,this.width,s);n?this.addRoundDash(u,s,r):this.addRegularDash(u)}var c={y:(this.nextRow+r+.5)/this.height,height:2*r/this.height,width:o};return this.nextRow+=i,this.dirty=!0,c},S.prototype.bind=function(t){var e=t.gl;this.texture?(e.bindTexture(e.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,e.texSubImage2D(e.TEXTURE_2D,0,0,0,this.width,this.height,e.ALPHA,e.UNSIGNED_BYTE,this.data))):(this.texture=e.createTexture(),e.bindTexture(e.TEXTURE_2D,this.texture),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_S,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_WRAP_T,e.REPEAT),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MIN_FILTER,e.LINEAR),e.texParameteri(e.TEXTURE_2D,e.TEXTURE_MAG_FILTER,e.LINEAR),e.texImage2D(e.TEXTURE_2D,0,e.ALPHA,this.width,this.height,0,e.ALPHA,e.UNSIGNED_BYTE,this.data))};var A=function e(n,r){this.workerPool=n,this.actors=[],this.currentActor=0,this.id=t.uniqueId();for(var i=this.workerPool.acquire(this.id),o=0;o<i.length;o++){var a=new e.Actor(i[o],r,this.id);a.name="Worker "+o,this.actors.push(a)}};function T(e,n,r){var i=function(i,o){if(i)return r(i);if(o){var a=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(a.vectorLayers=o.vector_layers,a.vectorLayerIds=a.vectorLayers.map((function(t){return t.id}))),a.tiles=n.canonicalizeTileset(a,e.url),r(null,a)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.browser.frame((function(){return i(null,e)}))}A.prototype.broadcast=function(e,n,r){t.asyncAll(this.actors,(function(t,r){t.send(e,n,r)}),r=r||function(){})},A.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},A.prototype.remove=function(){this.actors.forEach((function(t){t.remove()})),this.actors=[],this.workerPool.release(this.id)},A.Actor=t.Actor;var C=function(e,n,r){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=r||24};C.prototype.validateBounds=function(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]},C.prototype.contains=function(e){var n=Math.pow(2,e.z),r=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),a=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=r&&e.x<o&&e.y>=i&&e.y<a};var k=function(e){function n(n,r,i,o){if(e.call(this),this.id=n,this.dispatcher=i,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(r,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},r),this._collectResourceTiming=r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(o)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(n,r){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new C(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles,e.map._requestManager._customAccessToken),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken,e.map._requestManager._customAccessToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setSourceProperty=function(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},n.prototype.setTiles=function(t){var e=this;return this.setSourceProperty((function(){e._options.tiles=t})),this},n.prototype.setUrl=function(t){var e=this;return this.setSourceProperty((function(){e.url=t,e._options.url=t})),this},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.loadTile=function(e,n){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,t.ResourceType.Tile),uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function o(r,i){return delete e.request,e.aborted?n(null):r&&404!==r.status?n(r):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state?"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",i,o.bind(this)):(e.actor=this.dispatcher.getActor(),e.request=e.actor.send("loadTile",i,o.bind(this)))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.unloadTile=function(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id},void 0)},n.prototype.hasTransition=function(){return!1},n}(t.Evented),M=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.dispatcher=i,this.setEventedParent(o),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},r),t.extend(this,t.pick(r,["url","scheme","tileSize"]))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=T(this._options,this.map._requestManager,(function(n,r){e._tileJSONRequest=null,e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(t.extend(e,r),r.bounds&&(e.tileBounds=new C(r.bounds,e.minzoom,e.maxzoom)),t.postTurnstileEvent(r.tiles),t.postMapLoadEvent(r.tiles,e.map._getMapId(),e.map._requestManager._skuToken),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),e.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},n.prototype.serialize=function(){return t.extend({},this._options)},n.prototype.hasTile=function(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)},n.prototype.loadTile=function(e,n){var r=this,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(function(i,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(i)e.state="errored",n(i);else if(o){r.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=r.map.painter.context,s=a.gl;e.texture=r.map.painter.getTileTexture(o.width),e.texture?e.texture.update(o,{useMipmap:!0}):(e.texture=new t.Texture(a,o,s.RGBA,{useMipmap:!0}),e.texture.bind(s.LINEAR,s.CLAMP_TO_EDGE,s.LINEAR_MIPMAP_NEAREST),a.extTextureFilterAnisotropic&&s.texParameterf(s.TEXTURE_2D,a.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,a.extTextureFilterAnisotropicMax)),e.state="loaded",t.cacheEntryPossiblyAdded(r.dispatcher),n(null)}}))},n.prototype.abortTile=function(t,e){t.request&&(t.request.cancel(),delete t.request),e()},n.prototype.unloadTile=function(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()},n.prototype.hasTransition=function(){return!1},n}(t.Evented),P=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},n.prototype.loadTile=function(e,n){var r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function i(t,r){t&&(e.state="errored",n(t)),r&&(e.dem=r,e.needsHillshadePrepare=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),function(r,o){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData(o),delete o.cacheControl,delete o.expires;var a=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&t.offscreenCanvasSupported()?o:t.browser.getImageData(o,1),s={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:a,encoding:this.encoding};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",s,i.bind(this)))}}.bind(this)),e.neighboringTiles=this._getNeighboringTiles(e.tileID)},n.prototype._getNeighboringTiles=function(e){var n=e.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?e.wrap-1:e.wrap,a=(n.x+1+r)%r,s=n.x+1===r?e.wrap+1:e.wrap,u={};return u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y).key]={backfilled:!1},n.y>0&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y-1).key]={backfilled:!1}),n.y+1<r&&(u[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},u[new t.OverscaledTileID(e.overscaledZ,s,n.z,a,n.y+1).key]={backfilled:!1}),u},n.prototype.unloadTile=function(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded",t.actor&&t.actor.send("removeDEMTile",{uid:t.uid,source:this.id})},n}(M),I=function(e){function n(n,r,i,o){e.call(this),this.id=n,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=i.getActor(),this.setEventedParent(o),this._data=r.data,this._options=t.extend({},r),this._collectResourceTiming=r.collectResourceTiming,this._resourceTiming=[],void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;var a=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*a,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*a,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?Math.min(r.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:t.EXTENT,radius:(r.clusterRadius||50)*a,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter},r.workerOptions)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(n){if(n)e.fire(new t.ErrorEvent(n));else{var r={dataType:"source",sourceDataType:"metadata"};e._collectResourceTiming&&e._resourceTiming&&e._resourceTiming.length>0&&(r.resourceTiming=e._resourceTiming,e._resourceTiming=[]),e.fire(new t.Event("data",r))}}))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setData=function(e){var n=this;return this._data=e,this.fire(new t.Event("dataloading",{dataType:"source"})),this._updateWorkerData((function(e){if(e)n.fire(new t.ErrorEvent(e));else{var r={dataType:"source",sourceDataType:"content"};n._collectResourceTiming&&n._resourceTiming&&n._resourceTiming.length>0&&(r.resourceTiming=n._resourceTiming,n._resourceTiming=[]),n.fire(new t.Event("data",r))}})),this},n.prototype.getClusterExpansionZoom=function(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this},n.prototype.getClusterChildren=function(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this},n.prototype.getClusterLeaves=function(t,e,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},r),this},n.prototype._updateWorkerData=function(e){var n=this;this._loaded=!1;var r=t.extend({},this.workerOptions),i=this._data;"string"==typeof i?(r.request=this.map._requestManager.transformRequest(t.browser.resolveURL(i),t.ResourceType.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(i),this.actor.send(this.type+".loadData",r,(function(t,i){n._removed||i&&i.abandoned||(n._loaded=!0,i&&i.resourceTiming&&i.resourceTiming[n.id]&&(n._resourceTiming=i.resourceTiming[n.id].slice(0)),n.actor.send(n.type+".coalesce",{source:r.source},null),e(t))}))},n.prototype.loaded=function(){return this._loaded},n.prototype.loadTile=function(e,n){var r=this,i=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(i,{type:this.type,uid:e.uid,tileID:e.tileID,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(function(t,o){return delete e.request,e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(o,r.map.painter,"reloadTile"===i),n(null))}))},n.prototype.abortTile=function(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0},n.prototype.unloadTile=function(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})},n.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},n.prototype.serialize=function(){return t.extend({},this._options,{type:this.type,data:this._data})},n.prototype.hasTransition=function(){return!1},n}(t.Evented),R=t.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),L=function(e){function n(t,n,r,i){e.call(this),this.id=t,this.dispatcher=r,this.coordinates=n.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(i),this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(e,n){var r=this;this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(function(i,o){r._loaded=!0,i?r.fire(new t.ErrorEvent(i)):o&&(r.image=o,e&&(r.coordinates=e),n&&n(),r._finishLoading())}))},n.prototype.loaded=function(){return this._loaded},n.prototype.updateImage=function(t){var e=this;return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates,(function(){e.texture=null})),this):this},n.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))},n.prototype.onAdd=function(t){this.map=t,this.load()},n.prototype.setCoordinates=function(e){var n=this;this.coordinates=e;var r=e.map(t.MercatorCoordinate.fromLngLat);this.tileID=function(e){for(var n=1/0,r=1/0,i=-1/0,o=-1/0,a=0,s=e;a<s.length;a+=1){var u=s[a];n=Math.min(n,u.x),r=Math.min(r,u.y),i=Math.max(i,u.x),o=Math.max(o,u.y)}var c=Math.max(i-n,o-r),l=Math.max(0,Math.floor(-Math.log(c)/Math.LN2)),h=Math.pow(2,l);return new t.CanonicalTileID(l,Math.floor((n+i)/2*h),Math.floor((r+o)/2*h))}(r),this.minzoom=this.maxzoom=this.tileID.z;var i=r.map((function(t){return n.tileID.getTilePoint(t)._round()}));return this._boundsArray=new t.StructArrayLayout4i8,this._boundsArray.emplaceBack(i[0].x,i[0].y,0,0),this._boundsArray.emplaceBack(i[1].x,i[1].y,t.EXTENT,0),this._boundsArray.emplaceBack(i[3].x,i[3].y,0,t.EXTENT),this._boundsArray.emplaceBack(i[2].x,i[2].y,t.EXTENT,t.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this},n.prototype.prepare=function(){if(0!==Object.keys(this.tiles).length&&this.image){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,R.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.loadTile=function(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))},n.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return!1},n}(t.Evented),O=function(e){function n(t,n,r,i){e.call(this,t,n,r,i),this.roundZoom=!0,this.type="video",this.options=n}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){var e=this;this._loaded=!1;var n=this.options;this.urls=[];for(var r=0,i=n.urls;r<i.length;r+=1)this.urls.push(this.map._requestManager.transformRequest(i[r],t.ResourceType.Source).url);t.getVideo(this.urls,(function(n,r){e._loaded=!0,n?e.fire(new t.ErrorEvent(n)):r&&(e.video=r,e.video.loop=!0,e.video.setAttribute("playsinline",""),e.video.addEventListener("playing",(function(){e.map.triggerRepaint()})),e.map&&e.video.play(),e._finishLoading())}))},n.prototype.pause=function(){this.video&&this.video.pause()},n.prototype.play=function(){this.video&&this.video.play()},n.prototype.seek=function(e){if(this.video){var n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+n.start(0)+" and "+n.end(0)+"-second mark."))):this.video.currentTime=e}},n.prototype.getVideo=function(){return this.video},n.prototype.onAdd=function(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},n.prototype.prepare=function(){if(!(0===Object.keys(this.tiles).length||this.video.readyState<2)){var e=this.map.painter.context,n=e.gl;for(var r in this.boundsBuffer||(this.boundsBuffer=e.createVertexBuffer(this._boundsArray,R.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this.tiles){var i=this.tiles[r];"loaded"!==i.state&&(i.state="loaded",i.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this.video&&!this.video.paused},n}(L),D=function(e){function n(n,r,i,o){e.call(this,n,r,i,o),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some((function(t){return!Array.isArray(t)||2!==t.length||t.some((function(t){return"number"!=typeof t}))}))||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError("sources."+n,null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},n.prototype.getCanvas=function(){return this.canvas},n.prototype.onAdd=function(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()},n.prototype.onRemove=function(){this.pause()},n.prototype.prepare=function(){var e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),!this._hasInvalidDimensions()&&0!==Object.keys(this.tiles).length){var n=this.map.painter.context,r=n.gl;for(var i in this.boundsBuffer||(this.boundsBuffer=n.createVertexBuffer(this._boundsArray,R.members)),this.boundsSegments||(this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,r.RGBA,{premultiply:!0}),this.tiles){var o=this.tiles[i];"loaded"!==o.state&&(o.state="loaded",o.texture=this.texture)}}},n.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},n.prototype.hasTransition=function(){return this._playing},n.prototype._hasInvalidDimensions=function(){for(var t=0,e=[this.canvas.width,this.canvas.height];t<e.length;t+=1){var n=e[t];if(isNaN(n)||n<=0)return!0}return!1},n}(L),N={vector:k,raster:M,"raster-dem":P,geojson:I,video:O,image:L,canvas:D};function z(e,n){var r=t.identity([]);return t.translate(r,r,[1,1,0]),t.scale(r,r,[.5*e.width,.5*e.height,1]),t.multiply(r,r,e.calculatePosMatrix(n.toUnwrapped()))}function F(t,e,n,r,i,o){var a=function(t,e,n){if(t)for(var r=0,i=t;r<i.length;r+=1){var o=e[i[r]];if(o&&o.source===n&&"fill-extrusion"===o.type)return!0}else for(var a in e){var s=e[a];if(s.source===n&&"fill-extrusion"===s.type)return!0}return!1}(i&&i.layers,e,t.id),s=o.maxPitchScaleFactor(),u=t.tilesIn(r,s,a);u.sort(B);for(var c=[],l=0,h=u;l<h.length;l+=1){var f=h[l];c.push({wrappedTileID:f.tileID.wrapped().key,queryResults:f.tile.queryRenderedFeatures(e,n,t._state,f.queryGeometry,f.cameraQueryGeometry,f.scale,i,o,s,z(t.transform,f.tileID))})}var p=function(t){for(var e={},n={},r=0,i=t;r<i.length;r+=1){var o=i[r],a=o.queryResults,s=o.wrappedTileID,u=n[s]=n[s]||{};for(var c in a)for(var l=a[c],h=u[c]=u[c]||{},f=e[c]=e[c]||[],p=0,d=l;p<d.length;p+=1){var v=d[p];h[v.featureIndex]||(h[v.featureIndex]=!0,f.push(v))}}return e}(c);for(var d in p)p[d].forEach((function(e){var n=e.feature,r=t.getFeatureState(n.layer["source-layer"],n.id);n.source=n.layer.source,n.layer["source-layer"]&&(n.sourceLayer=n.layer["source-layer"]),n.state=r}));return p}function B(t,e){var n=t.tileID,r=e.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}var U=function(t,e){this.max=t,this.onRemove=e,this.reset()};U.prototype.reset=function(){for(var t in this.data)for(var e=0,n=this.data[t];e<n.length;e+=1){var r=n[e];r.timeout&&clearTimeout(r.timeout),this.onRemove(r.value)}return this.data={},this.order=[],this},U.prototype.add=function(t,e,n){var r=this,i=t.wrapped().key;void 0===this.data[i]&&(this.data[i]=[]);var o={value:e,timeout:void 0};if(void 0!==n&&(o.timeout=setTimeout((function(){r.remove(t,o)}),n)),this.data[i].push(o),this.order.push(i),this.order.length>this.max){var a=this._getAndRemoveByKey(this.order[0]);a&&this.onRemove(a)}return this},U.prototype.has=function(t){return t.wrapped().key in this.data},U.prototype.getAndRemove=function(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null},U.prototype._getAndRemoveByKey=function(t){var e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value},U.prototype.getByKey=function(t){var e=this.data[t];return e?e[0].value:null},U.prototype.get=function(t){return this.has(t)?this.data[t.wrapped().key][0].value:null},U.prototype.remove=function(t,e){if(!this.has(t))return this;var n=t.wrapped().key,r=void 0===e?0:this.data[n].indexOf(e),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this},U.prototype.setMaxSize=function(t){for(this.max=t;this.order.length>this.max;){var e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this},U.prototype.filter=function(t){var e=[];for(var n in this.data)for(var r=0,i=this.data[n];r<i.length;r+=1){var o=i[r];t(o.value)||e.push(o)}for(var a=0,s=e;a<s.length;a+=1){var u=s[a];this.remove(u.value.tileID,u)}};var j=function(t,e,n){this.context=t;var r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};j.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},j.prototype.updateData=function(t){var e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)},j.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Z={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},V=function(t,e,n,r){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;var i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||delete e.arrayBuffer};V.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},V.prototype.updateData=function(t){var e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)},V.prototype.enableAttributes=function(t,e){for(var n=0;n<this.attributes.length;n++){var r=e.attributes[this.attributes[n].name];void 0!==r&&t.enableVertexAttribArray(r)}},V.prototype.setVertexAttribPointers=function(t,e,n){for(var r=0;r<this.attributes.length;r++){var i=this.attributes[r],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[Z[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}},V.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var G=function(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};G.prototype.get=function(){return this.current},G.prototype.set=function(t){},G.prototype.getDefault=function(){return this.default},G.prototype.setDefault=function(){this.set(this.default)};var H=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(G),W=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 1},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)},e}(G),q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)},e}(G),X=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[!0,!0,!0,!0]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),Y=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)},e}(G),K=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 255},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)},e}(G),Q=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},e.prototype.set=function(t){var e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)},e}(G),J=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)},e}(G),$=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}},e}(G),tt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return[0,1]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}},e}(G),nt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.LESS},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)},e}(G),rt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}},e}(G),it=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[t.ONE,t.ZERO]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)},e}(G),ot=function(e){function n(){e.apply(this,arguments)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getDefault=function(){return t.Color.transparent},n.prototype.set=function(t){var e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)},n}(G),at=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.FUNC_ADD},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)},e}(G),st=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}},e}(G),ut=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.BACK},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)},e}(G),ct=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.CCW},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)},e}(G),lt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)},e}(G),ht=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return this.gl.TEXTURE0},e.prototype.set=function(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)},e}(G),ft=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){var t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]},e.prototype.set=function(t){var e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)},e}(G),pt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}},e}(G),dt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(G),vt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}},e}(G),mt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}},e}(G),gt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){var e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1},e}(G),yt=function(t){function e(e){t.call(this,e),this.vao=e.extVertexArrayObject}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e.prototype.set=function(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)},e}(G),_t=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return 4},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}},e}(G),xt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),bt=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return!1},e.prototype.set=function(t){if(t!==this.current||this.dirty){var e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}},e}(G),wt=function(t){function e(e,n){t.call(this,e),this.context=e,this.parent=n}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.getDefault=function(){return null},e}(G),Et=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.setDirty=function(){this.dirty=!0},e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}},e}(wt),St=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.set=function(t){if(t!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,e.DEPTH_ATTACHMENT,e.RENDERBUFFER,t),this.current=t,this.dirty=!1}},e}(wt),At=function(t,e,n,r){this.context=t,this.width=e,this.height=n;var i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new Et(t,i),r&&(this.depthAttachment=new St(t,i))};At.prototype.destroy=function(){var t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){var n=this.depthAttachment.get();n&&t.deleteRenderbuffer(n)}t.deleteFramebuffer(this.framebuffer)};var Tt=function(t,e,n){this.func=t,this.mask=e,this.range=n};Tt.ReadOnly=!1,Tt.ReadWrite=!0,Tt.disabled=new Tt(519,Tt.ReadOnly,[0,1]);var Ct=function(t,e,n,r,i,o){this.test=t,this.ref=e,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o};Ct.disabled=new Ct({func:519,mask:0},0,0,7680,7680,7680);var kt=function(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n};kt.disabled=new kt(kt.Replace=[1,0],t.Color.transparent,[!1,!1,!1,!1]),kt.unblended=new kt(kt.Replace,t.Color.transparent,[!0,!0,!0,!0]),kt.alphaBlended=new kt([1,771],t.Color.transparent,[!0,!0,!0,!0]);var Mt=function(t,e,n){this.enable=t,this.mode=e,this.frontFace=n};Mt.disabled=new Mt(!1,1029,2305),Mt.backCCW=new Mt(!0,1029,2305);var Pt=function(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new H(this),this.clearDepth=new W(this),this.clearStencil=new q(this),this.colorMask=new X(this),this.depthMask=new Y(this),this.stencilMask=new K(this),this.stencilFunc=new Q(this),this.stencilOp=new J(this),this.stencilTest=new $(this),this.depthRange=new tt(this),this.depthTest=new et(this),this.depthFunc=new nt(this),this.blend=new rt(this),this.blendFunc=new it(this),this.blendColor=new ot(this),this.blendEquation=new at(this),this.cullFace=new st(this),this.cullFaceSide=new ut(this),this.frontFace=new ct(this),this.program=new lt(this),this.activeTexture=new ht(this),this.viewport=new ft(this),this.bindFramebuffer=new pt(this),this.bindRenderbuffer=new dt(this),this.bindTexture=new vt(this),this.bindVertexBuffer=new mt(this),this.bindElementBuffer=new gt(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new yt(this),this.pixelStoreUnpack=new _t(this),this.pixelStoreUnpackPremultiplyAlpha=new xt(this),this.pixelStoreUnpackFlipY=new bt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)};Pt.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},Pt.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},Pt.prototype.createIndexBuffer=function(t,e){return new j(this,t,e)},Pt.prototype.createVertexBuffer=function(t,e,n){return new V(this,t,e,n)},Pt.prototype.createRenderbuffer=function(t,e,n){var r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),i},Pt.prototype.createFramebuffer=function(t,e,n){return new At(this,t,e,n)},Pt.prototype.clear=function(t){var e=t.color,n=t.depth,r=this.gl,i=0;e&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(e),this.colorMask.set([!0,!0,!0,!0])),void 0!==n&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(n),this.depthMask.set(!0)),r.clear(i)},Pt.prototype.setCullFace=function(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))},Pt.prototype.setDepthMode=function(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)},Pt.prototype.setStencilMode=function(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)},Pt.prototype.setColorMode=function(e){t.deepEqual(e.blendFunction,kt.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)},Pt.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var It=function(e){function n(n,r,i){var o=this;e.call(this),this.id=n,this.dispatcher=i,this.on("data",(function(t){"source"===t.dataType&&"metadata"===t.sourceDataType&&(o._sourceLoaded=!0),o._sourceLoaded&&!o._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(o.reload(),o.transform&&o.update(o.transform))})),this.on("error",(function(){o._sourceErrored=!0})),this._source=function(e,n,r,i){var o=new N[n.type](e,n,r,i);if(o.id!==e)throw new Error("Expected Source id to be "+e+" instead of "+o.id);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o}(n,r,i,this),this._tiles={},this._cache=new U(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new t.SourceFeatureState}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.onAdd=function(t){this.map=t,this._maxTileCacheSize=t?t._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(t)},n.prototype.onRemove=function(t){this._source&&this._source.onRemove&&this._source.onRemove(t)},n.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(var t in this._tiles){var e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0},n.prototype.getSource=function(){return this._source},n.prototype.pause=function(){this._paused=!0},n.prototype.resume=function(){if(this._paused){var t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}},n.prototype._loadTile=function(t,e){return this._source.loadTile(t,e)},n.prototype._unloadTile=function(t){if(this._source.unloadTile)return this._source.unloadTile(t,(function(){}))},n.prototype._abortTile=function(t){if(this._source.abortTile)return this._source.abortTile(t,(function(){}))},n.prototype.serialize=function(){return this._source.serialize()},n.prototype.prepare=function(t){for(var e in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}},n.prototype.getIds=function(){return t.values(this._tiles).map((function(t){return t.tileID})).sort(Rt).map((function(t){return t.key}))},n.prototype.getRenderableIds=function(e){var n=this,r=[];for(var i in this._tiles)this._isIdRenderable(i,e)&&r.push(this._tiles[i]);return e?r.sort((function(e,r){var i=e.tileID,o=r.tileID,a=new t.Point(i.canonical.x,i.canonical.y)._rotate(n.transform.angle),s=new t.Point(o.canonical.x,o.canonical.y)._rotate(n.transform.angle);return i.overscaledZ-o.overscaledZ||s.y-a.y||s.x-a.x})).map((function(t){return t.tileID.key})):r.map((function(t){return t.tileID})).sort(Rt).map((function(t){return t.key}))},n.prototype.hasRenderableParent=function(t){var e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)},n.prototype._isIdRenderable=function(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())},n.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var t in this._cache.reset(),this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(t,"reloading")},n.prototype._reloadTile=function(t,e){var n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))},n.prototype._tileLoaded=function(e,n,r,i){if(i)return e.state="errored",void(404!==i.status?this._source.fire(new t.ErrorEvent(i,{tile:e})):this.update(this.transform));e.timeAdded=t.browser.now(),"expired"===r&&(e.refreshedUponExpiration=!0),this._setTileReloadTimer(n,e),"raster-dem"===this.getSource().type&&e.dem&&this._backfillDEM(e),this._state.initializeTileState(e,this.map?this.map.painter:null),this._source.fire(new t.Event("data",{dataType:"source",tile:e,coord:e.tileID}))},n.prototype._backfillDEM=function(t){for(var e=this.getRenderableIds(),n=0;n<e.length;n++){var r=e[n];if(t.neighboringTiles&&t.neighboringTiles[r]){var i=this.getTileByID(r);o(t,i),o(i,t)}}function o(t,e){t.needsHillshadePrepare=!0;var n=e.tileID.canonical.x-t.tileID.canonical.x,r=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}},n.prototype.getTile=function(t){return this.getTileByID(t.key)},n.prototype.getTileByID=function(t){return this._tiles[t]},n.prototype._retainLoadedChildren=function(t,e,n,r){for(var i in this._tiles){var o=this._tiles[i];if(!(r[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>n)){for(var a=o.tileID;o&&o.tileID.overscaledZ>e+1;){var s=o.tileID.scaledTo(o.tileID.overscaledZ-1);(o=this._tiles[s.key])&&o.hasData()&&(a=s)}for(var u=a;u.overscaledZ>e;)if(t[(u=u.scaledTo(u.overscaledZ-1)).key]){r[a.key]=a;break}}}},n.prototype.findLoadedParent=function(t,e){if(t.key in this._loadedParentTiles){var n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(var r=t.overscaledZ-1;r>=e;r--){var i=t.scaledTo(r),o=this._getLoadedTile(i);if(o)return o}},n.prototype._getLoadedTile=function(t){var e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(t.wrapped().key)},n.prototype.updateCacheSize=function(t){var e=Math.ceil(t.width/this._source.tileSize)+1,n=Math.ceil(t.height/this._source.tileSize)+1,r=Math.floor(e*n*5),i="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,r):r;this._cache.setMaxSize(i)},n.prototype.handleWrapJump=function(t){var e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){var n={};for(var r in this._tiles){var i=this._tiles[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),n[i.tileID.key]=i}for(var o in this._tiles=n,this._timers)clearTimeout(this._timers[o]),delete this._timers[o];for(var a in this._tiles)this._setTileReloadTimer(a,this._tiles[a])}},n.prototype.update=function(e){var r=this;if(this.transform=e,this._sourceLoaded&&!this._paused){var i;this.updateCacheSize(e),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?i=e.getVisibleUnwrappedCoordinates(this._source.tileID).map((function(e){return new t.OverscaledTileID(e.canonical.z,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y)})):(i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(i=i.filter((function(t){return r._source.hasTile(t)})))):i=[];var o=e.coveringZoomLevel(this._source),a=Math.max(o-n.maxOverzooming,this._source.minzoom),s=Math.max(o+n.maxUnderzooming,this._source.minzoom),u=this._updateRetainedTiles(i,o);if(Lt(this._source.type)){for(var c={},l={},h=0,f=Object.keys(u);h<f.length;h+=1){var p=f[h],d=u[p],v=this._tiles[p];if(v&&!(v.fadeEndTime&&v.fadeEndTime<=t.browser.now())){var m=this.findLoadedParent(d,a);m&&(this._addTile(m.tileID),c[m.tileID.key]=m.tileID),l[p]=d}}for(var g in this._retainLoadedChildren(l,o,s,u),c)u[g]||(this._coveredTiles[g]=!0,u[g]=c[g])}for(var y in u)this._tiles[y].clearFadeHold();for(var _=0,x=t.keysDifference(this._tiles,u);_<x.length;_+=1){var b=x[_],w=this._tiles[b];w.hasSymbolBuckets&&!w.holdingForFade()?w.setHoldDuration(this.map._fadeDuration):w.hasSymbolBuckets&&!w.symbolFadeFinished()||this._removeTile(b)}this._updateLoadedParentTileCache()}},n.prototype.releaseSymbolFadeTiles=function(){for(var t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(t)},n.prototype._updateRetainedTiles=function(t,e){for(var r={},i={},o=Math.max(e-n.maxOverzooming,this._source.minzoom),a=Math.max(e+n.maxUnderzooming,this._source.minzoom),s={},u=0,c=t;u<c.length;u+=1){var l=c[u],h=this._addTile(l);r[l.key]=l,h.hasData()||e<this._source.maxzoom&&(s[l.key]=l)}this._retainLoadedChildren(s,e,a,r);for(var f=0,p=t;f<p.length;f+=1){var d=p[f],v=this._tiles[d.key];if(!v.hasData()){if(e+1>this._source.maxzoom){var m=d.children(this._source.maxzoom)[0],g=this.getTile(m);if(g&&g.hasData()){r[m.key]=m;continue}}else{var y=d.children(this._source.maxzoom);if(r[y[0].key]&&r[y[1].key]&&r[y[2].key]&&r[y[3].key])continue}for(var _=v.wasRequested(),x=d.overscaledZ-1;x>=o;--x){var b=d.scaledTo(x);if(i[b.key])break;if(i[b.key]=!0,!(v=this.getTile(b))&&_&&(v=this._addTile(b)),v&&(r[b.key]=b,_=v.wasRequested(),v.hasData()))break}}}return r},n.prototype._updateLoadedParentTileCache=function(){for(var t in this._loadedParentTiles={},this._tiles){for(var e=[],n=void 0,r=this._tiles[t].tileID;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}e.push(r.key);var i=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(i))break;r=i}for(var o=0,a=e;o<a.length;o+=1)this._loadedParentTiles[a[o]]=n}},n.prototype._addTile=function(e){var n=this._tiles[e.key];if(n)return n;(n=this._cache.getAndRemove(e))&&(this._setTileReloadTimer(e.key,n),n.tileID=e,this._state.initializeTileState(n,this.map?this.map.painter:null),this._cacheTimers[e.key]&&(clearTimeout(this._cacheTimers[e.key]),delete this._cacheTimers[e.key],this._setTileReloadTimer(e.key,n)));var r=Boolean(n);return r||(n=new t.Tile(e,this._source.tileSize*e.overscaleFactor()),this._loadTile(n,this._tileLoaded.bind(this,n,e.key,n.state))),n?(n.uses++,this._tiles[e.key]=n,r||this._source.fire(new t.Event("dataloading",{tile:n,coord:n.tileID,dataType:"source"})),n):null},n.prototype._setTileReloadTimer=function(t,e){var n=this;t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);var r=e.getExpiryTimeout();r&&(this._timers[t]=setTimeout((function(){n._reloadTile(t,"expired"),delete n._timers[t]}),r))},n.prototype._removeTile=function(t){var e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))},n.prototype.clearTiles=function(){for(var t in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(t);this._cache.reset()},n.prototype.tilesIn=function(e,n,r){var i=this,o=[],a=this.transform;if(!a)return o;for(var s=r?a.getCameraQueryGeometry(e):e,u=e.map((function(t){return a.pointCoordinate(t)})),c=s.map((function(t){return a.pointCoordinate(t)})),l=this.getIds(),h=1/0,f=1/0,p=-1/0,d=-1/0,v=0,m=c;v<m.length;v+=1){var g=m[v];h=Math.min(h,g.x),f=Math.min(f,g.y),p=Math.max(p,g.x),d=Math.max(d,g.y)}for(var y=function(e){var r=i._tiles[l[e]];if(!r.holdingForFade()){var s=r.tileID,v=Math.pow(2,a.zoom-r.tileID.overscaledZ),m=n*r.queryPadding*t.EXTENT/r.tileSize/v,g=[s.getTilePoint(new t.MercatorCoordinate(h,f)),s.getTilePoint(new t.MercatorCoordinate(p,d))];if(g[0].x-m<t.EXTENT&&g[0].y-m<t.EXTENT&&g[1].x+m>=0&&g[1].y+m>=0){var y=u.map((function(t){return s.getTilePoint(t)})),_=c.map((function(t){return s.getTilePoint(t)}));o.push({tile:r,tileID:s,queryGeometry:y,cameraQueryGeometry:_,scale:v})}}},_=0;_<l.length;_++)y(_);return o},n.prototype.getVisibleCoordinates=function(t){for(var e=this,n=this.getRenderableIds(t).map((function(t){return e._tiles[t].tileID})),r=0,i=n;r<i.length;r+=1){var o=i[r];o.posMatrix=this.transform.calculatePosMatrix(o.toUnwrapped())}return n},n.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(Lt(this._source.type))for(var e in this._tiles){var n=this._tiles[e];if(void 0!==n.fadeEndTime&&n.fadeEndTime>=t.browser.now())return!0}return!1},n.prototype.setFeatureState=function(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)},n.prototype.removeFeatureState=function(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)},n.prototype.getFeatureState=function(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)},n.prototype.setDependencies=function(t,e,n){var r=this._tiles[t];r&&r.setDependencies(e,n)},n.prototype.reloadTilesForDependencies=function(t,e){for(var n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(n,"reloading");this._cache.filter((function(n){return!n.hasDependency(t,e)}))},n}(t.Evented);function Rt(t,e){var n=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Lt(t){return"raster"===t||"image"===t||"video"===t}function Ot(){return new t.window.Worker(Ki.workerUrl)}It.maxOverzooming=10,It.maxUnderzooming=3;var Dt="mapboxgl_preloaded_worker_pool",Nt=function(){this.active={}};Nt.prototype.acquire=function(t){if(!this.workers)for(this.workers=[];this.workers.length<Nt.workerCount;)this.workers.push(new Ot);return this.active[t]=!0,this.workers.slice()},Nt.prototype.release=function(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach((function(t){t.terminate()})),this.workers=null)},Nt.prototype.isPreloaded=function(){return!!this.active[Dt]},Nt.prototype.numActive=function(){return Object.keys(this.active).length};var zt,Ft=Math.floor(t.browser.hardwareConcurrency/2);function Bt(){return zt||(zt=new Nt),zt}function Ut(e,n){var r={};for(var i in e)"ref"!==i&&(r[i]=e[i]);return t.refProperties.forEach((function(t){t in n&&(r[t]=n[t])})),r}function jt(t){t=t.slice();for(var e=Object.create(null),n=0;n<t.length;n++)e[t[n].id]=t[n];for(var r=0;r<t.length;r++)"ref"in t[r]&&(t[r]=Ut(t[r],e[t[r].ref]));return t}Nt.workerCount=Math.max(Math.min(Ft,6),1);var Zt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function Vt(t,e,n){n.push({command:Zt.addSource,args:[t,e[t]]})}function Gt(t,e,n){e.push({command:Zt.removeSource,args:[t]}),n[t]=!0}function Ht(t,e,n,r){Gt(t,n,r),Vt(t,e,n)}function Wt(e,n,r){var i;for(i in e[r])if(e[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;for(i in n[r])if(n[r].hasOwnProperty(i)&&"data"!==i&&!t.deepEqual(e[r][i],n[r][i]))return!1;return!0}function qt(e,n,r,i,o,a){var s;for(s in n=n||{},e=e||{})e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}));for(s in n)n.hasOwnProperty(s)&&!e.hasOwnProperty(s)&&(t.deepEqual(e[s],n[s])||r.push({command:a,args:[i,s,n[s],o]}))}function Xt(t){return t.id}function Yt(t,e){return t[e.id]=e,t}var Kt=function(t,e){this.reset(t,e)};Kt.prototype.reset=function(t,e){this.points=t||[],this._distances=[0];for(var n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding},Kt.prototype.lerp=function(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);for(var n=1,r=this._distances[n],i=e*this.paddedLength+this.padding;r<i&&n<this._distances.length;)r=this._distances[++n];var o=n-1,a=this._distances[o],s=r-a,u=s>0?(i-a)/s:0;return this.points[o].mult(1-u).add(this.points[n].mult(u))};var Qt=function(t,e,n){var r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(var o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0};function Jt(e,n,r,i,o){var a=t.create();return n?(t.scale(a,a,[1/o,1/o,1]),r||t.rotateZ(a,a,i.angle)):t.multiply(a,i.labelPlaneMatrix,e),a}function $t(e,n,r,i,o){if(n){var a=t.clone(e);return t.scale(a,a,[o,o,1]),r||t.rotateZ(a,a,-i.angle),a}return i.glCoordMatrix}function te(e,n){var r=[e.x,e.y,0,1];he(r,r,n);var i=r[3];return{point:new t.Point(r[0]/i,r[1]/i),signedDistanceFromCamera:i}}function ee(t,e){return.5+t/e*.5}function ne(t,e){var n=t[0]/t[3],r=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&r>=-e[1]&&r<=e[1]}function re(e,n,r,i,o,a,s,u){var c=i?e.textSizeData:e.iconSizeData,l=t.evaluateSizeForZoom(c,r.transform.zoom),h=[256/r.width*2+1,256/r.height*2+1],f=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;f.clear();for(var p=e.lineVertexArray,d=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,v=r.transform.width/r.transform.height,m=!1,g=0;g<d.length;g++){var y=d.get(g);if(y.hidden||y.writingMode===t.WritingMode.vertical&&!m)le(y.numGlyphs,f);else{m=!1;var _=[y.anchorX,y.anchorY,0,1];if(t.transformMat4(_,_,n),ne(_,h)){var x=ee(r.transform.cameraToCenterDistance,_[3]),b=t.evaluateSizeForFeature(c,l,y),w=s?b/x:b*x,E=new t.Point(y.anchorX,y.anchorY),S=te(E,o).point,A={},T=ae(y,w,!1,u,n,o,a,e.glyphOffsetArray,p,f,S,E,A,v);m=T.useVertical,(T.notEnoughRoom||m||T.needsFlipping&&ae(y,w,!0,u,n,o,a,e.glyphOffsetArray,p,f,S,E,A,v).notEnoughRoom)&&le(y.numGlyphs,f)}else le(y.numGlyphs,f)}}i?e.text.dynamicLayoutVertexBuffer.updateData(f):e.icon.dynamicLayoutVertexBuffer.updateData(f)}function ie(t,e,n,r,i,o,a,s,u,c,l){var h=s.glyphStartIndex+s.numGlyphs,f=s.lineStartIndex,p=s.lineStartIndex+s.lineLength,d=e.getoffsetX(s.glyphStartIndex),v=e.getoffsetX(h-1),m=ue(t*d,n,r,i,o,a,s.segment,f,p,u,c,l);if(!m)return null;var g=ue(t*v,n,r,i,o,a,s.segment,f,p,u,c,l);return g?{first:m,last:g}:null}function oe(e,n,r,i){return e===t.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:(e===t.WritingMode.vertical?n.y<r.y:n.x>r.x)?{needsFlipping:!0}:null}function ae(e,n,r,i,o,a,s,u,c,l,h,f,p,d){var v,m=n/24,g=e.lineOffsetX*m,y=e.lineOffsetY*m;if(e.numGlyphs>1){var _=e.glyphStartIndex+e.numGlyphs,x=e.lineStartIndex,b=e.lineStartIndex+e.lineLength,w=ie(m,u,g,y,r,h,f,e,c,a,p);if(!w)return{notEnoughRoom:!0};var E=te(w.first.point,s).point,S=te(w.last.point,s).point;if(i&&!r){var A=oe(e.writingMode,E,S,d);if(A)return A}v=[w.first];for(var T=e.glyphStartIndex+1;T<_-1;T++)v.push(ue(m*u.getoffsetX(T),g,y,r,h,f,e.segment,x,b,c,a,p));v.push(w.last)}else{if(i&&!r){var C=te(f,o).point,k=e.lineStartIndex+e.segment+1,M=new t.Point(c.getx(k),c.gety(k)),P=te(M,o),I=P.signedDistanceFromCamera>0?P.point:se(f,M,C,1,o),R=oe(e.writingMode,C,I,d);if(R)return R}var L=ue(m*u.getoffsetX(e.glyphStartIndex),g,y,r,h,f,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,c,a,p);if(!L)return{notEnoughRoom:!0};v=[L]}for(var O=0,D=v;O<D.length;O+=1){var N=D[O];t.addDynamicAttributes(l,N.point,N.angle)}return{}}function se(t,e,n,r,i){var o=te(t.add(t.sub(e)._unit()),i).point,a=n.sub(o);return n.add(a._mult(r/a.mag()))}function ue(e,n,r,i,o,a,s,u,c,l,h,f){var p=i?e-n:e+n,d=p>0?1:-1,v=0;i&&(d*=-1,v=Math.PI),d<0&&(v+=Math.PI);for(var m=d>0?u+s:u+s+1,g=o,y=o,_=0,x=0,b=Math.abs(p),w=[];_+x<=b;){if((m+=d)<u||m>=c)return null;if(y=g,w.push(g),void 0===(g=f[m])){var E=new t.Point(l.getx(m),l.gety(m)),S=te(E,h);if(S.signedDistanceFromCamera>0)g=f[m]=S.point;else{var A=m-d;g=se(0===_?a:new t.Point(l.getx(A),l.gety(A)),E,y,b-_+1,h)}}_+=x,x=y.dist(g)}var T=(b-_)/x,C=g.sub(y),k=C.mult(T)._add(y);k._add(C._unit()._perp()._mult(r*d));var M=v+Math.atan2(g.y-y.y,g.x-y.x);return w.push(k),{point:k,angle:M,path:w}}Qt.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qt.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},Qt.prototype.insertCircle=function(t,e,n,r){this._forEachCell(e-r,n-r,e+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(r)},Qt.prototype._insertBoxCell=function(t,e,n,r,i,o){this.boxCells[i].push(o)},Qt.prototype._insertCircleCell=function(t,e,n,r,i,o){this.circleCells[i].push(o)},Qt.prototype._query=function(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];var a=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(var s=0;s<this.boxKeys.length;s++)a.push({key:this.boxKeys[s],x1:this.bboxes[4*s],y1:this.bboxes[4*s+1],x2:this.bboxes[4*s+2],y2:this.bboxes[4*s+3]});for(var u=0;u<this.circleKeys.length;u++){var c=this.circles[3*u],l=this.circles[3*u+1],h=this.circles[3*u+2];a.push({key:this.circleKeys[u],x1:c-h,y1:l-h,x2:c+h,y2:l+h})}return o?a.filter(o):a}return this._forEachCell(t,e,n,r,this._queryCell,a,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?a.length>0:a},Qt.prototype._queryCircle=function(t,e,n,r,i){var o=t-n,a=t+n,s=e-n,u=e+n;if(a<0||o>this.width||u<0||s>this.height)return!r&&[];var c=[];return this._forEachCell(o,s,a,u,this._queryCellCircle,c,{hitTest:r,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},i),r?c.length>0:c},Qt.prototype.query=function(t,e,n,r,i){return this._query(t,e,n,r,!1,i)},Qt.prototype.hitTest=function(t,e,n,r,i){return this._query(t,e,n,r,!0,i)},Qt.prototype.hitTestCircle=function(t,e,n,r){return this._queryCircle(t,e,n,!0,r)},Qt.prototype._queryCell=function(t,e,n,r,i,o,a,s){var u=a.seenUids,c=this.boxCells[i];if(null!==c)for(var l=this.bboxes,h=0,f=c;h<f.length;h+=1){var p=f[h];if(!u.box[p]){u.box[p]=!0;var d=4*p;if(t<=l[d+2]&&e<=l[d+3]&&n>=l[d+0]&&r>=l[d+1]&&(!s||s(this.boxKeys[p]))){if(a.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[p],x1:l[d],y1:l[d+1],x2:l[d+2],y2:l[d+3]})}}}var v=this.circleCells[i];if(null!==v)for(var m=this.circles,g=0,y=v;g<y.length;g+=1){var _=y[g];if(!u.circle[_]){u.circle[_]=!0;var x=3*_;if(this._circleAndRectCollide(m[x],m[x+1],m[x+2],t,e,n,r)&&(!s||s(this.circleKeys[_]))){if(a.hitTest)return o.push(!0),!0;var b=m[x],w=m[x+1],E=m[x+2];o.push({key:this.circleKeys[_],x1:b-E,y1:w-E,x2:b+E,y2:w+E})}}}},Qt.prototype._queryCellCircle=function(t,e,n,r,i,o,a,s){var u=a.circle,c=a.seenUids,l=this.boxCells[i];if(null!==l)for(var h=this.bboxes,f=0,p=l;f<p.length;f+=1){var d=p[f];if(!c.box[d]){c.box[d]=!0;var v=4*d;if(this._circleAndRectCollide(u.x,u.y,u.radius,h[v+0],h[v+1],h[v+2],h[v+3])&&(!s||s(this.boxKeys[d])))return o.push(!0),!0}}var m=this.circleCells[i];if(null!==m)for(var g=this.circles,y=0,_=m;y<_.length;y+=1){var x=_[y];if(!c.circle[x]){c.circle[x]=!0;var b=3*x;if(this._circlesCollide(g[b],g[b+1],g[b+2],u.x,u.y,u.radius)&&(!s||s(this.circleKeys[x])))return o.push(!0),!0}}},Qt.prototype._forEachCell=function(t,e,n,r,i,o,a,s){for(var u=this._convertToXCellCoord(t),c=this._convertToYCellCoord(e),l=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r),f=u;f<=l;f++)for(var p=c;p<=h;p++)if(i.call(this,t,e,n,r,this.xCellCount*p+f,o,a,s))return},Qt.prototype._convertToXCellCoord=function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))},Qt.prototype._convertToYCellCoord=function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))},Qt.prototype._circlesCollide=function(t,e,n,r,i,o){var a=r-t,s=i-e,u=n+o;return u*u>a*a+s*s},Qt.prototype._circleAndRectCollide=function(t,e,n,r,i,o,a){var s=(o-r)/2,u=Math.abs(t-(r+s));if(u>s+n)return!1;var c=(a-i)/2,l=Math.abs(e-(i+c));if(l>c+n)return!1;if(u<=s||l<=c)return!0;var h=u-s,f=l-c;return h*h+f*f<=n*n};var ce=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function le(t,e){for(var n=0;n<t;n++){var r=e.length;e.resize(r+4),e.float32.set(ce,3*r)}}function he(t,e,n){var r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t[3]=n[3]*r+n[7]*i+n[15],t}var fe=function(t,e,n){void 0===e&&(e=new Qt(t.width+200,t.height+200,25)),void 0===n&&(n=new Qt(t.width+200,t.height+200,25)),this.transform=t,this.grid=e,this.ignoredGrid=n,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+100,this.screenBottomBoundary=t.height+100,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200};function pe(e,n,r){return n*(t.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}fe.prototype.placeCollisionBox=function(t,e,n,r,i){var o=this.projectAndGetPerspectiveRatio(r,t.anchorPointX,t.anchorPointY),a=n*o.perspectiveRatio,s=t.x1*a+o.point.x,u=t.y1*a+o.point.y,c=t.x2*a+o.point.x,l=t.y2*a+o.point.y;return!this.isInsideGrid(s,u,c,l)||!e&&this.grid.hitTest(s,u,c,l,i)?{box:[],offscreen:!1}:{box:[s,u,c,l],offscreen:this.isOffscreen(s,u,c,l)}},fe.prototype.placeCollisionCircles=function(e,n,r,i,o,a,s,u,c,l,h,f,p){var d=[],v=new t.Point(n.anchorX,n.anchorY),m=te(v,a),g=ee(this.transform.cameraToCenterDistance,m.signedDistanceFromCamera),y=(l?o/g:o*g)/t.ONE_EM,_=te(v,s).point,x=ie(y,i,n.lineOffsetX*y,n.lineOffsetY*y,!1,_,v,n,r,s,{}),b=!1,w=!1,E=!0;if(x){for(var S=.5*f*g+p,A=new t.Point(-100,-100),T=new t.Point(this.screenRightBoundary,this.screenBottomBoundary),C=new Kt,k=x.first,M=x.last,P=[],I=k.path.length-1;I>=1;I--)P.push(k.path[I]);for(var R=1;R<M.path.length;R++)P.push(M.path[R]);var L=2.5*S;if(u){var O=P.map((function(t){return te(t,u)}));P=O.some((function(t){return t.signedDistanceFromCamera<=0}))?[]:O.map((function(t){return t.point}))}var D=[];if(P.length>0){for(var N=P[0].clone(),z=P[0].clone(),F=1;F<P.length;F++)N.x=Math.min(N.x,P[F].x),N.y=Math.min(N.y,P[F].y),z.x=Math.max(z.x,P[F].x),z.y=Math.max(z.y,P[F].y);D=N.x>=A.x&&z.x<=T.x&&N.y>=A.y&&z.y<=T.y?[P]:z.x<A.x||N.x>T.x||z.y<A.y||N.y>T.y?[]:t.clipLine([P],A.x,A.y,T.x,T.y)}for(var B=0,U=D;B<U.length;B+=1){var j;C.reset(U[B],.25*S),j=C.length<=.5*S?1:Math.ceil(C.paddedLength/L)+1;for(var Z=0;Z<j;Z++){var V=Z/Math.max(j-1,1),G=C.lerp(V),H=G.x+100,W=G.y+100;d.push(H,W,S,0);var q=H-S,X=W-S,Y=H+S,K=W+S;if(E=E&&this.isOffscreen(q,X,Y,K),w=w||this.isInsideGrid(q,X,Y,K),!e&&this.grid.hitTestCircle(H,W,S,h)&&(b=!0,!c))return{circles:[],offscreen:!1,collisionDetected:b}}}}return{circles:!c&&b||!w?[]:d,offscreen:E,collisionDetected:b}},fe.prototype.queryRenderedSymbols=function(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};for(var n=[],r=1/0,i=1/0,o=-1/0,a=-1/0,s=0,u=e;s<u.length;s+=1){var c=u[s],l=new t.Point(c.x+100,c.y+100);r=Math.min(r,l.x),i=Math.min(i,l.y),o=Math.max(o,l.x),a=Math.max(a,l.y),n.push(l)}for(var h={},f={},p=0,d=this.grid.query(r,i,o,a).concat(this.ignoredGrid.query(r,i,o,a));p<d.length;p+=1){var v=d[p],m=v.key;if(void 0===h[m.bucketInstanceId]&&(h[m.bucketInstanceId]={}),!h[m.bucketInstanceId][m.featureIndex]){var g=[new t.Point(v.x1,v.y1),new t.Point(v.x2,v.y1),new t.Point(v.x2,v.y2),new t.Point(v.x1,v.y2)];t.polygonIntersectsPolygon(n,g)&&(h[m.bucketInstanceId][m.featureIndex]=!0,void 0===f[m.bucketInstanceId]&&(f[m.bucketInstanceId]=[]),f[m.bucketInstanceId].push(m.featureIndex))}}return f},fe.prototype.insertCollisionBox=function(t,e,n,r,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},t[0],t[1],t[2],t[3])},fe.prototype.insertCollisionCircles=function(t,e,n,r,i){for(var o=e?this.ignoredGrid:this.grid,a={bucketInstanceId:n,featureIndex:r,collisionGroupID:i},s=0;s<t.length;s+=4)o.insertCircle(a,t[s],t[s+1],t[s+2])},fe.prototype.projectAndGetPerspectiveRatio=function(e,n,r){var i=[n,r,0,1];return he(i,i,e),{point:new t.Point((i[0]/i[3]+1)/2*this.transform.width+100,(-i[1]/i[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/i[3]*.5}},fe.prototype.isOffscreen=function(t,e,n,r){return n<100||t>=this.screenRightBoundary||r<100||e>this.screenBottomBoundary},fe.prototype.isInsideGrid=function(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary},fe.prototype.getViewportMatrix=function(){var e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e};var de=function(t,e,n,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&n?1:0,this.placed=n};de.prototype.isHidden=function(){return 0===this.opacity&&!this.placed};var ve=function(t,e,n,r,i){this.text=new de(t?t.text:null,e,n,i),this.icon=new de(t?t.icon:null,e,r,i)};ve.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var me=function(t,e,n){this.text=t,this.icon=e,this.skipFade=n},ge=function(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]},ye=function(t,e,n,r,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i},_e=function(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}};function xe(e,n,r,i,o){var a=t.getAnchorAlignment(e),s=-(a.horizontalAlign-.5)*n,u=-(a.verticalAlign-.5)*r,c=t.evaluateVariableOffset(e,i);return new t.Point(s+c[0]*o,u+c[1]*o)}function be(e,n,r,i,o,a){var s=e.x1,u=e.x2,c=e.y1,l=e.y2,h=e.anchorPointX,f=e.anchorPointY,p=new t.Point(n,r);return i&&p._rotate(o?a:-a),{x1:s+p.x,y1:c+p.y,x2:u+p.x,y2:l+p.y,anchorPointX:h,anchorPointY:f}}_e.prototype.get=function(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){var e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:function(t){return t.collisionGroupID===e}}}return this.collisionGroups[t]};var we=function(t,e,n,r){this.transform=t.clone(),this.collisionIndex=new fe(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new _e(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}};function Ee(t,e,n,r,i){t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0)}we.prototype.getBucketParts=function(e,n,r,i){var o=r.getBucket(n),a=r.latestFeatureIndex;if(o&&a&&n.id===o.layerIds[0]){var s=r.collisionBoxArray,u=o.layers[0].layout,c=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),l=r.tileSize/t.EXTENT,h=this.transform.calculatePosMatrix(r.tileID.toUnwrapped()),f="map"===u.get("text-pitch-alignment"),p="map"===u.get("text-rotation-alignment"),d=pe(r,1,this.transform.zoom),v=Jt(h,f,p,this.transform,d),m=null;if(f){var g=$t(h,f,p,this.transform,d);m=t.multiply([],this.transform.labelPlaneMatrix,g)}this.retainedQueryData[o.bucketInstanceId]=new ye(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,r.tileID);var y={bucket:o,layout:u,posMatrix:h,textLabelPlaneMatrix:v,labelToScreenMatrix:m,scale:c,textPixelRatio:l,holdingForFade:r.holdingForFade(),collisionBoxArray:s,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(var _=0,x=o.sortKeyRanges;_<x.length;_+=1){var b=x[_];e.push({sortKey:b.sortKey,symbolInstanceStart:b.symbolInstanceStart,symbolInstanceEnd:b.symbolInstanceEnd,parameters:y})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:y})}},we.prototype.attemptAnchorPlacement=function(t,e,n,r,i,o,a,s,u,c,l,h,f,p,d){var v,m=[h.textOffset0,h.textOffset1],g=xe(t,n,r,m,i),y=this.collisionIndex.placeCollisionBox(be(e,g.x,g.y,o,a,this.transform.angle),l,s,u,c.predicate);if(!d||0!==this.collisionIndex.placeCollisionBox(be(d,g.x,g.y,o,a,this.transform.angle),l,s,u,c.predicate).box.length)return y.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(v=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:m,width:n,height:r,anchor:t,textBoxScale:i,prevAnchor:v},this.markUsedJustification(f,t,h,p),f.allowVerticalPlacement&&(this.markUsedOrientation(f,p,h),this.placedOrientations[h.crossTileID]=p),{shift:g,placedGlyphBoxes:y}):void 0},we.prototype.placeLayerBucketPart=function(e,n,r){var i=this,o=e.parameters,a=o.bucket,s=o.layout,u=o.posMatrix,c=o.textLabelPlaneMatrix,l=o.labelToScreenMatrix,h=o.textPixelRatio,f=o.holdingForFade,p=o.collisionBoxArray,d=o.partiallyEvaluatedTextSize,v=o.collisionGroup,m=s.get("text-optional"),g=s.get("icon-optional"),y=s.get("text-allow-overlap"),_=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),b="map"===s.get("text-pitch-alignment"),w="none"!==s.get("icon-text-fit"),E="viewport-y"===s.get("symbol-z-order"),S=y&&(_||!a.hasIconData()||g),A=_&&(y||!a.hasTextData()||m);!a.collisionArrays&&p&&a.deserializeCollisionBoxes(p);var T=function(e,o){if(!n[e.crossTileID])if(f)i.placements[e.crossTileID]=new me(!1,!1,!1);else{var p,E=!1,T=!1,C=!0,k=null,M={box:null,offscreen:null},P={box:null,offscreen:null},I=null,R=null,L=0,O=0,D=0;o.textFeatureIndex?L=o.textFeatureIndex:e.useRuntimeCollisionCircles&&(L=e.featureIndex),o.verticalTextFeatureIndex&&(O=o.verticalTextFeatureIndex);var N=o.textBox;if(N){var z=function(n){var r=t.WritingMode.horizontal;if(a.allowVerticalPlacement&&!n&&i.prevPlacement){var o=i.prevPlacement.placedOrientations[e.crossTileID];o&&(i.placedOrientations[e.crossTileID]=o,i.markUsedOrientation(a,r=o,e))}return r},F=function(n,r){if(a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&o.verticalTextBox)for(var i=0,s=a.writingModes;i<s.length&&(s[i]===t.WritingMode.vertical?(M=r(),P=M):M=n(),!(M&&M.box&&M.box.length));i+=1);else M=n()};if(s.get("text-variable-anchor")){var B=s.get("text-variable-anchor");if(i.prevPlacement&&i.prevPlacement.variableOffsets[e.crossTileID]){var U=i.prevPlacement.variableOffsets[e.crossTileID];B.indexOf(U.anchor)>0&&(B=B.filter((function(t){return t!==U.anchor}))).unshift(U.anchor)}var j=function(t,n,r){for(var o=t.x2-t.x1,s=t.y2-t.y1,c=e.textBoxScale,l=w&&!_?n:null,f={box:[],offscreen:!1},p=y?2*B.length:B.length,d=0;d<p;++d){var m=i.attemptAnchorPlacement(B[d%B.length],t,o,s,c,x,b,h,u,v,d>=B.length,e,a,r,l);if(m&&(f=m.placedGlyphBoxes)&&f.box&&f.box.length){E=!0,k=m.shift;break}}return f};F((function(){return j(N,o.iconBox,t.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&!(M&&M.box&&M.box.length)&&e.numVerticalGlyphVertices>0&&n?j(n,o.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null}})),M&&(E=M.box,C=M.offscreen);var Z=z(M&&M.box);if(!E&&i.prevPlacement){var V=i.prevPlacement.variableOffsets[e.crossTileID];V&&(i.variableOffsets[e.crossTileID]=V,i.markUsedJustification(a,V.anchor,e,Z))}}else{var G=function(t,n){var r=i.collisionIndex.placeCollisionBox(t,y,h,u,v.predicate);return r&&r.box&&r.box.length&&(i.markUsedOrientation(a,n,e),i.placedOrientations[e.crossTileID]=n),r};F((function(){return G(N,t.WritingMode.horizontal)}),(function(){var n=o.verticalTextBox;return a.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?G(n,t.WritingMode.vertical):{box:null,offscreen:null}})),z(M&&M.box&&M.box.length)}}if(E=(p=M)&&p.box&&p.box.length>0,C=p&&p.offscreen,e.useRuntimeCollisionCircles){var H=a.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex),W=t.evaluateSizeForFeature(a.textSizeData,d,H),q=s.get("text-padding");I=i.collisionIndex.placeCollisionCircles(y,H,a.lineVertexArray,a.glyphOffsetArray,W,u,c,l,r,b,v.predicate,e.collisionCircleDiameter,q),E=y||I.circles.length>0&&!I.collisionDetected,C=C&&I.offscreen}if(o.iconFeatureIndex&&(D=o.iconFeatureIndex),o.iconBox){var X=function(t){var e=w&&k?be(t,k.x,k.y,x,b,i.transform.angle):t;return i.collisionIndex.placeCollisionBox(e,_,h,u,v.predicate)};T=P&&P.box&&P.box.length&&o.verticalIconBox?(R=X(o.verticalIconBox)).box.length>0:(R=X(o.iconBox)).box.length>0,C=C&&R.offscreen}var Y=m||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,K=g||0===e.numIconVertices;if(Y||K?K?Y||(T=T&&E):E=T&&E:T=E=T&&E,E&&p&&p.box&&i.collisionIndex.insertCollisionBox(p.box,s.get("text-ignore-placement"),a.bucketInstanceId,P&&P.box&&O?O:L,v.ID),T&&R&&i.collisionIndex.insertCollisionBox(R.box,s.get("icon-ignore-placement"),a.bucketInstanceId,D,v.ID),I&&(E&&i.collisionIndex.insertCollisionCircles(I.circles,s.get("text-ignore-placement"),a.bucketInstanceId,L,v.ID),r)){var Q=a.bucketInstanceId,J=i.collisionCircleArrays[Q];void 0===J&&(J=i.collisionCircleArrays[Q]=new ge);for(var $=0;$<I.circles.length;$+=4)J.circles.push(I.circles[$+0]),J.circles.push(I.circles[$+1]),J.circles.push(I.circles[$+2]),J.circles.push(I.collisionDetected?1:0)}i.placements[e.crossTileID]=new me(E||S,T||A,C||a.justReloaded),n[e.crossTileID]=!0}};if(E)for(var C=a.getSortedSymbolIndexes(this.transform.angle),k=C.length-1;k>=0;--k){var M=C[k];T(a.symbolInstances.get(M),a.collisionArrays[M])}else for(var P=e.symbolInstanceStart;P<e.symbolInstanceEnd;P++)T(a.symbolInstances.get(P),a.collisionArrays[P]);if(r&&a.bucketInstanceId in this.collisionCircleArrays){var I=this.collisionCircleArrays[a.bucketInstanceId];t.invert(I.invProjMatrix,u),I.viewportMatrix=this.collisionIndex.getViewportMatrix()}a.justReloaded=!1},we.prototype.markUsedJustification=function(e,n,r,i){var o;o=i===t.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(n)];for(var a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];a<s.length;a+=1){var u=s[a];u>=0&&(e.text.placedSymbolArray.get(u).crossTileID=o>=0&&u!==o?0:r.crossTileID)}},we.prototype.markUsedOrientation=function(e,n,r){for(var i=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,o=n===t.WritingMode.vertical?n:0,a=0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];a<s.length;a+=1)e.text.placedSymbolArray.get(s[a]).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)},we.prototype.commit=function(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;var e=this.prevPlacement,n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;var r=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},o=e?e.variableOffsets:{},a=e?e.placedOrientations:{};for(var s in this.placements){var u=this.placements[s],c=i[s];c?(this.opacities[s]=new ve(c,r,u.text,u.icon),n=n||u.text!==c.text.placed||u.icon!==c.icon.placed):(this.opacities[s]=new ve(null,r,u.text,u.icon,u.skipFade),n=n||u.text||u.icon)}for(var l in i){var h=i[l];if(!this.opacities[l]){var f=new ve(h,r,!1,!1);f.isHidden()||(this.opacities[l]=f,n=n||h.text.placed||h.icon.placed)}}for(var p in o)this.variableOffsets[p]||!this.opacities[p]||this.opacities[p].isHidden()||(this.variableOffsets[p]=o[p]);for(var d in a)this.placedOrientations[d]||!this.opacities[d]||this.opacities[d].isHidden()||(this.placedOrientations[d]=a[d]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)},we.prototype.updateLayerOpacities=function(t,e){for(var n={},r=0,i=e;r<i.length;r+=1){var o=i[r],a=o.getBucket(t);a&&o.latestFeatureIndex&&t.id===a.layerIds[0]&&this.updateBucketOpacities(a,n,o.collisionBoxArray)}},we.prototype.updateBucketOpacities=function(e,n,r){var i=this;e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();var o=e.layers[0].layout,a=new ve(null,0,!1,!1,!0),s=o.get("text-allow-overlap"),u=o.get("icon-allow-overlap"),c=o.get("text-variable-anchor"),l="map"===o.get("text-rotation-alignment"),h="map"===o.get("text-pitch-alignment"),f="none"!==o.get("icon-text-fit"),p=new ve(null,0,s&&(u||!e.hasIconData()||o.get("icon-optional")),u&&(s||!e.hasTextData()||o.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);for(var d=function(t,e,n){for(var r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(n)},v=function(r){var o=e.symbolInstances.get(r),s=o.numHorizontalGlyphVertices,u=o.numVerticalGlyphVertices,v=o.crossTileID,m=i.opacities[v];n[v]?m=a:m||(i.opacities[v]=m=p),n[v]=!0;var g=o.numIconVertices>0,y=i.placedOrientations[o.crossTileID],_=y===t.WritingMode.vertical,x=y===t.WritingMode.horizontal||y===t.WritingMode.horizontalOnly;if(s>0||u>0){var b=Ie(m.text);d(e.text,s,_?Re:b),d(e.text,u,x?Re:b);var w=m.text.isHidden();[o.rightJustifiedTextSymbolIndex,o.centerJustifiedTextSymbolIndex,o.leftJustifiedTextSymbolIndex].forEach((function(t){t>=0&&(e.text.placedSymbolArray.get(t).hidden=w||_?1:0)})),o.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(o.verticalPlacedTextSymbolIndex).hidden=w||x?1:0);var E=i.variableOffsets[o.crossTileID];E&&i.markUsedJustification(e,E.anchor,o,y);var S=i.placedOrientations[o.crossTileID];S&&(i.markUsedJustification(e,"left",o,S),i.markUsedOrientation(e,S,o))}if(g){var A=Ie(m.icon),T=!(f&&o.verticalPlacedIconSymbolIndex&&_);o.placedIconSymbolIndex>=0&&(d(e.icon,o.numIconVertices,T?A:Re),e.icon.placedSymbolArray.get(o.placedIconSymbolIndex).hidden=m.icon.isHidden()),o.verticalPlacedIconSymbolIndex>=0&&(d(e.icon,o.numVerticalIconVertices,T?Re:A),e.icon.placedSymbolArray.get(o.verticalPlacedIconSymbolIndex).hidden=m.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){var C=e.collisionArrays[r];if(C){var k=new t.Point(0,0);if(C.textBox||C.verticalTextBox){var M=!0;if(c){var P=i.variableOffsets[v];P?(k=xe(P.anchor,P.width,P.height,P.textOffset,P.textBoxScale),l&&k._rotate(h?i.transform.angle:-i.transform.angle)):M=!1}C.textBox&&Ee(e.textCollisionBox.collisionVertexArray,m.text.placed,!M||_,k.x,k.y),C.verticalTextBox&&Ee(e.textCollisionBox.collisionVertexArray,m.text.placed,!M||x,k.x,k.y)}var I=Boolean(!x&&C.verticalIconBox);C.iconBox&&Ee(e.iconCollisionBox.collisionVertexArray,m.icon.placed,I,f?k.x:0,f?k.y:0),C.verticalIconBox&&Ee(e.iconCollisionBox.collisionVertexArray,m.icon.placed,!I,f?k.x:0,f?k.y:0)}}},m=0;m<e.symbolInstances.length;m++)v(m);if(e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){var g=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=g.invProjMatrix,e.placementViewportMatrix=g.viewportMatrix,e.collisionCircleArray=g.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}},we.prototype.symbolFadeChange=function(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},we.prototype.zoomAdjustment=function(t){return Math.max(0,(this.transform.zoom-t)/1.5)},we.prototype.hasTransitions=function(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration},we.prototype.stillRecent=function(t,e){var n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t},we.prototype.setStale=function(){this.stale=!0};var Se=Math.pow(2,25),Ae=Math.pow(2,24),Te=Math.pow(2,17),Ce=Math.pow(2,16),ke=Math.pow(2,9),Me=Math.pow(2,8),Pe=Math.pow(2,1);function Ie(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;var e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*Se+e*Ae+n*Te+e*Ce+n*ke+e*Me+n*Pe+e}var Re=0,Le=function(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Le.prototype.continuePlacement=function(t,e,n,r,i){for(var o=this._bucketParts;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((function(t,e){return t.sortKey-e.sortKey})));this._currentPartIndex<o.length;)if(e.placeLayerBucketPart(o[this._currentPartIndex],this._seenCrossTileIDs,n),this._currentPartIndex++,i())return!0;return!1};var Oe=function(t,e,n,r,i,o,a){this.placement=new we(t,i,o,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1};Oe.prototype.isDone=function(){return this._done},Oe.prototype.continuePlacement=function(e,n,r){for(var i=this,o=t.browser.now(),a=function(){var e=t.browser.now()-o;return!i._forceFullPlacement&&e>2};this._currentPlacementIndex>=0;){var s=n[e[this._currentPlacementIndex]],u=this.placement.collisionIndex.transform.zoom;if("symbol"===s.type&&(!s.minzoom||s.minzoom<=u)&&(!s.maxzoom||s.maxzoom>u)){if(this._inProgressLayer||(this._inProgressLayer=new Le(s)),this._inProgressLayer.continuePlacement(r[s.source],this.placement,this._showCollisionBoxes,s,a))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Oe.prototype.commit=function(t){return this.placement.commit(t),this.placement};var De=512/t.EXTENT/2,Ne=function(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(var r=0;r<e.length;r++){var i=e.get(r),o=i.key;this.indexedSymbolInstances[o]||(this.indexedSymbolInstances[o]=[]),this.indexedSymbolInstances[o].push({crossTileID:i.crossTileID,coord:this.getScaledCoordinates(i,t)})}};Ne.prototype.getScaledCoordinates=function(e,n){var r=De/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*t.EXTENT+e.anchorX)*r),y:Math.floor((n.canonical.y*t.EXTENT+e.anchorY)*r)}},Ne.prototype.findMatches=function(t,e,n){for(var r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z),i=0;i<t.length;i++){var o=t.get(i);if(!o.crossTileID){var a=this.indexedSymbolInstances[o.key];if(a)for(var s=this.getScaledCoordinates(o,e),u=0,c=a;u<c.length;u+=1){var l=c[u];if(Math.abs(l.coord.x-s.x)<=r&&Math.abs(l.coord.y-s.y)<=r&&!n[l.crossTileID]){n[l.crossTileID]=!0,o.crossTileID=l.crossTileID;break}}}}};var ze=function(){this.maxCrossTileID=0};ze.prototype.generate=function(){return++this.maxCrossTileID};var Fe=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};Fe.prototype.handleWrapJump=function(t){var e=Math.round((t-this.lng)/360);if(0!==e)for(var n in this.indexes){var r=this.indexes[n],i={};for(var o in r){var a=r[o];a.tileID=a.tileID.unwrapTo(a.tileID.wrap+e),i[a.tileID.key]=a}this.indexes[n]=i}this.lng=t},Fe.prototype.addBucket=function(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(var r=0;r<e.symbolInstances.length;r++)e.symbolInstances.get(r).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});var i=this.usedCrossTileIDs[t.overscaledZ];for(var o in this.indexes){var a=this.indexes[o];if(Number(o)>t.overscaledZ)for(var s in a){var u=a[s];u.tileID.isChildOf(t)&&u.findMatches(e.symbolInstances,t,i)}else{var c=a[t.scaledTo(Number(o)).key];c&&c.findMatches(e.symbolInstances,t,i)}}for(var l=0;l<e.symbolInstances.length;l++){var h=e.symbolInstances.get(l);h.crossTileID||(h.crossTileID=n.generate(),i[h.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Ne(t,e.symbolInstances,e.bucketInstanceId),!0},Fe.prototype.removeBucketCrossTileIDs=function(t,e){for(var n in e.indexedSymbolInstances)for(var r=0,i=e.indexedSymbolInstances[n];r<i.length;r+=1)delete this.usedCrossTileIDs[t][i[r].crossTileID]},Fe.prototype.removeStaleBuckets=function(t){var e=!1;for(var n in this.indexes){var r=this.indexes[n];for(var i in r)t[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],e=!0)}return e};var Be=function(){this.layerIndexes={},this.crossTileIDs=new ze,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Be.prototype.addLayer=function(t,e,n){var r=this.layerIndexes[t.id];void 0===r&&(r=this.layerIndexes[t.id]=new Fe);var i=!1,o={};r.handleWrapJump(n);for(var a=0,s=e;a<s.length;a+=1){var u=s[a],c=u.getBucket(t);c&&t.id===c.layerIds[0]&&(c.bucketInstanceId||(c.bucketInstanceId=++this.maxBucketInstanceId),r.addBucket(u.tileID,c,this.crossTileIDs)&&(i=!0),o[c.bucketInstanceId]=!0)}return r.removeStaleBuckets(o)&&(i=!0),i},Be.prototype.pruneUnusedLayers=function(t){var e={};for(var n in t.forEach((function(t){e[t]=!0})),this.layerIndexes)e[n]||delete this.layerIndexes[n]};var Ue=function(e,n){return t.emitValidationErrors(e,n&&n.filter((function(t){return"source.canvas"!==t.identifier})))},je=t.pick(Zt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ze=t.pick(Zt,["setCenter","setZoom","setBearing","setPitch"]),Ve=function(){var e={},n=t.styleSpec.$version;for(var r in t.styleSpec.$root){var i,o=t.styleSpec.$root[r];o.required&&null!=(i="version"===r?n:"array"===o.type?[]:{})&&(e[r]=i)}return e}(),Ge=function(e){function n(r,i){var o=this;void 0===i&&(i={}),e.call(this),this.map=r,this.dispatcher=new A(Bt(),this),this.imageManager=new p,this.imageManager.setEventedParent(this),this.glyphManager=new x(r._requestManager,i.localIdeographFontFamily),this.lineAtlas=new S(256,512),this.crossTileSymbolIndex=new Be,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());var a=this;this._rtlTextPluginCallback=n.registerForPluginStateChange((function(e){a.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(function(e,n){if(t.triggerPluginCompletionEvent(e),n&&n.every((function(t){return t})))for(var r in a.sourceCaches)a.sourceCaches[r].reload()}))})),this.on("data",(function(t){if("source"===t.dataType&&"metadata"===t.sourceDataType){var e=o.sourceCaches[t.sourceId];if(e){var n=e.getSource();if(n&&n.vectorLayerIds)for(var r in o._layers){var i=o._layers[r];i.source===n.id&&o._validateLayer(i)}}}}))}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.loadURL=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"}));var i="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);var o=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(o,(function(e,n){r._request=null,e?r.fire(new t.ErrorEvent(e)):n&&r._load(n,i)}))},n.prototype.loadJSON=function(e,n){var r=this;void 0===n&&(n={}),this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.browser.frame((function(){r._request=null,r._load(e,!1!==n.validate)}))},n.prototype.loadEmpty=function(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(Ve,!1)},n.prototype._load=function(e,n){if(!n||!Ue(this,t.validateStyle(e))){for(var r in this._loaded=!0,this.stylesheet=e,e.sources)this.addSource(r,e.sources[r],{validate:!1});e.sprite?this._loadSprite(e.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(e.glyphs);var i=jt(this.stylesheet.layers);this._order=i.map((function(t){return t.id})),this._layers={},this._serializedLayers={};for(var o=0,a=i;o<a.length;o+=1){var s=a[o];(s=t.createStyleLayer(s)).setEventedParent(this,{layer:{id:s.id}}),this._layers[s.id]=s,this._serializedLayers[s.id]=s.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new E(this.stylesheet.light),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}},n.prototype._loadSprite=function(e){var n=this;this._spriteRequest=function(e,n,r){var i,o,a,s=t.browser.devicePixelRatio>1?"@2x":"",u=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,s,".json"),t.ResourceType.SpriteJSON),(function(t,e){u=null,a||(a=t,i=e,l())})),c=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,s,".png"),t.ResourceType.SpriteImage),(function(t,e){c=null,a||(a=t,o=e,l())}));function l(){if(a)r(a);else if(i&&o){var e=t.browser.getImageData(o),n={};for(var s in i){var u=i[s],c=u.width,l=u.height,h=u.x,f=u.y,p=u.sdf,d=u.pixelRatio,v=u.stretchX,m=u.stretchY,g=u.content,y=new t.RGBAImage({width:c,height:l});t.RGBAImage.copy(e,y,{x:h,y:f},{x:0,y:0},{width:c,height:l}),n[s]={data:y,pixelRatio:d,sdf:p,stretchX:v,stretchY:m,content:g}}r(null,n)}}return{cancel:function(){u&&(u.cancel(),u=null),c&&(c.cancel(),c=null)}}}(e,this.map._requestManager,(function(e,r){if(n._spriteRequest=null,e)n.fire(new t.ErrorEvent(e));else if(r)for(var i in r)n.imageManager.addImage(i,r[i]);n.imageManager.setLoaded(!0),n._availableImages=n.imageManager.listImages(),n.dispatcher.broadcast("setImages",n._availableImages),n.fire(new t.Event("data",{dataType:"style"}))}))},n.prototype._validateLayer=function(e){var n=this.sourceCaches[e.source];if(n){var r=e.sourceLayer;if(r){var i=n.getSource();("geojson"===i.type||i.vectorLayerIds&&-1===i.vectorLayerIds.indexOf(r))&&this.fire(new t.ErrorEvent(new Error('Source layer "'+r+'" does not exist on source "'+i.id+'" as specified by style layer "'+e.id+'"')))}}},n.prototype.loaded=function(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(var t in this.sourceCaches)if(!this.sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()},n.prototype._serializeLayers=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=this._layers[r[n]];"custom"!==i.type&&e.push(i.serialize())}return e},n.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var t in this.sourceCaches)if(this.sourceCaches[t].hasTransition())return!0;for(var e in this._layers)if(this._layers[e].hasTransition())return!0;return!1},n.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},n.prototype.update=function(e){if(this._loaded){var n=this._changed;if(this._changed){var r=Object.keys(this._updatedLayers),i=Object.keys(this._removedLayers);for(var o in(r.length||i.length)&&this._updateWorkerLayers(r,i),this._updatedSources){var a=this._updatedSources[o];"reload"===a?this._reloadSource(o):"clear"===a&&this._clearSource(o)}for(var s in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[s].updateTransitions(e);this.light.updateTransitions(e),this._resetUpdates()}var u={};for(var c in this.sourceCaches){var l=this.sourceCaches[c];u[c]=l.used,l.used=!1}for(var h=0,f=this._order;h<f.length;h+=1){var p=this._layers[f[h]];p.recalculate(e,this._availableImages),!p.isHidden(e.zoom)&&p.source&&(this.sourceCaches[p.source].used=!0)}for(var d in u){var v=this.sourceCaches[d];u[d]!==v.used&&v.fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:d}))}this.light.recalculate(e),this.z=e.zoom,n&&this.fire(new t.Event("data",{dataType:"style"}))}},n.prototype._updateTilesForChangedImages=function(){var t=Object.keys(this._changedImages);if(t.length){for(var e in this.sourceCaches)this.sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}},n.prototype._updateWorkerLayers=function(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})},n.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},n.prototype.setState=function(e){var n=this;if(this._checkLoaded(),Ue(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=jt(e.layers);var r=function(e,n){if(!e)return[{command:Zt.setStyle,args:[n]}];var r=[];try{if(!t.deepEqual(e.version,n.version))return[{command:Zt.setStyle,args:[n]}];t.deepEqual(e.center,n.center)||r.push({command:Zt.setCenter,args:[n.center]}),t.deepEqual(e.zoom,n.zoom)||r.push({command:Zt.setZoom,args:[n.zoom]}),t.deepEqual(e.bearing,n.bearing)||r.push({command:Zt.setBearing,args:[n.bearing]}),t.deepEqual(e.pitch,n.pitch)||r.push({command:Zt.setPitch,args:[n.pitch]}),t.deepEqual(e.sprite,n.sprite)||r.push({command:Zt.setSprite,args:[n.sprite]}),t.deepEqual(e.glyphs,n.glyphs)||r.push({command:Zt.setGlyphs,args:[n.glyphs]}),t.deepEqual(e.transition,n.transition)||r.push({command:Zt.setTransition,args:[n.transition]}),t.deepEqual(e.light,n.light)||r.push({command:Zt.setLight,args:[n.light]});var i={},o=[];!function(e,n,r,i){var o;for(o in n=n||{},e=e||{})e.hasOwnProperty(o)&&(n.hasOwnProperty(o)||Gt(o,r,i));for(o in n)n.hasOwnProperty(o)&&(e.hasOwnProperty(o)?t.deepEqual(e[o],n[o])||("geojson"===e[o].type&&"geojson"===n[o].type&&Wt(e,n,o)?r.push({command:Zt.setGeoJSONSourceData,args:[o,n[o].data]}):Ht(o,n,r,i)):Vt(o,n,r))}(e.sources,n.sources,o,i);var a=[];e.layers&&e.layers.forEach((function(t){i[t.source]?r.push({command:Zt.removeLayer,args:[t.id]}):a.push(t)})),r=r.concat(o),function(e,n,r){n=n||[];var i,o,a,s,u,c,l,h=(e=e||[]).map(Xt),f=n.map(Xt),p=e.reduce(Yt,{}),d=n.reduce(Yt,{}),v=h.slice(),m=Object.create(null);for(i=0,o=0;i<h.length;i++)d.hasOwnProperty(a=h[i])?o++:(r.push({command:Zt.removeLayer,args:[a]}),v.splice(v.indexOf(a,o),1));for(i=0,o=0;i<f.length;i++)v[v.length-1-i]!==(a=f[f.length-1-i])&&(p.hasOwnProperty(a)?(r.push({command:Zt.removeLayer,args:[a]}),v.splice(v.lastIndexOf(a,v.length-o),1)):o++,r.push({command:Zt.addLayer,args:[d[a],c=v[v.length-i]]}),v.splice(v.length-i,0,a),m[a]=!0);for(i=0;i<f.length;i++)if(s=p[a=f[i]],u=d[a],!m[a]&&!t.deepEqual(s,u))if(t.deepEqual(s.source,u.source)&&t.deepEqual(s["source-layer"],u["source-layer"])&&t.deepEqual(s.type,u.type)){for(l in qt(s.layout,u.layout,r,a,null,Zt.setLayoutProperty),qt(s.paint,u.paint,r,a,null,Zt.setPaintProperty),t.deepEqual(s.filter,u.filter)||r.push({command:Zt.setFilter,args:[a,u.filter]}),t.deepEqual(s.minzoom,u.minzoom)&&t.deepEqual(s.maxzoom,u.maxzoom)||r.push({command:Zt.setLayerZoomRange,args:[a,u.minzoom,u.maxzoom]}),s)s.hasOwnProperty(l)&&"layout"!==l&&"paint"!==l&&"filter"!==l&&"metadata"!==l&&"minzoom"!==l&&"maxzoom"!==l&&(0===l.indexOf("paint.")?qt(s[l],u[l],r,a,l.slice(6),Zt.setPaintProperty):t.deepEqual(s[l],u[l])||r.push({command:Zt.setLayerProperty,args:[a,l,u[l]]}));for(l in u)u.hasOwnProperty(l)&&!s.hasOwnProperty(l)&&"layout"!==l&&"paint"!==l&&"filter"!==l&&"metadata"!==l&&"minzoom"!==l&&"maxzoom"!==l&&(0===l.indexOf("paint.")?qt(s[l],u[l],r,a,l.slice(6),Zt.setPaintProperty):t.deepEqual(s[l],u[l])||r.push({command:Zt.setLayerProperty,args:[a,l,u[l]]}))}else r.push({command:Zt.removeLayer,args:[a]}),c=v[v.lastIndexOf(a)+1],r.push({command:Zt.addLayer,args:[u,c]})}(a,n.layers,r)}catch(t){r=[{command:Zt.setStyle,args:[n]}]}return r}(this.serialize(),e).filter((function(t){return!(t.command in Ze)}));if(0===r.length)return!1;var i=r.filter((function(t){return!(t.command in je)}));if(i.length>0)throw new Error("Unimplemented: "+i.map((function(t){return t.command})).join(", ")+".");return r.forEach((function(t){"setTransition"!==t.command&&n[t.command].apply(n,t.args)})),this.stylesheet=e,!0},n.prototype.addImage=function(e,n){if(this.getImage(e))return this.fire(new t.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(e,n),this._afterImageUpdated(e)},n.prototype.updateImage=function(t,e){this.imageManager.updateImage(t,e)},n.prototype.getImage=function(t){return this.imageManager.getImage(t)},n.prototype.removeImage=function(e){if(!this.getImage(e))return this.fire(new t.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(e),this._afterImageUpdated(e)},n.prototype._afterImageUpdated=function(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))},n.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},n.prototype.addSource=function(e,n,r){var i=this;if(void 0===r&&(r={}),this._checkLoaded(),void 0!==this.sourceCaches[e])throw new Error("There is already a source with this ID");if(!n.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(n).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateStyle.source,"sources."+e,n,null,r))){this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);var o=this.sourceCaches[e]=new It(e,n,this.dispatcher);o.style=this,o.setEventedParent(this,(function(){return{isSourceLoaded:i.loaded(),source:o.serialize(),sourceId:e}})),o.onAdd(this.map),this._changed=!0}},n.prototype.removeSource=function(e){if(this._checkLoaded(),void 0===this.sourceCaches[e])throw new Error("There is no source with this ID");for(var n in this._layers)if(this._layers[n].source===e)return this.fire(new t.ErrorEvent(new Error('Source "'+e+'" cannot be removed while layer "'+n+'" is using it.')));var r=this.sourceCaches[e];delete this.sourceCaches[e],delete this._updatedSources[e],r.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:e})),r.setEventedParent(null),r.clearTiles(),r.onRemove&&r.onRemove(this.map),this._changed=!0},n.prototype.setGeoJSONSourceData=function(t,e){this._checkLoaded(),this.sourceCaches[t].getSource().setData(e),this._changed=!0},n.prototype.getSource=function(t){return this.sourceCaches[t]&&this.sourceCaches[t].getSource()},n.prototype.addLayer=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=e.id;if(this.getLayer(i))this.fire(new t.ErrorEvent(new Error('Layer with id "'+i+'" already exists on this map')));else{var a;if("custom"===e.type){if(Ue(this,t.validateCustomStyleLayer(e)))return;a=t.createStyleLayer(e)}else{if("object"==o(e.source)&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateStyle.layer,"layers."+i,e,{arrayIndex:-1},r))return;a=t.createStyleLayer(e),this._validateLayer(a),a.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[a.id]=a.serialize()}var s=n?this._order.indexOf(n):this._order.length;if(n&&-1===s)this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.')));else{if(this._order.splice(s,0,i),this._layerOrderChanged=!0,this._layers[i]=a,this._removedLayers[i]&&a.source&&"custom"!==a.type){var u=this._removedLayers[i];delete this._removedLayers[i],u.type!==a.type?this._updatedSources[a.source]="clear":(this._updatedSources[a.source]="reload",this.sourceCaches[a.source].pause())}this._updateLayer(a),a.onAdd&&a.onAdd(this.map)}}},n.prototype.moveLayer=function(e,n){if(this._checkLoaded(),this._changed=!0,this._layers[e]){if(e!==n){var r=this._order.indexOf(e);this._order.splice(r,1);var i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new t.ErrorEvent(new Error('Layer with id "'+n+'" does not exist on this map.'))):(this._order.splice(i,0,e),this._layerOrderChanged=!0)}}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be moved.")))},n.prototype.removeLayer=function(e){this._checkLoaded();var n=this._layers[e];if(n){n.setEventedParent(null);var r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map)}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be removed.")))},n.prototype.getLayer=function(t){return this._layers[t]},n.prototype.hasLayer=function(t){return t in this._layers},n.prototype.setLayerZoomRange=function(e,n,r){this._checkLoaded();var i=this.getLayer(e);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot have zoom extent.")))},n.prototype.setFilter=function(e,n,r){void 0===r&&(r={}),this._checkLoaded();var i=this.getLayer(e);if(i){if(!t.deepEqual(i.filter,n))return null==n?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(t.validateStyle.filter,"layers."+i.id+".filter",n,null,r)||(i.filter=t.clone$1(n),this._updateLayer(i)))}else this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be filtered.")))},n.prototype.getFilter=function(e){return t.clone$1(this.getLayer(e).filter)},n.prototype.setLayoutProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getLayoutProperty(n),r)||(o.setLayoutProperty(n,r,i),this._updateLayer(o)):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getLayoutProperty=function(e,n){var r=this.getLayer(e);if(r)return r.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style.")))},n.prototype.setPaintProperty=function(e,n,r,i){void 0===i&&(i={}),this._checkLoaded();var o=this.getLayer(e);o?t.deepEqual(o.getPaintProperty(n),r)||(o.setPaintProperty(n,r,i)&&this._updateLayer(o),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error("The layer '"+e+"' does not exist in the map's style and cannot be styled.")))},n.prototype.getPaintProperty=function(t,e){return this.getLayer(t).getPaintProperty(e)},n.prototype.setFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=e.sourceLayer,o=this.sourceCaches[r];if(void 0!==o){var a=o.getSource().type;"geojson"===a&&i?this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):"vector"!==a||i?(void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),o.setFeatureState(i,e.id,n)):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.removeFeatureState=function(e,n){this._checkLoaded();var r=e.source,i=this.sourceCaches[r];if(void 0!==i){var o=i.getSource().type,a="vector"===o?e.sourceLayer:void 0;"vector"!==o||a?n&&"string"!=typeof e.id&&"number"!=typeof e.id?this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):i.removeFeatureState(a,e.id,n):this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+r+"' does not exist in the map's style.")))},n.prototype.getFeatureState=function(e){this._checkLoaded();var n=e.source,r=e.sourceLayer,i=this.sourceCaches[n];if(void 0!==i){if("vector"!==i.getSource().type||r)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),i.getFeatureState(r,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error("The source '"+n+"' does not exist in the map's style.")))},n.prototype.getTransition=function(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},n.prototype.serialize=function(){return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:t.mapObject(this.sourceCaches,(function(t){return t.serialize()})),layers:this._serializeLayers(this._order)},(function(t){return void 0!==t}))},n.prototype._updateLayer=function(t){this._updatedLayers[t.id]=!0,t.source&&!this._updatedSources[t.source]&&"raster"!==this.sourceCaches[t.source].getSource().type&&(this._updatedSources[t.source]="reload",this.sourceCaches[t.source].pause()),this._changed=!0},n.prototype._flattenAndSortRenderedFeatures=function(t){for(var e=this,n=function(t){return"fill-extrusion"===e._layers[t].type},r={},i=[],o=this._order.length-1;o>=0;o--){var a=this._order[o];if(n(a)){r[a]=o;for(var s=0,u=t;s<u.length;s+=1){var c=u[s][a];if(c)for(var l=0,h=c;l<h.length;l+=1)i.push(h[l])}}}i.sort((function(t,e){return e.intersectionZ-t.intersectionZ}));for(var f=[],p=this._order.length-1;p>=0;p--){var d=this._order[p];if(n(d))for(var v=i.length-1;v>=0;v--){var m=i[v].feature;if(r[m.layer.id]<p)break;f.push(m),i.pop()}else for(var g=0,y=t;g<y.length;g+=1){var _=y[g][d];if(_)for(var x=0,b=_;x<b.length;x+=1)f.push(b[x].feature)}}return f},n.prototype.queryRenderedFeatures=function(e,n,r){n&&n.filter&&this._validate(t.validateStyle.filter,"queryRenderedFeatures.filter",n.filter,null,n);var i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var o=0,a=n.layers;o<a.length;o+=1){var s=a[o],u=this._layers[s];if(!u)return this.fire(new t.ErrorEvent(new Error("The layer '"+s+"' does not exist in the map's style and cannot be queried for features."))),[];i[u.source]=!0}}var c=[];for(var l in n.availableImages=this._availableImages,this.sourceCaches)n.layers&&!i[l]||c.push(F(this.sourceCaches[l],this._layers,this._serializedLayers,e,n,r));return this.placement&&c.push(function(t,e,n,r,i,o,a){for(var s={},u=o.queryRenderedSymbols(r),c=[],l=0,h=Object.keys(u).map(Number);l<h.length;l+=1)c.push(a[h[l]]);c.sort(B);for(var f=function(){var n=d[p],r=n.featureIndex.lookupSymbolFeatures(u[n.bucketInstanceId],e,n.bucketIndex,n.sourceLayerIndex,i.filter,i.layers,i.availableImages,t);for(var o in r){var a=s[o]=s[o]||[],c=r[o];c.sort((function(t,e){var r=n.featureSortOrder;if(r){var i=r.indexOf(t.featureIndex);return r.indexOf(e.featureIndex)-i}return e.featureIndex-t.featureIndex}));for(var l=0,h=c;l<h.length;l+=1)a.push(h[l])}},p=0,d=c;p<d.length;p+=1)f();var v=function(e){s[e].forEach((function(r){var i=r.feature,o=n[t[e].source].getFeatureState(i.layer["source-layer"],i.id);i.source=i.layer.source,i.layer["source-layer"]&&(i.sourceLayer=i.layer["source-layer"]),i.state=o}))};for(var m in s)v(m);return s}(this._layers,this._serializedLayers,this.sourceCaches,e,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(c)},n.prototype.querySourceFeatures=function(e,n){n&&n.filter&&this._validate(t.validateStyle.filter,"querySourceFeatures.filter",n.filter,null,n);var r=this.sourceCaches[e];return r?function(t,e){for(var n=t.getRenderableIds().map((function(e){return t.getTileByID(e)})),r=[],i={},o=0;o<n.length;o++){var a=n[o],s=a.tileID.canonical.key;i[s]||(i[s]=!0,a.querySourceFeatures(r,e))}return r}(r,n):[]},n.prototype.addSourceType=function(t,e,r){return n.getSourceType(t)?r(new Error('A source type called "'+t+'" already exists.')):(n.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},r):r(null,null))},n.prototype.getLight=function(){return this.light.getLight()},n.prototype.setLight=function(e,n){void 0===n&&(n={}),this._checkLoaded();var r=this.light.getLight(),i=!1;for(var o in e)if(!t.deepEqual(e[o],r[o])){i=!0;break}if(i){var a={now:t.browser.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(a)}},n.prototype._validate=function(e,n,r,i,o){return void 0===o&&(o={}),(!o||!1!==o.validate)&&Ue(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:r,styleSpec:t.styleSpec},i)))},n.prototype._remove=function(){for(var e in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[e].setEventedParent(null);for(var n in this.sourceCaches)this.sourceCaches[n].clearTiles(),this.sourceCaches[n].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},n.prototype._clearSource=function(t){this.sourceCaches[t].clearTiles()},n.prototype._reloadSource=function(t){this.sourceCaches[t].resume(),this.sourceCaches[t].reload()},n.prototype._updateSources=function(t){for(var e in this.sourceCaches)this.sourceCaches[e].update(t)},n.prototype._generateCollisionBoxes=function(){for(var t in this.sourceCaches)this._reloadSource(t)},n.prototype._updatePlacement=function(e,n,r,i,o){void 0===o&&(o=!1);for(var a=!1,s=!1,u={},c=0,l=this._order;c<l.length;c+=1){var h=this._layers[l[c]];if("symbol"===h.type){if(!u[h.source]){var f=this.sourceCaches[h.source];u[h.source]=f.getRenderableIds(!0).map((function(t){return f.getTileByID(t)})).sort((function(t,e){return e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1)}))}var p=this.crossTileSymbolIndex.addLayer(h,u[h.source],e.center.lng);a=a||p}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((o=o||this._layerOrderChanged||0===r)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.browser.now(),e.zoom))&&(this.pauseablePlacement=new Oe(e,this._order,o,n,r,i,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,u),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.browser.now()),s=!0),a&&this.pauseablePlacement.placement.setStale()),s||a)for(var d=0,v=this._order;d<v.length;d+=1){var m=this._layers[v[d]];"symbol"===m.type&&this.placement.updateLayerOpacities(m,u[m.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.browser.now())},n.prototype._releaseSymbolFadeTiles=function(){for(var t in this.sourceCaches)this.sourceCaches[t].releaseSymbolFadeTiles()},n.prototype.getImages=function(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();var r=this.sourceCaches[e.source];r&&r.setDependencies(e.tileID.key,e.type,e.icons)},n.prototype.getGlyphs=function(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)},n.prototype.getResource=function(e,n,r){return t.makeRequest(n,r)},n}(t.Evented);Ge.getSourceType=function(t){return N[t]},Ge.setSourceType=function(t,e){N[t]=e},Ge.registerForPluginStateChange=t.registerForPluginStateChange;var He=t.createLayout([{name:"a_pos",type:"Int16",components:2}]),We=_n("#ifdef GL_ES\nprecision mediump float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif","#ifdef GL_ES\nprecision highp float;\n#else\n#if !defined(lowp)\n#define lowp\n#endif\n#if !defined(mediump)\n#define mediump\n#endif\n#if !defined(highp)\n#define highp\n#endif\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}"),qe=_n("uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Xe=_n("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),Ye=_n("varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}"),Ke=_n("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Qe=_n("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}"),Je=_n("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),$e=_n("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),tn=_n("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),en=_n("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),nn=_n("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_FragColor=color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);}"),rn=_n("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),on=_n("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}"),an=_n("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}"),sn=_n("varying vec4 v_color;void main() {gl_FragColor=v_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}"),un=_n("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0\n? a_pos\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}"),cn=_n("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),ln=_n("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;\n#define PI 3.141592653589793\nvoid main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),hn=_n("uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),fn=_n("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}"),pn=_n("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}"),dn=_n("uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\n#define LINE_DISTANCE_SCALE 2.0\nattribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}"),vn=_n("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),mn=_n("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}"),gn=_n("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}"),yn=_n("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}");function _n(t,e){var n=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,r=e.match(/attribute ([\w]+) ([\w]+)/g),i=t.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),o=e.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),a=o?o.concat(i):i,s={};return{fragmentSource:t=t.replace(n,(function(t,e,n,r,i){return s[i]=!0,"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"\n#ifdef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),vertexSource:e=e.replace(n,(function(t,e,n,r,i){var o="float"===r?"vec2":"vec4",a=i.match(/color/)?"color":o;return s[i]?"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\nvarying "+n+" "+r+" "+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"define"===e?"\n#ifndef HAS_UNIFORM_u_"+i+"\nuniform lowp float u_"+i+"_t;\nattribute "+n+" "+o+" a_"+i+";\n#else\nuniform "+n+" "+r+" u_"+i+";\n#endif\n":"vec4"===a?"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = a_"+i+";\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n":"\n#ifndef HAS_UNIFORM_u_"+i+"\n    "+n+" "+r+" "+i+" = unpack_mix_"+a+"(a_"+i+", u_"+i+"_t);\n#else\n    "+n+" "+r+" "+i+" = u_"+i+";\n#endif\n"})),staticAttributes:r,staticUniforms:a}}var xn=Object.freeze({__proto__:null,prelude:We,background:qe,backgroundPattern:Xe,circle:Ye,clippingMask:Ke,heatmap:Qe,heatmapTexture:Je,collisionBox:$e,collisionCircle:tn,debug:en,fill:nn,fillOutline:rn,fillOutlinePattern:on,fillPattern:an,fillExtrusion:sn,fillExtrusionPattern:un,hillshadePrepare:cn,hillshade:ln,line:hn,lineGradient:fn,linePattern:pn,lineSDF:dn,raster:vn,symbolIcon:mn,symbolSDF:gn,symbolTextAndIcon:yn}),bn=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function wn(t){for(var e=[],n=0;n<t.length;n++)if(null!==t[n]){var r=t[n].split(" ");e.push(r.pop())}return e}bn.prototype.bind=function(t,e,n,r,i,o,a,s){this.context=t;for(var u=this.boundPaintVertexBuffers.length!==r.length,c=0;!u&&c<r.length;c++)this.boundPaintVertexBuffers[c]!==r[c]&&(u=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===n&&!u&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===a&&this.boundDynamicVertexBuffer2===s?(t.bindVertexArrayOES.set(this.vao),a&&a.bind(),i&&i.dynamicDraw&&i.bind(),s&&s.bind()):this.freshBind(e,n,r,i,o,a,s)},bn.prototype.freshBind=function(t,e,n,r,i,o,a){var s,u=t.numAttributes,c=this.context,l=c.gl;if(c.extVertexArrayObject)this.vao&&this.destroy(),this.vao=c.extVertexArrayObject.createVertexArrayOES(),c.bindVertexArrayOES.set(this.vao),s=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=a;else{s=c.currentNumAttributes||0;for(var h=u;h<s;h++)l.disableVertexAttribArray(h)}e.enableAttributes(l,t);for(var f=0,p=n;f<p.length;f+=1)p[f].enableAttributes(l,t);o&&o.enableAttributes(l,t),a&&a.enableAttributes(l,t),e.bind(),e.setVertexAttribPointers(l,t,i);for(var d=0,v=n;d<v.length;d+=1){var m=v[d];m.bind(),m.setVertexAttribPointers(l,t,i)}o&&(o.bind(),o.setVertexAttribPointers(l,t,i)),r&&r.bind(),a&&(a.bind(),a.setVertexAttribPointers(l,t,i)),c.currentNumAttributes=u},bn.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var En=function(t,e,n,r,i,o){var a=t.gl;this.program=a.createProgram();for(var s=wn(n.staticAttributes),u=r?r.getBinderAttributes():[],c=s.concat(u),l=n.staticUniforms?wn(n.staticUniforms):[],h=r?r.getBinderUniforms():[],f=[],p=0,d=l.concat(h);p<d.length;p+=1){var v=d[p];f.indexOf(v)<0&&f.push(v)}var m=r?r.defines():[];o&&m.push("#define OVERDRAW_INSPECTOR;");var g=m.concat(We.fragmentSource,n.fragmentSource).join("\n"),y=m.concat(We.vertexSource,n.vertexSource).join("\n"),_=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(_,g),a.compileShader(_),a.attachShader(this.program,_);var x=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())this.failedToCreate=!0;else{a.shaderSource(x,y),a.compileShader(x),a.attachShader(this.program,x),this.attributes={};var b={};this.numAttributes=c.length;for(var w=0;w<this.numAttributes;w++)c[w]&&(a.bindAttribLocation(this.program,w,c[w]),this.attributes[c[w]]=w);a.linkProgram(this.program),a.deleteShader(x),a.deleteShader(_);for(var E=0;E<f.length;E++){var S=f[E];if(S&&!b[S]){var A=a.getUniformLocation(this.program,S);A&&(b[S]=A)}}this.fixedUniforms=i(t,b),this.binderUniforms=r?r.getUniforms(t,b):[]}}};function Sn(t,e,n){var r=1/pe(n,1,e.transform.tileZoom),i=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,e.transform.tileZoom)/i,a=o*(n.tileID.canonical.x+n.tileID.wrap*i),s=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[a>>16,s>>16],u_pixel_coord_lower:[65535&a,65535&s]}}En.prototype.draw=function(t,e,n,r,i,o,a,s,u,c,l,h,f,p,d,v){var m,g=t.gl;if(!this.failedToCreate){for(var y in t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(r),t.setColorMode(i),t.setCullFace(o),this.fixedUniforms)this.fixedUniforms[y].set(a[y]);p&&p.setUniforms(t,this.binderUniforms,h,{zoom:f});for(var _=(m={},m[g.LINES]=2,m[g.TRIANGLES]=3,m[g.LINE_STRIP]=1,m)[e],x=0,b=l.get();x<b.length;x+=1){var w=b[x],E=w.vaos||(w.vaos={});(E[s]||(E[s]=new bn)).bind(t,this,u,p?p.getPaintVertexBuffers():[],c,w.vertexOffset,d,v),g.drawElements(e,w.primitiveLength*_,g.UNSIGNED_SHORT,w.primitiveOffset*_*2)}}};var An=function(e,n,r,i){var o=n.style.light,a=o.properties.get("position"),s=[a.x,a.y,a.z],u=t.create$1();"viewport"===o.properties.get("anchor")&&t.fromRotation(u,-n.transform.angle),t.transformMat3(s,s,u);var c=o.properties.get("color");return{u_matrix:e,u_lightpos:s,u_lightintensity:o.properties.get("intensity"),u_lightcolor:[c.r,c.g,c.b],u_vertical_gradient:+r,u_opacity:i}},Tn=function(e,n,r,i,o,a,s){return t.extend(An(e,n,r,i),Sn(a,n,s),{u_height_factor:-Math.pow(2,o.overscaledZ)/s.tileSize/8})},Cn=function(t){return{u_matrix:t}},kn=function(e,n,r,i){return t.extend(Cn(e),Sn(r,n,i))},Mn=function(t,e){return{u_matrix:t,u_world:e}},Pn=function(e,n,r,i,o){return t.extend(kn(e,n,r,i),{u_world:o})},In=function(e,n,r,i){var o,a,s=e.transform;if("map"===i.paint.get("circle-pitch-alignment")){var u=pe(r,1,s.zoom);o=!0,a=[u,u]}else o=!1,a=s.pixelsToGLUnits;return{u_camera_to_center_distance:s.cameraToCenterDistance,u_scale_with_map:+("map"===i.paint.get("circle-pitch-scale")),u_matrix:e.translatePosMatrix(n.posMatrix,r,i.paint.get("circle-translate"),i.paint.get("circle-translate-anchor")),u_pitch_with_map:+o,u_device_pixel_ratio:t.browser.devicePixelRatio,u_extrude_scale:a}},Rn=function(t,e,n){var r=pe(n,1,e.zoom),i=Math.pow(2,e.zoom-n.tileID.overscaledZ),o=n.tileID.overscaleFactor();return{u_matrix:t,u_camera_to_center_distance:e.cameraToCenterDistance,u_pixels_to_tile_units:r,u_extrude_scale:[e.pixelsToGLUnits[0]/(r*i),e.pixelsToGLUnits[1]/(r*i)],u_overscale_factor:o}},Ln=function(t,e,n){return{u_matrix:t,u_inv_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_viewport_size:[n.width,n.height]}},On=function(t,e,n){return void 0===n&&(n=1),{u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}},Dn=function(t){return{u_matrix:t}},Nn=function(t,e,n,r){return{u_matrix:t,u_extrude_scale:pe(e,1,n),u_intensity:r}},zn=function(e,n,r){var i=e.transform;return{u_matrix:Zn(e,n,r),u_ratio:1/pe(n,1,i.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_units_to_pixels:[1/i.pixelsToGLUnits[0],1/i.pixelsToGLUnits[1]]}},Fn=function(e,n,r,i){return t.extend(zn(e,n,r),{u_image:0,u_image_height:i})},Bn=function(e,n,r,i){var o=e.transform,a=jn(n,o);return{u_matrix:Zn(e,n,r),u_texsize:n.imageAtlasTexture.size,u_ratio:1/pe(n,1,o.zoom),u_device_pixel_ratio:t.browser.devicePixelRatio,u_image:0,u_scale:[a,i.fromScale,i.toScale],u_fade:i.t,u_units_to_pixels:[1/o.pixelsToGLUnits[0],1/o.pixelsToGLUnits[1]]}},Un=function(e,n,r,i,o){var a=e.lineAtlas,s=jn(n,e.transform),u="round"===r.layout.get("line-cap"),c=a.getDash(i.from,u),l=a.getDash(i.to,u),h=c.width*o.fromScale,f=l.width*o.toScale;return t.extend(zn(e,n,r),{u_patternscale_a:[s/h,-c.height/2],u_patternscale_b:[s/f,-l.height/2],u_sdfgamma:a.width/(256*Math.min(h,f)*t.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:c.y,u_tex_y_b:l.y,u_mix:o.t})};function jn(t,e){return 1/pe(t,1,e.tileZoom)}function Zn(t,e,n){return t.translatePosMatrix(e.tileID.posMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}var Vn=function(t,e,n,r,i){return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_buffer_scale:1,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(o=i.paint.get("raster-contrast"),o>0?1/(1-o):1+o),u_spin_weights:Gn(i.paint.get("raster-hue-rotate"))};var o,a};function Gn(t){t*=Math.PI/180;var e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}var Hn,Wn=function(t,e,n,r,i,o,a,s,u,c){var l=i.transform;return{u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:e?e.uSizeT:0,u_size:e?e.uSize:0,u_camera_to_center_distance:l.cameraToCenterDistance,u_pitch:l.pitch/360*2*Math.PI,u_rotate_symbol:+n,u_aspect_ratio:l.width/l.height,u_fade_change:i.options.fadeDuration?i.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:s,u_is_text:+u,u_pitch_with_map:+r,u_texsize:c,u_texture:0}},qn=function(e,n,r,i,o,a,s,u,c,l,h){var f=o.transform;return t.extend(Wn(e,n,r,i,o,a,s,u,c,l),{u_gamma_scale:i?Math.cos(f._pitch)*f.cameraToCenterDistance:1,u_device_pixel_ratio:t.browser.devicePixelRatio,u_is_halo:+h})},Xn=function(e,n,r,i,o,a,s,u,c,l){return t.extend(qn(e,n,r,i,o,a,s,u,!0,c,!0),{u_texsize_icon:l,u_texture_icon:1})},Yn=function(t,e,n){return{u_matrix:t,u_opacity:e,u_color:n}},Kn=function(e,n,r,i,o,a){return t.extend(function(t,e,n,r){var i=n.imageManager.getPattern(t.from.toString()),o=n.imageManager.getPattern(t.to.toString()),a=n.imageManager.getPixelSize(),s=a.width,u=a.height,c=Math.pow(2,r.tileID.overscaledZ),l=r.tileSize*Math.pow(2,n.transform.tileZoom)/c,h=l*(r.tileID.canonical.x+r.tileID.wrap*c),f=l*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,u],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/pe(r,1,n.transform.tileZoom),u_pixel_coord_upper:[h>>16,f>>16],u_pixel_coord_lower:[65535&h,65535&f]}}(i,a,r,o),{u_matrix:e,u_opacity:n})},Qn={fillExtrusion:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fillExtrusionPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}},fill:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},fillPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},fillOutline:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}},fillOutlinePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},circle:function(e,n){return{u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_scale_with_map:new t.Uniform1i(e,n.u_scale_with_map),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},collisionBox:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pixels_to_tile_units:new t.Uniform1f(e,n.u_pixels_to_tile_units),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale),u_overscale_factor:new t.Uniform1f(e,n.u_overscale_factor)}},collisionCircle:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,n.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,n.u_viewport_size)}},debug:function(e,n){return{u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_overlay:new t.Uniform1i(e,n.u_overlay),u_overlay_scale:new t.Uniform1f(e,n.u_overlay_scale)}},clippingMask:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmap:function(e,n){return{u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}},heatmapTexture:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}},hillshade:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}},hillshadePrepare:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}},line:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels)}},lineGradient:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_image:new t.Uniform1i(e,n.u_image),u_image_height:new t.Uniform1f(e,n.u_image_height)}},linePattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}},lineSDF:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_ratio:new t.Uniform1f(e,n.u_ratio),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_patternscale_a:new t.Uniform2f(e,n.u_patternscale_a),u_patternscale_b:new t.Uniform2f(e,n.u_patternscale_b),u_sdfgamma:new t.Uniform1f(e,n.u_sdfgamma),u_image:new t.Uniform1i(e,n.u_image),u_tex_y_a:new t.Uniform1f(e,n.u_tex_y_a),u_tex_y_b:new t.Uniform1f(e,n.u_tex_y_b),u_mix:new t.Uniform1f(e,n.u_mix)}},raster:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_buffer_scale:new t.Uniform1f(e,n.u_buffer_scale),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights)}},symbolIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture)}},symbolSDF:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},symbolTextAndIcon:function(e,n){return{u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_pitch:new t.Uniform1f(e,n.u_pitch),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}},background:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}},backgroundPattern:function(e,n){return{u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}}};function Jn(e,n,r,i,o,a,s){for(var u=e.context,c=u.gl,l=e.useProgram("collisionBox"),h=[],f=0,p=0,d=0;d<i.length;d++){var v=i[d],m=n.getTile(v),g=m.getBucket(r);if(g){var y=v.posMatrix;0===o[0]&&0===o[1]||(y=e.translatePosMatrix(v.posMatrix,m,o,a));var _=s?g.textCollisionBox:g.iconCollisionBox,x=g.collisionCircleArray;if(x.length>0){var b=t.create(),w=y;t.mul(b,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(b,b,g.placementViewportMatrix),h.push({circleArray:x,circleOffset:p,transform:w,invTransform:b}),p=f+=x.length/4}_&&l.draw(u,c.LINES,Tt.disabled,Ct.disabled,e.colorModeForRenderPass(),Mt.disabled,Rn(y,e.transform,m),r.id,_.layoutVertexBuffer,_.indexBuffer,_.segments,null,e.transform.zoom,null,null,_.collisionVertexBuffer)}}if(s&&h.length){var E=e.useProgram("collisionCircle"),S=new t.StructArrayLayout2f1f2i16;S.resize(4*f),S._trim();for(var A=0,T=0,C=h;T<C.length;T+=1)for(var k=C[T],M=0;M<k.circleArray.length/4;M++){var P=4*M,I=k.circleArray[P+0],R=k.circleArray[P+1],L=k.circleArray[P+2],O=k.circleArray[P+3];S.emplace(A++,I,R,L,O,0),S.emplace(A++,I,R,L,O,1),S.emplace(A++,I,R,L,O,2),S.emplace(A++,I,R,L,O,3)}(!Hn||Hn.length<2*f)&&(Hn=function(e){var n=2*e,r=new t.StructArrayLayout3ui6;r.resize(n),r._trim();for(var i=0;i<n;i++){var o=6*i;r.uint16[o+0]=4*i+0,r.uint16[o+1]=4*i+1,r.uint16[o+2]=4*i+2,r.uint16[o+3]=4*i+2,r.uint16[o+4]=4*i+3,r.uint16[o+5]=4*i+0}return r}(f));for(var D=u.createIndexBuffer(Hn,!0),N=u.createVertexBuffer(S,t.collisionCircleLayout.members,!0),z=0,F=h;z<F.length;z+=1){var B=F[z],U=Ln(B.transform,B.invTransform,e.transform);E.draw(u,c.TRIANGLES,Tt.disabled,Ct.disabled,e.colorModeForRenderPass(),Mt.disabled,U,r.id,N,D,t.SegmentVector.simpleSegment(0,2*B.circleOffset,B.circleArray.length,B.circleArray.length/2),null,e.transform.zoom,null,null,null)}N.destroy(),D.destroy()}}var $n=t.identity(new Float32Array(16));function tr(e,n,r,i,o,a){var s=t.getAnchorAlignment(e),u=-(s.horizontalAlign-.5)*n,c=-(s.verticalAlign-.5)*r,l=t.evaluateVariableOffset(e,i);return new t.Point((u/o+l[0])*a,(c/o+l[1])*a)}function er(e,n,r,i,o,a,s,u,c,l,h){var f=e.text.placedSymbolArray,p=e.text.dynamicLayoutVertexArray,d=e.icon.dynamicLayoutVertexArray,v={};p.clear();for(var m=0;m<f.length;m++){var g=f.get(m),y=g.hidden||!g.crossTileID||e.allowVerticalPlacement&&!g.placedOrientation?null:i[g.crossTileID];if(y){var _=new t.Point(g.anchorX,g.anchorY),x=te(_,r?u:s),b=ee(a.cameraToCenterDistance,x.signedDistanceFromCamera),w=o.evaluateSizeForFeature(e.textSizeData,l,g)*b/t.ONE_EM;r&&(w*=e.tilePixelRatio/c);for(var E=tr(y.anchor,y.width,y.height,y.textOffset,y.textBoxScale,w),S=r?te(_.add(E),s).point:x.point.add(n?E.rotate(-a.angle):E),A=e.allowVerticalPlacement&&g.placedOrientation===t.WritingMode.vertical?Math.PI/2:0,T=0;T<g.numGlyphs;T++)t.addDynamicAttributes(p,S,A);h&&g.associatedIconIndex>=0&&(v[g.associatedIconIndex]={shiftedAnchor:S,angle:A})}else le(g.numGlyphs,p)}if(h){d.clear();for(var C=e.icon.placedSymbolArray,k=0;k<C.length;k++){var M=C.get(k);if(M.hidden)le(M.numGlyphs,d);else{var P=v[k];if(P)for(var I=0;I<M.numGlyphs;I++)t.addDynamicAttributes(d,P.shiftedAnchor,P.angle);else le(M.numGlyphs,d)}}e.icon.dynamicLayoutVertexBuffer.updateData(d)}e.text.dynamicLayoutVertexBuffer.updateData(p)}function nr(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function rr(e,n,r,i,o,a,s,u,c,l,h,f){for(var p=e.context,d=p.gl,v=e.transform,m="map"===u,g="map"===c,y=m&&"point"!==r.layout.get("symbol-placement"),_=m&&!g&&!y,x=void 0!==r.layout.get("symbol-sort-key").constantOr(1),b=!1,w=e.depthModeForSublayer(0,Tt.ReadOnly),E=r.layout.get("text-variable-anchor"),S=[],A=0,T=i;A<T.length;A+=1){var C=T[A],k=n.getTile(C),M=k.getBucket(r);if(M){var P=o?M.text:M.icon;if(P&&P.segments.get().length){var I=P.programConfigurations.get(r.id),R=o||M.sdfIcons,L=o?M.textSizeData:M.iconSizeData,O=g||0!==v.pitch,D=e.useProgram(nr(R,o,M),I),N=t.evaluateSizeForZoom(L,v.zoom),z=void 0,F=[0,0],B=void 0,U=void 0,j=null,Z=void 0;if(o)B=k.glyphAtlasTexture,U=d.LINEAR,z=k.glyphAtlasTexture.size,M.iconsInText&&(F=k.imageAtlasTexture.size,j=k.imageAtlasTexture,Z=O||e.options.rotating||e.options.zooming||"composite"===L.kind||"camera"===L.kind?d.LINEAR:d.NEAREST);else{var V=1!==r.layout.get("icon-size").constantOr(0)||M.iconsNeedLinear;B=k.imageAtlasTexture,U=R||e.options.rotating||e.options.zooming||V||O?d.LINEAR:d.NEAREST,z=k.imageAtlasTexture.size}var G=pe(k,1,e.transform.zoom),H=Jt(C.posMatrix,g,m,e.transform,G),W=$t(C.posMatrix,g,m,e.transform,G),q=E&&M.hasTextData(),X="none"!==r.layout.get("icon-text-fit")&&q&&M.hasIconData();y&&re(M,C.posMatrix,e,o,H,W,g,l);var Y=e.translatePosMatrix(C.posMatrix,k,a,s),K=y||o&&E||X?$n:H,Q=e.translatePosMatrix(W,k,a,s,!0),J=R&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1),$={program:D,buffers:P,uniformValues:R?M.iconsInText?Xn(L.kind,N,_,g,e,Y,K,Q,z,F):qn(L.kind,N,_,g,e,Y,K,Q,o,z,!0):Wn(L.kind,N,_,g,e,Y,K,Q,o,z),atlasTexture:B,atlasTextureIcon:j,atlasInterpolation:U,atlasInterpolationIcon:Z,isSDF:R,hasHalo:J};if(x&&M.canOverlap){b=!0;for(var tt=0,et=P.segments.get();tt<et.length;tt+=1){var nt=et[tt];S.push({segments:new t.SegmentVector([nt]),sortKey:nt.sortKey,state:$})}}else S.push({segments:P.segments,sortKey:0,state:$})}}}b&&S.sort((function(t,e){return t.sortKey-e.sortKey}));for(var rt=0,it=S;rt<it.length;rt+=1){var ot=it[rt],at=ot.state;if(p.activeTexture.set(d.TEXTURE0),at.atlasTexture.bind(at.atlasInterpolation,d.CLAMP_TO_EDGE),at.atlasTextureIcon&&(p.activeTexture.set(d.TEXTURE1),at.atlasTextureIcon&&at.atlasTextureIcon.bind(at.atlasInterpolationIcon,d.CLAMP_TO_EDGE)),at.isSDF){var st=at.uniformValues;at.hasHalo&&(st.u_is_halo=1,ir(at.buffers,ot.segments,r,e,at.program,w,h,f,st)),st.u_is_halo=0}ir(at.buffers,ot.segments,r,e,at.program,w,h,f,at.uniformValues)}}function ir(t,e,n,r,i,o,a,s,u){var c=r.context;i.draw(c,c.gl.TRIANGLES,o,a,s,Mt.disabled,u,n.id,t.layoutVertexBuffer,t.indexBuffer,e,n.paint,r.transform.zoom,t.programConfigurations.get(n.id),t.dynamicLayoutVertexBuffer,t.opacityVertexBuffer)}function or(t,e,n,r,i,o,a){var s,u,c,l,h,f=t.context.gl,p=n.paint.get("fill-pattern"),d=p&&p.constantOr(1),v=n.getCrossfadeParameters();a?(u=d&&!n.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",s=f.LINES):(u=d?"fillPattern":"fill",s=f.TRIANGLES);for(var m=0,g=r;m<g.length;m+=1){var y=g[m],_=e.getTile(y);if(!d||_.patternsLoaded()){var x=_.getBucket(n);if(x){var b=x.programConfigurations.get(n.id),w=t.useProgram(u,b);d&&(t.context.activeTexture.set(f.TEXTURE0),_.imageAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),b.updatePaintBuffers(v));var E=p.constantOr(null);if(E&&_.imageAtlas){var S=_.imageAtlas,A=S.patternPositions[E.to.toString()],T=S.patternPositions[E.from.toString()];A&&T&&b.setConstantPatternPositions(A,T)}var C=t.translatePosMatrix(y.posMatrix,_,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));if(a){l=x.indexBuffer2,h=x.segments2;var k=[f.drawingBufferWidth,f.drawingBufferHeight];c="fillOutlinePattern"===u&&d?Pn(C,t,v,_,k):Mn(C,k)}else l=x.indexBuffer,h=x.segments,c=d?kn(C,t,v,_):Cn(C);w.draw(t.context,s,i,t.stencilModeForClipping(y),o,Mt.disabled,c,n.id,x.layoutVertexBuffer,l,h,n.paint,t.transform.zoom,b)}}}}function ar(t,e,n,r,i,o,a){for(var s=t.context,u=s.gl,c=n.paint.get("fill-extrusion-pattern"),l=c.constantOr(1),h=n.getCrossfadeParameters(),f=n.paint.get("fill-extrusion-opacity"),p=0,d=r;p<d.length;p+=1){var v=d[p],m=e.getTile(v),g=m.getBucket(n);if(g){var y=g.programConfigurations.get(n.id),_=t.useProgram(l?"fillExtrusionPattern":"fillExtrusion",y);l&&(t.context.activeTexture.set(u.TEXTURE0),m.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),y.updatePaintBuffers(h));var x=c.constantOr(null);if(x&&m.imageAtlas){var b=m.imageAtlas,w=b.patternPositions[x.to.toString()],E=b.patternPositions[x.from.toString()];w&&E&&y.setConstantPatternPositions(w,E)}var S=t.translatePosMatrix(v.posMatrix,m,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),A=n.paint.get("fill-extrusion-vertical-gradient"),T=l?Tn(S,t,A,f,v,h,m):An(S,t,A,f);_.draw(s,s.gl.TRIANGLES,i,o,a,Mt.backCCW,T,n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,t.transform.zoom,y)}}}function sr(e,n,r,i,o,a){var s=e.context,u=s.gl,c=n.fbo;if(c){var l=e.useProgram("hillshade");s.activeTexture.set(u.TEXTURE0),u.bindTexture(u.TEXTURE_2D,c.colorAttachment.get());var h=function(e,n,r){var i=r.paint.get("hillshade-shadow-color"),o=r.paint.get("hillshade-highlight-color"),a=r.paint.get("hillshade-accent-color"),s=r.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===r.paint.get("hillshade-illumination-anchor")&&(s-=e.transform.angle);var u,c,l,h=!e.options.moving;return{u_matrix:e.transform.calculatePosMatrix(n.tileID.toUnwrapped(),h),u_image:0,u_latrange:(u=n.tileID,c=Math.pow(2,u.canonical.z),l=u.canonical.y,[new t.MercatorCoordinate(0,l/c).toLngLat().lat,new t.MercatorCoordinate(0,(l+1)/c).toLngLat().lat]),u_light:[r.paint.get("hillshade-exaggeration"),s],u_shadow:i,u_highlight:o,u_accent:a}}(e,n,r);l.draw(s,u.TRIANGLES,i,o,a,Mt.disabled,h,r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments)}}function ur(e,n,r,i,o,a){var s=e.context,u=s.gl,c=n.dem;if(c&&c.data){var l=c.dim,h=c.stride,f=c.getPixels();if(s.activeTexture.set(u.TEXTURE1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(h),n.demTexture){var p=n.demTexture;p.update(f,{premultiply:!1}),p.bind(u.NEAREST,u.CLAMP_TO_EDGE)}else n.demTexture=new t.Texture(s,f,u.RGBA,{premultiply:!1}),n.demTexture.bind(u.NEAREST,u.CLAMP_TO_EDGE);s.activeTexture.set(u.TEXTURE0);var d=n.fbo;if(!d){var v=new t.Texture(s,{width:l,height:l,data:null},u.RGBA);v.bind(u.LINEAR,u.CLAMP_TO_EDGE),(d=n.fbo=s.createFramebuffer(l,l,!0)).colorAttachment.set(v.texture)}s.bindFramebuffer.set(d.framebuffer),s.viewport.set([0,0,l,l]),e.useProgram("hillshadePrepare").draw(s,u.TRIANGLES,i,o,a,Mt.disabled,function(e,n){var r=n.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:n.getUnpackVector()}}(n.tileID,c),r.id,e.rasterBoundsBuffer,e.quadTriangleIndexBuffer,e.rasterBoundsSegments),n.needsHillshadePrepare=!1}}function cr(e,n,r,i,o){var a=i.paint.get("raster-fade-duration");if(a>0){var s=t.browser.now(),u=(s-e.timeAdded)/a,c=n?(s-n.timeAdded)/a:-1,l=r.getSource(),h=o.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),f=!n||Math.abs(n.tileID.overscaledZ-h)>Math.abs(e.tileID.overscaledZ-h),p=f&&e.refreshedUponExpiration?1:t.clamp(f?u:1-c,0,1);return e.refreshedUponExpiration&&u>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-p}:{opacity:p,mix:0}}return{opacity:1,mix:0}}var lr=new t.Color(1,0,0,1),hr=new t.Color(0,1,0,1),fr=new t.Color(0,0,1,1),pr=new t.Color(1,0,1,1),dr=new t.Color(0,1,1,1);function vr(t,e,n,r){gr(t,0,e+n/2,t.transform.width,n,r)}function mr(t,e,n,r){gr(t,e-n/2,0,n,t.transform.height,r)}function gr(e,n,r,i,o,a){var s=e.context,u=s.gl;u.enable(u.SCISSOR_TEST),u.scissor(n*t.browser.devicePixelRatio,r*t.browser.devicePixelRatio,i*t.browser.devicePixelRatio,o*t.browser.devicePixelRatio),s.clear({color:a}),u.disable(u.SCISSOR_TEST)}function yr(e,n,r){var i=e.context,o=i.gl,a=r.posMatrix,s=e.useProgram("debug"),u=Tt.disabled,c=Ct.disabled,l=e.colorModeForRenderPass();i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.draw(i,o.LINE_STRIP,u,c,l,Mt.disabled,On(a,t.Color.red),"$debug",e.debugBuffer,e.tileBorderIndexBuffer,e.debugSegments);var h=n.getTileByID(r.key).latestRawTileData,f=Math.floor((h&&h.byteLength||0)/1024),p=n.getTile(r).tileSize,d=512/Math.min(p,512)*(r.overscaledZ/e.transform.zoom)*.5,v=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(v+=" => "+r.overscaledZ),function(t,e){t.initDebugOverlayCanvas();var n=t.debugOverlayCanvas,r=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,v+" "+f+"kb"),s.draw(i,o.TRIANGLES,u,c,kt.alphaBlended,Mt.disabled,On(a,t.Color.transparent,d),"$debug",e.debugBuffer,e.quadTriangleIndexBuffer,e.debugSegments)}var _r={symbol:function(e,n,r,i,o){if("translucent"===e.renderPass){var a=Ct.disabled,s=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,n,r,i,o,a,s){for(var u=n.transform,c="map"===o,l="map"===a,h=0,f=e;h<f.length;h+=1){var p=f[h],d=i.getTile(p),v=d.getBucket(r);if(v&&v.text&&v.text.segments.get().length){var m=t.evaluateSizeForZoom(v.textSizeData,u.zoom),g=pe(d,1,n.transform.zoom),y=Jt(p.posMatrix,l,c,n.transform,g),_="none"!==r.layout.get("icon-text-fit")&&v.hasIconData();if(m){var x=Math.pow(2,u.zoom-d.tileID.overscaledZ);er(v,c,l,s,t.symbolSize,u,y,p.posMatrix,x,m,_)}}}}(i,e,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&rr(e,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),a,s),0!==r.paint.get("text-opacity").constantOr(1)&&rr(e,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),a,s),n.map.showCollisionBoxes&&(Jn(e,n,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),Jn(e,n,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))}},circle:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("circle-opacity"),a=r.paint.get("circle-stroke-width"),s=r.paint.get("circle-stroke-opacity"),u=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0!==o.constantOr(1)||0!==a.constantOr(1)&&0!==s.constantOr(1)){for(var c=e.context,l=c.gl,h=e.depthModeForSublayer(0,Tt.ReadOnly),f=Ct.disabled,p=e.colorModeForRenderPass(),d=[],v=0;v<i.length;v++){var m=i[v],g=n.getTile(m),y=g.getBucket(r);if(y){var _=y.programConfigurations.get(r.id),x={programConfiguration:_,program:e.useProgram("circle",_),layoutVertexBuffer:y.layoutVertexBuffer,indexBuffer:y.indexBuffer,uniformValues:In(e,m,g,r)};if(u)for(var b=0,w=y.segments.get();b<w.length;b+=1){var E=w[b];d.push({segments:new t.SegmentVector([E]),sortKey:E.sortKey,state:x})}else d.push({segments:y.segments,sortKey:0,state:x})}}u&&d.sort((function(t,e){return t.sortKey-e.sortKey}));for(var S=0,A=d;S<A.length;S+=1){var T=A[S],C=T.state;C.program.draw(c,l.TRIANGLES,h,f,p,Mt.disabled,C.uniformValues,r.id,C.layoutVertexBuffer,C.indexBuffer,T.segments,r.paint,e.transform.zoom,C.programConfiguration)}}}},heatmap:function(e,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){var o=e.context,a=o.gl,s=Ct.disabled,u=new kt([a.ONE,a.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){var r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);var i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{var o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,n,r){var i=t.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width/4,e.height/4,0,i.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(t,e,o,i)}}(o,e,r),o.clear({color:t.Color.transparent});for(var c=0;c<i.length;c++){var l=i[c];if(!n.hasRenderableParent(l)){var h=n.getTile(l),f=h.getBucket(r);if(f){var p=f.programConfigurations.get(r.id);e.useProgram("heatmap",p).draw(o,a.TRIANGLES,Tt.disabled,s,u,Mt.disabled,Nn(l.posMatrix,h,e.transform.zoom,r.paint.get("heatmap-intensity")),r.id,f.layoutVertexBuffer,f.indexBuffer,f.segments,r.paint,e.transform.zoom,p)}}}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){var r=e.context,i=r.gl,o=n.heatmapFbo;if(o){r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);var a=n.colorRampTexture;a||(a=n.colorRampTexture=new t.Texture(r,n.colorRamp,i.RGBA)),a.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,i.TRIANGLES,Tt.disabled,Ct.disabled,e.colorModeForRenderPass(),Mt.disabled,function(e,n,r,i){var o=t.create();t.ortho(o,0,e.width,e.height,0,0,1);var a=e.context.gl;return{u_matrix:o,u_world:[a.drawingBufferWidth,a.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:n.paint.get("heatmap-opacity")}}(e,n),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}}(e,r))},line:function(e,n,r,i){if("translucent"===e.renderPass){var o=r.paint.get("line-opacity"),a=r.paint.get("line-width");if(0!==o.constantOr(1)&&0!==a.constantOr(1))for(var s=e.depthModeForSublayer(0,Tt.ReadOnly),u=e.colorModeForRenderPass(),c=r.paint.get("line-dasharray"),l=r.paint.get("line-pattern"),h=l.constantOr(1),f=r.paint.get("line-gradient"),p=r.getCrossfadeParameters(),d=h?"linePattern":c?"lineSDF":f?"lineGradient":"line",v=e.context,m=v.gl,g=!0,y=0,_=i;y<_.length;y+=1){var x=_[y],b=n.getTile(x);if(!h||b.patternsLoaded()){var w=b.getBucket(r);if(w){var E=w.programConfigurations.get(r.id),S=e.context.program.get(),A=e.useProgram(d,E),T=g||A.program!==S,C=l.constantOr(null);if(C&&b.imageAtlas){var k=b.imageAtlas,M=k.patternPositions[C.to.toString()],P=k.patternPositions[C.from.toString()];M&&P&&E.setConstantPatternPositions(M,P)}var I=h?Bn(e,b,r,p):c?Un(e,b,r,c,p):f?Fn(e,b,r,w.lineClipsArray.length):zn(e,b,r);if(h)v.activeTexture.set(m.TEXTURE0),b.imageAtlasTexture.bind(m.LINEAR,m.CLAMP_TO_EDGE),E.updatePaintBuffers(p);else if(c&&(T||e.lineAtlas.dirty))v.activeTexture.set(m.TEXTURE0),e.lineAtlas.bind(v);else if(f){var R=w.gradients[r.id],L=R.texture;if(r.gradientVersion!==R.version){var O=256;if(r.stepInterpolant){var D=n.getSource().maxzoom,N=x.canonical.z===D?Math.ceil(1<<e.transform.maxZoom-x.canonical.z):1;O=t.clamp(t.nextPowerOfTwo(w.maxLineLength/t.EXTENT*1024*N),256,v.maxTextureSize)}R.gradient=t.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:O,image:R.gradient||void 0,clips:w.lineClipsArray}),R.texture?R.texture.update(R.gradient):R.texture=new t.Texture(v,R.gradient,m.RGBA),R.version=r.gradientVersion,L=R.texture}v.activeTexture.set(m.TEXTURE0),L.bind(r.stepInterpolant?m.NEAREST:m.LINEAR,m.CLAMP_TO_EDGE)}A.draw(v,m.TRIANGLES,s,e.stencilModeForClipping(x),u,Mt.disabled,I,r.id,w.layoutVertexBuffer,w.indexBuffer,w.segments,r.paint,e.transform.zoom,E,w.layoutVertexBuffer2),g=!1}}}}},fill:function(e,n,r,i){var o=r.paint.get("fill-color"),a=r.paint.get("fill-opacity");if(0!==a.constantOr(1)){var s=e.colorModeForRenderPass(),u=r.paint.get("fill-pattern"),c=e.opaquePassEnabledForLayer()&&!u.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===a.constantOr(0)?"opaque":"translucent";if(e.renderPass===c){var l=e.depthModeForSublayer(1,"opaque"===e.renderPass?Tt.ReadWrite:Tt.ReadOnly);or(e,n,r,i,l,s,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){var h=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,Tt.ReadOnly);or(e,n,r,i,h,s,!0)}}},"fill-extrusion":function(t,e,n,r){var i=n.paint.get("fill-extrusion-opacity");if(0!==i&&"translucent"===t.renderPass){var o=new Tt(t.context.gl.LEQUAL,Tt.ReadWrite,t.depthRangeFor3D);if(1!==i||n.paint.get("fill-extrusion-pattern").constantOr(1))ar(t,e,n,r,o,Ct.disabled,kt.disabled),ar(t,e,n,r,o,t.stencilModeFor3D(),t.colorModeForRenderPass());else{var a=t.colorModeForRenderPass();ar(t,e,n,r,o,Ct.disabled,a)}}},hillshade:function(t,e,n,r){if("offscreen"===t.renderPass||"translucent"===t.renderPass){for(var i=t.context,o=t.depthModeForSublayer(0,Tt.ReadOnly),a=t.colorModeForRenderPass(),s="translucent"===t.renderPass?t.stencilConfigForOverlap(r):[{},r],u=s[0],c=0,l=s[1];c<l.length;c+=1){var h=l[c],f=e.getTile(h);f.needsHillshadePrepare&&"offscreen"===t.renderPass?ur(t,f,n,o,Ct.disabled,a):"translucent"===t.renderPass&&sr(t,f,n,o,u[h.overscaledZ],a)}i.viewport.set([0,0,t.width,t.height])}},raster:function(t,e,n,r){if("translucent"===t.renderPass&&0!==n.paint.get("raster-opacity")&&r.length)for(var i=t.context,o=i.gl,a=e.getSource(),s=t.useProgram("raster"),u=t.colorModeForRenderPass(),c=a instanceof L?[{},r]:t.stencilConfigForOverlap(r),l=c[0],h=c[1],f=h[h.length-1].overscaledZ,p=!t.options.moving,d=0,v=h;d<v.length;d+=1){var m=v[d],g=t.depthModeForSublayer(m.overscaledZ-f,1===n.paint.get("raster-opacity")?Tt.ReadWrite:Tt.ReadOnly,o.LESS),y=e.getTile(m),_=t.transform.calculatePosMatrix(m.toUnwrapped(),p);y.registerFadeDuration(n.paint.get("raster-fade-duration"));var x=e.findLoadedParent(m,0),b=cr(y,x,e,n,t.transform),w=void 0,E=void 0,S="nearest"===n.paint.get("raster-resampling")?o.NEAREST:o.LINEAR;i.activeTexture.set(o.TEXTURE0),y.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),i.activeTexture.set(o.TEXTURE1),x?(x.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST),w=Math.pow(2,x.tileID.overscaledZ-y.tileID.overscaledZ),E=[y.tileID.canonical.x*w%1,y.tileID.canonical.y*w%1]):y.texture.bind(S,o.CLAMP_TO_EDGE,o.LINEAR_MIPMAP_NEAREST);var A=Vn(_,E||[0,0],w||1,b,n);a instanceof L?s.draw(i,o.TRIANGLES,g,Ct.disabled,u,Mt.disabled,A,n.id,a.boundsBuffer,t.quadTriangleIndexBuffer,a.boundsSegments):s.draw(i,o.TRIANGLES,g,l[m.overscaledZ],u,Mt.disabled,A,n.id,t.rasterBoundsBuffer,t.quadTriangleIndexBuffer,t.rasterBoundsSegments)}},background:function(t,e,n){var r=n.paint.get("background-color"),i=n.paint.get("background-opacity");if(0!==i){var o=t.context,a=o.gl,s=t.transform,u=s.tileSize,c=n.paint.get("background-pattern");if(!t.isPatternMissing(c)){var l=!c&&1===r.a&&1===i&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass===l){var h=Ct.disabled,f=t.depthModeForSublayer(0,"opaque"===l?Tt.ReadWrite:Tt.ReadOnly),p=t.colorModeForRenderPass(),d=t.useProgram(c?"backgroundPattern":"background"),v=s.coveringTiles({tileSize:u});c&&(o.activeTexture.set(a.TEXTURE0),t.imageManager.bind(t.context));for(var m=n.getCrossfadeParameters(),g=0,y=v;g<y.length;g+=1){var _=y[g],x=t.transform.calculatePosMatrix(_.toUnwrapped()),b=c?Kn(x,i,t,c,{tileID:_,tileSize:u},m):Yn(x,i,r);d.draw(o,a.TRIANGLES,f,h,p,Mt.disabled,b,n.id,t.tileExtentBuffer,t.quadTriangleIndexBuffer,t.tileExtentSegments)}}}}},debug:function(t,e,n){for(var r=0;r<n.length;r++)yr(t,e,n[r])},custom:function(t,e,n){var r=t.context,i=n.implementation;if("offscreen"===t.renderPass){var o=i.prerender;o&&(t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),o.call(i,r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState())}else if("translucent"===t.renderPass){t.setCustomLayerDefaults(),r.setColorMode(t.colorModeForRenderPass()),r.setStencilMode(Ct.disabled);var a="3d"===i.renderingMode?new Tt(t.context.gl.LEQUAL,Tt.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Tt.ReadOnly);r.setDepthMode(a),i.render(r.gl,t.transform.customLayerMatrix()),r.setDirty(),t.setBaseState(),r.bindFramebuffer.set(null)}}},xr=function(t,e){this.context=new Pt(t),this.transform=e,this._tileTextures={},this.setup(),this.numSublayers=It.maxUnderzooming+It.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Be,this.gpuTimers={}};xr.prototype.resize=function(e,n){if(this.width=e*t.browser.devicePixelRatio,this.height=n*t.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var r=0,i=this.style._order;r<i.length;r+=1)this.style._layers[i[r]].resize()},xr.prototype.setup=function(){var e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,He.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);var r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(r,He.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);var i=new t.StructArrayLayout4i8;i.emplaceBack(0,0,0,0),i.emplaceBack(t.EXTENT,0,t.EXTENT,0),i.emplaceBack(0,t.EXTENT,0,t.EXTENT),i.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.rasterBoundsBuffer=e.createVertexBuffer(i,R.members),this.rasterBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);var o=new t.StructArrayLayout2i4;o.emplaceBack(0,0),o.emplaceBack(1,0),o.emplaceBack(0,1),o.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(o,He.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);var a=new t.StructArrayLayout1ui2;a.emplaceBack(0),a.emplaceBack(1),a.emplaceBack(3),a.emplaceBack(2),a.emplaceBack(0),this.tileBorderIndexBuffer=e.createIndexBuffer(a);var s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s),this.emptyTexture=new t.Texture(e,{width:1,height:1,data:new Uint8Array([0,0,0,0])},e.gl.RGBA);var u=this.context.gl;this.stencilClearMode=new Ct({func:u.ALWAYS,mask:0},0,255,u.ZERO,u.ZERO,u.ZERO)},xr.prototype.clearStencil=function(){var e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var r=t.create();t.ortho(r,0,this.width,this.height,0,0,1),t.scale(r,r,[n.drawingBufferWidth,n.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(e,n.TRIANGLES,Tt.disabled,this.stencilClearMode,kt.disabled,Mt.disabled,Dn(r),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},xr.prototype._renderTileClippingMasks=function(t,e){if(this.currentStencilSource!==t.source&&t.isTileClipped()&&e&&e.length){this.currentStencilSource=t.source;var n=this.context,r=n.gl;this.nextStencilID+e.length>256&&this.clearStencil(),n.setColorMode(kt.disabled),n.setDepthMode(Tt.disabled);var i=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var o=0,a=e;o<a.length;o+=1){var s=a[o],u=this._tileClippingMaskIDs[s.key]=this.nextStencilID++;i.draw(n,r.TRIANGLES,Tt.disabled,new Ct({func:r.ALWAYS,mask:0},u,255,r.KEEP,r.KEEP,r.REPLACE),kt.disabled,Mt.disabled,Dn(s.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},xr.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var t=this.nextStencilID++,e=this.context.gl;return new Ct({func:e.NOTEQUAL,mask:255},t,255,e.KEEP,e.KEEP,e.REPLACE)},xr.prototype.stencilModeForClipping=function(t){var e=this.context.gl;return new Ct({func:e.EQUAL,mask:255},this._tileClippingMaskIDs[t.key],0,e.KEEP,e.KEEP,e.REPLACE)},xr.prototype.stencilConfigForOverlap=function(t){var e,n=this.context.gl,r=t.sort((function(t,e){return e.overscaledZ-t.overscaledZ})),i=r[r.length-1].overscaledZ,o=r[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();for(var a={},s=0;s<o;s++)a[s+i]=new Ct({func:n.GEQUAL,mask:255},s+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[a,r]}return[(e={},e[i]=Ct.disabled,e),r]},xr.prototype.colorModeForRenderPass=function(){var e=this.context.gl;return this._showOverdrawInspector?new kt([e.CONSTANT_COLOR,e.ONE],new t.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):"opaque"===this.renderPass?kt.unblended:kt.alphaBlended},xr.prototype.depthModeForSublayer=function(t,e,n){if(!this.opaquePassEnabledForLayer())return Tt.disabled;var r=1-((1+this.currentLayer)*this.numSublayers+t)*this.depthEpsilon;return new Tt(n||this.context.gl.LEQUAL,e,[r,r])},xr.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},xr.prototype.render=function(e,n){var r=this;this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.browser.now()),this.imageManager.beginFrame();var i=this.style._order,o=this.style.sourceCaches;for(var a in o){var s=o[a];s.used&&s.prepare(this.context)}var u,c,l={},h={},f={};for(var p in o){var d=o[p];l[p]=d.getVisibleCoordinates(),h[p]=l[p].slice().reverse(),f[p]=d.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var v=0;v<i.length;v++)if(this.style._layers[i[v]].is3D()){this.opaquePassCutoff=v;break}this.renderPass="offscreen";for(var m=0,g=i;m<g.length;m+=1){var y=this.style._layers[g[m]];if(y.hasOffscreenPass()&&!y.isHidden(this.transform.zoom)){var _=h[y.source];("custom"===y.type||_.length)&&this.renderLayer(this,o[y.source],y,_)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:n.showOverdrawInspector?t.Color.black:t.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.depthRangeFor3D=[0,1-(e._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=i.length-1;this.currentLayer>=0;this.currentLayer--){var x=this.style._layers[i[this.currentLayer]],b=o[x.source],w=l[x.source];this._renderTileClippingMasks(x,w),this.renderLayer(this,b,x,w)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<i.length;this.currentLayer++){var E=this.style._layers[i[this.currentLayer]],S=o[E.source],A=("symbol"===E.type?f:h)[E.source];this._renderTileClippingMasks(E,l[E.source]),this.renderLayer(this,S,E,A)}this.options.showTileBoundaries&&(t.values(this.style._layers).forEach((function(t){t.source&&!t.isHidden(r.transform.zoom)&&(t.source!==(c&&c.id)&&(c=r.style.sourceCaches[t.source]),(!u||u.getSource().maxzoom<c.getSource().maxzoom)&&(u=c))})),u&&_r.debug(this,u,u.getVisibleCoordinates())),this.options.showPadding&&function(t){var e=t.transform.padding;vr(t,t.transform.height-(e.top||0),3,lr),vr(t,e.bottom||0,3,hr),mr(t,e.left||0,3,fr),mr(t,t.transform.width-(e.right||0),3,pr);var n=t.transform.centerPoint;!function(t,e,n,r){gr(t,e-1,n-10,2,20,r),gr(t,e-10,n-1,20,2,r)}(t,n.x,t.transform.height-n.y,dr)}(this),this.context.setDefault()},xr.prototype.renderLayer=function(t,e,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"custom"===n.type||r.length)&&(this.id=n.id,this.gpuTimingStart(n),_r[n.type](t,e,n,r,this.style.placement.variableOffsets),this.gpuTimingEnd())},xr.prototype.gpuTimingStart=function(t){if(this.options.gpuTiming){var e=this.context.extTimerQuery,n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}},xr.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}},xr.prototype.collectGpuTimers=function(){var t=this.gpuTimers;return this.gpuTimers={},t},xr.prototype.queryGpuTimers=function(t){var e={};for(var n in t){var r=t[n],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(r.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r.query),e[n]=o}return e},xr.prototype.translatePosMatrix=function(e,n,r,i,o){if(!r[0]&&!r[1])return e;var a=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(a){var s=Math.sin(a),u=Math.cos(a);r=[r[0]*u-r[1]*s,r[0]*s+r[1]*u]}var c=[o?r[0]:pe(n,r[0],this.transform.zoom),o?r[1]:pe(n,r[1],this.transform.zoom),0],l=new Float32Array(16);return t.translate(l,e,c),l},xr.prototype.saveTileTexture=function(t){var e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]},xr.prototype.getTileTexture=function(t){var e=this._tileTextures[t];return e&&e.length>0?e.pop():null},xr.prototype.isPatternMissing=function(t){if(!t)return!1;if(!t.from||!t.to)return!0;var e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n},xr.prototype.useProgram=function(t,e){this.cache=this.cache||{};var n=""+t+(e?e.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[n]||(this.cache[n]=new En(this.context,t,xn[t],e,Qn[t],this._showOverdrawInspector)),this.cache[n]},xr.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},xr.prototype.setBaseState=function(){var t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)},xr.prototype.initDebugOverlayCanvas=function(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},xr.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var br=function(t,e){this.points=t,this.planes=e};br.fromInvProjectionMatrix=function(e,n,r){var i=Math.pow(2,r),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((function(n){return t.transformMat4([],n,e)})).map((function(e){return t.scale$1([],e,1/e[3]/n*i)})),a=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((function(e){var n=t.sub([],o[e[0]],o[e[1]]),r=t.sub([],o[e[2]],o[e[1]]),i=t.normalize([],t.cross([],n,r)),a=-t.dot(i,o[e[1]]);return i.concat(a)}));return new br(o,a)};var wr=function(e,n){this.min=e,this.max=n,this.center=t.scale$2([],t.add([],this.min,this.max),.5)};wr.prototype.quadrant=function(e){for(var n=[e%2==0,e<2],r=t.clone$2(this.min),i=t.clone$2(this.max),o=0;o<n.length;o++)r[o]=n[o]?this.min[o]:this.center[o],i[o]=n[o]?this.center[o]:this.max[o];return i[2]=this.max[2],new wr(r,i)},wr.prototype.distanceX=function(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]},wr.prototype.distanceY=function(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]},wr.prototype.intersects=function(e){for(var n=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],r=!0,i=0;i<e.planes.length;i++){for(var o=e.planes[i],a=0,s=0;s<n.length;s++)a+=t.dot$1(o,n[s])>=0;if(0===a)return 0;a!==n.length&&(r=!1)}if(r)return 2;for(var u=0;u<3;u++){for(var c=Number.MAX_VALUE,l=-Number.MAX_VALUE,h=0;h<e.points.length;h++){var f=e.points[h][u]-this.min[u];c=Math.min(c,f),l=Math.max(l,f)}if(l<0||c>this.max[u]-this.min[u])return 0}return 1};var Er=function(t,e,n,r){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===n&&(n=0),void 0===r&&(r=0),isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=r};Er.prototype.interpolate=function(e,n,r){return null!=n.top&&null!=e.top&&(this.top=t.number(e.top,n.top,r)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,n.bottom,r)),null!=n.left&&null!=e.left&&(this.left=t.number(e.left,n.left,r)),null!=n.right&&null!=e.right&&(this.right=t.number(e.right,n.right,r)),this},Er.prototype.getCenter=function(e,n){var r=t.clamp((this.left+e-this.right)/2,0,e),i=t.clamp((this.top+n-this.bottom)/2,0,n);return new t.Point(r,i)},Er.prototype.equals=function(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right},Er.prototype.clone=function(){return new Er(this.top,this.bottom,this.left,this.right)},Er.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Sr=function(e,n,r,i,o){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setMaxBounds(),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new Er,this._posMatrixCache={},this._alignedPosMatrixCache={}},Ar={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Sr.prototype.clone=function(){var t=new Sr(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return t.tileSize=this.tileSize,t.latRange=this.latRange,t.width=this.width,t.height=this.height,t._center=this._center,t.zoom=this.zoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._calcMatrices(),t},Ar.minZoom.get=function(){return this._minZoom},Ar.minZoom.set=function(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))},Ar.maxZoom.get=function(){return this._maxZoom},Ar.maxZoom.set=function(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))},Ar.minPitch.get=function(){return this._minPitch},Ar.minPitch.set=function(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))},Ar.maxPitch.get=function(){return this._maxPitch},Ar.maxPitch.set=function(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))},Ar.renderWorldCopies.get=function(){return this._renderWorldCopies},Ar.renderWorldCopies.set=function(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t},Ar.worldSize.get=function(){return this.tileSize*this.scale},Ar.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},Ar.size.get=function(){return new t.Point(this.width,this.height)},Ar.bearing.get=function(){return-this.angle/Math.PI*180},Ar.bearing.set=function(e){var n=-t.wrap(e,-180,180)*Math.PI/180;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=t.create$2(),t.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},Ar.pitch.get=function(){return this._pitch/Math.PI*180},Ar.pitch.set=function(e){var n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())},Ar.fov.get=function(){return this._fov/Math.PI*180},Ar.fov.set=function(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())},Ar.zoom.get=function(){return this._zoom},Ar.zoom.set=function(t){var e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom,this._constrain(),this._calcMatrices())},Ar.center.get=function(){return this._center},Ar.center.set=function(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._constrain(),this._calcMatrices())},Ar.padding.get=function(){return this._edgeInsets.toJSON()},Ar.padding.set=function(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())},Ar.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Sr.prototype.isPaddingEqual=function(t){return this._edgeInsets.equals(t)},Sr.prototype.interpolatePadding=function(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()},Sr.prototype.coveringZoomLevel=function(t){var e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)},Sr.prototype.getVisibleUnwrappedCoordinates=function(e){var n=[new t.UnwrappedTileID(0,e)];if(this._renderWorldCopies)for(var r=this.pointCoordinate(new t.Point(0,0)),i=this.pointCoordinate(new t.Point(this.width,0)),o=this.pointCoordinate(new t.Point(this.width,this.height)),a=this.pointCoordinate(new t.Point(0,this.height)),s=Math.floor(Math.min(r.x,i.x,o.x,a.x)),u=Math.floor(Math.max(r.x,i.x,o.x,a.x)),c=s-1;c<=u+1;c++)0!==c&&n.push(new t.UnwrappedTileID(c,e));return n},Sr.prototype.coveringTiles=function(e){var n=this.coveringZoomLevel(e),r=n;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);var i=t.MercatorCoordinate.fromLngLat(this.center),o=Math.pow(2,n),a=[o*i.x,o*i.y,0],s=br.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n),u=e.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(u=n);var c=function(t){return{aabb:new wr([t*o,0,0],[(t+1)*o,o,0]),zoom:0,x:0,y:0,wrap:t,fullyVisible:!1}},l=[],h=[],f=n,p=e.reparseOverscaled?r:n;if(this._renderWorldCopies)for(var d=1;d<=3;d++)l.push(c(-d)),l.push(c(d));for(l.push(c(0));l.length>0;){var v=l.pop(),m=v.x,g=v.y,y=v.fullyVisible;if(!y){var _=v.aabb.intersects(s);if(0===_)continue;y=2===_}var x=v.aabb.distanceX(a),b=v.aabb.distanceY(a),w=Math.max(Math.abs(x),Math.abs(b));if(v.zoom===f||w>3+(1<<f-v.zoom)-2&&v.zoom>=u)h.push({tileID:new t.OverscaledTileID(v.zoom===f?p:v.zoom,v.wrap,v.zoom,m,g),distanceSq:t.sqrLen([a[0]-.5-m,a[1]-.5-g])});else for(var E=0;E<4;E++){var S=(m<<1)+E%2,A=(g<<1)+(E>>1);l.push({aabb:v.aabb.quadrant(E),zoom:v.zoom+1,x:S,y:A,wrap:v.wrap,fullyVisible:y})}}return h.sort((function(t,e){return t.distanceSq-e.distanceSq})).map((function(t){return t.tileID}))},Sr.prototype.resize=function(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()},Ar.unmodified.get=function(){return this._unmodified},Sr.prototype.zoomScale=function(t){return Math.pow(2,t)},Sr.prototype.scaleZoom=function(t){return Math.log(t)/Math.LN2},Sr.prototype.project=function(e){var n=t.clamp(e.lat,-this.maxValidLatitude,this.maxValidLatitude);return new t.Point(t.mercatorXfromLng(e.lng)*this.worldSize,t.mercatorYfromLat(n)*this.worldSize)},Sr.prototype.unproject=function(e){return new t.MercatorCoordinate(e.x/this.worldSize,e.y/this.worldSize).toLngLat()},Ar.point.get=function(){return this.project(this.center)},Sr.prototype.setLocationAtPoint=function(e,n){var r=this.pointCoordinate(n),i=this.pointCoordinate(this.centerPoint),o=this.locationCoordinate(e),a=new t.MercatorCoordinate(o.x-(r.x-i.x),o.y-(r.y-i.y));this.center=this.coordinateLocation(a),this._renderWorldCopies&&(this.center=this.center.wrap())},Sr.prototype.locationPoint=function(t){return this.coordinatePoint(this.locationCoordinate(t))},Sr.prototype.pointLocation=function(t){return this.coordinateLocation(this.pointCoordinate(t))},Sr.prototype.locationCoordinate=function(e){return t.MercatorCoordinate.fromLngLat(e)},Sr.prototype.coordinateLocation=function(t){return t.toLngLat()},Sr.prototype.pointCoordinate=function(e){var n=[e.x,e.y,0,1],r=[e.x,e.y,1,1];t.transformMat4(n,n,this.pixelMatrixInverse),t.transformMat4(r,r,this.pixelMatrixInverse);var i=n[3],o=r[3],a=n[1]/i,s=r[1]/o,u=n[2]/i,c=r[2]/o,l=u===c?0:(0-u)/(c-u);return new t.MercatorCoordinate(t.number(n[0]/i,r[0]/o,l)/this.worldSize,t.number(a,s,l)/this.worldSize)},Sr.prototype.coordinatePoint=function(e){var n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix),new t.Point(n[0]/n[3],n[1]/n[3])},Sr.prototype.getBounds=function(){return(new t.LngLatBounds).extend(this.pointLocation(new t.Point(0,0))).extend(this.pointLocation(new t.Point(this.width,0))).extend(this.pointLocation(new t.Point(this.width,this.height))).extend(this.pointLocation(new t.Point(0,this.height)))},Sr.prototype.getMaxBounds=function(){return this.latRange&&2===this.latRange.length&&this.lngRange&&2===this.lngRange.length?new t.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Sr.prototype.setMaxBounds=function(t){t?(this.lngRange=[t.getWest(),t.getEast()],this.latRange=[t.getSouth(),t.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Sr.prototype.calculatePosMatrix=function(e,n){void 0===n&&(n=!1);var r=e.key,i=n?this._alignedPosMatrixCache:this._posMatrixCache;if(i[r])return i[r];var o=e.canonical,a=this.worldSize/this.zoomScale(o.z),s=o.x+Math.pow(2,o.z)*e.wrap,u=t.identity(new Float64Array(16));return t.translate(u,u,[s*a,o.y*a,0]),t.scale(u,u,[a/t.EXTENT,a/t.EXTENT,1]),t.multiply(u,n?this.alignedProjMatrix:this.projMatrix,u),i[r]=new Float32Array(u),i[r]},Sr.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Sr.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var e,n,r,i,o=-90,a=90,s=-180,u=180,c=this.size,l=this._unmodified;if(this.latRange){var h=this.latRange;o=t.mercatorYfromLat(h[1])*this.worldSize,e=(a=t.mercatorYfromLat(h[0])*this.worldSize)-o<c.y?c.y/(a-o):0}if(this.lngRange){var f=this.lngRange;s=t.mercatorXfromLng(f[0])*this.worldSize,n=(u=t.mercatorXfromLng(f[1])*this.worldSize)-s<c.x?c.x/(u-s):0}var p=this.point,d=Math.max(n||0,e||0);if(d)return this.center=this.unproject(new t.Point(n?(u+s)/2:p.x,e?(a+o)/2:p.y)),this.zoom+=this.scaleZoom(d),this._unmodified=l,void(this._constraining=!1);if(this.latRange){var v=p.y,m=c.y/2;v-m<o&&(i=o+m),v+m>a&&(i=a-m)}if(this.lngRange){var g=p.x,y=c.x/2;g-y<s&&(r=s+y),g+y>u&&(r=u-y)}void 0===r&&void 0===i||(this.center=this.unproject(new t.Point(void 0!==r?r:p.x,void 0!==i?i:p.y))),this._unmodified=l,this._constraining=!1}},Sr.prototype._calcMatrices=function(){if(this.height){var e=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var n=Math.PI/2+this._pitch,r=this._fov*(.5+e.y/this.height),i=Math.sin(r)*this.cameraToCenterDistance/Math.sin(t.clamp(Math.PI-n-r,.01,Math.PI-.01)),o=this.point,a=o.x,s=o.y,u=1.01*(Math.cos(Math.PI/2-this._pitch)*i+this.cameraToCenterDistance),c=this.height/50,l=new Float64Array(16);t.perspective(l,this._fov,this.width/this.height,c,u),l[8]=2*-e.x/this.width,l[9]=2*e.y/this.height,t.scale(l,l,[1,-1,1]),t.translate(l,l,[0,0,-this.cameraToCenterDistance]),t.rotateX(l,l,this._pitch),t.rotateZ(l,l,this.angle),t.translate(l,l,[-a,-s,0]),this.mercatorMatrix=t.scale([],l,[this.worldSize,this.worldSize,this.worldSize]),t.scale(l,l,[1,1,t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=l,this.invProjMatrix=t.invert([],this.projMatrix);var h=this.width%2/2,f=this.height%2/2,p=Math.cos(this.angle),d=Math.sin(this.angle),v=a-Math.round(a)+p*h+d*f,m=s-Math.round(s)+p*f+d*h,g=new Float64Array(l);if(t.translate(g,g,[v>.5?v-1:v,m>.5?m-1:m,0]),this.alignedProjMatrix=g,l=t.create(),t.scale(l,l,[this.width/2,-this.height/2,1]),t.translate(l,l,[1,-1,0]),this.labelPlaneMatrix=l,l=t.create(),t.scale(l,l,[1,-1,1]),t.translate(l,l,[-1,-1,0]),t.scale(l,l,[2/this.width,2/this.height,1]),this.glCoordMatrix=l,this.pixelMatrix=t.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(l=t.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=l,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Sr.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var e=this.pointCoordinate(new t.Point(0,0)),n=[e.x*this.worldSize,e.y*this.worldSize,0,1];return t.transformMat4(n,n,this.pixelMatrix)[3]/this.cameraToCenterDistance},Sr.prototype.getCameraPoint=function(){var e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.Point(0,e))},Sr.prototype.getCameraQueryGeometry=function(e){var n=this.getCameraPoint();if(1===e.length)return[e[0],n];for(var r=n.x,i=n.y,o=n.x,a=n.y,s=0,u=e;s<u.length;s+=1){var c=u[s];r=Math.min(r,c.x),i=Math.min(i,c.y),o=Math.max(o,c.x),a=Math.max(a,c.y)}return[new t.Point(r,i),new t.Point(o,i),new t.Point(o,a),new t.Point(r,a),new t.Point(r,i)]},Object.defineProperties(Sr.prototype,Ar);var Tr=function(e){var n,r,i,o;this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(n=this._updateHashUnthrottled.bind(this),r=!1,i=null,o=function(){i=null,r&&(n(),i=setTimeout(o,300),r=!1)},function(){return r=!0,i||o(),i})};Tr.prototype.addTo=function(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},Tr.prototype.remove=function(){return t.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},Tr.prototype.getHashString=function(e){var n=this._map.getCenter(),r=Math.round(100*this._map.getZoom())/100,i=Math.ceil((r*Math.LN2+Math.log(512/360/.5))/Math.LN10),o=Math.pow(10,i),a=Math.round(n.lng*o)/o,s=Math.round(n.lat*o)/o,u=this._map.getBearing(),c=this._map.getPitch(),l="";if(l+=e?"/"+a+"/"+s+"/"+r:r+"/"+s+"/"+a,(u||c)&&(l+="/"+Math.round(10*u)/10),c&&(l+="/"+Math.round(c)),this._hashName){var h=this._hashName,f=!1,p=t.window.location.hash.slice(1).split("&").map((function(t){var e=t.split("=")[0];return e===h?(f=!0,e+"="+l):t})).filter((function(t){return t}));return f||p.push(h+"="+l),"#"+p.join("&")}return"#"+l},Tr.prototype._getCurrentHash=function(){var e,n=this,r=t.window.location.hash.replace("#","");return this._hashName?(r.split("&").map((function(t){return t.split("=")})).forEach((function(t){t[0]===n._hashName&&(e=t)})),(e&&e[1]||"").split("/")):r.split("/")},Tr.prototype._onHashChange=function(){var t=this._getCurrentHash();if(t.length>=3&&!t.some((function(t){return isNaN(t)}))){var e=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(t[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:e,pitch:+(t[4]||0)}),!0}return!1},Tr.prototype._updateHashUnthrottled=function(){var e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());try{t.window.history.replaceState(t.window.history.state,null,e)}catch(t){}};var Cr={linearity:.3,easing:t.bezier(0,0,.3,1)},kr=t.extend({deceleration:2500,maxSpeed:1400},Cr),Mr=t.extend({deceleration:20,maxSpeed:1400},Cr),Pr=t.extend({deceleration:1e3,maxSpeed:360},Cr),Ir=t.extend({deceleration:1e3,maxSpeed:90},Cr),Rr=function(t){this._map=t,this.clear()};function Lr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Or(e,n,r){var i=r.maxSpeed,o=r.linearity,a=r.deceleration,s=t.clamp(e*o/(n/1e3),-i,i),u=Math.abs(s)/(a*o);return{easing:r.easing,duration:1e3*u,amount:s*(u/2)}}Rr.prototype.clear=function(){this._inertiaBuffer=[]},Rr.prototype.record=function(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.browser.now(),settings:e})},Rr.prototype._drainInertiaBuffer=function(){for(var e=this._inertiaBuffer,n=t.browser.now();e.length>0&&n-e[0].time>160;)e.shift()},Rr.prototype._onMoveEnd=function(e){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var n={zoom:0,bearing:0,pitch:0,pan:new t.Point(0,0),pinchAround:void 0,around:void 0},r=0,i=this._inertiaBuffer;r<i.length;r+=1){var o=i[r].settings;n.zoom+=o.zoomDelta||0,n.bearing+=o.bearingDelta||0,n.pitch+=o.pitchDelta||0,o.panDelta&&n.pan._add(o.panDelta),o.around&&(n.around=o.around),o.pinchAround&&(n.pinchAround=o.pinchAround)}var a=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,s={};if(n.pan.mag()){var u=Or(n.pan.mag(),a,t.extend({},kr,e||{}));s.offset=n.pan.mult(u.amount/n.pan.mag()),s.center=this._map.transform.center,Lr(s,u)}if(n.zoom){var c=Or(n.zoom,a,Mr);s.zoom=this._map.transform.zoom+c.amount,Lr(s,c)}if(n.bearing){var l=Or(n.bearing,a,Pr);s.bearing=this._map.transform.bearing+t.clamp(l.amount,-179,179),Lr(s,l)}if(n.pitch){var h=Or(n.pitch,a,Ir);s.pitch=this._map.transform.pitch+h.amount,Lr(s,h)}if(s.zoom||s.bearing){var f=void 0===n.pinchAround?n.around:n.pinchAround;s.around=f?this._map.unproject(f):this._map.getCenter()}return this.clear(),t.extend(s,{noMoveStart:!0})}};var Dr=function(e){function r(r,i,o,a){void 0===a&&(a={});var s=n.mousePos(i.getCanvasContainer(),o),u=i.unproject(s);e.call(this,r,t.extend({point:s,lngLat:u,originalEvent:o},a)),this._defaultPrevented=!1,this.target=i}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),Nr=function(e){function r(r,i,o){var a="touchend"===r?o.changedTouches:o.touches,s=n.touchPos(i.getCanvasContainer(),a),u=s.map((function(t){return i.unproject(t)})),c=s.reduce((function(t,e,n,r){return t.add(e.div(r.length))}),new t.Point(0,0)),l=i.unproject(c);e.call(this,r,{points:s,point:c,lngLats:u,lngLat:l,originalEvent:o}),this._defaultPrevented=!1}e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r;var i={defaultPrevented:{configurable:!0}};return r.prototype.preventDefault=function(){this._defaultPrevented=!0},i.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(r.prototype,i),r}(t.Event),zr=function(t){function e(e,n,r){t.call(this,e,{originalEvent:r}),this._defaultPrevented=!1}t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e;var n={defaultPrevented:{configurable:!0}};return e.prototype.preventDefault=function(){this._defaultPrevented=!0},n.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(e.prototype,n),e}(t.Event),Fr=function(t,e){this._map=t,this._clickTolerance=e.clickTolerance};Fr.prototype.reset=function(){delete this._mousedownPos},Fr.prototype.wheel=function(t){return this._firePreventable(new zr(t.type,this._map,t))},Fr.prototype.mousedown=function(t,e){return this._mousedownPos=e,this._firePreventable(new Dr(t.type,this._map,t))},Fr.prototype.mouseup=function(t){this._map.fire(new Dr(t.type,this._map,t))},Fr.prototype.click=function(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||this._map.fire(new Dr(t.type,this._map,t))},Fr.prototype.dblclick=function(t){return this._firePreventable(new Dr(t.type,this._map,t))},Fr.prototype.mouseover=function(t){this._map.fire(new Dr(t.type,this._map,t))},Fr.prototype.mouseout=function(t){this._map.fire(new Dr(t.type,this._map,t))},Fr.prototype.touchstart=function(t){return this._firePreventable(new Nr(t.type,this._map,t))},Fr.prototype.touchmove=function(t){this._map.fire(new Nr(t.type,this._map,t))},Fr.prototype.touchend=function(t){this._map.fire(new Nr(t.type,this._map,t))},Fr.prototype.touchcancel=function(t){this._map.fire(new Nr(t.type,this._map,t))},Fr.prototype._firePreventable=function(t){if(this._map.fire(t),t.defaultPrevented)return{}},Fr.prototype.isEnabled=function(){return!0},Fr.prototype.isActive=function(){return!1},Fr.prototype.enable=function(){},Fr.prototype.disable=function(){};var Br=function(t){this._map=t};Br.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},Br.prototype.mousemove=function(t){this._map.fire(new Dr(t.type,this._map,t))},Br.prototype.mousedown=function(){this._delayContextMenu=!0},Br.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Dr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},Br.prototype.contextmenu=function(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Dr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()},Br.prototype.isEnabled=function(){return!0},Br.prototype.isActive=function(){return!1},Br.prototype.enable=function(){},Br.prototype.disable=function(){};var Ur=function(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1};function jr(t,e){for(var n={},r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}Ur.prototype.isEnabled=function(){return!!this._enabled},Ur.prototype.isActive=function(){return!!this._active},Ur.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},Ur.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Ur.prototype.mousedown=function(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(n.disableDrag(),this._startPos=this._lastPos=e,this._active=!0)},Ur.prototype.mousemoveWindow=function(t,e){if(this._active){var r=e;if(!(this._lastPos.equals(r)||!this._box&&r.dist(this._startPos)<this._clickTolerance)){var i=this._startPos;this._lastPos=r,this._box||(this._box=n.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));var o=Math.min(i.x,r.x),a=Math.max(i.x,r.x),s=Math.min(i.y,r.y),u=Math.max(i.y,r.y);n.setTransform(this._box,"translate("+o+"px,"+s+"px)"),this._box.style.width=a-o+"px",this._box.style.height=u-s+"px"}}},Ur.prototype.mouseupWindow=function(e,r){var i=this;if(this._active&&0===e.button){var o=this._startPos,a=r;if(this.reset(),n.suppressClick(),o.x!==a.x||o.y!==a.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:function(t){return t.fitScreenCoordinates(o,a,i._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",e)}},Ur.prototype.keydown=function(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))},Ur.prototype.blur=function(){this.reset()},Ur.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(n.remove(this._box),this._box=null),n.enableDrag(),delete this._startPos,delete this._lastPos},Ur.prototype._fireEvent=function(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))};var Zr=function(t){this.reset(),this.numTouches=t.numTouches};Zr.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Zr.prototype.touchstart=function(e,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(void 0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){for(var n=new t.Point(0,0),r=0,i=e;r<i.length;r+=1)n._add(i[r]);return n.div(e.length)}(n),this.touches=jr(r,n)))},Zr.prototype.touchmove=function(t,e,n){if(!this.aborted&&this.centroid){var r=jr(n,e);for(var i in this.touches){var o=r[i];(!o||o.dist(this.touches[i])>30)&&(this.aborted=!0)}}},Zr.prototype.touchend=function(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){var r=!this.aborted&&this.centroid;if(this.reset(),r)return r}};var Vr=function(t){this.singleTap=new Zr(t),this.numTaps=t.numTaps,this.reset()};Vr.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},Vr.prototype.touchstart=function(t,e,n){this.singleTap.touchstart(t,e,n)},Vr.prototype.touchmove=function(t,e,n){this.singleTap.touchmove(t,e,n)},Vr.prototype.touchend=function(t,e,n){var r=this.singleTap.touchend(t,e,n);if(r){var i=t.timeStamp-this.lastTime<500,o=!this.lastTap||this.lastTap.dist(r)<30;if(i&&o||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}};var Gr=function(){this._zoomIn=new Vr({numTouches:1,numTaps:2}),this._zoomOut=new Vr({numTouches:2,numTaps:1}),this.reset()};Gr.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},Gr.prototype.touchstart=function(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)},Gr.prototype.touchmove=function(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)},Gr.prototype.touchend=function(t,e,n){var r=this,i=this._zoomIn.touchend(t,e,n),o=this._zoomOut.touchend(t,e,n);return i?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(i)},{originalEvent:t})}}):o?(this._active=!0,t.preventDefault(),setTimeout((function(){return r.reset()}),0),{cameraAnimation:function(e){return e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(o)},{originalEvent:t})}}):void 0},Gr.prototype.touchcancel=function(){this.reset()},Gr.prototype.enable=function(){this._enabled=!0},Gr.prototype.disable=function(){this._enabled=!1,this.reset()},Gr.prototype.isEnabled=function(){return this._enabled},Gr.prototype.isActive=function(){return this._active};var Hr={0:1,2:2},Wr=function(t){this.reset(),this._clickTolerance=t.clickTolerance||1};Wr.prototype.blur=function(){this.reset()},Wr.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},Wr.prototype._correctButton=function(t,e){return!1},Wr.prototype._move=function(t,e){return{}},Wr.prototype.mousedown=function(t,e){if(!this._lastPoint){var r=n.mouseButton(t);this._correctButton(t,r)&&(this._lastPoint=e,this._eventButton=r)}},Wr.prototype.mousemoveWindow=function(t,e){var n=this._lastPoint;if(n)if(t.preventDefault(),function(t,e){var n=Hr[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(n,e)},Wr.prototype.mouseupWindow=function(t){this._lastPoint&&n.mouseButton(t)===this._eventButton&&(this._moved&&n.suppressClick(),this.reset())},Wr.prototype.enable=function(){this._enabled=!0},Wr.prototype.disable=function(){this._enabled=!1,this.reset()},Wr.prototype.isEnabled=function(){return this._enabled},Wr.prototype.isActive=function(){return this._active};var qr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.mousedown=function(e,n){t.prototype.mousedown.call(this,e,n),this._lastPoint&&(this._active=!0)},e.prototype._correctButton=function(t,e){return 0===e&&!t.ctrlKey},e.prototype._move=function(t,e){return{around:e,panDelta:e.sub(t)}},e}(Wr),Xr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=.8*(e.x-t.x);if(n)return this._active=!0,{bearingDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Wr),Yr=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype._correctButton=function(t,e){return 0===e&&t.ctrlKey||2===e},e.prototype._move=function(t,e){var n=-.5*(e.y-t.y);if(n)return this._active=!0,{pitchDelta:n}},e.prototype.contextmenu=function(t){t.preventDefault()},e}(Wr),Kr=function(t){this._minTouches=1,this._clickTolerance=t.clickTolerance||1,this.reset()};Kr.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new t.Point(0,0)},Kr.prototype.touchstart=function(t,e,n){return this._calculateTransform(t,e,n)},Kr.prototype.touchmove=function(t,e,n){if(this._active&&!(n.length<this._minTouches))return t.preventDefault(),this._calculateTransform(t,e,n)},Kr.prototype.touchend=function(t,e,n){this._calculateTransform(t,e,n),this._active&&n.length<this._minTouches&&this.reset()},Kr.prototype.touchcancel=function(){this.reset()},Kr.prototype._calculateTransform=function(e,n,r){r.length>0&&(this._active=!0);var i=jr(r,n),o=new t.Point(0,0),a=new t.Point(0,0),s=0;for(var u in i){var c=i[u],l=this._touches[u];l&&(o._add(c),a._add(c.sub(l)),s++,i[u]=c)}if(this._touches=i,!(s<this._minTouches)&&a.mag()){var h=a.div(s);if(this._sum._add(h),!(this._sum.mag()<this._clickTolerance))return{around:o.div(s),panDelta:h}}},Kr.prototype.enable=function(){this._enabled=!0},Kr.prototype.disable=function(){this._enabled=!1,this.reset()},Kr.prototype.isEnabled=function(){return this._enabled},Kr.prototype.isActive=function(){return this._active};var Qr=function(){this.reset()};function Jr(t,e,n){for(var r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function $r(t,e){return Math.log(t/e)/Math.LN2}Qr.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Qr.prototype._start=function(t){},Qr.prototype._move=function(t,e,n){return{}},Qr.prototype.touchstart=function(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))},Qr.prototype.touchmove=function(t,e,n){if(this._firstTwoTouches){t.preventDefault();var r=this._firstTwoTouches,i=r[1],o=Jr(n,e,r[0]),a=Jr(n,e,i);if(o&&a){var s=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],s,t)}}},Qr.prototype.touchend=function(t,e,r){if(this._firstTwoTouches){var i=this._firstTwoTouches,o=i[1],a=Jr(r,e,i[0]),s=Jr(r,e,o);a&&s||(this._active&&n.suppressClick(),this.reset())}},Qr.prototype.touchcancel=function(){this.reset()},Qr.prototype.enable=function(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around},Qr.prototype.disable=function(){this._enabled=!1,this.reset()},Qr.prototype.isEnabled=function(){return this._enabled},Qr.prototype.isActive=function(){return this._active};var ti=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._distance,delete this._startDistance},e.prototype._start=function(t){this._startDistance=this._distance=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs($r(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:$r(this._distance,n),pinchAround:e}},e}(Qr);function ei(t,e){return 180*t.angleWith(e)/Math.PI}var ni=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},e.prototype._start=function(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])},e.prototype._move=function(t,e){var n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:ei(this._vector,n),pinchAround:e}},e.prototype._isBelowThreshold=function(t){this._minDiameter=Math.min(this._minDiameter,t.mag());var e=25/(Math.PI*this._minDiameter)*360,n=ei(t,this._startVector);return Math.abs(n)<e},e}(Qr);function ri(t){return Math.abs(t.y)>Math.abs(t.x)}var ii=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e.prototype.reset=function(){t.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},e.prototype._start=function(t){this._lastPoints=t,ri(t[0].sub(t[1]))&&(this._valid=!1)},e.prototype._move=function(t,e,n){var r=t[0].sub(this._lastPoints[0]),i=t[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(r,i,n.timeStamp),this._valid)return this._lastPoints=t,this._active=!0,{pitchDelta:(r.y+i.y)/2*-.5}},e.prototype.gestureBeginsVertically=function(t,e,n){if(void 0!==this._valid)return this._valid;var r=t.mag()>=2,i=e.mag()>=2;if(r||i){if(!r||!i)return void 0===this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;var o=t.y>0==e.y>0;return ri(t)&&ri(e)&&o}},e}(Qr),oi={panStep:100,bearingStep:15,pitchStep:10},ai=function(){var t=oi;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1};function si(t){return t*(2-t)}ai.prototype.blur=function(){this.reset()},ai.prototype.reset=function(){this._active=!1},ai.prototype.keydown=function(t){var e=this;if(!(t.altKey||t.ctrlKey||t.metaKey)){var n=0,r=0,i=0,o=0,a=0;switch(t.keyCode){case 61:case 107:case 171:case 187:n=1;break;case 189:case 109:case 173:n=-1;break;case 37:t.shiftKey?r=-1:(t.preventDefault(),o=-1);break;case 39:t.shiftKey?r=1:(t.preventDefault(),o=1);break;case 38:t.shiftKey?i=1:(t.preventDefault(),a=-1);break;case 40:t.shiftKey?i=-1:(t.preventDefault(),a=1);break;default:return}return this._rotationDisabled&&(r=0,i=0),{cameraAnimation:function(s){var u=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:si,zoom:n?Math.round(u)+n*(t.shiftKey?2:1):u,bearing:s.getBearing()+r*e._bearingStep,pitch:s.getPitch()+i*e._pitchStep,offset:[-o*e._panStep,-a*e._panStep],center:s.getCenter()},{originalEvent:t})}}}},ai.prototype.enable=function(){this._enabled=!0},ai.prototype.disable=function(){this._enabled=!1,this.reset()},ai.prototype.isEnabled=function(){return this._enabled},ai.prototype.isActive=function(){return this._active},ai.prototype.disableRotation=function(){this._rotationDisabled=!0},ai.prototype.enableRotation=function(){this._rotationDisabled=!1};var ui=function(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,t.bindAll(["_onTimeout"],this)};ui.prototype.setZoomRate=function(t){this._defaultZoomRate=t},ui.prototype.setWheelZoomRate=function(t){this._wheelZoomRate=t},ui.prototype.isEnabled=function(){return!!this._enabled},ui.prototype.isActive=function(){return!!this._active||void 0!==this._finishTimeout},ui.prototype.isZooming=function(){return!!this._zooming},ui.prototype.enable=function(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=t&&"center"===t.around)},ui.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ui.prototype.wheel=function(e){if(this.isEnabled()){var n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY,r=t.browser.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%4.000244140625==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}},ui.prototype._onTimeout=function(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)},ui.prototype._start=function(e){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var r=n.mousePos(this._el,e);this._around=t.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(r)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},ui.prototype.renderFrame=function(){var e=this;if(this._frameId&&(this._frameId=null,this.isActive())){var n=this._map.transform;if(0!==this._delta){var r="wheel"===this._type&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,i=2/(1+Math.exp(-Math.abs(this._delta*r)));this._delta<0&&0!==i&&(i=1/i);var o="number"==typeof this._targetZoom?n.zoomScale(this._targetZoom):n.scale;this._targetZoom=Math.min(n.maxZoom,Math.max(n.minZoom,n.scaleZoom(o*i))),"wheel"===this._type&&(this._startZoom=n.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var a,s="number"==typeof this._targetZoom?this._targetZoom:n.zoom,u=this._startZoom,c=this._easing,l=!1;if("wheel"===this._type&&u&&c){var h=Math.min((t.browser.now()-this._lastWheelEventTime)/200,1),f=c(h);a=t.number(u,s,f),h<1?this._frameId||(this._frameId=!0):l=!0}else a=s,l=!0;return this._active=!0,l&&(this._active=!1,this._finishTimeout=setTimeout((function(){e._zooming=!1,e._handler._triggerRenderFrame(),delete e._targetZoom,delete e._finishTimeout}),200)),{noInertia:!0,needsRenderFrame:!l,zoomDelta:a-n.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},ui.prototype._smoothOutEasing=function(e){var n=t.ease;if(this._prevEase){var r=this._prevEase,i=(t.browser.now()-r.start)/r.duration,o=r.easing(i+.01)-r.easing(i),a=.27/Math.sqrt(o*o+1e-4)*.01,s=Math.sqrt(.0729-a*a);n=t.bezier(a,s,.25,1)}return this._prevEase={start:t.browser.now(),duration:e,easing:n},n},ui.prototype.blur=function(){this.reset()},ui.prototype.reset=function(){this._active=!1};var ci=function(t,e){this._clickZoom=t,this._tapZoom=e};ci.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},ci.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},ci.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},ci.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var li=function(){this.reset()};li.prototype.reset=function(){this._active=!1},li.prototype.blur=function(){this.reset()},li.prototype.dblclick=function(t,e){return t.preventDefault(),{cameraAnimation:function(n){n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}},li.prototype.enable=function(){this._enabled=!0},li.prototype.disable=function(){this._enabled=!1,this.reset()},li.prototype.isEnabled=function(){return this._enabled},li.prototype.isActive=function(){return this._active};var hi=function(){this._tap=new Vr({numTouches:1,numTaps:1}),this.reset()};hi.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},hi.prototype.touchstart=function(t,e,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=e[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,e,n))},hi.prototype.touchmove=function(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;var r=e[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,n)},hi.prototype.touchend=function(t,e,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(t,e,n)&&(this._tapTime=t.timeStamp)},hi.prototype.touchcancel=function(){this.reset()},hi.prototype.enable=function(){this._enabled=!0},hi.prototype.disable=function(){this._enabled=!1,this.reset()},hi.prototype.isEnabled=function(){return this._enabled},hi.prototype.isActive=function(){return this._active};var fi=function(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n};fi.prototype.enable=function(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},fi.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},fi.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},fi.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var pi=function(t,e,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=n};pi.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},pi.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},pi.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},pi.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var di=function(t,e,n,r){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0};di.prototype.enable=function(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},di.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},di.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},di.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},di.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},di.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var vi=function(t){return t.zoom||t.drag||t.pitch||t.rotate},mi=function(t){function e(){t.apply(this,arguments)}return t&&(e.__proto__=t),(e.prototype=Object.create(t&&t.prototype)).constructor=e,e}(t.Event);function gi(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}var yi=function(e,r){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Rr(e),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(r),t.bindAll(["handleEvent","handleWindowEvent"],this);var i=this._el;this._listeners=[[i,"touchstart",{passive:!0}],[i,"touchmove",{passive:!1}],[i,"touchend",void 0],[i,"touchcancel",void 0],[i,"mousedown",void 0],[i,"mousemove",void 0],[i,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[i,"mouseover",void 0],[i,"mouseout",void 0],[i,"dblclick",void 0],[i,"click",void 0],[i,"keydown",{capture:!1}],[i,"keyup",void 0],[i,"wheel",{passive:!1}],[i,"contextmenu",void 0],[t.window,"blur",void 0]];for(var o=0,a=this._listeners;o<a.length;o+=1){var s=a[o],u=s[0];n.addEventListener(u,s[1],u===t.window.document?this.handleWindowEvent:this.handleEvent,s[2])}};yi.prototype.destroy=function(){for(var e=0,r=this._listeners;e<r.length;e+=1){var i=r[e],o=i[0];n.removeEventListener(o,i[1],o===t.window.document?this.handleWindowEvent:this.handleEvent,i[2])}},yi.prototype._addDefaultHandlers=function(t){var e=this._map,n=e.getCanvasContainer();this._add("mapEvent",new Fr(e,t));var r=e.boxZoom=new Ur(e,t);this._add("boxZoom",r);var i=new Gr,o=new li;e.doubleClickZoom=new ci(o,i),this._add("tapZoom",i),this._add("clickZoom",o);var a=new hi;this._add("tapDragZoom",a);var s=e.touchPitch=new ii;this._add("touchPitch",s);var u=new Xr(t),c=new Yr(t);e.dragRotate=new pi(t,u,c),this._add("mouseRotate",u,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);var l=new qr(t),h=new Kr(t);e.dragPan=new fi(n,l,h),this._add("mousePan",l),this._add("touchPan",h,["touchZoom","touchRotate"]);var f=new ni,p=new ti;e.touchZoomRotate=new di(n,p,f,a),this._add("touchRotate",f,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]);var d=e.scrollZoom=new ui(e,this);this._add("scrollZoom",d,["mousePan"]);var v=e.keyboard=new ai;this._add("keyboard",v),this._add("blockableMapEvent",new Br(e));for(var m=0,g=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];m<g.length;m+=1){var y=g[m];t.interactive&&t[y]&&e[y].enable(t[y])}},yi.prototype._add=function(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e},yi.prototype.stop=function(t){if(!this._updatingCamera){for(var e=0,n=this._handlers;e<n.length;e+=1)n[e].handler.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}},yi.prototype.isActive=function(){for(var t=0,e=this._handlers;t<e.length;t+=1)if(e[t].handler.isActive())return!0;return!1},yi.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},yi.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},yi.prototype.isMoving=function(){return Boolean(vi(this._eventsInProgress))||this.isZooming()},yi.prototype._blockedByActive=function(t,e,n){for(var r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1},yi.prototype.handleWindowEvent=function(t){this.handleEvent(t,t.type+"Window")},yi.prototype._getMapTouches=function(t){for(var e=[],n=0,r=t;n<r.length;n+=1){var i=r[n];this._el.contains(i.target)&&e.push(i)}return e},yi.prototype.handleEvent=function(t,e){this._updatingCamera=!0;for(var r="renderFrame"===t.type?void 0:t,i={needsRenderFrame:!1},o={},a={},s=t.touches?this._getMapTouches(t.touches):void 0,u=s?n.touchPos(this._el,s):n.mousePos(this._el,t),c=0,l=this._handlers;c<l.length;c+=1){var h=l[c],f=h.handlerName,p=h.handler,d=h.allowed;if(p.isEnabled()){var v=void 0;this._blockedByActive(a,d,f)?p.reset():p[e||t.type]&&(v=p[e||t.type](t,u,s),this.mergeHandlerResult(i,o,v,f,r),v&&v.needsRenderFrame&&this._triggerRenderFrame()),(v||p.isActive())&&(a[f]=p)}}var m={};for(var g in this._previousActiveHandlers)a[g]||(m[g]=r);this._previousActiveHandlers=a,(Object.keys(m).length||gi(i))&&(this._changes.push([i,o,m]),this._triggerRenderFrame()),(Object.keys(a).length||gi(i))&&this._map._stop(!0),this._updatingCamera=!1;var y=i.cameraAnimation;y&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],y(this._map))},yi.prototype.mergeHandlerResult=function(e,n,r,i,o){if(r){t.extend(e,r);var a={handlerName:i,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(n.zoom=a),void 0!==r.panDelta&&(n.drag=a),void 0!==r.pitchDelta&&(n.pitch=a),void 0!==r.bearingDelta&&(n.rotate=a)}},yi.prototype._applyChanges=function(){for(var e={},n={},r={},i=0,o=this._changes;i<o.length;i+=1){var a=o[i],s=a[0],u=a[1],c=a[2];s.panDelta&&(e.panDelta=(e.panDelta||new t.Point(0,0))._add(s.panDelta)),s.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+s.zoomDelta),s.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+s.bearingDelta),s.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+s.pitchDelta),void 0!==s.around&&(e.around=s.around),void 0!==s.pinchAround&&(e.pinchAround=s.pinchAround),s.noInertia&&(e.noInertia=s.noInertia),t.extend(n,u),t.extend(r,c)}this._updateMapTransform(e,n,r),this._changes=[]},yi.prototype._updateMapTransform=function(t,e,n){var r=this._map,i=r.transform;if(!gi(t))return this._fireEvents(e,n,!0);var o=t.panDelta,a=t.zoomDelta,s=t.bearingDelta,u=t.pitchDelta,c=t.around,l=t.pinchAround;void 0!==l&&(c=l),r._stop(!0),c=c||r.transform.centerPoint;var h=i.pointLocation(o?c.sub(o):c);s&&(i.bearing+=s),u&&(i.pitch+=u),a&&(i.zoom+=a),i.setLocationAtPoint(h,c),this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(e,n,!0)},yi.prototype._fireEvents=function(e,n,r){var i=this,o=vi(this._eventsInProgress),a=vi(e),s={};for(var u in e)this._eventsInProgress[u]||(s[u+"start"]=e[u].originalEvent),this._eventsInProgress[u]=e[u];for(var c in!o&&a&&this._fireEvent("movestart",a.originalEvent),s)this._fireEvent(c,s[c]);for(var l in a&&this._fireEvent("move",a.originalEvent),e)this._fireEvent(l,e[l].originalEvent);var h,f={};for(var p in this._eventsInProgress){var d=this._eventsInProgress[p],v=d.handlerName,m=d.originalEvent;this._handlersById[v].isActive()||(delete this._eventsInProgress[p],f[p+"end"]=h=n[v]||m)}for(var g in f)this._fireEvent(g,f[g]);var y=vi(this._eventsInProgress);if(r&&(o||a)&&!y){this._updatingCamera=!0;var _=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),x=function(t){return 0!==t&&-i._bearingSnap<t&&t<i._bearingSnap};_?(x(_.bearing||this._map.getBearing())&&(_.bearing=0),this._map.easeTo(_,{originalEvent:h})):(this._map.fire(new t.Event("moveend",{originalEvent:h})),x(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},yi.prototype._fireEvent=function(e,n){this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))},yi.prototype._requestFrame=function(){var t=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add((function(e){delete t._frameId,t.handleEvent(new mi("renderFrame",{timeStamp:e})),t._applyChanges()}))},yi.prototype._triggerRenderFrame=function(){void 0===this._frameId&&(this._frameId=this._requestFrame())};var _i=function(e){function n(n,r){e.call(this),this._moving=!1,this._zooming=!1,this.transform=n,this._bearingSnap=r.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}return e&&(n.__proto__=e),(n.prototype=Object.create(e&&e.prototype)).constructor=n,n.prototype.getCenter=function(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)},n.prototype.setCenter=function(t,e){return this.jumpTo({center:t},e)},n.prototype.panBy=function(e,n,r){return e=t.Point.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),r)},n.prototype.panTo=function(e,n,r){return this.easeTo(t.extend({center:e},n),r)},n.prototype.getZoom=function(){return this.transform.zoom},n.prototype.setZoom=function(t,e){return this.jumpTo({zoom:t},e),this},n.prototype.zoomTo=function(e,n,r){return this.easeTo(t.extend({zoom:e},n),r)},n.prototype.zoomIn=function(t,e){return this.zoomTo(this.getZoom()+1,t,e),this},n.prototype.zoomOut=function(t,e){return this.zoomTo(this.getZoom()-1,t,e),this},n.prototype.getBearing=function(){return this.transform.bearing},n.prototype.setBearing=function(t,e){return this.jumpTo({bearing:t},e),this},n.prototype.getPadding=function(){return this.transform.padding},n.prototype.setPadding=function(t,e){return this.jumpTo({padding:t},e),this},n.prototype.rotateTo=function(e,n,r){return this.easeTo(t.extend({bearing:e},n),r)},n.prototype.resetNorth=function(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this},n.prototype.resetNorthPitch=function(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this},n.prototype.snapToNorth=function(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this},n.prototype.getPitch=function(){return this.transform.pitch},n.prototype.setPitch=function(t,e){return this.jumpTo({pitch:t},e),this},n.prototype.cameraForBounds=function(e,n){e=t.LngLatBounds.convert(e);var r=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),r,n)},n.prototype._cameraForBoxAndBearing=function(e,n,r,i){var o={top:0,bottom:0,right:0,left:0};if("number"==typeof(i=t.extend({padding:o,offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding){var a=i.padding;i.padding={top:a,bottom:a,right:a,left:a}}i.padding=t.extend(o,i.padding);var s=this.transform,u=s.padding,c=s.project(t.LngLat.convert(e)),l=s.project(t.LngLat.convert(n)),h=c.rotate(-r*Math.PI/180),f=l.rotate(-r*Math.PI/180),p=new t.Point(Math.max(h.x,f.x),Math.max(h.y,f.y)),d=new t.Point(Math.min(h.x,f.x),Math.min(h.y,f.y)),v=p.sub(d),m=(s.width-(u.left+u.right+i.padding.left+i.padding.right))/v.x,g=(s.height-(u.top+u.bottom+i.padding.top+i.padding.bottom))/v.y;if(!(g<0||m<0)){var y=Math.min(s.scaleZoom(s.scale*Math.min(m,g)),i.maxZoom),_="number"==typeof i.offset.x?new t.Point(i.offset.x,i.offset.y):t.Point.convert(i.offset),x=new t.Point((i.padding.left-i.padding.right)/2,(i.padding.top-i.padding.bottom)/2).rotate(r*Math.PI/180),b=_.add(x).mult(s.scale/s.zoomScale(y));return{center:s.unproject(c.add(l).div(2).sub(b)),zoom:y,bearing:r}}t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},n.prototype.fitBounds=function(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)},n.prototype.fitScreenCoordinates=function(e,n,r,i,o){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(t.Point.convert(e)),this.transform.pointLocation(t.Point.convert(n)),r,i),i,o)},n.prototype._fitInternal=function(e,n,r){return e?(delete(n=t.extend(e,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this},n.prototype.jumpTo=function(e,n){this.stop();var r=this.transform,i=!1,o=!1,a=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(i=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(a=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),i&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),o&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),a&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n))},n.prototype.easeTo=function(e,n){var r=this;this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.browser.prefersReducedMotion)&&(e.duration=0);var i=this.transform,o=this.getZoom(),a=this.getBearing(),s=this.getPitch(),u=this.getPadding(),c="zoom"in e?+e.zoom:o,l="bearing"in e?this._normalizeBearing(e.bearing,a):a,h="pitch"in e?+e.pitch:s,f="padding"in e?e.padding:i.padding,p=t.Point.convert(e.offset),d=i.centerPoint.add(p),v=i.pointLocation(d),m=t.LngLat.convert(e.center||v);this._normalizeCenter(m);var g,y,_=i.project(v),x=i.project(m).sub(_),b=i.zoomScale(c-o);e.around&&(g=t.LngLat.convert(e.around),y=i.locationPoint(g));var w={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||c!==o,this._rotating=this._rotating||a!==l,this._pitching=this._pitching||h!==s,this._padding=!i.isPaddingEqual(f),this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,w),this._ease((function(e){if(r._zooming&&(i.zoom=t.number(o,c,e)),r._rotating&&(i.bearing=t.number(a,l,e)),r._pitching&&(i.pitch=t.number(s,h,e)),r._padding&&(i.interpolatePadding(u,f,e),d=i.centerPoint.add(p)),g)i.setLocationAtPoint(g,y);else{var v=i.zoomScale(i.zoom-o),m=c>o?Math.min(2,b):Math.max(.5,b),w=Math.pow(m,1-e),E=i.unproject(_.add(x.mult(e*w)).mult(v));i.setLocationAtPoint(i.renderWorldCopies?E.wrap():E,d)}r._fireMoveEvents(n)}),(function(t){r._afterEase(n,t)}),e),this},n.prototype._prepareEase=function(e,n,r){void 0===r&&(r={}),this._moving=!0,n||r.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.Event("pitchstart",e))},n.prototype._fireMoveEvents=function(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))},n.prototype._afterEase=function(e,n){if(!this._easeId||!n||this._easeId!==n){delete this._easeId;var r=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}},n.prototype.flyTo=function(e,n){var r=this;if(!e.essential&&t.browser.prefersReducedMotion){var i=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(i,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);var o=this.transform,a=this.getZoom(),s=this.getBearing(),u=this.getPitch(),c=this.getPadding(),l="zoom"in e?t.clamp(+e.zoom,o.minZoom,o.maxZoom):a,h="bearing"in e?this._normalizeBearing(e.bearing,s):s,f="pitch"in e?+e.pitch:u,p="padding"in e?e.padding:o.padding,d=o.zoomScale(l-a),v=t.Point.convert(e.offset),m=o.centerPoint.add(v),g=o.pointLocation(m),y=t.LngLat.convert(e.center||g);this._normalizeCenter(y);var _=o.project(g),x=o.project(y).sub(_),b=e.curve,w=Math.max(o.width,o.height),E=w/d,S=x.mag();if("minZoom"in e){var A=t.clamp(Math.min(e.minZoom,a,l),o.minZoom,o.maxZoom),T=w/o.zoomScale(A-a);b=Math.sqrt(T/S*2)}var C=b*b;function k(t){var e=(E*E-w*w+(t?-1:1)*C*C*S*S)/(2*(t?E:w)*C*S);return Math.log(Math.sqrt(e*e+1)-e)}function M(t){return(Math.exp(t)-Math.exp(-t))/2}function P(t){return(Math.exp(t)+Math.exp(-t))/2}var I=k(0),R=function(t){return P(I)/P(I+b*t)},L=function(t){return w*((P(I)*(M(e=I+b*t)/P(e))-M(I))/C)/S;var e},O=(k(1)-I)/b;if(Math.abs(S)<1e-6||!isFinite(O)){if(Math.abs(w-E)<1e-6)return this.easeTo(e,n);var D=E<w?-1:1;O=Math.abs(Math.log(E/w))/b,L=function(){return 0},R=function(t){return Math.exp(D*b*t)}}return e.duration="duration"in e?+e.duration:1e3*O/("screenSpeed"in e?+e.screenSpeed/b:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0),this._zooming=!0,this._rotating=s!==h,this._pitching=f!==u,this._padding=!o.isPaddingEqual(p),this._prepareEase(n,!1),this._ease((function(e){var i=e*O,d=1/R(i);o.zoom=1===e?l:a+o.scaleZoom(d),r._rotating&&(o.bearing=t.number(s,h,e)),r._pitching&&(o.pitch=t.number(u,f,e)),r._padding&&(o.interpolatePadding(c,p,e),m=o.centerPoint.add(v));var g=1===e?y:o.unproject(_.add(x.mult(L(i))).mult(d));o.setLocationAtPoint(o.renderWorldCopies?g.wrap():g,m),r._fireMoveEvents(n)}),(function(){return r._afterEase(n)}),e),this},n.prototype.isEasing=function(){return!!this._easeFrameId},n.prototype.stop=function(){return this._stop()},n.prototype._stop=function(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var n=this._onEaseEnd;delete this._onEaseEnd,n.call(this,e)}if(!t){var r=this.handlers;r&&r.stop(!1)}return this},n.prototype._ease=function(e,n,r){!1===r.animate||0===r.duration?(e(1),n()):(this._easeStart=t.browser.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},n.prototype._renderFrameCallback=function(){var e=Math.min((t.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},n.prototype._normalizeBearing=function(e,n){e=t.wrap(e,-180,180);var r=Math.abs(e-n);return Math.abs(e-360-n)<r&&(e-=360),Math.abs(e+360-n)<r&&(e+=360),e},n.prototype._normalizeCenter=function(t){var e=this.transform;if(e.renderWorldCopies&&!e.lngRange){var n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}},n}(t.Evented),xi=function(e){void 0===e&&(e={}),this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};xi.prototype.getDefaultPosition=function(){return"bottom-right"},xi.prototype.onAdd=function(t){var e=this.options&&this.options.compact;return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=n.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=n.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},xi.prototype.onRemove=function(){n.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},xi.prototype._setElementTitle=function(t,e){var n=this._map._getUIString("AttributionControl."+e);t.title=n,t.setAttribute("aria-label",n)},xi.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},xi.prototype._updateEditLink=function(){var e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));var n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){var r=n.reduce((function(t,e,r){return e.value&&(t+=e.key+"="+e.value+(r<n.length-1?"&":"")),t}),"?");e.href=t.config.FEEDBACK_URL+"/"+r+(this._map._hash?this._map._hash.getHashString(!0):""),e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}},xi.prototype._updateData=function(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())},xi.prototype._updateAttributions=function(){if(this._map.style){var t=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=t.concat(this.options.customAttribution.map((function(t){return"string"!=typeof t?"":t}))):"string"==typeof this.options.customAttribution&&t.push(this.options.customAttribution)),this._map.style.stylesheet){var e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}var n=this._map.style.sourceCaches;for(var r in n){var i=n[r];if(i.used){var o=i.getSource();o.attribution&&t.indexOf(o.attribution)<0&&t.push(o.attribution)}}t.sort((function(t,e){return t.length-e.length}));var a=(t=t.filter((function(e,n){for(var r=n+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}))).join(" | ");a!==this._attribHTML&&(this._attribHTML=a,t.length?(this._innerContainer.innerHTML=a,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},xi.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var bi=function(){t.bindAll(["_updateLogo"],this),t.bindAll(["_updateCompact"],this)};bi.prototype.onAdd=function(t){this._map=t,this._container=n.create("div","mapboxgl-ctrl");var e=n.create("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},bi.prototype.onRemove=function(){n.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},bi.prototype.getDefaultPosition=function(){return"bottom-left"},bi.prototype._updateLogo=function(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")},bi.prototype._logoRequired=function(){if(this._map.style){var t=this._map.style.sourceCaches;for(var e in t)if(t[e].getSource().mapbox_logo)return!0;return!1}},bi.prototype._updateCompact=function(){var t=this._container.children;if(t.length){var e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}};var wi=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};wi.prototype.add=function(t){var e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e},wi.prototype.remove=function(t){for(var e=this._currentlyRunning,n=0,r=e?this._queue.concat(e):this._queue;n<r.length;n+=1){var i=r[n];if(i.id===t)return void(i.cancelled=!0)}},wi.prototype.run=function(t){void 0===t&&(t=0);var e=this._currentlyRunning=this._queue;this._queue=[];for(var n=0,r=e;n<r.length;n+=1){var i=r[n];if(!i.cancelled&&(i.callback(t),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},wi.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var Ei={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},Si=t.window.HTMLImageElement,Ai=t.window.HTMLElement,Ti=t.window.ImageBitmap,Ci={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},ki=function(r){function i(e){var n=this;if(null!=(e=t.extend({},Ci,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var i=new Sr(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies);if(r.call(this,i,e),this._interactive=e.interactive,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._renderTaskQueue=new wi,this._controls=[],this._mapId=t.uniqueId(),this._locale=t.extend({},Ei,e.locale),this._clickTolerance=e.clickTolerance,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken),"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error("Container '"+e.container+"' not found.")}else{if(!(e.container instanceof Ai))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",(function(){return n._update(!1)})),this.on("moveend",(function(){return n._update(!1)})),this.on("zoom",(function(){return n._update(!0)})),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new yi(this,e),this._hash=e.hash&&new Tr("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localIdeographFontFamily:e.localIdeographFontFamily}),e.attributionControl&&this.addControl(new xi({customAttribution:e.customAttribution})),this.addControl(new bi,e.logoPosition),this.on("style.load",(function(){n.transform.unmodified&&n.jumpTo(n.style.stylesheet)})),this.on("data",(function(e){n._update("style"===e.dataType),n.fire(new t.Event(e.dataType+"data",e))})),this.on("dataloading",(function(e){n.fire(new t.Event(e.dataType+"dataloading",e))}))}r&&(i.__proto__=r),(i.prototype=Object.create(r&&r.prototype)).constructor=i;var a={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return i.prototype._getMapId=function(){return this._mapId},i.prototype.addControl=function(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var r=e.onAdd(this);this._controls.push(e);var i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this},i.prototype.removeControl=function(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this},i.prototype.hasControl=function(t){return this._controls.indexOf(t)>-1},i.prototype.resize=function(e){var n=this._containerDimensions(),r=n[0],i=n[1];if(r===this.transform.width&&i===this.transform.height)return this;this._resizeCanvas(r,i),this.transform.resize(r,i),this.painter.resize(r,i);var o=!this._moving;return o&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),o&&this.fire(new t.Event("moveend",e)),this},i.prototype.getBounds=function(){return this.transform.getBounds()},i.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},i.prototype.setMaxBounds=function(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()},i.prototype.setMinZoom=function(t){if((t=null==t?-2:t)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t&&this.setZoom(t),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},i.prototype.getMinZoom=function(){return this.transform.minZoom},i.prototype.setMaxZoom=function(t){if((t=null==t?22:t)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t&&this.setZoom(t),this;throw new Error("maxZoom must be greater than the current minZoom")},i.prototype.getMaxZoom=function(){return this.transform.maxZoom},i.prototype.setMinPitch=function(t){if((t=null==t?0:t)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t&&this.setPitch(t),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},i.prototype.getMinPitch=function(){return this.transform.minPitch},i.prototype.setMaxPitch=function(t){if((t=null==t?60:t)>60)throw new Error("maxPitch must be less than or equal to 60");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t&&this.setPitch(t),this;throw new Error("maxPitch must be greater than the current minPitch")},i.prototype.getMaxPitch=function(){return this.transform.maxPitch},i.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},i.prototype.setRenderWorldCopies=function(t){return this.transform.renderWorldCopies=t,this._update()},i.prototype.project=function(e){return this.transform.locationPoint(t.LngLat.convert(e))},i.prototype.unproject=function(e){return this.transform.pointLocation(t.Point.convert(e))},i.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},i.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},i.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},i.prototype._createDelegatedListener=function(t,e,n){var r,i=this;if("mouseenter"===t||"mouseover"===t){var o=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){var a=i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[];a.length?o||(o=!0,n.call(i,new Dr(t,i,r.originalEvent,{features:a}))):o=!1},mouseout:function(){o=!1}}}}if("mouseleave"===t||"mouseout"===t){var a=!1;return{layer:e,listener:n,delegates:{mousemove:function(r){(i.getLayer(e)?i.queryRenderedFeatures(r.point,{layers:[e]}):[]).length?a=!0:a&&(a=!1,n.call(i,new Dr(t,i,r.originalEvent)))},mouseout:function(e){a&&(a=!1,n.call(i,new Dr(t,i,e.originalEvent)))}}}}return{layer:e,listener:n,delegates:(r={},r[t]=function(t){var r=i.getLayer(e)?i.queryRenderedFeatures(t.point,{layers:[e]}):[];r.length&&(t.features=r,n.call(i,t),delete t.features)},r)}},i.prototype.on=function(t,e,n){if(void 0===n)return r.prototype.on.call(this,t,e);var i=this._createDelegatedListener(t,e,n);for(var o in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(i),i.delegates)this.on(o,i.delegates[o]);return this},i.prototype.once=function(t,e,n){if(void 0===n)return r.prototype.once.call(this,t,e);var i=this._createDelegatedListener(t,e,n);for(var o in i.delegates)this.once(o,i.delegates[o]);return this},i.prototype.off=function(t,e,n){var i=this;return void 0===n?r.prototype.off.call(this,t,e):(this._delegatedListeners&&this._delegatedListeners[t]&&function(r){for(var o=r[t],a=0;a<o.length;a++){var s=o[a];if(s.layer===e&&s.listener===n){for(var u in s.delegates)i.off(u,s.delegates[u]);return o.splice(a,1),i}}}(this._delegatedListeners),this)},i.prototype.queryRenderedFeatures=function(e,n){if(!this.style)return[];var r;if(void 0!==n||void 0===e||e instanceof t.Point||Array.isArray(e)||(n=e,e=void 0),n=n||{},(e=e||[[0,0],[this.transform.width,this.transform.height]])instanceof t.Point||"number"==typeof e[0])r=[t.Point.convert(e)];else{var i=t.Point.convert(e[0]),o=t.Point.convert(e[1]);r=[i,new t.Point(o.x,i.y),o,new t.Point(i.x,o.y),i]}return this.style.queryRenderedFeatures(r,n,this.transform)},i.prototype.querySourceFeatures=function(t,e){return this.style.querySourceFeatures(t,e)},i.prototype.setStyle=function(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._updateStyle(e,n))},i.prototype._getUIString=function(t){var e=this._locale[t];if(null==e)throw new Error("Missing UI string '"+t+"'");return e},i.prototype._updateStyle=function(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove()),t?(this.style=new Ge(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t),this):(delete this.style,this)},i.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ge(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},i.prototype._diffStyle=function(e,n){var r=this;if("string"==typeof e){var i=this._requestManager.normalizeStyleURL(e),a=this._requestManager.transformRequest(i,t.ResourceType.Style);t.getJSON(a,(function(e,i){e?r.fire(new t.ErrorEvent(e)):i&&r._updateDiff(i,n)}))}else"object"==o(e)&&this._updateDiff(e,n)},i.prototype._updateDiff=function(e,n){try{this.style.setState(e)&&this._update(!0)}catch(r){t.warnOnce("Unable to perform style diff: "+(r.message||r.error||r)+".  Rebuilding the style from scratch."),this._updateStyle(e,n)}},i.prototype.getStyle=function(){if(this.style)return this.style.serialize()},i.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():t.warnOnce("There is no style added to the map.")},i.prototype.addSource=function(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)},i.prototype.isSourceLoaded=function(e){var n=this.style&&this.style.sourceCaches[e];if(void 0!==n)return n.loaded();this.fire(new t.ErrorEvent(new Error("There is no source with ID '"+e+"'")))},i.prototype.areTilesLoaded=function(){var t=this.style&&this.style.sourceCaches;for(var e in t){var n=t[e]._tiles;for(var r in n){var i=n[r];if("loaded"!==i.state&&"errored"!==i.state)return!1}}return!0},i.prototype.addSourceType=function(t,e,n){return this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)},i.prototype.removeSource=function(t){return this.style.removeSource(t),this._update(!0)},i.prototype.getSource=function(t){return this.style.getSource(t)},i.prototype.addImage=function(e,n,r){void 0===r&&(r={});var i=r.pixelRatio;void 0===i&&(i=1);var o=r.sdf;void 0===o&&(o=!1);var a=r.stretchX,s=r.stretchY,u=r.content;if(this._lazyInitEmptyStyle(),n instanceof Si||Ti&&n instanceof Ti){var c=t.browser.getImageData(n);this.style.addImage(e,{data:new t.RGBAImage({width:c.width,height:c.height},c.data),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0})}else{if(void 0===n.width||void 0===n.height)return this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var l=n;this.style.addImage(e,{data:new t.RGBAImage({width:n.width,height:n.height},new Uint8Array(n.data)),pixelRatio:i,stretchX:a,stretchY:s,content:u,sdf:o,version:0,userImage:l}),l.onAdd&&l.onAdd(this,e)}},i.prototype.updateImage=function(e,n){var r=this.style.getImage(e);if(!r)return this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var i=n instanceof Si||Ti&&n instanceof Ti?t.browser.getImageData(n):n,o=i.width,a=i.height,s=i.data;return void 0===o||void 0===a?this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):o!==r.data.width||a!==r.data.height?this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(r.data.replace(s,!(n instanceof Si||Ti&&n instanceof Ti)),void this.style.updateImage(e,r))},i.prototype.hasImage=function(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)},i.prototype.removeImage=function(t){this.style.removeImage(t)},i.prototype.loadImage=function(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),n)},i.prototype.listImages=function(){return this.style.listImages()},i.prototype.addLayer=function(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)},i.prototype.moveLayer=function(t,e){return this.style.moveLayer(t,e),this._update(!0)},i.prototype.removeLayer=function(t){return this.style.removeLayer(t),this._update(!0)},i.prototype.getLayer=function(t){return this.style.getLayer(t)},i.prototype.setLayerZoomRange=function(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)},i.prototype.setFilter=function(t,e,n){return void 0===n&&(n={}),this.style.setFilter(t,e,n),this._update(!0)},i.prototype.getFilter=function(t){return this.style.getFilter(t)},i.prototype.setPaintProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setPaintProperty(t,e,n,r),this._update(!0)},i.prototype.getPaintProperty=function(t,e){return this.style.getPaintProperty(t,e)},i.prototype.setLayoutProperty=function(t,e,n,r){return void 0===r&&(r={}),this.style.setLayoutProperty(t,e,n,r),this._update(!0)},i.prototype.getLayoutProperty=function(t,e){return this.style.getLayoutProperty(t,e)},i.prototype.setLight=function(t,e){return void 0===e&&(e={}),this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)},i.prototype.getLight=function(){return this.style.getLight()},i.prototype.setFeatureState=function(t,e){return this.style.setFeatureState(t,e),this._update()},i.prototype.removeFeatureState=function(t,e){return this.style.removeFeatureState(t,e),this._update()},i.prototype.getFeatureState=function(t){return this.style.getFeatureState(t)},i.prototype.getContainer=function(){return this._container},i.prototype.getCanvasContainer=function(){return this._canvasContainer},i.prototype.getCanvas=function(){return this._canvas},i.prototype._containerDimensions=function(){var t=0,e=0;return this._container&&(t=this._container.clientWidth||400,e=this._container.clientHeight||300),[t,e]},i.prototype._detectMissingCSS=function(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},i.prototype._setupContainer=function(){var t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=n.create("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();var e=this._canvasContainer=n.create("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=n.create("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var r=this._containerDimensions();this._resizeCanvas(r[0],r[1]);var i=this._controlContainer=n.create("div","mapboxgl-control-container",t),o=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach((function(t){o[t]=n.create("div","mapboxgl-ctrl-"+t,i)})),this._container.addEventListener("scroll",this._onMapScroll,!1)},i.prototype._resizeCanvas=function(e,n){var r=t.browser.devicePixelRatio||1;this._canvas.width=r*e,this._canvas.height=r*n,this._canvas.style.width=e+"px",this._canvas.style.height=n+"px"},i.prototype._setupPainter=function(){var n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);r?(this.painter=new xr(r,this.transform),t.webpSupported.testSupport(r)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))},i.prototype._contextLost=function(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))},i.prototype._contextRestored=function(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))},i.prototype._onMapScroll=function(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},i.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},i.prototype._update=function(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this},i.prototype._requestRenderFrame=function(t){return this._update(),this._renderTaskQueue.add(t)},i.prototype._cancelRenderFrame=function(t){this._renderTaskQueue.remove(t)},i.prototype._render=function(e){var n,r=this,i=0,o=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(n=o.createQueryEXT(),o.beginQueryEXT(o.TIME_ELAPSED_EXT,n),i=t.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),!this._removed){var a=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var s=this.transform.zoom,u=t.browser.now();this.style.zoomHistory.update(s,u);var c=new t.EvaluationParameters(s,{now:u,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),l=c.crossFadingFactor();1===l&&l===this._crossFadingFactor||(a=!0,this._crossFadingFactor=l),this.style.update(c)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||a)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var h=t.browser.now()-i;o.endQueryEXT(o.TIME_ELAPSED_EXT,n),setTimeout((function(){var e=o.getQueryObjectEXT(n,o.QUERY_RESULT_EXT)/1e6;o.deleteQueryEXT(n),r.fire(new t.Event("gpu-timing-frame",{cpuTime:h,gpuTime:e}))}),50)}if(this.listens("gpu-timing-layer")){var f=this.painter.collectGpuTimers();setTimeout((function(){var e=r.painter.queryGpuTimers(f);r.fire(new t.Event("gpu-timing-layer",{layerTimes:e}))}),50)}var p=this._sourcesDirty||this._styleDirty||this._placementDirty;return p||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new t.Event("idle")),!this._loaded||this._fullyLoaded||p||(this._fullyLoaded=!0),this}},i.prototype.remove=function(){this._hash&&this._hash.remove();for(var e=0,n=this._controls;e<n.length;e+=1)n[e].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));var r=this.painter.context.gl.getExtension("WEBGL_lose_context");r&&r.loseContext(),Mi(this._canvasContainer),Mi(this._controlContainer),Mi(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new t.Event("remove"))},i.prototype.triggerRepaint=function(){var e=this;this.style&&!this._frame&&(this._frame=t.browser.frame((function(t){e._frame=null,e._render(t)})))},i.prototype._onWindowOnline=function(){this._update()},i.prototype._onWindowResize=function(t){this._trackResize&&this.resize({originalEvent:t})._update()},a.showTileBoundaries.get=function(){return!!this._showTileBoundaries},a.showTileBoundaries.set=function(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())},a.showPadding.get=function(){return!!this._showPadding},a.showPadding.set=function(t){this._showPadding!==t&&(this._showPadding=t,this._update())},a.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},a.showCollisionBoxes.set=function(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())},a.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},a.showOverdrawInspector.set=function(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())},a.repaint.get=function(){return!!this._repaint},a.repaint.set=function(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())},a.vertices.get=function(){return!!this._vertices},a.vertices.set=function(t){this._vertices=t,this._update()},i.prototype._setCacheLimits=function(e,n){t.setCacheLimits(e,n)},a.version.get=function(){return t.version},Object.defineProperties(i.prototype,a),i}(_i);function Mi(t){t.parentNode&&t.parentNode.removeChild(t)}var Pi={showCompass:!0,showZoom:!0,visualizePitch:!1},Ii=function(e){var r=this;this.options=t.extend({},Pi,e),this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(function(t){return r._map.zoomIn({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(function(t){return r._map.zoomOut({},{originalEvent:t})})),n.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(function(t){r.options.visualizePitch?r._map.resetNorthPitch({},{originalEvent:t}):r._map.resetNorth({},{originalEvent:t})})),this._compassIcon=n.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};Ii.prototype._updateZoomButtons=function(){var t=this._map.getZoom(),e=t===this._map.getMaxZoom(),n=t===this._map.getMinZoom();this._zoomInButton.disabled=e,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",e.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())},Ii.prototype._rotateCompassArrow=function(){var t=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=t},Ii.prototype.onAdd=function(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Ri(this._map,this._compass,this.options.visualizePitch)),this._container},Ii.prototype.onRemove=function(){n.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},Ii.prototype._createButton=function(t,e){var r=n.create("button",t,this._container);return r.type="button",r.addEventListener("click",e),r},Ii.prototype._setButtonTitle=function(t,e){var n=this._map._getUIString("NavigationControl."+e);t.title=n,t.setAttribute("aria-label",n)};var Ri=function(e,r,i){void 0===i&&(i=!1),this._clickTolerance=10,this.element=r,this.mouseRotate=new Xr({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,i&&(this.mousePitch=new Yr({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener(r,"mousedown",this.mousedown),n.addEventListener(r,"touchstart",this.touchstart,{passive:!1}),n.addEventListener(r,"touchmove",this.touchmove),n.addEventListener(r,"touchend",this.touchend),n.addEventListener(r,"touchcancel",this.reset)};function Li(e,n,r){if(e=new t.LngLat(e.lng,e.lat),n){var i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),a=r.locationPoint(e).distSqr(n);r.locationPoint(i).distSqr(n)<a?e=i:r.locationPoint(o).distSqr(n)<a&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){var s=r.locationPoint(e);if(s.x>=0&&s.y>=0&&s.x<=r.width&&s.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}Ri.prototype.down=function(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),n.disableDrag()},Ri.prototype.move=function(t,e){var n=this.map,r=this.mouseRotate.mousemoveWindow(t,e);if(r&&r.bearingDelta&&n.setBearing(n.getBearing()+r.bearingDelta),this.mousePitch){var i=this.mousePitch.mousemoveWindow(t,e);i&&i.pitchDelta&&n.setPitch(n.getPitch()+i.pitchDelta)}},Ri.prototype.off=function(){var t=this.element;n.removeEventListener(t,"mousedown",this.mousedown),n.removeEventListener(t,"touchstart",this.touchstart,{passive:!1}),n.removeEventListener(t,"touchmove",this.touchmove),n.removeEventListener(t,"touchend",this.touchend),n.removeEventListener(t,"touchcancel",this.reset),this.offTemp()},Ri.prototype.offTemp=function(){n.enableDrag(),n.removeEventListener(t.window,"mousemove",this.mousemove),n.removeEventListener(t.window,"mouseup",this.mouseup)},Ri.prototype.mousedown=function(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:function(){return e.preventDefault()}}),n.mousePos(this.element,e)),n.addEventListener(t.window,"mousemove",this.mousemove),n.addEventListener(t.window,"mouseup",this.mouseup)},Ri.prototype.mousemove=function(t){this.move(t,n.mousePos(this.element,t))},Ri.prototype.mouseup=function(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()},Ri.prototype.touchstart=function(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return t.preventDefault()}},this._startPos))},Ri.prototype.touchmove=function(t){1!==t.targetTouches.length?this.reset():(this._lastPos=n.touchPos(this.element,t.targetTouches)[0],this.move({preventDefault:function(){return t.preventDefault()}},this._lastPos))},Ri.prototype.touchend=function(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},Ri.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Oi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Di(t,e,n){var r=t.classList;for(var i in Oi)r.remove("mapboxgl-"+n+"-anchor-"+i);r.add("mapboxgl-"+n+"-anchor-"+e)}var Ni,zi=function(e){function r(r,i){if(e.call(this),(r instanceof t.window.HTMLElement||i)&&(r=t.extend({element:r},i)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=r&&r.anchor||"center",this._color=r&&r.color||"#3FB1CE",this._scale=r&&r.scale||1,this._draggable=r&&r.draggable||!1,this._clickTolerance=r&&r.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=r&&r.rotation||0,this._rotationAlignment=r&&r.rotationAlignment||"auto",this._pitchAlignment=r&&r.pitchAlignment&&"auto"!==r.pitchAlignment?r.pitchAlignment:this._rotationAlignment,r&&r.element)this._element=r.element,this._offset=t.Point.convert(r&&r.offset||[0,0]);else{this._defaultMarker=!0,this._element=n.create("div"),this._element.setAttribute("aria-label","Map marker");var o=n.createNS("http://www.w3.org/2000/svg","svg");o.setAttributeNS(null,"display","block"),o.setAttributeNS(null,"height","41px"),o.setAttributeNS(null,"width","27px"),o.setAttributeNS(null,"viewBox","0 0 27 41");var a=n.createNS("http://www.w3.org/2000/svg","g");a.setAttributeNS(null,"stroke","none"),a.setAttributeNS(null,"stroke-width","1"),a.setAttributeNS(null,"fill","none"),a.setAttributeNS(null,"fill-rule","evenodd");var s=n.createNS("http://www.w3.org/2000/svg","g");s.setAttributeNS(null,"fill-rule","nonzero");var u=n.createNS("http://www.w3.org/2000/svg","g");u.setAttributeNS(null,"transform","translate(3.0, 29.0)"),u.setAttributeNS(null,"fill","#000000");for(var c=0,l=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];c<l.length;c+=1){var h=l[c],f=n.createNS("http://www.w3.org/2000/svg","ellipse");f.setAttributeNS(null,"opacity","0.04"),f.setAttributeNS(null,"cx","10.5"),f.setAttributeNS(null,"cy","5.80029008"),f.setAttributeNS(null,"rx",h.rx),f.setAttributeNS(null,"ry",h.ry),u.appendChild(f)}var p=n.createNS("http://www.w3.org/2000/svg","g");p.setAttributeNS(null,"fill",this._color);var d=n.createNS("http://www.w3.org/2000/svg","path");d.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),p.appendChild(d);var v=n.createNS("http://www.w3.org/2000/svg","g");v.setAttributeNS(null,"opacity","0.25"),v.setAttributeNS(null,"fill","#000000");var m=n.createNS("http://www.w3.org/2000/svg","path");m.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),v.appendChild(m);var g=n.createNS("http://www.w3.org/2000/svg","g");g.setAttributeNS(null,"transform","translate(6.0, 7.0)"),g.setAttributeNS(null,"fill","#FFFFFF");var y=n.createNS("http://www.w3.org/2000/svg","g");y.setAttributeNS(null,"transform","translate(8.0, 8.0)");var _=n.createNS("http://www.w3.org/2000/svg","circle");_.setAttributeNS(null,"fill","#000000"),_.setAttributeNS(null,"opacity","0.25"),_.setAttributeNS(null,"cx","5.5"),_.setAttributeNS(null,"cy","5.5"),_.setAttributeNS(null,"r","5.4999962");var x=n.createNS("http://www.w3.org/2000/svg","circle");x.setAttributeNS(null,"fill","#FFFFFF"),x.setAttributeNS(null,"cx","5.5"),x.setAttributeNS(null,"cy","5.5"),x.setAttributeNS(null,"r","5.4999962"),y.appendChild(_),y.appendChild(x),s.appendChild(u),s.appendChild(p),s.appendChild(v),s.appendChild(g),s.appendChild(y),o.appendChild(s),o.setAttributeNS(null,"height",41*this._scale+"px"),o.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(o),this._offset=t.Point.convert(r&&r.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(function(t){t.preventDefault()})),this._element.addEventListener("mousedown",(function(t){t.preventDefault()})),Di(this._element,this._anchor,"marker"),this._popup=null}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(t){return this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._update),t.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},r.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),n.remove(this._element),this._popup&&this._popup.remove(),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},r.prototype.getElement=function(){return this._element},r.prototype.setPopup=function(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){var e=Math.sqrt(Math.pow(13.5,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[e,-1*(24.6+e)],"bottom-right":[-e,-1*(24.6+e)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},r.prototype._onKeyPress=function(t){var e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()},r.prototype._onMapClick=function(t){var e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()},r.prototype.getPopup=function(){return this._popup},r.prototype.togglePopup=function(){var t=this._popup;return t?(t.isOpen()?t.remove():t.addTo(this._map),this):this},r.prototype._update=function(t){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=Li(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var e="";"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?e="rotateZ("+this._rotation+"deg)":"map"===this._rotationAlignment&&(e="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var r="";"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?r="rotateX(0deg)":"map"===this._pitchAlignment&&(r="rotateX("+this._map.getPitch()+"deg)"),t&&"moveend"!==t.type||(this._pos=this._pos.round()),n.setTransform(this._element,Oi[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+r+" "+e)}},r.prototype.getOffset=function(){return this._offset},r.prototype.setOffset=function(e){return this._offset=t.Point.convert(e),this._update(),this},r.prototype._onMove=function(e){if(!this._isDragging){var n=this._clickTolerance||this._map._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=n}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))},r.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"},r.prototype._addDragHandler=function(t){this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos).add(this._offset),this._pointerdownPos=t.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},r.prototype.setDraggable=function(t){return this._draggable=!!t,this._map&&(t?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},r.prototype.isDraggable=function(){return this._draggable},r.prototype.setRotation=function(t){return this._rotation=t||0,this._update(),this},r.prototype.getRotation=function(){return this._rotation},r.prototype.setRotationAlignment=function(t){return this._rotationAlignment=t||"auto",this._update(),this},r.prototype.getRotationAlignment=function(){return this._rotationAlignment},r.prototype.setPitchAlignment=function(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this},r.prototype.getPitchAlignment=function(){return this._pitchAlignment},r}(t.Evented),Fi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},Bi=0,Ui=!1,ji=function(e){function r(n){e.call(this),this.options=t.extend({},Fi,n),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.onAdd=function(e){var r;return this._map=e,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),r=this._setupUI,void 0!==Ni?r(Ni):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then((function(t){r(Ni="denied"!==t.state)})):r(Ni=!!t.window.navigator.geolocation),this._container},r.prototype.onRemove=function(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),n.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,Bi=0,Ui=!1},r.prototype._isOutOfMapMaxBounds=function(t){var e=this._map.getMaxBounds(),n=t.coords;return e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())},r.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},r.prototype._onSuccess=function(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}},r.prototype._updateCamera=function(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),o,{geolocateSource:!0})},r.prototype._updateMarker=function(e){if(e){var n=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},r.prototype._updateCircleRadius=function(){var t=this._map._container.clientHeight/2,e=this._map.unproject([0,t]),n=this._map.unproject([1,t]),r=e.distanceTo(n),i=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=i+"px",this._circleElement.style.height=i+"px"},r.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},r.prototype._onError=function(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var n=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=n,this._geolocateButton.setAttribute("aria-label",n),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&Ui)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}},r.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},r.prototype._setupUI=function(e){var r=this;if(this._container.addEventListener("contextmenu",(function(t){return t.preventDefault()})),this._geolocateButton=n.create("button","mapboxgl-ctrl-geolocate",this._container),n.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=i,this._geolocateButton.setAttribute("aria-label",i)}else{var o=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=o,this._geolocateButton.setAttribute("aria-label",o)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=n.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new zi(this._dotElement),this._circleElement=n.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new zi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(function(e){e.geolocateSource||"ACTIVE_LOCK"!==r._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(r._watchState="BACKGROUND",r._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),r._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),r.fire(new t.Event("trackuserlocationend")))}))},r.prototype.trigger=function(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Bi--,Ui=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){var e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++Bi>1?(e={maximumAge:6e5,timeout:0},Ui=!0):(e=this.options.positionOptions,Ui=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e)}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},r.prototype._clearWatch=function(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},r}(t.Evented),Zi={maxWidth:100,unit:"metric"},Vi=function(e){this.options=t.extend({},Zi,e),t.bindAll(["_onMove","setUnit"],this)};function Gi(t,e,n){var r=n&&n.maxWidth||100,i=t._container.clientHeight/2,o=t.unproject([0,i]),a=t.unproject([r,i]),s=o.distanceTo(a);if(n&&"imperial"===n.unit){var u=3.2808*s;u>5280?Hi(e,r,u/5280,t._getUIString("ScaleControl.Miles")):Hi(e,r,u,t._getUIString("ScaleControl.Feet"))}else n&&"nautical"===n.unit?Hi(e,r,s/1852,t._getUIString("ScaleControl.NauticalMiles")):s>=1e3?Hi(e,r,s/1e3,t._getUIString("ScaleControl.Kilometers")):Hi(e,r,s,t._getUIString("ScaleControl.Meters"))}function Hi(t,e,n,r){var i,o,a,s=(i=n,(o=Math.pow(10,(""+Math.floor(i)).length-1))*(a=(a=i/o)>=10?10:a>=5?5:a>=3?3:a>=2?2:a>=1?1:function(t){var e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(a)));t.style.width=e*(s/n)+"px",t.innerHTML=s+"&nbsp;"+r}Vi.prototype.getDefaultPosition=function(){return"bottom-left"},Vi.prototype._onMove=function(){Gi(this._map,this._container,this.options)},Vi.prototype.onAdd=function(t){return this._map=t,this._container=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Vi.prototype.onRemove=function(){n.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Vi.prototype.setUnit=function(t){this.options.unit=t,Gi(this._map,this._container,this.options)};var Wi=function(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in t.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in t.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in t.window.document&&(this._fullscreenchange="MSFullscreenChange")};Wi.prototype.onAdd=function(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=n.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},Wi.prototype.onRemove=function(){n.remove(this._controlContainer),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._checkFullscreenSupport=function(){return!!(t.window.document.fullscreenEnabled||t.window.document.mozFullScreenEnabled||t.window.document.msFullscreenEnabled||t.window.document.webkitFullscreenEnabled)},Wi.prototype._setupUI=function(){var e=this._fullscreenButton=n.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);n.create("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden",!0),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},Wi.prototype._updateTitle=function(){var t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.title=t},Wi.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},Wi.prototype._isFullscreen=function(){return this._fullscreen},Wi.prototype._changeIcon=function(){(t.window.document.fullscreenElement||t.window.document.mozFullScreenElement||t.window.document.webkitFullscreenElement||t.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},Wi.prototype._onClickFullscreen=function(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.mozCancelFullScreen?t.window.document.mozCancelFullScreen():t.window.document.msExitFullscreen?t.window.document.msExitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var qi={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},Xi=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),Yi=function(e){function r(n){e.call(this),this.options=t.extend(Object.create(qi),n),t.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return e&&(r.__proto__=e),(r.prototype=Object.create(e&&e.prototype)).constructor=r,r.prototype.addTo=function(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new t.Event("open")),this},r.prototype.isOpen=function(){return!!this._map},r.prototype.remove=function(){return this._content&&n.remove(this._content),this._container&&(n.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new t.Event("close")),this},r.prototype.getLngLat=function(){return this._lngLat},r.prototype.setLngLat=function(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},r.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},r.prototype.getElement=function(){return this._container},r.prototype.setText=function(e){return this.setDOMContent(t.window.document.createTextNode(e))},r.prototype.setHTML=function(e){var n,r=t.window.document.createDocumentFragment(),i=t.window.document.createElement("body");for(i.innerHTML=e;n=i.firstChild;)r.appendChild(n);return this.setDOMContent(r)},r.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},r.prototype.setMaxWidth=function(t){return this.options.maxWidth=t,this._update(),this},r.prototype.setDOMContent=function(t){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=n.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(t),this._createCloseButton(),this._update(),this._focusFirstElement(),this},r.prototype.addClassName=function(t){this._container&&this._container.classList.add(t)},r.prototype.removeClassName=function(t){this._container&&this._container.classList.remove(t)},r.prototype.setOffset=function(t){return this.options.offset=t,this._update(),this},r.prototype.toggleClassName=function(t){if(this._container)return this._container.classList.toggle(t)},r.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=n.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},r.prototype._onMouseUp=function(t){this._update(t.point)},r.prototype._onMouseMove=function(t){this._update(t.point)},r.prototype._onDrag=function(t){this._update(t.point)},r.prototype._update=function(e){var r=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=n.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=n.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach((function(t){return r._container.classList.add(t)})),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Li(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||e)){var i=this._pos=this._trackPointer&&e?e:this._map.project(this._lngLat),o=this.options.anchor,a=function e(n){if(n){if("number"==typeof n){var r=Math.round(Math.sqrt(.5*Math.pow(n,2)));return{center:new t.Point(0,0),top:new t.Point(0,n),"top-left":new t.Point(r,r),"top-right":new t.Point(-r,r),bottom:new t.Point(0,-n),"bottom-left":new t.Point(r,-r),"bottom-right":new t.Point(-r,-r),left:new t.Point(n,0),right:new t.Point(-n,0)}}if(n instanceof t.Point||Array.isArray(n)){var i=t.Point.convert(n);return{center:i,top:i,"top-left":i,"top-right":i,bottom:i,"bottom-left":i,"bottom-right":i,left:i,right:i}}return{center:t.Point.convert(n.center||[0,0]),top:t.Point.convert(n.top||[0,0]),"top-left":t.Point.convert(n["top-left"]||[0,0]),"top-right":t.Point.convert(n["top-right"]||[0,0]),bottom:t.Point.convert(n.bottom||[0,0]),"bottom-left":t.Point.convert(n["bottom-left"]||[0,0]),"bottom-right":t.Point.convert(n["bottom-right"]||[0,0]),left:t.Point.convert(n.left||[0,0]),right:t.Point.convert(n.right||[0,0])}}return e(new t.Point(0,0))}(this.options.offset);if(!o){var s,u=this._container.offsetWidth,c=this._container.offsetHeight;s=i.y+a.bottom.y<c?["top"]:i.y>this._map.transform.height-c?["bottom"]:[],i.x<u/2?s.push("left"):i.x>this._map.transform.width-u/2&&s.push("right"),o=0===s.length?"bottom":s.join("-")}var l=i.add(a[o]).round();n.setTransform(this._container,Oi[o]+" translate("+l.x+"px,"+l.y+"px)"),Di(this._container,o,"popup")}},r.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var t=this._container.querySelector(Xi);t&&t.focus()}},r.prototype._onClose=function(){this.remove()},r}(t.Evented),Ki={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:ki,NavigationControl:Ii,GeolocateControl:ji,AttributionControl:xi,ScaleControl:Vi,FullscreenControl:Wi,Popup:Yi,Marker:zi,Style:Ge,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.Point,MercatorCoordinate:t.MercatorCoordinate,Evented:t.Evented,config:t.config,prewarm:function(){Bt().acquire(Dt)},clearPrewarmedResources:function(){var t=zt;t&&t.isPreloaded()&&1===t.numActive()&&(t.release(Dt),zt=null)},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return Nt.workerCount},set workerCount(t){Nt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage:function(e){t.clearTileCache(e)},workerUrl:""};return Ki})),n}))},53431:function(t,e,n){"use strict";n(18264),n(39575),n(82472),n(48675),n(33105),n(63408),n(14590),n(3462),n(33824),n(23767),n(8585),n(68696),n(57658),n(21703),t.exports=i;var r=n(61615);function i(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}i.Varint=0,i.Fixed64=1,i.Bytes=2,i.Fixed32=5;var o=4294967296,a=1/o,s=12,u="undefined"===typeof TextDecoder?null:new TextDecoder("utf8");function c(t,e,n){var r,i,o=n.buf;if(i=o[n.pos++],r=(112&i)>>4,i<128)return h(t,r,e);if(i=o[n.pos++],r|=(127&i)<<3,i<128)return h(t,r,e);if(i=o[n.pos++],r|=(127&i)<<10,i<128)return h(t,r,e);if(i=o[n.pos++],r|=(127&i)<<17,i<128)return h(t,r,e);if(i=o[n.pos++],r|=(127&i)<<24,i<128)return h(t,r,e);if(i=o[n.pos++],r|=(1&i)<<31,i<128)return h(t,r,e);throw new Error("Expected varint not more than 10 bytes")}function l(t){return t.type===i.Bytes?t.readVarint()+t.pos:t.pos+1}function h(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function f(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(n=~(-t%4294967296),r=~(-t/4294967296),4294967295^n?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),p(n,r,e),d(r,e)}function p(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos]=127&t}function d(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}function v(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function m(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function g(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function y(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function _(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function x(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function b(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function w(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function E(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function S(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function A(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function T(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function C(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function k(t,e,n){var r="",i=e;while(i<n){var o,a,s,u=t[i],c=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l>n)break;1===l?u<128&&(c=u):2===l?(o=t[i+1],128===(192&o)&&(c=(31&u)<<6|63&o,c<=127&&(c=null))):3===l?(o=t[i+1],a=t[i+2],128===(192&o)&&128===(192&a)&&(c=(15&u)<<12|(63&o)<<6|63&a,(c<=2047||c>=55296&&c<=57343)&&(c=null))):4===l&&(o=t[i+1],a=t[i+2],s=t[i+3],128===(192&o)&&128===(192&a)&&128===(192&s)&&(c=(15&u)<<18|(63&o)<<12|(63&a)<<6|63&s,(c<=65535||c>=1114112)&&(c=null))),null===c?(c=65533,l=1):c>65535&&(c-=65536,r+=String.fromCharCode(c>>>10&1023|55296),c=56320|1023&c),r+=String.fromCharCode(c),i+=l}return r}function M(t,e,n){return u.decode(t.subarray(e,n))}function P(t,e,n){for(var r,i,o=0;o<e.length;o++){if(r=e.charCodeAt(o),r>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}i.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){n=n||this.length;while(this.pos<n){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=A(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=C(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=A(this.buf,this.pos)+A(this.buf,this.pos+4)*o;return this.pos+=8,t},readSFixed64:function(){var t=A(this.buf,this.pos)+C(this.buf,this.pos+4)*o;return this.pos+=8,t},readFloat:function(){var t=r.read(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=r.read(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return n=r[this.pos++],e=127&n,n<128?e:(n=r[this.pos++],e|=(127&n)<<7,n<128?e:(n=r[this.pos++],e|=(127&n)<<14,n<128?e:(n=r[this.pos++],e|=(127&n)<<21,n<128?e:(n=r[this.pos],e|=(15&n)<<28,c(e,t,this)))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2===1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=s&&u?M(this.buf,e,t):k(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==i.Bytes)return t.push(this.readVarint(e));var n=l(this);t=t||[];while(this.pos<n)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==i.Bytes)return t.push(this.readSVarint());var e=l(this);t=t||[];while(this.pos<e)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==i.Bytes)return t.push(this.readBoolean());var e=l(this);t=t||[];while(this.pos<e)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==i.Bytes)return t.push(this.readFloat());var e=l(this);t=t||[];while(this.pos<e)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==i.Bytes)return t.push(this.readDouble());var e=l(this);t=t||[];while(this.pos<e)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed32());var e=l(this);t=t||[];while(this.pos<e)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed32());var e=l(this);t=t||[];while(this.pos<e)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readFixed64());var e=l(this);t=t||[];while(this.pos<e)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==i.Bytes)return t.push(this.readSFixed64());var e=l(this);t=t||[];while(this.pos<e)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===i.Varint)while(this.buf[this.pos++]>127);else if(e===i.Bytes)this.pos=this.readVarint()+this.pos;else if(e===i.Fixed32)this.pos+=4;else{if(e!==i.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){var e=this.length||16;while(e<this.pos+t)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),T(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),T(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),T(this.buf,-1&t,this.pos),T(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),T(this.buf,-1&t,this.pos),T(this.buf,Math.floor(t*a),this.pos+4),this.pos+=8},writeVarint:function(t){t=+t||0,t>268435455||t<0?f(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=P(this.buf,t,this.pos);var n=this.pos-e;n>=128&&v(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),r.write(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),r.write(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&v(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,i.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,m,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,g,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,x,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,y,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,_,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,b,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,w,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,E,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,S,e)},writeBytesField:function(t,e){this.writeTag(t,i.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,i.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,i.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,i.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,i.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,i.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,i.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}}},46345:function(t,e,n){var r,i,o=n(1692)["default"];n(35837),n(21703),n(57658),n(33948),n(52262),n(24506),n(74916),n(30541),n(65069),n(2707),function(a,s){"object"===o(e)?t.exports=s():(r=s,i="function"===typeof r?r.call(e,n,e,t):r,void 0===i||(t.exports=i))}(0,(function(){"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function n(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}var r=function(){function t(t,e){this.next=null,this.key=t,this.data=e,this.left=null,this.right=null}return t}();function i(t,e){return t>e?1:t<e?-1:0}function o(t,e,n){var i=new r(null,null),o=i,a=i;while(1){var s=n(t,e.key);if(s<0){if(null===e.left)break;if(n(t,e.left.key)<0){var u=e.left;if(e.left=u.right,u.right=e,e=u,null===e.left)break}a.left=e,a=e,e=e.left}else{if(!(s>0))break;if(null===e.right)break;if(n(t,e.right.key)>0){u=e.right;if(e.right=u.left,u.left=e,e=u,null===e.right)break}o.right=e,o=e,e=e.right}}return o.right=e.left,a.left=e.right,e.left=i.right,e.right=i.left,e}function a(t,e,n,i){var a=new r(t,e);if(null===n)return a.left=a.right=null,a;n=o(t,n,i);var s=i(t,n.key);return s<0?(a.left=n.left,a.right=n,n.left=null):s>=0&&(a.right=n.right,a.left=n,n.right=null),a}function s(t,e,n){var r=null,i=null;if(e){e=o(t,e,n);var a=n(e.key,t);0===a?(r=e.left,i=e.right):a<0?(i=e.right,e.right=null,r=e):(r=e.left,e.left=null,i=e)}return{left:r,right:i}}function u(t,e,n){return null===e?t:(null===t||(e=o(t.key,e,n),e.left=t),e)}function c(t,e,n,r,i){if(t){r(e+(n?"└── ":"├── ")+i(t)+"\n");var o=e+(n?"    ":"│   ");t.left&&c(t.left,o,!1,r,i),t.right&&c(t.right,o,!0,r,i)}}var l=function(){function t(t){void 0===t&&(t=i),this._root=null,this._size=0,this._comparator=t}return t.prototype.insert=function(t,e){return this._size++,this._root=a(t,e,this._root,this._comparator)},t.prototype.add=function(t,e){var n=new r(t,e);null===this._root&&(n.left=n.right=null,this._size++,this._root=n);var i=this._comparator,a=o(t,this._root,i),s=i(t,a.key);return 0===s?this._root=a:(s<0?(n.left=a.left,n.right=a,a.left=null):s>0&&(n.right=a.right,n.left=a,a.right=null),this._size++,this._root=n),this._root},t.prototype.remove=function(t){this._root=this._remove(t,this._root,this._comparator)},t.prototype._remove=function(t,e,n){var r;if(null===e)return null;e=o(t,e,n);var i=n(t,e.key);return 0===i?(null===e.left?r=e.right:(r=o(t,e.left,n),r.right=e.right),this._size--,r):e},t.prototype.pop=function(){var t=this._root;if(t){while(t.left)t=t.left;return this._root=o(t.key,this._root,this._comparator),this._root=this._remove(t.key,this._root,this._comparator),{key:t.key,data:t.data}}return null},t.prototype.findStatic=function(t){var e=this._root,n=this._comparator;while(e){var r=n(t,e.key);if(0===r)return e;e=r<0?e.left:e.right}return null},t.prototype.find=function(t){return this._root&&(this._root=o(t,this._root,this._comparator),0!==this._comparator(t,this._root.key))?null:this._root},t.prototype.contains=function(t){var e=this._root,n=this._comparator;while(e){var r=n(t,e.key);if(0===r)return!0;e=r<0?e.left:e.right}return!1},t.prototype.forEach=function(t,e){var n=this._root,r=[],i=!1;while(!i)null!==n?(r.push(n),n=n.left):0!==r.length?(n=r.pop(),t.call(e,n),n=n.right):i=!0;return this},t.prototype.range=function(t,e,n,r){var i,o=[],a=this._comparator,s=this._root;while(0!==o.length||s)if(s)o.push(s),s=s.left;else{if(s=o.pop(),i=a(s.key,e),i>0)break;if(a(s.key,t)>=0&&n.call(r,s))return this;s=s.right}return this},t.prototype.keys=function(){var t=[];return this.forEach((function(e){var n=e.key;return t.push(n)})),t},t.prototype.values=function(){var t=[];return this.forEach((function(e){var n=e.data;return t.push(n)})),t},t.prototype.min=function(){return this._root?this.minNode(this._root).key:null},t.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},t.prototype.minNode=function(t){if(void 0===t&&(t=this._root),t)while(t.left)t=t.left;return t},t.prototype.maxNode=function(t){if(void 0===t&&(t=this._root),t)while(t.right)t=t.right;return t},t.prototype.at=function(t){var e=this._root,n=!1,r=0,i=[];while(!n)if(e)i.push(e),e=e.left;else if(i.length>0){if(e=i.pop(),r===t)return e;r++,e=e.right}else n=!0;return null},t.prototype.next=function(t){var e=this._root,n=null;if(t.right){n=t.right;while(n.left)n=n.left;return n}var r=this._comparator;while(e){var i=r(t.key,e.key);if(0===i)break;i<0?(n=e,e=e.left):e=e.right}return n},t.prototype.prev=function(t){var e=this._root,n=null;if(null!==t.left){n=t.left;while(n.right)n=n.right;return n}var r=this._comparator;while(e){var i=r(t.key,e.key);if(0===i)break;i<0?e=e.left:(n=e,e=e.right)}return n},t.prototype.clear=function(){return this._root=null,this._size=0,this},t.prototype.toList=function(){return p(this._root)},t.prototype.load=function(t,e,n){void 0===e&&(e=[]),void 0===n&&(n=!1);var r=t.length,i=this._comparator;if(n&&m(t,e,0,r-1,i),null===this._root)this._root=h(t,e,0,r),this._size=r;else{var o=v(this.toList(),f(t,e),i);r=this._size+r,this._root=d({head:o},0,r)}return this},t.prototype.isEmpty=function(){return null===this._root},Object.defineProperty(t.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),t.prototype.toString=function(t){void 0===t&&(t=function(t){return String(t.key)});var e=[];return c(this._root,"",!0,(function(t){return e.push(t)}),t),e.join("")},t.prototype.update=function(t,e,n){var r=this._comparator,i=s(t,this._root,r),o=i.left,c=i.right;r(t,e)<0?c=a(e,n,c,r):o=a(e,n,o,r),this._root=u(o,c,r)},t.prototype.split=function(t){return s(t,this._root,this._comparator)},t}();function h(t,e,n,i){var o=i-n;if(o>0){var a=n+Math.floor(o/2),s=t[a],u=e[a],c=new r(s,u);return c.left=h(t,e,n,a),c.right=h(t,e,a+1,i),c}return null}function f(t,e){for(var n=new r(null,null),i=n,o=0;o<t.length;o++)i=i.next=new r(t[o],e[o]);return i.next=null,n.next}function p(t){var e=t,n=[],i=!1,o=new r(null,null),a=o;while(!i)e?(n.push(e),e=e.left):n.length>0?(e=a=a.next=n.pop(),e=e.right):i=!0;return a.next=null,o.next}function d(t,e,n){var r=n-e;if(r>0){var i=e+Math.floor(r/2),o=d(t,e,i),a=t.head;return a.left=o,t.head=t.head.next,a.right=d(t,i+1,n),a}return null}function v(t,e,n){var i=new r(null,null),o=i,a=t,s=e;while(null!==a&&null!==s)n(a.key,s.key)<0?(o.next=a,a=a.next):(o.next=s,s=s.next),o=o.next;return null!==a?o.next=a:null!==s&&(o.next=s),i.next}function m(t,e,n,r,i){if(!(n>=r)){var o=t[n+r>>1],a=n-1,s=r+1;while(1){do{a++}while(i(t[a],o)<0);do{s--}while(i(t[s],o)>0);if(a>=s)break;var u=t[a];t[a]=t[s],t[s]=u,u=e[a],e[a]=e[s],e[s]=u}m(t,e,n,s,i),m(t,e,s+1,r,i)}}var g=function(t,e){return t.ll.x<=e.x&&e.x<=t.ur.x&&t.ll.y<=e.y&&e.y<=t.ur.y},y=function(t,e){if(e.ur.x<t.ll.x||t.ur.x<e.ll.x||e.ur.y<t.ll.y||t.ur.y<e.ll.y)return null;var n=t.ll.x<e.ll.x?e.ll.x:t.ll.x,r=t.ur.x<e.ur.x?t.ur.x:e.ur.x,i=t.ll.y<e.ll.y?e.ll.y:t.ll.y,o=t.ur.y<e.ur.y?t.ur.y:e.ur.y;return{ll:{x:n,y:i},ur:{x:r,y:o}}},_=Number.EPSILON;void 0===_&&(_=Math.pow(2,-52));var x=_*_,b=function(t,e){if(-_<t&&t<_&&-_<e&&e<_)return 0;var n=t-e;return n*n<x*t*e?0:t<e?-1:1},w=function(){function e(){t(this,e),this.reset()}return n(e,[{key:"reset",value:function(){this.xRounder=new E,this.yRounder=new E}},{key:"round",value:function(t,e){return{x:this.xRounder.round(t),y:this.yRounder.round(e)}}}]),e}(),E=function(){function e(){t(this,e),this.tree=new l,this.round(0)}return n(e,[{key:"round",value:function(t){var e=this.tree.add(t),n=this.tree.prev(e);if(null!==n&&0===b(e.key,n.key))return this.tree.remove(t),n.key;var r=this.tree.next(e);return null!==r&&0===b(e.key,r.key)?(this.tree.remove(t),r.key):t}}]),e}(),S=new w,A=function(t,e){return t.x*e.y-t.y*e.x},T=function(t,e){return t.x*e.x+t.y*e.y},C=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y},o=A(r,i);return b(o,0)},k=function(t){return Math.sqrt(T(t,t))},M=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return A(i,r)/k(i)/k(r)},P=function(t,e,n){var r={x:e.x-t.x,y:e.y-t.y},i={x:n.x-t.x,y:n.y-t.y};return T(i,r)/k(i)/k(r)},I=function(t,e,n){return 0===e.y?null:{x:t.x+e.x/e.y*(n-t.y),y:n}},R=function(t,e,n){return 0===e.x?null:{x:n,y:t.y+e.y/e.x*(n-t.x)}},L=function(t,e,n,r){if(0===e.x)return R(n,r,t.x);if(0===r.x)return R(t,e,n.x);if(0===e.y)return I(n,r,t.y);if(0===r.y)return I(t,e,n.y);var i=A(e,r);if(0==i)return null;var o={x:n.x-t.x,y:n.y-t.y},a=A(o,e)/i,s=A(o,r)/i,u=t.x+s*e.x,c=n.x+a*r.x,l=t.y+s*e.y,h=n.y+a*r.y,f=(u+c)/2,p=(l+h)/2;return{x:f,y:p}},O=function(){function e(n,r){t(this,e),void 0===n.events?n.events=[this]:n.events.push(this),this.point=n,this.isLeft=r}return n(e,null,[{key:"compare",value:function(t,n){var r=e.comparePoints(t.point,n.point);return 0!==r?r:(t.point!==n.point&&t.link(n),t.isLeft!==n.isLeft?t.isLeft?1:-1:N.compare(t.segment,n.segment))}},{key:"comparePoints",value:function(t,e){return t.x<e.x?-1:t.x>e.x?1:t.y<e.y?-1:t.y>e.y?1:0}}]),n(e,[{key:"link",value:function(t){if(t.point===this.point)throw new Error("Tried to link already linked events");for(var e=t.point.events,n=0,r=e.length;n<r;n++){var i=e[n];this.point.events.push(i),i.point=this.point}this.checkForConsuming()}},{key:"checkForConsuming",value:function(){for(var t=this.point.events.length,e=0;e<t;e++){var n=this.point.events[e];if(void 0===n.segment.consumedBy)for(var r=e+1;r<t;r++){var i=this.point.events[r];void 0===i.consumedBy&&(n.otherSE.point.events===i.otherSE.point.events&&n.segment.consume(i.segment))}}}},{key:"getAvailableLinkedEvents",value:function(){for(var t=[],e=0,n=this.point.events.length;e<n;e++){var r=this.point.events[e];r!==this&&!r.segment.ringOut&&r.segment.isInResult()&&t.push(r)}return t}},{key:"getLeftmostComparator",value:function(t){var e=this,n=new Map,r=function(r){var i=r.otherSE;n.set(r,{sine:M(e.point,t.point,i.point),cosine:P(e.point,t.point,i.point)})};return function(t,e){n.has(t)||r(t),n.has(e)||r(e);var i=n.get(t),o=i.sine,a=i.cosine,s=n.get(e),u=s.sine,c=s.cosine;return o>=0&&u>=0?a<c?1:a>c?-1:0:o<0&&u<0?a<c?-1:a>c?1:0:u<o?-1:u>o?1:0}}}]),e}(),D=0,N=function(){function e(n,r,i,o){t(this,e),this.id=++D,this.leftSE=n,n.segment=this,n.otherSE=r,this.rightSE=r,r.segment=this,r.otherSE=n,this.rings=i,this.windings=o}return n(e,null,[{key:"compare",value:function(t,e){var n=t.leftSE.point.x,r=e.leftSE.point.x,i=t.rightSE.point.x,o=e.rightSE.point.x;if(o<n)return 1;if(i<r)return-1;var a=t.leftSE.point.y,s=e.leftSE.point.y,u=t.rightSE.point.y,c=e.rightSE.point.y;if(n<r){if(s<a&&s<u)return 1;if(s>a&&s>u)return-1;var l=t.comparePoint(e.leftSE.point);if(l<0)return 1;if(l>0)return-1;var h=e.comparePoint(t.rightSE.point);return 0!==h?h:-1}if(n>r){if(a<s&&a<c)return-1;if(a>s&&a>c)return 1;var f=e.comparePoint(t.leftSE.point);if(0!==f)return f;var p=t.comparePoint(e.rightSE.point);return p<0?1:p>0?-1:1}if(a<s)return-1;if(a>s)return 1;if(i<o){var d=e.comparePoint(t.rightSE.point);if(0!==d)return d}if(i>o){var v=t.comparePoint(e.rightSE.point);if(v<0)return 1;if(v>0)return-1}if(i!==o){var m=u-a,g=i-n,y=c-s,_=o-r;if(m>g&&y<_)return 1;if(m<g&&y>_)return-1}return i>o?1:i<o||u<c?-1:u>c?1:t.id<e.id?-1:t.id>e.id?1:0}}]),n(e,[{key:"replaceRightSE",value:function(t){this.rightSE=t,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}},{key:"bbox",value:function(){var t=this.leftSE.point.y,e=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:t<e?t:e},ur:{x:this.rightSE.point.x,y:t>e?t:e}}}},{key:"vector",value:function(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}},{key:"isAnEndpoint",value:function(t){return t.x===this.leftSE.point.x&&t.y===this.leftSE.point.y||t.x===this.rightSE.point.x&&t.y===this.rightSE.point.y}},{key:"comparePoint",value:function(t){if(this.isAnEndpoint(t))return 0;var e=this.leftSE.point,n=this.rightSE.point,r=this.vector();if(e.x===n.x)return t.x===e.x?0:t.x<e.x?1:-1;var i=(t.y-e.y)/r.y,o=e.x+i*r.x;if(t.x===o)return 0;var a=(t.x-e.x)/r.x,s=e.y+a*r.y;return t.y===s?0:t.y<s?-1:1}},{key:"getIntersection",value:function(t){var e=this.bbox(),n=t.bbox(),r=y(e,n);if(null===r)return null;var i=this.leftSE.point,o=this.rightSE.point,a=t.leftSE.point,s=t.rightSE.point,u=g(e,a)&&0===this.comparePoint(a),c=g(n,i)&&0===t.comparePoint(i),l=g(e,s)&&0===this.comparePoint(s),h=g(n,o)&&0===t.comparePoint(o);if(c&&u)return h&&!l?o:!h&&l?s:null;if(c)return l&&i.x===s.x&&i.y===s.y?null:i;if(u)return h&&o.x===a.x&&o.y===a.y?null:a;if(h&&l)return null;if(h)return o;if(l)return s;var f=L(i,this.vector(),a,t.vector());return null===f?null:g(r,f)?S.round(f.x,f.y):null}},{key:"split",value:function(t){var n=[],r=void 0!==t.events,i=new O(t,!0),o=new O(t,!1),a=this.rightSE;this.replaceRightSE(o),n.push(o),n.push(i);var s=new e(i,a,this.rings.slice(),this.windings.slice());return O.comparePoints(s.leftSE.point,s.rightSE.point)>0&&s.swapEvents(),O.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),r&&(i.checkForConsuming(),o.checkForConsuming()),n}},{key:"swapEvents",value:function(){var t=this.rightSE;this.rightSE=this.leftSE,this.leftSE=t,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(var e=0,n=this.windings.length;e<n;e++)this.windings[e]*=-1}},{key:"consume",value:function(t){var n=this,r=t;while(n.consumedBy)n=n.consumedBy;while(r.consumedBy)r=r.consumedBy;var i=e.compare(n,r);if(0!==i){if(i>0){var o=n;n=r,r=o}if(n.prev===r){var a=n;n=r,r=a}for(var s=0,u=r.rings.length;s<u;s++){var c=r.rings[s],l=r.windings[s],h=n.rings.indexOf(c);-1===h?(n.rings.push(c),n.windings.push(l)):n.windings[h]+=l}r.rings=null,r.windings=null,r.consumedBy=n,r.leftSE.consumedBy=n.leftSE,r.rightSE.consumedBy=n.rightSE}}},{key:"prevInResult",value:function(){return void 0!==this._prevInResult||(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null),this._prevInResult}},{key:"beforeState",value:function(){if(void 0!==this._beforeState)return this._beforeState;if(this.prev){var t=this.prev.consumedBy||this.prev;this._beforeState=t.afterState()}else this._beforeState={rings:[],windings:[],multiPolys:[]};return this._beforeState}},{key:"afterState",value:function(){if(void 0!==this._afterState)return this._afterState;var t=this.beforeState();this._afterState={rings:t.rings.slice(0),windings:t.windings.slice(0),multiPolys:[]};for(var e=this._afterState.rings,n=this._afterState.windings,r=this._afterState.multiPolys,i=0,o=this.rings.length;i<o;i++){var a=this.rings[i],s=this.windings[i],u=e.indexOf(a);-1===u?(e.push(a),n.push(s)):n[u]+=s}for(var c=[],l=[],h=0,f=e.length;h<f;h++)if(0!==n[h]){var p=e[h],d=p.poly;if(-1===l.indexOf(d))if(p.isExterior)c.push(d);else{-1===l.indexOf(d)&&l.push(d);var v=c.indexOf(p.poly);-1!==v&&c.splice(v,1)}}for(var m=0,g=c.length;m<g;m++){var y=c[m].multiPoly;-1===r.indexOf(y)&&r.push(y)}return this._afterState}},{key:"isInResult",value:function(){if(this.consumedBy)return!1;if(void 0!==this._isInResult)return this._isInResult;var t=this.beforeState().multiPolys,e=this.afterState().multiPolys;switch(q.type){case"union":var n=0===t.length,r=0===e.length;this._isInResult=n!==r;break;case"intersection":var i,o;t.length<e.length?(i=t.length,o=e.length):(i=e.length,o=t.length),this._isInResult=o===q.numMultiPolys&&i<o;break;case"xor":var a=Math.abs(t.length-e.length);this._isInResult=a%2===1;break;case"difference":var s=function(t){return 1===t.length&&t[0].isSubject};this._isInResult=s(t)!==s(e);break;default:throw new Error("Unrecognized operation type found ".concat(q.type))}return this._isInResult}}],[{key:"fromRing",value:function(t,n,r){var i,o,a,s=O.comparePoints(t,n);if(s<0)i=t,o=n,a=1;else{if(!(s>0))throw new Error("Tried to create degenerate segment at [".concat(t.x,", ").concat(t.y,"]"));i=n,o=t,a=-1}var u=new O(i,!0),c=new O(o,!1);return new e(u,c,[r],[a])}}]),e}(),z=function(){function e(n,r,i){if(t(this,e),!Array.isArray(n)||0===n.length)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=r,this.isExterior=i,this.segments=[],"number"!==typeof n[0][0]||"number"!==typeof n[0][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var o=S.round(n[0][0],n[0][1]);this.bbox={ll:{x:o.x,y:o.y},ur:{x:o.x,y:o.y}};for(var a=o,s=1,u=n.length;s<u;s++){if("number"!==typeof n[s][0]||"number"!==typeof n[s][1])throw new Error("Input geometry is not a valid Polygon or MultiPolygon");var c=S.round(n[s][0],n[s][1]);c.x===a.x&&c.y===a.y||(this.segments.push(N.fromRing(a,c,this)),c.x<this.bbox.ll.x&&(this.bbox.ll.x=c.x),c.y<this.bbox.ll.y&&(this.bbox.ll.y=c.y),c.x>this.bbox.ur.x&&(this.bbox.ur.x=c.x),c.y>this.bbox.ur.y&&(this.bbox.ur.y=c.y),a=c)}o.x===a.x&&o.y===a.y||this.segments.push(N.fromRing(a,o,this))}return n(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.segments.length;e<n;e++){var r=this.segments[e];t.push(r.leftSE),t.push(r.rightSE)}return t}}]),e}(),F=function(){function e(n,r){if(t(this,e),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new z(n[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(var i=1,o=n.length;i<o;i++){var a=new z(n[i],this,!1);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.interiorRings.push(a)}this.multiPoly=r}return n(e,[{key:"getSweepEvents",value:function(){for(var t=this.exteriorRing.getSweepEvents(),e=0,n=this.interiorRings.length;e<n;e++)for(var r=this.interiorRings[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),e}(),B=function(){function e(n,r){if(t(this,e),!Array.isArray(n))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{"number"===typeof n[0][0][0]&&(n=[n])}catch(s){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(var i=0,o=n.length;i<o;i++){var a=new F(n[i],this);a.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=a.bbox.ll.x),a.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=a.bbox.ll.y),a.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=a.bbox.ur.x),a.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=a.bbox.ur.y),this.polys.push(a)}this.isSubject=r}return n(e,[{key:"getSweepEvents",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++)for(var r=this.polys[e].getSweepEvents(),i=0,o=r.length;i<o;i++)t.push(r[i]);return t}}]),e}(),U=function(){function e(n){t(this,e),this.events=n;for(var r=0,i=n.length;r<i;r++)n[r].segment.ringOut=this;this.poly=null}return n(e,null,[{key:"factory",value:function(t){for(var n=[],r=0,i=t.length;r<i;r++){var o=t[r];if(o.isInResult()&&!o.ringOut){var a=null,s=o.leftSE,u=o.rightSE,c=[s],l=s.point,h=[];while(1){if(a=s,s=u,c.push(s),s.point===l)break;while(1){var f=s.getAvailableLinkedEvents();if(0===f.length){var p=c[0].point,d=c[c.length-1].point;throw new Error("Unable to complete output ring starting at [".concat(p.x,",")+" ".concat(p.y,"]. Last matching segment found ends at")+" [".concat(d.x,", ").concat(d.y,"]."))}if(1===f.length){u=f[0].otherSE;break}for(var v=null,m=0,g=h.length;m<g;m++)if(h[m].point===s.point){v=m;break}if(null===v){h.push({index:c.length,point:s.point});var y=s.getLeftmostComparator(a);u=f.sort(y)[0].otherSE;break}var _=h.splice(v)[0],x=c.splice(_.index);x.unshift(x[0].otherSE),n.push(new e(x.reverse()))}}n.push(new e(c))}}return n}}]),n(e,[{key:"getGeom",value:function(){for(var t=this.events[0].point,e=[t],n=1,r=this.events.length-1;n<r;n++){var i=this.events[n].point,o=this.events[n+1].point;0!==C(i,t,o)&&(e.push(i),t=i)}if(1===e.length)return null;var a=e[0],s=e[1];0===C(a,t,s)&&e.shift(),e.push(e[0]);for(var u=this.isExteriorRing()?1:-1,c=this.isExteriorRing()?0:e.length-1,l=this.isExteriorRing()?e.length:-1,h=[],f=c;f!=l;f+=u)h.push([e[f].x,e[f].y]);return h}},{key:"isExteriorRing",value:function(){if(void 0===this._isExteriorRing){var t=this.enclosingRing();this._isExteriorRing=!t||!t.isExteriorRing()}return this._isExteriorRing}},{key:"enclosingRing",value:function(){return void 0===this._enclosingRing&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}},{key:"_calcEnclosingRing",value:function(){for(var t=this.events[0],e=1,n=this.events.length;e<n;e++){var r=this.events[e];O.compare(t,r)>0&&(t=r)}var i=t.segment.prevInResult(),o=i?i.prevInResult():null;while(1){if(!i)return null;if(!o)return i.ringOut;if(o.ringOut!==i.ringOut)return o.ringOut.enclosingRing()!==i.ringOut?i.ringOut:i.ringOut.enclosingRing();i=o.prevInResult(),o=i?i.prevInResult():null}}}]),e}(),j=function(){function e(n){t(this,e),this.exteriorRing=n,n.poly=this,this.interiorRings=[]}return n(e,[{key:"addInterior",value:function(t){this.interiorRings.push(t),t.poly=this}},{key:"getGeom",value:function(){var t=[this.exteriorRing.getGeom()];if(null===t[0])return null;for(var e=0,n=this.interiorRings.length;e<n;e++){var r=this.interiorRings[e].getGeom();null!==r&&t.push(r)}return t}}]),e}(),Z=function(){function e(n){t(this,e),this.rings=n,this.polys=this._composePolys(n)}return n(e,[{key:"getGeom",value:function(){for(var t=[],e=0,n=this.polys.length;e<n;e++){var r=this.polys[e].getGeom();null!==r&&t.push(r)}return t}},{key:"_composePolys",value:function(t){for(var e=[],n=0,r=t.length;n<r;n++){var i=t[n];if(!i.poly)if(i.isExteriorRing())e.push(new j(i));else{var o=i.enclosingRing();o.poly||e.push(new j(o)),o.poly.addInterior(i)}}return e}}]),e}(),V=function(){function e(n){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:N.compare;t(this,e),this.queue=n,this.tree=new l(r),this.segments=[]}return n(e,[{key:"process",value:function(t){var e=t.segment,n=[];if(t.consumedBy)return t.isLeft?this.queue.remove(t.otherSE):this.tree.remove(e),n;var r=t.isLeft?this.tree.insert(e):this.tree.find(e);if(!r)throw new Error("Unable to find segment #".concat(e.id," ")+"[".concat(e.leftSE.point.x,", ").concat(e.leftSE.point.y,"] -> ")+"[".concat(e.rightSE.point.x,", ").concat(e.rightSE.point.y,"] ")+"in SweepLine tree. Please submit a bug report.");var i=r,o=r,a=void 0,s=void 0;while(void 0===a)i=this.tree.prev(i),null===i?a=null:void 0===i.key.consumedBy&&(a=i.key);while(void 0===s)o=this.tree.next(o),null===o?s=null:void 0===o.key.consumedBy&&(s=o.key);if(t.isLeft){var u=null;if(a){var c=a.getIntersection(e);if(null!==c&&(e.isAnEndpoint(c)||(u=c),!a.isAnEndpoint(c)))for(var l=this._splitSafely(a,c),h=0,f=l.length;h<f;h++)n.push(l[h])}var p=null;if(s){var d=s.getIntersection(e);if(null!==d&&(e.isAnEndpoint(d)||(p=d),!s.isAnEndpoint(d)))for(var v=this._splitSafely(s,d),m=0,g=v.length;m<g;m++)n.push(v[m])}if(null!==u||null!==p){var y=null;if(null===u)y=p;else if(null===p)y=u;else{var _=O.comparePoints(u,p);y=_<=0?u:p}this.queue.remove(e.rightSE),n.push(e.rightSE);for(var x=e.split(y),b=0,w=x.length;b<w;b++)n.push(x[b])}n.length>0?(this.tree.remove(e),n.push(t)):(this.segments.push(e),e.prev=a)}else{if(a&&s){var E=a.getIntersection(s);if(null!==E){if(!a.isAnEndpoint(E))for(var S=this._splitSafely(a,E),A=0,T=S.length;A<T;A++)n.push(S[A]);if(!s.isAnEndpoint(E))for(var C=this._splitSafely(s,E),k=0,M=C.length;k<M;k++)n.push(C[k])}}this.tree.remove(e)}return n}},{key:"_splitSafely",value:function(t,e){this.tree.remove(t);var n=t.rightSE;this.queue.remove(n);var r=t.split(e);return r.push(n),void 0===t.consumedBy&&this.tree.insert(t),r}}]),e}(),G="undefined"!==typeof process&&{NODE_ENV:"production",VUE_APP_BASE_URL:"http://production",VUE_APP_l7IMAGE:"/upload/ybimg/",BASE_URL:""}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,H="undefined"!==typeof process&&{NODE_ENV:"production",VUE_APP_BASE_URL:"http://production",VUE_APP_l7IMAGE:"/upload/ybimg/",BASE_URL:""}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6,W=function(){function e(){t(this,e)}return n(e,[{key:"run",value:function(t,e,n){q.type=t,S.reset();for(var r=[new B(e,!0)],i=0,o=n.length;i<o;i++)r.push(new B(n[i],!1));if(q.numMultiPolys=r.length,"difference"===q.type){var a=r[0],s=1;while(s<r.length)null!==y(r[s].bbox,a.bbox)?s++:r.splice(s,1)}if("intersection"===q.type)for(var u=0,c=r.length;u<c;u++)for(var h=r[u],f=u+1,p=r.length;f<p;f++)if(null===y(h.bbox,r[f].bbox))return[];for(var d=new l(O.compare),v=0,m=r.length;v<m;v++)for(var g=r[v].getSweepEvents(),_=0,x=g.length;_<x;_++)if(d.insert(g[_]),d.size>G)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big). Please file a bug report.");var b=new V(d),w=d.size,E=d.pop();while(E){var A=E.key;if(d.size===w){var T=A.segment;throw new Error("Unable to pop() ".concat(A.isLeft?"left":"right"," SweepEvent ")+"[".concat(A.point.x,", ").concat(A.point.y,"] from segment #").concat(T.id," ")+"[".concat(T.leftSE.point.x,", ").concat(T.leftSE.point.y,"] -> ")+"[".concat(T.rightSE.point.x,", ").concat(T.rightSE.point.y,"] from queue. ")+"Please file a bug report.")}if(d.size>G)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big). Please file a bug report.");if(b.segments.length>H)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments). Please file a bug report.");for(var C=b.process(A),k=0,M=C.length;k<M;k++){var P=C[k];void 0===P.consumedBy&&d.insert(P)}w=d.size,E=d.pop()}S.reset();var I=U.factory(b.segments),R=new Z(I);return R.getGeom()}}]),e}(),q=new W,X=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q.run("union",t,n)},Y=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q.run("intersection",t,n)},K=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q.run("xor",t,n)},Q=function(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];return q.run("difference",t,n)},J={union:X,intersection:Y,xor:K,difference:Q};return J}))},32861:function(t,e,n){var r,i=n(1692)["default"];n(81299),n(41817),n(33948),n(21703),n(57658),n(39575),n(82472),n(48675),n(33105),n(63408),n(14590),n(3462),n(33824),n(23767),n(8585),n(68696),function(t){(function(e){var r="object"===("undefined"===typeof n.g?"undefined":i(n.g))?n.g:"object"===("undefined"===typeof self?"undefined":i(self))?self:"object"===i(this)?this:Function("return this;")(),o=a(t);function a(t,e){return function(n,r){"function"!==typeof t[n]&&Object.defineProperty(t,n,{configurable:!0,writable:!0,value:r}),e&&e(n,r)}}"undefined"===typeof r.Reflect?r.Reflect=t:o=a(r.Reflect,o),e(o)})((function(t){var e=Object.prototype.hasOwnProperty,n="function"===typeof Symbol,r=n&&"undefined"!==typeof Symbol.toPrimitive?Symbol.toPrimitive:"@@toPrimitive",o=n&&"undefined"!==typeof Symbol.iterator?Symbol.iterator:"@@iterator",a="function"===typeof Object.create,s={__proto__:[]}instanceof Array,u=!a&&!s,c={create:a?function(){return ot(Object.create(null))}:s?function(){return ot({__proto__:null})}:function(){return ot({})},has:u?function(t,n){return e.call(t,n)}:function(t,e){return e in t},get:u?function(t,n){return e.call(t,n)?t[n]:void 0}:function(t,e){return t[e]}},l=Object.getPrototypeOf(Function),h="object"===("undefined"===typeof process?"undefined":i(process))&&{NODE_ENV:"production",VUE_APP_BASE_URL:"http://production",VUE_APP_l7IMAGE:"/upload/ybimg/",BASE_URL:""}&&"true"==={NODE_ENV:"production",VUE_APP_BASE_URL:"http://production",VUE_APP_l7IMAGE:"/upload/ybimg/",BASE_URL:""}["REFLECT_METADATA_USE_MAP_POLYFILL"],f=h||"function"!==typeof Map||"function"!==typeof Map.prototype.entries?nt():Map,p=h||"function"!==typeof Set||"function"!==typeof Set.prototype.entries?rt():Set,d=h||"function"!==typeof WeakMap?it():WeakMap,v=new d;function m(t,e,n,r){if(z(n)){if(!W(t))throw new TypeError;if(!X(e))throw new TypeError;return T(t,e)}if(!W(t))throw new TypeError;if(!U(e))throw new TypeError;if(!U(r)&&!z(r)&&!F(r))throw new TypeError;return F(r)&&(r=void 0),n=H(n),C(t,e,n,r)}function g(t,e){function n(n,r){if(!U(n))throw new TypeError;if(!z(r)&&!Y(r))throw new TypeError;L(t,e,n,r)}return n}function y(t,e,n,r){if(!U(n))throw new TypeError;return z(r)||(r=H(r)),L(t,e,n,r)}function _(t,e,n){if(!U(e))throw new TypeError;return z(n)||(n=H(n)),M(t,e,n)}function x(t,e,n){if(!U(e))throw new TypeError;return z(n)||(n=H(n)),P(t,e,n)}function b(t,e,n){if(!U(e))throw new TypeError;return z(n)||(n=H(n)),I(t,e,n)}function w(t,e,n){if(!U(e))throw new TypeError;return z(n)||(n=H(n)),R(t,e,n)}function E(t,e){if(!U(t))throw new TypeError;return z(e)||(e=H(e)),O(t,e)}function S(t,e){if(!U(t))throw new TypeError;return z(e)||(e=H(e)),D(t,e)}function A(t,e,n){if(!U(e))throw new TypeError;z(n)||(n=H(n));var r=k(e,n,!1);if(z(r))return!1;if(!r.delete(t))return!1;if(r.size>0)return!0;var i=v.get(e);return i.delete(n),i.size>0||v.delete(e),!0}function T(t,e){for(var n=t.length-1;n>=0;--n){var r=t[n],i=r(e);if(!z(i)&&!F(i)){if(!X(i))throw new TypeError;e=i}}return e}function C(t,e,n,r){for(var i=t.length-1;i>=0;--i){var o=t[i],a=o(e,n,r);if(!z(a)&&!F(a)){if(!U(a))throw new TypeError;r=a}}return r}function k(t,e,n){var r=v.get(t);if(z(r)){if(!n)return;r=new f,v.set(t,r)}var i=r.get(e);if(z(i)){if(!n)return;i=new f,r.set(e,i)}return i}function M(t,e,n){var r=P(t,e,n);if(r)return!0;var i=et(e);return!F(i)&&M(t,i,n)}function P(t,e,n){var r=k(e,n,!1);return!z(r)&&V(r.has(t))}function I(t,e,n){var r=P(t,e,n);if(r)return R(t,e,n);var i=et(e);return F(i)?void 0:I(t,i,n)}function R(t,e,n){var r=k(e,n,!1);if(!z(r))return r.get(t)}function L(t,e,n,r){var i=k(n,r,!0);i.set(t,e)}function O(t,e){var n=D(t,e),r=et(t);if(null===r)return n;var i=O(r,e);if(i.length<=0)return n;if(n.length<=0)return i;for(var o=new p,a=[],s=0,u=n;s<u.length;s++){var c=u[s],l=o.has(c);l||(o.add(c),a.push(c))}for(var h=0,f=i;h<f.length;h++){c=f[h],l=o.has(c);l||(o.add(c),a.push(c))}return a}function D(t,e){var n=[],r=k(t,e,!1);if(z(r))return n;var i=r.keys(),o=Q(i),a=0;while(1){var s=$(o);if(!s)return n.length=a,n;var u=J(s);try{n[a]=u}catch(c){try{tt(o)}finally{throw c}}a++}}function N(t){if(null===t)return 1;switch(i(t)){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return null===t?1:6;default:return 6}}function z(t){return void 0===t}function F(t){return null===t}function B(t){return"symbol"===i(t)}function U(t){return"object"===i(t)?null!==t:"function"===typeof t}function j(t,e){switch(N(t)){case 0:return t;case 1:return t;case 2:return t;case 3:return t;case 4:return t;case 5:return t}var n=3===e?"string":5===e?"number":"default",i=K(t,r);if(void 0!==i){var o=i.call(t,n);if(U(o))throw new TypeError;return o}return Z(t,"default"===n?"number":n)}function Z(t,e){if("string"===e){var n=t.toString;if(q(n)){var r=n.call(t);if(!U(r))return r}var i=t.valueOf;if(q(i)){r=i.call(t);if(!U(r))return r}}else{i=t.valueOf;if(q(i)){r=i.call(t);if(!U(r))return r}var o=t.toString;if(q(o)){r=o.call(t);if(!U(r))return r}}throw new TypeError}function V(t){return!!t}function G(t){return""+t}function H(t){var e=j(t,3);return B(e)?e:G(e)}function W(t){return Array.isArray?Array.isArray(t):t instanceof Object?t instanceof Array:"[object Array]"===Object.prototype.toString.call(t)}function q(t){return"function"===typeof t}function X(t){return"function"===typeof t}function Y(t){switch(N(t)){case 3:return!0;case 4:return!0;default:return!1}}function K(t,e){var n=t[e];if(void 0!==n&&null!==n){if(!q(n))throw new TypeError;return n}}function Q(t){var e=K(t,o);if(!q(e))throw new TypeError;var n=e.call(t);if(!U(n))throw new TypeError;return n}function J(t){return t.value}function $(t){var e=t.next();return!e.done&&e}function tt(t){var e=t["return"];e&&e.call(t)}function et(t){var e=Object.getPrototypeOf(t);if("function"!==typeof t||t===l)return e;if(e!==l)return e;var n=t.prototype,r=n&&Object.getPrototypeOf(n);if(null==r||r===Object.prototype)return e;var i=r.constructor;return"function"!==typeof i||i===t?e:i}function nt(){var t={},e=[],n=function(){function t(t,e,n){this._index=0,this._keys=t,this._values=e,this._selector=n}return t.prototype["@@iterator"]=function(){return this},t.prototype[o]=function(){return this},t.prototype.next=function(){var t=this._index;if(t>=0&&t<this._keys.length){var n=this._selector(this._keys[t],this._values[t]);return t+1>=this._keys.length?(this._index=-1,this._keys=e,this._values=e):this._index++,{value:n,done:!1}}return{value:void 0,done:!0}},t.prototype.throw=function(t){throw this._index>=0&&(this._index=-1,this._keys=e,this._values=e),t},t.prototype.return=function(t){return this._index>=0&&(this._index=-1,this._keys=e,this._values=e),{value:t,done:!0}},t}();return function(){function e(){this._keys=[],this._values=[],this._cacheKey=t,this._cacheIndex=-2}return Object.defineProperty(e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),e.prototype.has=function(t){return this._find(t,!1)>=0},e.prototype.get=function(t){var e=this._find(t,!1);return e>=0?this._values[e]:void 0},e.prototype.set=function(t,e){var n=this._find(t,!0);return this._values[n]=e,this},e.prototype.delete=function(e){var n=this._find(e,!1);if(n>=0){for(var r=this._keys.length,i=n+1;i<r;i++)this._keys[i-1]=this._keys[i],this._values[i-1]=this._values[i];return this._keys.length--,this._values.length--,e===this._cacheKey&&(this._cacheKey=t,this._cacheIndex=-2),!0}return!1},e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=t,this._cacheIndex=-2},e.prototype.keys=function(){return new n(this._keys,this._values,r)},e.prototype.values=function(){return new n(this._keys,this._values,i)},e.prototype.entries=function(){return new n(this._keys,this._values,a)},e.prototype["@@iterator"]=function(){return this.entries()},e.prototype[o]=function(){return this.entries()},e.prototype._find=function(t,e){return this._cacheKey!==t&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=t)),this._cacheIndex<0&&e&&(this._cacheIndex=this._keys.length,this._keys.push(t),this._values.push(void 0)),this._cacheIndex},e}();function r(t,e){return t}function i(t,e){return e}function a(t,e){return[t,e]}}function rt(){return function(){function t(){this._map=new f}return Object.defineProperty(t.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),t.prototype.has=function(t){return this._map.has(t)},t.prototype.add=function(t){return this._map.set(t,t),this},t.prototype.delete=function(t){return this._map.delete(t)},t.prototype.clear=function(){this._map.clear()},t.prototype.keys=function(){return this._map.keys()},t.prototype.values=function(){return this._map.values()},t.prototype.entries=function(){return this._map.entries()},t.prototype["@@iterator"]=function(){return this.keys()},t.prototype[o]=function(){return this.keys()},t}()}function it(){var t=16,n=c.create(),r=i();return function(){function t(){this._key=i()}return t.prototype.has=function(t){var e=o(t,!1);return void 0!==e&&c.has(e,this._key)},t.prototype.get=function(t){var e=o(t,!1);return void 0!==e?c.get(e,this._key):void 0},t.prototype.set=function(t,e){var n=o(t,!0);return n[this._key]=e,this},t.prototype.delete=function(t){var e=o(t,!1);return void 0!==e&&delete e[this._key]},t.prototype.clear=function(){this._key=i()},t}();function i(){var t;do{t="@@WeakMap@@"+u()}while(c.has(n,t));return n[t]=!0,t}function o(t,n){if(!e.call(t,r)){if(!n)return;Object.defineProperty(t,r,{value:c.create()})}return t[r]}function a(t,e){for(var n=0;n<e;++n)t[n]=255*Math.random()|0;return t}function s(t){return"function"===typeof Uint8Array?"undefined"!==typeof crypto?crypto.getRandomValues(new Uint8Array(t)):"undefined"!==typeof msCrypto?msCrypto.getRandomValues(new Uint8Array(t)):a(new Uint8Array(t),t):a(new Array(t),t)}function u(){var e=s(t);e[6]=79&e[6]|64,e[8]=191&e[8]|128;for(var n="",r=0;r<t;++r){var i=e[r];4!==r&&6!==r&&8!==r||(n+="-"),i<16&&(n+="0"),n+=i.toString(16).toLowerCase()}return n}}function ot(t){return t.__=void 0,delete t.__,t}t("decorate",m),t("metadata",g),t("defineMetadata",y),t("hasMetadata",_),t("hasOwnMetadata",x),t("getMetadata",b),t("getOwnMetadata",w),t("getMetadataKeys",E),t("getOwnMetadataKeys",S),t("deleteMetadata",A)}))}(r||(r={}))},44378:function(t,e,n){var r,i,o=n(1692)["default"];n(35837),n(57658),n(39575),n(76495),n(48675),n(33105),n(63408),n(14590),n(3462),n(33824),n(23767),n(8585),n(68696),n(8255),n(29135),n(44197),n(21703),function(a,s){"object"===o(e)?t.exports=s():(r=s,i="function"===typeof r?r.call(e,n,e,t):r,void 0===i||(t.exports=i))}(0,(function(){"use strict";function t(n,r,i,o,a,s){if(!(a-o<=i)){var u=o+a>>1;e(n,r,u,o,a,s%2),t(n,r,i,o,u-1,s+1),t(n,r,i,u+1,a,s+1)}}function e(t,r,i,o,a,s){while(a>o){if(a-o>600){var u=a-o+1,c=i-o+1,l=Math.log(u),h=.5*Math.exp(2*l/3),f=.5*Math.sqrt(l*h*(u-h)/u)*(c-u/2<0?-1:1),p=Math.max(o,Math.floor(i-c*h/u+f)),d=Math.min(a,Math.floor(i+(u-c)*h/u+f));e(t,r,i,p,d,s)}var v=r[2*i+s],m=o,g=a;n(t,r,o,i),r[2*a+s]>v&&n(t,r,o,a);while(m<g){n(t,r,m,g),m++,g--;while(r[2*m+s]<v)m++;while(r[2*g+s]>v)g--}r[2*o+s]===v?n(t,r,o,g):(g++,n(t,r,g,a)),g<=i&&(o=g+1),i<=g&&(a=g-1)}}function n(t,e,n,i){r(t,n,i),r(e,2*n,2*i),r(e,2*n+1,2*i+1)}function r(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function i(t,e,n,r,i,o,a){var s,u,c=[0,t.length-1,0],l=[];while(c.length){var h=c.pop(),f=c.pop(),p=c.pop();if(f-p<=a)for(var d=p;d<=f;d++)s=e[2*d],u=e[2*d+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(t[d]);else{var v=Math.floor((p+f)/2);s=e[2*v],u=e[2*v+1],s>=n&&s<=i&&u>=r&&u<=o&&l.push(t[v]);var m=(h+1)%2;(0===h?n<=s:r<=u)&&(c.push(p),c.push(v-1),c.push(m)),(0===h?i>=s:o>=u)&&(c.push(v+1),c.push(f),c.push(m))}}return l}function o(t,e,n,r,i,o){var s=[0,t.length-1,0],u=[],c=i*i;while(s.length){var l=s.pop(),h=s.pop(),f=s.pop();if(h-f<=o)for(var p=f;p<=h;p++)a(e[2*p],e[2*p+1],n,r)<=c&&u.push(t[p]);else{var d=Math.floor((f+h)/2),v=e[2*d],m=e[2*d+1];a(v,m,n,r)<=c&&u.push(t[d]);var g=(l+1)%2;(0===l?n-i<=v:r-i<=m)&&(s.push(f),s.push(d-1),s.push(g)),(0===l?n+i>=v:r+i>=m)&&(s.push(d+1),s.push(h),s.push(g))}}return u}function a(t,e,n,r){var i=t-n,o=e-r;return i*i+o*o}var s=function(t){return t[0]},u=function(t){return t[1]},c=function(e,n,r,i,o){void 0===n&&(n=s),void 0===r&&(r=u),void 0===i&&(i=64),void 0===o&&(o=Float64Array),this.nodeSize=i,this.points=e;for(var a=e.length<65536?Uint16Array:Uint32Array,c=this.ids=new a(e.length),l=this.coords=new o(2*e.length),h=0;h<e.length;h++)c[h]=h,l[2*h]=n(e[h]),l[2*h+1]=r(e[h]);t(c,l,i,0,c.length-1,0)};c.prototype.range=function(t,e,n,r){return i(this.ids,this.coords,t,e,n,r,this.nodeSize)},c.prototype.within=function(t,e,n){return o(this.ids,this.coords,t,e,n,this.nodeSize)};var l={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(t){return t}},h=Math.fround||function(t){return function(e){return t[0]=+e,t[0]}}(new Float32Array(1)),f=function(t){this.options=b(Object.create(l),t),this.trees=new Array(this.options.maxZoom+1)};function p(t,e,n,r,i){return{x:h(t),y:h(e),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function d(t,e){var n=t.geometry.coordinates,r=n[0],i=n[1];return{x:h(g(r)),y:h(y(i)),zoom:1/0,index:e,parentId:-1}}function v(t){return{type:"Feature",id:t.id,properties:m(t),geometry:{type:"Point",coordinates:[_(t.x),x(t.y)]}}}function m(t){var e=t.numPoints,n=e>=1e4?Math.round(e/1e3)+"k":e>=1e3?Math.round(e/100)/10+"k":e;return b(b({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function g(t){return t/360+.5}function y(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function _(t){return 360*(t-.5)}function x(t){var e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function b(t,e){for(var n in e)t[n]=e[n];return t}function w(t){return t.x}function E(t){return t.y}return f.prototype.load=function(t){var e=this.options,n=(e.log,e.minZoom),r=e.maxZoom,i=e.nodeSize;t.length;this.points=t;for(var o=[],a=0;a<t.length;a++)t[a].geometry&&o.push(d(t[a],a));this.trees[r+1]=new c(o,w,E,i,Float32Array);for(var s=r;s>=n;s--){Date.now();o=this._cluster(o,s),this.trees[s]=new c(o,w,E,i,Float32Array)}return this},f.prototype.getClusters=function(t,e){var n=((t[0]+180)%360+360)%360-180,r=Math.max(-90,Math.min(90,t[1])),i=180===t[2]?180:((t[2]+180)%360+360)%360-180,o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){var a=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return a.concat(s)}for(var u=this.trees[this._limitZoom(e)],c=u.range(g(n),y(o),g(i),y(r)),l=[],h=0,f=c;h<f.length;h+=1){var p=f[h],d=u.points[p];l.push(d.numPoints?v(d):this.points[d.index])}return l},f.prototype.getChildren=function(t){var e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);var o=i.points[e];if(!o)throw new Error(r);for(var a=this.options.radius/(this.options.extent*Math.pow(2,n-1)),s=i.within(o.x,o.y,a),u=[],c=0,l=s;c<l.length;c+=1){var h=l[c],f=i.points[h];f.parentId===t&&u.push(f.numPoints?v(f):this.points[f.index])}if(0===u.length)throw new Error(r);return u},f.prototype.getLeaves=function(t,e,n){e=e||10,n=n||0;var r=[];return this._appendLeaves(r,t,e,n,0),r},f.prototype.getTile=function(t,e,n){var r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),o=this.options,a=o.extent,s=o.radius,u=s/a,c=(n-u)/i,l=(n+1+u)/i,h={features:[]};return this._addTileFeatures(r.range((e-u)/i,c,(e+1+u)/i,l),r.points,e,n,i,h),0===e&&this._addTileFeatures(r.range(1-u/i,c,1,l),r.points,i,n,i,h),e===i-1&&this._addTileFeatures(r.range(0,c,u/i,l),r.points,-1,n,i,h),h.features.length?h:null},f.prototype.getClusterExpansionZoom=function(t){var e=this._getOriginZoom(t)-1;while(e<=this.options.maxZoom){var n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e},f.prototype._appendLeaves=function(t,e,n,r,i){for(var o=this.getChildren(e),a=0,s=o;a<s.length;a+=1){var u=s[a],c=u.properties;if(c&&c.cluster?i+c.point_count<=r?i+=c.point_count:i=this._appendLeaves(t,c.cluster_id,n,r,i):i<r?i++:t.push(u),t.length===n)break}return i},f.prototype._addTileFeatures=function(t,e,n,r,i,o){for(var a=0,s=t;a<s.length;a+=1){var u=s[a],c=e[u],l=c.numPoints,h=void 0,f=void 0,p=void 0;if(l)h=m(c),f=c.x,p=c.y;else{var d=this.points[c.index];h=d.properties,f=g(d.geometry.coordinates[0]),p=y(d.geometry.coordinates[1])}var v={type:1,geometry:[[Math.round(this.options.extent*(f*i-n)),Math.round(this.options.extent*(p*i-r))]],tags:h},_=void 0;l?_=c.id:this.options.generateId?_=c.index:this.points[c.index].id&&(_=this.points[c.index].id),void 0!==_&&(v.id=_),o.features.push(v)}},f.prototype._limitZoom=function(t){return Math.max(this.options.minZoom,Math.min(Math.floor(+t),this.options.maxZoom+1))},f.prototype._cluster=function(t,e){for(var n=[],r=this.options,i=r.radius,o=r.extent,a=r.reduce,s=r.minPoints,u=i/(o*Math.pow(2,e)),c=0;c<t.length;c++){var l=t[c];if(!(l.zoom<=e)){l.zoom=e;for(var h=this.trees[e+1],f=h.within(l.x,l.y,u),d=l.numPoints||1,v=d,m=0,g=f;m<g.length;m+=1){var y=g[m],_=h.points[y];_.zoom>e&&(v+=_.numPoints||1)}if(v>d&&v>=s){for(var x=l.x*d,b=l.y*d,w=a&&d>1?this._map(l,!0):null,E=(c<<5)+(e+1)+this.points.length,S=0,A=f;S<A.length;S+=1){var T=A[S],C=h.points[T];if(!(C.zoom<=e)){C.zoom=e;var k=C.numPoints||1;x+=C.x*k,b+=C.y*k,C.parentId=E,a&&(w||(w=this._map(l,!0)),a(w,this._map(C)))}}l.parentId=E,n.push(p(x/v,b/v,E,v,w))}else if(n.push(l),v>1)for(var M=0,P=f;M<P.length;M+=1){var I=P[M],R=h.points[I];R.zoom<=e||(R.zoom=e,n.push(R))}}}return n},f.prototype._getOriginId=function(t){return t-this.points.length>>5},f.prototype._getOriginZoom=function(t){return(t-this.points.length)%32},f.prototype._map=function(t,e){if(t.numPoints)return e?b({},t.properties):t.properties;var n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?b({},r):r},f}))},40347:function(t,e,n){var r,i,o;t=n.nmd(t);var a=n(1692)["default"];!function(n,s){"object"==a(e)&&"object"==a(t)?t.exports=s():(i=[],r=s,o="function"===typeof r?r.apply(e,i):r,void 0===o||(t.exports=o))}(0,(function(){return function(t){function e(r){if(n[r])return n[r].exports;var i=n[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,e),i.l=!0,i.exports}var n={};return e.m=t,e.c=n,e.i=function(t){return t},e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{configurable:!1,enumerable:!0,get:r})},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},e.p="",e(e.s=5)}([function(t,e,n){"use strict";function r(){var t={},e=!1,n=0,i=arguments.length;for("[object Boolean]"===Object.prototype.toString.call(arguments[0])&&(e=arguments[0],n++);n<i;n++){var o=arguments[n];!function(n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e&&"[object Object]"===Object.prototype.toString.call(n[i])?t[i]=r(!0,t[i],n[i]):t[i]=n[i])}(o)}return t}e.a=r},function(t,e){!function(){"use strict";var e="undefined"!=typeof window&&void 0!==window.document?window.document:{},n=void 0!==t&&t.exports,r=function(){for(var t,n=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],r=0,i=n.length,o={};r<i;r++)if((t=n[r])&&t[1]in e){for(r=0;r<t.length;r++)o[n[0][r]]=t[r];return o}return!1}(),i={change:r.fullscreenchange,error:r.fullscreenerror},o={request:function(t,n){return new Promise(function(i,o){var a=function(){this.off("change",a),i()}.bind(this);this.on("change",a),t=t||e.documentElement;var s=t[r.requestFullscreen](n);s instanceof Promise&&s.then(a).catch(o)}.bind(this))},exit:function(){return new Promise(function(t,n){if(this.isFullscreen){var i=function(){this.off("change",i),t()}.bind(this);this.on("change",i);var o=e[r.exitFullscreen]();o instanceof Promise&&o.then(i).catch(n)}else t()}.bind(this))},toggle:function(t,e){return this.isFullscreen?this.exit():this.request(t,e)},onchange:function(t){this.on("change",t)},onerror:function(t){this.on("error",t)},on:function(t,n){var r=i[t];r&&e.addEventListener(r,n,!1)},off:function(t,n){var r=i[t];r&&e.removeEventListener(r,n,!1)},raw:r};r?(Object.defineProperties(o,{isFullscreen:{get:function(){return Boolean(e[r.fullscreenElement])}},element:{enumerable:!0,get:function(){return e[r.fullscreenElement]}},isEnabled:{enumerable:!0,get:function(){return Boolean(e[r.fullscreenEnabled])}}}),n?t.exports=o:window.screenfull=o):n?t.exports={isEnabled:!1}:window.screenfull={isEnabled:!1}}()},function(t,e,n){"use strict";function r(t,e){t.style.position=e.position,t.style.left=e.left,t.style.top=e.top,t.style.width=e.width,t.style.height=e.height}function i(t){var e=t.element;e&&(e.classList.remove(t.options.fullscreenClass),(t.options.teleport||t.options.pageOnly)&&(t.options.teleport&&l&&(l.insertBefore(e,c),l.removeChild(c)),e.__styleCache&&r(e,e.__styleCache)))}var o=n(1),a=n.n(o),s=n(0),u={callback:function(){},fullscreenClass:"fullscreen",pageOnly:!1,teleport:!1},c=void 0,l=void 0,h={options:null,element:null,isFullscreen:!1,isEnabled:a.a.isEnabled,toggle:function(t,e,n){return void 0===n?this.isFullscreen?this.exit():this.request(t,e):n?this.request(t,e):this.exit()},request:function(t,e){var o=this;if(this.isFullscreen)return Promise.resolve();if(t||(t=document.body),this.options=n.i(s.a)({},u,e),t===document.body&&(this.options.teleport=!1),a.a.isEnabled||(this.options.pageOnly=!0),t.classList.add(this.options.fullscreenClass),this.options.teleport||this.options.pageOnly){var h=t.style,f=h.position,p=h.left,d=h.top,v=h.width,m=h.height;t.__styleCache={position:f,left:p,top:d,width:v,height:m},r(t,{position:"fixed",left:"0",top:"0",width:"100%",height:"100%"})}if(this.options.teleport&&(l=t.parentNode)&&(c=document.createComment("fullscreen-token"),l.insertBefore(c,t),document.body.appendChild(t)),this.options.pageOnly){var g=function t(e){"Escape"===e.key&&(document.removeEventListener("keyup",t),o.exit())};return this.isFullscreen=!0,this.element=t,document.removeEventListener("keyup",g),document.addEventListener("keyup",g),this.options.callback&&this.options.callback(this.isFullscreen),Promise.resolve()}var y=function e(){a.a.isFullscreen||(a.a.off("change",e),i(o)),o.isFullscreen=a.a.isFullscreen,o.options.teleport?o.element=t||null:o.element=a.a.element,o.options.callback&&o.options.callback(a.a.isFullscreen)};return a.a.on("change",y),a.a.request(this.options.teleport?document.body:t)},exit:function(){return this.isFullscreen?this.options.pageOnly?(i(this),this.isFullscreen=!1,this.element=null,this.options.callback&&this.options.callback(this.isFullscreen),Promise.resolve()):a.a.exit():Promise.resolve()}};h.support=h.isEnabled,h.getState=function(){return h.isFullscreen},h.enter=h.request,e.a=h},function(t,e,n){"use strict";function r(t,e){var n={};for(var r in t)e.indexOf(r)>=0||Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r]);return n}var i=n(2),o=n(0),a=function(t,e){var a=function(){var t=void 0,a={teleport:e.modifiers.teleport,pageOnly:e.modifiers.pageOnly};if(e.value)if("string"==typeof e.value)t=e.value;else{var s=e.value,u=s.target,c=r(s,["target"]);t=u,a=n.i(o.a)(a,c)}"string"==typeof t&&(t=document.querySelector(t)),i.a.toggle(t,a)};t._onClickFullScreen&&t.removeEventListener("click",t._onClickFullScreen),t.addEventListener("click",a),t._onClickFullScreen=a};e.a=a},function(t,e,n){var r=n(7)(n(6),n(8),null,null);t.exports=r.exports},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(4),i=n.n(r),o=n(2),a=n(3),s=n(1),u=n.n(s),c=n(0);n.d(e,"screenfull",(function(){return u.a})),n.d(e,"api",(function(){return o.a})),n.d(e,"directive",(function(){return a.a})),n.d(e,"component",(function(){return i.a})),e.default={install:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e.name||"fullscreen";t.component(r,n.i(c.a)(i.a,{name:r})),t.prototype["$"+r]=o.a,t.directive(r,a.a)}}},function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var r=n(1),i=n.n(r);e.default={props:{value:{type:Boolean,default:!1},fullscreen:{type:Boolean,default:!1},exitOnClickWrapper:{type:Boolean,default:!0},fullscreenClass:{type:String,default:"fullscreen"},pageOnly:{type:Boolean,default:!1},teleport:{type:Boolean,default:!1}},data:function(){return{isFullscreen:!1,isEnabled:!1}},computed:{support:function(){return this.isEnabled},isPageOnly:function(){return this.pageOnly||!i.a.isEnabled},wrapperStyle:function(){return(this.isPageOnly||this.teleport)&&this.isFullscreen?{position:"fixed",left:"0",top:"0",width:"100%",height:"100%"}:void 0}},methods:{toggle:function(t){void 0===t?this.isFullscreen?this.exit():this.request():t?this.request():this.exit()},request:function(){if(this.isPageOnly?(this.isFullscreen=!0,this.onChangeFullScreen(),document.removeEventListener("keyup",this.keypressCallback),document.addEventListener("keyup",this.keypressCallback)):(i.a.off("change",this.fullScreenCallback),i.a.on("change",this.fullScreenCallback),i.a.request(this.teleport?document.body:this.$el)),this.teleport){if(this.$el.parentNode===document.body)return;this.__parentNode=this.$el.parentNode,this.__token=document.createComment("fullscreen-token"),this.__parentNode.insertBefore(this.__token,this.$el),document.body.appendChild(this.$el)}},exit:function(){this.isFullscreen&&(this.isPageOnly?(this.isFullscreen=!1,this.onChangeFullScreen(),document.removeEventListener("keyup",this.keypressCallback)):i.a.exit())},shadeClick:function(t){t.target===this.$el&&this.exitOnClickWrapper&&this.exit()},fullScreenCallback:function(){i.a.isFullscreen||i.a.off("change",this.fullScreenCallback),this.isFullscreen=i.a.isFullscreen,this.onChangeFullScreen()},keypressCallback:function(t){"Escape"===t.key&&this.exit()},onChangeFullScreen:function(){this.isFullscreen||this.teleport&&this.__parentNode&&(this.__parentNode.insertBefore(this.$el,this.__token),this.__parentNode.removeChild(this.__token)),this.$emit("change",this.isFullscreen),this.$emit("update:fullscreen",this.isFullscreen),this.$emit("input",this.isFullscreen)},enter:function(){this.request()},getState:function(){return this.isFullscreen}},watch:{value:function(t){t!==this.isFullscreen&&(t?this.request():this.exit())},fullscreen:function(t){t!==this.isFullscreen&&(t?this.request():this.exit())}},created:function(){this.isEnabled=i.a.isEnabled}}},function(t,e){t.exports=function(t,e,n,r){var i,o=t=t||{},s=a(t.default);"object"!==s&&"function"!==s||(i=t,o=t.default);var u="function"==typeof o?o.options:o;if(e&&(u.render=e.render,u.staticRenderFns=e.staticRenderFns),n&&(u._scopeId=n),r){var c=Object.create(u.computed||null);Object.keys(r).forEach((function(t){var e=r[t];c[t]=function(){return e}})),u.computed=c}return{esModule:i,exports:o,options:u}}},function(t,e){t.exports={render:function(){var t,e=this,n=e.$createElement;return(e._self._c||n)("div",e._b({ref:"wrapper",class:(t={},t[e.fullscreenClass]=e.isFullscreen,t),style:e.wrapperStyle,on:{click:function(t){return e.shadeClick(t)}}},"div",e.$attrs,!1),[e._t("default")],2)},staticRenderFns:[]}}])}))},93678:function(t){t.exports={IndexSizeError:{s:"INDEX_SIZE_ERR",c:1,m:1},DOMStringSizeError:{s:"DOMSTRING_SIZE_ERR",c:2,m:0},HierarchyRequestError:{s:"HIERARCHY_REQUEST_ERR",c:3,m:1},WrongDocumentError:{s:"WRONG_DOCUMENT_ERR",c:4,m:1},InvalidCharacterError:{s:"INVALID_CHARACTER_ERR",c:5,m:1},NoDataAllowedError:{s:"NO_DATA_ALLOWED_ERR",c:6,m:0},NoModificationAllowedError:{s:"NO_MODIFICATION_ALLOWED_ERR",c:7,m:1},NotFoundError:{s:"NOT_FOUND_ERR",c:8,m:1},NotSupportedError:{s:"NOT_SUPPORTED_ERR",c:9,m:1},InUseAttributeError:{s:"INUSE_ATTRIBUTE_ERR",c:10,m:1},InvalidStateError:{s:"INVALID_STATE_ERR",c:11,m:1},SyntaxError:{s:"SYNTAX_ERR",c:12,m:1},InvalidModificationError:{s:"INVALID_MODIFICATION_ERR",c:13,m:1},NamespaceError:{s:"NAMESPACE_ERR",c:14,m:1},InvalidAccessError:{s:"INVALID_ACCESS_ERR",c:15,m:1},ValidationError:{s:"VALIDATION_ERR",c:16,m:0},TypeMismatchError:{s:"TYPE_MISMATCH_ERR",c:17,m:1},SecurityError:{s:"SECURITY_ERR",c:18,m:1},NetworkError:{s:"NETWORK_ERR",c:19,m:1},AbortError:{s:"ABORT_ERR",c:20,m:1},URLMismatchError:{s:"URL_MISMATCH_ERR",c:21,m:1},QuotaExceededError:{s:"QUOTA_EXCEEDED_ERR",c:22,m:1},TimeoutError:{s:"TIMEOUT_ERR",c:23,m:1},InvalidNodeTypeError:{s:"INVALID_NODE_TYPE_ERR",c:24,m:1},DataCloneError:{s:"DATA_CLONE_ERR",c:25,m:1}}},7762:function(t,e,n){"use strict";var r=n(19781),i=n(47293),o=n(19670),a=n(70030),s=n(56277),u=Error.prototype.toString,c=i((function(){if(r){var t=a(Object.defineProperty({},"name",{get:function(){return this===t}}));if("true"!==u.call(t))return!0}return"2: 1"!==u.call({message:1,name:2})||"Error"!==u.call({})}));t.exports=c?function(){var t=o(this),e=s(t.name,"Error"),n=s(t.message);return e?n?e+": "+n:e:n}:u},44038:function(t,e,n){var r=n(35268);t.exports=function(t){try{if(r)return Function('return require("'+t+'")')()}catch(e){}}},52262:function(t,e,n){"use strict";var r=n(82109),i=n(47908),o=n(26244),a=n(19303),s=n(51223);r({target:"Array",proto:!0},{at:function(t){var e=i(this),n=o(e),r=a(t),s=r>=0?r:n+r;return s<0||s>=n?void 0:e[s]}}),s("at")},77287:function(t,e,n){"use strict";var r=n(82109),i=n(9671).findLastIndex,o=n(51223);r({target:"Array",proto:!0},{findLastIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),o("findLastIndex")},67635:function(t,e,n){"use strict";var r=n(82109),i=n(9671).findLast,o=n(51223);r({target:"Array",proto:!0},{findLast:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),o("findLast")},24506:function(t,e,n){"use strict";var r=n(82109),i=n(1702),o=n(84488),a=n(19303),s=n(41340),u=n(47293),c=i("".charAt),l=u((function(){return"\ud842"!=="𠮷".at(-2)}));r({target:"String",proto:!0,forced:l},{at:function(t){var e=s(o(this)),n=e.length,r=a(t),i=r>=0?r:n+r;return i<0||i>=n?void 0:c(e,i)}})},87714:function(t,e,n){"use strict";var r=n(82109),i=n(44038),o=n(35005),a=n(47293),s=n(70030),u=n(79114),c=n(3070).f,l=n(98052),h=n(47045),f=n(92597),p=n(25787),d=n(19670),v=n(7762),m=n(56277),g=n(93678),y=n(11060),_=n(29909),x=n(19781),b=n(31913),w="DOMException",E="DATA_CLONE_ERR",S=o("Error"),A=o(w)||function(){try{var t=o("MessageChannel")||i("worker_threads").MessageChannel;(new t).port1.postMessage(new WeakMap)}catch(e){if(e.name==E&&25==e.code)return e.constructor}}(),T=A&&A.prototype,C=S.prototype,k=_.set,M=_.getterFor(w),P="stack"in S(w),I=function(t){return f(g,t)&&g[t].m?g[t].c:0},R=function(){p(this,L);var t=arguments.length,e=m(t<1?void 0:arguments[0]),n=m(t<2?void 0:arguments[1],"Error"),r=I(n);if(k(this,{type:w,name:n,message:e,code:r}),x||(this.name=n,this.message=e,this.code=r),P){var i=S(e);i.name=w,c(this,"stack",u(1,y(i.stack,1)))}},L=R.prototype=s(C),O=function(t){return{enumerable:!0,configurable:!0,get:t}},D=function(t){return O((function(){return M(this)[t]}))};x&&(h(L,"code",D("code")),h(L,"message",D("message")),h(L,"name",D("name"))),c(L,"constructor",u(1,R));var N=a((function(){return!(new A instanceof S)})),z=N||a((function(){return C.toString!==v||"2: 1"!==String(new A(1,2))})),F=N||a((function(){return 25!==new A(1,"DataCloneError").code})),B=N||25!==A[E]||25!==T[E],U=b?z||F||B:N;r({global:!0,constructor:!0,forced:U},{DOMException:U?R:A});var j=o(w),Z=j.prototype;for(var V in z&&(b||A===j)&&l(Z,"toString",v),F&&x&&A===j&&h(Z,"code",O((function(){return I(d(this).name)}))),g)if(f(g,V)){var G=g[V],H=G.s,W=u(6,G.c);f(j,H)||c(j,H,W),f(Z,H)||c(Z,H,W)}},82801:function(t,e,n){"use strict";var r=n(82109),i=n(17854),o=n(35005),a=n(79114),s=n(3070).f,u=n(92597),c=n(25787),l=n(79587),h=n(56277),f=n(93678),p=n(11060),d=n(19781),v=n(31913),m="DOMException",g=o("Error"),y=o(m),_=function(){c(this,x);var t=arguments.length,e=h(t<1?void 0:arguments[0]),n=h(t<2?void 0:arguments[1],"Error"),r=new y(e,n),i=g(e);return i.name=m,s(r,"stack",a(1,p(i.stack,1))),l(r,this,_),r},x=_.prototype=y.prototype,b="stack"in g(m),w="stack"in new y(1,2),E=y&&d&&Object.getOwnPropertyDescriptor(i,m),S=!!E&&!(E.writable&&E.configurable),A=b&&!S&&!w;r({global:!0,constructor:!0,forced:v||A},{DOMException:A?_:y});var T=o(m),C=T.prototype;if(C.constructor!==T)for(var k in v||s(C,"constructor",a(1,T)),f)if(u(f,k)){var M=f[k],P=M.s;u(T,P)||s(T,P,a(6,M.c))}},1174:function(t,e,n){var r=n(35005),i=n(58003),o="DOMException";i(r(o),o)},87475:function(t){function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}t.exports=e,t.exports.__esModule=!0,t.exports["default"]=t.exports},64024:function(t,e,n){var r=n(87475);function i(t){if(Array.isArray(t))return r(t)}t.exports=i,t.exports.__esModule=!0,t.exports["default"]=t.exports},86728:function(t,e,n){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}n(21703),t.exports=r,t.exports.__esModule=!0,t.exports["default"]=t.exports},32046:function(t,e,n){var r=n(42944);function i(t,e){for(var n=0;n<e.length;n++){var i=e[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,r(i.key),i)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),Object.defineProperty(t,"prototype",{writable:!1}),t}t.exports=o,t.exports.__esModule=!0,t.exports["default"]=t.exports},51933:function(t,e,n){function r(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}n(41817),n(33948),t.exports=r,t.exports.__esModule=!0,t.exports["default"]=t.exports},85141:function(t,e,n){function r(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}n(21703),t.exports=r,t.exports.__esModule=!0,t.exports["default"]=t.exports},85409:function(t,e,n){n(41817),n(33948),n(72443),n(21703),n(57658),n(65069);var r=n(1692)["default"];function i(){"use strict";t.exports=i=function(){return e},t.exports.__esModule=!0,t.exports["default"]=t.exports;var e={},n=Object.prototype,o=n.hasOwnProperty,a=Object.defineProperty||function(t,e,n){t[e]=n.value},s="function"==typeof Symbol?Symbol:{},u=s.iterator||"@@iterator",c=s.asyncIterator||"@@asyncIterator",l=s.toStringTag||"@@toStringTag";function h(t,e,n){return Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{h({},"")}catch(I){h=function(t,e,n){return t[e]=n}}function f(t,e,n,r){var i=e&&e.prototype instanceof v?e:v,o=Object.create(i.prototype),s=new k(r||[]);return a(o,"_invoke",{value:S(t,n,s)}),o}function p(t,e,n){try{return{type:"normal",arg:t.call(e,n)}}catch(I){return{type:"throw",arg:I}}}e.wrap=f;var d={};function v(){}function m(){}function g(){}var y={};h(y,u,(function(){return this}));var _=Object.getPrototypeOf,x=_&&_(_(M([])));x&&x!==n&&o.call(x,u)&&(y=x);var b=g.prototype=v.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){h(t,e,(function(t){return this._invoke(e,t)}))}))}function E(t,e){function n(i,a,s,u){var c=p(t[i],t,a);if("throw"!==c.type){var l=c.arg,h=l.value;return h&&"object"==r(h)&&o.call(h,"__await")?e.resolve(h.__await).then((function(t){n("next",t,s,u)}),(function(t){n("throw",t,s,u)})):e.resolve(h).then((function(t){l.value=t,s(l)}),(function(t){return n("throw",t,s,u)}))}u(c.arg)}var i;a(this,"_invoke",{value:function(t,r){function o(){return new e((function(e,i){n(t,r,e,i)}))}return i=i?i.then(o,o):o()}})}function S(t,e,n){var r="suspendedStart";return function(i,o){if("executing"===r)throw new Error("Generator is already running");if("completed"===r){if("throw"===i)throw o;return P()}for(n.method=i,n.arg=o;;){var a=n.delegate;if(a){var s=A(a,n);if(s){if(s===d)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if("suspendedStart"===r)throw r="completed",n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);r="executing";var u=p(t,e,n);if("normal"===u.type){if(r=n.done?"completed":"suspendedYield",u.arg===d)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(r="completed",n.method="throw",n.arg=u.arg)}}}function A(t,e){var n=e.method,r=t.iterator[n];if(void 0===r)return e.delegate=null,"throw"===n&&t.iterator["return"]&&(e.method="return",e.arg=void 0,A(t,e),"throw"===e.method)||"return"!==n&&(e.method="throw",e.arg=new TypeError("The iterator does not provide a '"+n+"' method")),d;var i=p(r,t.iterator,e.arg);if("throw"===i.type)return e.method="throw",e.arg=i.arg,e.delegate=null,d;var o=i.arg;return o?o.done?(e[t.resultName]=o.value,e.next=t.nextLoc,"return"!==e.method&&(e.method="next",e.arg=void 0),e.delegate=null,d):o:(e.method="throw",e.arg=new TypeError("iterator result is not an object"),e.delegate=null,d)}function T(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function C(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function k(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(T,this),this.reset(!0)}function M(t){if(t){var e=t[u];if(e)return e.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var n=-1,r=function e(){for(;++n<t.length;)if(o.call(t,n))return e.value=t[n],e.done=!1,e;return e.value=void 0,e.done=!0,e};return r.next=r}}return{next:P}}function P(){return{value:void 0,done:!0}}return m.prototype=g,a(b,"constructor",{value:g,configurable:!0}),a(g,"constructor",{value:m,configurable:!0}),m.displayName=h(g,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===m||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,g):(t.__proto__=g,h(t,l,"GeneratorFunction")),t.prototype=Object.create(b),t},e.awrap=function(t){return{__await:t}},w(E.prototype),h(E.prototype,c,(function(){return this})),e.AsyncIterator=E,e.async=function(t,n,r,i,o){void 0===o&&(o=Promise);var a=new E(f(t,n,r,i),o);return e.isGeneratorFunction(n)?a:a.next().then((function(t){return t.done?t.value:a.next()}))},w(b),h(b,l,"Generator"),h(b,u,(function(){return this})),h(b,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),n=[];for(var r in e)n.push(r);return n.reverse(),function t(){for(;n.length;){var r=n.pop();if(r in e)return t.value=r,t.done=!1,t}return t.done=!0,t}},e.values=M,k.prototype={constructor:k,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=void 0,this.done=!1,this.delegate=null,this.method="next",this.arg=void 0,this.tryEntries.forEach(C),!t)for(var e in this)"t"===e.charAt(0)&&o.call(this,e)&&!isNaN(+e.slice(1))&&(this[e]=void 0)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(t){if(this.done)throw t;var e=this;function n(n,r){return a.type="throw",a.arg=t,e.next=n,r&&(e.method="next",e.arg=void 0),!!r}for(var r=this.tryEntries.length-1;r>=0;--r){var i=this.tryEntries[r],a=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var s=o.call(i,"catchLoc"),u=o.call(i,"finallyLoc");if(s&&u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(s){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,e){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,"finallyLoc")&&this.prev<r.finallyLoc){var i=r;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,d):this.complete(a)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),d},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.finallyLoc===t)return this.complete(n.completion,n.afterLoc),C(n),d}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var n=this.tryEntries[e];if(n.tryLoc===t){var r=n.completion;if("throw"===r.type){var i=r.arg;C(n)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,e,n){return this.delegate={iterator:M(t),resultName:e,nextLoc:n},"next"===this.method&&(this.arg=void 0),d}},e}t.exports=i,t.exports.__esModule=!0,t.exports["default"]=t.exports},4982:function(t,e,n){var r=n(64024),i=n(51933),o=n(47979),a=n(85141);function s(t){return r(t)||i(t)||o(t)||a()}t.exports=s,t.exports.__esModule=!0,t.exports["default"]=t.exports},16857:function(t,e,n){n(41817),n(21703);var r=n(1692)["default"];function i(t,e){if("object"!==r(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var i=n.call(t,e||"default");if("object"!==r(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}t.exports=i,t.exports.__esModule=!0,t.exports["default"]=t.exports},42944:function(t,e,n){var r=n(1692)["default"],i=n(16857);function o(t){var e=i(t,"string");return"symbol"===r(e)?e:String(e)}t.exports=o,t.exports.__esModule=!0,t.exports["default"]=t.exports},47979:function(t,e,n){n(74916);var r=n(87475);function i(t,e){if(t){if("string"===typeof t)return r(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?r(t,e):void 0}}t.exports=i,t.exports.__esModule=!0,t.exports["default"]=t.exports},82558:function(t,e,n){function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}n(35837),n(41817),n(33948);var i=n(85409)();t.exports=i;try{regeneratorRuntime=i}catch(o){"object"===("undefined"===typeof globalThis?"undefined":r(globalThis))?globalThis.regeneratorRuntime=i:Function("r","regeneratorRuntime = r")(i)}},89108:function(t,e,n){"use strict";function r(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}n.d(e,{Z:function(){return r}})},78910:function(t,e,n){"use strict";function r(t){if(Array.isArray(t))return t}n.d(e,{Z:function(){return s}});n(41817),n(33948);function i(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o,a,s=[],u=!0,c=!1;try{if(o=(n=n.call(t)).next,0===e){if(Object(n)!==n)return;u=!1}else for(;!(u=(r=o.call(n)).done)&&(s.push(r.value),s.length!==e);u=!0);}catch(l){c=!0,i=l}finally{try{if(!u&&null!=n["return"]&&(a=n["return"](),Object(a)!==a))return}finally{if(c)throw i}}return s}}var o=n(67553);function a(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function s(t,e){return r(t)||i(t,e)||(0,o.Z)(t,e)||a()}},23698:function(t,e,n){"use strict";n.d(e,{Z:function(){return u}});var r=n(89108);function i(t){if(Array.isArray(t))return(0,r.Z)(t)}n(41817),n(33948);function o(t){if("undefined"!==typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}var a=n(67553);function s(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function u(t){return i(t)||o(t)||(0,a.Z)(t)||s()}},67553:function(t,e,n){"use strict";n.d(e,{Z:function(){return i}});n(74916);var r=n(89108);function i(t,e){if(t){if("string"===typeof t)return(0,r.Z)(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?(0,r.Z)(t,e):void 0}}}}]);